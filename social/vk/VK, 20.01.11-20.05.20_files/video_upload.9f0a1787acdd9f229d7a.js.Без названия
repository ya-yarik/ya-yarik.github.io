!function(e){function o(o){for(var i,l,_=o[0],r=o[1],s=o[2],u=0,p=[];u<_.length;u++)l=_[u],Object.prototype.hasOwnProperty.call(d,l)&&d[l]&&p.push(d[l][0]),d[l]=0;for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);for(n&&n(o);p.length;)p.shift()();return t.push.apply(t,s||[]),a()}function a(){for(var e,o=0;o<t.length;o++){for(var a=t[o],i=!0,_=1;_<a.length;_++){var r=a[_];0!==d[r]&&(i=!1)}i&&(t.splice(o--,1),e=l(l.s=a[0]))}return e}var i={},d={"web/video_upload":0},t=[];function l(o){if(i[o])return i[o].exports;var a=i[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=i,l.d=function(e,o,a){l.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:a})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,o){if(1&o&&(e=l(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var i in e)l.d(a,i,function(o){return e[o]}.bind(null,i));return a},l.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(o,"a",o),o},l.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},l.p="/js/cmodules/";var _=window.webpackJsonp=window.webpackJsonp||[],r=_.push.bind(_);_.push=o,_=_.slice();for(var s=0;s<_.length;s++)o(_[s]);var n=r;t.push([281,"bundles/common"]),a()}({281:function(e,o,a){e.exports=a("LSJr")},"8h6g":function(e,o,a){"use strict";a.r(o),a.d(o,"VIDEO_UPLOAD_EXTS",(function(){return i})),a.d(o,"VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB",(function(){return d})),a.d(o,"VIDEO_UPLOAD_CHUNK_SIZE",(function(){return t}));a("KKXr");var i="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),d=5,t=4194304},Bwan:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("pIFo"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("91GP"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Btvt"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("zxIV"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("EasH"),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("cGUQ"),_video_upload_vars__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("8h6g"),_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("hogn"),VideoUpload={FILE_TYPES:"",UPLOAD_ACCEPT:"",uploadNum:0,showBox:function(e){function o(o){return e.apply(this,arguments)}return o.toString=function(){return e.toString()},o}((function(e){return re("video_upload_box_placeholder"),cur.uploadBanned?(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)({title:getLang("video_no_upload_title")},getLang("video_claims_no_upload")),!1):ge("video_upload_block")||4!=vk.al?(e=e||{},(e=extend(e,{ocl:cur.ocl?1:0})).oid||(e.oid=cur.oid||vk.id),cur.uploadVideoBox=showBox("al_video.php?act=upload_box",e,{stat:["video_edit.css","privacy.css",jsc("web/privacy.js")],params:{containerClass:"video_upload_box",onHide:window.VideoUpload.onHideUploadPanel,onDestroy:window.VideoUpload.onDestroyUploadBox,onShow:window.VideoUpload.onShowUploadPanel,width:450},onDone:()=>{cur.uploadVideoBox.removeButtons(),hide(domNS(cur.uploadVideoBox.bodyNode)),inArray(e.from,["board","post","comment","message"])&&window.VideoUpload.toExternalAdd(e.from)}}),!1):nav.go("videos"+cur.oid+"?z=upload_video")})),init:function(){window.VideoUpload.buildExtMasks(),window.VideoUpload.startEvents()},buildExtMasks:function(){var e=_video_upload_vars__WEBPACK_IMPORTED_MODULE_9__.VIDEO_UPLOAD_EXTS;window.VideoUpload.UPLOAD_ACCEPT="."+e.join(",.");for(var o=e.length,a=0;a<o;++a)e.push(e[a].toUpperCase());window.VideoUpload.FILE_TYPES="*."+e.join(";*.")},startEvents:function(){addEvent(boxLayerWrap,"scroll",window.VideoUpload.checkResize),addEvent(window,"resize",window.VideoUpload.checkResize)},stopEvents:function(){removeEvent(boxLayerWrap,"scroll",window.VideoUpload.checkResize),removeEvent(window,"resize",window.VideoUpload.checkResize)},onHideUploadPanel:function(){},onDestroyUploadBox:function(){window.VideoUpload.stopEvents(),delete cur.uploadVideoResizeTimeout,delete window.cur.uploadVideoBox},onShowUploadPanel:function(){ge("video_upload_box_placeholder")&&isVisible("video_upload_box_tab"),window.VideoUpload.doResize()},checkResize:function(){window.VideoUpload.doResize(),cur.uploadVideoResizeTimeout&&clearTimeout(cur.uploadVideoResizeTimeout),cur.uploadVideoResizeTimeout=setTimeout(window.VideoUpload.doResize,1)},destroyTab:function(){var e=ge("video_upload_block");if(e){var o=geByClass("video_upload",e);each(o,e=>{var a=o[e];cleanElems(a)})}},doResize:function(){},onPrivacyChanged:function(e){var o=cur.tag2ElMap[e.substr(5)],a=geByClass1("video_upload_publish",o);Privacy.getValue(e)>0?(removeClass(a,"on"),addClass(a,"disabled")):removeClass(a,"disabled")},onThumbClick(e,o){var a=gpeByClass("video_upload",e),i=domData(e,"video");return showInlineVideo(i,"",{autoplay:1,module:"upload",onLoaded:()=>{var e=isChecked(geByClass1("video_edit_repeat",a));Videoview.getPlayerObject().toggleLoop(e)}},o,e),!1},onRepeatChanged(e){VideoUpload.updatePlayer(gpeByClass("video_upload",e))},initUpload:function initUpload(uploadOptions,subtitleUploadOptions,itemTemplate){uploadOptions=JSON.parse(uploadOptions),cur.lang=extend(cur.lang||{},uploadOptions.lang,uploadOptions.lang_ui);var hashs={},tag=uploadOptions.vars.tag,ownerId=uploadOptions.vars.oid,options=uploadOptions.options;if(hashs[tag]=options.update_db_hash,cur.videoHashs=extend(cur.videoHashs||{},hashs),!ge("video_dropbox")){var p=ge("video_upload_box_tab").parentNode.parentNode.parentNode,d=se(`<div id="video_dropbox" class="dropbox choose">\n          <div class="dropbox_wrap">\n            <div class="dropbox_area">\n              <div class="dropbox_label">${uploadOptions.lang.drop_files_here}</div>\n            </div>\n          </div>\n        </div>`);p.appendChild(d)}window.VideoUpload.onShowUploadPanel();var placeholder=ge("video_upload_box_placeholder"),uploadItem=se('<div id="video_upload_box'+tag+'" class="noselect"></div>');placeholder.appendChild(uploadItem);var initButton=function initButton(){var uploadErrorInfo=ge("video_upload_fail_info");uploadErrorInfo&&(hide(uploadErrorInfo),Upload.init("video_upload_box"+tag,uploadOptions.url,uploadOptions.vars,{file_name:"video_file",file_size_limit:1024*(uploadOptions.options.file_size_limit_in_GB||_video_upload_vars__WEBPACK_IMPORTED_MODULE_9__.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:window.VideoUpload.FILE_TYPES,lang:uploadOptions.lang,flat_button:1,filesize_hide_last:1,chunked:1,chunkSize:_video_upload_vars__WEBPACK_IMPORTED_MODULE_9__.VIDEO_UPLOAD_CHUNK_SIZE,onUploadStart:function(e,o){var a=void 0!==e.ind?e.ind:e;cur._uploadStart=vkNow(),VideoUpload.uploadNum++,delete window.VideoUpload.videoUploadCallback;var i=function(){uploadOptions.vars.save_hashes||(nav.objLoc.section="upload",nav.setLoc(nav.objLoc));var o=se(rs(itemTemplate,{id:a}));window.VideoUpload.initBeforeUnload();var i=ge("video_upload_block"),d=domPN(geByClass1("video_upload",i));if(d){var t=geByClass1("page_block_h2",d).cloneNode(!0),l=geByClass1("_header_inner",t),_=d.cloneNode(!0);val(_,""),val(l,`${getLang("video_adding_video_title")} ${VideoUpload.uploadNum}`),_.appendChild(t),_.appendChild(o),i.appendChild(_),scrollTo(0,getXY(_)[1]-getSize(l)[1])}else{VideoUpload.uploadNum=1,geByClass1("page_block",i).appendChild(o)}re("video_upload_no_video"),uploadOptions.vars.save_hashes&&cur.oid>0&&(hide("video_edit_repeat"),hide(geByClass1("video_upload_publish")),hide(geByClass1("video_upload_publish_later")),geByClass1("video_upload__tabs").innerHTML=`<div class="video_ocl_warn">${getLang("video_ocl_privacy")}</div>`),ownerId>0&&(cur.privacy["video"+tag]||(cur.privacy["video"+tag]=cur.privacy.video,cur.privacy["videocomm"+tag]=cur.privacy.video),Privacy.update("video"+tag),Privacy.update("videocomm"+tag),cur.tag2ElMap=cur.tag2ElMap||{},cur.tag2ElMap[tag]=o,cur.onPrivacyChanged=window.VideoUpload.onPrivacyChanged),VideoUpload.initPrivacyControls(ownerId,cur.privacy),curBox()&&curBox().hide(),hide("video_main_block"),hide("videocat_other_blocks"),show("video_upload_block"),cur.videoReupload&&(window.VideoUpload.deleteItem(cur.videoReupload,!1),delete cur.videoReupload),show(o);var r=ge("video_upload_item_"+a);if(e.fileName){var s,n=e.fileName,u=window.VideoUpload.FILE_TYPES.split(";");each(u,(function(e,o){if((s=n.indexOf(o.substr(1)))==n.length-o.length+1)return n=n.substr(0,s),!1}));var p=geByClass1("video_upload__title",r);val(p,n),p.select()}if(window.VideoUpload.videoUploadCallback&&(window.VideoUpload.videoUploadCallback(),delete window.VideoUpload.videoUploadCallback),cur.videoThumbUploadOpts&&isObject(cur.videoThumbUploadOpts)&&window.VideoUpload.initThumbUpload(cur.videoThumbUploadOpts,o),window.VideoUpload._uploadAlbumChooser=window.VideoUpload._uploadAlbumChooser||{},cur.videoPlaylists&&cur.videoPlaylists.length){window.VideoUpload._uploadAlbumChooser[a]=new Dropdown(geByClass1("video_upload_album_chooser_input",o),[[0,getLang("video_upload_choose_album_placeholder")]].concat(cur.videoPlaylists),{autocomplete:!0,big:!0,selectedItems:[options.aid||0],onChange:e=>{""===e&&window.VideoUpload._uploadAlbumChooser[a].val(0)}})}else re(geByClass1("video_upload__album_chooser_wrap",o));var v=geByClass1("page_block_header",d),c=geByClass1("flat_button",v);c.innerHTML=getLang("video_upload_another_one"),addClass(c,"secondary"),uploadOptions.vars.save_hashes||(window.VideoUploadSubtitles||(window.VideoUploadSubtitles={}),window.VideoUploadSubtitles[a]={elems:{blockEl:r},options:subtitleUploadOptions,ownerId},window.VideoUploadSubtitles.init(a),geByClass1("video_upload__tabs",r)&&window.VideoUpload.showTab(r,"privacy")),autosizeSetup(geByClass1("video_upload__description",r),{minHeight:80,maxHeight:600})};if(ge("video_upload_block"))i();else{var d=cur.privacy,t=cur.videoHashs,l=cur.videoThumbUploadOpts,_=cur.videoUploadThumbBtnTpl,r=cur.videoPlaylists,s=Object.assign({},window.Upload.options[a]);curBox().hide(),nav.go("videos"+ownerId,!1,{nocur:!0,params:{ocl:cur.ocl?1:0},onDone:function(){window.Upload.options[a]=s,window.Upload.vars[a]=uploadOptions.vars,setTimeout((function(){cur.lang=extend(cur.lang||{},uploadOptions.lang_ui),cur.privacy=extend(cur.privacy||{},d),cur.videoHashs=extend(cur.videoHashs||{},t),cur.videoThumbUploadOpts=l,cur.videoUploadThumbBtnTpl=_,cur.videoPlaylists=r,i()}))}})}},onUploadComplete:function onUploadComplete(i,res){var obj;if(res){try{obj=eval("("+res+")")}catch(e){obj=Object(_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__.fromQueryString)(res)}if(obj.code||obj.error)Upload.onUploadError(i,obj);else{var videoId=obj.video_id,viewHash=obj.video_hash,ind=void 0!==i.ind?i.ind:i,item=ge("video_upload_item_"+ind);domData(item,"owner_id",ownerId),domData(item,"view_hash",viewHash);var callback=function(){var e=ge("video_upload_item_"+ind);domData(e,"video_id",videoId),domData(e,"uploaded",1),window.VideoUploadSubtitles[ind]&&window.VideoUploadSubtitles.onVideoUploaded(ind,videoId),window.VideoUpload.setUploadStatus(getLang("video_upload_link_text"),e);var o=geByClass1("video_upload_link",e,"input");if(o){var a=domData(o,"href-tpl"),i=rs(a,{video_id:videoId});val(o,i),o.removeAttribute("placeholder");var d=geByClass("video_upload__subtitles_upload_item",e);d.length&&d.forEach(e=>{domData(e,"selected")&&!domData(e,"uploaded")&&window.VideoUploadSubtitles.startUpload(e,cur.oid,videoId)});var t=geByClass1("video_upload__copy_video_link",e);show(t),t.onclick=()=>{_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_10__.default.copy(i),showDoneBox(getLang("video_upload_link_copied"),{out:1500}),o.focus()};var l=geByClass1("video_upload_ready_name",e);if(l){var _=ce("a",{innerHTML:l.innerHTML,className:l.className,href:i.href});domPN(l).insertBefore(_,l),re(l)}}domData(e,"saved")&&window.VideoUpload.saveParams(geByClass1("video_upload__ready_button",e),!0),window.VideoUpload.setStatusHeader(getLang("video_upload_encode_waiting"),e),window.VideoUpload.setProgressValue(100,getLang("video_upload_waiting"),e),window.VideoUpload.runVideoProgressUpdate(e,ownerId,videoId,viewHash,1,-1,0)};item?callback():window.VideoUpload.videoUploadCallback=callback}}},onUploadProgress:function(e,o,a){var i=void 0!==e.ind?e.ind:e,d=intval(o/a*100),t=o/a*100,l=ge("video_upload_item_"+i);if(l){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.data)(l,"progress")>d&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.data)(l,"max_size_error",!0),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.data)(l,"progress",d);var _=getLang("video_upload_uploaded_percent").replace("{percent}",d);window.VideoUpload.setProgressValue(t,_,l)}},onUploadError:function onUploadError(i,err){var debug;if(err&&(err.code||err.error)){try{debug=eval("("+err.debug+")")}catch(e){debug=Object(_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__.fromQueryString)(debug)}err=err.code?err.code:err.error}else debug=!1;var logErrorData={oid:ownerId,mid:uploadOptions.vars.mid,tag,srv:options.server,extra:err};window.VideoUpload._logUploadStatus("fail",logErrorData),cur.videoLastError=!0;var ind=void 0!==i.ind?i.ind:i,item=ge("video_upload_item_"+ind),callback=function(){var e,o=ge("video_upload_item_"+ind);o&&(-3==err?e=getLang("video_upload_error_file"):-4==err?e=getLang("video_upload_error_audio").replace("{link}",'<a href="/audio">').replace("{/link}","</a>"):-5==err?(e=getLang("video_claimed_not_uploaded"),debug&&debug.claim_id&&(e+=" ["+debug.claim_id+"]")):e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.data)(o,"max_size_error")?getLang("video_upload_big_file_error"):-12==err?getLang("video_upload_flood_control"):getLang("video_upload_error_common"),window.VideoUpload.showError(o,e))};item?callback():window.VideoUpload.videoUploadCallback=callback,debugLog(err)},onConnectionLost:function(e){var o=void 0!==e.ind?e.ind:e,a=ge("video_upload_item_"+o);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.data)(a,"upload_index",o),window.VideoUpload.showError(a,getLang("video_upload_connection_lost"),!0)},onDragEnter:function(){},onDragOut:function(){},onDrop:function(){},clear:1,type:"video",max_attempts:3,server:options.server,error:options.error,error_hash:options.error_hash,dropbox:"video_dropbox",custom_hash:options.custom_hash,check_hash:options.check_hash,check_rhash:options.check_rhash,check_url:options.check_url,accept:browser.safari?"":"video/*,"+window.VideoUpload.UPLOAD_ACCEPT}))},intervalId,text,lang,current,errorEl;initButton()},_logUploadStatus:function(e,o){try{o.act="upload_stats",o.stage=e,ajax.post("al_video.php",o)}catch(e){}},removeUploadedThumb:function(e,o){cancelEvent(o);var a=domPN(e);setStyle(a,{backgroundImage:""}),hide(a);var i=gpeByClass("video_tc_uploader",e),d=geByClass1("video_tc_upload_btn",i),t=domData(i,"thumb-id"),l=gpeByClass("video_upload",e),_=window.VideoUpload.getPlaceholderEl(e),r=_?domData(_,"thumb-id"):0,s="";if(domData(i,"thumb-id",""),domData(i,"thumb-hash",""),domData(i,"thumb-url",""),show(d),!_||r==t){var n=geByClass("video_tc_item",l);if(n.length>1)return window.VideoUpload.selectThumb(n[1+(n.length-2)/2]),!1;r="",s=_&&domData(_,"main-thumb"),_&&(domData(_,"thumb-id",r),setStyle(_,{backgroundImage:s?"url("+s+")":""}))}return!1},initThumbUpload:function(e,o){if(e&&isObject(e)){var a=geByClass1("video_tc_uploader",o),i={file_name:"photo",file_size_limit:1024*(e.file_size_limit_in_MB||50)*1024,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF;*.bmp;*.BMP",onUploadStart:function(e,o){var i=geByClass1("video_tc_upload_btn",a);hide(i),show(d),setStyle(t,"width","0%")},onUploadComplete:function(e,o){if(hide(d),setStyle(t,"width","0%"),o){o=window.parseJSON(o);var i=geByClass1("video_tc_upload_image",a);show(i),setStyle(i,{backgroundImage:"url("+o.thumb.l+")"}),domData(a,"thumb-url",o.thumb.l),domData(a,"thumb-id",o.photo_id+"_"+o.photo_owner_id),domData(a,"thumb-hash",o.photo_hash),window.VideoUpload.selectThumb(a)}else topError("Thumb load error")},onUploadProgress:function(e,o,a){var i=intval(o/a*100);i=Math.min(i,100),setStyle(t,"width",i+"%")},onUploadError:function(e,o){hide(d),setStyle(t,"width","0%"),topError("Thumb load error")},clear:1,type:"photo",max_attempts:3,server:e.server,error:e.default_error,error_hash:e.error_hash,noCheck:!0,chooseBox:!0,label:e.specialLabel||cur.videoUploadThumbBtnTpl,uploadButton:!0,buttonClass:"video_tc_upload_btn",accept:".jpg,.jpeg,.png",filesize_hide_last:!0,lang:{filesize_error:getLang("video_upload_thumb_size_error")}};Upload.init(a,e.url,e.vars,i);var d=geByClass1("video_tc_upload_progress_wrap",o),t=geByClass1("video_tc_upload_progress_bar",o)}},selectThumb:function(e){var o=domData(e,"thumb-url"),a=domData(e,"thumb-id"),i=domData(e,"thumb-hash");if(a){var d=domPN(e);each(geByClass("video_tc_item",d),(function(){toggleClass(this,"video_tc_item_selected",this==e)}));var t=window.VideoUpload.getPlaceholderEl(e);if(t){domData(t,"thumb-id",a),domData(t,"thumb-hash",i||""),domData(t,"thumb-url",o),setStyle(t,{backgroundImage:"url("+o+")"});var l=gpeByClass("video_upload",e);val(geByClass1("video_upload__player",l))&&VideoUpload.updatePlayerThumb(l)}}},getPlaceholderEl:function(e){var o=hasClass(e,"video_upload")?e:gpeByClass("video_upload",e);return gpeByClass("video_edit",o)?null:geByClass1("video_upload__thumb",o)},initTC:function(e,o,a){var i=geByClass1("video_upload__thumb_chooser_info",a);if(o)val(i.innerHTML,o);else{re(i),e=se(e),geByClass1("video_upload__thumb_chooser_wrap",a).appendChild(e);var d=geByClass1("video_tc_uploader",a);if(d){var t=geByClass1("video_tc_slider_cont",a);domInsertBefore(d,domFC(t))}var l=window.VideoUpload.getPlaceholderEl(e),_=geByClass("video_tc_item",e);if(l&&!domData(l,"thumb-id")&&_.length>1){var r=geByClass1("video_tc_uploader",e)?1:0;window.VideoUpload.selectThumb(_[Math.floor(r+(_.length-1-r)/2)])}}},runVideoProgressUpdate:function(e,o,a,i,d,t,l,_){ajax.post("al_video.php?act=encode_progress",{oid:o,vid:a,hash:i,need_thumb:d,need_tc:t},{onDone:function(r){if(domPN(e)){var s=!0,n=-1;if(r){if(r.error)return void window.VideoUpload.showError(e,getLang("video_upload_encode_error"));if(d&&r.thumb){var u=window.VideoUpload.getPlaceholderEl(e);domData(u,"main-thumb",r.thumb),domData(u,"thumb-id")||setStyle(u,{backgroundImage:"url('"+r.thumb+"')"}),d=""}t&&(r.tc||r.tc_msg)&&(window.VideoUpload.initTC(r.tc,r.tc_msg,e),t=0);var p=r.duration;if(n=r.percents,void 0!==p){if(domData(e,"duration",p),n>=100){if(l<100){if(VideoUpload.updatePlayer(e),r.published)window.VideoUpload.setPublished(e);else{var v=geByClass1("video_upload__progress",e);addClass(v,"_success");var c=geByClass1("video_upload__progress_text",v);val(c,domData(c,"lang-success")),window.VideoUpload.setStatusHeader(getLang("video_upload_completed_title"),e)}if(d||t){var g=d?2:0;g+=t?1:0,window.VideoUpload._logUploadStatus("no_thumb",{status:g,vid:o+"_"+a})}}}else{var h=getLang("video_upload_encode_percent").replace("{percent}",intval(n));window.VideoUpload.setStatusHeader(getLang("video_upload_encoding"),e),window.VideoUpload.setProgressValue(n,h,e,!0)}n>=100&&!d&&!t&&(s=!1)}else n=-1}s&&setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(e,o,a,i,d,t,n,_),1e3)}},onFail:function(){_||(_=1),setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(e,o,a,i,d,t,l,_+1),2e3*_)}})},updatePlayer:function(e){if(!gpeByClass("video_edit",e)){var o=domData(e,"owner_id"),a=domData(e,"video_id");if(o&&a){var i=domData(e,"duration"),d=geByClass1("video_upload__player",e);domData(d,"video",`${o}_${a}`),attr(d,"href",`/video${o}_${a}`),attr(d,"onclick","return VideoUpload.onThumbClick(this, event);"),show(d),i&&val(geByClass1("video_thumb_label_item",d),formatTime(i)),VideoUpload.updatePlayerThumb(e)}}},updatePlayerThumb:function(e){var o=window.VideoUpload.getPlaceholderEl(e),a=domData(o,"thumb-url");revertLastInlineVideo();var i=geByClass1("video_upload__player",e);setStyle(i,{backgroundImage:"url("+a+")"})},showError:function(e,o,a){var i=geByClass1("video_upload__progress",e),d=geByClass1("video_upload__progress_text",i);domData(e,"error",1),addClass(i,"_error"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(geByClass1("video_upload__ready_button",e),!0),val(d,o)},setPublished:function(e){domData(e,"published",1),window.VideoUpload.setStatusHeader(getLang("video_upload_published_title"),e),window.VideoUpload.setUploadStatus(getLang("video_upload_ready_link_text"),e);var o=geByClass1("video_upload__progress_wrap",e);isVisible(o)&&slideUp(o,{duration:150,transition:Fx.Transitions.swiftOut});var a=geByClass1("video_upload_publish",e);hasClass(a,"disabled")||window.disable(a);var i=geByClass1("video_upload_publish_later",e);i&&window.disable(i)},setProgressValue:function(e,o,a,i){if(a){var d=geByClass1("video_upload__progress_bar",a),t=geByClass1("video_upload__progress_text",a);toggleClass(geByClass1("video_upload__progress",a),"video_upload__progress_processing",!!i),setStyle(d,{width:e+"%"}),val(t,o)}},saveParams:function(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=window.VideoUpload.getUploadItem(e);if(domData(a,"saved"))VideoUpload.deleteParams(e,o);else{var i=window.VideoUpload.getParams(a),d=a.id.substr("video_upload_item_".length),t=Upload.vars[d];if(!i.title||i.title.length>cur.videoTitleLength)return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)(geByClass1("video_upload__title",a));if(i.desc.length>cur.videoDescriptionLength)return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)(geByClass1("video_upload__description",a));Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(e,!0),i.vid=domData(a,"video_id"),i.oid=t.oid,i.tag=t.tag,i.hash=cur.videoHashs[t.tag],nav.objLoc.ocl&&(i.ocl=1),ajax.post("al_video.php?act=save_video_params",i,{onDone:function(i){if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(e,!1),addClass(e,"secondary"),val(e,getLang("video_upload_back_to_editing")),geByClass1("video_upload__title",a).setAttribute("readonly","readonly"),domData(a,"saved",1),"published"===i&&window.VideoUpload.setPublished(a),!o){["video_upload__tabs","video_upload__thumb_chooser_wrap","video_upload__secondary_info"].forEach(e=>{var o=geByClass1(e,a);slideUp(o,{duration:150,transition:Fx.Transitions.swiftOut})})}}})}},deleteParams:function(e,o){var a=window.VideoUpload.getUploadItem(e),i=function(){domData(a,"saved",null),removeClass(e,"secondary"),geByClass1("video_upload__title",a).removeAttribute("readonly"),val(e,getLang("video_upload_end_editing"));["video_upload__tabs","video_upload__thumb_chooser_wrap","video_upload__secondary_info"].forEach(e=>{var o=geByClass1(e,a);slideDown(o,{duration:150,transition:Fx.Transitions.swiftOut})})};if(domData(a,"published"))i();else{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(e,!0);var d=a.id.substr("video_upload_item_".length),t=Upload.vars[d],l=window.VideoUpload.getParams(a);l.vid=domData(a,"video_id"),l.oid=t.oid,l.tag=t.tag,ajax.post("al_video.php?act=delete_video_params",l,{onDone:function(a){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(e,!1),o||i()},onError:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(e,!1)}})}},getParams:function(e){var o=e.id.substr("video_upload_item_".length),a=Upload.vars[o],i=a.tag,d=geByClass1("video_upload_publish",e),t=geByClass1("video_upload_publish_later",e),l=geByClass1("video_upload_no_comments",e),_=geByClass1("video_upload_monetized",e),r=geByClass1("video_upload__title",e),s=geByClass1("video_upload__description",e),n=geByClass1("video_edit_repeat",e),u=0;window.VideoUpload._uploadAlbumChooser[o]&&(u=window.VideoUpload._uploadAlbumChooser[o].selectedItems()[0]);var p=window.VideoUpload.getPlaceholderEl(e),v=domData(p,"thumb-id"),c=domData(p,"thumb-hash"),g={status_export:isChecked(d),publish_later:isChecked(t),no_comments:isChecked(l),monetized:isChecked(_),title:val(r),desc:val(s),repeat:isChecked(n),album_id:u?u[0]:"",thumb_id:v,thumb_hash:c};if(a.oid>0)g.privacy_video=Privacy.getValue("video"+i),g.privacy_videocomm=Privacy.getValue("videocomm"+i);else{var h={};each(cur.privacy,e=>{h[e]=val(ge(cur.privacy[e].key+"_input"))}),g.privacy=JSON.stringify(h)}return g},setStatusHeader:function(e,o){if(o){var a=geByClass1("video_upload_item_header",o);val(a,e)}},setUploadStatus:function(e,o){var a=geByClass1("video_upload_link_header",o);val(a,e)},showReupload:function(e){var o=window.VideoUpload.getUploadItem(e),a=window.VideoUpload.getParams(o);a.reupload=1,window.VideoUpload.showBox(a),cur.videoReupload=o},resumeUpload:function(e){var o=window.VideoUpload.getUploadItem(e);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.disableButton)(geByClass1("video_upload__ready_button",o),!1),domData(o,"error",null);var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.data)(o,"upload_index");Upload.resumeUpload(a)},getUploadItem:function(e){return gpeByClass("video_upload",e)},noPublish:function(e){var o=window.VideoUpload.getUploadItem(e),a=geByClass1("video_upload_publish",o);isChecked(e)?(checkbox(a,0),window.disable(a,1)):window.disable(a,0)},stopUpload:function(e){var o=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)({width:430,title:getLang("video_upload_stop_title"),dark:1,bodyStyle:"padding: 20px;"},getLang("video_upload_stop_text"),getLang("video_upload_stop_button"),(function(){o.hide(),Upload.terminateUpload(e);var a=ge("video_upload_item_"+e),i=domData(a,"video_id");if(i){var d=Upload.vars[e];ajax.post("al_video.php",{act:"delete_video",vid:i,oid:d.oid,sure:1})}window.VideoUpload.deleteItem(ge("video_upload_item_"+e),!0)}))},deleteItem:function(e,o){var a=gpeByClass("page_block",e),i=geByClass1("page_block_header",a),d=geByClass("ui_crumb",i),t=geByClass("video_upload").map(e=>gpeByClass("page_block",e));if(1===t.length)re(e),a.insertAdjacentHTML("beforeend",`<div id="video_upload_no_video">${getLang("video_no_video_upload_title")}</div>`),val(d[d.length-1],getLang("video_adding_video_title"));else if(a===t[0]){var l=t[1],_=geByClass1("page_block_header",l),r=val(geByClass1("_header_inner",l));val(d[d.length-1],r),domReplaceEl(_,i),re(a)}else o?slideUp(a,{duration:150,transition:Fx.Transitions.swiftOut,onComplete:function(){re(a)}}):re(a),cleanElems(a)},initBeforeUnload:function(){cur.nav.push((function(e,o,a,i){if(!1===window.VideoUpload.checkChanges(1))return cur.onContinueCb=nav.go.pbind(a),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=window.VideoUpload.checkChanges,cur.destroy.push((function(){window.onbeforeunload=cur.prevBefUnload,window.VideoUpload.destroyTab()}))},checkChanges:function(e){if(!cur.leaving){var o=ge("video_upload_block");if(!o)return!1;for(var a="",i="",d=geByClass("video_upload",o),t=d.length,l=0,_=0,r=0;r<d.length;r++){var s=d[r];domData(s,"error")?t--:(domData(s,"uploaded")&&l++,domData(s,"saved")&&_++)}if(l!==t)a=getLang("video_upload_changed");else if(_!==t){i=getLang("video_upload_leaving_without_saving",t-_)}if(1===e){if(!a&&!i)return!0;var n=e=>{cur.leaving=!0,e.hide(),cur.onContinueCb&&cur.onContinueCb()};if(a)var u=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)({title:getLang("global_warning"),dark:!0},a,getLang("global_continue"),()=>{n(u)},getLang("global_cancel"),()=>{u.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)});else if(i){var p=new MessageBox({title:getLang("global_warning"),containerClass:"video_upload__leave_editing_box"});p.content(i),p.addButton(getLang("global_save"),()=>{p.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc);for(var e=geByClass("video_upload__ready_button"),o=0;o<e.length;o++){var a=e[o];window.VideoUpload.saveParams(a)}}),p.addButton(getLang("video_upload_publish_later"),()=>{n(p)},"no",!1,"video_upload__publish_later_btn"),p.addButton(getLang("video_upload_remove_video"),()=>{d.forEach(e=>{if(!domData(e,"saved")){var o=e.id.substr("video_upload_item_".length),a=Upload.vars[o],i=domData(e,"owner_id"),d=domData(e,"video_id"),t=cur.videoHashs[a.tag];ajax.post("/al_video.php",{act:"a_delete_video",oid:i,vid:d,from:cur.oid,pl_id:-2,hash:t},{onDone:()=>{domQuery(`[data-id="${i}_${d}"]`).forEach(e=>{re(e)})}})}}),n(p)},"no",!1,"video_upload__remove_video_btn"),p.show()}return!1}var v=a||i;return v?winToUtf(v.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}},toUploadVideo:function(){var e=cur.uploadVideoBox;window.VideoUpload.checkResize(),show("video_upload_box_tab"),hide("video_add_from_youtube_tab"),window.VideoUpload.onShowUploadPanel(),e.removeButtons(),e.setOptions({hideButtons:1,title:getLang("video_header_new")}),e.addButton(getLang("global_cancel"),e.hide,"no")},toExternalAdd:function(e){var o=cur.uploadVideoBox,a="video"===e?this.toUploadVideo:o.hide;o.setBackTitle(a),window.VideoUpload.onHideUploadPanel(),hide("video_upload_box_tab"),show("video_add_from_youtube_tab"),o.removeButtons(),isVisible("video_extra_settings")||isVisible("video_share_not_allowed")||isVisible("video_share_error")?(o.setOptions({hideButtons:0}),o.addButton(getLang("global_save"),cur.saveExternalVideo)):o.setOptions({hideButtons:1}),o.addButton(getLang("global_cancel"),o.hide,"no"),ge("video_external_link").focus()},toGroupVideoSelect:function(e){var o=curBox();showBox("al_video.php?act=a_choose_video_box",{from:"video",without_upload:!0},{dark:1,onDone:function(e){var o='<div class="back" onclick="curBox().hide();">'+getLang("video_upload_back")+"</div>";e.setOptions({title:o,defaultTitle:o})}}),cur.chooseVideoAdd=function(a,i,d){for(var t=new CallHub((function(){"video"!=cur.module?nav.go("/videos-"+e,!1,{onDone:function(){cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(nav.objLoc[0])}}):(nav.reload(),boxQueue.hideAll(),o.destroy())}),a.length),l=0,_=a.length;l<_;l++){var r=a[l],s=ge("video_item_"+r),n=domData(s,"add-hash");r=r.split("_");var u=window.Video&&Video.isInAlbum()?Video._getSectionAlbumId():-2;ajax.post("al_video.php",{act:"a_add_to_playlist",oid:r[0],vid:r[1],hash:n,gid:e,add:1,playlist_id:u,list_owner_id:cur.getOwnerId()},{onDone:function(){d&&d(),t.done()},onFail:function(){t.done()}})}return!1}},lockSaveButton:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(curBox().btns.ok[0])},unlockSaveButton:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(curBox().btns.ok[0])},initShare:function(e,o,a){var i,d,t=cur.uploadVideoBox,l=ge("video_external_link");window.placeholderSetup(l,{back:!0});var _,r=function(){var e=trim(l.value);e&&d!=e&&(t.showProgress(),d=e,ge("video_share_form").submit())};function s(e){i&&clearTimeout(i),e.keyCode==KEY.ENTER?r():i=setTimeout(r,1e3)}window.onParseDone=function(e){if(hide("video_share_server_error"),hide("video_share_error"),e.images_proxy){var o=ge("video_share_form").action.replace(/\/[^\/]*$/,"")+"/upload.php?act=proxy_img&";each(e.images_proxy,(function(a,i){e.images_proxy[a]=o+i}))}else e.images_proxy=e.images;if(e.extra>0&&e.extraData&&e.images[0]){if(hide("video_share_descr"),hide("video_share_error"),hide("video_share_not_allowed"),hide("video_share_error"),t.hideProgress(),ge("video_share_photo_url").value=e.url,ge("video_share_photo_image").value=e.images[0],ge("video_share_photo_extra").value=e.extra,cur.changeExternalImage=function(o){cur.externalVideoImage++,e.images[cur.externalVideoImage]?o.src=e.images_proxy[cur.externalVideoImage]:(cur.externalVideoImage=0,o.src=e.images_proxy[0])},e.images[0]){cur.externalVideoImage=0;var i=ge("video_external_image");if(setStyle(i,{backgroundImage:"url('"+e.images_proxy[0]+"')"}),i.setAttribute("onclick","cur.changeExternalImage(this)"),e.images.length>1){var d=vkImage();d.src=e.images_proxy[0],d.onload=function(){d.width<130&&cur.changeExternalImage(ge("video_external_img"))}}(r=vkImage()).onerror=function(){var o=!1;each(e.images_proxy,(function(e,a){if(0!=e){var d=vkImage();d.onload=function(){o||(o=!0,ge("video_share_photo_image").value=a,cur.externalVideoImage=e,setStyle(i,{backgroundImage:"url('"+a+"')"}))},d.src=a}}))},r.src=e.images_proxy[0]}ge("video_external_title").value=replaceEntities(e.title),ge("video_external_description").value=replaceEntities(e.description),show("video_extra_settings"),cur.videoPlaylists.length?cur._addExternalAlbumDD=new Dropdown(geByClass1("video_external_upload_album_chooser_input",curBox().bodyNode),[[0,getLang("video_upload_choose_album_placeholder")]].concat(cur.videoPlaylists),{autocomplete:!0,selectedItems:[0],big:!0}):re(geByClass1("video_upload__album_chooser_wrap"));var l=getLang("global_save");"video"!==a&&(l=getLang("global_add"),hide("video_external_status_export"),hide(geByClass1("video_upload__album_chooser_wrap")),hide(domByClass(t.bodyNode,"video_upload_privacy_wrap"))),_=e,t.removeButtons(),t.addButton(getLang("global_cancel"),t.hide,"no"),cur.saveExternalVideo=function(){e&&e.images&&(window.VideoUpload.lockSaveButton(),cur.shareExternalImageSave=e.images[cur.externalVideoImage],ge("video_share_photo_image").value=cur.shareExternalImageSave,ge("video_share_photo_form").submit())},t.setOptions({hideButtons:0}),t.addButton(l,cur.saveExternalVideo)}else-1==e.extra?(show("video_share_not_allowed"),window.VideoUpload.unlockSaveButton()):(show("video_share_error"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)("video_external_link"),window.VideoUpload.unlockSaveButton());var r},window.onParseFail=function(){hide("video_share_server_error"),window.VideoUpload.unlockSaveButton(),show("video_share_error"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)("video_external_link")},window.onUploadDone=function(i,d){if(d.photo_id&&d.user_id&&_){var l=_.title;_.title=ge("video_external_title").value;var r=ge("video_external_description").value,s=0;if(cur.vSection){var n=cur.vSection.split("_");"album"===n[0]&&(s=n[1])}var u=extend(_,{oid:e,folder_id:s,act:"save_external",from:a,hash:o,share_title:l||ge("video_external_title").value,share_text:r,image_url:cur.shareExternalImageSave,photo_owner_id:d.user_id,photo_id:d.photo_id,extra:_.extra,extra_data:_.extraData,to_video:"video"===a?1:0,album_id:cur._addExternalAlbumDD?cur._addExternalAlbumDD.selectedItems()[0][0]:"",no_comments:isChecked("video_external_no_comments")?1:0,to_status:isChecked("video_external_status_export")?1:0});u.openGraph&&delete u.openGraph,delete _.extraData,u.oid>0&&(u.privacy_video=Privacy.getValue("video_external"),u.privacy_videocomm=Privacy.getValue("videocomm_external")),delete u.images,delete u.images_proxy,setTimeout((function(){ajax.post("/al_video.php",u,{onDone:function(e){if(hide("share_error"),e.owner_id&&e.video_id)if("video"===a)t.hide(),nav.reload();else{boxQueue.hideAll();var o=e.owner_id+"_"+e.video_id;Video.attachVideos([o])}else window.VideoUpload.unlockSaveButton(),show("video_share_server_error")},onFail:function(e){window.VideoUpload.unlockSaveButton(),hide("video_share_error"),ge("video_share_server_error").innerHTML=e,show("video_share_server_error")}})}),0)}else t.showProgress(),show("video_share_error")},window.onUploadFail=function(){t.hideProgress(),hide("video_share_error"),show("video_share_server_error")},addEvent(l,"paste blur",r),addEvent(l,"keydown input",s),cur.destroy.push((function(){removeEvent(l,"paste blur",r),removeEvent(l,"keydown input",s)}))},createLiveStream:function(){showBox("al_video.php",{act:"a_add_new_live_trans_form",owner_id:cur.oid},{stat:["video_edit.css","privacy.css",jsc("web/privacy.js"),jsc("web/upload.js")],onDone:function(e){if(e.removeButtons(),e.addButton(getLang("video_save_but"),window.VideoUpload.saveLiveStream),e.addButton(getLang("video_cancel_but"),e.hide,"no"),ls.get("video_live_create_form_shown")){var o=domByClass(e.bodyNode,"video_upload_live_launch_steps_wrap");hide(o);var a=domByClass(e.bodyNode,"video_upload_live_launch_subheader");removeClass(a,"_open")}else ls.set("video_live_create_form_shown",1)},onFail:function(e){if(e)return curBox().hide(),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e),!0}})},initLiveStreamCategoryDropdown:function(e,o){var a=ge("video_upload_live_category"),i=ge("video_upload_live_game_category"),d=domPN(a).offsetWidth;toggle("video_upload_live_game_category_wrap",3==val(a));var t=new Dropdown(a,e,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:d,onChange:function(e){toggle("video_upload_live_game_category_wrap",3==e)}}),l=new Dropdown(i,o,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:d,onChange:function(){}});cur.destroy.push((function(){t.destroy(),l.destroy()}))},getLiveStreamCategoryVal:function(){var e=ge("video_upload_live_category"),o=ge("video_upload_live_game_category");if(!e)return 0;var a=+val(e);if(3==a){var i=+val(o);a=i>0?i:a}return a},toggleLiveLaunchSteps:function(e){toggleClass(e,"_open");var o=domByClass(curBox().bodyNode,"video_upload_live_launch_steps_wrap");window.slideToggle(o,200)},updateLiveTransSettings:function(e,o,a,i){ajax.post("al_video.php",{act:"generate_live_trans_keys",rhash:i,hash:a,owner_id:cur.oid,need_new:e?1:0},{onDone:function(e){val("video_live_trans_settings_url",e.url),val("video_live_trans_settings_key",e.key),o&&o()}})},updatedLiveKeyMsg:function(){Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("video_live_trans_key_updated"),getLang("video_live_trans_key_updated_msg"))},saveLiveStream:function(){var e=curBox(),o=geByClass1("video_tc_item_selected",e.bodyNode),a=null,i=null;o&&(a=domData(o,"thumb-id"),i=domData(o,"thumb-hash"));var d=trim(val("video_new_live_trans_title")),t=trim(val("video_new_live_trans_description")),l=window.VideoUpload.getLiveStreamCategoryVal(),_={owner_id:cur.oid,thumb_id:a,thumb_hash:i,title:d,description:t,category:l,publish:isChecked("video_create_live_publish_on_wall"),preparation_check:isChecked("video_create_live_preparation_check"),notify_followers:isChecked("video_create_live_notify_followers"),enable_donations:isChecked("video_create_enable_donations"),forbid_rewind:isChecked("video_create_forbid_rewind"),rhash:cur.newLiveHash,random_tag:cur.newLiveRandomTag};return cur.oid<0?_.no_comments=isChecked("video_create_live_no_comments"):(_.privacy_view=Privacy.getValue("video_live_view"),_.privacy_comment=Privacy.getValue("video_live_comment")),!_.title||_.title.length>cur.videoTitleLength?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)("video_new_live_trans_title"):_.description.length>cur.videoDescriptionLength?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)("video_new_live_trans_description"):_.category?(window.VideoUpload.lockSaveButton(),void ajax.post("al_video.php?act=a_add_new_live_trans",_,{onFail:function(e){return window.VideoUpload.unlockSaveButton(),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("video_create_live_error"),e||getLang("video_create_live_error_try_later")),!0}})):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)(domClosest("dropdown_container","video_upload_live_category"))},showTab(e,o){var a=hasClass(e,"video_upload")?e:gpeByClass("video_upload",e);geByClass("video_upload__tab",a).forEach(e=>{hide(e)}),show(geByClass1("video_upload__"+o,a)),uiTabs.switchTab(domByClass(geByClass1("video_upload__tab_"+o,a),"ui_tab"))},initEdit(e,o,a,i,d){cur.privacy=e;var t=VideoUpload.options[0],l=geByClass1("video_upload");if(autosizeSetup(geByClass1("video_upload__description",l),{minHeight:80,maxHeight:250}),re(geByClass1("video_upload__link-block",l)),geByClass1("video_upload__tabs",l)&&(window.VideoUploadSubtitles[0].elems.blockEl=l,window.VideoUploadSubtitles.init(0),hide(geByClass("video_upload__tab",l)),window.VideoUpload.showTab(l,"privacy")),o&&d){if(cur.videoUploadThumbBtnTpl=i,VideoUpload.initThumbUpload(a,l),VideoUpload.initTC(o,"",l,!0),d.uploaded_id){var _=geByClass1("video_tc_upload_image",l);setStyle(_,{backgroundImage:"url("+d.uploaded_url+")"}),show(_);var r=geByClass1("video_tc_uploader",l);r&&(domData(r,"thumb-id",d.uploaded_id),domData(r,"thumb-hash",d.uploaded_hash))}var s=geByClass("video_tc_item",l);each(s,(function(e){if(domData(this,"thumb-id")==d.selected)return addClass(this,"video_tc_item_selected"),e>3&&Video.tcSlide(null,this,-Math.min(e-1,s.length-4),!0),!1}))}VideoUpload.initPrivacyControls(t.ownerId,e),curBox().setOptions({width:495}),curBox().removeButtons(),curBox().addButton(t.saveButtonTitle,VideoUpload.editSaveVideo)},initPrivacyControls(e,o){e>0||each(o,e=>{var a=o[e];new InlineDropdown(ge(a.key),{items:a.items,selected:a.selected})})},editSaveVideo(e){var o,a=gpeByClass("video_upload",e),i=VideoUpload.options[0],d=0;each(geByClass("video_tc_item",curBox().bodyNode),(function(){if(hasClass(this,"video_tc_item_selected"))return d=domData(this,"thumb-id"),o=domData(this,"thumb-hash"),!1}));var t=Videoview.getPlayerObject(),l=cur.mvMoveToAlbum?cur.mvMoveToAlbum.val():"",_={act:i.isPublish?"save_video_params":"do_edit_box",title:val(geByClass1("video_upload__title",a)),desc:val(geByClass1("video_upload__description",a)),vid:i.videoId,oid:i.ownerId,hash:i.hash,album_id:l,thumb_id:d,thumb_hash:o};if(i.isPublish&&(_.status_export=isChecked("video_edit_publish")),-1==l&&(_.album_title=val("mv_create_album"),!_.album_title))return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)("mv_create_album");if(_.oid>0)_.privacy_video=Privacy.getValue("video"+i.videoId),_.privacy_videocomm=Privacy.getValue("videocomm"+i.videoId);else{_.no_comments=isChecked(geByClass1("video_upload_no_comments",a));var r={};each(cur.privacy,e=>{r[e]=val(ge(cur.privacy[e].key+"_input"))}),_.privacy=JSON.stringify(r)}if(ge("video_edit_repeat")&&(_.repeat=isChecked("video_edit_repeat"),t&&t.toggleLoop(_.repeat)),!_.title||_.title.length>cur.videoTitleLength)return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)(geByClass1("video_upload__title",a));if(_.desc.length>cur.videoDescriptionLength)return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)(geByClass1("video_upload__description",a));if(ge("video_upload_live_category")&&(_.live_category=VideoUpload.getLiveStreamCategoryVal(),!_.live_category))return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.notaBene)(domClosest("dropdown_container","video_upload_live_category"));if(ge("video_edit_live_preparation")&&(_.live_preparation=isChecked("video_edit_live_preparation")?1:0),ge("video_edit_live_donations")&&(_.live_donations=isChecked("video_edit_live_donations")?1:0),i.isExternal||i.isLive||!window.VideoUploadSubtitles[0]||window.VideoUploadSubtitles[0].tracksSaved)if(ajax.post("al_video.php?act="+_.act,_,{onDone:function(e,o,a,i){if(curBox().hide(),window.Videoview&&a&&Videoview.updateVideo(_.oid,_.vid,e,o,i),cur.videoEditItem&&a){var d=Video.buildVideoEl(a);domPN(cur.videoEditItem).replaceChild(d,cur.videoEditItem),cur.videoEditItem=!1,Video._reinitSorters()}Video._updateThumbsInView()},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(e)}),ge("mv_edit_album")){var s=[];s&&(cur.mvMoveToAlbum=new Dropdown(ge("mv_edit_album"),s,{width:250,selectedItems:[],autocomplete:s.length>7,big:1,onChange:function(e){-1==e?slideDown("mv_edit_create_album",200,(function(){window.placeholderSetup("mv_create_album",{back:!0}),ge("mv_create_album").focus()})):slideUp("mv_edit_create_album",200)}}))}else cur.mvMoveToAlbum=!1;else window.VideoUploadSubtitles.saveEditedTracks(0,VideoUpload.editSaveVideo)}};__webpack_exports__.default=VideoUpload},LSJr:function(e,o,a){"use strict";a.r(o);var i=a("Bwan"),d=(a("rGqo"),a("VRzm"),a("Btvt"),a("pIFo"),a("v+DW")),t=a("EasH"),l={init(e){var o=l[e];o.elems.tracksLangDropdown={},o.isEditing&&(o.subtitlesListAdd=[]);var a=!!o.options&&o.subtitlesList;if(isObject(a)&&!isEmpty(a)){for(var i in a)if(a.hasOwnProperty(i)){var d=a[i];d.key=i,this.initTrack(e,d)}}else this.initTrack(e);this.initDefaultDropdown(e)},initTrack(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=l[e].elems.blockEl,i=geByClass1("video_upload__add_subtitles_track",a);this.initNewTrackEl(i,o)},initNewTrackEl(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=gpeByClass("video_upload",e),i=geByClass1("video_upload__upload_subtitles_left",a),d=geByClass1("video_upload__subtitles_upload_item",i).cloneNode(!0),t=a.id.substr("video_upload_item_".length);domInsertBefore(d,e);var _=0;geByClass("video_upload__subtitles_upload_item",a).forEach(e=>{isVisible(e)&&(_++,geByClass1("video_upload__subtitles_upload_label",e).innerHTML=getLang("video_upload_upload_subtitle_label").replace("{index}",_))}),_>=l[t].options.max_tracks_num&&hide(e),this.initLangDropdown(t,d,o);var r=geByClass1("video_upload__subtitles_track_name",d),s=geByClass1("video_upload__subtitles_upload_btn",d),n=geByClass1("video_upload__subtitles_remove_file",d);if(o){var u=o.hasOwnProperty("params")?o.params.full_name:o.name;this.decorateLangName(r,u),s.removeAttribute("disabled"),hide(s),domData(d,"track-id",o.key)}else hide(n),hide(r)},initDefaultDropdown(e){var o,a=l[e],i=a.elems.blockEl,t=domByClass(i,"video_upload__upload_subtitles"),_=a.subtitlesDefault;o=0==_||-1==_?-1==_&&isObject(a.subtitlesList)?-1:-2:null!=_?a.subtitlesList[_].lang_id:-2;var r=this.getActualDefaultDropdownOptions(e);a.elems.defaultLangDropdown=new Dropdown(t.elements.subtitle_default,r,{big:!0,selectedItems:o,onChange:()=>{this.updateDefaultLang(i)}});var s=a.elems.defaultLangDropdown.container;r.length>1?(Object(d.enableEl)(s),removeClass(s,"disabled")):(Object(d.disableEl)(s),addClass(s,"disabled"))},decorateLangName(e,o){o&&o.length>30&&(o=o.slice(0,27)+"…"+o.slice(-4)),val(e,o)},getCurrentAvailableLangs(e){var o=l[e],a=o.elems.blockEl,i=[];geByClass("video_upload__subtitles_upload_item",a).forEach(e=>{if(isVisible(e)){var o=val(domQuery1('input[name="subtitle_lang"]',e));o&&i.push(o)}});var d=[];return each(o.options.langs,(e,o)=>{inArray(e,i)||d.push([e,o])}),d},getActualDefaultDropdownOptions(e){var o=l[e],a=o.elems.blockEl,i=geByClass("video_upload__subtitles_upload_item",a),d=[],t=[];return d.push([-2,getLang("video_upload_subtitles_default_off")]),i.forEach(e=>{if(isVisible(e)){var a=val(domQuery1('input[name="subtitle_lang"]',e)),i=domByClass(e,"video_upload__subtitles_track_name");isVisible(i)&&t.push([a,o.options.langs[a]])}}),t.length&&(d.push([-1,getLang("video_upload_subtitles_default_user_lang")]),d.push(...t)),d},getActualSelectedLangIds(e){return this.getActualDefaultDropdownOptions(e).map(e=>e[0])},initLangDropdown(e,o,a){var i=domQuery1('input[name="subtitle_lang"]',o),d=domByClass(o,"video_upload__subtitles_track_loading");hide(d);var t=new Dropdown(i,this.getCurrentAvailableLangs(e),{autocomplete:!0,big:!0,placeholder:domData(i,"placeholder"),selectedItems:a?a.lang_id:"",onChange:o=>{var a=domData(t.container,"last-saved");if(a&&""===o)t.val(a);else if(""!==o){domData(t.container,"last-saved",o);var i=gpeByClass("video_upload__subtitles_upload_item",t.container);_.removeAttribute("disabled"),this.updateAllLangDropdowns(e),o||attr(_,"disabled","disabled"),this.onUpdateLang(i)}}}),_=geByClass1("video_upload__subtitles_upload_btn",o);this.initUploadButton(e,_),l[e].elems.tracksLangDropdown[t.guid]=t},initUploadButton(e,o){var a=l[e],i=a.elems.blockEl,_=gpeByClass("video_upload__subtitles_upload_item",o),r=domByClass(_,"selector_container"),s=domByClass(_,"video_upload__upload_subtitles_input_container"),n=domByClass(_,"video_upload__subtitles_track_loading"),u=domByClass(_,"video_upload__subtitles_track_name"),p=domByClass(_,"video_upload__subtitles_remove_file"),v=a.options;o.onclick=()=>{domFC(s).click()};var c=null;Upload.init(s,"",{},{accept:".srt",chooseBox:!0,clear:!0,file_name:"file",file_size_limit:v.file_size_limit,file_types:"*.srt",lang:{filesize_error:getLang("video_upload_subtitles_size_error")},max_attempts:3,noCheck:!0,noFlash:!0,requestOptionsForFile:!0,type:"subtitles",withoutAutoUpload:!0,onFilesSelected:(i,t)=>{if(t.length){if(c=t[0],domData(_,"upload-index",i),hide(o),a.isEditing)return show(u),show(p),this.decorateLangName(u,c.name),this.updateDefaultLangDropdown(e),void a.subtitlesListAdd.push(_);show(n),Object(d.disableEl)(r),addClass(r,"disabled"),l.uploadTrack(_)}},onNoFilteredCallback:()=>{Object(d.notaBene)(r),Object(t.showFastBox)(getLang("global_error"),getLang("video_upload_subtitles_format_error"))},onUploadStart:(e,o)=>{hide(u),hide(p),show(n),Object(d.disableEl)(r),addClass(r,"disabled")},onUploadComplete:(a,t)=>{hide(n),show(u),Object(d.enableEl)(r),removeClass(r,"disabled"),this.decorateLangName(u,c.name),this.updateDefaultLangDropdown(e),hide(o),show(p);var l=window.parseJSON(t);each(l,(e,o)=>{geByClass("video_upload__subtitles_upload_item",i).forEach(a=>{isVisible(a)&&(+val(domQuery1('input[name="subtitle_lang"]',a))==+o.lang_id&&domData(a,"track-id",e))})}),this.updateDefaultLang(i),VideoUpload.updatePlayer(i)},onUploadError:(e,a)=>{hide(n),show(o),Object(d.enableEl)(r),removeClass(r,"disabled")}})},removeTrack(e){var o=gpeByClass("video_upload",e),a=gpeByClass("video_upload__subtitles_upload_item",e),i=geByClass1("video_upload__add_subtitles_track",o),d=geByClass1("video_upload__subtitles_remove_file",a),t=o.id.substr("video_upload_item_".length);this.removeTrackFile(d),hide(a);var _=0;geByClass("video_upload__subtitles_upload_item",o).forEach(e=>{isVisible(e)&&(_++,geByClass1("video_upload__subtitles_upload_label",e).innerHTML=getLang("video_upload_upload_subtitle_label").replace("{index}",_))}),_<l[t].options.max_tracks_num&&show(i)},removeTrackFile(e,o){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=gpeByClass("video_upload",e),d=gpeByClass("video_upload__subtitles_upload_item",e),t=geByClass1("file",geByClass1("video_upload__upload_subtitles_input_container",d)),_=geByClass1("video_upload__subtitles_upload_btn",d),r=geByClass1("video_upload__subtitles_track_loading",d),s=geByClass1("video_upload__subtitles_track_name",d),n=i.id.substr("video_upload_item_".length),u=l[n];return(o=o||domData(d,"track-id"))===domData(d,"track-id")&&(val(t,""),hide(e),hide(s)),this.updateDefaultLangDropdown(n),u.isEditing&&!a?(show(_),domData(d,"track-id",""),void(o&&(u.subtitlesList[o].remove=e))):o?(o===domData(d,"track-id")&&(show(r),hide(_)),new Promise((e,a)=>{ajax.post("video?act=edit_subtitles_track",{action:"remove",owner_id:u.ownerId,video_id:u.videoId,track_id:o,hash:u.editHash},{onDone:()=>(o===domData(d,"track-id")&&(hide(r),show(_),domData(d,"track-id","")),VideoUpload.updatePlayer(i),e()),onFail:e=>a(e)})})):void 0},onUpdateLang(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=domData(e,"track-id"),i=gpeByClass("video_upload",e),d=i.id.substr("video_upload_item_".length),t=val(domQuery1('input[name="subtitle_lang"]',e)),_=l[d];if(this.updateDefaultLangDropdown(d),a){if(!_.isEditing||o){var r=geByClass1("video_upload__subtitles_track_loading",e),s=domByClass(e,"video_upload__subtitles_remove_file"),n=geByClass1("video_upload__subtitles_track_name",e);return hide(s),hide(n),show(r),new Promise((e,o)=>{ajax.post("video?act=edit_subtitles_track",{action:"edit_lang",owner_id:_.ownerId,video_id:_.videoId,lang_id:t,track_id:a,hash:_.editHash},{onDone:()=>(hide(r),show(s),show(n),this.updateDefaultLang(i),VideoUpload.updatePlayer(i),e()),onFail:e=>o(e)})})}_.subtitlesList[a].update=e}},onVideoUploaded(e,o){var a=l[e];a.videoId=o;var i=a.elems.blockEl;geByClass("video_upload__subtitles_upload_item",i).forEach(e=>{l.uploadTrack(e)})},saveEditedTracks(e,o){var a=l[e],i=a.elems.blockEl,d=[],t=a.subtitlesList;a.subtitlesListAdd.forEach(e=>{d.push(()=>l.uploadTrack(e))});var _=function(e){if(!t.hasOwnProperty(e))return"continue";var o=t[e];o.hasOwnProperty("remove")?d.push(()=>l.removeTrackFile(o.remove,e,!0)):o.hasOwnProperty("update")&&d.push(()=>l.onUpdateLang(o.update,!0))};for(var r in t)_(r);d.reduce((e,o)=>e.then(o),Promise.resolve()).then(()=>{Promise.all(d).then(()=>{var e=l.updateDefaultLang(i,!0);e?e.then(()=>{a.tracksSaved=!0,o()}):(a.tracksSaved=!0,o())})})},updateAllLangDropdowns(e){var o=l[e];for(var a in o.elems.tracksLangDropdown){if(o.elems.tracksLangDropdown.hasOwnProperty(a))o.elems.tracksLangDropdown[a].setOptions({defaultItems:this.getCurrentAvailableLangs(e)})}},updateDefaultLang(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=e.id.substr("video_upload_item_".length),i=l[a];if(i.editHash){var d=null,t=i.elems.defaultLangDropdown.val(),_=i.elems.defaultLangDropdown.container;if(-1!=t&&-2!=t)geByClass("video_upload__subtitles_upload_item",e).forEach(e=>{isVisible(e)&&(val(domQuery1('input[name="subtitle_lang"]',e))===t&&(d=domData(e,"track-id")))});else d=-2==+t?0:-1;if((!i.isEditing||o)&&null!==d&&d!=domData(_,"last-saved"))return new Promise((o,a)=>{ajax.post("video?act=edit_subtitles_track",{action:"set_default",owner_id:i.ownerId,video_id:i.videoId,track_id:d,hash:i.editHash},{onDone:()=>(domData(_,"last-saved",d),VideoUpload.updatePlayer(e),o()),onFail:e=>a(e)})})}},updateDefaultLangDropdown(e){var o=l[e],a=o.elems.blockEl,i=o.elems.defaultLangDropdown,t=i.container,_=i.val(),r=this.getActualDefaultDropdownOptions(e);if(i.setOptions({defaultItems:r}),!inArray(_,this.getActualSelectedLangIds(e))){var s=o.subtitlesDefault,n=domQuery1(`.video_upload__subtitles_upload_item[data-track-id="${s}"]`),u=geByClass1("video_upload__subtitles_remove_file",n);n&&isVisible(u)?i.val(val(domQuery1('input[name="subtitle_lang"]',n))):i.val(-2)}r.length>1?(Object(d.enableEl)(t),removeClass(t,"disabled")):(Object(d.disableEl)(t),addClass(t,"disabled")),this.updateDefaultLang(a)},uploadTrack(e){var o=gpeByClass("video_upload",e).id.substr("video_upload_item_".length),a=l[o],i=a.ownerId,d=a.videoId;if(d){var t=geByClass1("file",geByClass1("video_upload__upload_subtitles_input_container",e));if(t){var _=domData(e,"upload-index"),r=val(domQuery1('input[name="subtitle_lang"]',e)),s=t.files;if(s.length)return new Promise((e,a)=>{ajax.post("al_video.php?act=get_subtitles_upload_params",{oid:i,vid:d},{onDone:a=>{l[o].editHash=a.edit_hash,a.vars.langId=r,a.vars.name=s[0].name,extend(Upload.options[_],a.options),extend(Upload.vars[_],a.vars),Upload.uploadUrls[_]=a.options.url;var i=Upload.options[_].onUploadComplete;Upload.options[_].onUploadComplete=(o,a)=>(i(o,a),e()),Upload.onFileApiSend(_,s,!0)},onFail:e=>(Upload.terminateUpload(_,s[0].name),a(e))})})}}}},_=l,r=a("rCUf");window.VideoUpload=i.default,window.VideoUploadSubtitles=_,window.VideoInlineUpload=r.default;try{stManager.done("video_upload.js")}catch(e){}},hogn:function(e,o,a){"use strict";a.r(o),o.default={get supported(){return!!document.queryCommandSupported&&document.queryCommandSupported("copy")},copy(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.utilsNode,a=!1,i=ce("textarea",{value:e},{position:"absolute",top:-9999,zIndex:2});o.appendChild(i),browser.msie?i.setSelectionRange(0,e.length):i.select();try{a=document.execCommand("copy")}catch(e){a=!1}return re(i),a}}},rCUf:function(e,o,a){"use strict";a.r(o),a.d(o,"getUploadVideoExtMasks",(function(){return t})),a.d(o,"getUploadModule",(function(){return _})),a.d(o,"onVideoUploaded",(function(){return r}));a("91GP"),a("pIFo");var i=a("EasH"),d=a("8h6g");function t(e){var o=d.VIDEO_UPLOAD_EXTS.slice(0,d.VIDEO_UPLOAD_EXTS.length);if("types"===e){for(var a=o.length,i=0;i<a;++i)o.push(o[i].toUpperCase());return"*."+o.join(";*.")}return"accept"===e?"."+d.VIDEO_UPLOAD_EXTS.join(",."):""}function l(e){if(!cur.leaving){var o=getLang("video_upload_changed"),a=!1;if(each(window.cur.videoUploaders,(e,o)=>{Upload.isSomethingUploading(o)&&(a=!0)}),1===e){if(!a)return!0;var d=Object(i.showFastBox)({title:getLang("global_warning"),dark:!0},o,getLang("global_continue"),(function(){cur.leaving=!0,d.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){d.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return a?winToUtf(o.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function _(e,o,a,_,s){if(a){_=_||cur,(s=s||{}).onUploadStart||(s.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,o,a){if(!1===l(1))return cur.onContinueCb=nav.go.pbind(a),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=l,s.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),s.onUploadStartDone&&s.onUploadStartDone()}),s.onUploadComplete||(s.onUploadComplete=(e,o)=>{var a=window.parseJSON(o);a.video_id?r(e,a,_):"string"==typeof o&&o.indexOf("TERMINATED")>-1||Upload.onUploadError(e);s.onUploadCompleteDone&&s.onUploadCompleteDone(),setTimeout(()=>{s.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&s.onUploadAllCompleteDone()})}),s.onUploadProgress||(s.onUploadProgress=(e,o,a)=>{var i=void 0!==e.ind?e.ind:e;show("_im_media_preview"),_.showMediaProgress&&_.showMediaProgress("video",i,function(e,o,a){return{loaded:o,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,o,a))}),s.onUploadError||(s.onUploadError=(e,o)=>{statlogsValueEvent("upload_video_fails",1,a.options.server,o),function(e){var o=void 0!==e.ind?e.ind:e,a=e.fileName?o+"_"+e.fileName:e;if(re("upload"+a+"_progress_wrap"),!geByClass1("popup_box_container")){var d=getLang("video_upload_error");setTimeout(Object(i.showFastBox)({title:getLang("global_error")},d).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+o)||{}).action}),Upload.embed(o)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var n=cur.maxFiles-(cur.savedVideos||[]).length,u=browser.safari?"":"video/*,"+t("accept");a.lang&&(cur.lang=extend(cur.lang||{},a.lang));var p={accept:u,file_input:null,file_name:"video_file",file_size_limit:1024*(a.options.file_size_limit_in_GB||d.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:t("types"),chooseBox:1,chunked:1,chunkSize:d.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:o===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:o,from:a.vars.from,lang:a.lang,max_attempts:3,max_files:n,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!a.options.hasOwnProperty("visible_dropbox")||a.options.visible_dropbox},v=Upload.init(e,"",{},Object.assign(p,s));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(v),v}}function r(e,o,a,d){a=a||cur;var t=void 0!==e.ind?e.ind:e,l=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),_=l?t+"_"+l:e,r=o.owner_id+"_"+o.video_id,s=ge("upload"+_+"_progress_wrap");s&&hide(geByClass1("progress_x",s)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:r},{onDone:e=>{a.chooseMedia("video",r,extend(e[r],{upload_ind:_,upload_new:!0}));var t=o.owner_id,l=o.video_id,s=o.video_hash,n=0,u=()=>{ajax.post("al_video.php?act=encode_progress",{oid:t,vid:l,hash:s,need_thumb:1},{onDone:o=>{var s,n=!0;if(o){if(o.error)return s=getLang("video_upload_encode_error"),void setTimeout(Object(i.showFastBox)({title:getLang("global_error")},s).hide,2e3);o.thumb&&(n=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:t,vid:l},{onDone:o=>{a.hasChosenMedia("video",r)?a.updateChosenMedia("video",r,extend(o,{upload_ind:_,upload_new:!0})):d&&d(e,r)}}))}n&&a.hasChosenMedia("video",r)&&setTimeout(u,1e3)},onFail:()=>{++n<3&&setTimeout(u,2e3*n)}})};u()}})}o.default={getUploadModule:(e,o,a,i,d)=>_(e,o,a,i,d),initModalVideoUploader(){var e=cur.videoUploadParams,o=ge("choose_video_upload");return!!o&&(this.initDragEvents(),_(o,boxLayerWrap,e))},initDragEvents(){var e=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var o=ge("video_choose_upload_area_wrap");if(!hasClass(o,"video_choose_upload_area_enter")){addClass(o,"video_choose_upload_area_enter");var a=ge("video_choose_wrap"),i=getXY(a)[1],d=getSize(o)[1];return hide("video_choose_wrap"),setStyle(o,"height",scrollGetY()+window.clientHeight()-i+d),cancelEvent(e)}},o=e=>cancelEvent(e),a=e=>{if(o(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},i=()=>{addEvent(boxLayerWrap,"dragenter dragover",e),addEvent(boxLayerWrap,"dragleave",o),addEvent(boxLayerWrap,"drop",a)};i(),setTimeout(curBox().setOptions.pbind({onHide:()=>{removeEvent(boxLayerWrap,"dragenter dragover",e),removeEvent(boxLayerWrap,"dragleave",o),removeEvent(boxLayerWrap,"drop",a)},onShow:()=>{i()}}),0)}}}});