(self.webpackChunkvk=self.webpackChunkvk||[]).push([[3087],{695577:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var a=s(667294),i=s(887854),n=s.n(i),r=s(408091),l=s(634777),o=s(379333),h="0 0 12 12",c="star_circle_fill_yellow_12",_=!1;function d(){_||((0,l.addSpriteSymbol)(new(n())({id:c,viewBox:h,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" id="star_circle_fill_yellow_12"><linearGradient id="star_circle_fill_yellow_12_a" gradientUnits="userSpaceOnUse" x1="-6" x2="6" y1="6" y2="18"><stop offset="0" stop-color="#ffb73d" /><stop offset="1" stop-color="#ffa000" /></linearGradient><g clip-rule="evenodd" fill-rule="evenodd"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm.11 2.59a.25.25 0 00-.334.114l-.952 1.928-2.127.31a.25.25 0 00-.138.426l1.539 1.5-.364 2.119a.25.25 0 00.363.263L6 8.25l1.903 1a.25.25 0 00.363-.263l-.364-2.119 1.54-1.5a.25.25 0 00-.14-.427l-2.126-.309-.952-1.928a.25.25 0 00-.113-.113z" fill="url(#star_circle_fill_yellow_12_a)" /><path d="M6.11 2.59a.25.25 0 00-.334.114l-.952 1.928-2.127.31a.25.25 0 00-.138.426l1.539 1.5-.364 2.119a.25.25 0 00.363.263L6 8.25l1.903 1a.25.25 0 00.363-.263l-.364-2.119 1.54-1.5a.25.25 0 00-.14-.427l-2.126-.309-.952-1.928a.25.25 0 00-.113-.113z" fill="#fff" /></g></symbol>'})),_=!0)}var m=function(e){return(0,l.useIsomorphicLayoutEffect)((function(){d()}),[]),a.createElement(o.SvgIcon,(0,r.assign)({},e,{viewBox:h,id:c,width:isNaN(e.width)?12:+e.width,height:isNaN(e.height)?12:+e.height}))};m.mountIcon=d;const g=m},126764:(e,t,s)=>{"use strict";s.d(t,{ChatSettings:()=>b});s(530522),s(66108),s(991181),s(579665),s(95767),s(176774),s(940851),s(296253);var a=s(667294),i=s(663527),n=s(389430),r=s(81020),l=s(41437),o=s(907851),h=s(319368),c=s(881150),_=s(501339),d=s(111146),m=s(234371),g=s(596673),u=s(198946),p=s(383356),C=s(732779),A=s(74934),v=s(791563),S=s(929566),N=s(236205),f=s(351117);function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var s=[],a=!0,i=!1,n=void 0;try{for(var r,l=e[Symbol.iterator]();!(a=(r=l.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){i=!0,n=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw n}}return s}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}var E=l.default.getLang;class b extends a.Component{constructor(e){super(e),this.showInvitationLink=()=>{var e=this.props.store,t=(0,o.unpackStore)(e),s=t.peer;return this.setState({invitationLoading:!0}),(0,n.getInviteLink)(s-2e9,t).then((e=>{var t=L(e,1)[0];this.setState({section:2,invitationLoading:!1,invitationLinks:t})}))},this.onUpdateNotificationSettings=(e,t)=>{var s=this.props,a=s.store,i=s.parentMutations,r=a.get().peer;return a.set(n.toggleMutePeer.bind(null,r,e,t)).then(i().updateState.bind(null,r))},this.onUpdateMentionNotificationSettings=e=>{var t=this.props,s=t.store,a=t.parentMutations,i=s.get().peer;return s.set(n.toggleMuteMentionsPeer.bind(null,i,e)).then(a().updateState.bind(null,i))},this.onUpdateFlags=e=>{var t=this.props.store.get(),s=t.peer,a=t.hasOwnProperty("onUpdateFlags")?t.onUpdateFlags.bind(null,s,e):e=>Promise.resolve(e);return(0,n.updateFlags)(s,e,t).then(a)},this.afterFlagsUpdated=()=>{this.go(0,(()=>this.setBlinkStatus({flagsUpdated:!0})))},this.afterMembersAdded=e=>{this.go(0,(()=>this.setBlinkStatus({membersAdded:!0,membersCount:e})))},this.afterNotificationSettingsUpdated=()=>{this.setBlinkStatus({notificationSettingsUpdated:!0})},this.afterDisableUntilUpdated=()=>{this.setBlinkStatus({disableUntilUpdated:!0})},this.setBlinkStatus=e=>{this.timers.push(setTimeout((()=>this.setState(e)),300))},this.onHideStatus=()=>{this.setState({membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1})},this.onLeave=()=>{var e=this.props,t=e.store,s=e.closePopup,a=t.get().peer,l=(0,i.isFvkcomgroup)(t,a),o=(0,v.showFastBox)({title:E(l?"mail_leave_channel":"mail_chat_leave_title"),dark:1},E(l?"mail_vkcomgroup_leave_confirm":"mail_chat_leave_confirm"),E(l?"mail_leave_channel":"mail_leave_chat"),(function(){t.set(n.unpinMessageOptimistic.bind(null,a)),t.set(n.leaveChat.bind(null,a)),o.hide(),s(),t.get().longpoll.push([(0,r.resetPeer)()])}),E("global_cancel"),(function(){o.hide()}))},this.onChatClose=()=>{var e=this.props,t=e.store,s=e.closePopup,a=t.get().peer,i=(0,S.getTab)(t,a).data.flags,n=i&A.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?i&~A.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:i|A.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE,l=(0,v.showFastBox)({title:E("global_warning"),dark:1},E("mail_chat_close_confirm"),E("mail_close_chat"),(()=>{this.onUpdateFlags(n).then((()=>{l.hide(),s(),t.get().longpoll.push([(0,r.resetPeer)()])}))}),E("global_cancel"),(function(){l.hide()}))},this.onChatRestore=()=>{var e=this.props,t=e.store,s=e.closePopup,a=t.get().peer,i=(0,S.getTab)(t,a).data.flags,n=i&A.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?i&~A.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:i|A.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE;this.onUpdateFlags(n).then(s)},this.onResetLink=()=>{var e=this.props.store,t=(0,o.unpackStore)(e),s=t.peer;return(0,n.resetInviteLink)(s,t).then((e=>{var t=L(e,1)[0];this.setState({invitationLinksReseted:!0,invitationLinks:t})}))},this.onShowAttachments=()=>{var e=(0,N.getPeer)(this.props.store);this.props.closePopup(),window.showWiki({w:"history"+(0,i.convertPeerToUrl)(e)+"_photo"},null,{})},this.onLinkHistoryOptionToggle=()=>{var e=(0,N.getPeer)(this.props.store);this.setState((e=>({isInvitationLinkWithHistory:!e.isInvitationLinkWithHistory})),(()=>{this.props.updateHistoryLinkState(e,this.state.isInvitationLinkWithHistory)}))},this.state={section:0,invitationLinks:null,invitationLinksReseted:!1,isInvitationLinkWithHistory:this.props.isLinkWithHistorySelected,membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1},this.timers=[]}go(e,t){this.setState({section:e},(()=>{this.props.updatePopup(),t&&t()}))}getPopupTitle(){switch(this.state.section){case 1:return E("mail_settings_add_members");case 2:case 3:return E("mail_chat_invite_link");case 6:return E("mail_settings_options");default:return E("mail_settings_title")}}componentWillReceiveProps(e){var t=e.store.get(),s=t.peer,a=t.tabs[s];a.photoLarge||a.photoGrid||this.resync||(this.resync=!0,e.store.set(n.getChatDetails.bind(null,s)).then((()=>{this.resync=!0})))}componentDidMount(){this.props.updatePopup()}componentWillUnmount(){this.timers.forEach(clearTimeout)}render(){var e=this.props,t=e.store,s=e.closePopup,n=t.get(),r=n.peer,l=n.tabs[r],o=(0,i.isFvkcomgroup)(t,r),v=(0,S.isCasperChat)(t,r),N=(0,S.isCommunityChat)(t,r),L=!o&&!N||!t.get().gid,I=(0,A.canCloseChat)(t,r,n.id),b=(0,f.isClosedChat)(l),M=n.isChatTypeEditAllowed,k=E(o?"mail_im_n_vkcomgroup_members":"mail_im_n_chat_members",(0,i.getAliveMembersCount)(l));return a.createElement("section",{className:"ChatSettings"},a.createElement(h.default,{title:this.getPopupTitle(),back:0!==this.state.section?E("global_back"):void 0,onCloseClick:s,onBackClick:()=>this.go(0)}),0===this.state.section&&a.createElement("div",{className:"ChatSettings__content"},a.createElement(_.default,{store:t,photo:l.photoLarge,grid:l.photoGrid,title:l.name,flags:l.data.flags,isDefaultPhotoOwner:l.isDefaultPhotoOwner,isCasper:v,isDonutChat:l.isDonutChat,meta:k,description:""}),a.createElement(g.default,{store:t,showMembersSettings:()=>this.go(1),showAttachments:this.onShowAttachments,showInvitationLink:this.showInvitationLink,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks,showSettings:()=>this.go(6),notificationSettingsUpdated:this.state.notificationSettingsUpdated,disableUntilUpdated:this.state.disableUntilUpdated,flagsUpdated:this.state.flagsUpdated,onHideStatus:this.onHideStatus,onUpdateNotificationSettings:this.onUpdateNotificationSettings,onUpdateMentionNotificationSettings:this.onUpdateMentionNotificationSettings,afterNotificationSettingsUpdated:this.afterNotificationSettingsUpdated,afterDisableUntilUpdated:this.afterDisableUntilUpdated}),o?null:a.createElement("div",{className:"ChatSettings__pane"},a.createElement(u.default,{store:t,onLeave:this.onLeave,showMembersSettings:()=>this.go(1),membersAdded:this.state.membersAdded,onHideStatus:this.onHideStatus,membersCount:this.state.membersCount})),L&&a.createElement("div",{className:"ChatSettings__pane"},a.createElement(c.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__leave",onClick:this.onLeave},E(o?"mail_leave_channel":"mail_settings_leave"))),I&&!b&&a.createElement("div",{className:"ChatSettings__pane"},a.createElement(c.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__close",onClick:this.onChatClose},E("mail_settings_close"))),I&&b&&l.canRestore&&a.createElement("div",{className:"ChatSettings__pane"},a.createElement(c.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__restore",onClick:this.onChatRestore},E("mail_settings_restore")))),1===this.state.section&&a.createElement(p.default,{store:t,afterSave:this.afterMembersAdded}),6===this.state.section&&a.createElement(C.ChatSettingsOptions,{isChatTypeEditAllowed:M,flags:l.data.flags,isCasperChatTab:v,isCommunityChat:N,allowedUpdateFlags:l.allowedUpdateFlags,back:()=>this.go(0),onSave:this.onUpdateFlags,afterSave:this.afterFlagsUpdated}),2===this.state.section&&a.createElement(d.default,{store:t,onReset:()=>this.go(3),onLinkHistoryOptionToggle:this.onLinkHistoryOptionToggle,reseted:this.state.invitationLinksReseted,isInvitationLinkWithHistory:this.state.isInvitationLinkWithHistory,invitationLinks:this.state.invitationLinks}),3===this.state.section&&a.createElement(m.default,{onConfirm:this.onResetLink,onCancel:()=>this.go(2)}))}}},501339:(e,t,s)=>{"use strict";s.d(t,{default:()=>m});s(176774),s(59357);var a=s(667294),i=s(121265),n=s(41437),r=s(838482),l=s(639790),o=s(969135),h=s(695577),c=s(74934),_=s(389430),d=s(713075);class m extends a.PureComponent{constructor(e){super(e),this.onSaveTitle=e=>{var t=this.props.store,s=t.get(),a=e.value.trim().replace("\n","");a&&a!==unclean(this.props.title)&&(this.setState({titleChanged:!1}),t.set(_.updateChatTopic.bind(null,s.peer,a)))},this.onChangeTitle=e=>{if(this.state.title!==e.target.value){var t=e.target.value.replace("\n","");this.setState({title:t,titleChanged:unclean(this.props.title)!==t})}},this.onValidateTitle=e=>!!e.trim().replace("\n",""),this.onCancelTitle=()=>{this.setState({title:unclean(this.props.title),titleChanged:!1})},this.onSaveDescription=e=>{},this.onPhotoUpload=()=>{var e=this.props.store,t=e.get().peer;(0,c.canChangeTitle)(e)&&(cur.recieveCropResult=void 0,Page.ownerPhoto(t,{gid:e.get().gid}))},this.onPhotoRemove=()=>{var e=this.props.store,t=e.get().peer;(0,c.canChangeTitle)(e)&&e.set(_.removeChatPhoto.bind(null,t)).then((()=>e.set(_.getChatDetails.bind(null,t)))).catch((e=>(0,d.imWeirdCatch)("onPhotoRemove",e)))},this.state={title:unclean(e.title),titleChanged:!1}}getCasperInfo(){var e=(0,n.getLang)("mail_casper_chat_info");return a.createElement(a.Fragment,null,(0,n.getLang)("mail_casper_chat_label"),a.createElement(r.default,{text:e,position:"t",appearance:"light",maxWidth:280,marginTop:-6},a.createElement(o.default,{"aria-label":e,className:"ChatSettingsInfo__casperHint"})))}render(){var e=this.props,t=e.store,s=e.photo,o=e.title,_=e.description,d=e.grid,m=e.meta,g=e.isDonutChat,u=e.isDefaultPhotoOwner,p=void 0!==u&&u,C=e.isCasper,A=void 0!==C&&C,v=unclean(o),S=(0,c.canChangeTitle)(t),N=(0,i.classNames)("ChatSettingsInfo",{"ChatSettingsInfo--editable":S}),f=(0,i.classNames)("ChatSettingsInfo__title",{"ChatSettingsInfo__title-service":64&this.props.flags});return a.createElement("div",{className:N},a.createElement("header",{className:"ChatSettingsInfo__header"},a.createElement("div",{className:"ChatSettingsInfo__photo"},a.createElement("div",{className:"ChatSettingsInfo__attach nim-peer nim-peer_larger","data-tip":(0,n.getLang)("mail_settings_photo"),onClick:this.onPhotoUpload},s?a.createElement("img",{src:s,width:"80",height:"80",alt:v,className:"ChatSettingsInfo__photoSelf"}):a.createElement("div",{className:"nim-peer--photo-w"},a.createElement("div",{className:"ChatSettingsInfo__photoGrid nim-peer--photo",dangerouslySetInnerHTML:{__html:d}}))),s&&S&&!p&&a.createElement(r.default,{text:(0,n.getLang)("mail_settings_remove_photo"),position:"t",align:"left"},a.createElement("button",{onClick:this.onPhotoRemove,className:"ChatSettingsInfo__photoRemove"}))),a.createElement("h3",{className:f},S?a.createElement(l.default,{value:this.state.title,changed:this.state.titleChanged,useEnter:!0,onSave:this.onSaveTitle,onChange:this.onChangeTitle,onCancel:this.onCancelTitle,validate:this.onValidateTitle}):v),a.createElement("div",{className:"ChatSettingsInfo__meta"},a.createElement("span",{className:"ChatSettingsInfo__metaItem"},m),g&&a.createElement("span",{className:"ChatSettingsInfo__metaItem"},(0,n.getLang)("groups_donut_is_dons_chat")," ",a.createElement(h.default,null)),A&&a.createElement("span",{className:"ChatSettingsInfo__metaItem"},this.getCasperInfo()))),_&&a.createElement("div",{className:"ChatSettingsInfo__description"},S?a.createElement(l.default,{value:_,onSave:this.onSaveDescription}):_))}}},111146:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});s(751876);var a=s(667294),i=s(41437),n=s(595775),r=s(881150),l=s(629142),o=s(856612),h=s(663527),c=s(277256),_=i.default.getLang;class d extends a.Component{constructor(e){super(e),this.onCopy=()=>{this.input&&(elfocus(this.input,0,this.input.value.length),document.execCommand("copy"),this.setState({copied:!0}))},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getInputRef=e=>{e&&e.element&&(this.input=e.element)},this.state={copied:!1}}componentDidMount(){this.input&&elfocus(this.input,0,this.input.value.length)}render(){var e=this.props,t=e.onReset,s=e.invitationLinks,i=e.store,d=_("mail_invite_link_reset_explainer").split("{reset_link}"),m=!(0,h.isFvkcomgroup)(i,i.get().peer),g=s.linkWithHistory,u=s.linkWithoutHistory,p=this.props.isInvitationLinkWithHistory?g:u;return a.createElement("div",{className:"ChatSettingsInvitationLink"},this.props.reseted&&a.createElement("div",{className:"ChatSettingsInvitationLink__reseted"},_("mail_invite_link_reseted_explainer")),a.createElement("p",null,_("mail_invite_link_explainer")),a.createElement("div",{className:"ChatSettingsInvitationLink__switch"},a.createElement(c.default,{children:_("mail_im_chat_add_members_show_history"),checked:this.props.isInvitationLinkWithHistory,onChange:this.props.onLinkHistoryOptionToggle})),a.createElement("div",{className:"ChatSettingsInvitationLink__main"},a.createElement(n.default,{ref:this.getInputRef,readOnly:"readonly",className:"ChatSettingsInvitationLink__input",value:p}),a.createElement(r.default,{onClick:this.onCopy},_("mail_get_invite_link_copy")),a.createElement(l.default,{className:"ChatSettingsInvitationLink__copied",shown:this.state.copied,callback:this.onBlinkTextHide},_("mail_invite_link_copied"))),m&&a.createElement("p",null,d[0],a.createElement(o.default,{className:"ChatSettingsInvitationLink__reset",onClick:t},_("mail_invite_reset_link")),d[1]))}}},598940:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var a=s(667294),i=s(41437),n=s(309739),r=s(838482),l=s(74934),o=s(713075),h=s(389430),c=s(929566),_=s(122902),d=s(151223),m=s(907851),g=i.default.getLang;class u extends a.Component{constructor(){super(...arguments),this.toggleAdmin=()=>{var e=this.props,t=e.store,s=e.mid,a=e.adminMap,i=t.get().peer,n=!a[s];t.set(h.toggleAdminOptimisticly.bind(null,i,s,n)),t.set(h.toggleAdmin.bind(null,i,s,n))},this.kick=()=>{var e=this.props.store,t=e.get().peer,s=this.props.mid;e.set((e=>(0,d.kickUserOptimistically)(e,t,s))),e.set((e=>(0,_.kickUserAction)(e,t,s))).catch((e=>{(0,o.imWeirdCatch)("ChatSettingsMemberEdit.kick",e)}))},this.cancelMessageRequest=()=>{var e=this.props.store,t=e.get().peer,s=this.props.mid;e.set((e=>(0,_.cancelMessageRequestAction)(e,t,s))).catch((e=>{(0,o.imWeirdCatch)("ChatSettingsMemberEdit.cancel",e)}))},this.changeAccess=e=>{var t=this.props.store,s=t.get().peer,a=this.props.mid;t.set(h.changeCommunityAccess.bind(null,s,a,!e)).catch((e=>{(0,o.imWeirdCatch)("ChatSettingsMemberEdit.changeAccess",e)}))}}getMemberRole(e,t){var s=this.props.storeData,a=s.peer;return t===s.tabs[a].ownerId?g("mail_settings_owner"):e[t]?g("mail_settings_admin"):null}getActions(e){var t=this.props,s=t.store,a=t.mid,i=(0,m.unpackStore)(s),n=i.id,r=i.peer,o=n===a,h=[],_=(0,c.isCommunityChat)(s,r);if(o)return _&&(0,c.isCommunityInterface)(s)?[]:[{text:g("mail_leave_chat"),onClick:this.props.onLeave}];if((0,l.canAddAdmin)(s,a)&&h.push({text:e[a]?g("mail_chat_remove_admin"):g("mail_settings_appoint_admin"),onClick:this.toggleAdmin}),(0,l.canKickUser)(s,a)&&h.push({text:g("mail_settings_kick"),onClick:this.kick}),(0,c.isCommunityPeer)(a)&&!e[a]){var d=(0,l.canSeeAllMessages)(s,s.get().peer,a),u=d?"mail_settings_community_mentions_only":"mail_settings_community_full_access";h.push({text:g(u),onClick:this.changeAccess.bind(this,d)})}return h}render(){var e=this.props,t=e.adminMap,s=e.storeData,i=e.mid,o=e.isMR,h=s.id,c=!!t[h],_=this.getMemberRole(t,i),d=h===i,m=c&&this.getActions(t);return o?a.createElement(r.default,{text:g("mail_cancel_invitation"),position:"t",align:"right"},a.createElement("span",{onClick:this.cancelMessageRequest,className:"ChatSettingsMembersEdit__kick"})):a.createElement(a.Fragment,null,_&&a.createElement("span",{className:"ChatSettingsMembersEdit__role"},_),m&&m.length>0&&a.createElement(n.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:this.getActions(t)},a.createElement("span",{className:"ChatSettingsMembersEdit__actions"})),!c&&!d&&(0,l.canKickUser)(s,i)&&a.createElement(r.default,{text:g("mail_settings_kick"),position:"t",align:"right"},a.createElement("span",{onClick:this.kick,className:"ChatSettingsMembersEdit__kick"})),!c&&d&&a.createElement(r.default,{text:g("mail_leave_chat"),position:"t",align:"right"},a.createElement("span",{onClick:this.props.onLeave,className:"ChatSettingsMembersEdit__kick"})))}}},383356:(e,t,s)=>{"use strict";s.d(t,{default:()=>A});s(991181),s(175115),s(940851),s(296253);var a=s(667294),i=s(41437),n=s(121265),r=s(929566),l=s(389430),o=s(248586),h=s(167578),c=s(423558),_=s(351605),d=s(731585),m=s(791563),g=s(227192),u=s(351117),p=i.default.getLang,C=()=>{};class A extends a.Component{constructor(e){super(e),this.onChange=e=>{var t=this.props.store.get(),s=e.target.value,a=(0,r.getTab)(t,t.peer);a.customChatMemberSearch?a.customChatMemberSearch(s).then((e=>(this.setSearchResults({},!1,s,e),s&&a.customChatMemberServerSearch?(this.isSearching=!0,a.customChatMemberServerSearch(s).catch((e=>{if("debounce"!==e)throw e}))):Promise.resolve([])))).then(this.appendSearchResults):(0,l.searchLocalHints)(s,t).then((e=>(this.setSearchResults({},!1,s,e),s?(this.isSearching=!0,this.serverSearch(s,e.map((e=>e.peerId)))):Promise.resolve([])))).then(this.appendSearchResults).catch((()=>{}))},this.serverSearch=(0,g.debouncedPromise)(((e,t)=>{var s=this.props.store;return(0,l.searchHints)(e,t,"friends",s.get())}),300),this.onRemoveToken=e=>new Promise((t=>{var s=this.state.selected.filter((t=>t!==e));this.selected=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.setState({selected:s},t)})),this.onSelect=e=>new Promise((t=>{var s=this.selected[e]?this.state.selected.filter((t=>t!==e)):[].concat(this.state.selected,e).filter(((e,t,s)=>s.indexOf(e)===t));this.selected=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.resetSearch({selected:s,value:""},t)})),this.onShowHistoryToggle=()=>{this.setState({isShowHistoryChecked:!this.state.isShowHistoryChecked})},this.onAddPeople=()=>{var e=this.props.store,t=e.get().peer,s=this.state.selected.map((e=>parseInt(e))),a=this.state.isShowHistoryChecked;this.setState({loading:!0}),e.set(l.addNewMember.bind(null,t,s,a)).then((()=>e.set(l.getChatDetails.bind(null,t)).then((()=>{this.selected={},this.resetSearch({selected:[],loading:!1},(()=>{this.props.afterSave(s.length)}))})))).catch((e=>{this.selected={},this.resetSearch({selected:[],loading:!1}),(0,m.showFastBox)(p("global_error"),e)}))},this.setSearchResults=(e,t,s,a)=>{var i=this.props.store.get(),n=(0,r.getTab)(i,i.peer),l=[];a.forEach((e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===n.memberIds.indexOf(e.peerId)&&l.push(e.peerId)})),this.setState(Object.assign({},e,{found:l,value:s}),t||C)},this.appendSearchResults=e=>{var t=this.props.store.get(),s=(0,r.getTab)(t,t.peer),a=this.state.found;e.forEach((e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===s.memberIds.indexOf(e.peerId)&&-1===a.indexOf(e.peerId)&&a.push(e.peerId)})),this.isSearching=!1,this.setState({found:a})},this.getBadge=()=>(0,u.getCurrentTab)(this.props.store).isDonutChat?a.createElement("div",{className:"BannerInfo ChatSettingsMembers__donutBadge"},p("mail_dons_only_search")):null,this.state={selected:[],value:"",loading:!1,found:[],isShowHistoryChecked:!0},this.data={},this.selected={}}resetSearch(e,t){var s=this.props.store.get(),a=(0,r.getTab)(s,s.peer);return(a.customChatMemberSearch?a.customChatMemberSearch(""):(0,l.searchLocalHints)("",this.props.store.get())).then((s=>this.setSearchResults(e,t,"",s)))}componentDidMount(){this.resetSearch()}render(){var e=Object.keys(this.state.selected).length,t="ChatSettingsMembers__entity";return a.createElement("div",{className:"ChatSettingsMembers"},a.createElement(h.default,{className:"ChatSettingsMembers__multiSelect",tokens:this.state.selected.map((e=>({text:unclean(this.data[e].name),id:e}))),removeTokenPlaceholder:p("mail_create_chat_remove_user"),onRemoveToken:this.onRemoveToken,placeholder:p("mail_search_creation"),value:this.state.value,onChange:this.onChange,onSelect:this.onSelect,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:()=>{},notFoundText:p("mail_not_found"),autoFocus:!0,isSearching:this.isSearching,badge:this.getBadge()},this.state.found.map((e=>a.createElement("div",{className:(0,n.classNames)(t,{[`${t}--selected`]:this.selected[e]}),key:e,"data-id":e},a.createElement(o.default,{size:"34",title:this.data[e].name,photo:this.data[e].photo}))))),a.createElement(_.default,{alignment:"right",className:"ChatSettingsMembers__submitArea"},a.createElement(d.default,{checked:this.state.isShowHistoryChecked,onChange:this.onShowHistoryToggle,className:"ChatSettingsMembers__showHistory"},p("mail_im_chat_add_members_show_history")),a.createElement(c.default,{disabled:0===e,onClick:this.onAddPeople,loading:this.state.loading,className:"ChatSettingsMembers__confirm"},p(e<2?"mail_append_chat":"mail_im_create_chat_with"))))}}},198946:(e,t,s)=>{"use strict";s.d(t,{default:()=>N});s(940851),s(976142),s(751876),s(820075),s(991181),s(296253),s(59357);var a=s(667294),i=s(41437),n=s(121265),r=s(663527),l=s(371372),o=s(74934),h=s(339814),c=s(670546),_=s(750598),d=s(248586),m=s(598940),g=s(629142),u=s(907851),p=s(906942),C=50,A={appendParentCls:"ChatSettingsWrapper"},v=i.default.getLang,S={all:"allShowMore",admins:"adminsShowMore",invitedByMRShowMore:"invitedByMRShowMore"};class N extends a.Component{constructor(e){super(e),this.onToggleSearch=()=>{this.state.showSearch?this.setState({showSearch:!1,searchQuery:""}):(this.setState({showSearch:!0}),requestAnimationFrame((()=>{this.searchInput.focus()})))},this.onSearchChange=e=>{e.target.value!==this.state.searchQuery&&this.setState({searchQuery:e.target.value})},this.onShowMore=()=>{var e=S[this.state.current];this.state[e]&&this.setState({[e]:!1})},this.onTabClick=(e,t)=>{e.preventDefault(),this.state.current!==t&&this.setState({current:t})},this.handleDocumentClick=e=>{!this.state.showSearch||this.state.searchQuery||e.target.closest(".ChatSettingsMembersWidget__search")||e.target.closest(".ChatSettingsMembersWidget__searchIcon")||this.setState({showSearch:!1})},this.onKeydown=e=>{this.state.showSearch&&27===e.keyCode&&(this.searchInput.blur(),this.setState({showSearch:!1,searchQuery:""}),e.preventDefault(),e.stopPropagation())},this.getInviter=e=>{if(this.invitersCache[e])return this.invitersCache[e];var t=this.props.store.get(),s=t.peer,a=t.tabs[s],i=a.inviters;if(!i[e])return"";var n=(0,r.getChatMembersByIds)(t,[i[e][0]])[0],l=getSmDate(i[e][2],t.timeshift,!0);if((0,o.isUserOwnerInChat)(a,e))return this.invitersCache[e]=v("mail_settings_owner"),v("mail_settings_owner");if(!n)return this.invitersCache[e]=l,l;var h=langSex(i[e][1],v("mail_chat_member_invited_by_X","raw")).replace(/{inviter}/,replaceEntities(n.name))+" "+l;return this.invitersCache[e]=h,h},this.isAddMemberWidgetShown=()=>{var e=this.props.store,t=(0,u.unpackStore)(e),s=t.id,a=t.peer,i=this.state,n=i.current,r=i.showSearch,l=i.searchQuery;return"all"===n&&!(r&&""!==l)&&(0,o.canInviteUser)(e,a,s)},this.getCommunityDescriptionText=e=>v(e?"mail_settings_community":"mail_settings_bot"),this.getMemberDescriptionText=(e,t,s)=>{var a=t.tabs[t.peer];if((0,r.isCommunityPeer)(e.id))return this.getCommunityDescriptionText(e.id===a.ownerId);if(s)return(0,r.getMessageRequestDateText)(e.date,t.timeshift);var i=a.membersLastSeen;return i&&i[e.id]?(0,r.getLastSeenText)(t,e.id,i[e.id],A):void 0},this.searchInputRef=e=>{this.searchInput=e};var t=e.store.get(),s=this.getMembers(t),a=this.getAdmins(t),i=this.getInvitedByMessageRequests(t);this.state={showSearch:!1,searchQuery:"",current:"all",all:s,allShowMore:s.length>C,admins:a,adminsShowMore:a.length>C,invitedByMR:i,invitedByMRShowMore:i.length>C},this.membersMap=s.reduce(((e,t)=>(e[t]=!0,e)),{}),this.searchIndexPromise=this.getSearchIndex(s).then((e=>{this.searchIndex=e})),this.invitersCache={}}componentWillReceiveProps(e){var t=e.store.get(),s=this.getMembers(t),a=this.getAdmins(t),i=this.getInvitedByMessageRequests(t),n={removes:[],additions:[]},r=s.reduce(((e,t)=>(e[t]=!0,e)),{});s.forEach((e=>{this.membersMap[e]||n.additions.push(e)})),Object.keys(this.membersMap).forEach((e=>{r[e]||n.removes.push(e)})),(n.removes.length||n.additions.length)&&(this.updateSearchIndex(t,n),this.membersMap=r);var l={all:s,allShowMore:this.state.allShowMore&&s.length>C,admins:a,adminsShowMore:this.state.adminsShowMore&&a.length>C,invitedByMR:i,invitedByMRShowMore:this.state.invitedByMRShowMore&&i.length>C};l.current=l[this.state.current].length>0?this.state.current:"all",this.setState(l)}getMembers(e){var t=e.peer,s=e.tabs[t],a=-1!==(s.memberIds||[]).indexOf(s.ownerId),i=(s.adminIds||[]).reduce(((e,t)=>(e[t]=!0,e)),{});return(a?[s.ownerId]:[]).concat((s.adminIds||[]).filter((e=>e!==s.ownerId)),(s.memberIds||[]).filter((e=>e!==s.ownerId&&!i[e])))}getAdmins(e){var t=e.peer,s=e.tabs[t];return(-1!==(s.memberIds||[]).indexOf(s.ownerId)?[s.ownerId]:[]).concat((s.adminIds||[]).filter((e=>e!==s.ownerId)))}getInvitedByMessageRequests(e){var t=e.peer;return e.tabs[t].invitedByMessageRequest.sort((function(e,t){return e.date-t.date}))}getCurrentList(){var e=this.props.store,t=this.state,s=t.current,a=t.showSearch,i=t.searchQuery,n=t.invitedByMR;if(a&&i&&this.searchIndex){var l=n.filter((e=>!!e.name.toLowerCase().trim().split(/\s+/).find((e=>0===e.indexOf(i.toLowerCase())))));return this.searchIndex.search(i).concat(l)}var o=this.state[s],h="invitedByMR"===s?o:(0,r.getChatMembersByIds)(e.get(),o);return this.state[`${s}ShowMore`]?h.slice(0,C):h}getSearchIndex(e){var t=window.vkIndexer,s=(0,r.getChatMembersByIds)(this.props.store.get(),e);return this.membersMap=s.reduce(((e,t)=>(e[t.id]=!0,e)),{}),new Promise(((e,a)=>{var i=new t(s,(e=>e.name),(()=>{e(i)}))}))}updateSearchIndex(e,t){var s=(0,r.getChatMembersByIds)(e,t.removes),a=(0,r.getChatMembersByIds)(e,t.additions);(this.searchIndex?Promise.resolve(this.searchIndex):this.searchIndexPromise).then((e=>{s.forEach((t=>{e.remove(t)})),a.forEach((t=>{e.add(t)}))}))}componentDidMount(){this.searchInput.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.searchInput.removeEventListener("keydown",this.onKeydown)}render(){var e=this.props,t=e.store,s=e.membersCount,i=e.membersAdded,o=e.onHideStatus,u=this.state,C=u.current,A=u.showSearch,N=u.searchQuery,f=u.admins,L=u.invitedByMR,I=t.get(),E=I.peer,b=I.tabs[E],M=this.getCurrentList(),k=this.isAddMemberWidgetShown()?["add"].concat(M):M,T=this.state[S[C]],y={"ChatSettingsMembersWidget--search":!!A},w=b.adminIds.reduce(((e,t)=>(e[t]=!0,e)),{});return a.createElement("div",{className:(0,n.classNames)("ChatSettingsMembersWidget",y)},a.createElement("header",{className:"ChatSettingsMembersWidget__header"},a.createElement("input",{placeholder:v("mail_members_search"),className:"ChatSettingsMembersWidget__search",onChange:this.onSearchChange,onInput:this.onSearchChange,onPaste:this.onSearchChange,value:this.state.searchQuery,ref:this.searchInputRef}),a.createElement("button",{className:"ChatSettingsMembersWidget__searchIcon",onClick:this.onToggleSearch}),a.createElement(h.default,{className:"ChatSettingsMembersWidget__tabs",onTabClick:this.onTabClick},a.createElement("span",{key:"all"},v("mail_settings_everyone")+" ",a.createElement("span",{className:"Tabs__desc"},(0,r.getAliveMembersCount)(b))),f.length>0&&a.createElement("span",{key:"admins"},v("mail_settings_admins")+" ",a.createElement("span",{className:"Tabs__desc"},f.length)),L.length>0&&a.createElement("span",{key:"invitedByMR"},v("mail_invited_members")+" ",a.createElement("span",{className:"Tabs__desc"},L.length)))),a.createElement("div",{className:"ChatSettingsMembersWidget__list"},a.createElement(c.default,{border:!1},k.length>0&&k.map((e=>{if("add"===e)return a.createElement(_.default,{selectable:!1,border:!1,key:"add",onClick:this.props.showMembersSettings,aside:a.createElement(g.default,{className:"ChatSettingsMembersWidget__blink",shown:i,callback:o},langNumeric(s||0,v("mail_settings_members_added","raw")))},a.createElement("span",{className:"ChatSettingsMembersWidget__add"},a.createElement("span",null,v("mail_settings_add_members"))));var n=this.getInviter(e.id),h="invitedByMR"===C,c=e.image_status?e.name+`<span class="ChatSettingsMembersWidget__imageStatus">${e.image_status}</span>`:e.name,u=this.getMemberDescriptionText(e,I,h);return a.createElement(_.default,{selectable:!1,border:!1,aside:a.createElement(m.default,{adminMap:w,store:t,storeData:I,mid:e.id,onLeave:this.props.onLeave,isMR:h}),key:e.id},a.createElement(d.default,{ignoreDecodeHTML:!0,photo:(0,l.isContactPeer)(e.id)?a.createElement(p.ConversationNoPhoto,{id:E,text:(0,r.getUserInitials)(e.name),size:"xxxs",specificType:7}):e.photo,title:a.createElement("span",{dangerouslySetInnerHTML:{__html:c}}),description:a.createElement("span",{title:n,dangerouslySetInnerHTML:{__html:u}}),href:e.link,onLinkClick:t=>{t.preventDefault(),nav.go(e.link,t)}}))})),!k.length&&A&&N&&a.createElement("div",{className:"ChatSettingsMembersWidget__empty"},v("mail_settings_not_found")),!(A&&N)&&T&&a.createElement("div",{className:"ChatSettingsMembersWidget__more",onClick:this.onShowMore},v("mail_settings_show_all_members")))))}}},596673:(e,t,s)=>{"use strict";s.d(t,{default:()=>v});s(175115);var a=s(667294),i=s(121265),n=s(41437),r=s(856612),l=s(670546),o=s(750598),h=s(629142),c=s(248586),_=s(539503),d=s(927273),m=s(366035),g=s(74934),u=s(663527),p=s(929566),C=n.default.getLang,A=()=>[{label:C("mail_settings_time_one_hour"),value:d.HOUR},{label:C("mail_settings_time_eight_hours"),value:8*d.HOUR},{label:C("mail_settings_time_day"),value:d.DAY},{label:C("mail_settings_time_week"),value:d.WEEK},{label:C("mail_settings_time_forever"),value:-1}];class v extends a.Component{constructor(e){super(e),this.onCopyInviteLink=e=>{this.input&&(this.input.focus(),this.input.select(),document.execCommand("copy"),this.setState({copied:!0})),e.preventDefault(),e.stopPropagation()},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getHiddenInput=e=>{this.input=e},this.onDisabledSettingsChange=e=>{var t=e.selected.value,s=t>0?Math.floor((Date.now()+t)/1e3):t,a=0!==s;this.setState({push_disabled_until:s,push_disabled:a,disabledPlaceholder:this.getDisabledPlaceholder(s)},(()=>{this.props.onUpdateNotificationSettings(a,Math.floor(t/1e3)).then((()=>{this.props.afterDisableUntilUpdated()}))}))},this.onMentionSettingsChange=e=>{var t=e.selected.value;this.setState({mentions_push_disabled:t},(()=>{this.props.onUpdateMentionNotificationSettings(t).then((()=>{this.props.afterNotificationSettingsUpdated()}))}))},this.onShowInviteLink=()=>{(0,g.canChangeInviteLink)(this.props.store)&&this.props.showInvitationLink()};var t=this.getPushSettingsFromProps(e),s=t.push_disabled_until,a=s>0?+new Date(s):s;this.state=Object.assign({pushDisabled:s,disabledPlaceholder:this.getDisabledPlaceholder(a),copied:!1},t)}getPushSettingsFromProps(e){var t=e.store.get();return t.tabs[t.peer].notifications}getPushDisabledFromProps(e){var t=e.store.get();return t.tabs[t.peer].notifications.push_disabled}getDisabledPlaceholder(e){if(!e||0===e)return C("mail_settings_configure");if(-1===e)return C("mail_settings_time_forever");var t=getShortDateWithTime(e,0,!1);return`${C("mail_settings_until")} ${t}`}getDisabledOptions(){return this.state.push_disabled_until?[].concat(A(),[{label:C("mail_settings_time_cancel"),value:0}]):A()}render(){var e=this.props,t=e.store,s=e.flagsUpdated,n=e.notificationSettingsUpdated,d=e.disableUntilUpdated,A=e.onHideStatus,v=e.invitationLinks,S=e.isInvitationLinkWithHistory,N=t.get(),f=N.tabs[N.peer],L=(0,u.isFvkcomgroup)(N,N.peer),I=(0,p.isCommunityChat)(N,N.peer),E=f.inviteLinks&&(0,g.canSeeInviteLink)(t)||(0,g.canChangeInviteLink)(t),b=v||f.inviteLinks,M=b&&(S?b.linkWithHistory:b.linkWithoutHistory),k=(0,g.canSeeSettingsItem)(t,N.peer,N.id),T=(0,i.classNames)("ChatSettingsMenu",{"ChatSettingsMenu--copied":this.state.copied}),y=N.isMassMentionsMessageAllowed,w=C(S?"mail_get_invite_link_copy_with_history":"mail_get_invite_link_copy_without_history");return a.createElement("div",{className:"ChatSettings__pane"},I&&a.createElement(l.default,{className:T},a.createElement(o.default,{onClick:e=>nav.go(f.owner.link,e),chevron:!0,className:"ChatSettingsMenu__owner"},a.createElement(c.default,{size:"28",title:f.owner.title,photo:f.owner.photo,href:f.owner.link,description:f.owner.description}))),a.createElement(l.default,{className:T},a.createElement(o.default,{onClick:this.props.showAttachments,chevron:!0},a.createElement(m.default,{type:"attach",backgroundColor:"blue"}),C("mail_im_show_media_history"))),a.createElement(l.default,{className:T},y&&a.createElement(a.Fragment,null,a.createElement(o.default,{selectable:!1,chevron:!1,aside:a.createElement(a.Fragment,null,a.createElement(h.default,{shown:n,callback:A},C("global_changes_saved_short")),a.createElement(_.default,{className:"ChatSettingsMenu__select",onChange:this.onMentionSettingsChange,options:[{label:C("mail_settings_mentions_all"),value:0},{label:C("mail_settings_mentions_except"),value:1},{label:C("mail_settings_mentions_disable"),value:2}],value:this.state.mentions_push_disabled}))},a.createElement(m.default,{type:"mention",backgroundColor:"blue"}),C("mail_settings_mentions")),a.createElement(o.default,{selectable:!1,aside:a.createElement(a.Fragment,null,a.createElement(h.default,{shown:d,callback:A},C("global_changes_saved_short")),a.createElement(_.default,{className:"ChatSettingsMenu__select",onChange:this.onDisabledSettingsChange,options:this.getDisabledOptions(),placeholder:this.state.disabledPlaceholder}))},a.createElement(m.default,{type:"notice",backgroundColor:"red"}),C("mail_settings_notices"))),(E||k)&&a.createElement(a.Fragment,null,E&&a.createElement(o.default,{onClick:this.onShowInviteLink,chevron:(0,g.canChangeInviteLink)(t)},a.createElement(m.default,{type:"link",backgroundColor:"green"}),C(L?"mail_vkcomgroup_invite_link":"mail_chat_invite_link"),M&&a.createElement("span",{className:"ChatSettingsMenu__invite"},a.createElement("span",{className:"ChatSettingsMenu__hidden"},a.createElement("input",{type:"text",readOnly:!0,value:M,ref:this.getHiddenInput})),a.createElement(h.default,{className:"ChatSettingsMenu__copied",shown:this.state.copied,callback:this.onBlinkTextHide},C("mail_invite_link_copied")),a.createElement(r.default,{className:"ChatSettingsMenu__copy",onClick:this.onCopyInviteLink},w))),k&&a.createElement(o.default,{onClick:this.props.showSettings,chevron:!0,aside:a.createElement(h.default,{shown:s,callback:A},C("global_changes_saved"))},a.createElement(m.default,{type:"gear",backgroundColor:"gray"}),C("mail_settings_options")))))}}},732779:(e,t,s)=>{"use strict";s.d(t,{ChatSettingsOptions:()=>C});s(176774);var a=s(667294),i=s(41437),n=s(670546),r=s(750598),l=s(539503),o=s(881150),h=s(423558),c=s(351605),_=s(366035),d=s(756800),m=s(486353),g=s(74934),u=i.default.getLang,p=(0,m.partConfigEnabled)("invert_change_style_community_options");class C extends a.Component{constructor(e){super(e),this.onChange=e=>{var t=e.name,s=e.selected.value;this.setState((e=>({flags:s?e.flags&~t^s:e.flags&~t})))},this.onCancel=()=>{this.setState({flags:this.props.flags}),this.props.back()},this.onSave=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onSave(this.state.flags).then((()=>{this.setState({loading:!1},this.props.afterSave)})).catch((e=>{this.setState({loading:!1,flags:this.props.flags})})))},this.setFlags=e=>{this.setState({flags:e})},this.isAllowed=e=>{var t=this.props.allowedUpdateFlags;return!t||t.includes(e)},this.state={flags:e.flags,loading:!1}}render(){var e=this.state.flags,t=this.props,s=t.isChatTypeEditAllowed,i=t.isCasperChatTab,m=t.isCommunityChat,C=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return[!m&&{value:e,label:u("mail_settings_only_owner")},{value:a?s:t,label:u(m?"mail_settings_only_admins":"mail_settings_owner_and_admins")},{value:a?t:s,label:u("mail_settings_all_members")}].filter(Boolean)};return a.createElement("div",{className:"ChatSettingsOptions"},this.props.isChatCreation&&a.createElement(d.default,{flags:e,onSelectPreset:this.setFlags}),a.createElement(n.default,null,(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE))&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE,options:C(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_INVITE|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)})},a.createElement(_.default,{type:"plus",backgroundColor:"green"}),u("mail_settings_can_invite")),(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE))&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE,options:C(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_TITLE|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)})},a.createElement(_.default,{type:"pencil",backgroundColor:"blue"}),u("mail_settings_can_edit_info")),(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN))&&!i&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN,options:C(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_PIN|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)})},a.createElement(_.default,{type:"pin",backgroundColor:"blue"}),u("mail_settings_can_pin")),(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION))&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION,options:C(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_MASS_MENTION|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_MASS_MENTION)})},a.createElement(_.default,{type:"mention",backgroundColor:"blue"}),u("mail_settings_can_use_mass_mention")),(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK))&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,options:C(0,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK,g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_SEE_INVITE_LINK|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_SEE_INVITE_LINK)})},a.createElement(_.default,{type:"link",backgroundColor:"blue"}),u("mail_settings_can_see_invitation_link")),(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL))&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL,options:C(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CALL|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CALL)})},a.createElement(_.default,{type:"call",backgroundColor:"green"}),u("mail_settings_can_start_group_call")),this.isAllowed(g.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,options:[{value:0,label:u("mail_settings_only_owner")},{value:g.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS,label:u("mail_settings_owner_and_admins")}],value:e&g.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS})},a.createElement(_.default,{type:"user",backgroundColor:"green"}),u("mail_settings_admins_can_add_admins")),(this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE)||this.isAllowed(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE))&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE+g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE,options:C(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE,g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE,0,p),value:e&(g.MAIL_CHAT_FLAG_ONLY_OWNER_CAN_CHANGE_STYLE|g.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_STYLE)})},a.createElement(_.default,{type:"palette",backgroundColor:"blue"}),u("mail_settings_can_change_style")),this.isAllowed(g.MAIL_CHAT_FLAG_SERVICE_CHAT)&&s&&a.createElement(r.default,{selectable:!1,aside:a.createElement(l.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:g.MAIL_CHAT_FLAG_SERVICE_CHAT,options:[{value:0,label:u("mail_settings_service_simple")},{value:g.MAIL_CHAT_FLAG_SERVICE_CHAT,label:u("mail_settings_service_service")}],value:e&g.MAIL_CHAT_FLAG_SERVICE_CHAT})},a.createElement(_.default,{type:"gear",backgroundColor:"gray"}),u("mail_settings_service"))),a.createElement(c.default,{alignment:"right",className:"ChatSettingsOptions__submitArena"},a.createElement(o.default,{appearance:"tertiary",onClick:this.onCancel},u("global_cancel")),a.createElement(h.default,{onClick:this.onSave,loading:this.state.loading},u("global_save"))))}}},756800:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});s(176774);var a=s(667294),i=(s(45697),s(121265)),n=s(41437),r=149946368,l=0;class o extends a.Component{constructor(e){super(e),this.selectPreset=(e,t)=>{var s=3===this.state.selectedPresetId&&null!==this.state.customFlags;this.setState((e=>({selectedPresetId:t,customFlags:s?this.props.flags:e.customFlags}))),this.props.onSelectPreset(e)};var t=this.props.flags===r?2:this.props.flags===l?1:3;this.state={customFlags:3===t?this.props.flags:null,selectedPresetId:t}}componentWillReceiveProps(e){![l,r].includes(e.flags)&&this.setState({customFlags:e.flags,selectedPresetId:3})}render(){var e=this.state.customFlags?this.state.customFlags:this.props.flags,t=this.state.selectedPresetId,s="ChatSettingsPresetPanel__preset",o=[{id:1,title:(0,n.getLang)("mail_chat_creation_preset_regular"),icon:"regular",flags:l},{id:2,title:(0,n.getLang)("mail_chat_creation_preset_closed"),icon:"closed",flags:r},{id:3,title:(0,n.getLang)("mail_chat_creation_preset_custom"),icon:"custom",flags:e}];return a.createElement("div",{className:"ChatSettingsPresetPanel"},o.map(((e,n)=>a.createElement("div",{className:(0,i.classNames)(s,{[`${s}--selected`]:e.id===t}),onClick:this.selectPreset.bind(null,e.flags,e.id),key:n},a.createElement("div",{className:(0,i.classNames)("ChatSettingsPresetPanel__presetIcon",`ChatSettingsPresetPanel__presetIcon--${e.icon}`)}),a.createElement("div",{className:"ChatSettingsPresetPanel__presetTitle"},e.title)))))}}},234371:(e,t,s)=>{"use strict";s.d(t,{default:()=>h});var a=s(667294),i=s(41437),n=s(881150),r=s(423558),l=s(351605),o=i.default.getLang;class h extends a.Component{constructor(e){super(e),this.onConfirm=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onConfirm().then((()=>{this.setState({loading:!1}),this.props.onCancel()})).catch((()=>this.setState({loading:!1}))))},this.state={}}render(){return a.createElement("div",{className:"ChatSettingsResetInvitationLink"},a.createElement("div",{className:"ChatSettingsResetInvitationLink__text",dangerouslySetInnerHTML:{__html:o("mail_chat_reset_link_warning")}}),a.createElement(l.default,{alignment:"right"},a.createElement(n.default,{appearance:"tertiary",onClick:this.props.onCancel},o("global_cancel")),a.createElement(r.default,{onClick:this.onConfirm,loading:this.state.loading},o("mail_chat_reset_link_confirm"))))}}},366035:(e,t,s)=>{"use strict";s.d(t,{default:()=>n});var a=s(667294),i=(s(45697),s(121265));function n(e){return a.createElement("div",{className:(0,i.classNames)("ChatSettingsRoundedIcon",`ChatSettingsRoundedIcon--${e.type}`,`ChatSettingsRoundedIcon--${e.backgroundColor}`)})}},212311:(e,t,s)=>{"use strict";s.d(t,{mount:()=>A});var a,i=s(533246),n=s(667294),r=s(973935),l=s(126764),o=s(389430),h=s(929566),c=s(907851),_=s(236205);function d(e,t){var s=ls.get("im_chats_no_invite_link_history")||[],a=e-2e9,i=t?s.filter((e=>e!==a)):s.concat(a);ls.set("im_chats_no_invite_link_history",i)}function m(e,t){var s=p(),a=function(e){var t=(0,_.getPeer)(e)-2e9;return!(ls.get("im_chats_no_invite_link_history")||[]).includes(t)}(e);s&&r.render(n.createElement(l.ChatSettings,{store:e,closePopup:g.bind(null,e),updatePopup:u,isLinkWithHistorySelected:a,updateHistoryLinkState:d,parentMutations:t}),s)}function g(e){a&&a.hide();var t=e.get();t.hasOwnProperty("onClose")&&t.onClose()}function u(){a&&a.updateBoxCoords()}function p(){return document.querySelector("#ChatSettings")}function C(e){var t=document.querySelector("#box_layer_wrap"),s=document.querySelector("#box_loader"),a=isVisible(t);return{unmount(){var t=p();t&&r.unmountComponentAtNode(t),(0,i.destroyModule)(e)},showLoader(){boxRefreshCoords(s),show(s),a||show(t)},hideLoader(){hide(s),a||hide(t)}}}function A(e,t,s){var n=(0,i.createMutations)(C).bindMutations,r=t.get(),l=(0,i.createModule)({handlers:(e,t)=>{}}),_=r.peer,d=n(l);var u=function(e,t){t.get().peer===_?function(e,t){var s=(0,h.getTab)(e,e.get().peer);s&&s.data&&(0,h.isChatActive)(s)?m(e,t):g(e)}(t,s):e.unmount()}.bind(null,d),p={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:560,onShow(){m(t,s),t.subscribe(u),requestAnimationFrame((()=>a.updateBoxCoords()))},onHideAttempt:()=>(t.unsubscribe(u),d.unmount(),!0)};return d.showLoader(),t.set(o.getChatDetails.bind(null,_)).then((e=>{d.hideLoader();var t=(0,c.unpackStore)(e).peer;t&&t===_?a=new MessageBox(p).content('<div id="ChatSettings" class="ChatSettingsWrapper"></div>').show():d.unmount()})),d}},151223:(e,t,s)=>{"use strict";s.d(t,{kickUserOptimistically:()=>i});var a=s(351117);function i(e,t,s){var i=(0,a.getTab)(e,t);return i&&(0,a.isChatConvo)(i)?(i.memberIds=i.memberIds.filter((function(e){return e!==s})),i.adminIds=i.adminIds.filter((function(e){return e!==s})),i.membersCount=i.memberIds.length,Promise.resolve(e)):Promise.reject("No chat info")}}}]);try{stManager.done("dist/902866c362380432bb8fab2a5e67d693.95b0693bd085c8e2ca6e.js")}catch(e){}