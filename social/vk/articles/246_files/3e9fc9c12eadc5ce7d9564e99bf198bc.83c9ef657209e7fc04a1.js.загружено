(self.webpackChunkvk=self.webpackChunkvk||[]).push([[1690],{464380:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Api:()=>Jt,BaseApi:()=>m,BaseLogger:()=>_,BaseSignaling:()=>y,CallType:()=>E,ChatRoomEventType:()=>C,ConversationOption:()=>R,DebugMessageType:()=>oe,ExternalIdType:()=>$e,HangupReason:()=>ct,HangupType:()=>A,MediaOption:()=>k,MediaType:()=>ze,ParticipantStatus:()=>Q,Signaling:()=>Zt,SignalingCommandType:()=>Xt,SignalingConnectionType:()=>N,UserRole:()=>U,Utils:()=>pe,acceptCall:()=>hn,addParticipant:()=>yn,addParticipantInternal:()=>Sn,authorize:()=>ln,browser:()=>tn,callInternal:()=>un,callTo:()=>cn,captureScreen:()=>bn,changeConversationOptions:()=>Gn,changeDevice:()=>Cn,changeParticipantState:()=>On,changePriorities:()=>An,changeVideoEffect:()=>or,chatHistory:()=>Wn,chatMessage:()=>Bn,chatMessageInternal:()=>Hn,createJoinLink:()=>Jn,customData:()=>qn,customDataInternal:()=>Kn,debug:()=>rr,debugMessage:()=>ir,declineCall:()=>fn,forceRelayPolicy:()=>Qn,getAnonymTokenByLink:()=>Yn,getStreamInfo:()=>tr,getWaitingHall:()=>sr,grantRoles:()=>Dn,grantRolesInternal:()=>Nn,hangup:()=>gn,init:()=>sn,joinCall:()=>vn,joinCallByLink:()=>_n,joinCallInternal:()=>mn,muteParticipant:()=>Mn,muteParticipantInternal:()=>Ln,pinParticipant:()=>jn,pinParticipantInternal:()=>Vn,processPush:()=>dn,processPushInternal:()=>pn,promoteParticipant:()=>cr,removeJoinLink:()=>zn,removeParticipant:()=>En,removeParticipantInternal:()=>Tn,setApi:()=>nn,setAudioStream:()=>ar,setLocalResolution:()=>Pn,setLogger:()=>on,setMediaModifiers:()=>Fn,setSignalingFactory:()=>rn,setStatisticsInterval:()=>nr,setVideoEffects:()=>an,setVideoStream:()=>Rn,setVolume:()=>Xn,startConversation:()=>$n,startStream:()=>Zn,stopStream:()=>er,toggleLocalAudio:()=>In,toggleLocalVideo:()=>wn,unmuteRequest:()=>xn,unmuteRequestInternal:()=>Un,updateDisplayLayout:()=>kn});n(545580);var r=n(224736),i=n.n(r),o=n(535557),a=n(406257),s=n.n(a),c="2.4.2",u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function d(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function l(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function h(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function f(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var v,m=function(){function e(){}return e.prototype.createJoinLink=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,{join_link:"nop"}]}))}))},e.prototype.removeJoinLink=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,{success:!0}]}))}))},e.prototype.getAnonymTokenByLink=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,""]}))}))},e.prototype.log=function(e){},e.prototype.prepareUserIds=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2]}))}))},e.prototype.getCachedOkIdByExternalId=function(e){return null},e.prototype.cacheExternalId=function(e,t){},e.prototype.hangupConversation=function(e){},e.prototype.cleanup=function(){},e}(),_=function(){function e(){}return e.prototype.log=function(e,t,n){},e.prototype.destroy=function(){},e}(),g=function(){function e(){this._handlers={},this._listeners=[]}return e.prototype._triggerEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this._handlers.hasOwnProperty(e))for(var r=0,i=this._handlers[e];r<i.length;r++){var o=i[r];setTimeout.apply(void 0,f([o,0],t))}},e.prototype.addEventListener=function(e,t){if("function"!=typeof t)throw new Error("Listener should be a function");return this._handlers.hasOwnProperty(e)||(this._handlers[e]=[]),this._handlers[e].push(t),{dispose:this.removeEventListener.bind(this,e,t)}},e.prototype.removeEventListener=function(e,t){if(this._handlers.hasOwnProperty(e)){t||delete this._handlers[e];var n=this._handlers[e].indexOf(t);n>=0&&this._handlers[e].splice(n,1)}},e.prototype.subscribe=function(e,t,n){var r=e.addEventListener(t,n);this._listeners.push(r)},e.prototype.unsubscribe=function(){this._listeners.forEach((function(e){e.dispose()}))},e}(),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),Object.defineProperty(t.prototype,"ready",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.setParticipantIdRegistry=function(e){},t.prototype.requestRealloc=function(){},t.prototype.setEndpoint=function(e){},t.prototype.setConversationId=function(e){},t.prototype.readyToSend=function(){},t.prototype.cleanup=function(){},t.prototype.requestTestMode=function(e){},t.prototype.getNextCommandSequenceNumber=function(){return 0},t}(g);!function(e){e.USER="USER",e.GROUP="GROUP",e.CHAT="CHAT"}(v||(v={}));var S,E=v;!function(e){e.ATTENDEE="ATTENDEE",e.HAND_UP="HAND_UP"}(S||(S={}));var T,C=S;!function(e){e.REQUIRE_AUTH_TO_JOIN="REQUIRE_AUTH_TO_JOIN",e.AUDIENCE_MODE="AUDIENCE_MODE",e.WAITING_HALL="WAITING_HALL"}(T||(T={}));var b,R=T;!function(e){e.CAMERA_PERMISSION="camera",e.MIC_PERMISSION="mic",e.CAMERA_ACCESS="cameralock",e.MIC_ACCESS="miclock",e.MIC_NOT_FOUND="nomic",e.SCREEN_PERMISSION="screenpermission",e.SCREEN_ACCESS="screenlock",e.CONNECTION="connection",e.NETWORK="network",e.UNKNOWN="unknown",e.UNSUPPORTED="unsupported",e.SIGNALING_FAILED="signalingfailed",e.API="api",e.AUTH="auth"}(b||(b={}));var w,I=b;!function(e){e.CANCELED="CANCELED",e.REJECTED="REJECTED",e.REMOVED="REMOVED",e.HUNGUP="HUNGUP",e.MISSED="MISSED",e.BUSY="BUSY",e.FAILED="FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.CALLER_IS_BLOCKED="CALLER_IS_BLOCKED",e.NOT_FRIENDS="NOT_FRIENDS",e.CALLEE_IS_OFFLINE="CALLEE_IS_OFFLINE",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED="UNSUPPORTED",e.OLD_VERSION="OLD_VERSION",e.SERVICE_DISABLED="SERVICE_DISABLED",e.EXTERNAL_API_ERROR="EXTERNAL_API_ERROR",e.SOCKET_CLOSED="SOCKET_CLOSED",e.ENDED="ENDED"}(w||(w={}));var P,A=w;!function(e){e.AUDIO="AUDIO",e.VIDEO="VIDEO",e.SCREEN_SHARING="SCREEN_SHARING"}(P||(P={}));var O,k=P;!function(e){e.START="start",e.ACCEPT="accept",e.JOIN="join",e.RETRY="retry"}(O||(O={}));var D,N=O;!function(e){e.NO_AVAILABLE_TRACKS="no-available-tracks",e.UNKNOWN_ERROR="unknown-error"}(D||(D={}));var M,L=D;function x(e){switch(e){case 1:return D.NO_AVAILABLE_TRACKS;default:return D.UNKNOWN_ERROR}}!function(e){e.CREATOR="CREATOR",e.ADMIN="ADMIN"}(M||(M={}));var U=M;function j(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.includes(i))return!1}return!0}var V,F,G,B=function(){function e(){this._items=[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this._items.push(e)},e.prototype.shift=function(){return this._items.shift()||null},e.prototype.bisect=function(){var e=this.length>1?Math.floor(this.length/2):1;this._items=this._items.slice(e)},e.prototype.clear=function(){this._items=[]},e.prototype.toString=function(){return this._items.length?JSON.stringify(this._items,(function(e,t){return t instanceof Error?String(t):t})):""},e}(),H=function(){function e(){this._items=[],this._itemsSize=0,this._storageSize=2097152;try{for(var e=window.localStorage,t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if(0===r.indexOf("_okcls_logs_session_")){var i=e.getItem(r);if(i){var o=q(i);this.add(r,o)}else K(r)}}}catch(e){console.error("Storage is blocked",e),this._storageSize=0}this._items.sort((function(e,t){return e.date-t.date})),this.cleanup(102400)}return Object.defineProperty(e.prototype,"size",{get:function(){return this._itemsSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"available",{get:function(){return Math.max(this._storageSize-this._itemsSize,0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storageSize",{set:function(e){this._storageSize=e},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t){var n=parseInt(e.replace("_okcls_logs_session_",""),10);this._itemsSize+=t,this._items.push({key:e,size:t,date:n})},e.prototype.deleteOldestItem=function(){var e=this._items.shift();e&&(K(e.key),this._itemsSize-=e.size)},e.prototype.cleanup=function(e){for(;this.length&&(this.size>2097152||this.length>4||this.size+e>this.available);)this.deleteOldestItem()},e}();function W(){return"_okcls_logs_session_"+Date.now()}function q(e){return new Blob([e]).size}function K(e){try{window.localStorage.removeItem(e)}catch(e){console.error("Failed to remove log from storage",e)}}function $(){var e=F.toString();if(V.available&&e){var t=q(e);V.cleanup(t);try{window.localStorage.setItem(G,e)}catch(e){return console.warn("Failed to write log to storage",e),V.storageSize=V.size+t,V.cleanup(102400+t),V.available>=102400+t?void $():t>102400?(F.bisect(),void $()):void(V.storageSize=0)}t>524288&&(V.add(G,t),G=W(),F.clear(),V.cleanup(102400))}}function J(){V.available&&F.length&&$()}function z(e,t){V.available&&(F.push({t:Date.now(),l:e,d:t}),X||(X=window.setTimeout((function(){X=null,J()}),3e4)))}function Y(){V||(V=new H,F=new B,G=W(),window.addEventListener("beforeunload",J))}var X=null;window.__VKCallsSDKLogs__=function(e){return void 0===e&&(e=!1),V||Y(),J(),function(e){void 0===e&&(e=!1);var t=[];try{for(var n=window.localStorage,r=0,i=V.items;r<i.length;r++){var o=i[r],a=n.getItem(o.key);t.push(a)}var s=F.toString();s&&t.push(s)}catch(e){console.error("Storage is blocked",e)}var c="["+t.join(",")+"]";if(e)return c;var u,d,p,l,h="logs_"+Date.now()+".json";return u=c,d=h,p=document.createElement("a"),l=new Blob([u],{type:"text/json"}),p.href=URL.createObjectURL(l),p.download=d,p.click(),h}(e)};var Q,Z,ee=function(){function e(){}return Object.defineProperty(e,"sessionKey",{get:function(){return e._sessionKey},set:function(t){e._sessionKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"sessionSecretKey",{get:function(){return e._sessionSecretKey},set:function(t){e._sessionSecretKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"accessToken",{get:function(){return e._accessToken},set:function(t){e._accessToken=t},enumerable:!1,configurable:!0}),e.isEmpty=function(){return!e._sessionKey||!e._sessionSecretKey},e}(),te=function(){function e(){}return e.set=function(t){t.hasOwnProperty("voiceParams")&&(Object.assign(e._params.voiceParams,t.voiceParams),delete t.voiceParams),t.hasOwnProperty("specListenerParams")&&(Object.assign(e._params.specListenerParams,t.specListenerParams),delete t.specListenerParams),t.hasOwnProperty("unifiedPlanBrowsers")&&(Object.assign(e._params.unifiedPlanBrowsers,t.unifiedPlanBrowsers),delete t.unifiedPlanBrowsers),t.hasOwnProperty("apiAuth")&&(ee.accessToken=t.apiAuth.accessToken,ee.sessionKey=t.apiAuth.sessionKey,ee.sessionSecretKey=t.apiAuth.sessionSecretKey),Object.assign(e._params,t)},e.get=function(t){return e._params[t]},Object.defineProperty(e,"appName",{get:function(){return e._params.appName},enumerable:!1,configurable:!0}),Object.defineProperty(e,"appVersion",{get:function(){return e._params.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"protocolVersion",{get:function(){return e._params.protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"platform",{get:function(){return e._params.platform},set:function(t){e._params.platform=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"clientType",{get:function(){return e._params.clientType},set:function(t){e._params.clientType=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"device",{get:function(){return e._params.device},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiAppId",{get:function(){return e._params.apiAppId},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiKey",{get:function(){return e._params.apiKey},enumerable:!1,configurable:!0}),Object.defineProperty(e,"apiEnv",{get:function(){switch(e._params.apiEnv){case"TEST":return{api:"https://apitest.ok.ru/api/",connect:"https://test.ok.ru/"};case"VIDEOTEST":return{api:"https://videotestapi.ok.ru/api/",connect:"https://test.ok.ru/"};case"DEV":return{api:"https://1.api.an-eremeev.devdc.odkl.ru/api/",connect:"https://1.web.an-eremeev.devdc.odkl.ru/"};default:return{api:"https://api.ok.ru/",connect:"https://connect.ok.ru/"}}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"authToken",{get:function(){return e._params.authToken},set:function(t){e._params.authToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"anonymToken",{get:function(){return e._params.anonymToken},set:function(t){e._params.anonymToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"domain",{get:function(){return e._params.domain},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceServers",{get:function(){return e._params.iceServers},set:function(t){e._params.iceServers=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssBase",{get:function(){return e._params.wssBase},set:function(t){e._params.wssBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"wssToken",{get:function(){return e._params.wssToken},set:function(t){e._params.wssToken=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectDelay",{get:function(){return e._params.signalingReconnectDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxDelay",{get:function(){return e._params.signalingReconnectMaxDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"signalingReconnectMaxCount",{get:function(){return e._params.signalingReconnectMaxCount},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitConnectionDelay",{get:function(){return e._params.waitConnectionDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitResponseDelay",{get:function(){return e._params.waitResponseDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"waitMessageDelay",{get:function(){return e._params.waitMessageDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e,"debugLog",{get:function(){return e._params.debugLog},enumerable:!1,configurable:!0}),Object.defineProperty(e,"forceRelayPolicy",{get:function(){return e._params.forceRelayPolicy},set:function(t){e._params.forceRelayPolicy=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinWidth",{get:function(){return e._params.videoMinWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxWidth",{get:function(){return e._params.videoMaxWidth},set:function(t){e._params.videoMaxWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMinHeight",{get:function(){return e._params.videoMinHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoMaxHeight",{get:function(){return e._params.videoMaxHeight},set:function(t){e._params.videoMaxHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoAspectRatio",{get:function(){return e._params.videoAspectRatio},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFrameRate",{get:function(){return e._params.videoFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoFacingMode",{get:function(){return e._params.videoFacingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e,"screenFrameRate",{get:function(){return e._params.screenFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoEffects",{get:function(){return e._params.videoEffects},set:function(t){e._params.videoEffects=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoEffectMaxWidth",{get:function(){return e._params.videoEffectMaxWidth},set:function(t){e._params.videoEffectMaxWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoEffectMaxHeight",{get:function(){return e._params.videoEffectMaxHeight},set:function(t){e._params.videoEffectMaxHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"voiceParams",{get:function(){return e._params.voiceParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"specListenerParams",{get:function(){return e._params.specListenerParams},enumerable:!1,configurable:!0}),Object.defineProperty(e,"iceRestartWaitTime",{get:function(){return e._params.iceRestartWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"transportConnectionWaitTime",{get:function(){return e._params.transportConnectionWaitTime},enumerable:!1,configurable:!0}),Object.defineProperty(e,"statisticsInterval",{get:function(){return e._params.statisticsInterval},set:function(t){e._params.statisticsInterval=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"networkStatisticsInterval",{get:function(){return e._params.networkStatisticsInterval},enumerable:!1,configurable:!0}),Object.defineProperty(e,"perfStatReportEnabled",{get:function(){return e._params.perfStatReportEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerNotificationDataChannel",{get:function(){return e._params.producerNotificationDataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerCommandDataChannel",{get:function(){return e._params.producerCommandDataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(e,"consumerScreenDataChannel",{get:function(){return e._params.consumerScreenDataChannel},set:function(t){e._params.consumerScreenDataChannel=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerScreenDataChannel",{get:function(){return e._params.producerScreenDataChannel&&e._params.producerNotificationDataChannel},set:function(t){e._params.producerScreenDataChannel=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"noiseSuppression",{get:function(){return e._params.noiseSuppression},set:function(t){e._params.noiseSuppression=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"preferH264",{get:function(){return e._params.preferH264},enumerable:!1,configurable:!0}),Object.defineProperty(e,"preferVP9",{get:function(){return e._params.preferVP9},enumerable:!1,configurable:!0}),Object.defineProperty(e,"audioNack",{get:function(){return e._params.audioNack},enumerable:!1,configurable:!0}),Object.defineProperty(e,"consumerScreenTrack",{get:function(){return e._params.consumerScreenTrack&&e._params.consumerScreenDataChannel},enumerable:!1,configurable:!0}),Object.defineProperty(e,"producerScreenTrack",{get:function(){return e._params.producerScreenTrack&&e._params.producerScreenDataChannel},enumerable:!1,configurable:!0}),e.isUnifiedPlanSupported=function(t,n){var r=e._params.unifiedPlanBrowsers;return!!r.hasOwnProperty(t)&&n>=r[t]},Object.defineProperty(e,"onDemandTracks",{get:function(){return e._params.onDemandTracks},enumerable:!1,configurable:!0}),Object.defineProperty(e,"videoTracksCount",{get:function(){return e._params.videoTracksCount},enumerable:!1,configurable:!0}),Object.defineProperty(e,"breakVideoPayloadTypes",{get:function(){return e._params.breakVideoPayloadTypes},enumerable:!1,configurable:!0}),Object.defineProperty(e,"filteredMessages",{get:function(){return e._params.filteredMessages},enumerable:!1,configurable:!0}),Object.defineProperty(e,"batchParticipantsOnStart",{get:function(){return e._params.batchParticipantsOnStart},enumerable:!1,configurable:!0}),Object.defineProperty(e,"participantStateMapped",{get:function(){return e._params.participantStateMapped},enumerable:!1,configurable:!0}),e._params={appName:"ok.calls.sdk.js",appVersion:1.1,protocolVersion:5,platform:"WEB",clientType:"PORTAL",device:"browser",apiAppId:42,apiKey:"",authToken:"",anonymToken:"",apiEnv:"PROD",domain:"",iceServers:[],wssBase:"",wssToken:"",signalingReconnectDelay:1e3,signalingReconnectMaxDelay:5e3,signalingReconnectMaxCount:20,waitConnectionDelay:1e4,waitResponseDelay:1e4,waitMessageDelay:15e3,debugLog:!1,forceRelayPolicy:!1,videoMinWidth:428,videoMinHeight:240,videoMaxWidth:1280,videoMaxHeight:720,videoAspectRatio:16/9,videoFrameRate:25,screenFrameRate:15,videoEffects:null,videoEffectMaxWidth:640,videoEffectMaxHeight:360,iceRestartWaitTime:2e4,transportConnectionWaitTime:5e3,statisticsInterval:5e3,networkStatisticsInterval:2e4,perfStatReportEnabled:!0,voiceParams:{smoothing:.8,minFreq:200,maxFreq:5e3,interval:500,threshold:.35,speakerLevelMultiplier:1.8},specListenerParams:{connectionTimeout:1e4,volumeTimeout:1e4},unifiedPlanBrowsers:{Firefox:10,Chrome:76,Safari:12},producerNotificationDataChannel:!0,producerCommandDataChannel:!0,consumerScreenDataChannel:!0,producerScreenDataChannel:!0,noiseSuppression:!0,preferH264:!1,preferVP9:!0,audioNack:!0,consumerScreenTrack:!1,producerScreenTrack:!1,onDemandTracks:!1,videoTracksCount:0,filteredMessages:!1,breakVideoPayloadTypes:!1,batchParticipantsOnStart:!1,participantStateMapped:!1},e}();function ne(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=te.get(e);r&&setTimeout.apply(void 0,f([r,0],t))}function re(e){return Object.assign({},e)}function ie(e){return e.slice()}!function(e){e.WAITING_HALL="WAITING_HALL",e.WAITING="WAITING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECT="RECONNECT",e.ERROR="ERROR",e.HANGUP="HANGUP",e.PERMISSIONS="PERMISSIONS"}(Q||(Q={})),function(e){e.onLocalStream=function(e,t){ne("onLocalStream",e,re(t))},e.onScreenStream=function(e,t){ne("onScreenStream",e,re(t))},e.onLocalStreamUpdate=function(e,t){ne("onLocalStreamUpdate",re(e),t)},e.onLocalStatus=function(e){ne("onLocalStatus",e)},e.onRemoteStream=function(e,t){ne("onRemoteStream",e,t)},e.onRemoteLive=function(e,t,n){ne("onRemoteLive",e,t,n)},e.onRemoteScreenStream=function(e,t){ne("onRemoteScreenStream",e,t)},e.onConversation=function(e,t,n){ne("onConversation",e,re(t),n)},e.onRemoteMediaSettings=function(e,t){ne("onRemoteMediaSettings",e,re(t))},e.onRemoteParticipantState=function(e,t){ne("onRemoteParticipantState",e,re(t))},e.onParticipantStatus=function(e,t,n){void 0===n&&(n=null),ne("onParticipantStatus",e,t,n)},e.onPermissionsRequested=function(){ne("onPermissionsRequested")},e.onPermissionsError=function(e){ne("onPermissionsError",e)},e.onRemoteRemoved=function(e){ne("onRemoteRemoved",e)},e.onCallState=function(e,t,n){ne("onCallState",e,t,re(n))},e.onDeviceSwitched=function(e,t){ne("onDeviceSwitched",e,t)},e.onUnmuteRequest=function(e){ne("onUnmuteRequest",e)},e.onUnmutePermission=function(e){ne("onUnmutePermission",e)},e.onRolesChanged=function(e,t){ne("onRolesChanged",e,ie(t))},e.onLocalRolesChanged=function(e){ne("onLocalRolesChanged",ie(e))},e.onPinnedParticipant=function(e,t){ne("onPinnedParticipant",e,t)},e.onLocalPin=function(e){ne("onLocalPin",e)},e.onOptionsChanged=function(e){ne("onOptionsChanged",ie(e))},e.onCallAccepted=function(){ne("onCallAccepted")},e.onRateNeeded=function(){ne("onRateNeeded")},e.onSpeakerChanged=function(e){ne("onSpeakerChanged",e)},e.onVolumesDetected=function(e){ne("onVolumesDetected",ie(e))},e.onLocalVolume=function(e,t){ne("onLocalVolume",e,t)},e.onJoinStatus=function(e,t){ne("onJoinStatus",e,t)},e.onHangup=function(e,t){ne("onHangup",e,t)},e.onMultipartyChatCreated=function(e){ne("onMultipartyChatCreated",re(e))},e.onDeviceChange=function(){ne("onDeviceChange")},e.onFingerprintChange=function(e){ne("onFingerprintChange",e)},e.onTokenExpired=function(){ne("onTokenExpired")},e.onChatMessage=function(e,t,n){void 0===n&&(n=!1),ne("onChatMessage",e,t,n)},e.onCustomData=function(e,t,n){void 0===n&&(n=!1),ne("onCustomData",e,t,n)},e.onRecordStarted=function(e,t,n,r,i,o){ne("onRecordStarted",e,t,n,r,i,o)},e.onRecordStopped=function(){ne("onRecordStopped")},e.onLocalNetworkStatusChanged=function(e){ne("onLocalNetworkStatusChanged",e)},e.onNetworkStatusChanged=function(e){ne("onNetworkStatusChanged",e)},e.onDebugMessage=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];ne.apply(void 0,f(["onDebugMessage",e],t))},e.onStatistics=function(e,t){ne("onStatistics",Object.assign({},e,{memory:t}))},e.onAutoplayError=function(){ne("onAutoplayError")},e.onChatRoomUpdated=function(e,t,n){ne("onChatRoomUpdated",e,t,n)}}(Z||(Z={}));var oe,ae,se=Z;!function(e){e.DEBUG="DEBUG",e.LOG="LOG",e.WARN="WARN",e.ERROR="ERROR"}(oe||(oe={})),function(e){var t="����",n=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];se.onDebugMessage.apply(se,f([e],t))},r=!1,i=function(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];e.apply(void 0,n),z(t,n)}},o=console.debug.bind(console,t),a=console.log.bind(console,t),s=console.warn.bind(console,t),c=console.error.bind(console,t),u=n.bind(null,oe.DEBUG),d=n.bind(null,oe.LOG),p=n.bind(null,oe.WARN),l=n.bind(null,oe.ERROR);e.debug=u,e.log=d,e.warn=p,e.error=l,e.enabled=function(){return r},e.toggle=function(t){r=t,te.debugLog&&Y(),t?(e.debug=te.debugLog?i(o,oe.DEBUG):o,e.log=te.debugLog?i(a,oe.LOG):a,e.warn=te.debugLog?i(s,oe.WARN):s,e.error=te.debugLog?i(c,oe.ERROR):c):(e.debug=te.debugLog?i(u,oe.DEBUG):u,e.log=te.debugLog?i(d,oe.LOG):d,e.warn=te.debugLog?i(p,oe.WARN):p,e.error=te.debugLog?i(l,oe.ERROR):l)},e.send=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];switch(t){case oe.DEBUG:e.debug.apply(void 0,n);break;case oe.LOG:e.log.apply(void 0,n);break;case oe.WARN:e.warn.apply(void 0,n);break;case oe.ERROR:e.error.apply(void 0,n)}}}(ae||(ae={}));var ce,ue=ae;!function(e){e.patchSDP=function(e,t,n,r,i){void 0===i&&(i=!1);var o=/[\r\n]+/,a="\r\n";if(!t&&!n&&!r)return i?s(e.split(o)).join(a):e;function s(e){var t=e.findIndex((function(e){return e.startsWith("a=rtcp-fb:111")}));return~t&&(e[t]=e[t]+a+["a=rtcp-fb:111 nack","a=rtcp-fb:111 nack pli"].join(a)),e}function c(e,t,n){var r,i=e.split(" "),o=i.slice(0,3);for(r=3;r<i.length;r++)n.includes(i[r])&&o.push(i[r]);for(r=3;r<i.length;r++)n.includes(i[r])||t.includes(i[r])||o.push(i[r]);return o.join(" ")}function u(e,t){var n,r=new RegExp("a=rtpmap:(\\d+) ([a-zA-Z0-9-]+)\\/\\d+"),i=[];for(n=0;n<e.length;++n){var o=e[n].match(r);o&&3===o.length&&o[2]===t&&i.push(o[1])}return i}function d(e,t,n,r){var i,o="m="+t;for(i=0;i<e.length;++i)if(e[i].startsWith(o)){e[i]=c(e[i],n,r);break}}var p=[],l=e.split(o);(n||t)&&(p=u(l,"H264"));var h=[];if(r&&(h=u(l,"VP9")),n){var f=p.slice(0),v=new RegExp("a=fmtp:(\\d+) apt=(\\d+)"),m=void 0;for(m=0;m<l.length;++m)(g=l[m].match(v))&&3===g.length&&f.includes(g[2])&&f.push(g[1]);var _=new RegExp("a=(rtpmap|rtcp-fb|fmtp):(\\d+) .*");for(m=l.length;m--;){var g;(g=l[m].match(_))&&3===g.length&&f.includes(g[2])&&l.splice(m,1)}d(l,"video",f,[])}else t&&d(l,"video",[],p);return r&&d(l,"video",[],h),i&&s(l),l.join(a)},e.getPeerIdString=function(e){return e?(e.type||"WEB_SOCKET")+"_"+e.id:"_"},e.comparePeerId=function(e,t){return e&&e.id===t.id&&(e.type||"WEB_SOCKET")===(t.type||"WEB_SOCKET")},e.getPeerConnectionHostInfo=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return e&&e.getStats?[2,e.getStats(null).then((function(e){var t=null,n=null;if(e.forEach((function(t){"transport"===t.type&&t.selectedCandidatePairId?n=e.get(t.selectedCandidatePairId):"candidate-pair"!==t.type||"succeeded"!==t.state||n||t.hasOwnProperty("selected")&&!t.selected||(n=t)})),n&&n.localCandidateId){var r=e.get(n.localCandidateId);r&&(t={type:r.candidateType,ip:r.ip||r.ipAddress,port:r.port||r.portNumber})}return t})).catch((function(){return null}))]:[2,Promise.resolve(null)]}))}))};var t=/^[0-9]+$/,n=/^([gu])([0-9]+)$/;function r(e,r){var i=String(e);return n.test(i)?(ue.warn("Already composite id ["+e+"] type supplied ["+r+"]"),i):"GROUP"===r?"g"+i:"USER"===r?"u"+i:(ue.warn("Unknown type ["+r+"] for id ["+e+"]"),i.match(t)?"u"+i:i)}function o(e){return r(e.id,e.idType||"USER")}function a(e,t,n,r,i){if(e&&n&&"video"===n.kind){var o=n.getSettings();if(o){var a=e.maxBitrateK?1024*e.maxBitrateK:null,s=o.width,c=o.height,u=s&&c&&e.maxDimension?Math.max(1,Math.max(s,c)/e.maxDimension):null,d=e.maxFramerate?e.maxFramerate:null,p=e.degradationPreference?e.degradationPreference:"balanced",l=r[n.id];if(l&&l.bitrate===a&&l.scaleResolutionDownBy===u&&l.maxFramerate===d&&l.degradationPreference===p)return void(i[n.id]=l);i[n.id]={bitrate:a,scaleResolutionDownBy:u,maxFramerate:d,degradationPreference:p};var h=t.getParameters();h.encodings||(h.encodings=[{}]),h.encodings.forEach((function(e){a?e.maxBitrate=a:delete e.maxBitrate,u?e.scaleResolutionDownBy=u:delete e.scaleResolutionDownBy,d?e.maxFramerate=d:delete e.maxFramerate})),h.degradationPreference=p,t.setParameters(h)}}}e.composeId=r,e.composeParticipantId=o,e.composeMessageId=function(e){return e.participant?o(e.participant):r(e.participantId,e.participantType||"USER")},e.decomposeId=function(e){var t=String(e),r=t.match(n);return r?{id:Number(r[2]),type:"g"===r[1]?"GROUP":"USER"}:(ue.warn("Unsupported compositeId ["+e+"]"),{id:Number(t),type:"USER"})},e.uuid=function(){var e,t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),i=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,r[t]=n[19===t?3&e|8:e]);return r.join("")},e.throttle=function(e,t){var n;return function(){var r=this,i=arguments;n&&window.clearTimeout(n),n=window.setTimeout((function(){e.apply(r,i)}),t)}},e.sdpFingerprint=function(e){for(var t="",n=0,r=e.split("\n");n<r.length;n++){var o=r[n];if(o.startsWith("a=fingerprint")){var a=o.split(" ");if(2===a.length){t=a[1];break}}}if(!t)return i().minusOne;for(var s=t.split(":"),c=i().zero,u=Math.min(7,s.length-1);u>=0;u--){var d=i()(s[u],16);c=c.shiftLeft(8).or(d)}return function(e,t){var n=t.value;if("bigint"==typeof n)return i()(BigInt.asIntN(64,n));var r=i().one.shiftLeft(64),o=t.and(r.subtract(1));return o.greaterOrEquals(r.subtract(o))?o.subtract(r):o}(0,c)},e.delay=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,new Promise((function(t){return window.setTimeout(t,e)}))]}))}))},e.applySettings=function(e,t,n){var r=[];return e.getSenders().forEach((function(e){return a(t,e,e.track,n,r)})),r},e.applyVideoTrackSettings=a,e.includesOneOf=function(e,t){Array.isArray(t)||(t=[t]);for(var n=0,r=t;n<r.length;n++){var i=r[n];if(e.includes(i))return!0}return!1},e.mapParticipantState=function(e){var t;return Object.entries((null===(t=e.participantState)||void 0===t?void 0:t.state)||{}).reduce((function(t,n){var r=n[0],i=n[1];return e.participantState&&(t[r]={ts:e.participantState.stateUpdateTs[r],state:i}),t}),{})},e.mapLegacyParticipantState=function(e){return Object.entries(e).reduce((function(e,t){var n=t[0],r=t[1].state;return e[n]=r,e}),{})},e.mapSharedParticipants=function(e){return e.map((function(e){var t={uid:e.externalId,mediaSettings:e.mediaSettings,status:Q.WAITING};return te.participantStateMapped&&(t.participantState=e.participantState),t}))},e.isEqualParticipantState=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!r.hasOwnProperty(a))return!1;if(e[a].state!==t[a].state)return!1;if(e[a].ts!==t[a].ts)return!1}return!0}}(ce||(ce={}));var de,pe=ce,le=function(){try{var e,t=Date.now().toString(),n=window.localStorage;return n.setItem(t,t),e=n.getItem(t)===t,n.removeItem(t),e?n:null}catch(e){return null}}();!function(e){e.get=function(e){return function(e){var t=le?le.getItem("_okcls_"+e):null;if(null===t)return null;try{return JSON.parse(t)}catch(e){return null}}(e)||null},e.set=function(e,t){!function(e,t){try{le&&le.setItem("_okcls_"+e,JSON.stringify(t))}catch(e){}}(e,t)},e.remove=function(e){!function(e){le&&le.removeItem("_okcls_"+e)}(e)}}(de||(de={}));var he,fe,ve,me,_e=de,ge=null,ye=null,Se=[],Ee=[],Te=[],Ce=null,be=null,Re=null,we=!1,Ie=!1,Pe=!1,Ae=!1,Oe=null,ke="",De=[],Ne=null,Me=navigator.appVersion,Le=navigator.appName,xe=navigator.userAgent;!function(e){e.USER="user",e.ENVIRONMENT="environment",e.LEFT="left",e.RIGHT="right"}(me||(me={}));var Ue,je=function(){function e(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=te.videoMaxWidth),void 0===r&&(r=te.videoMaxHeight);var i=!1;if(e){i={noiseSuppression:te.noiseSuppression,echoCancellation:!0,autoGainControl:!0};var o=void 0;be&&(o=be.deviceId),"string"==typeof e&&(o=e),o&&(i.deviceId={exact:o})}var a=!1;if(t){a={width:{min:te.videoMinWidth,max:n,ideal:n},height:{min:te.videoMinHeight,max:r,ideal:r},aspectRatio:{ideal:te.videoAspectRatio},frameRate:{ideal:te.videoFrameRate}};var s=void 0;Ce&&(s=Ce.deviceId),"string"==typeof t&&(s=t),s&&(a.deviceId={exact:s}),te.videoFacingMode&&(a.facingMode={exact:te.videoFacingMode})}this.audio=i,this.video=a,this.needVideo=!!a}return e.prototype.getNative=function(){return Object.assign({},{audio:this.audio,video:this.video})},e.prototype.simplify=function(){return"object"==typeof this.video&&(this.video.width||this.video.height?(delete this.video.width,delete this.video.height):this.video.aspectRatio?delete this.video.aspectRatio:this.video.frameRate?delete this.video.frameRate:(this.video.deviceId||this.video.facingMode)&&(delete this.video.deviceId,delete this.video.facingMode)),"object"==typeof this.audio&&(this.audio.echoCancellation||this.audio.autoGainControl||this.audio.noiseSuppression?(delete this.audio.echoCancellation,delete this.audio.autoGainControl,delete this.audio.noiseSuppression):this.audio.deviceId&&delete this.audio.deviceId),!0===this.video&&!0===this.audio?this.video=!1:!1===this.video&&!0===this.audio?(this.audio=!1,this.video=this.needVideo):!0===this.video&&!1===this.audio&&(this.video=!1),this.video&&!Object.keys(this.video).length&&(this.video=!0),this.audio&&!Object.keys(this.audio).length&&(this.audio=!0),this},e.prototype.canSimplify=function(){var e="object"==typeof this.video&&(this.video.width||this.video.height||this.video.aspectRatio||this.video.frameRate||this.video.facingMode||this.video.deviceId)||this.video;return!!("object"==typeof this.audio&&(this.audio.deviceId||this.audio.noiseSuppression||this.audio.echoCancellation||this.audio.autoGainControl)||this.audio||e)},e.prototype.isVideo=function(){return!!this.video},e.prototype.isAudio=function(){return!!this.audio},e}(),Ve=function(e){function t(t,n){var r=e.call(this,!1,!0)||this;return"object"==typeof r.video?(delete r.video.deviceId,delete r.video.aspectRatio,delete r.video.frameRate,delete r.video.facingMode):r.video={},r.video.cursor="motion",r.video.width=t,r.video.height=n,r.video.frameRate=te.screenFrameRate,r}return d(t,e),t}(je);function Fe(){return l(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return ge=null,[4,Be()];case 1:return e.sent(),[2]}}))}))}function Ge(){ge=null,Be().then((function(){return se.onDeviceChange()}))}function Be(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return ge?[2,ge]:navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(!ye&&navigator.mediaDevices.addEventListener&&(ye=pe.throttle(Ge,1e3),navigator.mediaDevices.addEventListener("devicechange",ye)),[2,ge=navigator.mediaDevices.enumerateDevices().then((function(e){Se=e.filter((function(e){return"videoinput"===e.kind&&(e.label&&(we=!0),!0)})),Ee=e.filter((function(e){return"audioinput"===e.kind&&(e.label?Ie=!0:Ue.isMobile()&&"Firefox"===Ue.browserName()&&(Ie=we),!0)})),Te=e.filter((function(e){return"audiooutput"===e.kind}));var t=_e.get("videoinput"),n=_e.get("audioinput"),r=_e.get("audiooutput");return Ce=Se.find((function(e){return e.deviceId===t}))||null,be=Ee.find((function(e){return e.deviceId===n}))||null,Re=Te.find((function(e){return e.deviceId===r}))||null,ge=Promise.resolve(e),e})).catch((function(){return ge=null,[]}))]):[2,[]]}))}))}function He(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return Ue.isBrowserSupported()?[2,new Promise((function(e){(new window.RTCPeerConnection).createOffer({offerToReceiveVideo:!0}).then((function(t){/^a=rtpmap:\d+ VP8\/\d+$/m.test(t.sdp)&&(Pe=!0),/^a=mid:0$/m.test(t.sdp)&&(Ae=!0),e()})).catch(e)}))]:[2,Promise.resolve()]}))}))}function We(e,t){return l(this,void 0,void 0,(function(){var n,r,i;return h(this,(function(o){switch(o.label){case 0:ue.debug("Try to get media",e.getNative()),(n=Ue.hasPermissions(e.isVideo()))||t||se.onPermissionsRequested(),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,navigator.mediaDevices.getUserMedia(e.getNative())];case 2:return r=o.sent(),n?[3,4]:[4,Fe()];case 3:o.sent(),o.label=4;case 4:return[2,r];case 5:switch(o.sent().name){case"PermissionDeniedError":case"PermissionDismissedError":case"NotAllowedError":case"SecurityError":case"DOMException":t=e.isVideo()?I.CAMERA_PERMISSION:I.MIC_PERMISSION;break;case"OverconstrainedError":case"TypeError":case"NotFoundError":break;case"AbortError":case"NotReadableError":t=e.isVideo()?I.CAMERA_ACCESS:I.MIC_ACCESS}if(e.canSimplify())return[2,We(e.simplify(),t)];throw i=t||I.UNKNOWN,se.onPermissionsError(i),i;case 6:return[2]}}))}))}function qe(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:ue.debug("Try to get screen",e.getNative()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,navigator.mediaDevices.getDisplayMedia(e.getNative())];case 2:return t=r.sent(),(n=null==t?void 0:t.getVideoTracks()[0])&&(ue.debug("Got display media track",n.id),n.contentHint="text"),[2,t];case 3:switch(r.sent().name){case"PermissionDeniedError":case"NotAllowedError":case"SecurityError":throw I.SCREEN_PERMISSION;default:throw I.SCREEN_ACCESS}return[3,4];case 4:return[2]}}))}))}function Ke(){return De.length?De:De=function(){var e,t=!1,n=0,r=xe.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(r[1]))return["IE",(e=/\brv[ :]+(\d+)/g.exec(xe))&&e[1]||"Unknown",t,n];if("Safari"===r[1]){if(e=xe.match(/\bEdge\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(e=xe.match(/\bCriOS\/(\d+)/))return["Chrome",e[1],!0,e[1]];if(e=xe.match(/\bFxiOS\/(\d+)/))return["Firefox",e[1],!1,n];if(e=xe.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1],!1,n];if(e=xe.match(/\bOPT\/(\d+)/))return["Opera",e[1],!1,n]}if("Chrome"===r[1]){if(t=!0,n=Number(r[2]),e=xe.match(/\bOPR\/(\d+)/))return["Opera",e[1]||"Unknown",t,n];if(e=xe.match(/\bYaBrowser\/(\d+)/))return["Yandex",e[1]||"Unknown",t,n];if(e=xe.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return["Sferum",e[1]||"Unknown",t,n];if(e=xe.match(/\bEdge?\/(\d+)/))return["Edge",e[1]||"Unknown",t,n];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return["Opera","Hidden",t,n]}return e=xe.match(/version\/(\d+)/i),[r[2]?r[1]:Le,e&&e[1]||r[2]||Me,t,n]}()}!function(e){function t(){return Se.length>0}function n(){return Ee.length>0}function r(){return we}function i(){return Ie}function o(){if(!ve||"ended"===ve.readyState){var e=u(),t=e.createMediaStreamDestination(),n=e.createGain();n.gain.value=1e-5,n.connect(t),n.connect(e.destination);var r=e.createOscillator();r.type="sine",r.frequency.value=0,r.connect(n),r.start(),ve=t.stream.getAudioTracks()[0]}return Object.assign(ve.clone(),{enabled:!1})}function a(e,t){if(void 0===e&&(e=te.videoMinWidth),void 0===t&&(t=te.videoMinHeight),fe||(fe=document.createElement("canvas")).getContext("2d"),fe.width=e,fe.height=t,!he||"ended"===he.readyState){var n=fe.captureStream(te.videoFrameRate);he=n.getVideoTracks()[0]}return Object.assign(he.clone(),{enabled:!1})}function s(){return Ke()[0]}function c(){return Ke()[1]}function u(){return Ne||(Ne=new(window.AudioContext||window.webkitAudioContext)),Ne}e.init=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,He()];case 1:return e.sent(),[2,Be()]}}))}))},e.getCameras=function(){return Se},e.getMicrophones=function(){return Ee},e.getOutput=function(){return Te},e.hasCamera=t,e.hasMicrophone=n,e.getSavedCamera=function(){return Ce},e.getSavedMicrophone=function(){return be},e.getSavedOutput=function(){return Re},e.hasCameraPermission=r,e.hasMicrophonePermission=i,e.hasPermissions=function(e){return void 0===e&&(e=!1),!!i()&&(!t()||!e||r())},e.getUserMedia=function(e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),l(this,void 0,void 0,(function(){var i,s,c;return h(this,(function(u){switch(u.label){case 0:return i=n()&&r,s=t()&&e,i||s?[3,1]:(c=new MediaStream,[3,4]);case 1:return u.trys.push([1,3,,4]),[4,We(new je(i,s))];case 2:return c=u.sent(),[3,4];case 3:return u.sent(),c=new MediaStream,[3,4];case 4:return c.getVideoTracks().length||c.addTrack(a()),c.getAudioTracks().length||c.addTrack(o()),[2,c]}}))}))},e.getScreenMedia=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,qe(new Ve(window.screen.width,window.screen.height))]}))}))},e.getUserVideo=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){return n=t?te.videoEffectMaxWidth:te.videoMaxWidth,r=t?te.videoEffectMaxHeight:te.videoMaxHeight,[2,We(new je(!1,e||!0,n,r))]}))}))},e.getUserAudio=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,We(new je(e||!0,!1))]}))}))},e.saveDeviceId=function(e,t){return l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return[4,Be()];case 1:return n=i.sent(),(r=n.find((function(n){return n.kind===e&&n.deviceId===t})))?("videoinput"===e?Ce=r:"audioinput"===e?be=r:"audiooutput"===e&&(Re=r),_e.set(e,t),[2,r]):[2,null]}}))}))},e.getSilentMediaTrack=o,e.getBlackMediaTrack=a,e.isBrowserSupported=function(){if("Edge"===s()&&c()<70)return!1;try{var e=window;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&e.RTCPeerConnection&&e.RTCIceCandidate&&e.RTCSessionDescription&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.RTCRtpSender&&e.RTCRtpSender.prototype.replaceTrack&&e.RTCRtpSender.prototype.getParameters&&navigator.sendBeacon&&!0}catch(e){return!1}},e.isScreenCapturingSupported=function(){return!!navigator.mediaDevices.getDisplayMedia},e.canVP8=function(){return Pe},e.isUnifiedPlan=function(){return Ae},e.isBrokenH264=function(){return"Opera"===e.browserName()&&"Windows"===e.os()},e.canPreferH264=function(){return!(e.baseChromeVersion()&&e.isMobile())},e.os=function(){return ke||(ke=function(){var e={Windows:/Win/,Android:/Android/,OpenBSD:/OpenBSD/,SunOS:/SunOS/,Linux:/(Linux|X11)/,iPad:/(iPad)/,iPhone:/(iPhone)/,iPod:/(iPod)/,MacOS:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/,QNX:/QNX/,UNIX:/UNIX/,BeOS:/BeOS/,OS2:/OS\/2/,Bot:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/};for(var t in e)if(e.hasOwnProperty(t)&&e[t].test(xe))return t;return"Unknown"}()),ke},e.isMobile=function(){return null===Oe&&(Oe=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(Me)),Oe},e.browserName=s,e.browserVersion=c,e.baseChromeVersion=function(){return Ke()[3]},e.getAudioContext=u}(Ue||(Ue={}));var $e,Je,ze,Ye=Ue;function Xe(e){return Object.assign({isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1,videoStreams:[]},e||{})}function Qe(e){return e.participantId+(e.mediaType?":s"+e.mediaType:"")+(e.streamName?":c"+e.streamName:"")}function Ze(e){var t=e.split(":"),n=t.shift();if(!n)throw new Error("Illegal stream description: "+e);for(var r={participantId:n,mediaType:null},i=0,o=t;i<o.length;i++){var a=o[i];switch(a.charAt(0)){case"s":r.mediaType=et(a.slice(1));break;case"c":r.streamName=a.slice(1);break;default:throw new Error("Unexpected parameter type "+a.charAt(0)+" in stream description "+e)}}return r}function et(e){for(var t=0,n=Object.keys(ze);t<n.length;t++){var r=n[t];if(r===e)return ze[r]}return null}function tt(e,t){return null===e||null===t?null===e&&null===t:e.maxDimension===t.maxDimension&&e.maxBitrateK===t.maxBitrateK&&e.maxFramerate===t.maxFramerate&&e.degradationPreference===t.degradationPreference}function nt(e,t){return!!tt(e.camera,t.camera)&&!!tt(e.screenSharing,t.screenSharing)}function rt(e,t){return{camera:Object.assign({},e.camera,t.camera),screenSharing:Object.assign({},e.screenSharing,t.screenSharing)}}!function(e){e.USER="USER",e.ANONYM="ANONYM",e.GROUP="GROUP"}($e||($e={})),function(e){function t(e,t){return void 0===t&&(t=$e.USER),{id:e,type:t}}function n(e){return'{"id":"'+e.id+'","type":"'+e.type+'"}'}e.fromIds=function(e){return e.length?"object"==typeof e[0]?e:e.map((function(e){return t(e)})):[]},e.fromId=t,e.fromSignaling=function(e){return{id:e.id,type:"ANONYM"===e.type?$e.ANONYM:$e.USER}},e.toString=n,e.fromIdToString=function(e,r){return void 0===r&&(r=$e.USER),n(t(e,r))},e.fromString=function(e){try{return JSON.parse(e)}catch(t){throw new Error("Failed to parse ExternalId from string '"+e+"'")}},e.compare=function(e,t){return e.id===t.id&&e.type===t.type}}(Je||(Je={})),function(e){e.CAMERA="CAMERA",e.SCREEN="SCREEN",e.STREAM="STREAM",e.MOVIE="MOVIE"}(ze||(ze={}));var it=function(e){function t(t,n){var r=e.call(this)||this;return r._batchInterval=3e3,r._batch=[],r._batchTimeout=null,r._api=t,r._externalLogger=n,r}return d(t,e),t.prototype._send=function(e){this._api.log(e)},t.prototype._sendBatch=function(){this._stopTimeout(),this._batch.length>0&&(this._send(this._batch),this._batch=[],this._startTimeout())},t.prototype._startTimeout=function(){var e=this;this._batchTimeout=window.setTimeout((function(){return e._sendBatch()}),this._batchInterval)},t.prototype._stopTimeout=function(){this._batchTimeout&&(clearTimeout(this._batchTimeout),this._batchTimeout=null)},t.prototype._onUnload=function(){this._sendBatch(),this._stopTimeout()},t.prototype.log=function(e,t,n){void 0===n&&(n=!1);var r={type:1,time:0,operation:e,timestamp:Date.now(),custom:{},uid:this._api.getUserId()};void 0!==t&&(r.custom.param=t),this._batch.push(r),!n&&this._batchTimeout||this._sendBatch(),this._externalLogger&&this._externalLogger.log(e,t,n)},t.prototype.destroy=function(){this._sendBatch(),this._stopTimeout(),this._externalLogger&&this._externalLogger.destroy()},t.create=function(e,n){t._instance||(t._instance=new t(e,n))},t.log=function(e,n,r){void 0===r&&(r=!1),t._instance&&t._instance.log(e,n,r)},t.destroy=function(){t._instance&&t._instance.destroy(),t._instance=null},t}(_),ot=function(){function e(e){this._fixNoPacketsApplied=!1,this._fixNoPacketsChecked=!1,this._fixTooManyPacketsApplied=!1,this._fixTooManyPacketsSucceeded=!1,this._fixTooManyPacketsFailed=!1,this._mediaSource=e}return e.prototype._fixAudioDeviceNoPackets=function(e){if(!this._fixNoPacketsApplied||!this._fixNoPacketsChecked)return this._fixNoPacketsApplied&&!this._fixNoPacketsChecked?(this._fixNoPacketsChecked=!0,void it.log("callError","audio_device_recover_"+(e.bandwidth?"success":"fail"))):void(this._fixNoPacketsApplied||e.bandwidth||(this._fixNoPacketsApplied=!0,it.log("callError","audio_device_recover"),this._mediaSource.toggleAudio(!0)))},e.prototype._fixAudioDeviceTooManyPackets=function(e){if(!this._fixTooManyPacketsSucceeded&&!this._fixTooManyPacketsFailed){var t=Date.now();if(this._lastPacketsSentTime){if(t-this._lastPacketsSentTime>500){var n=1e3*(e.packetsSent-this._lastPacketsSent)/(t-this._lastPacketsSentTime);this._lastPacketsSentTime=t,this._lastPacketsSent=e.packetsSent,this._fixTooManyPacketsApplied?n>75?(ue.log("Failed to fix RV"),it.log("callError","audio_device_recover_rv_fail"),this._fixTooManyPacketsFailed=!0):t-this._fixTooManyPacketsTime>6e4&&(ue.log("Fixed RV"),it.log("callError","audio_device_recover_rv_success"),this._fixTooManyPacketsSucceeded=!0):n>75&&(this._fixTooManyPacketsApplied=!0,ue.log("Trying to fix RV"),this._mediaSource.toggleAudio(!0),this._fixTooManyPacketsTime=t)}}else e.packetsSent>0&&(this._lastPacketsSentTime=t,this._lastPacketsSent=e.packetsSent)}},e.prototype.fix=function(e){if(this._mediaSource){var t=e.find((function(e){return"audio"===e.kind}));t&&(this._fixAudioDeviceNoPackets(t),this._fixAudioDeviceTooManyPackets(t))}},e}(),at=function(){function e(){this._output=null,this._volume=1,this._features={setSinkId:!!Audio.prototype.setSinkId}}return e.prototype.add=function(e){this.destroy(),this._output={},this._output.audioTrack=e,this._initAudioElement()},e.prototype.remove=function(e){this._output&&this._output.audioTrack===e&&this.destroy()},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=Math.max(0,Math.min(1,e)),this._output&&this._output.audioElement&&(this._output.audioElement.volume=this._volume)},enumerable:!1,configurable:!0}),e.prototype._initAudioElement=function(){var e,t=this;if(null===(e=this._output)||void 0===e?void 0:e.audioTrack){var n=new Audio;n.muted=!1,n.volume=this._volume,n.preload="auto";var r=function(){ue.warn("Error on play audio"),se.onAutoplayError()},i=function(e){n.srcObject=new MediaStream([e]),n.load();var t=n.play();t?t.catch(r):r()},o=function(){var e;ue.debug("Recover audio playback");var n=null===(e=t._output)||void 0===e?void 0:e.audioTrack;n?i(n):ue.warn("Broken audio track")};n.onpause=o,n.onstalled=o,n.onerror=o,i(this._output.audioTrack),this._output.audioElement=n}},e.prototype._stopAudioElement=function(){var e,t,n;(null===(e=this._output)||void 0===e?void 0:e.audioElement)&&(this._output.audioElement.pause(),this._output.audioElement.srcObject=null),null===(n=null===(t=this._output)||void 0===t?void 0:t.audioTrack)||void 0===n||n.stop()},e.prototype.destroy=function(){this._output&&(this._stopAudioElement(),this._output=null)},e.prototype.changeOutput=function(){var e,t,n;return l(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),!this._features.setSinkId)throw new Error('Feature "setSinkId" is not supported');if(!(null===(e=this._output)||void 0===e?void 0:e.audioElement))throw new Error("Audio Element is not initialized");return(r=Ye.getSavedOutput())?[4,null===(n=(t=this._output.audioElement).setSinkId)||void 0===n?void 0:n.call(t,r.deviceId)]:[3,2];case 1:o.sent(),o.label=2;case 2:return[3,4];case 3:throw i=o.sent(),it.log("callError","change_output"),ue.error("Output change failed",i),i;case 4:return[2]}}))}))},e}(),st=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._lastMemoryStat={percent:0,bytes:0},t}return d(t,e),t.prototype.onRemoteDataStats=function(e,t){this._calcMemory(),e.inbound.rtps.map((function(e){var n="string"==typeof e.userId&&t[e.userId]||null;e.userId=null==n?void 0:n.externalId})),se.onStatistics(e,this._lastMemoryStat)},t.prototype._calcMemory=function(){var e,t=null===(e=null===window||void 0===window?void 0:window.performance)||void 0===e?void 0:e.memory;if(t&&t.usedJSHeapSize&&t.jsHeapSizeLimit){var n=Number((100*t.usedJSHeapSize/t.jsHeapSizeLimit).toFixed(2)),r=Number((t.usedJSHeapSize/1024/1024).toFixed(1));n>90?ue.warn("High memory usage: "+n+"% ("+r+" MiB)"):(!this._lastMemoryStat.percent||Math.abs(n-this._lastMemoryStat.percent)>=3)&&(ue.debug("Memory usage: "+n+"% ("+r+" MiB)"),this._lastMemoryStat.percent=n,this._lastMemoryStat.bytes=t.usedJSHeapSize)}},t}(g),ct=function(e){function t(n,r){var i=e.call(this)||this;i.name="HangupReason",i.code=r&&r.code||0,i.remote=r&&r.remote||!1,Object.values(A).indexOf(n)>-1?i.hangup=n:i.error=n;var o=[];return i.error&&o.push("error"),i.remote&&o.push("remote"),i.code&&o.push("code: "+i.code),r&&r.message&&o.push("message: '"+r.message+"'"),i.message=n+(o.length?" ("+o.join(", ")+")":""),Error.captureStackTrace&&Error.captureStackTrace(i,t),i}return d(t,e),t}(Error),ut=function(){function e(e,t){this._analyser=null,this._gainNode=null,this._fftBins=null,this._mediaStreamSource=null,this._lastSmoothedLevel=0,this._trackId=e,this._stream=t;try{var n=Ye.getAudioContext();this._gainNode=n.createGain(),this._gainNode.gain.value=1e-5,this._gainNode.connect(n.destination),this._analyser=n.createAnalyser(),this._analyser.fftSize=1024,this._analyser.smoothingTimeConstant=0,this._analyser.connect(this._gainNode),this._fftBins=new Uint8Array(this._analyser.frequencyBinCount),this._mediaStreamSource=n.createMediaStreamSource(t),this._mediaStreamSource.connect(this._analyser)}catch(e){}}return Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trackId",{get:function(){return this._trackId},enumerable:!1,configurable:!0}),e.prototype._getBins=function(){if(!this._fftBins||!this._analyser)return new Uint8Array;this._analyser.getByteFrequencyData(this._fftBins);var e=44100/this._fftBins.length,t=Math.ceil(te.voiceParams.minFreq/e),n=Math.floor(te.voiceParams.maxFreq/e);return this._fftBins.subarray(t,n)},e.prototype.getLevel=function(){var e=this._getBins(),t=e.reduce((function(e,t){return e+t}),0)/e.length/255,n=this._lastSmoothedLevel*te.voiceParams.smoothing+t*(1-te.voiceParams.smoothing);return this._lastSmoothedLevel=n,{real:t,smoothed:n}},e.prototype.destroy=function(){this._mediaStreamSource&&(this._mediaStreamSource.disconnect(),this._mediaStreamSource=null),this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null),this._analyser&&(this._analyser.disconnect(),this._analyser=null,this._fftBins=null,this._lastSmoothedLevel=0)},e}(),dt=function(e){function t(t){var n=e.call(this)||this;n._detector=null,n._track=null,n._interval=null;var r=function(){n._detector&&se.onLocalVolume(n._detector.getLevel().real,t.getMediaSettings().isAudioEnabled),n._interval=window.setTimeout(r,te.voiceParams.interval)};n._interval=window.setTimeout(r,te.voiceParams.interval);var i=function(){var e=t.getStream();e&&n.init(e)};return n.subscribe(t,"SOURCE_CHANGED",(function(e){"audio"===e.kind&&e.mediaSettings.isAudioEnabled&&i()})),i(),n}return d(t,e),t.prototype.init=function(e){this._stopDetector();var t=e.getAudioTracks();t.length&&(this._track=t[0].clone(),this._detector=new ut("local",new MediaStream([this._track])))},t.prototype._stopDetector=function(){this._detector&&(this._detector.destroy(),this._detector=null),this._track&&(this._track.stop(),this._track=null)},t.prototype.destroy=function(){this.unsubscribe(),this._interval&&(window.clearTimeout(this._interval),this._interval=null),this._stopDetector()},t}(g),pt=function(e){function t(){var t=e.call(this)||this;return t._stream=null,t._screenTrack=null,t._sendVideoTrack=null,t._mediaSettings=Xe(),t._videoStatusOnScreenCapturingEnabled=!1,t._effect=null,t._initDeviceChangeListener(),t}return d(t,e),t.prototype.request=function(e){return void 0===e&&(e=[k.AUDIO]),l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:if(this._stream)return[2];if(t=e.includes(k.VIDEO),n=e.includes(k.AUDIO),!Ye.isBrowserSupported())throw new ct(I.UNSUPPORTED);o.label=1;case 1:return o.trys.push([1,3,,4]),r=this,[4,Ye.getUserMedia(t,n)];case 2:return r._stream=o.sent(),this._mediaSettings.isVideoEnabled=t&&this._stream.getVideoTracks().filter((function(e){return e.enabled})).length>0||!1,this._mediaSettings.isAudioEnabled=n&&this._stream.getAudioTracks().filter((function(e){return e.enabled})).length>0||!1,[3,4];case 3:throw i=o.sent(),new ct(i);case 4:return[2]}}))}))},t.prototype.getStream=function(){return this._stream},t.prototype.getScreenTrack=function(){return this._screenTrack},t.prototype.getSendVideoTrack=function(e){return void 0===e&&(e=!1),this._sendVideoTrack&&!e?this._sendVideoTrack:this._stream?this._stream.getVideoTracks()[0]:null},t.prototype._getSendAudioTrack=function(){var e;return(null===(e=this._stream)||void 0===e?void 0:e.getAudioTracks()[0])||null},t.prototype.addTrackToPeerConnection=function(e,t){void 0===t&&(t=!1);var n=this.getStream(),r=this._getSendAudioTrack(),i=this.getSendVideoTrack(t);if(!n||!r&&!i)throw new Error("No local stream found");r&&e.addTrack(r,n),i&&e.addTrack(i,n)},t.prototype.getMediaSettings=function(){return this._mediaSettings},t.prototype.changeDevice=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(e){case"videoinput":return[2,this._changeVideoInput()];case"audioinput":return[2,this._changeAudioInput()];default:return[2,Promise.reject()]}}))}))},t.prototype.setVideoStream=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,t?this._changeScreen(e):this._changeVideoInput(e)]}))}))},t.prototype._initDeviceChangeListener=function(){var e=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.addEventListener){var t=!1,n=!1,r=pe.throttle((function(){n&&e._changeVideoInput().catch((function(){})),t&&e._changeAudioInput().catch((function(){})),t=!1,n=!1}),1e3);navigator.mediaDevices.addEventListener("devicechange",(function(){return l(e,void 0,void 0,(function(){var e,i,o,a,s,c,u;return h(this,(function(d){switch(d.label){case 0:return this._stream?(e=this._stream.getAudioTracks()[0],i=e&&e.enabled&&e.getSettings(),o=i&&i.groupId,a=this._stream.getVideoTracks()[0],s=a&&a.enabled&&a.getSettings(),c=s&&s.groupId,o||c?[4,navigator.mediaDevices.enumerateDevices()]:[2]):[2];case 1:return u=d.sent(),!t&&o&&(t=!u.find((function(e){return e.groupId===o}))),!n&&c&&(n=!u.find((function(e){return e.groupId===c}))),r(),[2]}}))}))}))}},t.prototype._changeVideoInput=function(e){return void 0===e&&(e=null),l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return o.trys.push([0,7,,8]),t=e?"stream":"video",(n=e)?[3,2]:[4,Ye.getUserVideo(void 0,!!this._effect)];case 1:n=o.sent(),o.label=2;case 2:return e=n,this._stream?[3,3]:(e.getTracks().forEach((function(e){return e.stop()})),[3,6]);case 3:return this._disableScreenCapture(),[4,this._videoEffect(this._effect,e.getVideoTracks()[0])];case 4:return r=o.sent(),this._stopLocalTrack("video"),it.log("callDeviceChanged",t),ue.log("Video stream changed"),[4,this._replaceLocalTrack(r)];case 5:o.sent(),this._mediaSettings.isVideoEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings}),o.label=6;case 6:return[3,8];case 7:throw i=o.sent(),it.log("callError","change_video"),ue.warn("Camera change failed",i),i;case 8:return[2]}}))}))},t.prototype.setAudioStream=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._changeAudioInput(e)]}))}))},t.prototype._changeAudioInput=function(e){return void 0===e&&(e=null),l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),(t=e)?[3,2]:[4,Ye.getUserAudio()];case 1:t=i.sent(),i.label=2;case 2:return e=t,this._stream?[3,3]:(e.getTracks().forEach((function(e){return e.stop()})),[3,5]);case 3:return n=e.getAudioTracks()[0],this._stopLocalTrack("audio"),it.log("callDeviceChanged","audio"),ue.log("Audio stream changed"),[4,this._replaceLocalTrack(n)];case 4:i.sent(),this._mediaSettings.isAudioEnabled=!0,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings}),i.label=5;case 5:return[3,7];case 6:throw r=i.sent(),it.log("callError","change_audio"),ue.error("Microphone change failed",r),r;case 7:return[2]}}))}))},t.prototype._changeScreen=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i=this;return h(this,(function(o){switch(o.label){case 0:return o.trys.push([0,8,,9]),(t=e)?[3,2]:[4,Ye.getScreenMedia()];case 1:t=o.sent(),o.label=2;case 2:return(e=t).addEventListener("inactive",(function(){i._mediaSettings.isScreenSharingEnabled&&i.toggleScreenCapturing(!1)}),!1),this._stream?[3,3]:(e.getTracks().forEach((function(e){return e.stop()})),[3,7]);case 3:return[4,this._videoEffect(null,e.getVideoTracks()[0])];case 4:return n=o.sent(),it.log("callDeviceChanged","screen"),ue.log("Screen capturing started"),this._screenTrack=n,this._mediaSettings.isScreenSharingEnabled=!0,te.consumerScreenTrack?[3,6]:(this._videoStatusOnScreenCapturingEnabled=this._mediaSettings.isVideoEnabled,this._mediaSettings.isVideoEnabled=!0,this._stopLocalTrack("video"),this._sendVideoTrack=te.consumerScreenDataChannel?Ye.getBlackMediaTrack(te.videoMinWidth,te.videoMinHeight):n,[4,this._replaceLocalTrack(n,this._sendVideoTrack)]);case 5:o.sent(),o.label=6;case 6:this._triggerEvent("SCREEN_STATUS",{track:n,mediaSettings:this._mediaSettings}),this._triggerEvent("SOURCE_CHANGED",{kind:"screen",mediaSettings:this._mediaSettings}),o.label=7;case 7:return[3,9];case 8:throw r=o.sent(),it.log("callError","screen"),ue.warn("Screen capturing failed",r),r;case 9:return[2]}}))}))},t.prototype._disableScreenCapture=function(){this._sendVideoTrack&&(this._sendVideoTrack.stop(),this._sendVideoTrack=null),this._screenTrack&&(this._screenTrack.stop(),this._screenTrack=null),this._mediaSettings.isScreenSharingEnabled&&(this._mediaSettings.isScreenSharingEnabled=!1,this._triggerEvent("SCREEN_STATUS",{mediaSettings:this._mediaSettings}),this._triggerEvent("SOURCE_CHANGED",{kind:"screen",mediaSettings:this._mediaSettings}))},t.prototype._replaceLocalTrack=function(e,t){return l(this,void 0,void 0,(function(){var n=this;return h(this,(function(r){return this._stream?(this._stream.getTracks().forEach((function(r){var i,o;r.kind===e.kind&&(null===(i=n._stream)||void 0===i||i.removeTrack(r),null===(o=n._stream)||void 0===o||o.addTrack(e),n._triggerEvent("TRACK_REPLACED",e,t))})),[2]):[2]}))}))},t.prototype._stopLocalTrack=function(e){this._stream&&this._stream.getTracks().forEach((function(t){t.kind===e&&t.stop()}))},t.prototype._videoEffect=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){if(!te.videoEffects)return[2,t];try{return it.log("callDeviceChanged","effect_"+e),[2,te.videoEffects.setEffect(e,t)]}catch(e){return ue.warn("Video effect failed",e),[2,t]}return[2]}))}))},t.prototype.destroy=function(){te.videoEffects&&(this._effect=null,te.videoEffects.stopEffect()),this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null),this._disableScreenCapture()},t.prototype.toggleScreenCapturing=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return e?[2,this._changeScreen()]:te.consumerScreenTrack?[2,this._disableScreenCapture()]:this._videoStatusOnScreenCapturingEnabled?[2,this._changeVideoInput()]:[2,this.toggleVideo(!1)]}))}))},t.prototype.toggleVideo=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return this._stream?(te.consumerScreenTrack||this._disableScreenCapture(),e?[4,Ye.getUserVideo(void 0,!!this._effect)]:[3,3]):[2];case 1:return n=r.sent(),t=n.getVideoTracks()[0],[4,this._videoEffect(this._effect,t)];case 2:return t=r.sent(),[3,5];case 3:return t=Ye.getBlackMediaTrack(te.videoMinWidth,te.videoMinHeight),[4,this._videoEffect(null,t)];case 4:t=r.sent(),r.label=5;case 5:return this._stopLocalTrack("video"),[4,this._replaceLocalTrack(t)];case 6:return r.sent(),this._mediaSettings.isVideoEnabled=e,this._triggerEvent("SOURCE_CHANGED",{kind:"video",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.toggleAudio=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return this._stream?e?[4,Ye.getUserAudio()]:[3,2]:[2];case 1:return n=r.sent(),t=n.getAudioTracks()[0],[3,3];case 2:t=Ye.getSilentMediaTrack(),r.label=3;case 3:return this._stopLocalTrack("audio"),[4,this._replaceLocalTrack(t)];case 4:return r.sent(),this._mediaSettings.isAudioEnabled=e,this._triggerEvent("SOURCE_CHANGED",{kind:"audio",mediaSettings:this._mediaSettings}),[2]}}))}))},t.prototype.setResolution=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){if(!te.consumerScreenTrack&&this._mediaSettings.isScreenSharingEnabled)return[2];if(!this._stream)throw new Error("Local stream not found");if(!(n=this._stream.getVideoTracks()[0]))throw new Error("Local video track not found");return n.enabled?[2,n.applyConstraints({width:{ideal:e},height:{ideal:t}})]:[2]}))}))},t.prototype.updateNoiseSuppression=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){if(!this._stream||!this._mediaSettings.isAudioEnabled)return[2];if(!(e=this._stream.getAudioTracks()[0]))throw new Error("Local audio track not found");return e.enabled?[2,e.applyConstraints({noiseSuppression:te.noiseSuppression})]:[2]}))}))},t.prototype.videoEffect=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){if(!te.videoEffects)throw new Error("Video Effects library is not set");if(!te.consumerScreenTrack&&this._mediaSettings.isScreenSharingEnabled)throw new Error("Can't apply effect to screensharing");return this._mediaSettings.isVideoEnabled?this._stream&&e!==this._effect?(this._effect=e,[2,this._changeVideoInput()]):[2]:(this._effect=e,[2])}))}))},t}(g),lt=function(e){function t(t,n){var r=e.call(this)||this;return r._speakerId=null,r._serverAudioActivityAvailable=!1,r.subscribe(t,"VOLUMES_DETECTED",r._onVolumesDetected.bind(r)),r.subscribe(n,"SIGNALLED_SPEAKER_CHANGED",r._onServerSpeakerChanged.bind(r)),r.subscribe(n,"SIGNALLED_ACTIVE_PARTICIPANTS",r._onReceivedServerAudioActivity.bind(r)),r.subscribe(n,"ACTIVE_PARTICIPANTS_NO_SIGNAL",r._onStoppedReceivingServerAudioActivity.bind(r)),r}return d(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.prototype._onVolumesDetected=function(e){if(!this._serverAudioActivityAvailable){var t=0,n=null;if(Object.keys(e).forEach((function(r){var i=e[r].smoothed;i>t&&i>te.voiceParams.threshold&&(t=i,n=r)})),n&&n!==this._speakerId){var r=this._speakerId&&e.hasOwnProperty(this._speakerId)?e[this._speakerId].smoothed:0;t>r*te.voiceParams.speakerLevelMultiplier&&(this._speakerId=n,this._triggerEvent("SPEAKER_CHANGED",n))}}},t.prototype._onServerSpeakerChanged=function(e){this._serverAudioActivityAvailable&&this._triggerEvent("SPEAKER_CHANGED",e)},t.prototype._onReceivedServerAudioActivity=function(){this._serverAudioActivityAvailable=!0},t.prototype._onStoppedReceivingServerAudioActivity=function(){this._serverAudioActivityAvailable=!1},t}(g),ht=function(e){function t(t,n,r){var i=e.call(this)||this;return i._states={},i._volumes={},i._participants={},i._connectionTimeout=0,i._volumeTimeout=0,i._transport=t,i._participants=r,i.subscribe(t,"STATE_CHANGED",i._onTransportStateChanged.bind(i)),i.subscribe(n,"VOLUMES_DETECTED",i._onVolumesDetected.bind(i)),i}return d(t,e),t.prototype.destroy=function(){this.unsubscribe(),this._connectionTimeout&&window.clearTimeout(this._connectionTimeout),this._volumeTimeout&&window.clearTimeout(this._volumeTimeout)},t.prototype.onChangeRemoteMediaSettings=function(e,t){t.isAudioEnabled||(this._volumes[e]=1),t.isAudioEnabled&&(this._volumes[e]=0)},t.prototype._onTransportStateChanged=function(e,t){this._states[e]=t,"OPENED"===t&&(this._connectionTimeout||(this._connectionTimeout=window.setTimeout(this._onConnectionTimeout.bind(this),te.specListenerParams.connectionTimeout)),this._volumeTimeout||(this._volumeTimeout=window.setTimeout(this._onVolumeTimeout.bind(this),te.specListenerParams.volumeTimeout))),"FAILED"===t&&this._connectionTimeout&&(ue.warn("Transport failed, send callSpecError"),it.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT"))},t.prototype._onVolumesDetected=function(e){var t=this;Object.keys(e).forEach((function(n){t._volumes[n]=Math.max(e[n].real,t._volumes[n]||0)}))},t.prototype._onConnectionTimeout=function(){Object.values(this._states).filter((function(e){return"CONNECTED"!==e})).length>0&&(ue.warn("There is not connected transport, send callSpecError"),it.log("callSpecError",this._transport.getTopology()+"_CONNECTION_TIMEOUT")),this._connectionTimeout=0},t.prototype._onVolumeTimeout=function(){var e=this,t=[];Object.keys(this._volumes).forEach((function(n){if(!(e._volumes[n]>0)){var r="UNKNOWN",i=e._participants[n];i&&i.platform&&(r=i.platform),t.indexOf(r)<0&&(t.push(r),it.log("callSpecError",e._transport.getTopology()+"_VOLUME_TIMEOUT_"+r))}})),t.length&&ue.warn("There is silent participant, send callSpecError"),this._volumeTimeout=0},t}(g);function ft(e,t,n){return void 0===n&&(n=0),t in e&&e[t]?e[t]:n}function vt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){for(var n=0,r=e;n<r.length;n++)if((0,r[n])(t))return!0;return!1}}function mt(e,t){return function(n){return n[e]===t}}function _t(e,t){return t.reduce((function(t,n){return t[n[e]]=n,t}),{})}function gt(e){for(var t={},n=[],r=0,i=e;r<i.length;r++){var o=i[r];t[o.id]||(t[o.id]=!0,n.push(o))}return n}function yt(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return[t,e[t]]})).reduce((function(e,t){return e[t[0]]=function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}(t[1])?yt(t[1]):t[1],e}),{})}function St(e){for(var t=[],n=0,r=e;n<r.length;n++)r[n].forEach((function(e){return t.push(e)}));return t}function Et(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){return t=[],RTCRtpReceiver.prototype.getStats?(t.push.apply(t,e.getReceivers().map((function(e){return e.getStats()}))),t.push.apply(t,e.getSenders().map((function(e){return e.getStats()})))):t.push(e.getStats()),[2,Promise.all(t).then(St).then(gt)]}))}))}function Tt(e){var t,n=e.filter(mt("type","candidate-pair")).sort((t="priority",function(e,n){return e[t]-n[t]})).find(vt(mt("nominated",!0),mt("selected",!0)));if(!n)return{totalRoundTripTime:0,currentRoundTripTime:0,bytesSent:0,bytesReceived:0};var r={totalRoundTripTime:n.totalRoundTripTime||0,currentRoundTripTime:n.currentRoundTripTime||0,bytesSent:n.bytesSent,bytesReceived:n.bytesReceived},i=e.find(mt("id",n.remoteCandidateId));i&&(r=Object.assign({},r,{remote:{type:i.candidateType,address:i.ip||i.address,port:i.port,protocol:i.protocol}}));var o=e.find(mt("id",n.localCandidateId));return o&&(r=Object.assign({},r,{local:{type:o.candidateType,address:o.ip||o.address,port:o.port,protocol:o.protocol,relayProtocol:o.relayProtocol,networkType:o.networkType}})),yt(r)}function Ct(e,t){var n=_t("id",e),r=e.filter(vt(mt("type","inbound-rtp"),mt("type","outbound-rtp")));"Firefox"===Ye.browserName()&&(r=Object.values(r.reduce((function(e,t){if(e[t.ssrc]){var n=Object.assign({},e[t.ssrc],t),r=e[t.ssrc].isRemote?t:e[t.ssrc];n.id=r.id,n.type=r.type,delete n.isRemote,delete n.remoteId,e[n.ssrc]=n}else e[t.ssrc]=t;return e}),{})));var i={};if("Safari"===Ye.browserName()){var o=e.filter(mt("type","track"));i=_t("trackIdentifier",o)}return r.map((function(e){var r=Number(e.ssrc),o=e.mediaType||e.kind,a=e.trackId,s=e.type,c=e.codecId;if("Safari"===Ye.browserName()){var u=/^.+_([\d]+)$/.exec(e.id);if(u&&(r=parseInt(u[1],10)),o=e.id.indexOf("Audio")>0?"audio":"video",t[r]){var d=o+"-"+t[r];i[d]&&(a=i[d].id)}}if(!s||!r||!o)return null;var p={ssrc:r,type:s,kind:o,bytesReceived:ft(e,"bytesReceived"),bytesSent:ft(e,"bytesSent"),jitter:ft(e,"jitter"),packetsLost:ft(e,"packetsLost"),packetsReceived:ft(e,"packetsReceived"),packetsSent:ft(e,"packetsSent"),fractionLost:ft(e,"fractionLost"),pliCount:ft(e,"pliCount"),firCount:ft(e,"firCount"),nackCount:ft(e,"nackCount"),userId:t[r]};if(c&&n[c]){var l=n[c];p.clockRate=l.clockRate,p.mimeType=l.mimeType}if(a&&n[a]){var h=n[a];p.frameHeight=h.frameHeight,p.frameWidth=h.frameWidth,p.framesDecoded=h.framesDecoded,p.framesReceived=h.framesReceived,p.framesDropped=h.framesDropped}return yt(p)})).filter((function(e){return!!e}))}function bt(e,t){if(!t)return e;if(!t.rtps||!e.rtps)return e;var n=_t("ssrc",e.rtps),r=_t("ssrc",t.rtps),i=(e.timestamp-t.timestamp)/1e3;return n&&r?(Object.keys(n).forEach((function(e){var t=n[e],o=r[e];if(t&&o){if(t.bytesReceived&&t.bytesReceived>o.bytesReceived&&(t.bandwidth=Math.round((t.bytesReceived-o.bytesReceived)/i)),t.bytesSent&&t.bytesSent>o.bytesSent&&(t.bandwidth=Math.round((t.bytesSent-o.bytesSent)/i)),t.packetsReceived)if(t.packetsReceived>o.packetsReceived||t.packetsLost>o.packetsLost){var a=t.packetsLost-o.packetsLost,s=t.packetsReceived-o.packetsReceived;t.packetLoss=parseFloat((100*a/(a+s)).toFixed(2))}else t.packetLoss=0;t.framesDropped&&o.framesDropped&&t.framesDropped>o.framesDropped&&(t.framesDroppedDelta=parseFloat(((t.framesDropped-o.framesDropped)/i).toFixed(0)))}})),e):e}function Rt(e,t,n){return void 0===n&&(n={}),l(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:return[4,Et(e)];case 1:return r=o.sent(),i={timestamp:Date.now(),transport:Tt(r),rtps:Ct(r,n)},t?[3,3]:[4,pe.delay(1e3)];case 2:return o.sent(),[2,Rt(e,i,n)];case 3:return[2,bt(i,t)]}}))}))}var wt=function(e){function t(t,n,r,i,o){var a=e.call(this)||this;if(a._remoteSDP={},a._remoteCandidates={},a._state="IDLE",a._isOpen=!1,a._remotePeerId=null,a._statInterval=null,a._settingsInterval=null,a._failedOnCreate=null,a._remoteStream=null,a._iceRestartTimeout=null,a._reconnectionTimeout=null,a._reconnectionPrevented=!1,a._fingerprint=null,a._neverConnected=!0,a._prevConsumerSettings={},a._lastNetworkStat={rtt:0,loss:0,date:0},a._remoteNetworkStat={rtt:0,loss:0},a._networkLimits={badNet:{loss:3,rtt:1e3},goodNet:{loss:.5,rtt:600}},a._signaling=r,a._mediaSource=i,a._participantId=t,a._isMaster=n,a._serverSettings=o,a.subscribe(a._signaling,"NOTIFICATION",a._onSignalingNotification.bind(a)),a.subscribe(a._mediaSource,"TRACK_REPLACED",a._onReplacedTrack.bind(a)),a.subscribe(a._mediaSource,"SOURCE_CHANGED",a._applySettings.bind(a)),a._pc=new RTCPeerConnection({iceServers:te.iceServers,iceTransportPolicy:te.forceRelayPolicy?"relay":"all"},{optional:[{googSuspendBelowMinBitrate:!1}]}),a._pc.onicecandidate=a._handleIceCandidate.bind(a),a._pc.ontrack=a._onAddTrack.bind(a),a._pc.oniceconnectionstatechange=a._onIceConnectionStateChange.bind(a),a._pc.onconnectionstatechange=a._onConnectionStateChange.bind(a),a._pc.onsignalingstatechange=a._onSignalingStateChange.bind(a),a._prevConsumerSettings={},a._isMaster){try{a._mediaSource.addTrackToPeerConnection(a._pc,!0),a._applySettings()}catch(e){return it.log("callError","addTrack-direct"),ue.error("Unable to add media source tracks",e,{participantId:a._participantId}),a._failedOnCreate=e,a}a._createOffer(!1).catch((function(e){"IDLE"===a._state?a._failedOnCreate=e:a.close(e)}))}return a._startSettingsInterval(),a._startStatInterval(),a}return d(t,e),t.prototype.getState=function(){return this._state},t.prototype.updateStatisticsInterval=function(){this._stopStatInterval();var e=this.getState();"IDLE"!==e&&"CLOSED"!==e&&"FAILED"!==e&&this._startStatInterval()},t.prototype.open=function(e){return void 0===e&&(e=null),l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:if(this._isOpen)return ue.warn("DirectTransport: Already opened",{participantId:this._participantId}),[2];if(this._failedOnCreate)return this.close(this._failedOnCreate),[2];if(ue.debug("DirectTransport: Open transport",{participantId:this._participantId}),this._isOpen=!0,this._remotePeerId=e,!this._isMaster)try{this._mediaSource.addTrackToPeerConnection(this._pc,!0),this._applySettings()}catch(e){return it.log("callError","addTrack-direct"),ue.error("DirectTransport: Unable to add media source tracks",e,{participantId:this._participantId}),this.close(e),[2]}if(this._setState("OPENED"),t=e,e||(n=Object.keys(this._remoteSDP),t=n[n.length-1]),!t||!this._remoteSDP[t])return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._setRemoteDescription(t,this._remoteSDP[t])];case 2:return r.sent(),[3,4];case 3:return r.sent(),this.close(),[2];case 4:return this._remoteSDP={},this._remoteCandidates={},this._triggerEvent("ACTIVE_PARTICIPANTS_NO_SIGNAL"),[2]}}))}))},t.prototype.updateSettings=function(e){nt(e,this._serverSettings)||(this._serverSettings=e,this._applySettings())},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.close=function(e){var t=this;this._isOpen=!1,this._stopReconnection(),this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop(),t._triggerEvent("REMOTE_TRACK_REMOVED",t._remoteStream,e)})),this._remoteStream=null),this._stopStatInterval(),this._stopSettingsInterval(),this._pc&&(this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.oniceconnectionstatechange=null,this._pc.onconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.close()),this.unsubscribe(),e?(ue.error("DirectTransport: Closed",e,{participantId:this._participantId}),this._setState("FAILED")):(ue.debug("DirectTransport: Closed",{participantId:this._participantId}),this._setState("CLOSED")),this._triggerEvent("PEER_CONNECTION_CLOSED")},t.prototype._setState=function(e){this._state!==e&&(ue.debug("DirectTransport: State changed to "+e,{participantId:this._participantId}),this._state=e,this._triggerEvent("STATE_CHANGED",e),this._triggerEvent("LOCAL_STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){var t,n,r,i;switch(e.notification){case"transmitted-data":this._handleTransmittedData(e);break;case"settings-update":Object.assign(this._networkLimits.badNet,(null===(t=e.settings)||void 0===t?void 0:t.badNet)||{}),Object.assign(this._networkLimits.goodNet,(null===(n=e.settings)||void 0===n?void 0:n.goodNet)||{});break;case"custom-data":e.data.hasOwnProperty("sdk")&&(this._remoteNetworkStat.rtt=(null===(r=e.data.sdk)||void 0===r?void 0:r.rtt)||0,this._remoteNetworkStat.loss=(null===(i=e.data.sdk)||void 0===i?void 0:i.loss)||0)}},t.prototype._handleTransmittedData=function(e){var t=e.data,n=pe.getPeerIdString(e.peerId);pe.composeMessageId(e)===this._participantId&&(t.candidate&&t.candidate.candidate?this._addIceCandidate(n,t.candidate).catch(this.close.bind(this)):t.sdp&&this._setRemoteDescription(n,t.sdp).catch(this.close.bind(this)))},t.prototype._addIceCandidate=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:if(!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc||!this._pc.remoteDescription)return[3,5];ue.debug("Add remote ice candidate",{participantId:this._participantId,candidate:t}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._pc.addIceCandidate(new RTCIceCandidate(t))];case 2:return r.sent(),[3,4];case 3:throw n=r.sent(),it.log("callError","addIceCandidate-direct"),ue.error("Unable to add remote ice candidate",n,{participantId:this._participantId,candidate:t}),n;case 4:return[3,6];case 5:ue.debug("Cache remote ice candidate",{participantId:this._participantId,candidate:t}),this._remoteCandidates[e]=this._remoteCandidates[e]||[],this._remoteCandidates[e].push(t),r.label=6;case 6:return[2]}}))}))},t.prototype._setRemoteCandidates=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:if(!this._remoteCandidates[e])return ue.log("No cached candidates found for peer "+e),[2];t=this._remoteCandidates[e],this._remoteCandidates[e]=[],n=0,r=t,o.label=1;case 1:if(!(n<r.length))return[3,6];i=r[n],o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this._addIceCandidate(e,i)];case 3:case 4:return o.sent(),[3,5];case 5:return n++,[3,1];case 6:return[2]}}))}))},t.prototype._setRemoteDescription=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:if(!this._isOpen||this._remotePeerId&&this._remotePeerId!==e||!this._pc)return[3,6];ue.debug("Add remote description",{participantId:this._participantId,sdp:t}),this._calcFingerprint(t.sdp),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,this._pc.setRemoteDescription(new RTCSessionDescription(t))];case 2:return r.sent(),[4,this._setRemoteCandidates(e)];case 3:return r.sent(),[3,5];case 4:throw n=r.sent(),it.log("callError","setRemoteDescription-direct"),ue.error("Unable to set remote description",n,{participantId:this._participantId,sdp:t}),n;case 5:return[3,7];case 6:this._remoteSDP[e]=t,r.label=7;case 7:return[2]}}))}))},t.prototype._onAddTrack=function(e){var t=this;ue.debug("Added remote track",{participantId:this._participantId,kind:e.track.kind}),this._remoteStream?this._remoteStream.addTrack(e.track):(this._remoteStream=new MediaStream([e.track]),this._remoteStream.onremovetrack=function(e){t._triggerEvent("REMOTE_TRACK_REMOVED",t._remoteStream,e.track)}),this._triggerEvent("REMOTE_TRACK_ADDED",this._remoteStream,e.track)},t.prototype._handleIceCandidate=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return e.candidate&&this._signaling.ready?(ue.debug("Local ice candidate",{participantId:this._participantId,candidate:e.candidate}),[4,this._signaling.sendCandidate(this._participantId,e.candidate)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype._onSignalingStateChange=function(){var e=this;switch(ue.debug("DirectTransport: Signaling state changed to "+this._pc.signalingState,{participantId:this._participantId}),this._pc.signalingState){case"have-local-offer":var t=this._pc.localDescription;t?this._signaling.sendSdp(this._participantId,t).catch(this.close.bind(this)):this.close(new Error);break;case"have-remote-offer":this._createAnswer().catch(this.close.bind(this)).then((function(t){return l(e,void 0,void 0,(function(){return h(this,(function(e){return[2,this._signaling.sendSdp(this._participantId,t)]}))}))})).catch(this.close.bind(this))}},t.prototype._onIceConnectionStateChange=function(){switch(ue.debug("DirectTransport: Ice Connection state changed to "+this._pc.iceConnectionState,{participantId:this._participantId}),this._pc.iceConnectionState){case"checking":var e=this.getState();"IDLE"===e||"OPENED"===e?this._setState("CONNECTING"):this._setState("RECONNECTING")}},t.prototype._onConnectionStateChange=function(){switch(ue.debug("DirectTransport: Connection state changed to "+this._pc.connectionState,{participantId:this._participantId}),it.log("callIceConnectionState",this._pc.connectionState),this._pc.connectionState){case"connected":this._neverConnected=!1,this._setState("CONNECTED"),this._stopReconnection(),pe.getPeerConnectionHostInfo(this._pc).then((function(e){e&&it.log("callIceConnectionType",e.type)}));break;case"failed":case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection "+this._pc.connectionState)):(this._setState("RECONNECTING"),this._startReconnection());break;case"closed":this.close(new Error("Ice connection closed"))}},t.prototype._startReconnection=function(){var e=this;this._reconnectionTimeout||this._iceRestartTimeout||(ue.log("Waiting for reconnection...",{participantId:this._participantId}),this._reconnectionTimeout=window.setTimeout((function(){e._reconnectionTimeout=null,e._neverConnected?e._requestTopologySwitch():e._startIceRestart()}),te.transportConnectionWaitTime))},t.prototype._requestTopologySwitch=function(){this._isMaster&&this._signaling.ready&&(ue.log("Switch topology DIRECT to SERVER",{participantId:this._participantId}),this._signaling.switchTopology("SERVER"))},t.prototype._stopReconnection=function(){this._reconnectionTimeout&&(clearTimeout(this._reconnectionTimeout),this._reconnectionTimeout=null),this._iceRestartTimeout&&(clearTimeout(this._iceRestartTimeout),this._iceRestartTimeout=null)},t.prototype._startIceRestart=function(){var e=this;this._isMaster?(it.log("callIceRestart"),ue.log("Ice restart",{participantId:this._participantId}),this._createOffer(!0).catch(this.close.bind(this))):ue.debug("Waiting for ice restart...",{participantId:this._participantId}),this._iceRestartTimeout=window.setTimeout((function(){e._iceRestartTimeout=null,ue.error("Ice restart failed",{participantId:e._participantId}),it.log("callError","iceRestart-direct"),e._requestTopologySwitch()}),te.iceRestartWaitTime)},t.prototype._createOffer=function(e){return l(this,void 0,void 0,(function(){var n,r=this;return h(this,(function(i){return n={iceRestart:e,offerToReceiveAudio:!0,offerToReceiveVideo:!0},ue.debug("Create offer",{participantId:this._participantId,options:n}),[2,this._pc.createOffer(n).catch((function(e){throw ue.error("Unable to create offer",e,{participantId:r._participantId}),it.log("callError","createOffer-direct"),e})).then((function(e){return l(r,void 0,void 0,(function(){var n=this;return h(this,(function(r){return ue.debug("Created offer",{participantId:this._participantId,offer:e}),e=t._patchDescription(e),ue.debug("Set local description",{participantId:this._participantId,offer:e}),this._calcFingerprint(e.sdp),[2,this._pc.setLocalDescription(e).then((function(){return n._pc.localDescription}))]}))}))})).catch((function(e){throw ue.error("Unable to set local description",e,{participantId:r._participantId}),it.log("callError","setLocalDescription-direct"),e}))]}))}))},t.prototype._createAnswer=function(){return l(this,void 0,void 0,(function(){var e=this;return h(this,(function(n){return ue.debug("Create answer",{participantId:this._participantId}),[2,this._pc.createAnswer().catch((function(t){throw ue.error("Unable to create answer",t,{participantId:e._participantId}),it.log("callError","createAnswer-direct"),t})).then((function(n){return l(e,void 0,void 0,(function(){return h(this,(function(e){return ue.debug("Created answer",{participantId:this._participantId,answer:n}),n=t._patchDescription(n),ue.debug("Set local description",{participantId:this._participantId,answer:n}),this._calcFingerprint(n.sdp),[2,this._pc.setLocalDescription(n)]}))}))})).then((function(){return e._pc.localDescription})).catch((function(t){throw ue.error("Unable to set local description",t,{participantId:e._participantId}),it.log("callError","setLocalDescription-direct"),t}))]}))}))},t._patchDescription=function(e){var t=!!Ye.baseChromeVersion();return e.sdp=pe.patchSDP(e.sdp,te.preferH264&&Ye.canPreferH264(),Ye.isBrokenH264(),te.preferVP9,t&&te.audioNack),e},t.prototype._onReplacedTrack=function(e){var t=this;this._pc&&(this._pc.getSenders().forEach((function(n){n.track&&n.track.kind===e.kind&&(n.track.enabled=e.enabled,n.replaceTrack(e).catch((function(e){ue.error("DirectTransport: Unable to replace track",e,{participantId:t._participantId}),it.log("callError","replaceTrack-direct")})))})),this._applySettings())},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._pc?Rt(e._pc,e._lastStat).then((function(n){e._lastStat=n;var r={inbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(t){return"inbound-rtp"===t.type&&(t.userId=e._participantId,!0)}))},outbound:{topology:"DIRECT",transport:n.transport,rtps:n.rtps.filter((function(e){return"outbound-rtp"===e.type}))}};e._checkBadNetwork(r),e._triggerEvent("REMOTE_DATA_STATS",r),e._statInterval=window.setTimeout(t,te.statisticsInterval)})):e._stopStatInterval()};this._statInterval=window.setTimeout(t,te.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null)},t.prototype._checkBadNetwork=function(e){var t=this;if(this._signaling.ready){var n=function(e){return e.rtt<=t._networkLimits.goodNet.rtt&&e.loss<=t._networkLimits.goodNet.loss},r=function(e){return e.rtt>=t._networkLimits.badNet.rtt||e.loss>=t._networkLimits.badNet.loss},i=Math.round(1e3*e.outbound.transport.currentRoundTripTime)||0,o=e.inbound.rtps.reduce((function(e,t){return Math.max(e,t.packetLoss||0)}),0),a={rtt:this._lastNetworkStat.rtt*(1-.8)+.8*i,loss:this._lastNetworkStat.loss*(1-.8)+.8*o},s=r(a),c=n(a),u=r(this._remoteNetworkStat),d=n(this._remoteNetworkStat),p=r(this._lastNetworkStat),l=n(this._lastNetworkStat),h=s||u?.2:c&&d?1:0,f=Date.now();if((p!==s||l!==c||f-this._lastNetworkStat.date>te.networkStatisticsInterval)&&(this._lastNetworkStat.date=Date.now(),this._signaling.customData({sdk:Object.assign({type:"bad-net"},a)},null).catch((function(e){ue.warn("Unable to send [bad-net]",e)}))),h){var v={};v[this._participantId]=v[""]=h,this._triggerEvent("NETWORK_STATUS",v)}this._lastNetworkStat.rtt=a.rtt,this._lastNetworkStat.loss=a.loss}},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._pc?(e._applySettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._calcFingerprint=function(e){var t=pe.sdpFingerprint(e);null===this._fingerprint?this._fingerprint=t:(se.onFingerprintChange(this._fingerprint.xor(t).toString()),this._fingerprint=null)},t.prototype._applySettings=function(){var e,t=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;t&&"connected"===(null===(e=this._pc)||void 0===e?void 0:e.connectionState)&&(this._prevConsumerSettings=pe.applySettings(this._pc,t,this._prevConsumerSettings))},t}(g),It=function(){function e(){this.streamDescriptionByCompactId=new Map}return e.prototype.getStreamDescription=function(e){return this.streamDescriptionByCompactId.get(e)},e.prototype.handleMessage=function(e){var t,n,r=this,i=new Uint8Array(e),a=i[0],s=i.subarray(1);switch(a){case 1:var c=(0,o.decode)(s);return Object.entries(c).forEach((function(e){var t=e[0],n=e[1],i=Ze(t);r.streamDescriptionByCompactId.set(n,i)})),null;case 2:case 4:for(var u=[],d=0,p=(0,o.decode)(s);d<p.length;d++){var l=p[d],h=this.getStreamDescription(l);h&&u.push(h.participantId)}return 2===a?{type:"notification",notification:"audio-activity",activeParticipants:u}:{type:"notification",notification:"stalled-activity",stalledParticipants:u};case 3:var f=(0,o.decode)(s);return{type:"notification",notification:"speaker-changed",speaker:null===(t=this.getStreamDescription(f))||void 0===t?void 0:t.participantId};case 5:var v=(0,o.decode)(s);return{type:"notification",notification:"video-quality-update",quality:{maxBitrate:v[0],maxDimension:v[1]}};case 6:for(var m=(0,o.decode)(s),_={},g=0,y=Object.entries(m);g<y.length;g++){var S=y[g],E=S[0],T=S[1],C=null===(n=this.getStreamDescription(Number(E)))||void 0===n?void 0:n.participantId;C&&(_[C]=T/100)}return{type:"notification",notification:"network-status",statuses:_};case 7:return this._createParticipantSourcesUpdateNotification(s);default:return ue.debug("unsupported message type: "+a),null}},e.prototype._createParticipantSourcesUpdateNotification=function(e){for(var t=(0,o.decode)(e),n=[],r=0,i=Object.entries(t);r<i.length;r++){var a=i[r],s=a[0],c=a[1],u=c[0],d=c[1],p=c[2],l=void 0;if(null!==u){if(!(l=this.getStreamDescription(u))){ue.error("could not uncompress participant ID "+u);continue}}else l=null;if(null!==p){var h="pat-"+s,f=d?d>>>0:null;n.push({participantStreamDescription:l,streamId:h,rtpTimestamp:f,sequenceNumber:p})}else ue.error("unexpected null sequenceNumber",s,c)}return{type:"notification",notification:"participant-sources-update",participantUpdateInfos:n}},e}(),Pt=function(){function e(){this._worker=null}return e.prototype._createWorker=function(e,t,n,r,i){return void 0===n&&(n=[]),void 0===r&&(r={}),void 0===i&&(i=[]),l(this,void 0,void 0,(function(){var o=this;return h(this,(function(a){return[2,new Promise((function(a,s){var c=n.join(","),u=new Blob(["("+e+")("+c+");"],{type:"application/javascript; charset=utf-8"}),d=window.URL.createObjectURL(u);o._worker=new Worker(d),o._worker.onmessage=function(e){switch(e.data.type){case"ready":a();break;case"error":s(e.data.error);break;case"frame":t(e.data);break;case"debug":ue.debug(e.data.message)}},o._sendToWorker("init",r,i)}))]}))}))},e.prototype._removeWorker=function(){var e;null===(e=this._worker)||void 0===e||e.terminate(),this._worker=null},e.prototype._sendToWorker=function(e,t,n){var r;void 0===t&&(t={}),void 0===n&&(n=[]),null===(r=this._worker)||void 0===r||r.postMessage(Object.assign({type:e},t),n)},e._workerFunction=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},e.isBrowserSupported=function(){throw new Error("Not implemented")},e}(),At=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.init=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return ue.debug("LibVPxDecoder started"),[4,this._createWorker(t._workerFunction,(function(t){if(t.error)ue.warn("LibVPxDecoder",t.error);else if(t.data instanceof ArrayBuffer){var n=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);e(n)}else e(t.data)}),[s(),s().getUrl])];case 1:return n.sent(),[2]}}))}))},t._workerFunction=function(e,t){var n=null,r=null,i=!0;e({locateFile:t}).then((function(e){return r=e})).then((function(){self.onmessage=function(e){switch(e.data.type){case"frame":!function(e,t,o,a,s){if(!r)return it.log("callError","decoder-init-fail-libvpx"),void self.postMessage({type:"frame",error:"Fatal initialization error"});if(i!==o&&(i=o,n&&(n=null,self.postMessage({type:"debug",message:"LibVPxDecoder codec changed to "+(o?"VP9":"VP8")+" - reinitialize"}))),!n&&(self.postMessage({type:"debug",message:"LibVPxDecoder codec "+(o?"VP9":"VP8")}),(n=new r.VpxDecoder).debug(s),!n.init(o?r.VpxType.VP9:r.VpxType.VP8)))return n=null,void self.postMessage({type:"frame",error:"Decoder failed to create"});try{n.allocateBuffer(t.byteLength).set(new Uint8Array(t))}catch(e){return self.postMessage({type:"debug",message:e}),n=null,void self.postMessage({type:"frame",error:String(e)})}if(n.decode()&&n.nextImage()){var c=n.getImageBuffer();if(c){var u=n.getImageWidth(),d=n.getImageHeight();n.nextImage()&&(ue.warn("LibVPxDecoder dropped frame"),it.log("callError","LibVPxDecoder-drop"));var p=new Uint8ClampedArray(c.byteLength);if(p.set(c),a){var l=new ImageData(p,u,d);createImageBitmap(l,0,0,u,d).then((function(e){self.postMessage({type:"frame",data:e},[e]),e.close()}))}else self.postMessage({type:"frame",data:p.buffer,width:u,height:d},[p.buffer])}else self.postMessage({type:"frame",error:"No decoded data"})}else self.postMessage({type:"frame",error:"Decode failed"})}(e.data.timestamp,e.data.data,e.data.isVP9,e.data.useImageBitmap,e.data.debug)}},self.postMessage({type:"ready"})})).catch((function(e){self.postMessage({type:"error",error:String(e)})}))},t.prototype.decodeFrame=function(e,t,n,r){var i="ImageBitmap"in window;this._sendToWorker("frame",{timestamp:e,data:t.buffer,isVP9:n,keyFrame:r,useImageBitmap:i,debug:ue.enabled()},[t.buffer])},t.prototype.destroy=function(){this._removeWorker(),ue.debug("LibVPxDecoder destroyed")},t.isBrowserSupported=function(){return"WebAssembly"in window&&"Worker"in window},t}(Pt),Ot=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.init=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return ue.debug("WebCodecsDecoder started"),[4,this._createWorker(t._workerFunction,(function(t){t.error?ue.warn("WebCodecsDecoder",t.error):e(t.data)}))];case 1:return n.sent(),[2]}}))}))},t._workerFunction=function(){var e=null,t=!0;self.onmessage=function(n){switch(n.data.type){case"init":self.postMessage({type:"ready"});break;case"frame":!function(n,r,i,o){void 0===o&&(o=!1),e&&t===i||(t=i,e?self.postMessage({type:"debug",message:"WebCodecsDecoder codec changed to "+(i?"VP9":"VP8")}):(self.postMessage({type:"debug",message:"WebCodecsDecoder codec "+(i?"VP9":"VP8")}),e=new VideoDecoder({output:function(e){("createImageBitmap"in e?e.createImageBitmap():createImageBitmap(e)).then((function(e){self.postMessage({type:"frame",data:e}),e.close()})).finally((function(){return e.close()}))},error:function(t){e&&"closed"!==e.state&&e.close(),e=null,self.postMessage({type:"frame",error:"WebCodecsDecoder failed, reinitialize"})}})),e.configure({codec:i?"vp09.00.50.08":"vp8"}));var a=new EncodedVideoChunk({type:o?"key":"delta",timestamp:n,data:r});e.decode(a)}(n.data.timestamp,n.data.data,n.data.isVP9,n.data.keyFrame)}}},t.prototype.decodeFrame=function(e,t,n,r){void 0===r&&(r=!1),this._sendToWorker("frame",{timestamp:e,data:t.buffer,isVP9:n,keyFrame:r},[t.buffer])},t.prototype.destroy=function(){this._removeWorker(),ue.debug("WebCodecsDecoder destroyed")},t.isBrowserSupported=function(){return"VideoDecoder"in window&&"Worker"in window&&"VideoFrame"in window&&"ImageBitmap"in window&&"createImageBitmap"in window},t}(Pt),kt=function(){function e(e,t){var n=this;this._decoderReady=!1,this._decoderQueue=[],this._chunks=[],this._onStream=function(){},this._canvas=null,this._canvasContext=null,this._stream=null,this._track=null,ue.debug("StreamBuilder started for participant ["+e+"]"),this._participantId=e,this._onStream=t,this._useImageBitmap="ImageBitmap"in window,Ot.isBrowserSupported()?this._decoder=new Ot:this._decoder=new At,this._decoder.init((function(e){return n._drawImage(e)})).then((function(){n._decoderReady=!0,n._decodeQueue()}))}return e.prototype._createStream=function(e,t){this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.style.bottom="0",this._canvas.style.right="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas),this._useImageBitmap?this._canvasContext=this._canvas.getContext("bitmaprenderer"):this._canvasContext=this._canvas.getContext("2d"),this._stream=this._canvas.captureStream(0),this._track=this._stream.getVideoTracks()[0],this._track.contentHint="text")},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._canvasContext=null;try{this._canvas&&document.body.removeChild(this._canvas)}catch(e){}this._canvas=null},e.prototype._processFrameData=function(){for(var e=new Uint8Array,t=0,n=this._chunks;t<n.length;t++){var r=n[t],i=new Uint8Array(e.byteLength+r.data.byteLength);i.set(new Uint8Array(e),0),i.set(new Uint8Array(r.data),e.byteLength),e=i}return this._chunks=[],e},e.prototype._requestCanvasFrame=function(){this._track&&this._track.requestFrame?this._track.requestFrame():this._stream&&this._stream.requestFrame&&this._stream.requestFrame()},e.prototype._drawImage=function(e){this._track||(this._createStream(e.width,e.height),this._onStream(this._stream));var t,n=this._canvas;n.width=e.width,n.height=e.height,e instanceof ImageData?((t=this._canvasContext).clearRect(0,0,n.width,n.height),t.putImageData(e,0,0)):(t=this._canvasContext).transferFromImageBitmap(e),this._requestCanvasFrame()},e.prototype._decodeFrame=function(e){!this._decoderReady||this._decoderQueue.length?(this._decoderQueue.push(e),this._decodeQueue()):this._decoder.decodeFrame(e.timestamp,e.frameData,e.isVP9,e.keyframe)},e.prototype._decodeQueue=function(){var e=this;if(this._decoderReady){var t=this._decoderQueue;this._decoderQueue=[],t.forEach((function(t){e._decoder.decodeFrame(t.timestamp,t.frameData,t.isVP9,t.keyframe)}))}},e.prototype.appendChunk=function(e){var t=this._chunks.length;if(e.start)t&&(ue.warn("[FrameBuilder] Cleanup buffer",Array.prototype.slice.call(this._chunks)),this._chunks=[]);else if(!t||(this._chunks[t-1].sequence+1)%65536!==e.sequence)return void ue.warn("[FrameBuilder] Got incorrect chunk");if(this._chunks.push(e),e.end){var n=this._processFrameData();this._decodeFrame({timestamp:e.timestamp,frameData:n,isVP9:e.isVP9,keyframe:e.keyframe})}},e.prototype.destroy=function(){this._decoder.destroy(),this._removeStream(),this._chunks=[],ue.debug("StreamBuilder destroyed for participant "+this._participantId)},e}(),Dt=function(){function e(e,t,n,r){var i=this;this._participantIdRegistry=null,this._streamBuilders={},this._onStream=function(){},this._onEos=function(){},ue.debug("ScreenCaptureReceiver started"),this._datachannel=e,this._participantIdRegistry=t,this._onStream=n,this._onEos=r,this._datachannel.onmessage=function(e){return i._onDataChannelMessage(e.data)}}return e.prototype._onDataChannelMessage=function(e){var t,n,r=this,i=function(e){var t=new DataView(e),n=t.getUint8(0),r=t.getUint16(1),i=t.getUint32(3),o=1===t.getUint8(7),a=t.getUint16(8),s=t.getUint8(10),c=!!(1&s),u=!!(2&s),d=!!(4&s),p=!!(8&s);if(1!==n)throw new Error("Unexpected protocol version. Got "+n+", expected 1");return{timestamp:i,start:c,end:u,keyframe:d,sequence:r,isVP9:o,ssrc:a,eos:p,data:e.slice(11)}}(e),o=null===(n=null===(t=this._participantIdRegistry)||void 0===t?void 0:t.getStreamDescription(i.ssrc))||void 0===n?void 0:n.participantId;if(o){if(i.eos)return this.close(o),void this._onEos(o);var a=this._streamBuilders[o];a||(a=new kt(o,(function(e){return r._onStream(o,e)})),this._streamBuilders[o]=a),a.appendChunk(i)}else ue.warn("Participant id for ssrc "+i.ssrc+" not found in registry")},e.prototype.close=function(e){var t=this._streamBuilders[e];t&&(t.destroy(),delete this._streamBuilders[e])},e.prototype.destroy=function(){this._datachannel.onbufferedamountlow=null,this._datachannel.onmessage=null,this._onStream=function(){},Object.values(this._streamBuilders).forEach((function(e){return e.destroy()})),this._streamBuilders={},this._participantIdRegistry=null,ue.debug("ScreenCaptureReceiver destroyed")},e.isBrowserSupported=function(){return(Ot.isBrowserSupported()||At.isBrowserSupported())&&("CanvasCaptureMediaStream"in window||"CanvasCaptureMediaStreamTrack"in window)},e}(),Nt=function(e){function t(t,n){var r=e.call(this)||this;return r._video=null,r._imageCapture=null,r._canvas=null,r._canvasCtx=null,r._stream=null,r._track=null,r._frameReadTimeout=0,r._lastFrame=null,r._sourceTrack=t,r._onFrame=n,r._useImageCapture="ImageCapture"in window&&"ImageBitmap"in window,"live"===t.readyState&&t.enabled&&!t.muted||(r._useImageCapture=!1),r}return d(t,e),t.prototype._createDom=function(){this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.style.bottom="0",this._canvas.style.right="160px",this._canvas.style.zIndex="5000",this._canvasCtx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)),this._video||this._useImageCapture||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},t.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvasCtx=null,this._canvas=null,this._video=null},t.prototype._createStream=function(e){return l(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){if(!this._canvas)throw new Error("Canvas not found");if(!this._video&&!this._useImageCapture)throw new Error("Video element not found");return this._stream=this._canvas.captureStream(0),this._track=this._stream.getVideoTracks()[0],[2,new Promise((function(n,r){if(t._useImageCapture)t._imageCapture=new ImageCapture(e),n();else{var i=t._video;i.srcObject=new MediaStream([e]),i.onloadeddata=function(e){return n()},i.onerror=function(){return r(new Error("Video element error"))};var o=i.play(),a=function(){return r(new Error("Autoplay is disabled"))};o?o.catch(a):a()}}))]}))}))},t.prototype._removeStream=function(){var e;window.clearTimeout(this._frameReadTimeout),null===(e=this._lastFrame)||void 0===e||e.close(),this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject=null),this._imageCapture&&(this._imageCapture=null)},t.prototype._drawFrameVideo=function(){if(!(this._canvas&&this._canvasCtx&&this._video&&this._track))throw new Error("Fatal error");var e=this._video.videoWidth,t=this._video.videoHeight;return this._canvas.width=this._video.width=e,this._canvas.height=this._video.height=t,this._canvasCtx.clearRect(0,0,e,t),this._canvasCtx.drawImage(this._video,0,0,e,t),this._requestCanvasFrame(),this._canvasCtx.getImageData(0,0,e,t)},t.prototype._getFrameBitmap=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){if(!this._imageCapture)throw new Error("Destroyed");return[2,this._imageCapture.grabFrame()]}))}))},t.prototype._drawFrameData=function(e){var t;if(!this._canvas||!this._canvasCtx||!this._track)throw new Error("Destroyed");var n=e.width,r=e.height;return this._canvas.width=n,this._canvas.height=r,this._canvasCtx.clearRect(0,0,n,r),this._canvasCtx.drawImage(e,0,0,n,r),this._requestCanvasFrame(),null===(t=this._canvasCtx)||void 0===t?void 0:t.getImageData(0,0,n,r)},t.prototype._requestCanvasFrame=function(){this._track&&this._track.requestFrame?this._track.requestFrame():this._stream&&this._stream.requestFrame&&this._stream.requestFrame()},t.prototype.init=function(){return l(this,void 0,void 0,(function(){var e,n,r=this;return h(this,(function(i){switch(i.label){case 0:return this._createDom(),e=this._sourceTrack.getSettings().width,n=this._sourceTrack.getSettings().height,ue.debug("LibVPxEncoder started "+e+"x"+n+", codec "+(this.isVP9()?"VP9":"VP8")),[4,this._createStream(this._sourceTrack)];case 1:return i.sent(),[4,this._createWorker(t._workerFunction,(function(e){var t;e.error?r._onFrame(null,e.error):r._onFrame({type:e.frameType,timestamp:e.timestamp,duration:e.duration,data:e.data,byteLength:null===(t=e.data)||void 0===t?void 0:t.byteLength})}),[s(),s().getUrl],{isVP9:this.isVP9(),debug:ue.enabled()})];case 2:return i.sent(),[2]}}))}))},t._workerFunction=function(e,t){var n;self.onmessage=function(r){switch(r.data.type){case"init":(function(r,i){return e({locateFile:t}).then((function(e){if((n=new e.VpxEncoder).debug(i),!n.init(r?e.VpxType.VP9:e.VpxType.VP8))throw it.log("callError","encoder-init-fail-libvpx"),new Error("LibVPxEncoder failed to create");n.setMaxQuantizer(10),n.setTargetBitrate(1024)}))})(r.data.isVP9,r.data.debug).then((function(){return self.postMessage({type:"ready"})})).catch((function(e){return self.postMessage({type:"error",error:String(e)})}));break;case"frame":!function(e,t,r,i){var o=n.allocateImage(e,t);if(o){o.set(new Uint8Array(r));var a=Math.round(performance.now());if(n.encode(a,150,i)){var s=n.readFrame();if(s){n.readFrame()&&(ue.warn("LibVPxEncoder dropped frame"),it.log("callError","LibVPxEncoder-drop"));var c=new Uint8Array(s.byteLength);c.set(s),self.postMessage({type:"frame",frameType:i?"key":"delta",timestamp:a,duration:150,data:c.buffer},[c.buffer])}else self.postMessage({type:"frame",error:"No encoded data"})}else self.postMessage({type:"frame",error:"Encode failed"})}else self.postMessage({type:"frame",error:"No buffer data"})}(r.data.width,r.data.height,r.data.imageData,r.data.keyFrame)}}},t.prototype._encode=function(e,t){var n=e.data.buffer;this._sendToWorker("frame",{width:e.width,height:e.height,imageData:n,keyFrame:t},[n])},t.prototype._requestFrameVideo=function(e){var t=this._drawFrameVideo();this._encode(t,e)},t.prototype._requestFrameBitmap=function(e){var t=this;this._frameReadTimeout=window.setTimeout((function(){if(t._lastFrame){var n=t._drawFrameData(t._lastFrame);t._encode(n,e)}else t._onFrame(null)}),1e3),this._getFrameBitmap().then((function(n){var r;window.clearTimeout(t._frameReadTimeout),null===(r=t._lastFrame)||void 0===r||r.close(),t._lastFrame=n;var i=t._drawFrameData(n);t._encode(i,e)})).catch((function(){}))},t.prototype.requestFrame=function(e){void 0===e&&(e=!1),this._useImageCapture?this._requestFrameBitmap(e):this._requestFrameVideo(e)},t.prototype.isVP9=function(){return!1},t.prototype.destroy=function(){this._removeWorker(),this._removeStream(),this._removeDom(),ue.debug("LibVPxEncoder destroyed")},t.isBrowserSupported=function(){return"WebAssembly"in window&&"Worker"in window&&("CanvasCaptureMediaStream"in window||"CanvasCaptureMediaStreamTrack"in window)},t}(Pt),Mt=function(e){function t(t,n){var r=e.call(this)||this;return r._sourceTrack=t,r._onFrame=n,r._trackProcessor=new MediaStreamTrackProcessor(t),r}return d(t,e),t.prototype.init=function(){return l(this,void 0,void 0,(function(){var e,n,r,i=this;return h(this,(function(o){switch(o.label){case 0:return e=this._sourceTrack.getSettings().width,n=this._sourceTrack.getSettings().height,r=this._trackProcessor.readable,ue.debug("WebCodecsEncoder started "+e+"x"+n+", codec "+(this.isVP9()?"VP9":"VP8")),[4,this._createWorker(t._workerFunction,(function(e){var t;e.error?i._onFrame(null,e.error):i._onFrame({type:e.frameType,timestamp:e.timestamp,duration:e.duration,data:e.data,byteLength:null===(t=e.data)||void 0===t?void 0:t.byteLength})}),[],{readable:r,width:e,height:n,isVP9:this.isVP9(),framerate:te.screenFrameRate},[r])];case 1:return o.sent(),[2]}}))}))},t._workerFunction=function(){var e,t,n,r,i,o,a=null,s=0,c=!1;function u(e,t){e.codedWidth===n&&e.codedHeight===r||(n=e.codedWidth,r=e.codedHeight,d.configure({framerate:o,codec:i?"vp09.00.50.08":"vp8",width:n,height:r})),d.encode(e,{keyFrame:t})}var d=new VideoEncoder({output:function(e){var t;e.data?t=e.data:(t=new ArrayBuffer(e.byteLength),e.copyTo(t)),self.postMessage({type:"frame",frameType:e.type,timestamp:e.timestamp,duration:e.duration,data:t},[t])},error:function(e){self.postMessage({type:"frame",error:String(e)})}});self.onmessage=function(p){switch(p.data.type){case"init":h=p.data,e=h.readable,t=e.getReader(),n=h.width,r=h.height,i=h.isVP9,o=h.framerate,d.configure({framerate:o,codec:i?"vp09.00.50.08":"vp8",width:n,height:r}),self.postMessage({type:"ready"});break;case"frame":l=p.data.keyFrame,s=self.setTimeout((function(){a&&u(a,l)}),1e3),c||(c=!0,t.read().finally((function(){c=!1,self.clearTimeout(s)})).then((function(n){var r=n.done,i=n.value;if(null==a||a.close(),a=null,!r&&i){if(!d)return t.releaseLock(),void e.cancel();a=i,u(i,l)}})))}var l,h}},t.prototype.requestFrame=function(e){void 0===e&&(e=!1),this._sendToWorker("frame",{keyFrame:e})},t.prototype.isVP9=function(){return!0},t.prototype.destroy=function(){this._removeWorker(),ue.debug("WebCodecsEncoder destroyed")},t.isBrowserSupported=function(){return"VideoEncoder"in window&&"Worker"in window&&"EncodedVideoChunk"in window&&"MediaStreamTrackProcessor"in window},t}(Pt),Lt=0,xt=function(){function e(e,t){var n=this;this._destroyed=!1,this._needKeyframe=!0,ue.debug("ScreenCaptureSender started"),this._datachannel=t;var r=function(e,t){if(!n._destroyed)return e?void n._send(e).catch((function(e){ue.warn("sendFrame failed",e),n._needKeyframe=!0})).finally((function(){return n._requestFrame()})):(ue.warn("requestFrame failed, keyFrame: "+n._needKeyframe,t),n._needKeyframe=!0,void n._requestFrame())};Mt.isBrowserSupported()?this._encoder=new Mt(e,r):this._encoder=new Nt(e,r),this._datachannel.onmessage=function(e){(function(e){if(!e||!e.byteLength||4!==e.byteLength)return!1;var t=new DataView(e);return 1===t.getUint8(0)&&1===t.getUint8(1)&&0===t.getUint16(2)})(e.data)&&(ue.debug("["+n._datachannel.label+"] Requested keyframe"),n._needKeyframe=!0)},this._encoder.init().then((function(){return n._requestFrame()})).catch((function(e){return ue.warn("ScreenCaptureSender init failed",e)}))}return e.prototype._requestFrame=function(){this._destroyed||(this._encoder.requestFrame(this._needKeyframe),this._needKeyframe=!1)},e.prototype._wrapHeader=function(e,t,n,r,i){var o=function(e,t,n,r,i,o,a){var s=0;t&&(s|=1),n&&(s|=2),r&&(s|=4),a||(s|=8);var c=new ArrayBuffer(11),u=new DataView(c);if(u.setUint8(0,1),u.setUint16(1,i),u.setUint32(3,e),u.setUint8(7,o?1:0),u.setUint16(8,0),u.setUint8(10,s),!a)return c;var d=new Uint8Array(c.byteLength+a.byteLength);return d.set(new Uint8Array(c),0),d.set(new Uint8Array(a),c.byteLength),d.buffer}(e,t,n,r,Lt,this._encoder.isVP9(),i);return Lt=(Lt+1)%65536,o},e.prototype._stopPacket=function(){return this._wrapHeader(Date.now(),!1,!1,!1,null)},e.prototype._send=function(e){return l(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){return[2,new Promise((function(n,r){t._sendChunk(e,0,n,r)}))]}))}))},e.prototype._sendChunk=function(e,t,n,r){var i=this;if(this._datachannel&&"open"===this._datachannel.readyState){var o=e.data.slice(t,t+16373),a=e.data.byteLength<=t+o.byteLength,s=this._wrapHeader(e.timestamp,!t,a,"key"===e.type,o);this._datachannel.onbufferedamountlow=a?function(){i._datachannel.bufferedAmount<=i._datachannel.bufferedAmountLowThreshold&&n()}:null;try{this._datachannel.send(s)}catch(e){return ue.warn("Error send data to DataChannel",e),void r()}a||window.setTimeout((function(){return i._sendChunk(e,t+16373,n,r)}),0)}else r()},e.prototype.destroy=function(){this._datachannel.onbufferedamountlow=null,this._datachannel.onmessage=null,"open"===this._datachannel.readyState&&this._datachannel.send(this._stopPacket()),this._destroyed=!0,this._encoder.destroy(),ue.debug("ScreenCaptureSender destroyed")},e.isBrowserSupported=function(){return Mt.isBrowserSupported()||Nt.isBrowserSupported()},e}(),Ut=function(e){function t(t,n){var r=e.call(this)||this;return r._previousTimestamp=0,r._signaling=n,r.subscribe(t,"REMOTE_DATA_STATS",r._handleStats.bind(r)),r}return d(t,e),t.prototype.destroy=function(){this.unsubscribe()},t.getEstimatedPerformanceIndex=function(){try{var e=parseInt(localStorage.getItem("videochat-epi")||"",10);return isNaN(e)?0:e}catch(e){return 0}},t.prototype._handleStats=function(e){return l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:if(!te.perfStatReportEnabled)return[2];if(!e.inbound||!e.inbound.rtps)return[2];if(t=e.inbound.rtps.reduce((function(e,t){return"video"===t.kind&&(e.framesDecoded+=t.framesDecoded||0,e.framesReceived+=t.framesReceived||0),e}),{framesDecoded:0,framesReceived:0}),n=Date.now(),this._previousTimestamp+5e3>n)return[2];if(!t.framesDecoded)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._signaling.reportPerfStat(t)];case 2:return r=i.sent(),localStorage.setItem("videochat-epi",r.estimatedPerformanceIndex),[3,4];case 3:return i.sent(),[3,4];case 4:return this._previousTimestamp=n,[2]}}))}))},t}(g),jt=function(e){function t(t,n,r){var i=e.call(this)||this;return i._pc=null,i._producerNotification=null,i._producerCommand=null,i._producerScreen=null,i._consumerScreen=null,i._isOpen=!1,i._reconnectionPrevented=!1,i._state="IDLE",i._statInterval=null,i._settingsInterval=null,i._statBytes={},i._ssrcMap={},i._producerOfferIsProcessing=!1,i._producerNextOffer=null,i._prevConsumerSettings={},i._captureSender=null,i._captureReceiver=null,i._participantIdRegistry=null,i._disabledSenders=new Set,i._rtpReceiversByStreamId={},i._producerSessionId="",i._signaling=t,i._mediaSource=n,i.subscribe(i._signaling,"NOTIFICATION",i._onSignalingNotification.bind(i)),i.subscribe(i._mediaSource,"TRACK_REPLACED",i._onReplacedTrack.bind(i)),i.subscribe(i._mediaSource,"SOURCE_CHANGED",i._applyConsumerSettings.bind(i)),i.subscribe(i._mediaSource,"SCREEN_STATUS",i._onScreenSharingStatus.bind(i)),i._perfStatReporter=new Ut(i,t),i._serverSettings=r,te.consumerScreenDataChannel&&!xt.isBrowserSupported()&&(te.consumerScreenDataChannel=!1),te.producerScreenDataChannel&&!Dt.isBrowserSupported()&&(te.producerScreenDataChannel=!1),ue.debug("ServerTransport: Created"),i}return d(t,e),t.prototype.getState=function(){return this._state||"IDLE"},t.prototype.updateStatisticsInterval=function(){this._stopStatInterval();var e=this.getState();"IDLE"!==e&&"CLOSED"!==e&&"FAILED"!==e&&this._startStatInterval()},t.prototype.open=function(){this._isOpen?ue.log("ServerTransport: Already opened connections"):(this._isOpen=!0,this._openConnection())},t.prototype.close=function(e){this._isOpen=!1,this._closeConnection(),this.unsubscribe(),e?(ue.error("ServerTransport: Closed",e),this._setState("FAILED")):(ue.debug("ServerTransport: Closed"),this._setState("CLOSED"))},t.prototype.removeParticipant=function(e){var t;null===(t=this._captureReceiver)||void 0===t||t.close(e)},t.prototype.preventRestart=function(){this._reconnectionPrevented=!0},t.prototype.allowRestart=function(){this._reconnectionPrevented=!1},t.prototype.updateSettings=function(e){nt(e,this._serverSettings)||(this._serverSettings=e,this._applyConsumerSettings())},t.prototype._closeConnection=function(){this._stopStatInterval(),this._stopSettingsInterval(),this._removeCaptureSender(),this._removeCaptureReceiver(),this._pc&&(this._rtpReceiversByStreamId={},this._disabledSenders.forEach((function(e){var t;return null===(t=e.track)||void 0===t?void 0:t.stop()})),this._disabledSenders.clear(),this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._participantIdRegistry=null,t._closeDataChannel(this._producerNotification),t._closeDataChannel(this._producerCommand),t._closeDataChannel(this._producerScreen),t._closeDataChannel(this._consumerScreen),this._pc.close(),this._pc=null,this._producerOfferIsProcessing=!1,this._producerNextOffer=null),this._triggerEvent("PEER_CONNECTION_CLOSED")},t._closeDataChannel=function(e){e&&(e.onopen=null,e.onmessage=null,e.onerror=null,e.close())},t.prototype._createDataChannel=function(e,t,n){ue.debug("["+t+"] data channel opening");var r=e.createDataChannel(t,{ordered:!0});r.onopen=function(){ue.debug("["+t+"] data channel opened"),r.onerror=function(e){ue.error("["+t+"] data channel error",e)},n(r)}},t.prototype._openConnection=function(e){var n=this;void 0===e&&(e=!1),ue.debug("ServerTransport: Open single connection");var r={};Ye.baseChromeVersion()&&(r.sdpSemantics=t._isUnifiedPlanSupported()?"unified-plan":"plan-b"),this._pc=new RTCPeerConnection(r,{optional:[{googSuspendBelowMinBitrate:!1}]}),this._pc.ontrack=this._onAddTrack.bind(this,this._pc),this._pc.onconnectionstatechange=pe.throttle((function(e){n._pc&&n._onConnectionStateChange(n._pc,e)}),500),this._pc.onsignalingstatechange=t._onSignalingStateChange.bind(this,this._pc),te.producerNotificationDataChannel&&this._createDataChannel(this._pc,"producerNotification",(function(e){n._producerNotification=e,n._producerNotification.binaryType="arraybuffer",n._participantIdRegistry=new It,n._signaling.setParticipantIdRegistry(n._participantIdRegistry),n._signaling.setProducerNotificationDataChannel(e)})),te.producerCommandDataChannel&&this._createDataChannel(this._pc,"producerCommand",(function(e){n._producerCommand=e,n._signaling.setProducerCommandDataChannel(e)})),te.producerScreenDataChannel&&this._createDataChannel(this._pc,"producerScreenShare",(function(e){n._producerScreen=e,n._producerScreen.binaryType="arraybuffer",n._createCaptureReceiver()}));try{this._mediaSource.addTrackToPeerConnection(this._pc),this._prevConsumerSettings={},this._applyConsumerSettings()}catch(e){return ue.error("ServerTransport: Unable to add media source tracks",e),it.log("callError","addTrack-single"),void this.close(e)}te.consumerScreenDataChannel&&this._createDataChannel(this._pc,"consumerScreenShare",(function(e){n._consumerScreen=e,n._consumerScreen.binaryType="arraybuffer";var t=n._mediaSource.getScreenTrack();t&&n._createCaptureSender(t)})),e||this._allocateConsumer(),this._setState("OPENED"),this._startStatInterval(),this._startSettingsInterval()},t.prototype._reconnect=function(){"OPENED"!==this.getState()&&(this._setState("RECONNECTING"),this._closeConnection(),this._openConnection(!0))},t.prototype._signalActiveParticipants=function(e){this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._signalStalledParticipants=function(e){this._triggerEvent("SIGNALLED_STALLED_PARTICIPANTS",e)},t.prototype._signalSpeakerChanged=function(e){this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._signalNetworkStatus=function(e){this._triggerEvent("NETWORK_STATUS",e)},t.prototype._updateSSRCMap=function(e){var t=this;e&&e.sdp.split("\n").forEach((function(e){var n=new RegExp("a=ssrc:([0-9]+) label:(audio|video)-((?:[ug]?[\\d]+)|(?:mix)|(?:pat-[0-9]+))").exec(e);n&&(t._ssrcMap[n[1]]=n[3])}))},t.prototype._createCaptureSender=function(e){e&&te.consumerScreenDataChannel&&this._consumerScreen&&this._mediaSource.getMediaSettings().isScreenSharingEnabled&&(this._captureSender&&this._removeCaptureSender(),this._captureSender=new xt(e,this._consumerScreen))},t.prototype._removeCaptureSender=function(){var e;null===(e=this._captureSender)||void 0===e||e.destroy(),this._captureSender=null},t.prototype._createCaptureReceiver=function(){var e=this;te.producerScreenDataChannel&&this._producerScreen&&this._participantIdRegistry&&(this._captureReceiver&&this._removeCaptureReceiver(),this._captureReceiver=new Dt(this._producerScreen,this._participantIdRegistry,(function(t,n){e._triggerEvent("REMOTE_STREAM_SECOND",t,n)}),(function(t){e._triggerEvent("REMOTE_STREAM_SECOND",t,null)})))},t.prototype._removeCaptureReceiver=function(){var e;null===(e=this._captureReceiver)||void 0===e||e.destroy(),this._captureReceiver=null},t.prototype._applyConsumerSettings=function(){var e=this,t=this._mediaSource.getMediaSettings().isScreenSharingEnabled?this._serverSettings.screenSharing:this._serverSettings.camera;if(t&&this._pc){var n=[];this._pc.getSenders().forEach((function(r){if(r.track&&"video"===r.track.kind){var i=!e._disabledSenders.has(r),o=0!==t.maxDimension;if(i&&!o)return ue.log("Disabling video upload"),e._disabledSenders.add(r),void r.replaceTrack(Ye.getBlackMediaTrack()).catch((function(e){ue.error("Could not disable video upload",e)}));var a=e._mediaSource.getSendVideoTrack();if(!i&&o&&a){ue.log("Enabling video upload"),e._disabledSenders.delete(r);var s=r.track;s.enabled=a.enabled,r.replaceTrack(a).then((function(){return s.stop()})).catch((function(e){ue.error("Could not enable video upload",e)}))}pe.applyVideoTrackSettings(t,r,null!=a?a:r.track,e._prevConsumerSettings,n)}})),this._prevConsumerSettings=n}},t.prototype._onScreenSharingStatus=function(e){e.track?this._createCaptureSender(e.track):this._removeCaptureSender()},t.prototype._setState=function(e){this._state!==e&&(this._state=e,this._triggerEvent("LOCAL_STATE_CHANGED",e),this._triggerEvent("STATE_CHANGED",e))},t.prototype._startStatInterval=function(){var e=this;if(!this._statInterval){var t=function(){e._pc?(e._collectStat().then((function(t){e._reportStats(t),e._detectStaleTracks(t)})).catch((function(){})),e._statInterval=window.setTimeout(t,te.statisticsInterval)):e._stopStatInterval()};this._statInterval=window.setTimeout(t,te.statisticsInterval)}},t.prototype._stopStatInterval=function(){this._statInterval&&(window.clearTimeout(this._statInterval),this._statInterval=null),this._statBytes={}},t.prototype._startSettingsInterval=function(){var e=this;if(!this._settingsInterval){var t=function(){e._pc?(e._applyConsumerSettings(),e._settingsInterval=window.setTimeout(t,2e3)):e._stopSettingsInterval()};this._settingsInterval=window.setTimeout(t,2e3)}},t.prototype._stopSettingsInterval=function(){this._settingsInterval&&(window.clearTimeout(this._settingsInterval),this._settingsInterval=null)},t.prototype._collectStat=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return this._pc?[4,Rt(this._pc,this._lastStat,this._ssrcMap)]:[2,Promise.reject()];case 1:return e=t.sent(),this._lastStat=e,[2,e]}}))}))},t.prototype._reportStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",{inbound:{topology:"SERVER",transport:e.transport,rtps:e.rtps.filter((function(e){return"inbound-rtp"===e.type}))},outbound:{topology:"SERVER",transport:e.transport,rtps:e.rtps.filter((function(e){return"outbound-rtp"===e.type}))}})},t.prototype._detectStaleTracks=function(e){var t=this,n=e.rtps.find((function(e){return"inbound-rtp"===e.type&&"audio"===e.kind&&"mix"===t._ssrcMap[e.ssrc]}));if(n){var r="audio-mix",i=this._statBytes[r],o=!1;if(i){var a=n.bytesReceived-i.bytesReceived;a>=0&&a<=5&&(o=!0),i.stalled!==o&&this._triggerEvent("REMOTE_ALL_STALL",o)}this._statBytes[r]={bytesReceived:n.bytesReceived,stalled:o}}},t.prototype._allocateConsumer=function(){if(this._signaling.ready){var e={estimatedPerformanceIndex:Ut.getEstimatedPerformanceIndex(),audioMix:!0,consumerUpdate:!0,producerNotificationDataChannelVersion:te.producerNotificationDataChannel?6:0,producerCommandDataChannelVersion:te.producerCommandDataChannel?2:0,consumerScreenDataChannelVersion:te.consumerScreenDataChannel?1:0,producerScreenDataChannelVersion:te.producerScreenDataChannel?1:0,onDemandTracks:te.onDemandTracks,unifiedPlan:t._isUnifiedPlanSupported(),singleSession:!0,videoTracksCount:te.videoTracksCount};this._signaling.allocateConsumer(null,e)}},t.prototype._acceptProducer=function(e){return l(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){if(this._producerOfferIsProcessing)return this._producerNextOffer=e,ue.debug("[single] wait until other remote offer is processed"),[2];if(this._producerOfferIsProcessing=!0,t=new RTCSessionDescription({type:"offer",sdp:e}),ue.debug("[single] set remote offer",{offer:t}),!this._pc)throw new Error("Interrupt allocation");return this._pc.setRemoteDescription(t).catch((function(e){throw ue.error("[single] unable to set remote offer",e),it.log("callError","setRemoteDescription-single"),e})).then((function(){return l(n,void 0,void 0,(function(){return h(this,(function(e){if(ue.debug("[single] create local answer"),!this._pc)throw new Error("Interrupt allocation");return[2,this._pc.createAnswer()]}))}))})).catch((function(e){throw ue.error("[single] unable to create answer",e),it.log("callError","createAnswer-single"),e})).then((function(e){return e.sdp=pe.patchSDP(e.sdp,!1,Ye.isBrokenH264(),!1),e})).then((function(e){return l(n,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:if(ue.debug("[single] set local answer",{answer:e}),!this._pc)throw new Error("Interrupt allocation");return[4,this._pc.setLocalDescription(e)];case 1:return t.sent(),[2,e]}}))}))})).catch((function(e){throw ue.error("[single] unable to set local answer",e),it.log("callError","setLocalDescription-single"),e})).then((function(e){return l(n,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return ue.debug("[single] transmit local answer",{answer:e}),this._updateSSRCMap(t),[4,this._signaling.acceptProducer(e,Object.keys(this._ssrcMap))];case 1:return n.sent(),ue.debug("[single] remote offer has been processed"),[2]}}))}))})).catch((function(e){ue.warn("[single] unable to send local answer",e),it.log("callError","acceptProducer")})).then((function(){if(n._producerOfferIsProcessing=!1,n._producerNextOffer){ue.debug("[single] there is other unprocessed remote offer, process it");var e=n._producerNextOffer;return n._producerNextOffer=null,n._acceptProducer(e)}})).catch((function(e){return n.close(e)})),[2]}))}))},t.prototype._onSignalingNotification=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:if(!this._isOpen)return[2];switch(e.notification){case"producer-updated":return[3,1];case"realloc-con":return[3,3];case"audio-activity":return[3,4];case"speaker-changed":return[3,5];case"stalled-activity":return[3,6];case"network-status":return[3,7]}return[3,8];case 1:return[4,this._onProducerUpdated(e)];case 2:return t.sent(),[3,8];case 3:return this._reconnect(),[3,8];case 4:return this._signalActiveParticipants(e.activeParticipants),[3,8];case 5:return this._signalSpeakerChanged(e.speaker),[3,8];case 6:return this._signalStalledParticipants(e.stalledParticipants),[3,8];case 7:return this._signalNetworkStatus(e.statuses),[3,8];case 8:return[2]}}))}))},t.prototype._onProducerUpdated=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this._producerSessionId&&this._producerSessionId!==e.sessionId&&this._reconnect(),te.breakVideoPayloadTypes&&(ue.log("test mode enabled, video switched off"),this._signaling.requestTestMode("breakVideoPayloadTypes")),this._producerSessionId=e.sessionId,[4,this._acceptProducer(e.description)];case 1:return t.sent(),[2]}}))}))},t.prototype._onAddTrack=function(e,t){var n=this;ue.debug("[single] remote track (added)",{track:t.track});var r=t.streams[0];r?(r.onremovetrack||(r.onremovetrack=function(e){n._triggerEvent("REMOTE_TRACK_REMOVED",r.id,r,e.track)}),r.getTracks().find((function(e){return e.id===t.track.id}))||r.addTrack(t.track),this._rtpReceiversByStreamId[r.id]=t.receiver,this._triggerEvent("REMOTE_TRACK_ADDED",r.id,r,t.track)):ue.error("[single] unable to get media stream from track event")},t._onSignalingStateChange=function(e,t){ue.debug("[single] signaling state changed",{state:e.signalingState},t)},t.prototype._onConnectionStateChange=function(e,t){switch(ue.debug("[single] connection state changed",{state:e.connectionState},t),it.log("callIceConnectionState",e.connectionState),e.connectionState){case"failed":this._reconnectionPrevented?this.close(new Error("Ice connection failed")):this._reconnect();break;case"connecting":var n=this.getState();"IDLE"===n||"OPENED"===n?this._setState("CONNECTING"):"checking"===e.iceConnectionState&&this._setState("RECONNECTING");break;case"disconnected":this._reconnectionPrevented?this.close(new Error("Ice connection disconnected")):this._setState("RECONNECTING");break;case"connected":this._setState("CONNECTED"),pe.getPeerConnectionHostInfo(e).then((function(e){e&&it.log("callIceConnectionType",e.type)}))}},t.prototype._onReplacedTrack=function(e,t){var n=this;this._pc&&(te.consumerScreenDataChannel&&t&&(e=t),this._pc.getSenders().forEach((function(t){t.track&&t.track.kind===e.kind&&!n._disabledSenders.has(t)&&(t.track.enabled=e.enabled,t.replaceTrack(e).catch((function(e){ue.error("ServerTransport: Unable to replace track",e),it.log("callError","replaceTrack-single")})))}))),this._applyConsumerSettings()},t._isUnifiedPlanSupported=function(){var e=Ye.baseChromeVersion();return e?te.isUnifiedPlanSupported("Chrome",e):te.isUnifiedPlanSupported(Ye.browserName(),Ye.browserVersion())},t.prototype.getStreamWaitingTimeMs=function(e,t){if(!this._pc)return it.log("patWaitingTimeError","noConnection"),ue.error("Cannot get stream waiting time, peer connection is not initialized"),0;var n=this._rtpReceiversByStreamId[e];if(!n)return it.log("patWaitingTimeError","noReceiver"),ue.error("Cannot get stream waiting time, cannot find RTP receiver by stream ID: "+e),0;var r=n.getSynchronizationSources();if(!r||!r.length)return ue.log("Cannot get stream waiting time, "+e+" receiver has no synchronization sources"),0;var i=r[0].rtpTimestamp;if(!Number.isInteger(i))return it.log("patWaitingTimeError","timestampNotInteger"),ue.error("Cannot get stream waiting time, "+e+" receiver's RTP timestamp is not an integer: "+i),0;var o=t-i&4294967295,a=Math.ceil(o/90);return Math.min(100,Math.max(0,a))},t}(g),Vt=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o._allocated=[],o._opened=[],o._directTransport=null,o._serverTransport=null,o._dtListeners=[],o._stListeners=[],o._states={},o._localState="IDLE",o._signaling=n,o._mediaSource=r,o._topology=t,o._serverSettings=i,o.subscribe(o._signaling,"NOTIFICATION",o._onSignalingNotification.bind(o)),"SERVER"===t&&(o._serverTransport=o._createServerTransport()),o}return d(t,e),t.prototype.updateSettings=function(e){this._serverSettings=e,this._directTransport&&this._directTransport.updateSettings(e),this._serverTransport&&this._serverTransport.updateSettings(e)},t.prototype.updateStatisticsInterval=function(){this._directTransport&&this._directTransport.updateStatisticsInterval(),this._serverTransport&&this._serverTransport.updateStatisticsInterval()},t.prototype.allocate=function(e,t){void 0===t&&(t=!1),-1===this._allocated.indexOf(e)?(this._allocated.push(e),"DIRECT"!==this._topology||this._directTransport||(this._directTransport=this._createDirectTransport(e,t)),"SERVER"!==this._topology||this._serverTransport||(this._serverTransport=this._createServerTransport())):ue.warn("The participant ["+e+"] has already had allocated transport")},t.prototype.open=function(e,t){void 0===t&&(t=null),-1===this._opened.indexOf(e)?-1!==this._allocated.indexOf(e)?(this._opened.push(e),"DIRECT"===this._topology&&this._directTransport&&this._directTransport.open(t),"SERVER"===this._topology&&this._serverTransport&&(this._serverTransport.open(),this._setState(e,this._serverTransport.getState()),this._setLocalState(this._serverTransport.getState())),ue.debug("The participant ["+e+"] transport opened")):ue.warn("The participant ["+e+"] has no allocated transport"):ue.warn("The participant ["+e+"] has already had opened transport")},t.prototype.close=function(e){var t,n=this._allocated.indexOf(e),r=this._opened.indexOf(e);n<0&&ue.warn("The participant ["+e+"] transport has already deallocated"),"DIRECT"===this._topology&&this._directTransport&&(this._directTransport.close(),this._directTransport=null),"SERVER"===this._topology&&(null===(t=this._serverTransport)||void 0===t||t.removeParticipant(e),this._setState(e,"CLOSED")),r>=0&&this._opened.splice(r,1),n>=0&&this._allocated.splice(n,1)},t.prototype.destroy=function(){this.unsubscribe(),this._dtListeners&&this._dtListeners.forEach((function(e){e.dispose()})),this._stListeners&&this._stListeners.forEach((function(e){e.dispose()})),this._directTransport&&(this._directTransport.close(),this._directTransport=null),this._serverTransport&&(this._serverTransport.close(),this._serverTransport=null),this._allocated=[],this._opened=[]},t.prototype.getTopology=function(){return this._topology},t.prototype.isAllocated=function(e){return this._allocated.indexOf(e)>=0},t.prototype.allocated=function(){return this._allocated.slice()},t.prototype.opened=function(){return this._opened.slice()},t.prototype._setStates=function(e,t){var n=this;e.forEach((function(e){n._setState(e,t)}))},t.prototype._setState=function(e,t){this._states[e]!==t&&(this._states[e]=t,this._triggerEvent("STATE_CHANGED",e,t))},t.prototype._setLocalState=function(e){this._localState!==e&&(this._localState=e,this._triggerEvent("LOCAL_STATE_CHANGED",e))},t.prototype._onSignalingNotification=function(e){return"topology-changed"===e.notification?this._onTopologyChanged(e):"record-started"===e.notification?this._onRecordStarted(e):void 0},t.prototype._onTopologyChanged=function(e){var t;if(e.topology!==this._topology){if(ue.log("Topology changed "+this._topology+" -> "+e.topology),it.log("callTopologyChangeRequested",e.topology),this._topology=e.topology,"SERVER"===this._topology&&(this._serverTransport?this._serverTransport.allowRestart():(this._serverTransport=this._createServerTransport(),this._opened.length>0&&(null===(t=this._directTransport)||void 0===t||t.preventRestart(),this._serverTransport.open()))),"DIRECT"===this._topology){var n=e.offerTo||[],r=e.offerToTypes||[],i=n.length&&r.length?pe.composeId(n[0],r[0]):null;if(this._serverTransport&&this._serverTransport.preventRestart(),!this._allocated||0===this._allocated.length)return void ue.error("Topology changed to DIRECT, but the list of allocated participants is empty");this._allocated.length>1&&ue.warn("Topology changed to DIRECT, but the allocated participants count more then one");var o=this._allocated[0];if(this._directTransport)this._directTransport.allowRestart();else{var a=i===o;this._directTransport=this._createDirectTransport(o,a)}this._opened.indexOf(o)>=0&&this._directTransport.open()}this._triggerEvent("TOPOLOGY_CHANGED",this._topology)}},t.prototype._onRecordStarted=function(e){this._serverTransport&&this._serverTransport.open()},t.prototype._createDirectTransport=function(e,t){void 0===t&&(t=!1);var n=new wt(e,t,this._signaling,this._mediaSource,this._serverSettings);return this._setLocalNoiseSuppression(!0),this._dtListeners&&this._dtListeners.length>0&&ue.warn("The list of direct listeners for the participant ["+e+"] is not empty"),this._dtListeners=[],this._dtListeners.push(n.addEventListener("REMOTE_TRACK_ADDED",this._onDirectRemoteTrackAdded.bind(this,e)),n.addEventListener("REMOTE_TRACK_REMOVED",this._onDirectRemoteTrackRemoved.bind(this,e)),n.addEventListener("REMOTE_DATA_STATS",this._onDirectRemoteDataStats.bind(this)),n.addEventListener("STATE_CHANGED",this._onDirectTransportChanged.bind(this,e)),n.addEventListener("NETWORK_STATUS",this._onTransportNetworkStatus.bind(this)),n.addEventListener("PEER_CONNECTION_CLOSED",this._onPeerConnectionClosed.bind(this,"DIRECT"))),n},t.prototype._createServerTransport=function(){var e=new jt(this._signaling,this._mediaSource,this._serverSettings);return this._setLocalNoiseSuppression(!1),this._stListeners&&this._stListeners.length>0&&ue.warn("The list of server transport listeners is not empty"),this._stListeners=[],this._stListeners.push(e.addEventListener("REMOTE_TRACK_ADDED",this._onServerRemoteTrackAdded.bind(this)),e.addEventListener("REMOTE_TRACK_REMOVED",this._onServerRemoteTrackRemoved.bind(this)),e.addEventListener("REMOTE_ALL_STALL",this._onServerRemoteAllStall.bind(this)),e.addEventListener("REMOTE_DATA_STATS",this._onServerRemoteDataStats.bind(this)),e.addEventListener("STATE_CHANGED",this._onServerTransportChanged.bind(this)),e.addEventListener("LOCAL_STATE_CHANGED",this._onServerTransportLocalChanged.bind(this)),e.addEventListener("ACTIVE_PARTICIPANTS_NO_SIGNAL",this._onTransportActiveParticipantsNoSignal.bind(this)),e.addEventListener("SIGNALLED_ACTIVE_PARTICIPANTS",this._onTransportActiveParticipants.bind(this)),e.addEventListener("SIGNALLED_SPEAKER_CHANGED",this._onTransportSpeakerChanged.bind(this)),e.addEventListener("SIGNALLED_STALLED_PARTICIPANTS",this._onTransportStalledParticipants.bind(this)),e.addEventListener("NETWORK_STATUS",this._onTransportNetworkStatus.bind(this)),e.addEventListener("REMOTE_STREAM_SECOND",this._onRemoteStreamSecond.bind(this)),e.addEventListener("PEER_CONNECTION_CLOSED",this._onPeerConnectionClosed.bind(this,"SERVER"))),e},t.prototype._releaseDirectTransport=function(e){this._directTransport&&(e&&this._directTransport.close(),this._directTransport=null),this._dtListeners&&(this._dtListeners.forEach((function(e){e.dispose()})),this._dtListeners=[])},t.prototype._releaseServerTransport=function(e){this._serverTransport&&(e&&this._serverTransport.close(),this._serverTransport=null),this._stListeners&&(this._stListeners.forEach((function(e){e.dispose()})),this._stListeners=[])},t.prototype._setLocalNoiseSuppression=function(e){var t;te.noiseSuppression!==e&&(te.noiseSuppression=e,null===(t=this._mediaSource)||void 0===t||t.updateNoiseSuppression())},t.prototype._onDirectTransportChanged=function(e,t){if("CONNECTED"===t&&"DIRECT"===this._topology&&this._releaseServerTransport(!0),("CLOSED"===t||"FAILED"===t)&&(this._releaseDirectTransport(!1),"DIRECT"===this._topology)){var n=this._opened.indexOf(e);n>=0&&this._opened.splice(n,1);var r=this._allocated.indexOf(e);r>=0&&this._allocated.splice(r,1)}"DIRECT"===this._topology&&(this._setState(e,t),this._setLocalState(t))},t.prototype._onServerTransportChanged=function(e){var t=this._opened.slice();"CONNECTED"===e&&"SERVER"===this._topology&&this._releaseDirectTransport(!0),"CLOSED"!==e&&"FAILED"!==e||this._releaseServerTransport(!1),"SERVER"===this._topology&&this._setStates(t,e)},t.prototype._onServerTransportLocalChanged=function(e){"SERVER"===this._topology&&("CLOSED"!==e&&"FAILED"!==e||(this._allocated=[],this._opened=[]),this._setLocalState(e))},t.prototype._onTransportActiveParticipantsNoSignal=function(){this._triggerEvent("ACTIVE_PARTICIPANTS_NO_SIGNAL")},t.prototype._onTransportActiveParticipants=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_ACTIVE_PARTICIPANTS",e)},t.prototype._onTransportStalledParticipants=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_STALLED_PARTICIPANTS",e)},t.prototype._onTransportSpeakerChanged=function(e){"SERVER"===this._topology&&this._triggerEvent("SIGNALLED_SPEAKER_CHANGED",e)},t.prototype._onTransportNetworkStatus=function(e){this._triggerEvent("NETWORK_STATUS",e)},t.prototype._onRemoteStreamSecond=function(e,t){this._triggerEvent("REMOTE_STREAM_SECOND",e,t)},t.prototype._onPeerConnectionClosed=function(e){this._triggerEvent("PEER_CONNECTION_CLOSED",e)},t.prototype._onServerRemoteAllStall=function(e){"SERVER"===this._topology&&this._triggerEvent("REMOTE_ALL_STALL",e)},t.prototype._onServerRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onDirectRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onDirectRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype._onDirectRemoteDataStats=function(e){this._triggerEvent("REMOTE_DATA_STATS",e)},t.prototype._onServerRemoteTrackAdded=function(e,t,n){this._triggerEvent("REMOTE_TRACK_ADDED",e,t,n)},t.prototype._onServerRemoteTrackRemoved=function(e,t,n){this._triggerEvent("REMOTE_TRACK_REMOVED",e,t,n)},t.prototype.getStreamWaitingTimeMs=function(e,t){return"SERVER"!==this._topology?(it.log("patWaitingTimeError","wrongTopology"),ue.error("Cannot get stream waiting time, incorrect topology: "+this._topology),0):this._serverTransport?this._serverTransport.getStreamWaitingTimeMs(e,t):(it.log("patWaitingTimeError","noTransport"),ue.error("Cannot get stream waiting time, server transport is not initialized"),0)},t}(g),Ft=function(e){function t(t){var n=e.call(this)||this;return n._detector=null,n._interval=null,n.subscribe(t,"REMOTE_TRACK_ADDED",n._onRemoteTrackAdded.bind(n)),n.subscribe(t,"REMOTE_TRACK_REMOVED",n._onRemoteTrackRemoved.bind(n)),n.subscribe(t,"SIGNALLED_ACTIVE_PARTICIPANTS",n._onSignalledActiveParticipants.bind(n)),n.subscribe(t,"ACTIVE_PARTICIPANTS_NO_SIGNAL",n._onActiveParticipantsNoSignal.bind(n)),n}return d(t,e),t.prototype.destroy=function(){var e;this._interval&&(window.clearTimeout(this._interval),this._interval=null),this.unsubscribe(),null===(e=this._detector)||void 0===e||e.destroy(),this._detector=null},t.prototype._onRemoteTrackAdded=function(e,t,n){var r,i=this;if("audio"===n.kind&&(null===(r=this._detector)||void 0===r||r.destroy(),this._detector=new ut(e,t),!this._interval)){var o=function(){i._collectVolumes(),i._interval=window.setTimeout(o,te.voiceParams.interval)};this._interval=window.setTimeout(o,te.voiceParams.interval)}},t.prototype._onRemoteTrackRemoved=function(e,t,n){"audio"===n.kind&&this._detector&&this._detector.stream===t&&(this._detector.destroy(),this._detector=null)},t.prototype._collectVolumes=function(){if(this._detector){var e={},t=this._detector.trackId,n=this._detector.getLevel()||0;if("audio-mix"===t){if(this._activeParticipants)for(var r=0,i=this._activeParticipants;r<i.length;r++)e[i[r]]=n}else e[t]=n;this._triggerEvent("VOLUMES_DETECTED",e)}},t.prototype._onSignalledActiveParticipants=function(e){this._activeParticipants=e},t.prototype._onActiveParticipantsNoSignal=function(){this._activeParticipants=null},t}(g),Gt=function(e){function t(t,n,r){var i=e.call(this)||this;return i._mediaSource=null,i._conversation=null,i._state="IDLE",i._participantState="CALLED",i._participants={},i._transport=null,i._debugInfo=null,i._volumesDetector=null,i._speakerDetector=null,i._localVolumeDetector=null,i._specListener=null,i._activeSpeakerId=null,i._lastSignalledActiveSpeakerId=null,i._serverSettings={camera:null,screenSharing:null},i._signalingServerSettings={camera:null,screenSharing:null},i._lastStalled={},i._remoteAllStalled=!1,i._audioFix=null,i._streamByStreamId=new Map,i._streamIdByStreamDescription=new Map,i._streamWaitTimerByStreamDescription=new Map,i._sequenceNumberByStreamDescription=new Map,i._cooldownTimestampByStreamDescription=new Map,it.create(t,r),i._api=t,i._signaling=n,i._onUnload=function(){i._conversation&&i._api&&i._api.hangupConversation(i._conversation.id),it.destroy()},window.addEventListener("unload",i._onUnload),i._audioOutput=new at,te.videoTracksCount>0&&(i._cooldownQueueCleanupTimer=window.setInterval(i._cleanupCooldownQueue.bind(i),1e3)),i}return d(t,e),t.current=function(){return t._current},t.hangupAfterInit=function(){t._activationMutex&&!t._current&&(t._delayedHangup=!0)},t.id=function(){var e,n;return(null===(n=null===(e=t._current)||void 0===e?void 0:e._conversation)||void 0===n?void 0:n.id)||null},t.prototype.onStart=function(e,n,r,i,o,a){return void 0===i&&(i=""),void 0===o&&(o=!1),void 0===a&&(a=!1),l(this,void 0,void 0,(function(){var s,c,u,d,p,l,f,v;return h(this,(function(h){switch(h.label){case 0:if(t._activationMutex)throw it.log("callError","startCall"),ue.warn("Conversation: there is already running activation"),new ct(A.FAILED);t._activationMutex=!0,h.label=1;case 1:return h.trys.push([1,8,9,10]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(r)];case 2:return h.sent(),s=this._mediaSource.getMediaSettings(),n===E.CHAT||e.length>1?this._logWithMediaSettings("callStartMultiparty",s):this._logWithMediaSettings("callStart",s),[4,this._startConversation(e,n,"OUTGOING",r,i,o,a)];case 3:if(c=h.sent(),!this._conversation)throw new ct(A.UNKNOWN_ERROR);return this._participantState="ACCEPTED",this._signaling.changeMediaSettings(s),[4,this._registerParticipants(c.conversation.participants)];case 4:if(h.sent(),this._processConnectionData(c),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),t._delayedHangup)throw new ct(A.CANCELED);if(ue.debug("Outgoing call",{opponentIds:e,opponentType:n,mediaOptions:r}),u=Object.values(this._participants),d=void 0,te.batchParticipantsOnStart&&(d=pe.mapSharedParticipants(u)),se.onLocalStream(this._mediaSource.getStream(),this._mediaSource.getMediaSettings()),se.onConversation(this._conversation.externalId,this._conversation.mediaModifiers,d),se.onLocalStatus(Q.WAITING),this._toggleJoinAvailability(),this._changeFeatureSet(),this._changeNeedRate(),t._current=this,this._conversation.concurrent)return[3,5];if(!te.batchParticipantsOnStart)for(p=0,l=u;p<l.length;p++)f=l[p],se.onParticipantStatus(f.externalId,Q.WAITING);return[3,7];case 5:return[4,this._acceptConcurrent()];case 6:h.sent(),h.label=7;case 7:return[2,this._conversation];case 8:throw v=h.sent(),this._close(v,"Unable to start conversation"),v;case 9:return t._activationMutex=!1,[7];case 10:return[2]}}))}))},t.prototype.onJoin=function(e){return l(this,void 0,void 0,(function(){var n,r,i;return h(this,(function(o){switch(o.label){case 0:if(t._activationMutex)throw it.log("callError","joinCall"),ue.warn("Conversation: there is already running activation"),new ct(A.FAILED);t._activationMutex=!0,this._state="PROCESSING",o.label=1;case 1:return o.trys.push([1,4,,5]),this._mediaSource=this._createMediaSource(),[4,this._mediaSource.request(e.mediaOptions)];case 2:return o.sent(),n=this._mediaSource.getMediaSettings(),this._logWithMediaSettings("callJoinConversation",n),[4,this._joinConversation(e)];case 3:if(r=o.sent(),!this._conversation)throw new ct(A.UNKNOWN_ERROR);return se.onLocalStream(this._mediaSource.getStream(),n),this._conversation.waitingHall?(ue.log("In waiting hall"),t._current=this,t._activationMutex=!1,this._signaling.readyToSend(),se.onLocalStatus(Q.WAITING_HALL),[2,this._conversation]):[2,this._onJoinPart2(r)];case 4:throw i=o.sent(),t._activationMutex=!1,this._close(i,"Unable to join conversation"),i;case 5:return[2]}}))}))},t.prototype._onJoinPart2=function(e){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s;return h(this,(function(c){switch(c.label){case 0:ue.debug("Join conversation part 2"),t._activationMutex=!0,c.label=1;case 1:if(c.trys.push([1,3,4,5]),this._participantState="ACCEPTED",!this._conversation||!this._mediaSource)throw new ct(A.UNKNOWN_ERROR);return this._signaling.changeMediaSettings(this._mediaSource.getMediaSettings()),[4,this._registerParticipants(e.conversation.participants)];case 2:if(c.sent(),this._processConnectionData(e),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),t._delayedHangup)throw new ct(A.CANCELED);for(n=Object.values(this._participants),r=void 0,te.batchParticipantsOnStart&&(r=pe.mapSharedParticipants(n)),se.onConversation(this._conversation.externalId,this._conversation.mediaModifiers,r),se.onLocalStatus(Q.WAITING),this._toggleJoinAvailability(),this._changeNeedRate(),this._state="ACTIVE",this._changeFeatureSet(),t._current=this,i=0,o=n;i<o.length;i++)a=o[i],te.batchParticipantsOnStart||se.onParticipantStatus(a.externalId,Q.WAITING),"CALLED"!==a.state&&"ACCEPTED"!==a.state||this._transport&&!this._transport.isAllocated(a.id)&&this._transport.allocate(a.id,!1),this._transport&&"ACCEPTED"===a.state&&this._transport.open(a.id,null);return[2,this._conversation];case 3:throw s=c.sent(),this._close(s,"Unable to join conversation"),s;case 4:return t._activationMutex=!1,[7];case 5:return[2]}}))}))},t.prototype.onPush=function(e,n,r){return void 0===n&&(n="USER"),l(this,void 0,void 0,(function(){var i,o,a=this;return h(this,(function(s){switch(s.label){case 0:if(t._activationMutex)throw ue.warn("Conversation: there is already running activation"),new ct(A.REJECTED);t._activationMutex=!0,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,this._prepareConversation(e,n,r)];case 2:if(i=s.sent(),this._mediaSource=this._createMediaSource(),!this._conversation)throw new ct(A.UNKNOWN_ERROR);if(!i.conversation.participants.find((function(e){var t;return"CALLED"===e.state&&e.id===(null===(t=a._conversation)||void 0===t?void 0:t.userId)})))throw ue.log("Push rejected (there is an active call)"),it.log("callPush","rejected"),new ct(A.REJECTED);return[4,this._registerParticipants(i.conversation.participants)];case 3:if(s.sent(),this._processConnectionData(i),this._allocateTransport(),this._createSpeakerDetector(),this._createSpecListener(),this._signaling.readyToSend(),it.log("callPush","accepted"),t._current=this,t._delayedHangup)throw new ct(A.CANCELED);return t._activationMutex=!1,[3,5];case 4:throw o=s.sent(),t._activationMutex=!1,this._close(o,"Unable to handle inbound call push"),o;case 5:return[2]}}))}))},t.prototype._isInWaitingHall=function(e){if(!e.conversation)return!1;if((e.conversation.options||[]).indexOf(R.WAITING_HALL)<0)return!1;var t=(e.conversation.participants||[]).find((function(t){return pe.comparePeerId(t.peerId,e.peerId)}));return t&&t.restricted||!1},t.prototype._acceptConcurrent=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:if(!this._mediaSource||!this._conversation)throw new ct(A.UNKNOWN_ERROR);this._state="PROCESSING",e=this._mediaSource.getMediaSettings(),this._logWithMediaSettings("callAcceptConcurrent",e),ue.debug("Concurrent call",{conversationId:this._conversation.id}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._signaling.acceptCall(this._mediaSource.getMediaSettings())];case 2:for(o.sent(),se.onCallAccepted(),this._state="ACTIVE",this._participantState="ACCEPTED",this._changeFeatureSet(),t=0,n=Object.values(this._participants);t<n.length;t++)"CALLED"!==(r=n[t]).state&&"ACCEPTED"!==r.state||this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!0),this._transport&&"ACCEPTED"===r.state&&this._transport.open(r.id);return[3,4];case 3:return i=o.sent(),this._close(i,"Unable to accept concurrent call"),[3,4];case 4:return[2]}}))}))},t.prototype.accept=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return h(this,(function(c){switch(c.label){case 0:if("IDLE"!==this._state)throw it.log("callError","acceptIncoming"),ue.error("Unable to accept a call - invalid state"),new Error("Unable to accept a call - invalid state");if(!this._mediaSource||!this._conversation)throw new ct(A.UNKNOWN_ERROR);this._state="PROCESSING",ue.debug("Accept incoming call",e),c.label=1;case 1:return c.trys.push([1,6,,7]),[4,this._mediaSource.request(e)];case 2:return c.sent(),t=this._mediaSource.getMediaSettings(),this._logWithMediaSettings("callAcceptIncoming",t),this._signaling.changeMediaSettings(t),[4,this._signaling.acceptCall(t)];case 3:return c.sent(),this._participantState="ACCEPTED",n=Object.values(this._participants),r=void 0,te.batchParticipantsOnStart&&(r=pe.mapSharedParticipants(n)),se.onCallAccepted(),se.onLocalStream(this._mediaSource.getStream(),t),se.onConversation(this._conversation.externalId,this._conversation.mediaModifiers,r),se.onLocalStatus(Q.WAITING),this._toggleJoinAvailability(),this._changeNeedRate(),"MUTE"!==this._conversation.muteState&&"MUTE_PERMANENT"!==this._conversation.muteState?[3,5]:[4,this._processMuteState()];case 4:c.sent(),c.label=5;case 5:for(this._state="ACTIVE",this._changeFeatureSet(),i=0,o=n;i<o.length;i++)"CALLED"!==(a=o[i]).state&&"ACCEPTED"!==a.state||this._transport&&!this._transport.isAllocated(a.id)&&this._transport.allocate(a.id,!0),this._transport&&"ACCEPTED"===a.state&&this._transport.open(a.id),te.batchParticipantsOnStart||se.onParticipantStatus(a.externalId,Q.WAITING);return[2,this._conversation];case 6:throw s=c.sent(),this._close(s,"Unable to accept call"),s;case 7:return[2]}}))}))},t.prototype.decline=function(){var e;return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:if("IDLE"!==this._state)throw it.log("callError","declineIncoming"),ue.error("Unable to decline a call - invalid state"),new Error("Unable to decline a call - invalid state");return this._state="PROCESSING",ue.debug("Decline incoming call"),this._logWithMediaSettings("callDeclineIncoming",null===(e=this._mediaSource)||void 0===e?void 0:e.getMediaSettings()),this._participantState="HUNGUP",this._signaling.ready?[4,this._signaling.hangup(A.REJECTED)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this._close(new ct(A.REJECTED)),[2]}}))}))},t.prototype.hangup=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return ue.debug("Hangup"),e="ACTIVE"===this._state?A.HUNGUP:A.CANCELED,it.log("callHangup",e),this._signaling.ready?[4,this._signaling.hangup(e)]:[3,2];case 1:return t.sent(),this._close(new ct(e)),[3,3];case 2:se.onHangup(new ct(A.HUNGUP),this._conversation&&this._conversation.id),t.label=3;case 3:return[2]}}))}))},t.prototype.addParticipant=function(e,t){return l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return this._signaling.ready?[4,this._signaling.addParticipant(e,t)]:(this._close(new ct(A.UNKNOWN_ERROR),"Unable to add participant"),[2]);case 1:return n=i.sent(),r=null,"error"===n.type&&(r="call-unfeasible"===n.error?n.status:A.UNKNOWN_ERROR),[4,this._onAddParticipant(e,r)];case 2:return i.sent(),[2]}}))}))},t.prototype.removeParticipant=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return this._signaling.ready?[4,this._signaling.removeParticipant(e,t)]:[3,2];case 1:n.sent(),this._onRemoveParticipant(e),n.label=2;case 2:return[2]}}))}))},t.prototype.setVolume=function(e){this._audioOutput.volume=e},t.prototype.updateStatisticsInterval=function(){this._transport&&this._transport.updateStatisticsInterval()},t.prototype._close=function(e,n){n&&ue.error(n,e),ue.debug("Close conversation",e),e.error?this._signaling.ready&&this._signaling.hangup(A.FAILED):it.log("callError",e.hangup),t._activationMutex=!1;var r=this._conversation&&this._conversation.id;return-1!==[A.CANCELED,A.NOT_FRIENDS,A.CALLEE_IS_OFFLINE,A.CALLER_IS_BLOCKED].indexOf(e.hangup)||e.hangup===A.REJECTED&&!e.remote?(se.onHangup(e,r),void this.destroy()):(e.hangup!==A.HUNGUP||e.remote&&"CALLED"!==this._participantState)&&(e.hangup!==A.MISSED||e.remote)?e.hangup===A.SOCKET_CLOSED&&t._current&&!this._conversation?(this._cleanupSignaling(),void this._cleanupMediaSource()):e.hangup!==A.BUSY||e.remote?(this._state="CLOSE",this._participantState="HUNGUP",this._changeFeatureSet(),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupParticipantAgnosticStreams(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._api.cleanup(),it.destroy(),this._conversation=null,t._current=null,t._delayedHangup=!1,void se.onHangup(e||new ct(A.UNKNOWN_ERROR),r)):(this._cleanupSignaling(),void this._cleanupMediaSource()):(se.onHangup(e,r),void this.destroy())},t.prototype.destroy=function(){var e=this._conversation&&this._conversation.id;ue.debug("Destroy conversation",{conversationId:e}),this._cleanupMediaSource(),this._cleanupParticipants(),this._cleanupParticipantAgnosticStreams(),this._cleanupTransport(),this._cleanupSpeakerDetector(),this._cleanupSpecListener(),this._cleanupSignaling(),this._api.cleanup(),this._cleanupListeners(),it.destroy(),this._conversation=null,t._current=null,t._delayedHangup=!1},t.prototype._getConversationParams=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return[4,this._api.getConversationParams()];case 1:return e=o.sent(),ue.debug("Api.getConversationParams",e),t=[],n=e.turn_server,(r=e.stun_server)&&t.push(r),n&&((i=n.urls.filter((function(e,t,n){return n.indexOf(e)===t}))).forEach((function(e){return i.push(e+"?transport=tcp")})),t.push({urls:i,username:n.username,credential:n.credential})),te.iceServers=t,te.wssBase=e.endpoint,te.wssToken=e.token,e.client_type&&(te.clientType=e.client_type),[2]}}))}))},t.prototype._startConversation=function(e,t,n,r,i,o,a){return void 0===i&&(i=""),void 0===o&&(o=!1),void 0===a&&(a=!1),l(this,void 0,void 0,(function(){var s,c,u,d;return h(this,(function(p){switch(p.label){case 0:return s=pe.uuid(),ue.debug("Conversation: start",{conversationId:s,opponentIds:e,opponentType:t,direction:n}),c=r.includes(k.VIDEO),[4,this._api.startConversation(s,e,t,c,i,o,a)];case 1:return u=p.sent(),ue.debug("Api.startConversation",u),[4,this._getConversationParams()];case 2:return p.sent(),[4,this._connectSignaling(N.START,u)];case 3:return d=p.sent(),[4,this._setConversation(u,d,n)];case 4:return p.sent(),[2,d]}}))}))},t.prototype._joinConversation=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return h(this,(function(c){switch(c.label){case 0:return t=e.conversationId,n=e.mediaOptions,r=e.chatId,i=e.joinLink,ue.debug("Conversation: join",{conversationId:t,joinLink:i}),o=n.includes(k.VIDEO),t?[4,this._api.joinConversation(t,o,r)]:[3,2];case 1:return a=c.sent(),[3,5];case 2:return i?[4,this._api.joinConversationByLink(i,o)]:[3,4];case 3:return a=c.sent(),[3,5];case 4:throw new ct(A.UNKNOWN_ERROR);case 5:return ue.debug("Api.joinConversation",a),[4,this._getConversationParams()];case 6:return c.sent(),[4,this._connectSignaling(N.JOIN,a)];case 7:return s=c.sent(),[4,this._setConversation(a,s,"JOINING")];case 8:return c.sent(),[2,s]}}))}))},t.prototype._prepareConversation=function(e,n,r){return void 0===n&&(n="USER"),l(this,void 0,void 0,(function(){var i,o,a;return h(this,(function(s){switch(s.label){case 0:return ue.debug("Conversation: push",{conversationId:e,type:n,peerId:r}),[4,this._getConversationParams()];case 1:if(s.sent(),!(i=this._api.getUserId()))throw new ct(A.UNKNOWN_ERROR);return o={id:e,peerId:r,endpoint:te.wssBase+"?userId="+i+"&entityType="+n+"&conversationId="+e+"&token="+te.wssToken,is_concurrent:!1,p2p_forbidden:!1},[4,this._connectSignaling(N.ACCEPT,o)];case 2:return a=s.sent(),!t._current||"ACCEPTED"!==t._current._participantState&&"CALLED"!==t._current._participantState?(t._current&&(t._current.destroy(),t._current=null),[4,this._setConversation(o,a,"INCOMING",n)]):(ue.log("Push rejected (busy)"),it.log("callPush","busy"),this._signaling.ready&&this._signaling.hangup(A.BUSY),[2,Promise.reject({hangup:A.BUSY})]);case 3:return s.sent(),[2,a]}}))}))},t.prototype._createParticipant=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return t=Object.assign({id:null,externalId:null,mediaSettings:Xe(),participantState:{},state:"CALLED",remoteStream:null,mediaSource:null,platform:null,clientType:null,roles:[],networkRating:1,lastRequestedLayouts:{}},e),e.externalId?(this._api.cacheExternalId(t.id,e.externalId),[3,3]):[3,1];case 1:return n=t,[4,this._getUserId(t.id)];case 2:n.externalId=r.sent(),r.label=3;case 3:return[2,t]}}))}))},t.prototype._getUserId=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._api.userId(e)];case 1:return[2,n.sent()];case 2:throw t=n.sent(),this._close(new ct(A.NETWORK_ERROR),t),t;case 3:return[2]}}))}))},t.prototype._setConversation=function(e,t,n,r){return void 0===r&&(r="USER"),l(this,void 0,void 0,(function(){var i,o,a,s,c;return h(this,(function(u){switch(u.label){case 0:return i=t.conversation.participants.map((function(e){return e.id})),[4,this._api.prepareUserIds(i)];case 1:if(u.sent(),!(o=this._api.getUserId())){if(!(a=(t.conversation.participants||[]).find((function(e){return pe.comparePeerId(e.peerId,t.peerId)}))))throw new ct(A.UNKNOWN_ERROR);o=Number(a.id),a.idType&&(r=a.idType),this._api.setUserId(o)}return s=pe.composeId(o,r),[4,this._getUserId(s)];case 2:return c=u.sent(),this._conversation={userId:o,compositeUserId:s,externalId:c,acceptTime:t.conversation.acceptTime,features:t.conversation.features||[],id:t.conversation.id||e.id,participantsLimit:t.conversation.participantsLimit||30,topology:t.conversation.topology||"DIRECT",direction:n,concurrent:t.isConcurrent||e.is_concurrent||!1,needRate:!1,chatId:t.conversation.multichatId,roles:[],recordInfo:null,joinLink:e.join_link,pinnedParticipantId:null,mediaModifiers:t.mediaModifiers,options:[],muteState:"UNMUTE",muteOptions:[],networkRating:1,waitingHall:this._isInWaitingHall(t)},this._signaling.setConversationId(e.id),e.p2p_forbidden&&(te.forceRelayPolicy=e.p2p_forbidden),it.log("callForceRelay",te.forceRelayPolicy?"1":"0"),this._changeFeatureSet(),this._logDevices(),[2]}}))}))},t.prototype._updateConversation=function(e){if(!this._conversation)throw new ct(A.UNKNOWN_ERROR);this._conversation.acceptTime=e.conversation.acceptTime,this._conversation.features=e.conversation.features||[],this._conversation.participantsLimit=e.conversation.participantsLimit||30,this._conversation.topology=e.conversation.topology||"DIRECT",this._conversation.concurrent=e.isConcurrent||!1,this._conversation.chatId=e.conversation.multichatId,this._conversation.mediaModifiers=e.mediaModifiers,this._conversation.waitingHall=!1},t.prototype._createMediaSource=function(){var e=new pt;return this.subscribe(e,"SOURCE_CHANGED",this._onLocalMediaStreamChanged.bind(this)),this.subscribe(e,"SCREEN_STATUS",this._onScreenSharingStatus.bind(this)),this._audioFix=new ot(e),e},t.prototype._connectSignaling=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return this._signaling.setEndpoint(t.endpoint),this.subscribe(this._signaling,"NOTIFICATION",this._onSignalingNotification.bind(this)),this.subscribe(this._signaling,"FAILED",this._onSignalingFailed.bind(this)),this.subscribe(this._signaling,"RECONNECT",this._onSignalingReconnect.bind(this)),[2,this._signaling.connect(e,t)]}))}))},t.prototype._registerParticipants=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a;return h(this,(function(s){switch(s.label){case 0:if(!this._conversation)return[2];t=0,n=e,s.label=1;case 1:return t<n.length?(r=n[t],(i=pe.composeParticipantId(r))===this._conversation.compositeUserId?(this._conversation.roles=r.roles||[],this._conversation.roles.length&&(ue.debug("Local roles changed: "+r.roles),se.onLocalRolesChanged(this._conversation.roles)),[3,3]):"HUNGUP"===r.state||"REJECTED"===r.state?(this._participants[r.id]&&this._removeParticipant(this._participants[r.id],A.HUNGUP),[3,3]):(o=this._participants,a=i,[4,this._createParticipant({id:i,externalId:r.externalId&&Je.fromSignaling(r.externalId),mediaSettings:Xe(r.mediaSettings),participantState:pe.mapParticipantState(r),state:r.state,roles:r.roles||[]})])):[3,4];case 2:o[a]=s.sent(),r.roles&&r.roles.length&&(ue.debug("Roles for participant ["+i+"] changed: "+r.roles),se.onRolesChanged(this._participants[i].externalId,r.roles)),s.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype._processConnectionData=function(e){!e.muteOptions||"MUTE"!==e.muteState&&"MUTE_PERMANENT"!==e.muteState||this._onMuteParticipant(e.muteOptions,!1,e.muteState),e.conversation.pinnedParticipantId&&this._onPinParticipant(e.conversation.pinnedParticipantId),this._onRecordInfo(e.conversation.recordInfo),this._onOptionsChanged(e.conversation.options),e.chatRoom&&e.chatRoom.totalCount&&this._onChatRoomUpdated(C.ATTENDEE,e.chatRoom.totalCount,e.chatRoom.firstParticipants)},t.prototype._allocateTransport=function(){if(this._conversation&&this._mediaSource){this._transport=new Vt(this._conversation.topology,this._signaling,this._mediaSource,this._serverSettings),this._debugInfo=new st,this.subscribe(this._transport,"STATE_CHANGED",this._onTransportStateChanged.bind(this)),this.subscribe(this._transport,"LOCAL_STATE_CHANGED",this._onTransportLocalStateChanged.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_ADDED",this._onRemoteTrackAdded.bind(this)),this.subscribe(this._transport,"REMOTE_TRACK_REMOVED",this._onRemoteTrackRemoved.bind(this)),this.subscribe(this._transport,"REMOTE_ALL_STALL",this._onRemoteAllStall.bind(this)),this.subscribe(this._transport,"REMOTE_DATA_STATS",this._onRemoteDataStats.bind(this)),this.subscribe(this._transport,"SIGNALLED_STALLED_PARTICIPANTS",this._onRemoteSignalledStall.bind(this)),this.subscribe(this._transport,"ACTIVE_PARTICIPANTS_NO_SIGNAL",this._onRemoteActivityNoSignal.bind(this)),this.subscribe(this._transport,"TOPOLOGY_CHANGED",this._onTopologyChanged.bind(this)),this.subscribe(this._transport,"NETWORK_STATUS",this._onNetworkStatus.bind(this)),this.subscribe(this._transport,"REMOTE_STREAM_SECOND",this._onRemoteStreamSecond.bind(this)),this.subscribe(this._transport,"PEER_CONNECTION_CLOSED",this._onPeerConnectionClosed.bind(this));for(var e="OUTGOING"===this._conversation.direction&&!this._conversation.concurrent,t=0,n=Object.values(this._participants);t<n.length;t++){var r=n[t];"ACCEPTED"!==r.state&&"CALLED"!==r.state||this._transport.allocate(r.id,e)}}},t.prototype._createSpeakerDetector=function(){this._transport&&(this._volumesDetector=new Ft(this._transport),this.subscribe(this._volumesDetector,"VOLUMES_DETECTED",this._onVolumesDetected.bind(this)),this._speakerDetector=new lt(this._volumesDetector,this._transport),this.subscribe(this._speakerDetector,"SPEAKER_CHANGED",this._onSpeakerChanged.bind(this)),this._localVolumeDetector=new dt(this._mediaSource))},t.prototype._createSpecListener=function(){this._transport&&this._volumesDetector&&(this._specListener=new ht(this._transport,this._volumesDetector,this._participants))},t.prototype._logDevices=function(){var e=Ye.getCameras().length,t=Ye.getMicrophones().length;ue.debug("Cameras: "+e+(Ye.hasCameraPermission()?"✔":"✖")+", Microphones: "+t+(Ye.hasMicrophonePermission()?"✔":"✖")),it.log("callDevices",e+"_"+t)},t.prototype._logWithMediaSettings=function(e,t){it.log(e,[(null==t?void 0:t.isAudioEnabled)&&"audio",(null==t?void 0:t.isVideoEnabled)&&"video"].filter(Boolean).join("_"))},t.prototype._removeParticipant=function(e,t){var n;"CALLED"!==e.state&&"ACCEPTED"!==e.state&&"CLOSE"!==this._state&&this._participants[e.id]&&(t===A.HUNGUP?se.onParticipantStatus(e.externalId,Q.HANGUP):se.onParticipantStatus(e.externalId,Q.ERROR,t),null===(n=e.mediaSource)||void 0===n||n.disconnect(),this._conversation&&this._conversation.pinnedParticipantId===e.id&&(this._conversation.pinnedParticipantId=null),this.updateDisplayLayout([{uid:e.externalId,mediaType:ze.CAMERA,stopStream:!0}]),delete this._participants[e.id],se.onRemoteRemoved(e.externalId))},t.prototype._cleanupListeners=function(){this.unsubscribe(),window.removeEventListener("unload",this._onUnload)},t.prototype._cleanupMediaSource=function(){this._mediaSource&&(this._mediaSource.destroy(),this._mediaSource=null)},t.prototype._cleanupParticipants=function(){Object.values(this._participants).forEach((function(e){var t,n,r;null===(t=e.remoteStream)||void 0===t||t.getTracks().forEach((function(e){return e.stop()})),null===(n=e.secondStream)||void 0===n||n.getTracks().forEach((function(e){return e.stop()})),null===(r=e.mediaSource)||void 0===r||r.disconnect()})),this._participants={},this._audioOutput&&this._audioOutput.destroy()},t.prototype._cleanupParticipantAgnosticStreams=function(){ue.debug("cleaning up participant-agnostic streams"),this._streamByStreamId.forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))})),this._streamByStreamId=new Map,this._streamWaitTimerByStreamDescription.forEach((function(e){window.clearTimeout(e)})),this._streamWaitTimerByStreamDescription=new Map,this._streamIdByStreamDescription=new Map,this._sequenceNumberByStreamDescription=new Map,this._cooldownTimestampByStreamDescription=new Map,window.clearInterval(this._cooldownQueueCleanupTimer)},t.prototype._cleanupTransport=function(){this._transport&&(this._transport.destroy(),this._transport=null),this._debugInfo&&(this._debugInfo=null)},t.prototype._cleanupSpeakerDetector=function(){this._speakerDetector&&(this._speakerDetector.destroy(),this._speakerDetector=null),this._volumesDetector&&(this._volumesDetector.destroy(),this._volumesDetector=null),this._localVolumeDetector&&(this._localVolumeDetector.destroy(),this._localVolumeDetector=null)},t.prototype._cleanupSpecListener=function(){this._specListener&&(this._specListener.destroy(),this._specListener=null)},t.prototype._cleanupSignaling=function(){this._signaling.close(),this._signaling.cleanup()},t.prototype._onAddParticipant=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i;return h(this,(function(o){switch(o.label){case 0:return ue.debug("Add new participant ["+e+"]"),!(n=this._participants[e])||"ACCEPTED"!==n.state&&"CALLED"!==n.state?n?[3,2]:(r=this._participants,i=e,[4,this._createParticipant({id:e})]):(ue.warn("Participant ["+n.id+":"+n.state+"] is already in conversation"),[2]);case 1:r[i]=o.sent(),n=this._participants[e],o.label=2;case 2:return se.onParticipantStatus(n.externalId,Q.WAITING),t?(n.state="HUNGUP",this._removeParticipant(n,t)):this._transport&&(n.state="CALLED",this._transport.allocate(n.id,!0),it.log("callAddParticipant")),[2]}}))}))},t.prototype._onRemoveParticipant=function(e){ue.debug("Remove participant ["+e+"]");var t=this._participants[e];t?(this._transport&&this._transport.close(t.id),it.log("callRemoveParticipant")):ue.warn("Participant ["+e+"] isn't in conversation")},t.prototype.changeDevice=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return"audiooutput"===e?[2,this._audioOutput.changeOutput()]:this._mediaSource?("audioinput"===e&&(this._audioFix=new ot(this._mediaSource)),[2,this._mediaSource.changeDevice(e)]):[2,Promise.reject(I.UNKNOWN)]}))}))},t.prototype.toggleScreenCapturing=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this._mediaSource?[2,this._mediaSource.toggleScreenCapturing(e)]:[2,Promise.reject(I.UNKNOWN)]}))}))},t.prototype.setVideoStream=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){return this._mediaSource?[2,this._mediaSource.setVideoStream(e,t)]:[2]}))}))},t.prototype.setAudioStream=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this._mediaSource?[2,this._mediaSource.setAudioStream(e)]:[2]}))}))},t.prototype.toggleLocalVideo=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this._mediaSource?(it.log("callMediaStatus",e?"video_1":"video_0"),[2,this._mediaSource.toggleVideo(e)]):[2]}))}))},t.prototype.toggleLocalAudio=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this._mediaSource?(it.log("callMediaStatus",e?"audio_1":"audio_0"),[2,this._mediaSource.toggleAudio(e)]):[2]}))}))},t.prototype.changePriorities=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d;return h(this,(function(p){switch(p.label){case 0:if(e.length<2||!this._signaling.ready)return[2];for(t={},n={},r=0,i=e;r<i.length;r++)o=i[r],a="object"==typeof o.uid?o.uid:Je.fromId(o.uid),d=Je.toString(a),n[d]=o.priority;for(s=0,c=Object.values(this._participants);s<c.length;s++)u=c[s],d=Je.toString(u.externalId),n.hasOwnProperty(d)&&(t[u.id]=n[d]);return[4,this._signaling.changePriorities(t)];case 1:return p.sent(),[2]}}))}))},t.prototype.changeParticipantState=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(a){switch(a.label){case 0:for(t=0,n=Object.entries(e);t<n.length;t++)if(r=n[t],i=r[0],o=r[1],i.length>5||o.length>5)throw new Error("key/value max length is 5 chars, mappings with empty values (null or empty string) are discarded");return[4,this._signaling.changeParticipantState(e)];case 1:return a.sent(),[2]}}))}))},t.prototype.updateDisplayLayout=function(e){return l(this,void 0,void 0,(function(){var n,r,i,o,a,s,c,u,d,p,l;return h(this,(function(h){switch(h.label){case 0:if(e.length<1||!this._signaling.ready)return[2];for(ue.log("Update display layout ["+this._signaling.getNextCommandSequenceNumber()+"]",e),n={},r=0,i=e;r<i.length;r++)o=i[r],a="object"==typeof o.uid?o.uid:Je.fromId(o.uid),s=Je.toString(a),(c=this._api.getCachedOkIdByExternalId(a))?(u=Qe({participantId:c,mediaType:o.mediaType,streamName:o.streamName}),(d=this._participants[c])&&(d.lastRequestedLayouts[u]=o),t._isStopStreaming(o)?this._streamIdByStreamDescription.has(u)&&!this._cooldownTimestampByStreamDescription.has(u)&&this._cooldownTimestampByStreamDescription.set(u,Date.now()):(this._cooldownTimestampByStreamDescription.delete(u),!this._streamIdByStreamDescription.has(u)&&te.videoTracksCount>0&&this._streamIdByStreamDescription.set(u,null),n[u]=t._layoutToString(o))):ue.log("Unknown participant external ID "+s);for(p=this._cooldownTimestampByStreamDescription.keys();this._streamIdByStreamDescription.size>te.videoTracksCount;){if((l=p.next()).done){ue.error("Cannot accommodate all streaming requests: tracks available "+te.videoTracksCount+"; requested streams: "+Array.from(this._streamIdByStreamDescription.keys()));break}this._stopStreaming(l.value),n[l.value]=t._layoutToString({stopStream:!0})}return[4,this._sendUpdateDisplayLayout(n)];case 1:return h.sent(),[2]}}))}))},t.prototype._stopStreaming=function(e){if(this._cooldownTimestampByStreamDescription.delete(e),this._sequenceNumberByStreamDescription.set(e,this._signaling.getNextCommandSequenceNumber()),this._streamWaitTimerByStreamDescription.has(e)&&(ue.log("Client asked to stop streaming before stream became available",e),window.clearTimeout(this._streamWaitTimerByStreamDescription.get(e)),this._streamWaitTimerByStreamDescription.delete(e)),this._streamIdByStreamDescription.get(e)){var t=Ze(e),n=this._participants[t.participantId];n?(!t.streamName||t.mediaType!==ze.STREAM&&t.mediaType!==ze.SCREEN?se.onRemoteStream(n.externalId,null):se.onRemoteLive(n.externalId,t.streamName,null),it.log("patDeallocate")):ue.log("Cannot find participant to stop streaming: "+t.participantId)}this._streamIdByStreamDescription.delete(e)},t.prototype._sendUpdateDisplayLayout=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d;return h(this,(function(p){switch(p.label){case 0:return 0===Object.keys(e).length?[2]:[4,this._signaling.updateDisplayLayout(e)];case 1:if(!(t=p.sent()))return[2];for(n=[],r=0,i=Object.entries(t.errorCodeByParticipantId||{});r<i.length;r++)o=i[r],a=o[0],s=o[1],c=Ze(a),(u=this._participants[c.participantId])&&(d=void 0,"number"!=typeof s?(ue.warn("Unexpected error code "+s+" received for participant "+c.participantId),d=L.UNKNOWN_ERROR):d=x(s),n.push({externalId:u.externalId,errorReason:d}));if(n&&n.length)throw new Bt("Could not allocate one or more participants",n);return[2]}}))}))},t.prototype._cleanupCooldownQueue=function(){for(var e={},n=this._cooldownTimestampByStreamDescription.entries();;){var r=n.next();if(r.done)break;var i=r.value;if(i[1]+12e4>Date.now())break;var o=i[0];this._stopStreaming(o),e[o]=t._layoutToString({stopStream:!0})}this._sendUpdateDisplayLayout(e)},t._isStopStreaming=function(e){return e.stopStream},t._layoutToString=function(e){if(t._isStopStreaming(e))return"ss";var n="";return void 0!==e.priority&&(n+="p="+e.priority),void 0!==e.width&&void 0!==e.height&&(""!==n&&(n+=":"),n+="sz="+Math.round(e.width)+"x"+Math.round(e.height)),void 0!==e.fit&&(""!==n&&(n+=":"),n+="fit="+e.fit),e.keyFrame&&(""!==n&&(n+=":"),n+="kf"),n},t.prototype._onParticipantSourcesUpdate=function(e){if(this._conversation){ue.log("Received participant sources update notification",e);for(var t=0,n=e;t<n.length;t++){var r=n[t];this._waitForStreamIfNeeded(r)}}},t.prototype._onParticipantPromoted=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return ue.log("Promoted in waiting hall",!e.demote),e.demote?(ue.log("Kicked from waiting hall"),this._close(new ct(A.REMOVED)),[3,3]):[3,1];case 1:return this._updateConversation(e),[4,this._onJoinPart2(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype._onChatRoomUpdated=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=[]),l(this,void 0,void 0,(function(){var r,i,o=this;return h(this,(function(a){switch(a.label){case 0:return ue.log("Chat room updated: "+e),r=[],i=[],n.length?(n.forEach((function(e){if(e.externalId){var t=Je.fromSignaling(e.externalId);r.push(t),o._api.cacheExternalId(e.id.id,t)}else i.push(pe.decomposeId(e.id.id).id)})),!i.length||r.length?[3,2]:[4,this._api.getExternalIdsByOkIds(i)]):[3,2];case 1:r=a.sent(),a.label=2;case 2:return se.onChatRoomUpdated(e,t,r),[2]}}))}))},t.prototype._waitForStreamIfNeeded=function(e){var t,n,r=this._matchStreamDescription(e.participantStreamDescription);if(r&&(!te.producerScreenTrack||r.mediaType!==ze.SCREEN)){var i=Qe(r),o=this._sequenceNumberByStreamDescription.get(i);if(o&&o>e.sequenceNumber)return ue.warn("Participant "+r.participantId+" received outdated PAT response: sequence number "+e.sequenceNumber+"; last sent sequence number for given participant is "+o),void it.log("patOutdatedResponse");var a=e.streamId,s=e.rtpTimestamp?this._getWaitingTime(a,e.rtpTimestamp):0;if(s<=0){this._streamWaitTimerByStreamDescription.delete(i);var c=r.participantId,u=this._participants[c];if(!u)return it.log("patError","participantMissing"),void ue.error("Could not find participant by ID: "+c);var d=this._streamByStreamId.get(a);if(!d)return it.log("patError","streamNotFound"),void ue.error("Could not find stream by ID: "+a);it.log("patAllocate"),this._streamIdByStreamDescription.set(i,a);var p=null===(t=e.participantStreamDescription)||void 0===t?void 0:t.mediaType;if(p===ze.STREAM||p===ze.MOVIE)(null===(n=e.participantStreamDescription)||void 0===n?void 0:n.streamName)&&se.onRemoteLive(u.externalId,e.participantStreamDescription.streamName,d);else{var l=(te.producerScreenTrack?null:u.secondStream)||d;se.onRemoteStream(u.externalId,l)}}else{ue.debug("Waiting for "+s+" until stream "+a+" for "+i+" is switched");var h=window.setTimeout(this._waitForStreamIfNeeded.bind(this,e),s);this._streamWaitTimerByStreamDescription.set(i,h)}}},t.prototype._matchStreamDescription=function(e){if(!e)return null;if(this._streamIdByStreamDescription.has(Qe(e)))return e;var t=e.participantId;if(e.mediaType){var n={participantId:t,mediaType:null};if(this._streamIdByStreamDescription.has(Qe(n)))return n}else{var r={participantId:t,mediaType:ze.CAMERA};if(this._streamIdByStreamDescription.has(Qe(r)))return r;var i={participantId:t,mediaType:ze.SCREEN};if(this._streamIdByStreamDescription.has(Qe(i)))return i}return ue.error("Received unrequested allocation",e),null},t.prototype._getWaitingTime=function(e,t){if(this._transport)return this._transport.getStreamWaitingTimeMs(e,t);throw new Error("transport is not initialized")},t.prototype._isCallAdmin=function(){return!!this._conversation&&pe.includesOneOf(this._conversation.roles,[U.ADMIN,U.CREATOR])},t.prototype._checkAdminRole=function(){if(this._conversation&&!pe.includesOneOf(this._conversation.roles,[U.ADMIN,U.CREATOR]))throw new Error("You don't have the required permission")},t.prototype.grantRoles=function(e,t,n){return l(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return this._checkAdminRole(),[4,this._signaling.grantRoles(e,t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.switchParticipantDevice=function(e,t,n,r){return void 0===e&&(e=null),void 0===r&&(r=!1),l(this,void 0,void 0,(function(){return h(this,(function(i){switch(i.label){case 0:return this._checkAdminRole(),[4,this._signaling.muteParticipant(e,t,n,r)];case 1:return i.sent(),[2]}}))}))},t.prototype.pinParticipant=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return this._checkAdminRole(),[4,this._signaling.pinParticipant(e,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.updateMediaModifiers=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this._signaling.ready&&this._conversation?(this._conversation.mediaModifiers=e,[4,this._signaling.updateMediaModifiers(e)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.changeOptions=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return this._signaling.ready&&this._conversation?(this._checkAdminRole(),[4,this._signaling.changeOptions(e)]):[3,2];case 1:n.sent(),t=function(e,t){for(var n=new Set(e),r=0,i=Object.entries(t);r<i.length;r++){var o=i[r],a=o[0];o[1]?n.add(a):n.delete(a)}return Array.from(n)}(this._conversation.options,e),this._onOptionsChanged(t),n.label=2;case 2:return[2]}}))}))},t.prototype.getWaitingHall=function(e,t,n){return l(this,void 0,void 0,(function(){var r,i,o,a,s,c,u=this;return h(this,(function(d){switch(d.label){case 0:return this._signaling?(r=null,e&&(r=function(e){try{return JSON.parse(atob(e))}catch(t){ue.warn("WaitingParticipant: failed convert from string",e,t)}return null}(e)),[4,this._signaling.getWaitingHall(r,t,n)]):[2,Promise.reject()];case 1:return(i=d.sent()).error?[2,Promise.reject(i.message)]:(o=i.participants||[],a=[],s=[],c=null,o.length?(o.forEach((function(e){if(e.externalId){var t=Je.fromSignaling(e.externalId);a.push(t),u._api.cacheExternalId(e.id.id,t)}else s.push(pe.decomposeId(e.id.id).id)})),!s.length||a.length?[3,3]:[4,this._api.getExternalIdsByOkIds(s)]):[3,4]);case 2:a=d.sent(),d.label=3;case 3:i.hasMore&&(c=function(e){try{return btoa(JSON.stringify(e))}catch(t){ue.warn("WaitingParticipant: failed convert to string",e,t)}return null}(o[o.length-1].id)),d.label=4;case 4:return[2,{participants:a,pageMarker:c,totalCount:i.totalCount||0}]}}))}))},t.prototype.promoteParticipant=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return this._signaling?[4,this._signaling.promoteParticipant(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return this._signaling.ready?[4,this._signaling.chatMessage(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.chatHistory=function(e){return l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:return this._signaling.ready?[4,this._signaling.chatHistory(e)]:[3,5];case 1:t=i.sent(),n=t.messages.length-1,i.label=2;case 2:return n>=0?(r=t.messages[n],[4,this._onChatMessage(r)]):[3,5];case 3:i.sent(),i.label=4;case 4:return n--,[3,2];case 5:return[2]}}))}))},t.prototype.customData=function(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return this._signaling.ready?[4,this._signaling.customData(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype.createJoinLink=function(){return l(this,void 0,void 0,(function(){var e,t;return h(this,(function(n){switch(n.label){case 0:return this._conversation?[4,this._api.createJoinLink(this._conversation.id)]:[3,2];case 1:if(e=n.sent(),t=e.join_link)return this._conversation.joinLink=t,[2,t];n.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.removeJoinLink=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return this._conversation?[4,this._api.removeJoinLink(this._conversation.id)]:[3,2];case 1:if(e.sent().success)return delete this._conversation.joinLink,[2];e.label=2;case 2:return[2,Promise.reject()]}}))}))},t.prototype.startStream=function(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),l(this,void 0,void 0,(function(){var o,a;return h(this,(function(s){switch(s.label){case 0:return o={movieId:n,name:t,privacy:r,groupId:i,streamMovie:!e},[4,this._signaling.startStream(o)];case 1:return(a=s.sent()).error?[2,Promise.reject(a.message)]:[2,a]}}))}))},t.prototype.stopStream=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,this._signaling.stopStream()];case 1:return(e=t.sent()).error?[2,Promise.reject()]:[2,e]}}))}))},t.prototype.getStreamInfo=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,this._signaling.getRecordStatus()];case 1:return[2,{movieId:(e=t.sent()).recordMovieId,preview:e.recordMoviePreviewUrl}]}}))}))},t.prototype.setLocalResolution=function(e,t){var n;return l(this,void 0,void 0,(function(){return h(this,(function(r){if(e<te.videoMinWidth||t<te.videoMinHeight)throw new Error("Sizes received are less than the `videoMinWidth` or `videoMinHeight`");return te.videoMaxWidth=e,te.videoMaxHeight=t,[2,null===(n=this._mediaSource)||void 0===n?void 0:n.setResolution(e,t)]}))}))},t.prototype.videoEffect=function(e){var t;return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,null===(t=this._mediaSource)||void 0===t?void 0:t.videoEffect(e)]}))}))},t.prototype._onLocalMediaStreamChanged=function(e){var t;return l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return this._conversation?(ue.debug("Local media stream changed",e.mediaSettings),se.onLocalStreamUpdate(e.mediaSettings,e.kind),!this._signaling.ready||(null===(t=this._conversation)||void 0===t?void 0:t.waitingHall)?[3,2]:[4,this._signaling.changeMediaSettings(e.mediaSettings)]):[2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},t.prototype._onScreenSharingStatus=function(e){var t;return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return ue.log("Screen sharing changed",e.track,e.mediaSettings),te.consumerScreenTrack?(n=e.track?new MediaStream([e.track]):null,se.onScreenStream(n,e.mediaSettings),!this._signaling.ready||(null===(t=this._conversation)||void 0===t?void 0:t.waitingHall)?[3,2]:[4,this._signaling.changeMediaSettings(e.mediaSettings)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype._changeRemoteMediaSettings=function(e,t){ue.debug("Remote media settings changed ["+e+"]",t);var n=this._participants[e];n&&(n.mediaSettings=t,"ACTIVE"===this._state&&se.onRemoteMediaSettings(n.externalId,t),this._specListener&&this._specListener.onChangeRemoteMediaSettings(e,t))},t.prototype._changeRemoteParticipantState=function(e,t){ue.debug("Remote participant state changed ["+e+"]",t);var n=this._participants[e];n&&(n.participantState=t||{},"ACTIVE"===this._state&&(te.participantStateMapped?se.onRemoteParticipantState(n.externalId,n.participantState):se.onRemoteParticipantState(n.externalId,pe.mapLegacyParticipantState(n.participantState))))},t.prototype._onSignalingNotification=function(e){var t;switch(e.notification){case"accepted-call":return this._onAcceptedCall(e);case"hungup":return this._onHungup(e);case"participant-added":return this._onAddedParticipant(e);case"participant-joined":return this._onJoinedParticipant(e);case"closed-conversation":return this._onClosedConversation(e);case"media-settings-changed":return this._onMediaSettingsChanged(e);case"participant-state-changed":return this._onParticipantStateChanged(e);case"rate-call-data":return this._onNeedRate();case"feature-set-changed":return this._onFeatureSetChanged(e);case"multiparty-chat-created":return this._onMultipartyChatCreated(e);case"force-media-settings-change":return this._onForceMediaSettingsChange(e);case"settings-update":return this._onSettingsUpdate(e);case"video-quality-update":return this._onVideoQualityUpdate(e);case"registered-peer":return this._onPeerRegistered(e);case"switch-micro":return this._onMicSwitched(e);case"chat-message":return this._onChatMessage(e);case"custom-data":return this._onCustomData(e);case"record-started":return this._onRecordInfo(e.recordInfo);case"record-stopped":return this._onRecordInfo(null);case"roles-changed":return this._onRolesChanged(e.participantId,e.roles||[]);case"mute-participant":var n=e.unmute?(null===(t=this._conversation)||void 0===t?void 0:t.muteState)||"UNMUTE":e.mutePermanent?"MUTE_PERMANENT":"MUTE";return this._onMuteParticipant(e.mediaOptions||[],e.unmute||!1,n);case"pin-participant":return this._onPinParticipant(e.participantId,e.unpin);case"options-changed":return this._onOptionsChanged(e.options||[]);case"participant-sources-update":return this._onParticipantSourcesUpdate(e.participantUpdateInfos);case"promote-participant":return this._onParticipantPromoted(e);case"chat-room-updated":return this._onChatRoomUpdated(e.eventType,e.totalCount,e.firstParticipants)}},t.prototype._onSignalingReconnect=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d,p,l,f,v,m;return h(this,(function(h){switch(h.label){case 0:if(!this._conversation)return[2];if(e.conversation.acceptTime&&(this._conversation.acceptTime=e.conversation.acceptTime),e.conversation.participantsLimit&&(this._conversation.participantsLimit=e.conversation.participantsLimit),e.conversation.features&&(this._conversation.features=e.conversation.features,this._changeFeatureSet()),e.conversation.pinnedParticipantId!==this._conversation.pinnedParticipantId&&(e.conversation.pinnedParticipantId?this._onPinParticipant(e.conversation.pinnedParticipantId,!1):this._conversation.pinnedParticipantId&&this._onPinParticipant(this._conversation.pinnedParticipantId,!0)),e.conversation.state,t=null,!e.conversation.participants)return[3,6];n=Object.keys(this._participants),r=[],i=0,o=e.conversation.participants,h.label=1;case 1:return i<o.length?(a=o[i],s=pe.composeParticipantId(a),c=a.roles||[],s===this._conversation.compositeUserId?(t=Xe(a.mediaSettings),j(this._conversation.roles,c)||this._onRolesChanged(s,c),[3,4]):(r.push(s),(u=this._participants[s])?[3,3]:[4,this._onJoinedParticipant({participantId:a.id,participant:a,mediaSettings:a.mediaSettings})])):[3,5];case 2:return h.sent(),[3,4];case 3:(function(e,t){if(e.isAudioEnabled!==t.isAudioEnabled)return!1;if(e.isVideoEnabled!==t.isVideoEnabled)return!1;if(e.isScreenSharingEnabled!==t.isScreenSharingEnabled)return!1;if(e.videoStreams.length!==t.videoStreams.length)return!1;for(var n=function(e){if(!t.videoStreams.find((function(t){return t.name===e.name&&t.source===e.source})))return{value:!1}},r=0,i=e.videoStreams;r<i.length;r++){var o=n(i[r]);if("object"==typeof o)return o.value}return!0})(d=Xe(a.mediaSettings),u.mediaSettings)||this._changeRemoteMediaSettings(s,d),p=pe.mapParticipantState(a),l=u.participantState,pe.isEqualParticipantState(p,l)||this._changeRemoteParticipantState(s,p),j(c,u.roles)||this._onRolesChanged(u.id,c),h.label=4;case 4:return i++,[3,1];case 5:for(f=0,v=n;f<v.length;f++)m=v[f],r.indexOf(m)<0&&this._removeParticipant(this._participants[m],A.HUNGUP);h.label=6;case 6:return"MUTE"!==e.muteState&&"MUTE_PERMANENT"!==e.muteState||this._onMuteParticipant(e.muteOptions,!1,e.muteState,t),e.unmuteOptions&&e.unmuteOptions.length&&this._onMuteParticipant(e.unmuteOptions,!0,e.muteState,t),this._onRecordInfo(e.conversation.recordInfo),this._onOptionsChanged(e.conversation.options),[2]}}))}))},t.prototype._onSignalingFailed=function(e){ue.error("Signaling failed",e),this._close(e)},t.prototype._onAcceptedCall=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(a){switch(a.label){case 0:return t=pe.composeMessageId(e),n=pe.getPeerIdString(e.peerId),ue.debug("Participant accepted call ["+t+"]"),this._conversation&&t===this._conversation.compositeUserId?(this._close(new ct(A.MISSED),"Call accepted on other device"),[2]):(r=this._participants[t])?[3,2]:(i=this._participants,o=t,[4,this._createParticipant({id:t,mediaSettings:Xe(e.mediaSettings)})]);case 1:i[o]=a.sent(),r=this._participants[t],a.label=2;case 2:return r.state="ACCEPTED",r.mediaSettings=Xe(e.mediaSettings),this._logWithMediaSettings("callAcceptedOutgoing",r.mediaSettings),!this._conversation||"OUTGOING"!==this._conversation.direction||"IDLE"!==this._state&&"PROCESSING"!==this._state||(this._state="ACTIVE",this._changeFeatureSet()),"ACTIVE"===this._state&&this._transport&&this._transport.open(r.id,n),this._changeRemoteMediaSettings(t,r.mediaSettings),this._changeRemoteParticipantState(t),[2]}}))}))},t.prototype._onHungup=function(e){ue.debug("Participant hungup ["+e.participantId+"]",{reason:e.reason});var t=pe.composeMessageId(e);if(this._conversation&&this._conversation.compositeUserId===t)this._close(new ct(e.reason));else{var n=this._participants[t];n?(this._transport&&this._transport.close(t),n.state=e.reason===A.REJECTED?"REJECTED":"HUNGUP","CLOSE"!==this._state&&this._removeParticipant(n,A.HUNGUP)):ue.warn("Participant ["+t+"] isn't in conversation")}},t.prototype._onAddedParticipant=function(e){var t,n;return l(this,void 0,void 0,(function(){var r,i,o,a;return h(this,(function(s){switch(s.label){case 0:return ue.debug("Participant added ["+e.participantId+"]"),r=pe.composeMessageId(e),(i=this._participants[r])&&"HUNGUP"!==i.state&&"REJECTED"!==i.state?(ue.debug("Participant ["+r+"] is already in conversation and is active"),[2]):i?[3,2]:(o=this._participants,a=r,[4,this._createParticipant({id:r,externalId:e.participant.externalId&&Je.fromSignaling(e.participant.externalId),mediaSettings:Xe(e.participant.mediaSettings),state:e.participant.state,participantState:pe.mapParticipantState(e.participant),roles:e.participant.roles||[]})]);case 1:o[a]=s.sent(),i=this._participants[r],s.label=2;case 2:return i.state="CALLED",i.mediaSettings=Xe(null===(t=e.participant)||void 0===t?void 0:t.mediaSettings),i.participantState=pe.mapParticipantState(e.participant),i.roles=(null===(n=e.participant)||void 0===n?void 0:n.roles)||[],se.onParticipantStatus(i.externalId,Q.WAITING),"ACTIVE"===this._state&&this._transport&&this._transport.allocate(i.id,!0),this._changeRemoteMediaSettings(r,i.mediaSettings),this._changeRemoteParticipantState(r,i.participantState),[2]}}))}))},t.prototype._onJoinedParticipant=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return ue.debug("Participant joined ["+e.participantId+"]"),t=pe.composeMessageId(e),(n=this._participants[t])&&"ACCEPTED"===n.state?(ue.warn("Participant ["+t+"] is already in conversation and is active"),[2]):n?[3,2]:(r=this._participants,i=t,[4,this._createParticipant({id:t,externalId:e.participant.externalId&&Je.fromSignaling(e.participant.externalId),mediaSettings:Xe(e.participant.mediaSettings),state:e.participant.state,participantState:pe.mapParticipantState(e.participant),roles:e.participant.roles||[]})]);case 1:r[i]=o.sent(),n=this._participants[t],o.label=2;case 2:return!this._conversation||"OUTGOING"!==this._conversation.direction||"IDLE"!==this._state&&"PROCESSING"!==this._state||(this._state="ACTIVE",this._changeFeatureSet()),n.state="ACCEPTED",n.mediaSettings=Xe(e.mediaSettings),n.participantState=pe.mapParticipantState(e.participant),n.roles=e.participant.roles||[],this._transport&&this._transport.isAllocated(n.id)?se.onParticipantStatus(n.externalId,Q.CONNECTED):se.onParticipantStatus(n.externalId,Q.WAITING),"ACTIVE"===this._state&&this._transport&&(this._transport.isAllocated(n.id)||this._transport.allocate(n.id,!0),this._transport.open(n.id)),this._changeRemoteMediaSettings(t,n.mediaSettings),this._changeRemoteParticipantState(t,n.participantState),[2]}}))}))},t.prototype._onClosedConversation=function(e){this._toggleJoinAvailability(),this._close(new ct(e.reason,{remote:!0}))},t.prototype._onMediaSettingsChanged=function(e){var t=pe.composeMessageId(e);this._changeRemoteMediaSettings(t,Xe(e.mediaSettings))},t.prototype._onParticipantStateChanged=function(e){var t=pe.composeMessageId(e);this._changeRemoteParticipantState(t,pe.mapParticipantState(e))},t.prototype._onNeedRate=function(){this._conversation&&(this._conversation.needRate=!0,this._changeNeedRate())},t.prototype._onFeatureSetChanged=function(e){this._conversation&&(this._conversation.features=e.features,this._changeFeatureSet())},t.prototype._onMultipartyChatCreated=function(e){this._conversation&&(this._conversation.chatId=e.chatId,this._toggleJoinAvailability(),se.onMultipartyChatCreated(this._conversation))},t.prototype._onForceMediaSettingsChange=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return this._mediaSource?(t=this._mediaSource.getMediaSettings(),n=Xe(e.mediaSettings),t.isAudioEnabled===n.isAudioEnabled?[3,2]:[4,this._mediaSource.toggleAudio(n.isAudioEnabled)]):[2];case 1:r.sent(),r.label=2;case 2:return t.isVideoEnabled===n.isVideoEnabled?[3,4]:[4,this._mediaSource.toggleVideo(n.isVideoEnabled)];case 3:r.sent(),r.label=4;case 4:return te.consumerScreenTrack&&t.isScreenSharingEnabled!==n.isScreenSharingEnabled?[4,this._mediaSource.toggleScreenCapturing(n.isScreenSharingEnabled)]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},t.prototype._onSettingsUpdate=function(e){var t,n={camera:e.camera,screenSharing:e.screenSharing};this._serverSettings=rt(this._serverSettings,n),this._signalingServerSettings=(t=this._serverSettings,{camera:Object.assign({},t.camera),screenSharing:Object.assign({},t.screenSharing)}),this._transport&&this._transport.updateSettings(this._serverSettings)},t.prototype._onVideoQualityUpdate=function(e){var t=this._serverSettings.camera,n=this._signalingServerSettings.camera;if(t&&n){var r=Math.min(Math.round(e.quality.maxBitrate/1024),n.maxBitrateK),i=Math.min(e.quality.maxDimension,n.maxDimension),o={camera:Object.assign({},t,{maxBitrateK:r,maxDimension:i}),screenSharing:null};this._serverSettings=rt(this._serverSettings,o),ue.log("Got video quality update notification",this._serverSettings),this._transport&&this._transport.updateSettings(this._serverSettings)}},t.prototype._onPeerRegistered=function(e){var t=pe.composeMessageId(e);this._participants[t]&&(this._participants[t].clientType=e.clientType,this._participants[t].platform=e.platform)},t.prototype._onMicSwitched=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return se.onDeviceSwitched(k.AUDIO,!e.mute),[4,this.toggleLocalAudio(!e.mute)];case 1:return t.sent(),[2]}}))}))},t.prototype._onChatMessage=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return t=pe.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1];case 1:return[4,this._getUserId(t)];case 2:n=r.sent(),r.label=3;case 3:return se.onChatMessage(e.message,n,e.direct),[2]}}))}))},t.prototype._onCustomData=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return e.data.hasOwnProperty("sdk")?[2]:(t=pe.composeMessageId(e),this._participants[t]?(n=this._participants[t].externalId,[3,3]):[3,1]);case 1:return[4,this._getUserId(t)];case 2:n=r.sent(),r.label=3;case 3:return se.onCustomData(e.data,n,e.direct),[2]}}))}))},t.prototype._onRecordInfo=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return this._conversation?(t=!1,!this._conversation.recordInfo!=!e?t=!0:this._conversation.recordInfo&&e&&(t=this._conversation.recordInfo.recordMovieId!==e.recordMovieId),t?e?[4,this._getUserId(e.initiator)]:[3,2]:[3,3]):[2];case 1:return n=r.sent(),se.onRecordStarted(n,e.recordMovieId,e.recordStartTime,e.recordType,e.recordExternalMovieId,e.recordExternalOwnerId),[3,3];case 2:se.onRecordStopped(),r.label=3;case 3:return this._conversation.recordInfo=e,[2]}}))}))},t.prototype._onRolesChanged=function(e,t){if(this._conversation&&e===this._conversation.compositeUserId&&!j(this._conversation.roles,t))return ue.debug("Local roles changed: "+t),this._conversation.roles=t,void se.onLocalRolesChanged(t);var n=this._participants[e];n&&!j(n.roles,t)&&(ue.debug("Roles for participant ["+e+"] changed: "+t),n.roles=t,se.onRolesChanged(n.externalId,t))},t.prototype._onMuteParticipant=function(e,t,n,r){return l(this,void 0,void 0,(function(){return h(this,(function(i){switch(i.label){case 0:return this._conversation?(this._conversation.muteOptions=e,this._conversation.muteState!==n||t?(this._conversation.muteState=n,[4,this._processMuteState(t,r)]):[2]):[2];case 1:return i.sent(),[2]}}))}))},t.prototype._processMuteState=function(e,t){return void 0===e&&(e=!1),l(this,void 0,void 0,(function(){var n,r,i,o,a,s,c;return h(this,(function(u){switch(u.label){case 0:if(!this._conversation||!this._mediaSource||"ACCEPTED"!==this._participantState)return[2];if(n=this._conversation.muteState,r=this._conversation.muteOptions,i="MUTE_PERMANENT"===n,o=this._mediaSource.getMediaSettings(),e){for(a=0,s=r;a<s.length;a++)c=s[a],se.onUnmuteRequest(c);return[2]}return!r.includes(k.AUDIO)||!o.isAudioEnabled||t&&t.isAudioEnabled?[3,2]:(se.onDeviceSwitched(k.AUDIO,!1),[4,this.toggleLocalAudio(!1)]);case 1:u.sent(),u.label=2;case 2:return!r.includes(k.VIDEO)||!o.isVideoEnabled||t&&t.isVideoEnabled?[3,4]:(se.onDeviceSwitched(k.VIDEO,!1),[4,this.toggleLocalVideo(!1)]);case 3:u.sent(),u.label=4;case 4:return!r.includes(k.SCREEN_SHARING)||!o.isScreenSharingEnabled||t&&t.isScreenSharingEnabled?[3,6]:(se.onDeviceSwitched(k.SCREEN_SHARING,!1),[4,this.toggleScreenCapturing(!1)]);case 5:u.sent(),u.label=6;case 6:return se.onUnmutePermission(!i||this._isCallAdmin()),[2]}}))}))},t.prototype._onPinParticipant=function(e,t){if(void 0===t&&(t=!1),this._conversation){var n=this._conversation.pinnedParticipantId;n&&n!==e&&(this._participants[n]?se.onPinnedParticipant(this._participants[n].externalId,!0):this._conversation.compositeUserId===n&&se.onLocalPin(!0)),this._participants[e]?se.onPinnedParticipant(this._participants[e].externalId,t):this._conversation.compositeUserId===e&&se.onLocalPin(t),this._conversation.pinnedParticipantId=t?null:e}},t.prototype._onOptionsChanged=function(e){this._conversation&&!function(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(!t.includes(i))return!1}return!0}(this._conversation.options,e)&&(this._conversation.options=e,se.onOptionsChanged(e))},t.prototype._onNetworkStatus=function(e){if(this._conversation){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n],o=i[0],a=i[1],s=void 0;if(o===this._conversation.compositeUserId||""===o)s=this._conversation.networkRating;else{if(!this._participants[o])continue;s=this._participants[o].networkRating}if(s!==a)if(o===this._conversation.compositeUserId||""===o)this._conversation.networkRating=a,se.onLocalNetworkStatusChanged(a);else{var c=this._participants[o];c.networkRating=a,t.push({uid:c.externalId,rating:a})}}if(0===t.length)return;ue.log("Received network status update: ",e),se.onNetworkStatusChanged(t)}},t.prototype._onRemoteStreamSecond=function(e,t){var n=this._participants[e];if(n)if(te.producerScreenTrack)se.onRemoteScreenStream(n.externalId,t);else if(n.secondStream=t,te.videoTracksCount>0){var r=e;if(!this._streamIdByStreamDescription.has(r))return void ue.error("Received remote stream notification for a participant that has no track associated with it",r);var i=this._streamIdByStreamDescription.get(r);if(!i||this._streamWaitTimerByStreamDescription.has(r))return void ue.log("Delaying secondary stream start/stop until main stream becomes available",r);var o=this._streamByStreamId.get(i);if(!o)return it.log("patError","streamNotFound"),void ue.error("Could not find stream by ID: "+i);se.onRemoteStream(n.externalId,n.secondStream||o)}else{var a=t||n.remoteStream;a&&se.onRemoteStream(n.externalId,a)}},t.prototype._onPeerConnectionClosed=function(e){"SERVER"===e&&this._cleanupParticipantAgnosticStreams()},t.prototype._changeFeatureSet=function(){if(this._conversation){var e="ACTIVE"===this._state,t=this._conversation.features.includes("ADD_PARTICIPANT");se.onCallState(e,t,this._conversation)}},t.prototype._changeNeedRate=function(){this._conversation&&this._conversation.needRate&&se.onRateNeeded()},t.prototype._onVolumesDetected=function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n],o=i[0],a=i[1],s=this._participants[o];s&&s.externalId&&t.push({uid:s.externalId,volume:a.real})}se.onVolumesDetected(t)},t.prototype._onSpeakerChanged=function(e){this._activeSpeakerId=e,this._participants[e]&&this._lastSignalledActiveSpeakerId!==e&&(se.onSpeakerChanged(this._participants[e].externalId),this._lastSignalledActiveSpeakerId=e)},t.prototype._onTransportStateChanged=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return(n=this._participants[e])?(ue.debug("Transport state for participant ["+e+"] has changed: "+t),"CONNECTED"===t&&(se.onParticipantStatus(n.externalId,Q.CONNECTED),te.onDemandTracks&&!n.remoteStream&&(n.mediaSettings&&this._changeRemoteMediaSettings(e,n.mediaSettings),this._changeRemoteParticipantState(e,n.participantState)),this._updateDisplayLayoutFromCache(e)),"CONNECTING"!==t&&"OPENED"!==t||se.onParticipantStatus(n.externalId,Q.CONNECTING),"RECONNECTING"===t&&se.onParticipantStatus(n.externalId,Q.RECONNECT),[2]):(ue.warn("Participant ["+e+"] isn't in conversation"),[2])}))}))},t.prototype._onTransportLocalStateChanged=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return ue.debug("Local transport state has changed: "+e),"CONNECTED"===e&&se.onLocalStatus(Q.CONNECTED),"CONNECTING"===e&&se.onLocalStatus(Q.CONNECTING),"RECONNECTING"===e&&se.onLocalStatus(Q.RECONNECT),"FAILED"!==e?[3,3]:this._transport&&0===this._transport.allocated().length?this._signaling.ready?[4,this._signaling.hangup(A.FAILED)]:[3,2]:[3,3];case 1:t.sent(),t.label=2;case 2:this._close(new ct(A.FAILED),"Transport failed"),t.label=3;case 3:return[2]}}))}))},t.prototype._onRemoteTrackAdded=function(e,t,n){return l(this,void 0,void 0,(function(){var r,i,o;return h(this,(function(a){switch(a.label){case 0:return e.endsWith("audio-mix")?(ue.debug("Remote audio mix track added"),this._audioOutput.add(n),[3,5]):[3,1];case 1:return e.startsWith("pat")?(ue.debug("Participant-agnostic track added: "+e),this._streamByStreamId.set(e,t),[3,5]):[3,2];case 2:return ue.debug("Remote track added on the participant ["+e+"]",{kind:n.kind}),(r=this._participants[e])?[3,4]:(ue.warn("Conversation: track added before participant ["+e+"]"),i=this._participants,o=e,[4,this._createParticipant({id:e})]);case 3:i[o]=a.sent(),r=this._participants[e],se.onParticipantStatus(r.externalId,Q.WAITING),this._activeSpeakerId===e&&this._lastSignalledActiveSpeakerId!==e&&(se.onSpeakerChanged(r.externalId),this._lastSignalledActiveSpeakerId=e),a.label=4;case 4:if(this._transport&&!this._transport.isAllocated(r.id)&&this._transport.allocate(r.id,!1),"audio"===n.kind&&this._audioOutput.add(n),r.remoteStream!==t){if(r.remoteStream=t,r.secondStream)return[2];se.onRemoteStream(r.externalId,t)}r.mediaSettings&&this._changeRemoteMediaSettings(e,r.mediaSettings),te.batchParticipantsOnStart||this._changeRemoteParticipantState(e,r.participantState),a.label=5;case 5:return[2]}}))}))},t.prototype._onRemoteTrackRemoved=function(e,t,n){switch(ue.debug("["+e+"] remote track (removed)",{track:n}),n.kind){case"audio":this._removeAudioTrack(e,t,n);break;case"video":case"screen":this._removeVideoTrack(e,t,n)}},t.prototype._removeAudioTrack=function(e,t,n){if("audio-mix"!==e){var r=this._participants[e];if(!r)return;if(r.remoteStream&&r.remoteStream!==t)return}this._audioOutput.remove(n)},t.prototype._removeVideoTrack=function(e,t,n){},t.prototype._onRemoteActivityNoSignal=function(){this._onRemoteSignalledStall([]),this._onRemoteAllStall(!1)},t.prototype._onTopologyChanged=function(e){this._conversation&&(this._conversation.topology=e,this._changeFeatureSet())},t.prototype._onRemoteAllStall=function(e){var t=this;this._remoteAllStalled!==e&&(this._remoteAllStalled=e,Object.values(this._participants).forEach((function(n){n.externalId&&se.onParticipantStatus(n.externalId,e||t._lastStalled[n.id]?Q.RECONNECT:Q.CONNECTED)})))},t.prototype._onRemoteSignalledStall=function(e){var t=this,n={};e.forEach((function(e){if(n[e]=!0,!t._lastStalled[e]){var r=t._participants[e];r&&r.externalId&&!t._remoteAllStalled&&se.onParticipantStatus(r.externalId,Q.RECONNECT)}delete t._lastStalled[e]})),Object.keys(this._lastStalled).forEach((function(e){var n=t._participants[e];n&&n.externalId&&!t._remoteAllStalled&&se.onParticipantStatus(n.externalId,Q.CONNECTED)})),this._lastStalled=n},t.prototype._onRemoteDataStats=function(e){this._debugInfo&&this._debugInfo.onRemoteDataStats(e,this._participants),this._fixAudioDevice(e.outbound.rtps)},t.prototype._fixAudioDevice=function(e){var t;Ye.hasMicrophone()&&this._audioFix&&(null===(t=this._mediaSource)||void 0===t?void 0:t.getMediaSettings().isAudioEnabled)&&this._audioFix.fix(e)},t.prototype._toggleJoinAvailability=function(){var e=this._conversation&&this._conversation.chatId,t=e&&"CLOSE"!==this._state||!1;e&&(ue.debug("Toggle join availability",{available:t,chatId:e}),se.onJoinStatus(t,e))},t.prototype._updateDisplayLayoutFromCache=function(e){var t;return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return"SERVER"!==(null===(t=this._transport)||void 0===t?void 0:t.getTopology())?[2]:(n=this._participants[e])&&n.lastRequestedLayouts&&Object.keys(n.lastRequestedLayouts).length?[4,this.updateDisplayLayout(Object.values(n.lastRequestedLayouts))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t._delayedHangup=!1,t}(g),Bt=function(e){function t(n,r){var i=e.call(this,n)||this;return Object.setPrototypeOf(i,t.prototype),i.participantErrors=r,i}return d(t,e),t}(Error);function Ht(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=!1),window.Blob&&window.navigator.sendBeacon){var r=Kt(e,t,n),i=new window.Blob([r],{type:"application/x-www-form-urlencoded"});window.navigator.sendBeacon(te.apiEnv.api+"fb.do",i)}}function Wt(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){return h(this,(function(r){return[2,qt(Kt(e,t,n))]}))}))}function qt(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,new Promise((function(t,n){var r=new XMLHttpRequest;r.open("POST",te.apiEnv.api+"fb.do",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){var e;try{e=JSON.parse(r.responseText)}catch(t){e={result:r.responseText}}200!==r.status||e.hasOwnProperty("error_msg")?n(e):t(e)}},r.send(e)}))]}))}))}function Kt(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1),t.method=e,t.format="JSON",t.application_key||(t.application_key=te.apiKey),n||(ee.sessionKey?t.session_key=ee.sessionKey:ee.accessToken&&(t.access_token=ee.accessToken));for(var r=0,i=Object.entries(t);r<i.length;r++){var o=i[r],a=o[0];"object"==typeof(p=o[1])&&(t[a]=JSON.stringify(p))}for(var s="",c=0,u=Object.entries(t);c<u.length;c++){var d=u[c],p=(a=d[0],d[1]);s&&(s+="&"),s+=a+"="+encodeURIComponent(p)}return s}var $t,Jt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._userId=null,t._externalUidsCache={},t}return d(t,e),t.prototype._callUnsafe=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r,i=this;return h(this,(function(o){return[2,(r=function(o){return l(i,void 0,void 0,(function(){var i;return h(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,5]),[4,Wt(e,t,n)];case 1:return[2,a.sent()];case 2:return(i=a.sent()).hasOwnProperty("error_msg")?[3,4]:(o++,ue.debug(e+" network error, attempt "+o+"..."),o<10?[4,pe.delay(Math.min(700*o,3e3))]:[3,4]);case 3:return a.sent(),[2,r(o)];case 4:throw ue.warn(e,"error",i),i;case 5:return[2]}}))}))})(0)]}))}))},t.prototype._call=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,10]),[4,this._callUnsafe(e,t,n)];case 1:return[2,o.sent()];case 2:switch(r=o.sent(),ue.warn("Api call error",r),i=I.API,r.error_code){case 102:case 103:case 104:return[3,3];case 1101:return[3,5];case 1102:return[3,6];case 1103:return[3,7];case 1104:case 1106:return[3,8]}return[3,9];case 3:return[4,this.authorize()];case 4:return o.sent(),[2,this._callUnsafe(e,t,n)];case 5:return i=A.SERVICE_DISABLED,[3,9];case 6:return i=A.CALLEE_IS_OFFLINE,[3,9];case 7:return i=A.NOT_FRIENDS,[3,9];case 8:return i=A.EXTERNAL_API_ERROR,[3,9];case 9:throw new ct(i,{message:r.error_msg,code:r.error_code});case 10:return[2]}}))}))},t.prototype.userId=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return t=pe.decomposeId(e).id,ee.isEmpty()?[2,Je.fromId(String(t))]:this._externalUidsCache.hasOwnProperty(t)?[3,2]:(r=(n=Object).assign,i=[this._externalUidsCache],[4,this._getExternalIdsByOkIds([t])]);case 1:r.apply(n,i.concat([o.sent()])),o.label=2;case 2:return[2,Je.fromString(this._externalUidsCache[t])]}}))}))},t.prototype.prepareUserIds=function(e){return l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:return ee.isEmpty()?[3,2]:(n=(t=Object).assign,r=[this._externalUidsCache],[4,this._getExternalIdsByOkIds(e)]);case 1:n.apply(t,r.concat([i.sent()])),i.label=2;case 2:return[2]}}))}))},t.prototype.authorize=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return h(this,(function(r){return this._uuid||((e=_e.get("uuid"))||(e=pe.uuid(),_e.set("uuid",e)),this._uuid=String(e)),t={session_data:{version:2,device_id:this._uuid,client_version:te.appVersion,client_type:"SDK_JS"}},te.authToken&&(t.session_data.auth_token=te.authToken,t.session_data.version=3),[2,this._callUnsafe("auth.anonymLogin",t,!0).then((function(e){e.uid&&(n._userId=Number(e.uid)),ee.sessionKey=e.session_key,ee.sessionSecretKey=e.session_secret_key})).catch((function(e){throw 401===e.error_code&&se.onTokenExpired(),new ct(I.AUTH,{message:e.error_msg,code:e.error_code})}))]}))}))},t.prototype.log=function(e){Ht("log.externalLog",{collector:"ok.mobile.apps.video",data:JSON.stringify({application:te.appName+":"+c,platform:te.platform,items:e})})},t.prototype.init=function(){!function(){if(!te.apiAppId||!te.apiKey)throw new ct(I.API,{message:"Required arguments apiAppId/apiAppKey not passed"})}()},t.prototype.joinConversation=function(e,t,n){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var r;return h(this,(function(i){return r={conversationId:e,isVideo:t},n&&(r.chatId=n),[2,this._call("vchat.joinConversation",r)]}))}))},t.prototype.createConversation=function(e,t,n){return void 0===t&&(t=""),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r;return h(this,(function(i){return r={conversationId:e,createJoinLink:!0,isVideo:!1},t&&(r.payload=t),te.domain&&(r.domainId=te.domain),n&&(r.requireAuthToJoin=!0),[2,this._startConversation(r)]}))}))},t.prototype.startConversation=function(e,t,n,r,i,o,a){return void 0===r&&(r=!1),void 0===i&&(i=""),void 0===o&&(o=!1),void 0===a&&(a=!1),l(this,void 0,void 0,(function(){var s;return h(this,(function(c){if(s={conversationId:e,isVideo:r},t&&t.length)switch(n){case E.USER:s.uids=t.join(",");break;case E.GROUP:s.gid=t[0];break;case E.CHAT:s.chatId=t[0]}return o&&(s.createJoinLink=!0),i&&(s.payload=i),te.domain&&(s.domainId=te.domain),a&&(s.requireAuthToJoin=!0),[2,this._startConversation(s)]}))}))},t.prototype._startConversation=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._call("vchat.startConversation",e)]}))}))},t.prototype.createJoinLink=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._call("vchat.createJoinLink",{conversationId:e})]}))}))},t.prototype.removeJoinLink=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._call("vchat.removeJoinLink",{conversationId:e})]}))}))},t.prototype.getAnonymTokenByLink=function(e,t){return l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return n={joinLink:e},t&&(n.anonymName=t),[4,this._call("vchat.getAnonymTokenByLink",n)];case 1:return r=i.sent(),this._userId=Number(r.uid),[2,r.token]}}))}))},t.prototype.joinConversationByLink=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return n={joinLink:e,isVideo:t},te.anonymToken&&(n.anonymToken=te.anonymToken),[2,this._call("vchat.joinConversationByLink",n)]}))}))},t.prototype.getOkIdsByExternalIds=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d,p,l=this;return h(this,(function(h){switch(h.label){case 0:for(t=Je.fromIds(e),n=[],r={methods:[]},i=[],o=Object.keys(this._externalUidsCache),a=Object.values(this._externalUidsCache),s=0,c=t;s<c.length;s++)u=c[s],d=Je.toString(u),(p=a.indexOf(d))>-1?n.push(Number(o[p])):(i.push(d),r.methods.push({"vchat.getOkIdByExternalId":{params:{externalId:u.id,anonym:u.type===$e.ANONYM},onError:"SKIP"}}));return r.methods.length?[4,this._call("batch.executeV2",r)]:[2,n];case 1:return h.sent().forEach((function(e,t){if(e.ok){var r=Number(e.ok.ok_id);l._externalUidsCache[r]=i[t],n.push(r)}})),[2,n]}}))}))},t.prototype.getExternalIdsByOkIds=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c;return h(this,(function(u){switch(u.label){case 0:for(t=[],n=[],r=0,i=e;r<i.length;r++)c=i[r],this._externalUidsCache.hasOwnProperty(c)?t.push(Je.fromString(this._externalUidsCache[c])):n.push(c);return n.length?[4,this._getExternalIdsByOkIds(n)]:[2,t];case 1:for(o=u.sent(),Object.assign(this._externalUidsCache,o),a=0,s=n;a<s.length;a++)c=s[a],o.hasOwnProperty(c)&&t.push(Je.fromString(o[c]));return[2,t]}}))}))},t.prototype.getCachedOkIdByExternalId=function(e){var t=Object.keys(this._externalUidsCache),n=Object.values(this._externalUidsCache),r=Je.toString(e),i=n.indexOf(r);return i>-1?pe.composeId(t[i],"USER"):null},t.prototype.cacheExternalId=function(e,t){var n=pe.decomposeId(e).id;this._externalUidsCache[n]=Je.toString(t)},t.prototype.getConversationParams=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return e={},te.anonymToken&&(e.anonymToken=te.anonymToken),[2,this._call("vchat.getConversationParams",e)]}))}))},t.prototype.getUserId=function(){return this._userId},t.prototype.setUserId=function(e){this._userId=e},t.prototype.hangupConversation=function(e){var t={conversationId:e,reason:A.HUNGUP};te.anonymToken&&(t.anonymToken=te.anonymToken),Ht("vchat.hangupConversation",t)},t.prototype.cleanup=function(){},t.prototype._getExternalIdsByOkIds=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c,u,d;return h(this,(function(p){switch(p.label){case 0:t={},p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this._call("vchat.getExternalIdsByOkIds",{uids:e.join(",")})];case 2:if((n=p.sent()).external_ids)for(r=0,i=Object.entries(n.external_ids);r<i.length;r++)o=i[r],u=o[0],d=o[1],t[u]=Je.fromIdToString(d,$e.USER);if(n.anonym_ids)for(a=0,s=Object.entries(n.anonym_ids);a<s.length;a++)c=s[a],u=c[0],d=c[1],t[u]=Je.fromIdToString(d,$e.ANONYM);return[2,t];case 3:return p.sent(),[2,t];case 4:return[2]}}))}))},t}(m);!function(e){e.RECOVER="recover",e.ACCEPT_CALL="accept-call",e.ADD_PARTICIPANT="add-participant",e.REMOVE_PARTICIPANT="remove-participant",e.HANGUP="hangup",e.TRANSMIT_DATA="transmit-data",e.ACCEPT_PRODUCER="accept-producer",e.ALLOCATE_CONSUMER="allocate-consumer",e.CHANGE_MEDIA_SETTINGS="change-media-settings",e.CHANGE_PARTICIPANT_STATE="change-participant-state",e.CHANGE_STREAM_PRIORITIES="change-streams-priorities",e.UPDATE_DISPLAY_LAYOUT="update-display-layout",e.REPORT_PERF_STAT="report-perf-stat",e.RECORD_START="record-start",e.RECORD_STOP="record-stop",e.RECORD_GET_STATUS="record-get-status",e.SWITCH_MICRO="switch-micro",e.SWITCH_TOPOLOGY="switch-topology",e.REQUEST_REALLOC="request-realloc",e.CHAT_MESSAGE="chat-message",e.CHAT_HISTORY="chat-history",e.CUSTOM_DATA="custom-data",e.GRANT_ROLES="grant-roles",e.MUTE_PARTICIPANT="mute-participant",e.PIN_PARTICIPANT="pin-participant",e.UPDATE_MEDIA_MODIFIERS="update-media-modifiers",e.CHANGE_OPTIONS="change-options",e.GET_WAITING_HALL="get-waiting-hall",e.PROMOTE_PARTICIPANT="promote-participant",e.REQUEST_TEST_MODE="request-test-mode"}($t||($t={}));var zt,Yt,Xt=$t,Qt=[function(){return te.producerScreenTrack},function(){return te.videoTracksCount>0},function(){return!0},function(){return te.filteredMessages},function(){return te.consumerScreenTrack}],Zt=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.socket=null,n.sequence=1,n.lastStamp=0,n.websocketCommandsQueue=[],n.datachannelCommandsQueue=[],n.incomingCache=[],n.responseHandlers={},n.reconnectCount=0,n.conversationResolve=null,n.conversationReject=null,n.connected=!1,n.listenersReady=!1,n.postfix="&platform="+te.platform+"&appVersion="+te.appVersion+"&version="+te.protocolVersion+"&device="+te.device+"&capabilities="+t._getCapabilityFlags(),n.peerId=null,n.conversationId=null,n.reconnectTimer=0,n.connectionMessageWaitTimer=0,n.doctorTimer=0,n.participantIdRegistry=null,n.producerNotificationDataChannel=null,n.producerCommandDataChannel=null,n}return d(t,e),t._getCapabilityFlags=function(){for(var e=0,t=0;t<Qt.length;t++)Qt[t]()&&(e|=1<<t);return e.toString(16).toUpperCase()},Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this.socket},enumerable:!1,configurable:!0}),t.prototype.setEndpoint=function(e){this.endpoint=e},t.prototype.setConversationId=function(e){this.conversationId=e},t.prototype.setParticipantIdRegistry=function(e){this.participantIdRegistry=e},t.prototype.setProducerNotificationDataChannel=function(e){var t=this;this.producerNotificationDataChannel=e,this.producerNotificationDataChannel.onmessage=function(e){var n,r=null===(n=t.participantIdRegistry)||void 0===n?void 0:n.handleMessage(e.data);r&&t._handleMessage(r)}},t.prototype.setProducerCommandDataChannel=function(e){this.producerCommandDataChannel=e,this.producerCommandDataChannel.onmessage=this._onMessage.bind(this),this._handleCommandsQueue(this.datachannelCommandsQueue)},t.prototype.cleanup=function(){this.datachannelCommandsQueue=[]},t.prototype.connect=function(e){return l(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){return this.postfix+="&clientType="+te.clientType,[2,new Promise((function(n,r){if(t.socket&&t.socket.readyState<WebSocket.CLOSING)return it.log("callSocketAction","already_opened"),void r(Error("Socket already opened"));t.conversationResolve=function(e){n(e),t.conversationResolve=null,t.conversationReject=null},t.conversationReject=function(e){r(e),t.conversationResolve=null,t.conversationReject=null},t._connect(e)}))]}))}))},t.prototype._send=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=0),l(this,void 0,void 0,(function(){var r;return h(this,(function(i){return t.participantId&&(r=pe.decomposeId(t.participantId),t=Object.assign({},t,{participantId:r.id,participantType:r.type})),[2,this._sendRaw(e,t,n)]}))}))},t.prototype._sendRaw=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=0),l(this,void 0,void 0,(function(){var r,i=this;return h(this,(function(o){return r=function(t){var n;if(i._isDataChannelCommand(e))i.datachannelCommandsQueue.push(t),"open"===(null===(n=i.producerCommandDataChannel)||void 0===n?void 0:n.readyState)&&i._handleCommandsQueue(i.datachannelCommandsQueue);else{if(!i.socket)return it.log("callSocketAction","not_opened"),ue.warn("Socket not opened"),void t.reject(new Error("Socket not opened ["+e+"]"),!0);i.socket.readyState>WebSocket.OPEN&&(it.log("callSocketAction","invalid_state"),ue.warn("Socket is not opened, state "+i.socket.readyState)),i.websocketCommandsQueue.push(t),i.socket&&i.socket.readyState===WebSocket.OPEN&&i._handleCommandsQueue(i.websocketCommandsQueue)}},[2,new Promise((function(o,a){var s={sequence:i.sequence++,name:e,params:t,responseTimer:0,resolve:o,reject:function(t,i){void 0===i&&(i=!1),!n||i?a(t):(ue.debug("Resending a signaling message",e,s.sequence),n--,r(s))}};r(s)}))]}))}))},t.prototype._isDataChannelCommand=function(e){return!!this.producerCommandDataChannel&&(e===Xt.UPDATE_DISPLAY_LAYOUT||e===Xt.REPORT_PERF_STAT)},t._isDataChannelResponseRequired=function(e){return e===Xt.UPDATE_DISPLAY_LAYOUT||e===Xt.REPORT_PERF_STAT},t.prototype.getNextCommandSequenceNumber=function(){return this.sequence},t.prototype.hangup=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.HANGUP,{reason:e}).catch((function(){}))]}))}))},t.prototype.sendCandidate=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.TRANSMIT_DATA,{participantId:e,data:{candidate:t}})]}))}))},t.prototype.requestTestMode=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.REQUEST_TEST_MODE,{consumerCommand:e})]}))}))},t.prototype.sendSdp=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.TRANSMIT_DATA,{participantId:e,data:{sdp:t}})]}))}))},t.prototype.acceptCall=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.ACCEPT_CALL,{mediaSettings:e})]}))}))},t.prototype.changeMediaSettings=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.CHANGE_MEDIA_SETTINGS,{mediaSettings:e},10)]}))}))},t.prototype.changeParticipantState=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.CHANGE_PARTICIPANT_STATE,{participantState:{state:e}})]}))}))},t.prototype.addParticipant=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.ADD_PARTICIPANT,p({participantId:e},t))]}))}))},t.prototype.removeParticipant=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.REMOVE_PARTICIPANT,{participantId:e,ban:t})]}))}))},t.prototype.allocateConsumer=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return n={capabilities:t},e&&(n.description=e.sdp),[2,this._send(Xt.ALLOCATE_CONSUMER,n)]}))}))},t.prototype.acceptProducer=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return n={description:e.sdp},t&&(n.ssrcs=t),[2,this._send(Xt.ACCEPT_PRODUCER,n)]}))}))},t.prototype.changePriorities=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.CHANGE_STREAM_PRIORITIES,{typedPriorities:e}).catch((function(){}))]}))}))},t.prototype.updateDisplayLayout=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.UPDATE_DISPLAY_LAYOUT,{layouts:e})]}))}))},t.prototype.startStream=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.RECORD_START,e)]}))}))},t.prototype.stopStream=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,this._send(Xt.RECORD_STOP)]}))}))},t.prototype.getRecordStatus=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,this._send(Xt.RECORD_GET_STATUS)]}))}))},t.prototype.switchTopology=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.SWITCH_TOPOLOGY,{topology:e,force:t})]}))}))},t.prototype.requestRealloc=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,this._send(Xt.REQUEST_REALLOC)]}))}))},t.prototype.reportPerfStat=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.REPORT_PERF_STAT,{report:e})]}))}))},t.prototype.chatMessage=function(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.CHAT_MESSAGE,{message:e,participantId:t})]}))}))},t.prototype.chatHistory=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.CHAT_HISTORY,{count:e})]}))}))},t.prototype.customData=function(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,this._send(Xt.CUSTOM_DATA,{data:e,participantId:t})]}))}))},t.prototype.grantRoles=function(e,t,n){return l(this,void 0,void 0,(function(){var r;return h(this,(function(i){return r={participantId:e,roles:t},n&&(r.revoke=!0),[2,this._sendRaw(Xt.GRANT_ROLES,r)]}))}))},t.prototype.muteParticipant=function(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),l(this,void 0,void 0,(function(){return h(this,(function(i){return[2,this._sendRaw(Xt.MUTE_PARTICIPANT,{participantId:e,mediaOptions:t,unmute:n,mutePermanent:r})]}))}))},t.prototype.pinParticipant=function(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return n={participantId:e},t&&(n.unpin=!0),[2,this._sendRaw(Xt.PIN_PARTICIPANT,n)]}))}))},t.prototype.updateMediaModifiers=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.UPDATE_MEDIA_MODIFIERS,{mediaModifiers:e})]}))}))},t.prototype.changeOptions=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this._send(Xt.CHANGE_OPTIONS,{options:e})]}))}))},t.prototype.getWaitingHall=function(e,t,n){return void 0===e&&(e=null),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r;return h(this,(function(i){return r={},e&&(r.fromId=e),t&&(r.count=t),n&&(r.backward=n),[2,this._send(Xt.GET_WAITING_HALL,r)]}))}))},t.prototype.promoteParticipant=function(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return n={participantId:e},t&&(n.demote=t),[2,this._sendRaw(Xt.PROMOTE_PARTICIPANT,n)]}))}))},t.prototype.close=function(){this.socket&&this.socket.readyState<WebSocket.CLOSING&&this._closeSocket(),this._stopWaitConnectionMessage(),this._stopDoctor(),clearTimeout(this.reconnectTimer)},t.prototype.readyToSend=function(){this.listenersReady=!0,this._handleCachedMessages()},t.prototype._connect=function(e){if(!(this.socket&&this.socket.readyState<WebSocket.CLOSING)){var t="";e&&(t+="&tgt="+e),e===N.RETRY&&this.lastStamp&&(t+="&recoverTs="+this.lastStamp),ue.debug("Connecting to "+this.endpoint+this.postfix+t),this.socket=new WebSocket(this.endpoint+this.postfix+t),this.socket.onopen=this._onOpen.bind(this),this.socket.onmessage=this._onMessage.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this._startDoctor()}},t.prototype._disconnect=function(){this.socket&&this.socket.readyState<WebSocket.CLOSING&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close(),this.socket=null),this._stopWaitConnectionMessage(),this._stopDoctor(),clearTimeout(this.reconnectTimer)},t.prototype._onOpen=function(){ue.debug("Socket opened"),it.log("callSocketAction","opened"),this._waitConnectionMessage(),this._startDoctor()},t.prototype._onMessage=function(e){if(this._startDoctor(),"ping"!==e.data)try{this._handleMessage(JSON.parse(e.data))}catch(t){it.log("callSocketAction","parse_error"),ue.error("Unable to parse message",t,e.data)}else this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send("pong")},t.prototype._handleMessage=function(e){var t,n=this;"notification"===e.type?"connection"===e.notification?(ue.debug("Signaling connected",e),this.connected=!0,this.reconnectCount=0,this.endpoint=e.endpoint,e.peerId&&this.peerId!==e.peerId.id&&(this.postfix+="&peerId="+e.peerId.id,this.peerId=e.peerId.id),this._stopWaitConnectionMessage(),this.conversationResolve?this.conversationResolve(e):(this._triggerEvent("RECONNECT",e),e.conversation.topology&&this._triggerEvent("NOTIFICATION",{type:"notification",notification:"topology-changed",topology:e.conversation.topology})),this.lastStamp&&this._handleCachedMessages(),null===(t=e.recoverMessages)||void 0===t||t.forEach((function(e){return n._handleMessage(e)})),this._handleCommandsQueue(this.websocketCommandsQueue)):this.connected&&this.listenersReady?this._triggerEvent("NOTIFICATION",e):this.incomingCache.push(e):"response"===e.type&&this.responseHandlers[e.sequence]?this._handleCommandResponse(!0,e):"error"===e.type&&this.responseHandlers[e.sequence]?(it.log("callSocketAction","error-"+e.error),this._handleCommandResponse(!1,e)):"error"===e.type?(it.log("callSocketAction","error-"+e.error),"service-unavailable"===e.error?this._reconnect():"conversation-ended"===e.error?this.conversationReject?this.conversationReject(new ct(A.SOCKET_CLOSED,{message:"Unable to connect to the signaling: "+e.error})):this._triggerEvent("NOTIFICATION",{notification:"closed-conversation",reason:e.reason}):this.connected||"invalid-token"===e.error?this._throwError(new Error("Signaling error: "+e.error)):e.sequence||(this.conversationReject&&this.conversationReject(new ct(I.SIGNALING_FAILED,{message:"Unable to connect to the signaling: "+e.error})),this._closeSocket())):(it.log("callSocketAction","unknown_message"),ue.warn("Unhandled message",e)),this.lastStamp=e.stamp||this.lastStamp},t.prototype._handleCachedMessages=function(){var e=f(this.incomingCache);for(this.incomingCache=[];e.length>0;){var t=e.shift();this._handleMessage(t)}},t.prototype._throwError=function(e){this._triggerEvent("FAILED",e)},t.prototype._onError=function(e){it.log("callSocketAction","error"),ue.error("Signaling error",e)},t.prototype._onClose=function(e){it.log("callSocketAction","closed"),ue.debug("Connection closed",{code:e.code,reason:e.reason}),this.connected=!1,this._stopDoctor(),this.socket&&this.reconnectCount++<t.RECONNECT_MAX_COUNT?this._reconnect():this.socket&&this._closeSocket(new Error("Connection closed"))},t.prototype._closeSocket=function(e){void 0===e&&(e=null),this.socket&&(this._disconnect(),Object.values(this.responseHandlers).forEach((function(t){window.clearTimeout(t.responseTimer),e&&t.reject(new Error("Connection closed"),!0)})),this.websocketCommandsQueue=[],this.responseHandlers={},this.lastStamp=0,e&&this._throwError(new Error("Connection closed")))},t.prototype._reconnect=function(){var e=Math.min(t.RECONNECT_MAX_DELAY,t.RECONNECT_DELAY*Math.pow(2,this.reconnectCount-1));ue.log("Reconnect websocket after "+e+"ms ("+this.reconnectCount+")"),it.log("callSocketAction","reconnect"),this.reconnectTimer=window.setTimeout(this._connect.bind(this,N.RETRY),e)},t.prototype._handleCommandResponse=function(e,n){var r,i=this;if(this.responseHandlers.hasOwnProperty(n.sequence)){var o=this.responseHandlers[n.sequence];window.clearTimeout(o.responseTimer),e?(delete this.responseHandlers[n.sequence],o.resolve(n)):(null===(r=this.socket)||void 0===r?void 0:r.readyState)===WebSocket.OPEN?(delete this.responseHandlers[n.sequence],it.log("callSocketAction","response-timeout"),o.reject(new Error(n.error||"Response timeout ["+o.name+"]"))):o.responseTimer=window.setTimeout((function(){return i._handleCommandResponse(!1,n)}),t.WAIT_RESPONSE_DELAY)}},t.prototype._handleCommandsQueue=function(e){for(var n,r,i=this,o=function(){var o=e.shift(),s=Object.assign({command:o.name,sequence:o.sequence},o.params);if(a._isDataChannelCommand(o.name)){if("open"!==(null===(n=a.producerCommandDataChannel)||void 0===n?void 0:n.readyState))return o.reject(new Error("Invalid data channel state: "+(null===(r=a.producerCommandDataChannel)||void 0===r?void 0:r.readyState))),{value:void 0};t._isDataChannelResponseRequired(o.name)&&(o.responseTimer=window.setTimeout((function(){return i._handleCommandResponse(!1,s)}),t.WAIT_RESPONSE_DELAY),a.responseHandlers[o.sequence]=o),a.producerCommandDataChannel.send(JSON.stringify(s))}else{if(!a.socket||a.socket.readyState!==WebSocket.OPEN)return o.reject(new Error("Invalid state or socket already closed")),"continue";o.responseTimer=window.setTimeout((function(){return i._handleCommandResponse(!1,s)}),t.WAIT_RESPONSE_DELAY),a.responseHandlers[o.sequence]=o,a.socket.send(JSON.stringify(s))}},a=this;e.length>0;){var s=o();if("object"==typeof s)return s.value}},t.prototype._waitConnectionMessage=function(){var e=this;this.connectionMessageWaitTimer=window.setTimeout((function(){e.conversationReject&&e.conversationReject(new ct(I.SIGNALING_FAILED,{message:"Unable to connect to the signaling: connection timeout"}))}),t.WAIT_CONNECTION_DELAY)},t.prototype._stopWaitConnectionMessage=function(){window.clearTimeout(this.connectionMessageWaitTimer),this.connectionMessageWaitTimer=0},t.prototype._startDoctor=function(){var e=this;this._stopDoctor(),this.doctorTimer=window.setTimeout((function(){ue.warn("Socket is dead, trying to reconnect"),e._disconnect(),e._connect(N.RETRY)}),t.WAIT_MESSAGE_DELAY)},t.prototype._stopDoctor=function(){window.clearTimeout(this.doctorTimer),this.doctorTimer=0},t.RECONNECT_DELAY=te.signalingReconnectDelay,t.RECONNECT_MAX_DELAY=te.signalingReconnectMaxDelay,t.RECONNECT_MAX_COUNT=te.signalingReconnectMaxCount,t.WAIT_CONNECTION_DELAY=te.waitConnectionDelay,t.WAIT_RESPONSE_DELAY=te.waitResponseDelay,t.WAIT_MESSAGE_DELAY=te.waitMessageDelay,t}(y),en=null,tn={getCameras:Ye.getCameras,getMicrophones:Ye.getMicrophones,getOutput:Ye.getOutput,hasCamera:Ye.hasCamera,hasMicrophone:Ye.hasMicrophone,getSavedCamera:Ye.getSavedCamera,getSavedMicrophone:Ye.getSavedMicrophone,getSavedOutput:Ye.getSavedOutput,hasCameraPermission:Ye.hasCameraPermission,hasMicrophonePermission:Ye.hasMicrophonePermission,hasPermissions:Ye.hasPermissions,getUserMedia:Ye.getUserMedia,getUserVideo:Ye.getUserVideo,getUserAudio:Ye.getUserAudio,saveDeviceId:Ye.saveDeviceId,isBrowserSupported:Ye.isBrowserSupported,isScreenCapturingSupported:Ye.isScreenCapturingSupported,os:Ye.os,isMobile:Ye.isMobile,browserName:Ye.browserName,browserVersion:Ye.browserVersion,baseChromeVersion:Ye.baseChromeVersion,getAudioContext:Ye.getAudioContext};function nn(e){Yt=e}function rn(e){zt=e}function on(e){en=e}function an(e){te.videoEffects=e}function sn(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return te.set(e),"Sferum"===Ye.browserName()&&(te.platform="SFERUM:"+Ye.browserVersion()),Yt||nn(new Jt),zt||rn((function(){return new Zt})),ue.log("Calls SDK "+c,e),[4,Ye.init()];case 1:if(t.sent(),!Ye.isBrowserSupported())throw new ct(I.UNSUPPORTED);return Yt.init(),[2]}}))}))}function cn(e,t,n,r,i){return void 0===t&&(t=[k.AUDIO]),void 0===n&&(n=""),void 0===r&&(r=!1),void 0===i&&(i=!1),l(this,void 0,void 0,(function(){var o,a;return h(this,(function(s){switch(s.label){case 0:return o=[],a=[],Array.isArray(e)?o=e.length?e:[]:e&&(o=[e]),o.length?[4,Yt.getOkIdsByExternalIds(o)]:[3,2];case 1:if(!(a=s.sent()).length)throw new ct(A.CALLEE_IS_OFFLINE);s.label=2;case 2:return[2,un(a,E.USER,t,n,r,i)]}}))}))}function un(e,t,n,r,i,o){return void 0===t&&(t=E.USER),void 0===r&&(r=""),void 0===i&&(i=!1),void 0===o&&(o=!1),l(this,void 0,void 0,(function(){return h(this,(function(a){if(Gt.current())throw ue.error("There is already active call"),new ct(A.FAILED);return[2,new Gt(Yt,zt(),en).onStart(e,t,n,r,i,o)]}))}))}function dn(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,pn(e)]}))}))}function pn(e,t,n){return void 0===t&&(t="USER"),l(this,void 0,void 0,(function(){return h(this,(function(r){if(e===Gt.id())throw new Error("Push has already been processed");return[2,new Gt(Yt,zt(),en).onPush(e,t,n)]}))}))}function ln(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return e&&(te.authToken=e),[2,Yt.authorize()]}))}))}function hn(e){return void 0===e&&(e=[k.AUDIO]),l(this,void 0,void 0,(function(){var t;return h(this,(function(n){if(t=Gt.current())return[2,t.accept(e)];throw new Error("Conversation not found")}))}))}function fn(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return(e=Gt.current())?[2,e.decline()]:[2]}))}))}function vn(e,t){return void 0===t&&(t=[k.AUDIO]),l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,mn(e,t)]}))}))}function mn(e,t,n){return l(this,void 0,void 0,(function(){return h(this,(function(r){if(Gt.current())throw ue.error("There is already active call"),new ct(A.FAILED);return[2,new Gt(Yt,zt(),en).onJoin({conversationId:e,mediaOptions:t,chatId:n})]}))}))}function _n(e,t,n){return void 0===t&&(t=[k.AUDIO]),l(this,void 0,void 0,(function(){return h(this,(function(r){if(Gt.current())throw ue.error("There is already active call"),new ct(A.FAILED);return n&&(te.anonymToken=n),[2,new Gt(Yt,zt(),en).onJoin({joinLink:e,mediaOptions:t})]}))}))}function gn(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return(e=Gt.current())?[2,e.hangup()]:(Gt.hangupAfterInit(),[2])}))}))}function yn(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return[4,Yt.getOkIdsByExternalIds([e])];case 1:if(!(n=r.sent()).length)throw new Error("User not found");return[2,Sn(n[0],t)]}}))}))}function Sn(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return(n=Gt.current())?[4,n.addParticipant(pe.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function En(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,Yt.getOkIdsByExternalIds([e])];case 1:return[2,Tn(n.sent()[0],t)]}}))}))}function Tn(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return(n=Gt.current())?[4,n.removeParticipant(pe.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function Cn(e,t){return l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return[4,Ye.saveDeviceId(e,t)];case 1:return n=i.sent(),r=Gt.current(),n&&r?[2,r.changeDevice(e)]:[2,Promise.reject()]}}))}))}function bn(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){return(t=Gt.current())?[2,t.toggleScreenCapturing(e)]:[2,Promise.reject()]}))}))}function Rn(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return(n=Gt.current())?[4,n.setVideoStream(e,t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function wn(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.toggleLocalVideo(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function In(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.toggleLocalAudio(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Pn(e,t){return l(this,void 0,void 0,(function(){var n;return h(this,(function(r){return(n=Gt.current())?[2,n.setLocalResolution(e,t)]:[2]}))}))}function An(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.changePriorities(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function On(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.changeParticipantState(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function kn(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.updateDisplayLayout(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Dn(e,t,n){return void 0===n&&(n=!1),l(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,Yt.getOkIdsByExternalIds([e])];case 1:return[2,Nn(r.sent()[0],t,n)]}}))}))}function Nn(e,t,n){return void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r;return h(this,(function(i){switch(i.label){case 0:return(r=Gt.current())?[4,r.grantRoles(pe.composeId(e,"USER"),t,n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function Mn(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=[k.AUDIO]),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:return r=null,e?[4,Yt.getOkIdsByExternalIds([e])]:[3,2];case 1:i=o.sent(),r=i[0],o.label=2;case 2:return[2,Ln(r,t,n)]}}))}))}function Ln(e,t,n){return void 0===e&&(e=null),void 0===t&&(t=[k.AUDIO]),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:return(r=Gt.current())?(i=e?pe.composeId(e,"USER"):null,[4,r.switchParticipantDevice(i,t,!1,n)]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}}))}))}function xn(e,t){return void 0===e&&(e=null),void 0===t&&(t=[k.AUDIO]),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return n=null,e?[4,Yt.getOkIdsByExternalIds([e])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Un(n,t)]}}))}))}function Un(e,t){return void 0===e&&(e=null),void 0===t&&(t=[k.AUDIO]),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return(n=Gt.current())?(r=e?pe.composeId(e,"USER"):null,[4,n.switchParticipantDevice(r,t,!0)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function jn(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,Yt.getOkIdsByExternalIds([e])];case 1:return[2,Vn(n.sent()[0],t)]}}))}))}function Vn(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return(n=Gt.current())?[4,n.pinParticipant(pe.composeId(e,"USER"),t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}function Fn(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.updateMediaModifiers(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Gn(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.changeOptions(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function Bn(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return n=null,t?[4,Yt.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Hn(e,n)]}}))}))}function Hn(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return(n=Gt.current())?(r=t?pe.composeId(t,"USER"):null,[4,n.chatMessage(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function Wn(e){return void 0===e&&(e=10),l(this,void 0,void 0,(function(){var t;return h(this,(function(n){return(t=Gt.current())?[2,t.chatHistory(e)]:[2]}))}))}function qn(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return n=null,t?[4,Yt.getOkIdsByExternalIds([t])]:[3,2];case 1:r=i.sent(),n=r[0],i.label=2;case 2:return[2,Kn(e,n)]}}))}))}function Kn(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:return(n=Gt.current())?(r=t?pe.composeId(t,"USER"):null,[4,n.customData(e,r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}function $n(e,t){return void 0===e&&(e=""),void 0===t&&(t=!1),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,Yt.createConversation(pe.uuid(),e,t)];case 1:return[2,n.sent().join_link]}}))}))}function Jn(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return(e=Gt.current())?[2,e.createJoinLink()]:[2,Promise.reject()]}))}))}function zn(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return(e=Gt.current())?[2,e.removeJoinLink()]:[2,Promise.reject()]}))}))}function Yn(e,t){return l(this,void 0,void 0,(function(){return h(this,(function(n){return[2,Yt.getAnonymTokenByLink(e,t)]}))}))}function Xn(e){var t=Gt.current();t&&t.setVolume(e)}function Qn(e){te.forceRelayPolicy=e}function Zn(e,t,n,r,i){return void 0===e&&(e=!1),void 0===t&&(t=null),void 0===n&&(n=null),void 0===r&&(r="DIRECT_LINK"),void 0===i&&(i=null),l(this,void 0,void 0,(function(){var o;return h(this,(function(a){return(o=Gt.current())?[2,o.startStream(e,t,n,r,i)]:[2,Promise.reject()]}))}))}function er(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return(e=Gt.current())?[2,e.stopStream()]:[2,Promise.reject()]}))}))}function tr(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){return(e=Gt.current())?[2,e.getStreamInfo()]:[2,Promise.reject()]}))}))}function nr(e){te.statisticsInterval=e;var t=Gt.current();if(t)return t.updateStatisticsInterval()}function rr(e){ue.toggle(e)}function ir(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];te.debugLog&&ue.send.apply(ue,f([e,"[external]"],t))}function or(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){return(t=Gt.current())?[2,t.videoEffect(e)]:[2]}))}))}function ar(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return(t=Gt.current())?[4,t.setAudioStream(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}function sr(e,t,n){return void 0===e&&(e=null),void 0===n&&(n=!1),l(this,void 0,void 0,(function(){var r;return h(this,(function(i){if(!(r=Gt.current()))throw new Error("Conversation not found");return[2,r.getWaitingHall(e,t,n)]}))}))}function cr(e,t){return void 0===t&&(t=!1),l(this,void 0,void 0,(function(){var n,r;return h(this,(function(i){switch(i.label){case 0:if(!(n=Gt.current()))throw new Error("Conversation not found");return[4,Yt.getOkIdsByExternalIds([e])];case 1:return r=i.sent(),[2,n.promoteParticipant(pe.composeId(r[0],"USER"),t)]}}))}))}},406257:e=>{var t=function(){"undefined"!=typeof document&&document.currentScript&&document.currentScript.src;return function(e){var t,n,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,r){t=e,n=r}));var i,o={};for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);var a,s=[],c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var u=r.print||console.log.bind(console),d=r.printErr||console.warn.bind(console);for(i in o)o.hasOwnProperty(i)&&(r[i]=o[i]);o=null,r.arguments&&(s=r.arguments),r.thisProgram&&r.thisProgram,r.quit&&r.quit;var p,l=0;r.wasmBinary&&(p=r.wasmBinary);var h;r.noExitRuntime;"object"!=typeof WebAssembly&&B("no native wasm support detected");var f=!1;var v="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function m(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&v)return v.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var c=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|c:(7&a)<<18|s<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}function _(e,t){return e?m(S,e,t):""}var g,y,S,E,T,C,b,R,w,I="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function P(e,t){for(var n=e,r=n>>1,i=r+t/2;!(r>=i)&&T[r];)++r;if((n=r<<1)-e>32&&I)return I.decode(S.subarray(e,n));for(var o="",a=0;!(a>=t/2);++a){var s=E[e+2*a>>1];if(0==s)break;o+=String.fromCharCode(s)}return o}function A(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var r=t,i=(n-=2)<2*e.length?n/2:e.length,o=0;o<i;++o){var a=e.charCodeAt(o);E[t>>1]=a,t+=2}return E[t>>1]=0,t-r}function O(e){return 2*e.length}function k(e,t){for(var n=0,r="";!(n>=t/4);){var i=C[e+4*n>>2];if(0==i)break;if(++n,i>=65536){var o=i-65536;r+=String.fromCharCode(55296|o>>10,56320|1023&o)}else r+=String.fromCharCode(i)}return r}function D(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var r=t,i=r+n-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o);if(C[t>>2]=a,(t+=4)+4>i)break}return C[t>>2]=0,t-r}function N(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&++n,t+=4}return t}function M(e){g=e,r.HEAP8=y=new Int8Array(e),r.HEAP16=E=new Int16Array(e),r.HEAP32=C=new Int32Array(e),r.HEAPU8=S=new Uint8Array(e),r.HEAPU16=T=new Uint16Array(e),r.HEAPU32=b=new Uint32Array(e),r.HEAPF32=R=new Float32Array(e),r.HEAPF64=w=new Float64Array(e)}r.INITIAL_MEMORY;var L,x=[],U=[],j=[];var V=0,F=null,G=null;function B(e){r.onAbort&&r.onAbort(e),d(e+=""),f=!0,1,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}r.preloadedImages={},r.preloadedAudios={};var H,W;function q(e){return e.startsWith("data:application/octet-stream;base64,")}function K(e){try{if(e==H&&p)return new Uint8Array(p);if(a)return a(e);throw"both async and sync fetching of the wasm failed"}catch(e){B(e)}}function $(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?L.get(n)():L.get(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(r)}}function J(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}q(H="libvpx.wasm")||(W=H,H=r.locateFile?r.locateFile(W,c):c+W);var z=void 0;function Y(e){for(var t="",n=e;S[n];)t+=z[S[n++]];return t}var X={},Q={},Z={};function ee(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function te(e,t){return e=ee(e),function(){return t.apply(this,arguments)}}function ne(e,t){var n=te(t,(function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var re=void 0;function ie(e){throw new re(e)}var oe=void 0;function ae(e){throw new oe(e)}function se(e,t,n){function r(t){var r=n(t);r.length!==e.length&&ae("Mismatched type converter count");for(var i=0;i<e.length;++i)ce(e[i],r[i])}e.forEach((function(e){Z[e]=t}));var i=new Array(t.length),o=[],a=0;t.forEach((function(e,t){Q.hasOwnProperty(e)?i[t]=Q[e]:(o.push(e),X.hasOwnProperty(e)||(X[e]=[]),X[e].push((function(){i[t]=Q[e],++a===o.length&&r(i)})))})),0===o.length&&r(i)}function ce(e,t,n){if(n=n||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||ie('type "'+r+'" must have a positive integer typeid pointer'),Q.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;ie("Cannot register type '"+r+"' twice")}if(Q[e]=t,delete Z[e],X.hasOwnProperty(e)){var i=X[e];delete X[e],i.forEach((function(e){e()}))}}function ue(e){if(!(this instanceof Te))return!1;if(!(e instanceof Te))return!1;for(var t=this.$$.ptrType.registeredClass,n=this.$$.ptr,r=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)n=t.upcast(n),t=t.baseClass;for(;r.baseClass;)i=r.upcast(i),r=r.baseClass;return t===r&&n===i}function de(e){ie(e.$$.ptrType.registeredClass.name+" instance already deleted")}var pe=!1;function le(e){}function he(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function fe(e){return"undefined"==typeof FinalizationGroup?(fe=function(e){return e},e):(pe=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var n=t.value;n.ptr?he(n):console.warn("object already deleted: "+n.ptr)}})),le=function(e){pe.unregister(e.$$)},(fe=function(e){return pe.register(e,e.$$,e.$$),e})(e))}function ve(){if(this.$$.ptr||de(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=fe(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function me(){this.$$.ptr||de(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ie("Object already scheduled for deletion"),le(this),he(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function _e(){return!this.$$.ptr}var ge=void 0,ye=[];function Se(){for(;ye.length;){var e=ye.pop();e.$$.deleteScheduled=!1,e.delete()}}function Ee(){return this.$$.ptr||de(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ie("Object already scheduled for deletion"),ye.push(this),1===ye.length&&ge&&ge(Se),this.$$.deleteScheduled=!0,this}function Te(){}var Ce={};function be(e,t,n){if(void 0===e[t].overloadTable){var r=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ie("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[r.argCount]=r}}function Re(e,t,n){r.hasOwnProperty(e)?((void 0===n||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[n])&&ie("Cannot register public name '"+e+"' twice"),be(r,e,e),r.hasOwnProperty(n)&&ie("Cannot register multiple overloads of a function with the same number of arguments ("+n+")!"),r[e].overloadTable[n]=t):(r[e]=t,void 0!==n&&(r[e].numArguments=n))}function we(e,t,n,r,i,o,a,s){this.name=e,this.constructor=t,this.instancePrototype=n,this.rawDestructor=r,this.baseClass=i,this.getActualType=o,this.upcast=a,this.downcast=s,this.pureVirtualFunctions=[]}function Ie(e,t,n){for(;t!==n;)t.upcast||ie("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Pe(e,t){if(null===t)return this.isReference&&ie("null is not a valid "+this.name),0;t.$$||ie('Cannot pass "'+at(t)+'" as a '+this.name),t.$$.ptr||ie("Cannot pass deleted object as a pointer of type "+this.name);var n=t.$$.ptrType.registeredClass;return Ie(t.$$.ptr,n,this.registeredClass)}function Ae(e,t){var n;if(null===t)return this.isReference&&ie("null is not a valid "+this.name),this.isSmartPointer?(n=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,n),n):0;t.$$||ie('Cannot pass "'+at(t)+'" as a '+this.name),t.$$.ptr||ie("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&ie("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass;if(n=Ie(t.$$.ptr,r,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&ie("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?n=t.$$.smartPtr:ie("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:n=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)n=t.$$.smartPtr;else{var i=t.clone();n=this.rawShare(n,rt((function(){i.delete()}))),null!==e&&e.push(this.rawDestructor,n)}break;default:ie("Unsupporting sharing policy")}return n}function Oe(e,t){if(null===t)return this.isReference&&ie("null is not a valid "+this.name),0;t.$$||ie('Cannot pass "'+at(t)+'" as a '+this.name),t.$$.ptr||ie("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&ie("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;return Ie(t.$$.ptr,n,this.registeredClass)}function ke(e){return this.fromWireType(b[e>>2])}function De(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Ne(e){this.rawDestructor&&this.rawDestructor(e)}function Me(e){null!==e&&e.delete()}function Le(e,t,n){if(t===n)return e;if(void 0===n.baseClass)return null;var r=Le(e,t,n.baseClass);return null===r?null:n.downcast(r)}function xe(){return Object.keys(Ve).length}function Ue(){var e=[];for(var t in Ve)Ve.hasOwnProperty(t)&&e.push(Ve[t]);return e}function je(e){ge=e,ye.length&&ge&&ge(Se)}var Ve={};function Fe(e,t){return t=function(e,t){for(void 0===t&&ie("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),Ve[t]}function Ge(e,t){return t.ptrType&&t.ptr||ae("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!==!!t.smartPtr&&ae("Both smartPtrType and smartPtr must be specified"),t.count={value:1},fe(Object.create(e,{$$:{value:t}}))}function Be(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var n=Fe(this.registeredClass,t);if(void 0!==n){if(0===n.$$.count.value)return n.$$.ptr=t,n.$$.smartPtr=e,n.clone();var r=n.clone();return this.destructor(e),r}function i(){return this.isSmartPointer?Ge(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ge(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,a=this.registeredClass.getActualType(t),s=Ce[a];if(!s)return i.call(this);o=this.isConst?s.constPointerType:s.pointerType;var c=Le(t,this.registeredClass,o.registeredClass);return null===c?i.call(this):this.isSmartPointer?Ge(o.registeredClass.instancePrototype,{ptrType:o,ptr:c,smartPtrType:this,smartPtr:e}):Ge(o.registeredClass.instancePrototype,{ptrType:o,ptr:c})}function He(e,t,n,r,i,o,a,s,c,u,d){this.name=e,this.registeredClass=t,this.isReference=n,this.isConst=r,this.isSmartPointer=i,this.pointeeType=o,this.sharingPolicy=a,this.rawGetPointee=s,this.rawConstructor=c,this.rawShare=u,this.rawDestructor=d,i||void 0!==t.baseClass?this.toWireType=Ae:r?(this.toWireType=Pe,this.destructorFunction=null):(this.toWireType=Oe,this.destructorFunction=null)}function We(e,t,n){return e.includes("j")?function(e,t,n){var i=r["dynCall_"+e];return n&&n.length?i.apply(null,[t].concat(n)):i.call(null,t)}(e,t,n):L.get(t).apply(null,n)}function qe(e,t){var n,r,i,o=(e=Y(e)).includes("j")?(n=e,r=t,i=[],function(){i.length=arguments.length;for(var e=0;e<arguments.length;e++)i[e]=arguments[e];return We(n,r,i)}):L.get(t);return"function"!=typeof o&&ie("unknown function pointer with signature "+e+": "+t),o}var Ke=void 0;function $e(e){var t=vt(e),n=Y(t);return ht(t),n}function Je(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||Q[t]||(Z[t]?Z[t].forEach(e):(n.push(t),r[t]=!0))})),new Ke(e+": "+n.map($e).join([", "]))}function ze(e,t){for(var n=[],r=0;r<e;r++)n.push(C[(t>>2)+r]);return n}function Ye(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function Xe(e,t,n,r,i){var o=t.length;o<2&&ie("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==n,s=!1,c=1;c<t.length;++c)if(null!==t[c]&&void 0===t[c].destructorFunction){s=!0;break}var u="void"!==t[0].name,d=o-2,p=new Array(d),l=[],h=[];return function(){var n;arguments.length!==d&&ie("function "+e+" called with "+arguments.length+" arguments, expected "+d+" args!"),h.length=0,l.length=a?2:1,l[0]=i,a&&(n=t[1].toWireType(h,this),l[1]=n);for(var o=0;o<d;++o)p[o]=t[o+2].toWireType(h,arguments[o]),l.push(p[o]);var c=r.apply(null,l);function f(e){if(s)Ye(h);else for(var r=a?1:2;r<t.length;r++){var i=1===r?n:p[r-2];null!==t[r].destructorFunction&&t[r].destructorFunction(i)}if(u)return t[0].fromWireType(e)}return f(c)}}var Qe=[],Ze=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function et(e){e>4&&0==--Ze[e].refcount&&(Ze[e]=void 0,Qe.push(e))}function tt(){for(var e=0,t=5;t<Ze.length;++t)void 0!==Ze[t]&&++e;return e}function nt(){for(var e=5;e<Ze.length;++e)if(void 0!==Ze[e])return Ze[e];return null}function rt(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Qe.length?Qe.pop():Ze.length;return Ze[t]={refcount:1,value:e},t}}function it(e,t,n){switch(t){case 0:return function(e){var t=n?y:S;return this.fromWireType(t[e])};case 1:return function(e){var t=n?E:T;return this.fromWireType(t[e>>1])};case 2:return function(e){var t=n?C:b;return this.fromWireType(t[e>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function ot(e,t){var n=Q[e];return void 0===n&&ie(t+" has unknown type "+$e(e)),n}function at(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function st(e,t){switch(t){case 2:return function(e){return this.fromWireType(R[e>>2])};case 3:return function(e){return this.fromWireType(w[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function ct(e,t,n){switch(t){case 0:return n?function(e){return y[e]}:function(e){return S[e]};case 1:return n?function(e){return E[e>>1]}:function(e){return T[e>>1]};case 2:return n?function(e){return C[e>>2]}:function(e){return b[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function ut(e){try{return h.grow(e-g.byteLength+65535>>>16),M(h.buffer),1}catch(e){}}var dt={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=dt.buffers[e];0===t||10===t?((1===e?u:d)(m(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return dt.varargs+=4,C[dt.varargs-4>>2]},getStr:function(e){return _(e)},get64:function(e,t){return e}};!function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);z=e}(),re=r.BindingError=ne(Error,"BindingError"),oe=r.InternalError=ne(Error,"InternalError"),Te.prototype.isAliasOf=ue,Te.prototype.clone=ve,Te.prototype.delete=me,Te.prototype.isDeleted=_e,Te.prototype.deleteLater=Ee,He.prototype.getPointee=De,He.prototype.destructor=Ne,He.prototype.argPackAdvance=8,He.prototype.readValueFromPointer=ke,He.prototype.deleteObject=Me,He.prototype.fromWireType=Be,r.getInheritedInstanceCount=xe,r.getLiveInheritedInstances=Ue,r.flushPendingDeletes=Se,r.setDelayFunction=je,Ke=r.UnboundTypeError=ne(Error,"UnboundTypeError"),r.count_emval_handles=tt,r.get_first_emval=nt;var pt,lt={y:function(e,t,n,r,i){},H:function(e,t,n,r,i){var o=J(n);ce(e,{name:t=Y(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:i},argPackAdvance:8,readValueFromPointer:function(e){var r;if(1===n)r=y;else if(2===n)r=E;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=C}return this.fromWireType(r[e>>o])},destructorFunction:null})},t:function(e,t,n,i,o,a,s,c,u,d,p,l,h){p=Y(p),a=qe(o,a),c&&(c=qe(s,c)),d&&(d=qe(u,d)),h=qe(l,h);var f=ee(p);Re(f,(function(){Je("Cannot construct "+p+" due to unbound types",[i])})),se([e,t,n],i?[i]:[],(function(t){var n,o;t=t[0],o=i?(n=t.registeredClass).instancePrototype:Te.prototype;var s=te(f,(function(){if(Object.getPrototypeOf(this)!==u)throw new re("Use 'new' to construct "+p);if(void 0===l.constructor_body)throw new re(p+" has no accessible constructor");var e=l.constructor_body[arguments.length];if(void 0===e)throw new re("Tried to invoke ctor of "+p+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(l.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),u=Object.create(o,{constructor:{value:s}});s.prototype=u;var l=new we(p,s,u,h,n,a,c,d),v=new He(p,l,!0,!1,!1),m=new He(p+"*",l,!1,!1,!1),_=new He(p+" const*",l,!1,!0,!1);return Ce[e]={pointerType:m,constPointerType:_},function(e,t,n){r.hasOwnProperty(e)||ae("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==n?r[e].overloadTable[n]=t:(r[e]=t,r[e].argCount=n)}(f,s),[v,m,_]}))},p:function(e,t,n,r,i,o){var a;t>0||B("Assertion failed: "+a);var s=ze(t,n);i=qe(r,i),se([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new re("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){Je("Cannot construct "+e.name+" due to unbound types",s)},se([],s,(function(r){return r.splice(1,0,null),e.registeredClass.constructor_body[t-1]=Xe(n,r,null,i,o),[]})),[]}))},e:function(e,t,n,r,i,o,a,s){var c=ze(n,r);t=Y(t),o=qe(i,o),se([],[e],(function(e){var r=(e=e[0]).name+"."+t;function i(){Je("Cannot call "+r+" due to unbound types",c)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),s&&e.registeredClass.pureVirtualFunctions.push(t);var u=e.registeredClass.instancePrototype,d=u[t];return void 0===d||void 0===d.overloadTable&&d.className!==e.name&&d.argCount===n-2?(i.argCount=n-2,i.className=e.name,u[t]=i):(be(u,t,r),u[t].overloadTable[n-2]=i),se([],c,(function(i){var s=Xe(r,i,e,o,a);return void 0===u[t].overloadTable?(s.argCount=n-2,u[t]=s):u[t].overloadTable[n-2]=s,[]})),[]}))},G:function(e,t){ce(e,{name:t=Y(t),fromWireType:function(e){var t=Ze[e].value;return et(e),t},toWireType:function(e,t){return rt(t)},argPackAdvance:8,readValueFromPointer:ke,destructorFunction:null})},L:function(e,t,n,r){var i=J(n);function o(){}t=Y(t),o.values={},ce(e,{name:t,constructor:o,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:it(t,i,r),destructorFunction:null}),Re(t,o)},x:function(e,t,n){var r=ot(e,"enum");t=Y(t);var i=r.constructor,o=Object.create(r.constructor.prototype,{value:{value:n},constructor:{value:te(r.name+"_"+t,(function(){}))}});i.values[n]=o,i[t]=o},r:function(e,t,n){var r=J(n);ce(e,{name:t=Y(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+at(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:st(t,r),destructorFunction:null})},h:function(e,t,n,r,i){t=Y(t),-1===i&&(i=4294967295);var o=J(n),a=function(e){return e};if(0===r){var s=32-8*n;a=function(e){return e<<s>>>s}}var c=t.includes("unsigned");ce(e,{name:t,fromWireType:a,toWireType:function(e,n){if("number"!=typeof n&&"boolean"!=typeof n)throw new TypeError('Cannot convert "'+at(n)+'" to '+this.name);if(n<r||n>i)throw new TypeError('Passing a number "'+at(n)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+r+", "+i+"]!");return c?n>>>0:0|n},argPackAdvance:8,readValueFromPointer:ct(t,o,0!==r),destructorFunction:null})},g:function(e,t,n){var r=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=b,n=t[e>>=2],i=t[e+1];return new r(g,i,n)}ce(e,{name:n=Y(n),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},s:function(e,t){var n="std::string"===(t=Y(t));ce(e,{name:t,fromWireType:function(e){var t,r=b[e>>2];if(n)for(var i=e+4,o=0;o<=r;++o){var a=e+4+o;if(o==r||0==S[a]){var s=_(i,a-i);void 0===t?t=s:(t+=String.fromCharCode(0),t+=s),i=a+1}}else{var c=new Array(r);for(o=0;o<r;++o)c[o]=String.fromCharCode(S[e+4+o]);t=c.join("")}return ht(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ie("Cannot pass non-string to std::string");var i=(n&&r?function(){return function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}(t)}:function(){return t.length})(),o=ft(4+i+1);if(b[o>>2]=i,n&&r)(function(e,t,n,r){if(!(r>0))return 0;for(var i=n,o=n+r-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(n>=o)break;t[n++]=s}else if(s<=2047){if(n+1>=o)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=o)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(t,S,o+4,i+1);else if(r)for(var a=0;a<i;++a){var s=t.charCodeAt(a);s>255&&(ht(o),ie("String has UTF-16 code units that do not fit in 8 bits")),S[o+4+a]=s}else for(a=0;a<i;++a)S[o+4+a]=t[a];return null!==e&&e.push(ht,o),o},argPackAdvance:8,readValueFromPointer:ke,destructorFunction:function(e){ht(e)}})},m:function(e,t,n){var r,i,o,a,s;n=Y(n),2===t?(r=P,i=A,a=O,o=function(){return T},s=1):4===t&&(r=k,i=D,a=N,o=function(){return b},s=2),ce(e,{name:n,fromWireType:function(e){for(var n,i=b[e>>2],a=o(),c=e+4,u=0;u<=i;++u){var d=e+4+u*t;if(u==i||0==a[d>>s]){var p=r(c,d-c);void 0===n?n=p:(n+=String.fromCharCode(0),n+=p),c=d+t}}return ht(e),n},toWireType:function(e,r){"string"!=typeof r&&ie("Cannot pass non-string to C++ string type "+n);var o=a(r),c=ft(4+o+t);return b[c>>2]=o>>s,i(r,c+4,o+t),null!==e&&e.push(ht,c),c},argPackAdvance:8,readValueFromPointer:ke,destructorFunction:function(e){ht(e)}})},I:function(e,t){ce(e,{isVoid:!0,name:t=Y(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},F:function(){throw"longjmp"},k:et,l:function(e){e>4&&(Ze[e].refcount+=1)},j:function(e,t){return rt((e=ot(e,"_emval_take_value")).readValueFromPointer(t))},E:function(){B()},C:function(e,t,n){S.copyWithin(e,t,t+n)},D:function(e){var t,n,r=S.length,i=2147483648;if((e>>>=0)>i)return!1;for(var o=1;o<=4;o*=2){var a=r*(1+.2/o);if(a=Math.min(a,e+100663296),ut(Math.min(i,((t=Math.max(e,a))%(n=65536)>0&&(t+=n-t%n),t))))return!0}return!1},q:function(e,t,n,r){for(var i=0,o=0;o<n;o++){for(var a=C[t+8*o>>2],s=C[t+(8*o+4)>>2],c=0;c<s;c++)dt.printChar(e,S[a+c]);i+=s}return C[r>>2]=i,0},a:function(){return l},f:function(e){var t=Date.now();return C[e>>2]=t/1e3|0,C[e+4>>2]=t%1e3*1e3|0,0},d:function(e,t,n){var r=mt();try{return L.get(e)(t,n)}catch(e){if(_t(r),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},n:function(e,t,n,r){var i=mt();try{return L.get(e)(t,n,r)}catch(e){if(_t(i),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},o:function(e,t,n,r,i){var o=mt();try{return L.get(e)(t,n,r,i)}catch(e){if(_t(o),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},u:function(e,t,n,r,i,o){var a=mt();try{return L.get(e)(t,n,r,i,o)}catch(e){if(_t(a),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},K:function(e,t,n,r,i,o,a,s,c){var u=mt();try{return L.get(e)(t,n,r,i,o,a,s,c)}catch(e){if(_t(u),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},B:function(e,t,n,r,i,o,a,s){var c=mt();try{return yt(e,t,n,r,i,o,a,s)}catch(e){if(_t(c),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},z:function(e,t,n,r){var i=mt();try{return Et(e,t,n,r)}catch(e){if(_t(i),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},i:function(e,t){var n=mt();try{L.get(e)(t)}catch(e){if(_t(n),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},w:function(e,t,n){var r=mt();try{L.get(e)(t,n)}catch(e){if(_t(r),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},c:function(e,t,n,r,i){var o=mt();try{L.get(e)(t,n,r,i)}catch(e){if(_t(o),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},J:function(e,t,n,r,i,o,a){var s=mt();try{L.get(e)(t,n,r,i,o,a)}catch(e){if(_t(s),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},v:function(e,t,n,r,i,o,a,s,c){var u=mt();try{L.get(e)(t,n,r,i,o,a,s,c)}catch(e){if(_t(u),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},A:function(e,t,n,r,i,o,a,s,c,u){var d=mt();try{St(e,t,n,r,i,o,a,s,c,u)}catch(e){if(_t(d),e!==e+0&&"longjmp"!==e)throw e;gt(1,0)}},b:function(e){l=e}},ht=(function(){var e={a:lt};function t(e,t){var n,i=e.exports;r.asm=i,M((h=r.asm.M).buffer),L=r.asm.Q,n=r.asm.N,U.unshift(n),function(e){if(V--,r.monitorRunDependencies&&r.monitorRunDependencies(V),0==V&&(null!==F&&(clearInterval(F),F=null),G)){var t=G;G=null,t()}}()}function i(e){t(e.instance)}function o(t){return(p||"function"!=typeof fetch?Promise.resolve().then((function(){return K(H)})):fetch(H,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+H+"'";return e.arrayBuffer()})).catch((function(){return K(H)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){d("failed to asynchronously prepare wasm: "+e),B(e)}))}if(V++,r.monitorRunDependencies&&r.monitorRunDependencies(V),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return d("Module.instantiateWasm callback failed with error: "+e),!1}(p||"function"!=typeof WebAssembly.instantiateStreaming||q(H)||"function"!=typeof fetch?o(i):fetch(H,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return d("wasm streaming compile failed: "+e),d("falling back to ArrayBuffer instantiation"),o(i)}))}))).catch(n)}(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.N).apply(null,arguments)},r._free=function(){return(ht=r._free=r.asm.O).apply(null,arguments)}),ft=r._malloc=function(){return(ft=r._malloc=r.asm.P).apply(null,arguments)},vt=r.___getTypeName=function(){return(vt=r.___getTypeName=r.asm.R).apply(null,arguments)},mt=(r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.S).apply(null,arguments)},r.stackSave=function(){return(mt=r.stackSave=r.asm.T).apply(null,arguments)}),_t=r.stackRestore=function(){return(_t=r.stackRestore=r.asm.U).apply(null,arguments)},gt=r._setThrew=function(){return(gt=r._setThrew=r.asm.V).apply(null,arguments)},yt=r.dynCall_iiiijj=function(){return(yt=r.dynCall_iiiijj=r.asm.W).apply(null,arguments)},St=(r.dynCall_iiijiii=function(){return(r.dynCall_iiijiii=r.asm.X).apply(null,arguments)},r.dynCall_vijjjid=function(){return(St=r.dynCall_vijjjid=r.asm.Y).apply(null,arguments)}),Et=r.dynCall_iij=function(){return(Et=r.dynCall_iij=r.asm.Z).apply(null,arguments)};r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm._).apply(null,arguments)};function Tt(e){function n(){pt||(pt=!0,r.calledRun=!0,f||(!0,$(U),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),j.unshift(e);var e;$(j)}()))}e=e||s,V>0||(!function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),x.unshift(e);var e;$(x)}(),V>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),n()}),1)):n()))}if(G=function e(){pt||Tt(),pt||(G=e)},r.run=Tt,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return Tt(),e.ready}}();e.exports=t,t.getUrl=function(e){return"https://st.mycdn.me/static/libvpx/2-0-9/"+e}},489588:(e,t,n)=>{"use strict";t.isIPadOS=t.isIPad=void 0;var r=n(279405);function i(e){e||(e=r.canUseDOM?navigator.userAgent.toLowerCase():"");var t=v(e),n=t||-1!==e.indexOf("ipad"),i=!n&&-1!==e.search(/iphone|ipod/),o=i||n,a=o&&e.match(/OS ([\d_]+) like Mac OS X/i),s=0,c=0;t?(s=13,c=0):a&&(s=+(a=a[1].split("_"))[0],c=+a[1]),a=null;var u=s<13&&!(11===s&&c<3),d=o&&function(e){if(!r.canUseDOM)return!1;var t=window.webkit;if(t&&t.messageHandlers)return!0;var n=/constructor/i.test(String(window.HTMLElement)),i=!!window.indexedDB;if(-1===e.indexOf("safari")||-1===e.indexOf("version")||navigator.standalone){if(!i&&n||!window.statusbar||!window.statusbar.visible);else if(!n||i)return!0}else;return!1}(e),p=!1;return r.canUseDOM&&(p=o&&375===screen.width&&812===screen.height&&3===window.devicePixelRatio),{isIPad:n,isIPhone:i,isIOS:o,isIPadOS:t,iosMajor:s,iosMinor:c,isWKWebView:d,isScrollBasedViewport:u,isIPhoneX:p,isIOSChrome:-1!==e.search(/crios/i)}}var o=i(),a=o.isIPad,s=o.isIPhone,c=o.isIOS,u=o.isIPadOS,d=o.iosMajor,p=o.iosMinor,l=o.isWKWebView,h=o.isScrollBasedViewport,f=o.isIPhoneX;function v(e){if(!r.canUseDOM)return!1;var t=!/ipad|iphone|ipod/.test(e);return!(!/mac os/.test(e)||!t||"boolean"!=typeof navigator.standalone)}o.isIOSChrome,t.isIPadOS=u,t.isIPad=a},279405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onDOMLoaded=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)},t.canUseEventListeners=t.canUseDOM=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t.canUseDOM=n;var r=n&&!!window.addEventListener;t.canUseEventListeners=r},224736:(e,t,n)=>{var r;e=n.nmd(e);var i=function(e){"use strict";var t=1e7,n=9007199254740992,r=l(n),o="0123456789abcdefghijklmnopqrstuvwxyz",a="function"==typeof BigInt;function s(e,t,n,r){return void 0===e?s[0]:void 0!==t&&(10!=+t||n)?W(e,t,n,r):z(e)}function c(e,t){this.value=e,this.sign=t,this.isSmall=!1}function u(e){this.value=e,this.sign=e<0,this.isSmall=!0}function d(e){this.value=e}function p(e){return-n<e&&e<n}function l(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function h(e){f(e);var n=e.length;if(n<4&&O(e,r)<0)switch(n){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*t;default:return e[0]+(e[1]+e[2]*t)*t}return e}function f(e){for(var t=e.length;0===e[--t];);e.length=t+1}function v(e){for(var t=new Array(e),n=-1;++n<e;)t[n]=0;return t}function m(e){return e>0?Math.floor(e):Math.ceil(e)}function _(e,n){var r,i,o=e.length,a=n.length,s=new Array(o),c=0,u=t;for(i=0;i<a;i++)c=(r=e[i]+n[i]+c)>=u?1:0,s[i]=r-c*u;for(;i<o;)c=(r=e[i]+c)===u?1:0,s[i++]=r-c*u;return c>0&&s.push(c),s}function g(e,t){return e.length>=t.length?_(e,t):_(t,e)}function y(e,n){var r,i,o=e.length,a=new Array(o),s=t;for(i=0;i<o;i++)r=e[i]-s+n,n=Math.floor(r/s),a[i]=r-n*s,n+=1;for(;n>0;)a[i++]=n%s,n=Math.floor(n/s);return a}function S(e,n){var r,i,o=e.length,a=n.length,s=new Array(o),c=0,u=t;for(r=0;r<a;r++)(i=e[r]-c-n[r])<0?(i+=u,c=1):c=0,s[r]=i;for(r=a;r<o;r++){if(!((i=e[r]-c)<0)){s[r++]=i;break}i+=u,s[r]=i}for(;r<o;r++)s[r]=e[r];return f(s),s}function E(e,n,r){var i,o,a=e.length,s=new Array(a),d=-n,p=t;for(i=0;i<a;i++)o=e[i]+d,d=Math.floor(o/p),o%=p,s[i]=o<0?o+p:o;return"number"==typeof(s=h(s))?(r&&(s=-s),new u(s)):new c(s,r)}function T(e,n){var r,i,o,a,s=e.length,c=n.length,u=v(s+c),d=t;for(o=0;o<s;++o){a=e[o];for(var p=0;p<c;++p)r=a*n[p]+u[o+p],i=Math.floor(r/d),u[o+p]=r-i*d,u[o+p+1]+=i}return f(u),u}function C(e,n){var r,i,o=e.length,a=new Array(o),s=t,c=0;for(i=0;i<o;i++)r=e[i]*n+c,c=Math.floor(r/s),a[i]=r-c*s;for(;c>0;)a[i++]=c%s,c=Math.floor(c/s);return a}function b(e,t){for(var n=[];t-- >0;)n.push(0);return n.concat(e)}function R(e,t){var n=Math.max(e.length,t.length);if(n<=30)return T(e,t);n=Math.ceil(n/2);var r=e.slice(n),i=e.slice(0,n),o=t.slice(n),a=t.slice(0,n),s=R(i,a),c=R(r,o),u=R(g(i,r),g(a,o)),d=g(g(s,b(S(S(u,s),c),n)),b(c,2*n));return f(d),d}function w(e,n,r){return new c(e<t?C(n,e):T(n,l(e)),r)}function I(e){var n,r,i,o,a=e.length,s=v(a+a),c=t;for(i=0;i<a;i++){r=0-(o=e[i])*o;for(var u=i;u<a;u++)n=o*e[u]*2+s[i+u]+r,r=Math.floor(n/c),s[i+u]=n-r*c;s[i+a]=r}return f(s),s}function P(e,t){var n,r,i,o,a=e.length,s=v(a);for(i=0,n=a-1;n>=0;--n)i=(o=1e7*i+e[n])-(r=m(o/t))*t,s[n]=0|r;return[s,0|i]}function A(e,n){var r,i=z(n);if(a)return[new d(e.value/i.value),new d(e.value%i.value)];var o,p=e.value,_=i.value;if(0===_)throw new Error("Cannot divide by zero");if(e.isSmall)return i.isSmall?[new u(m(p/_)),new u(p%_)]:[s[0],e];if(i.isSmall){if(1===_)return[e,s[0]];if(-1==_)return[e.negate(),s[0]];var g=Math.abs(_);if(g<t){o=h((r=P(p,g))[0]);var y=r[1];return e.sign&&(y=-y),"number"==typeof o?(e.sign!==i.sign&&(o=-o),[new u(o),new u(y)]):[new c(o,e.sign!==i.sign),new u(y)]}_=l(g)}var E=O(p,_);if(-1===E)return[s[0],e];if(0===E)return[s[e.sign===i.sign?1:-1],s[0]];o=(r=p.length+_.length<=200?function(e,n){var r,i,o,a,s,c,u,d=e.length,p=n.length,l=t,f=v(n.length),m=n[p-1],_=Math.ceil(l/(2*m)),g=C(e,_),y=C(n,_);for(g.length<=d&&g.push(0),y.push(0),m=y[p-1],i=d-p;i>=0;i--){for(r=l-1,g[i+p]!==m&&(r=Math.floor((g[i+p]*l+g[i+p-1])/m)),o=0,a=0,c=y.length,s=0;s<c;s++)o+=r*y[s],u=Math.floor(o/l),a+=g[i+s]-(o-u*l),o=u,a<0?(g[i+s]=a+l,a=-1):(g[i+s]=a,a=0);for(;0!==a;){for(r-=1,o=0,s=0;s<c;s++)(o+=g[i+s]-l+y[s])<0?(g[i+s]=o+l,o=0):(g[i+s]=o,o=1);a+=o}f[i]=r}return g=P(g,_)[0],[h(f),h(g)]}(p,_):function(e,n){for(var r,i,o,a,s,c=e.length,u=n.length,d=[],p=[],l=t;c;)if(p.unshift(e[--c]),f(p),O(p,n)<0)d.push(0);else{o=p[(i=p.length)-1]*l+p[i-2],a=n[u-1]*l+n[u-2],i>u&&(o=(o+1)*l),r=Math.ceil(o/a);do{if(O(s=C(n,r),p)<=0)break;r--}while(r);d.push(r),p=S(p,s)}return d.reverse(),[h(d),h(p)]}(p,_))[0];var T=e.sign!==i.sign,b=r[1],R=e.sign;return"number"==typeof o?(T&&(o=-o),o=new u(o)):o=new c(o,T),"number"==typeof b?(R&&(b=-b),b=new u(b)):b=new c(b,R),[o,b]}function O(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return e[n]>t[n]?1:-1;return 0}function k(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function D(e,t){for(var n,r,o,a=e.prev(),s=a,c=0;s.isEven();)s=s.divide(2),c++;e:for(r=0;r<t.length;r++)if(!e.lesser(t[r])&&!(o=i(t[r]).modPow(s,e)).isUnit()&&!o.equals(a)){for(n=c-1;0!=n;n--){if((o=o.square().mod(e)).isUnit())return!1;if(o.equals(a))continue e}return!1}return!0}c.prototype=Object.create(s.prototype),u.prototype=Object.create(s.prototype),d.prototype=Object.create(s.prototype),c.prototype.add=function(e){var t=z(e);if(this.sign!==t.sign)return this.subtract(t.negate());var n=this.value,r=t.value;return t.isSmall?new c(y(n,Math.abs(r)),this.sign):new c(g(n,r),this.sign)},c.prototype.plus=c.prototype.add,u.prototype.add=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.subtract(t.negate());var r=t.value;if(t.isSmall){if(p(n+r))return new u(n+r);r=l(Math.abs(r))}return new c(y(r,Math.abs(n)),n<0)},u.prototype.plus=u.prototype.add,d.prototype.add=function(e){return new d(this.value+z(e).value)},d.prototype.plus=d.prototype.add,c.prototype.subtract=function(e){var t=z(e);if(this.sign!==t.sign)return this.add(t.negate());var n=this.value,r=t.value;return t.isSmall?E(n,Math.abs(r),this.sign):function(e,t,n){var r;return O(e,t)>=0?r=S(e,t):(r=S(t,e),n=!n),"number"==typeof(r=h(r))?(n&&(r=-r),new u(r)):new c(r,n)}(n,r,this.sign)},c.prototype.minus=c.prototype.subtract,u.prototype.subtract=function(e){var t=z(e),n=this.value;if(n<0!==t.sign)return this.add(t.negate());var r=t.value;return t.isSmall?new u(n-r):E(r,Math.abs(n),n>=0)},u.prototype.minus=u.prototype.subtract,d.prototype.subtract=function(e){return new d(this.value-z(e).value)},d.prototype.minus=d.prototype.subtract,c.prototype.negate=function(){return new c(this.value,!this.sign)},u.prototype.negate=function(){var e=this.sign,t=new u(-this.value);return t.sign=!e,t},d.prototype.negate=function(){return new d(-this.value)},c.prototype.abs=function(){return new c(this.value,!1)},u.prototype.abs=function(){return new u(Math.abs(this.value))},d.prototype.abs=function(){return new d(this.value>=0?this.value:-this.value)},c.prototype.multiply=function(e){var n,r,i,o=z(e),a=this.value,u=o.value,d=this.sign!==o.sign;if(o.isSmall){if(0===u)return s[0];if(1===u)return this;if(-1===u)return this.negate();if((n=Math.abs(u))<t)return new c(C(a,n),d);u=l(n)}return r=a.length,i=u.length,new c(-.012*r-.012*i+15e-6*r*i>0?R(a,u):T(a,u),d)},c.prototype.times=c.prototype.multiply,u.prototype._multiplyBySmall=function(e){return p(e.value*this.value)?new u(e.value*this.value):w(Math.abs(e.value),l(Math.abs(this.value)),this.sign!==e.sign)},c.prototype._multiplyBySmall=function(e){return 0===e.value?s[0]:1===e.value?this:-1===e.value?this.negate():w(Math.abs(e.value),this.value,this.sign!==e.sign)},u.prototype.multiply=function(e){return z(e)._multiplyBySmall(this)},u.prototype.times=u.prototype.multiply,d.prototype.multiply=function(e){return new d(this.value*z(e).value)},d.prototype.times=d.prototype.multiply,c.prototype.square=function(){return new c(I(this.value),!1)},u.prototype.square=function(){var e=this.value*this.value;return p(e)?new u(e):new c(I(l(Math.abs(this.value))),!1)},d.prototype.square=function(e){return new d(this.value*this.value)},c.prototype.divmod=function(e){var t=A(this,e);return{quotient:t[0],remainder:t[1]}},d.prototype.divmod=u.prototype.divmod=c.prototype.divmod,c.prototype.divide=function(e){return A(this,e)[0]},d.prototype.over=d.prototype.divide=function(e){return new d(this.value/z(e).value)},u.prototype.over=u.prototype.divide=c.prototype.over=c.prototype.divide,c.prototype.mod=function(e){return A(this,e)[1]},d.prototype.mod=d.prototype.remainder=function(e){return new d(this.value%z(e).value)},u.prototype.remainder=u.prototype.mod=c.prototype.remainder=c.prototype.mod,c.prototype.pow=function(e){var t,n,r,i=z(e),o=this.value,a=i.value;if(0===a)return s[1];if(0===o)return s[0];if(1===o)return s[1];if(-1===o)return i.isEven()?s[1]:s[-1];if(i.sign)return s[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&p(t=Math.pow(o,a)))return new u(m(t));for(n=this,r=s[1];!0&a&&(r=r.times(n),--a),0!==a;)a/=2,n=n.square();return r},u.prototype.pow=c.prototype.pow,d.prototype.pow=function(e){var t=z(e),n=this.value,r=t.value,i=BigInt(0),o=BigInt(1),a=BigInt(2);if(r===i)return s[1];if(n===i)return s[0];if(n===o)return s[1];if(n===BigInt(-1))return t.isEven()?s[1]:s[-1];if(t.isNegative())return new d(i);for(var c=this,u=s[1];(r&o)===o&&(u=u.times(c),--r),r!==i;)r/=a,c=c.square();return u},c.prototype.modPow=function(e,t){if(e=z(e),(t=z(t)).isZero())throw new Error("Cannot take modPow with modulus 0");var n=s[1],r=this.mod(t);for(e.isNegative()&&(e=e.multiply(s[-1]),r=r.modInv(t));e.isPositive();){if(r.isZero())return s[0];e.isOdd()&&(n=n.multiply(r).mod(t)),e=e.divide(2),r=r.square().mod(t)}return n},d.prototype.modPow=u.prototype.modPow=c.prototype.modPow,c.prototype.compareAbs=function(e){var t=z(e),n=this.value,r=t.value;return t.isSmall?1:O(n,r)},u.prototype.compareAbs=function(e){var t=z(e),n=Math.abs(this.value),r=t.value;return t.isSmall?n===(r=Math.abs(r))?0:n>r?1:-1:-1},d.prototype.compareAbs=function(e){var t=this.value,n=z(e).value;return(t=t>=0?t:-t)===(n=n>=0?n:-n)?0:t>n?1:-1},c.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:O(n,r)*(this.sign?-1:1)},c.prototype.compareTo=c.prototype.compare,u.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=z(e),n=this.value,r=t.value;return t.isSmall?n==r?0:n>r?1:-1:n<0!==t.sign?n<0?-1:1:n<0?1:-1},u.prototype.compareTo=u.prototype.compare,d.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=this.value,n=z(e).value;return t===n?0:t>n?1:-1},d.prototype.compareTo=d.prototype.compare,c.prototype.equals=function(e){return 0===this.compare(e)},d.prototype.eq=d.prototype.equals=u.prototype.eq=u.prototype.equals=c.prototype.eq=c.prototype.equals,c.prototype.notEquals=function(e){return 0!==this.compare(e)},d.prototype.neq=d.prototype.notEquals=u.prototype.neq=u.prototype.notEquals=c.prototype.neq=c.prototype.notEquals,c.prototype.greater=function(e){return this.compare(e)>0},d.prototype.gt=d.prototype.greater=u.prototype.gt=u.prototype.greater=c.prototype.gt=c.prototype.greater,c.prototype.lesser=function(e){return this.compare(e)<0},d.prototype.lt=d.prototype.lesser=u.prototype.lt=u.prototype.lesser=c.prototype.lt=c.prototype.lesser,c.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},d.prototype.geq=d.prototype.greaterOrEquals=u.prototype.geq=u.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals,c.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},d.prototype.leq=d.prototype.lesserOrEquals=u.prototype.leq=u.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals,c.prototype.isEven=function(){return 0==(1&this.value[0])},u.prototype.isEven=function(){return 0==(1&this.value)},d.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},c.prototype.isOdd=function(){return 1==(1&this.value[0])},u.prototype.isOdd=function(){return 1==(1&this.value)},d.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},c.prototype.isPositive=function(){return!this.sign},u.prototype.isPositive=function(){return this.value>0},d.prototype.isPositive=u.prototype.isPositive,c.prototype.isNegative=function(){return this.sign},u.prototype.isNegative=function(){return this.value<0},d.prototype.isNegative=u.prototype.isNegative,c.prototype.isUnit=function(){return!1},u.prototype.isUnit=function(){return 1===Math.abs(this.value)},d.prototype.isUnit=function(){return this.abs().value===BigInt(1)},c.prototype.isZero=function(){return!1},u.prototype.isZero=function(){return 0===this.value},d.prototype.isZero=function(){return this.value===BigInt(0)},c.prototype.isDivisibleBy=function(e){var t=z(e);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},d.prototype.isDivisibleBy=u.prototype.isDivisibleBy=c.prototype.isDivisibleBy,c.prototype.isPrime=function(t){var n=k(this);if(n!==e)return n;var r=this.abs(),o=r.bitLength();if(o<=64)return D(r,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var a=Math.log(2)*o.toJSNumber(),s=Math.ceil(!0===t?2*Math.pow(a,2):a),c=[],u=0;u<s;u++)c.push(i(u+2));return D(r,c)},d.prototype.isPrime=u.prototype.isPrime=c.prototype.isPrime,c.prototype.isProbablePrime=function(t,n){var r=k(this);if(r!==e)return r;for(var o=this.abs(),a=t===e?5:t,s=[],c=0;c<a;c++)s.push(i.randBetween(2,o.minus(2),n));return D(o,s)},d.prototype.isProbablePrime=u.prototype.isProbablePrime=c.prototype.isProbablePrime,c.prototype.modInv=function(e){for(var t,n,r,o=i.zero,a=i.one,s=z(e),c=this.abs();!c.isZero();)t=s.divide(c),n=o,r=s,o=a,s=c,a=n.subtract(t.multiply(a)),c=r.subtract(t.multiply(c));if(!s.isUnit())throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===o.compare(0)&&(o=o.add(e)),this.isNegative()?o.negate():o},d.prototype.modInv=u.prototype.modInv=c.prototype.modInv,c.prototype.next=function(){var e=this.value;return this.sign?E(e,1,this.sign):new c(y(e,1),this.sign)},u.prototype.next=function(){var e=this.value;return e+1<n?new u(e+1):new c(r,!1)},d.prototype.next=function(){return new d(this.value+BigInt(1))},c.prototype.prev=function(){var e=this.value;return this.sign?new c(y(e,1),!0):E(e,1,this.sign)},u.prototype.prev=function(){var e=this.value;return e-1>-n?new u(e-1):new c(r,!0)},d.prototype.prev=function(){return new d(this.value-BigInt(1))};for(var N=[1];2*N[N.length-1]<=t;)N.push(2*N[N.length-1]);var M=N.length,L=N[M-1];function x(e){return Math.abs(e)<=t}function U(e,t,n){t=z(t);for(var r=e.isNegative(),o=t.isNegative(),a=r?e.not():e,s=o?t.not():t,c=0,u=0,d=null,p=null,l=[];!a.isZero()||!s.isZero();)c=(d=A(a,L))[1].toJSNumber(),r&&(c=L-1-c),u=(p=A(s,L))[1].toJSNumber(),o&&(u=L-1-u),a=d[0],s=p[0],l.push(n(c,u));for(var h=0!==n(r?1:0,o?1:0)?i(-1):i(0),f=l.length-1;f>=0;f-=1)h=h.multiply(L).add(i(l[f]));return h}c.prototype.shiftLeft=function(e){var t=z(e).toJSNumber();if(!x(t))throw new Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var n=this;if(n.isZero())return n;for(;t>=M;)n=n.multiply(L),t-=M-1;return n.multiply(N[t])},d.prototype.shiftLeft=u.prototype.shiftLeft=c.prototype.shiftLeft,c.prototype.shiftRight=function(e){var t,n=z(e).toJSNumber();if(!x(n))throw new Error(String(n)+" is too large for shifting.");if(n<0)return this.shiftLeft(-n);for(var r=this;n>=M;){if(r.isZero()||r.isNegative()&&r.isUnit())return r;r=(t=A(r,L))[1].isNegative()?t[0].prev():t[0],n-=M-1}return(t=A(r,N[n]))[1].isNegative()?t[0].prev():t[0]},d.prototype.shiftRight=u.prototype.shiftRight=c.prototype.shiftRight,c.prototype.not=function(){return this.negate().prev()},d.prototype.not=u.prototype.not=c.prototype.not,c.prototype.and=function(e){return U(this,e,(function(e,t){return e&t}))},d.prototype.and=u.prototype.and=c.prototype.and,c.prototype.or=function(e){return U(this,e,(function(e,t){return e|t}))},d.prototype.or=u.prototype.or=c.prototype.or,c.prototype.xor=function(e){return U(this,e,(function(e,t){return e^t}))},d.prototype.xor=u.prototype.xor=c.prototype.xor;var j=1<<30;function V(e){var n=e.value,r="number"==typeof n?n|j:"bigint"==typeof n?n|BigInt(j):n[0]+n[1]*t|1073758208;return r&-r}function F(e,t){if(t.compareTo(e)<=0){var n=F(e,t.square(t)),r=n.p,o=n.e,a=r.multiply(t);return a.compareTo(e)<=0?{p:a,e:2*o+1}:{p:r,e:2*o}}return{p:i(1),e:0}}function G(e,t){return e=z(e),t=z(t),e.greater(t)?e:t}function B(e,t){return e=z(e),t=z(t),e.lesser(t)?e:t}function H(e,t){if(e=z(e).abs(),t=z(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var n,r,i=s[1];e.isEven()&&t.isEven();)n=B(V(e),V(t)),e=e.divide(n),t=t.divide(n),i=i.multiply(n);for(;e.isEven();)e=e.divide(V(e));do{for(;t.isEven();)t=t.divide(V(t));e.greater(t)&&(r=t,t=e,e=r),t=t.subtract(e)}while(!t.isZero());return i.isUnit()?e:e.multiply(i)}c.prototype.bitLength=function(){var e=this;return e.compareTo(i(0))<0&&(e=e.negate().subtract(i(1))),0===e.compareTo(i(0))?i(0):i(F(e,i(2)).e).add(i(1))},d.prototype.bitLength=u.prototype.bitLength=c.prototype.bitLength;var W=function(e,t,n,r){n=n||o,e=String(e),r||(e=e.toLowerCase(),n=n.toLowerCase());var i,a=e.length,s=Math.abs(t),c={};for(i=0;i<n.length;i++)c[n[i]]=i;for(i=0;i<a;i++){if("-"!==(p=e[i])&&(p in c&&c[p]>=s)){if("1"===p&&1===s)continue;throw new Error(p+" is not a valid digit in base "+t+".")}}t=z(t);var u=[],d="-"===e[0];for(i=d?1:0;i<e.length;i++){var p;if((p=e[i])in c)u.push(z(c[p]));else{if("<"!==p)throw new Error(p+" is not a valid character");var l=i;do{i++}while(">"!==e[i]&&i<e.length);u.push(z(e.slice(l+1,i)))}}return q(u,t,d)};function q(e,t,n){var r,i=s[0],o=s[1];for(r=e.length-1;r>=0;r--)i=i.add(e[r].times(o)),o=o.times(t);return n?i.negate():i}function K(e,t){if((t=i(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var n=Array.apply(null,Array(e.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return n.unshift([1]),{value:[].concat.apply([],n),isNegative:!1}}var r=!1;if(e.isNegative()&&t.isPositive()&&(r=!0,e=e.abs()),t.isUnit())return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(e.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:r};for(var o,a=[],s=e;s.isNegative()||s.compareAbs(t)>=0;){o=s.divmod(t),s=o.quotient;var c=o.remainder;c.isNegative()&&(c=t.minus(c).abs(),s=s.next()),a.push(c.toJSNumber())}return a.push(s.toJSNumber()),{value:a.reverse(),isNegative:r}}function $(e,t,n){var r=K(e,t);return(r.isNegative?"-":"")+r.value.map((function(e){return function(e,t){return e<(t=t||o).length?t[e]:"<"+e+">"}(e,n)})).join("")}function J(e){if(p(+e)){var t=+e;if(t===m(t))return a?new d(BigInt(t)):new u(t);throw new Error("Invalid integer: "+e)}var n="-"===e[0];n&&(e=e.slice(1));var r=e.split(/e/i);if(r.length>2)throw new Error("Invalid integer: "+r.join("e"));if(2===r.length){var i=r[1];if("+"===i[0]&&(i=i.slice(1)),(i=+i)!==m(i)||!p(i))throw new Error("Invalid integer: "+i+" is not a valid exponent.");var o=r[0],s=o.indexOf(".");if(s>=0&&(i-=o.length-s-1,o=o.slice(0,s)+o.slice(s+1)),i<0)throw new Error("Cannot include negative exponent part for integers");e=o+=new Array(i+1).join("0")}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);if(a)return new d(BigInt(n?"-"+e:e));for(var l=[],h=e.length,v=h-7;h>0;)l.push(+e.slice(v,h)),(v-=7)<0&&(v=0),h-=7;return f(l),new c(l,n)}function z(e){return"number"==typeof e?function(e){if(a)return new d(BigInt(e));if(p(e)){if(e!==m(e))throw new Error(e+" is not an integer.");return new u(e)}return J(e.toString())}(e):"string"==typeof e?J(e):"bigint"==typeof e?new d(e):e}c.prototype.toArray=function(e){return K(this,e)},u.prototype.toArray=function(e){return K(this,e)},d.prototype.toArray=function(e){return K(this,e)},c.prototype.toString=function(t,n){if(t===e&&(t=10),10!==t)return $(this,t,n);for(var r,i=this.value,o=i.length,a=String(i[--o]);--o>=0;)r=String(i[o]),a+="0000000".slice(r.length)+r;return(this.sign?"-":"")+a},u.prototype.toString=function(t,n){return t===e&&(t=10),10!=t?$(this,t,n):String(this.value)},d.prototype.toString=u.prototype.toString,d.prototype.toJSON=c.prototype.toJSON=u.prototype.toJSON=function(){return this.toString()},c.prototype.valueOf=function(){return parseInt(this.toString(),10)},c.prototype.toJSNumber=c.prototype.valueOf,u.prototype.valueOf=function(){return this.value},u.prototype.toJSNumber=u.prototype.valueOf,d.prototype.valueOf=d.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var Y=0;Y<1e3;Y++)s[Y]=z(Y),Y>0&&(s[-Y]=z(-Y));return s.one=s[1],s.zero=s[0],s.minusOne=s[-1],s.max=G,s.min=B,s.gcd=H,s.lcm=function(e,t){return e=z(e).abs(),t=z(t).abs(),e.divide(H(e,t)).multiply(t)},s.isInstance=function(e){return e instanceof c||e instanceof u||e instanceof d},s.randBetween=function(e,n,r){e=z(e),n=z(n);var i=r||Math.random,o=B(e,n),a=G(e,n).subtract(o).add(1);if(a.isSmall)return o.add(Math.floor(i()*a));for(var c=K(a,t).value,u=[],d=!0,p=0;p<c.length;p++){var l=d?c[p]:t,h=m(i()*l);u.push(h),h<l&&(d=!1)}return o.add(s.fromArray(u,t,!1))},s.fromArray=function(e,t,n){return q(e.map(z),z(t||10),n)},s}();e.hasOwnProperty("exports")&&(e.exports=i),void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)},535557:(e,t,n)=>{"use strict";function r(e,t){throw new TypeError(`unexpected tag 0x${e.toString(16)} (${t} expected)`)}function i(e){return 127&e}function o(e){return 0==(128&e)}function a(e){return 224==(224&e)}function s(e){return 160==(224&e)}function c(e){return 144==(240&e)}function u(e){return 128==(240&e)}function d(e,t,n){const r=t.byteLength;if(r<=255)e.putUi8(n),e.putUi8(r);else if(r<=65535)e.putUi8(n+1),e.putUi16(r);else{if(!(r<=4294967295))throw new RangeError("length limit exceeded");e.putUi8(n+2),e.putUi32(r)}e.put(t)}function p(e){const t=e.getUi8();let n;switch(t){case 192:n=0;break;case 196:case 217:n=e.getUi8();break;case 197:case 218:n=e.getUi16();break;case 198:case 219:n=e.getUi32();break;default:s(t)||r(t,"bytes or string"),n=function(e){return 31&e}(t)}return e.get(n)}function l(e,t){t<16?e.putUi8(144|15&t):m(e,220,t)}function h(e,t){const n=e.getUi8(),r=c(n)?function(e){return 15&e}(n):_(e,n,220,"array");if(null!=t&&r!==t)throw new Error(`invalid array header size ${r}`);return r}function f(e,t){t<16?e.putUi8(128|15&t):m(e,222,t)}function v(e,t){const n=e.getUi8(),r=u(n)?function(e){return 15&e}(n):_(e,n,222,"map");if(null!=t&&r!==t)throw new Error(`invalid map header size ${r}`);return r}function m(e,t,n){if(n<=65535)e.putUi8(t),e.putUi16(n);else{if(!(n<=4294967295))throw new RangeError("length limit exceeded");e.putUi8(t+1),e.putUi32(n)}}function _(e,t,n,i){switch(t){case 192:return 0;case n:return e.getUi16();case n+1:return e.getUi32();default:r(t,i)}}n.d(t,{decode:()=>O});const g={enc(e,t){(function(e){switch(typeof e){case"undefined":return y;case"boolean":return S;case"number":return isFinite(e)&&Math.floor(e)===e?e<0?E:T:C;case"string":return R;case"object":return null===e?y:Array.isArray(e)?I:e instanceof Uint8Array||e instanceof ArrayBuffer?b:e instanceof Date?w:A;default:throw new TypeError("unsupported type "+typeof e)}})(t).enc(e,t)},dec:e=>function(e){switch(e){case 192:return y;case 194:case 195:return S;case 208:case 209:case 210:case 211:return E;case 204:case 205:case 206:case 207:return T;case 202:case 203:return C;case 196:case 197:case 198:return b;case 217:case 218:case 219:return R;case 220:case 221:return I;case 222:case 223:return A;case 214:case 215:case 199:return w;default:if(o(e)||a(e))return E;if(s(e))return R;if(c(e))return I;if(u(e))return A;throw new TypeError(`unsupported tag ${e}`)}}(e.peek()).dec(e)},y={enc(e,t){e.putUi8(192)},dec(e){const t=e.getUi8();return 192!==t&&r(t,"nil"),null}},S={enc(e,t){e.putUi8(t?195:194)},dec(e){const t=e.getUi8();switch(t){case 192:case 194:return!1;case 195:return!0;default:r(t,"bool")}}},E={enc(e,t){-128<=t&&t<=127?t>=0?e.putUi8(i(t)):t>-32?e.putUi8(224|31&t):(e.putUi8(208),e.putUi8(t)):-32768<=t&&t<=32767?(e.putI8(209),e.putI16(t)):-2147483648<=t&&t<=2147483647?(e.putI8(210),e.putI32(t)):(e.putI8(211),e.putI64(t))},dec(e){const t=e.getUi8();if(o(t))return function(e){return 127&e}(t);if(a(t))return function(e){return e-256}(t);switch(t){case 192:return 0;case 208:return e.getI8();case 209:return e.getI16();case 210:return e.getI32();case 211:return e.getI64();case 204:return e.getUi8();case 205:return e.getUi16();case 206:return e.getUi32();case 207:return e.getUi64();default:r(t,"int")}}},T={enc(e,t){if(t<0)throw new Error(`not an uint: ${t}`);t<=127?e.putUi8(i(t)):t<=255?(e.putUi8(204),e.putUi8(t)):t<=65535?(e.putUi8(205),e.putUi16(t)):t<=4294967295?(e.putUi8(206),e.putUi32(t)):(e.putUi8(207),e.putUi64(t))},dec(e){const t=E.dec(e);if(t<0)throw new RangeError("uint underflow");return t}},C={enc(e,t){e.putUi8(203),e.putF(t)},dec(e){const t=e.getUi8();switch(t){case 192:return 0;case 202:return e.getF32();case 203:return e.getF64();default:r(t,"float")}}},b={enc(e,t){d(e,t,196)},dec:p},R={enc(e,t){const n=function(e){const t=e.length,n=new Uint8Array(4*t);let r,i=0,o=0;for(;o<t;)r=e.charCodeAt(o++),55296==(64512&r)&&(r=(r<<10)+e.charCodeAt(o++)-56613888),r<128?n[i++]=r:r<2048?(n[i++]=192+(r>>6),n[i++]=128+(63&r)):r<65536?(n[i++]=224+(r>>12),n[i++]=128+(r>>6&63),n[i++]=128+(63&r)):(n[i++]=240+(r>>18),n[i++]=128+(r>>12&63),n[i++]=128+(r>>6&63),n[i++]=128+(63&r));return n.buffer.slice(0,i)}(t);n.byteLength<32?(e.putUi8(160|31&n.byteLength),e.put(n)):d(e,n,217)},dec:e=>function(e){return new TextDecoder("utf-8").decode(e)}(p(e))},w={enc(e,t){const n=t.getTime();e.putUi8(199),e.putUi8(12),e.putI8(-1),e.putUi32(n%1e3*1e6),e.putI64(n/1e3)},dec(e){const t=e.getUi8();switch(t){case 214:if(-1===e.getI8())return new Date(1e3*e.getUi32());break;case 215:if(-1===e.getI8()){const t=e.getUi32(),n=e.getUi32();return new Date(1e3*(n+4294967296*(3&t))+t/4e6)}break;case 199:if(12===e.getUi8()&&-1===e.getI8()){const t=e.getUi32(),n=e.getI64();return new Date(1e3*n+t/1e6)}}r(t,"time")}},I=(P=g,{encHeader:l,decHeader:h,enc(e,t){l(e,t.length),t.forEach((t=>P.enc(e,t)))},dec(e){const t=[];for(let n=h(e);n>0;--n)t.push(P.dec(e));return t}});var P;const A=function(e,t){return{encHeader:f,decHeader:v,enc(n,r){const i=Object.keys(r);f(n,i.length),i.forEach((i=>{e.enc(n,i),t.enc(n,r[i])}))},dec(n){const r={};for(let i=v(n);i>0;--i){r[e.dec(n)]=t.dec(n)}return r}}}(g,g);function O(e,t){return(t||g).dec(function(e){let t=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),n=0;return{peek:()=>t.getUint8(n),get(e){n+=e;const r=t.byteOffset;return t.buffer.slice(r+n-e,r+n)},getI8:()=>t.getInt8(n++),getI16:()=>(n+=2,t.getInt16(n-2)),getI32:()=>(n+=4,t.getInt32(n-4)),getI64:()=>(n+=8,4294967296*t.getInt32(n-8)+t.getUint32(n-4)),getUi8:()=>t.getUint8(n++),getUi16:()=>(n+=2,t.getUint16(n-2)),getUi32:()=>(n+=4,t.getUint32(n-4)),getUi64:()=>(n+=8,4294967296*t.getUint32(n-8)+t.getUint32(n-4)),getF32:()=>(n+=4,t.getFloat32(n-4)),getF64:()=>(n+=8,t.getFloat64(n-8))}}(e))}},762539:(e,t,n)=>{"use strict";var r=n(857539);function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var d=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},d.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},d.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},d.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},d.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},d.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var u=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(u)),a.candidate.candidate=u,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var d=r.getMediaSections(i._localDescription.sdp);d[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+d.join("");var p=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),p&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},d.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var a=i.transceivers[t],c=a.iceGatherer,u=a.iceTransport,d=a.dtlsTransport,p=a.localCapabilities,l=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!a.rejected){var h=r.getIceParameters(e,n),f=r.getDtlsParameters(e,n);s&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===u.state&&u.start(c,h,s?"controlling":"controlled"),"new"===d.state&&d.start(f));var v=o(p,l);i._transceive(a,v.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var d=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,d.signalingState)||d._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+d.signalingState));var p={};d.remoteStreams.forEach((function(e){p[e.id]=e}));var l=[],h=r.splitSections(i.sdp),f=h.shift(),v=r.matchPrefix(f,"a=ice-lite").length>0,m=r.matchPrefix(f,"a=group:BUNDLE ").length>0;d.usingBundle=m;var _=r.matchPrefix(f,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!_&&_.substr(14).split(" ").indexOf("trickle")>=0,h.forEach((function(a,c){var u=r.splitLines(a),h=r.getKind(a),_=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],y=r.getDirection(a,f),S=r.parseMsid(a),E=r.getMid(a)||r.generateIdentifier();if(_||"application"===h&&("DTLS/SCTP"===g||"UDP/DTLS/SCTP"===g))d.transceivers[c]={mid:E,kind:h,protocol:g,rejected:!0};else{var T,C,b,R,w,I,P,A,O;!_&&d.transceivers[c]&&d.transceivers[c].rejected&&(d.transceivers[c]=d._createTransceiver(h,!0));var k,D,N=r.parseRtpParameters(a);_||(k=r.getIceParameters(a,f),(D=r.getDtlsParameters(a,f)).role="client"),P=r.parseRtpEncodingParameters(a);var M=r.parseRtcpParameters(a),L=r.matchPrefix(a,"a=end-of-candidates",f).length>0,x=r.matchPrefix(a,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!_&&m&&c>0&&d.transceivers[c]&&(d._disposeIceAndDtlsTransports(c),d.transceivers[c].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[c].iceTransport=d.transceivers[0].iceTransport,d.transceivers[c].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[c].rtpSender&&d.transceivers[c].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[c].rtpReceiver&&d.transceivers[c].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==i.type||_){if("answer"===i.type&&!_){C=(T=d.transceivers[c]).iceGatherer,b=T.iceTransport,R=T.dtlsTransport,w=T.rtpReceiver,I=T.sendEncodingParameters,A=T.localCapabilities,d.transceivers[c].recvEncodingParameters=P,d.transceivers[c].remoteCapabilities=N,d.transceivers[c].rtcpParameters=M,x.length&&"new"===b.state&&(!v&&!L||m&&0!==c?x.forEach((function(e){s(T.iceTransport,e)})):b.setRemoteCandidates(x)),m&&0!==c||("new"===b.state&&b.start(C,k,"controlling"),"new"===R.state&&R.start(D)),!o(T.localCapabilities,T.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,d._transceive(T,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!w||"sendrecv"!==y&&"sendonly"!==y?delete T.rtpReceiver:(O=w.track,S?(p[S.stream]||(p[S.stream]=new e.MediaStream),n(O,p[S.stream]),l.push([O,w,p[S.stream]])):(p.default||(p.default=new e.MediaStream),n(O,p.default),l.push([O,w,p.default])))}}else{(T=d.transceivers[c]||d._createTransceiver(h)).mid=E,T.iceGatherer||(T.iceGatherer=d._createIceGatherer(c,m)),x.length&&"new"===T.iceTransport.state&&(!L||m&&0!==c?x.forEach((function(e){s(T.iceTransport,e)})):T.iceTransport.setRemoteCandidates(x)),A=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(A.codecs=A.codecs.filter((function(e){return"rtx"!==e.name}))),I=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var U,j=!1;if("sendrecv"===y||"sendonly"===y){if(j=!T.rtpReceiver,w=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,h),j)O=w.track,S&&"-"===S.stream||(S?(p[S.stream]||(p[S.stream]=new e.MediaStream,Object.defineProperty(p[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(O,"id",{get:function(){return S.track}}),U=p[S.stream]):(p.default||(p.default=new e.MediaStream),U=p.default)),U&&(n(O,U),T.associatedRemoteMediaStreams.push(U)),l.push([O,w,U])}else T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===T.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),T.associatedRemoteMediaStreams=[]);T.localCapabilities=A,T.remoteCapabilities=N,T.rtpReceiver=w,T.rtcpParameters=M,T.sendEncodingParameters=I,T.recvEncodingParameters=P,d._transceive(d.transceivers[c],!1,j)}}})),void 0===d._dtlsRole&&(d._dtlsRole="offer"===i.type?"active":"passive"),d._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(p).forEach((function(t){var n=p[t];if(n.getTracks().length){if(-1===d.remoteStreams.indexOf(n)){d.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){d._dispatchEvent("addstream",r)}))}l.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(d,t,r,[n])}))}})),l.forEach((function(e){e[2]||u(d,e[0],e[1],[])})),e.setTimeout((function(){d&&d.transceivers&&d.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},d.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter((function(e){return"audio"===e.kind})).length,a=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(s);t<15019&&(u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}))),u.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),u.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=u,i.sendEncodingParameters=d})),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))}));var d=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(d)},d.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}}));var u=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(u)},d.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){a=u;break}var d=n.transceivers[a];if(!d)return o(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var p=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===p.protocol&&(0===p.port||9===p.port))return i();if(p.component&&1!==p.component)return i();if((0===a||a>0&&d.iceTransport!==n.transceivers[0].iceTransport)&&!s(d.iceTransport,p))return o(c("OperationError","Can not add ICE candidate"));var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(p.type?l:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var h=0;h<n.transceivers.length&&(n.transceivers[h].rejected||(n.transceivers[h].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[h]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));h++);i()}))},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var p=["createOffer","createAnswer"];return p.forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(p=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),d}},857539:e=>{"use strict";var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},t.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((function(e){return 0===e.indexOf(n)}))},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){var r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=t.parseRtpMap(a),c=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?t.parseFmtp(c[0]):{},s.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(s.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((function(e){n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){var r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((function(e){r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));var i=0;return n.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach((function(e){r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){var n,r=[],i=t.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,u=t.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(n=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),r.push(t),o&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&c&&r.push({ssrc:c});var d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=d}))),r},t.parseRtcpParameters=function(e){var n={},r=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);var i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;var o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.parseMsid=function(e){var n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(n=r[0].substr(7).split(" "))[0],track:n[1]};var i=t.matchPrefix(e,"a=ssrc:").map((function(e){return t.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(n=i[0].value.split(" "))[0],track:n[1]}:void 0},t.parseSctpDescription=function(e){var n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substr(19),10)),isNaN(n)&&(n=65536);var o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:n};if(t.matchPrefix(e,"a=sctpmap:").length>0){var a=t.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){var i=void 0!==n?n:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,r,i){var o=t.writeRtpDescription(e.kind,n);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),o},t.getDirection=function(e,n){for(var r=t.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),r=0;r<n.length;r++)if(n[r].length<2||"="!==n[r].charAt(1))return!1;return!0},e.exports=t},121255:(e,t,n)=>{"use strict";n.d(t,{CallStatReachedType:()=>h.CallStatReachedType,CallStatResult:()=>h.CallStatResult,CallStatFailReason:()=>h.CallStatFailReason,CallStatSource:()=>h.CallStatSource,CallActionEventType:()=>h.CallActionEventType,CallStatMuteType:()=>h.CallStatMuteType,VIDEO_SLOTS_COUNT:()=>f,NoiseCancellationTypes:()=>u,VideoResolutionTypes:()=>d,VIDEO_RESOLUTION_STORAGE_KEY:()=>R,LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED:()=>w,DESKTOP_CALLS_SCHEME:()=>I,DESKTOP_CALLS_HOST:()=>P,DESKTOP_CALLS_DOWNLOAD_PAGE:()=>A,DESKTOP_CALLS_DOWNLOAD:()=>O,DESKTOP_CALLS_FILENAME:()=>k,VideoHeight:()=>v,VideoWidth:()=>m,ParticipantsManagementMode:()=>_,MediaPermissionType:()=>g,ErrorHandleType:()=>y,CallErrorType:()=>S,MediaError:()=>E,FatalError:()=>T,SearchResultType:()=>C,Mode:()=>b,LOAD_PEERS:()=>U,CHANGE_MODE:()=>j,CALL_STATE:()=>V,REMOVE_USER:()=>F,TIME_START:()=>G,LOCAL_TIME_START:()=>B,HANGUP:()=>H,SET_CHAT_INFO:()=>W,GROUP_CALL_SETUP:()=>q,TOGGLE_POPUP:()=>K,UPDATE_HASH:()=>$,CHANGE_UI_MODE:()=>J,SET_ORATOR:()=>z,TOGGLE_ORATOR_MODE:()=>Y,TOGGLE_PARTICIPANTS_ASIDE:()=>X,SET_PINNED_PARTICIPANT:()=>Q,SET_ADMIN_PINNED_PARTICIPANT:()=>Z,SET_SCREEN_SHARING_PINNED_PARTICIPANT:()=>ee,MANAGEMENT:()=>te,CALL_NOTIFICATION:()=>ne,JOIN:()=>re,CALL_BY_NAME:()=>ie,ERROR:()=>oe,CHANGE_PARTICIPANT_STATE:()=>ae,CHANGE_PARTICIPANT_ROLES:()=>se,CHANGE_PARTICIPANT_PERMISSIONS:()=>ce,SET_SCREEN_SHARER:()=>ue,SET_FRIENDS:()=>de,SET_GROUP_MEMBERS:()=>pe,SET_SPEAKERS:()=>le,UPDATE_PARTICIPANTS_BATCH:()=>he,SET_UNREAD_COUNT:()=>fe,SHOW_CAUTION_BOX:()=>ve,SHOW_LOADER:()=>me,SET_TOOLTIP:()=>_e,MANUAL_ADD_PARTICIPANTS:()=>ge,SET_TRANSLATION:()=>ye,UPDATE_ANON_SECRET:()=>Se,TOGGLE_PARTICIPANTS_MANAGEMENT:()=>Ee,TOGGLE_PARTICIPANTS_KICK:()=>Te,TOGGLE_ADMIN_ASSIGNMENT:()=>Ce,SET_NOISE_CANCELLATION:()=>be,CHANGE_LOCAL_VIDEO_RESOLUTION:()=>Re,SET_CONVERSATION_OPTIONS:()=>we,SET_PRIVACY_SETTINGS:()=>Ie,UNBAN_PARTICIPANTS:()=>Pe,SET_GROUP:()=>Ae,SET_WAITING_HALL:()=>Oe,SET_LOCAL_STATUS:()=>ke,SET_PUSH_TO_TALK_ENABLE:()=>De,SET_GRID_SCROLL_POSITION:()=>Ne,SET_ORATOR_SCROLL_POSITION:()=>Me,CallType:()=>D,UIMode:()=>N,NotificationType:()=>M,SdkHandType:()=>L,SdkErrorType:()=>x,defaultNotificationLifeSpan:()=>xe,VOLUME_LEVEL_DETECTION:()=>Ue,DEFAULT_AVATAR:()=>je,DEFAULT_GROUP_CALL_PHOTO:()=>Ve,HANGUP_DELAY:()=>Fe,CLIENT_ERROR_UNKNOWN:()=>Ge,SERVER_ERROR_UNKNOWN:()=>Be,SERVER_ERROR_INVALID_REQUEST:()=>He,SERVER_ERROR_FLOOD_CONTROL:()=>We,SERVER_ERROR_INTERNAL:()=>qe,SERVER_ERROR_OLD_RECEIVER_APP:()=>Ke,SERVER_ERROR_PRIVACY:()=>$e,SERVER_ERROR_BUSY:()=>Je,SERVER_ERROR_REQUIRE_AUTH:()=>ze,SERVER_ERROR_MESSAGES_CALL_JOIN_NOT_ALLOWED:()=>Ye,SERVER_ERROR_MESSAGES_CALL_NOT_FOUND:()=>Xe,SDK_ERROR_AUTH:()=>Qe,POPUP_SETTINGS:()=>Ze,POPUP_TRANSLATION:()=>et,POPUP_TRANSLATION_START_COUNTDOWN:()=>tt,POPUP_TRANSLATION_STOP:()=>nt,POPUP_TRANSLATION_SHARE:()=>rt,POPUP_EXIT:()=>it,POPUP_UNMUTE_REQUEST:()=>ot,POPUP_ADMIN_PIN_UNMUTE_REQUEST:()=>at,POPUP_TRANSFER_ADMIN_RIGHTS:()=>st,HANGUP_TYPE_BUSY:()=>ct,HANGUP_TYPE_CALLEE_IS_OFFLINE:()=>ut,HANGUP_TYPE_CALLER_IS_BLOCKED:()=>dt,HANGUP_TYPE_CANCELED:()=>pt,HANGUP_TYPE_EXTERNAL_API_ERROR:()=>lt,HANGUP_TYPE_FAILED:()=>ht,HANGUP_TYPE_HUNGUP:()=>ft,HANGUP_TYPE_MISSED:()=>vt,HANGUP_TYPE_NOT_FRIENDS:()=>mt,HANGUP_TYPE_OLD_VERSION:()=>_t,HANGUP_TYPE_REJECTED:()=>gt,HANGUP_TYPE_REMOVED:()=>yt,HANGUP_TYPE_SERVICE_DISABLED:()=>St,HANGUP_TYPE_UNKNOWN_ERROR:()=>Et,HANGUP_TYPE_UNSUPPORTED:()=>Tt,FLAG_OUTBOUND:()=>Ct,FLAG_DELETED:()=>bt,FLAG_SPAM:()=>Rt,INCOMING_CALL:()=>wt,ADD_MESSAGE:()=>It,CONVERSATION_UPDATED:()=>Pt,MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:()=>At,READ_INBOUND:()=>Ot,SET_FLAGS:()=>kt,EDIT_MESSAGE:()=>Dt,REPLACE_MESSAGE:()=>Nt,DELETE_DIALOG:()=>Mt,COUNT_OF_GROUP_MEMBERS_TO_LOAD:()=>Lt,KickParticipantType:()=>Le});var r,i,o,a,s,c,u,d,p=n(464380),l=n(233194),h=n(765446),f=30;!function(e){e.NEURAL="NEURAL",e.SIMPLE="SIMPLE",e.NONE="NONE"}(u||(u={})),function(e){e.SD="SD",e.HD="HD",e.FHD="FHD"}(d||(d={}));var v,m,_,g,y,S,E,T,C,b,R="calls_video_resolution",w="vkcalls:calls_app_downloaded",I="vkcalls://",P="vk.com",A="https://vk.com/video-calls",O=((r={})[l.OS.WINDOWS]="https://vkcalls-native-ac.vk-apps.com/latest/vk-calls.exe",r[l.OS.MAC]="https://vkcalls-native-ac.vk-apps.com/latest/vk-calls.dmg",r[l.OS.LINUX]={deb:(i={},i[l.ARCH.X64]="https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-amd64.deb",i[l.ARCH.X86]="https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-i386.deb",i),rpm:(o={},o[l.ARCH.X64]="https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-x86_64.rpm",o[l.ARCH.X86]="https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-i686.rpm",o)},r),k=((a={})[l.OS.WINDOWS]="vk-calls.exe",a[l.OS.MAC]="vk-calls.dmg",a[l.OS.LINUX]={deb:(s={},s[l.ARCH.X64]="vk-calls-amd64.deb",s[l.ARCH.X86]="vk-calls-i386.deb",s),rpm:(c={},c[l.ARCH.X64]="vk-calls-x86_64.rpm",c[l.ARCH.X86]="vk-calls-i686.rpm",c)},a);!function(e){e[e.SD=360]="SD",e[e.HD=720]="HD",e[e.FHD=1080]="FHD"}(v||(v={})),function(e){e[e.SD=640]="SD",e[e.HD=1280]="HD",e[e.FHD=1920]="FHD"}(m||(m={})),function(e){e[e.SINGLE=0]="SINGLE",e[e.ALL=1]="ALL"}(_||(_={})),function(e){e[e.DENY=0]="DENY",e[e.ONCE=1]="ONCE",e[e.ALLOW=1/0]="ALLOW"}(g||(g={})),function(e){e[e.DECLINE=0]="DECLINE",e[e.PROCESS=1]="PROCESS",e[e.FATAL=2]="FATAL"}(y||(y={})),function(e){e.ALREADY_IN_CALL="already_in_call",e.CANT_REACH_API="cant_reach_api"}(S||(S={})),function(e){e.MIC_CAMERA_PERMISSION="mic_camera",e.CAMERA_PERMISSION="camera",e.MIC_PERMISSION="mic",e.CAMERA_ACCESS="cameralock",e.MIC_ACCESS="miclock",e.MIC_NOT_FOUND="nomic",e.SCREEN_PERMISSION="screenpermission",e.SCREEN_ACCESS="screenlock"}(E||(E={})),function(e){e.AUTH="auth"}(T||(T={})),function(e){e[e.HEADER=0]="HEADER",e[e.CALL_ALL_IN_CHAT=1]="CALL_ALL_IN_CHAT",e[e.MEMBERS_MORE=2]="MEMBERS_MORE",e[e.FRIENDS_MORE=3]="FRIENDS_MORE",e[e.GROUP_MEMBERS_MORE=4]="GROUP_MEMBERS_MORE"}(C||(C={})),function(e){e[e.READY=0]="READY",e[e.CALL=1]="CALL",e[e.INCOMING=2]="INCOMING",e[e.JOIN=3]="JOIN",e[e.ERROR=4]="ERROR",e[e.FEEDBACK=5]="FEEDBACK",e[e.START=6]="START",e[e.CALL_BY=7]="CALL_BY"}(b||(b={}));var D,N,M,L,x,U="load_peer",j="change_mode",V="call_state",F="remove_user",G="time_start",B="local_time_start",H="hangup",W="set_chat_info",q="group_call_setup",K="toggle_popup",$="update_hash",J="change_ui_mode",z="set_orator",Y="toggle_orator_mode",X="toggle_participants_aside",Q="set_pinned_participant",Z="set_admin_pinned_participant",ee="set_screen_sharing_pinned_participant",te="management",ne="call_notification",re="join",ie="call_by_name",oe="error",ae="change_participant_state",se="change_participant_roles",ce="change_participant_permissions",ue="set_screen_sharer",de="set_friends",pe="set_group_members",le="set_speakers",he="update_participants_batch",fe="set_unread_count",ve="show_caution_box",me="show_loader",_e="set_tooltip",ge="manual_add_participants",ye="set_translation",Se="update_anon_token",Ee="toggle_participants_management",Te="toggle_participants_kick",Ce="toggle_admin_assignment",be="set_noise_cancellation",Re="change_local_video_resolution",we="set_conversation_options",Ie="set_privacy_settings",Pe="unban_participants",Ae="set_group",Oe="set_waiting_hall",ke="set_local_status",De="set_push_to_talk_enable",Ne="set_grid_scroll_position",Me="set_orator_scroll_position";!function(e){e.AUDIO="audio",e.VIDEO="video"}(D||(D={})),function(e){e.DEFAULT="default",e.COLLAPSED="collapsed",e.FULLSCREEN="fullscreen"}(N||(N={})),function(e){e.SPEAKING_ON_MUTE="SPEAKING_ON_MUTE",e.RAISED_HAND="RAISED_HAND",e.SCREEN_SHARING_STARTED="SCREEN_SHARING_STARTED",e.BAD_NETWORK_CONNECTION="BAD_NETWORK_CONNECTION",e.BAD_NETWORK_CONNECTION_DISABLE_CAMERA="BAD_NETWORK_CONNECTION_DISABLE_CAMERA",e.ADMIN_MUTE="ADMIN_MUTE",e.ADMIN_MUTE_PERMANENT="ADMIN_MUTE_PERMANENT",e.ADMIN_ROLE_GRANTED="ADMIN_ROLE_GRANTED",e.USER_GRANTED_WITH_ADMIN_ROLE="USER_GRANTED_WITH_ADMIN_ROLE",e.PINNED_BY_ADMIN="PINNED_BY_ADMIN",e.USER_PINNED_BY_ADMIN="USER_PINNED_BY_ADMIN",e.PUSH_TO_TALK="PUSH_TO_TALK",e.CONNECTING="CONNECTING"}(M||(M={})),function(e){e.LOWERED="0",e.RAISED="1"}(L||(L={})),function(e){e.NETWORK="network_error",e.API="api_error"}(x||(x={}));var Le,xe=5e3,Ue=.25,je="https://vk.com/images/camera_400.png",Ve="https://vk.com/images/call_convo_stub.png",Fe=2,Ge=-2,Be=1,He=8,We=9,qe=10,Ke=923,$e=928,Je=948,ze=960,Ye=963,Xe=951,Qe=401,Ze="settings",et="translation",tt="translation_start_countdown",nt="translation_stop",rt="translation_stop_share",it="exit",ot="unmute_request",at="admin_pin_unmute_request",st="transfer_admin_rights",ct=p.HangupType.BUSY,ut=p.HangupType.CALLEE_IS_OFFLINE,dt=p.HangupType.CALLER_IS_BLOCKED,pt=p.HangupType.CANCELED,lt=p.HangupType.EXTERNAL_API_ERROR,ht=p.HangupType.FAILED,ft=p.HangupType.HUNGUP,vt=p.HangupType.MISSED,mt=p.HangupType.NOT_FRIENDS,_t=p.HangupType.OLD_VERSION,gt=p.HangupType.REJECTED,yt=p.HangupType.REMOVED,St=p.HangupType.SERVICE_DISABLED,Et=p.HangupType.UNKNOWN_ERROR,Tt=p.HangupType.UNSUPPORTED,Ct=2,bt=128,Rt=64,wt="incoming_call",It="event_add_message",Pt="event_chat_updated",At=19,Ot="event_read_inbound",kt="event_set_flags",Dt="event_edit_message",Nt="event_replace_message",Mt="event_delete_dialog",Lt=500;!function(e){e[e.CALL=0]="CALL",e[e.WAITING_HALL=1]="WAITING_HALL"}(Le||(Le={}))},233194:(e,t,n)=>{"use strict";n.d(t,{OS:()=>i,ARCH:()=>o,BROWSER:()=>a,Platform:()=>h});var r,i,o,a,s=n(570655),c=n(489588);!function(e){e.WINDOWS="windows",e.MAC="mac",e.ANDROID="android",e.IOS="ios",e.LINUX="linux",e.UNKNOWN="unknown"}(i||(i={})),function(e){e.X86="x86",e.X64="x64",e.ARM="arm"}(o||(o={})),function(e){e.CHROME="chrome",e.FIREFOX="firefox",e.SAFARI="safari",e.OPERA="opera",e.YANDEX="yandex",e.IE="ie",e.EDGE="edge"}(a||(a={}));var u=((r={})[i.ANDROID]=/Android/i,r[i.IOS]=/(iPhone|iPad|iPod)/i,r[i.WINDOWS]=/Win/i,r[i.IOS]=/(iPhone|iPad|iPod)/i,r[i.ANDROID]=/Android/i,r[i.MAC]=/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/i,r[i.LINUX]=/(Linux|X11(?!.*CrOS))/i,r),d=/(x86_64|x86-64|win64|x64;|amd64|wow64|x64_64)/i,p=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,l=new Map,h={get OS(){var e,t;if(l.has("os"))return l.get("os");var n=window.navigator.userAgent;try{for(var r=(0,s.__values)(Object.entries(u)),o=r.next();!o.done;o=r.next()){var a=(0,s.__read)(o.value,2),c=a[0],d=a[1];if(d&&d.test(n))return l.set("os",c),c}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return l.set("os",i.UNKNOWN),i.UNKNOWN},get ARCH(){if(l.has("arch"))return l.get("arch");var e=window.navigator,t=e.userAgent,n=e.platform;return d.test(t)||"MacIntel"===n||"Linux x86_64"===n?(l.set("arch",o.X64),o.X64):/arm/i.test(t)?(l.set("arch",o.ARM),o.ARM):(l.set("arch",o.X86),o.X86)},get BROWSER(){return f().name.toLowerCase()},get isChromeBased(){return f().chromeBased},get isMobile(){if(l.has("isMobile"))return l.get("isMobile");var e=window.navigator.appVersion,t=p.test(e);return l.set("isMobile",t),t},get isIPad(){return c.isIPad||c.isIPadOS}};function f(){if(l.has("browserInfo"))return l.get("browserInfo");var e=function(){var e,t=!1,n=0,r=window.navigator,i=r.userAgent,o=r.appName,s=r.appVersion,c=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)([\d.]+)/i)||[];if(/trident/i.test(c[1]))return e=/\brv[ :]+(\d+)([\d.]+)/g.exec(i),{name:a.IE,version:e&&e[1]||"Unknown",fullVersion:e&&e[1]?""+e[1]+(e[2]||""):"Unknown",chromeBased:t,chromeVersion:n};if("Safari"===c[1]){if(e=i.match(/\bEdge\/(\d+)([\d.])+/))return{name:a.EDGE,version:e[1]||"Unknown",fullVersion:e[1]?""+e[1]+(e[2]||""):"Unknown",chromeBased:t,chromeVersion:n};if(e=i.match(/\bCriOS\/(\d+)([\d.]+)/))return{name:a.CHROME,version:e[1],fullVersion:""+e[1]+e[2],chromeBased:!0,chromeVersion:e[1]};if(e=i.match(/\bFxiOS\/(\d+)([\d.]+)/))return{name:a.FIREFOX,version:e[1],fullVersion:""+e[1]+e[2],chromeBased:t,chromeVersion:n};if(e=i.match(/\bYaBrowser\/(\d+)([\d.]+)/))return{name:a.YANDEX,version:e[1],fullVersion:""+e[1]+e[2],chromeBased:t,chromeVersion:n};if(e=i.match(/\bOPT\/(\d+)([\d.]+)/))return{name:a.OPERA,version:e[1],fullVersion:""+e[1]+e[2],chromeBased:t,chromeVersion:n}}if("Chrome"===c[1]){if(n=Number(c[2]),t=!0,e=i.match(/\bOPR\/(\d+)([\d.]+)/))return{name:a.CHROME,version:e[1]||"Unknown",fullVersion:e[1]?""+e[1]+(e[2]||""):"Unknown",chromeBased:t,chromeVersion:n};if(e=i.match(/\bYaBrowser\/(\d+)([\d.]+)/))return{name:a.YANDEX,version:e[1]||"Unknown",fullVersion:e[1]?""+e[1]+(e[2]||""):"Unknown",chromeBased:t,chromeVersion:n};if(e=i.match(/\bEdge?\/(\d+)([\d.]+)/))return{name:a.EDGE,version:e[1]||"Unknown",fullVersion:e[1]?""+e[1]+(e[2]||""):"Unknown",chromeBased:t,chromeVersion:n};if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return{name:a.OPERA,version:"Hidden",fullVersion:"Hidden",chromeBased:t,chromeVersion:n}}return e=i.match(/version\/(\d+)([\d.]+)/i),{name:c[2]?c[1]:o,version:e&&e[1]||c[2]||s,fullVersion:e&&e[1]?""+e[1]+(e[2]||""):c[2]?""+c[2]+(c[3]||""):s,chromeBased:t,chromeVersion:n}}();return l.set("browserInfo",e),e}},545580:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});const r=(0,n(640447).adapterFactory)({window:"undefined"==typeof window?void 0:window})},640447:(e,t,n)=>{"use strict";n.d(t,{adapterFactory:()=>d});var r=n(786643),i=n(165070),o=n(624854),a=n(960057),s=n(809080),c=n(155938),u=n(548864);function d({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const n=r.log,d=r.detectBrowser(e),p={browserDetails:d,commonShim:u,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(d.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),p;if(null===d.version)return n("Chrome shim can not determine version, not shimming."),p;n("adapter.js shimming chrome."),p.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;case"firefox":if(!a||!a.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),p;n("adapter.js shimming firefox."),p.browserShim=a,s.shimGetUserMedia(e),a.shimPeerConnection(e),a.shimOnTrack(e),a.shimRemoveStream(e),a.shimSenderGetStats(e),a.shimReceiverGetStats(e),a.shimRTCDataChannel(e),a.shimAddTransceiver(e),a.shimGetParameters(e),a.shimCreateOffer(e),a.shimCreateAnswer(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"edge":if(!o||!o.shimPeerConnection||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),p;n("adapter.js shimming edge."),p.browserShim=o,o.shimGetUserMedia(e),o.shimGetDisplayMedia(e),o.shimPeerConnection(e),o.shimReplaceTrack(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"safari":if(!c||!t.shimSafari)return n("Safari shim is not included in this adapter release."),p;n("adapter.js shimming safari."),p.browserShim=c,c.shimRTCIceServerUrls(e),c.shimCreateOfferLegacy(e),c.shimCallbacksAPI(e),c.shimLocalStreamsAPI(e),c.shimRemoteStreamsAPI(e),c.shimTrackEventTransceiver(e),c.shimGetUserMedia(e),c.shimAudioContext(e),u.shimRTCIceCandidate(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;default:n("Unsupported browser!")}return p}},165070:(e,t,n)=>{"use strict";n.r(t),n.d(t,{shimGetUserMedia:()=>i.shimGetUserMedia,shimGetDisplayMedia:()=>o.shimGetDisplayMedia,shimMediaStream:()=>a,shimOnTrack:()=>s,shimGetSendersWithDtmf:()=>c,shimGetStats:()=>u,shimSenderReceiverGetStats:()=>d,shimAddTrackRemoveTrackWithNative:()=>p,shimAddTrackRemoveTrack:()=>l,shimPeerConnection:()=>h,fixNegotiationNeeded:()=>f});var r=n(786643),i=n(480009),o=n(271533);function a(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function s(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else r.wrapPeerConnectionEvent(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function c(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function u(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function d(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>r.filterStats(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),r.wrapPeerConnectionEvent(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>r.filterStats(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function p(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function l(e){if(!e.RTCPeerConnection)return;const t=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return p(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>a(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=u.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function h(e){const t=r.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;const n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function f(e){const t=r.detectBrowser(e);r.wrapPeerConnectionEvent(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}},271533:(e,t,n)=>{"use strict";function r(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}n.d(t,{shimGetDisplayMedia:()=>r})},480009:(e,t,n)=>{"use strict";n.d(t,{shimGetUserMedia:()=>o});var r=n(786643);const i=r.log;function o(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=r.detectBrowser(e),o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(n.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});const s=n.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||s)){let n;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?n=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then((t=>{let s=(t=t.filter((e=>"videoinput"===e.kind))).find((e=>n.some((t=>e.label.toLowerCase().includes(t)))));return!s&&t.length&&n.includes("back")&&(s=t[t.length-1]),s&&(e.video.deviceId=a.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)}))}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){a(e,(e=>{t.webkitGetUserMedia(e,n,(e=>{r&&r(s(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return a(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}},548864:(e,t,n)=>{"use strict";n.r(t),n.d(t,{shimRTCIceCandidate:()=>a,shimMaxMessageSize:()=>s,shimSendThrowTypeError:()=>c,shimConnectionState:()=>u,removeAllowExtmapMixed:()=>d});var r=n(857539),i=n.n(r),o=n(786643);function a(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=i().parseCandidate(e.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function s(e){if(!e.RTCPeerConnection)return;const t=o.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=i().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=i().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},a=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},s=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const o=i().matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?r=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=a(e),n=s(arguments[0],e);let i;i=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>i}),this._sctp=o}return c.apply(this,arguments)}}function c(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},o.wrapPeerConnectionEvent(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function u(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function d(e){if(!e.RTCPeerConnection)return;const t=o.detectBrowser(e);if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n")),n.apply(this,arguments)}}},624854:(e,t,n)=>{"use strict";n.r(t),n.d(t,{shimGetUserMedia:()=>s.shimGetUserMedia,shimGetDisplayMedia:()=>c.shimGetDisplayMedia,shimPeerConnection:()=>u,shimReplaceTrack:()=>d});var r=n(786643),i=n(860641),o=n(762539),a=n.n(o),s=n(131169),c=n(794155);function u(e){const t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const n=a()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,i.filterIceServers)(e.iceServers,t.version),r.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function d(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}},860641:(e,t,n)=>{"use strict";n.d(t,{filterIceServers:()=>i});var r=n(786643);function i(e,t){let n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){let t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");const i="string"==typeof t;return i&&(t=[t]),t=t.filter((e=>{if(0===e.indexOf("stun:"))return!1;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))}},794155:(e,t,n)=>{"use strict";function r(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}n.d(t,{shimGetDisplayMedia:()=>r})},131169:(e,t,n)=>{"use strict";function r(e){const t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e))))}}n.d(t,{shimGetUserMedia:()=>r})},960057:(e,t,n)=>{"use strict";n.r(t),n.d(t,{shimGetUserMedia:()=>i.shimGetUserMedia,shimGetDisplayMedia:()=>o.shimGetDisplayMedia,shimOnTrack:()=>a,shimPeerConnection:()=>s,shimSenderGetStats:()=>c,shimReceiverGetStats:()=>u,shimRemoveStream:()=>d,shimRTCDataChannel:()=>p,shimAddTransceiver:()=>l,shimGetParameters:()=>h,shimCreateOffer:()=>f,shimCreateAnswer:()=>v});var r=n(786643),i=n(809080),o=n(72365);function a(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function s(e){const t=r.detectBrowser(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})),t.version<68){const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,o]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,o)}}function c(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function u(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),r.wrapPeerConnectionEvent(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function d(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){r.deprecated("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function p(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function l(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function h(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function f(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function v(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}},72365:(e,t,n)=>{"use strict";function r(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}n.d(t,{shimGetDisplayMedia:()=>r})},809080:(e,t,n)=>{"use strict";n.d(t,{shimGetUserMedia:()=>i});var r=n(786643);function i(e){const t=r.detectBrowser(e),n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}},155938:(e,t,n)=>{"use strict";n.r(t),n.d(t,{shimLocalStreamsAPI:()=>i,shimRemoteStreamsAPI:()=>o,shimCallbacksAPI:()=>a,shimGetUserMedia:()=>s,shimConstraints:()=>c,shimRTCIceServerUrls:()=>u,shimTrackEventTransceiver:()=>d,shimCreateOfferLegacy:()=>p,shimAudioContext:()=>l});var r=n(786643);function i(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function o(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function a(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}function s(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(c(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function c(e){return e&&void 0!==e.video?Object.assign({},e,{video:r.compactObject(e.video)}):e}function u(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function d(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function p(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function l(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}},786643:(e,t,n)=>{"use strict";n.d(t,{extractVersion:()=>o,wrapPeerConnectionEvent:()=>a,disableLog:()=>s,disableWarnings:()=>c,log:()=>u,deprecated:()=>d,detectBrowser:()=>p,compactObject:()=>h,filterStats:()=>v});let r=!0,i=!0;function o(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function a(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function s(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function c(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function u(){if("object"==typeof window){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function d(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")}function p(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=o(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=o(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=o(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=o(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function l(e){return"[object Object]"===Object.prototype.toString.call(e)}function h(e){return l(e)?Object.keys(e).reduce((function(t,n){const r=l(e[n]),i=r?h(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function f(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?f(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{f(e,e.get(t),n)}))})))}function v(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&f(e,n,i)}))})),i}}}]);try{stManager.done("dist/3e9fc9c12eadc5ce7d9564e99bf198bc.83c9ef657209e7fc04a1.js")}catch(e){}