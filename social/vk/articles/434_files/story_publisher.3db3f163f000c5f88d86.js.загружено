(()=>{"use strict";var e,t,o,n={416259:(e,t,o)=>{o.d(t,{default:()=>f});var n=o(667294),r=o(887854),i=o.n(r),a=o(408091),s=o(634777),l=o(379333),c="0 0 16 16",d="done_16",u=!1;function h(){u||((0,s.addSpriteSymbol)(new(i())({id:d,viewBox:c,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" id="done_16"><path d="M13.743 3.756a.872.872 0 010 1.237l-7.317 7.25a.88.88 0 01-1.242 0L2.257 9.366a.872.872 0 010-1.237.88.88 0 011.242 0l2.306 2.261L12.5 3.756a.88.88 0 011.242 0z" fill="currentColor" /></symbol>'})),u=!0)}var p=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),n.createElement(l.SvgIcon,(0,a.assign)({},e,{viewBox:c,id:d,width:isNaN(e.width)?16:+e.width,height:isNaN(e.height)?16:+e.height}))};p.mountIcon=h;const f=p},783199:(e,t,o)=>{o.d(t,{default:()=>f});var n=o(667294),r=o(887854),i=o.n(r),a=o(408091),s=o(634777),l=o(379333),c="0 0 16 24",d="chevron_24",u=!1;function h(){u||((0,s.addSpriteSymbol)(new(i())({id:d,viewBox:c,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 24" id="chevron_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h16v24H0z" /><path d="M4.706 7.706a1 1 0 010-1.412l.088-.088a.997.997 0 011.414.002l5.084 5.084a.998.998 0 010 1.416l-5.084 5.084a1.002 1.002 0 01-1.414.002l-.088-.088a.995.995 0 010-1.412L9 12 4.706 7.706z" fill="currentColor" /></g></symbol>'})),u=!0)}var p=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),n.createElement(l.SvgIcon,(0,a.assign)({},e,{viewBox:c,id:d,width:isNaN(e.width)?16:+e.width,height:isNaN(e.height)?24:+e.height}))};p.mountIcon=h;const f=p},495707:(e,t,o)=>{o.d(t,{default:()=>f});var n=o(667294),r=o(887854),i=o.n(r),a=o(408091),s=o(634777),l=o(379333),c="0 0 24 24",d="done_24",u=!1;function h(){u||((0,s.addSpriteSymbol)(new(i())({id:d,viewBox:c,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="done_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9 16.2l-3.5-3.5a.99.99 0 10-1.4 1.4l4.193 4.193a1 1 0 001.414 0L20.3 7.7a.99.99 0 00-1.4-1.4L9 16.2z" fill="currentColor" /></g></symbol>'})),u=!0)}var p=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),n.createElement(l.SvgIcon,(0,a.assign)({},e,{viewBox:c,id:d,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};p.mountIcon=h;const f=p},784977:(e,t,o)=>{o.d(t,{default:()=>f});var n=o(667294),r=o(887854),i=o.n(r),a=o(408091),s=o(634777),l=o(379333),c="0 0 28 28",d="camera_outline_28",u=!1;function h(){u||((0,s.addSpriteSymbol)(new(i())({id:d,viewBox:c,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="camera_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M15.697 2c.52 0 .993.065 1.43.202.458.143.87.364 1.244.665.356.288.673.645.961 1.078l.266.398.134.189c.097.13.162.197.235.258a.767.767 0 00.28.15c.129.038.259.056.578.06h.218c1.192.052 1.871.216 2.587.599A4.271 4.271 0 0125.4 7.37c.445.831.599 1.631.599 3.245v5.975c0 2.183-.203 3.233-.786 4.324a5.543 5.543 0 01-2.3 2.3c-1.091.583-2.14.786-4.324.786H9.41c-2.183 0-3.233-.203-4.324-.786a5.543 5.543 0 01-2.3-2.3c-.553-1.034-.764-2.03-.784-3.988v-6.604c.018-1.421.18-2.172.597-2.952A4.271 4.271 0 014.37 5.6c.691-.37 1.347-.534 2.451-.583l.089-.012L7 5h.175c.32-.004.45-.022.577-.06a.767.767 0 00.28-.15c.104-.085.19-.184.37-.447l.266-.398c.288-.433.605-.79.961-1.078a3.74 3.74 0 011.244-.665c.437-.137.91-.202 1.43-.202h3.394zm0 2h-3.394c-.327 0-.6.037-.832.11a1.74 1.74 0 00-.586.313c-.19.154-.372.36-.553.632l-.304.452c-.27.392-.465.613-.72.824a2.766 2.766 0 01-.98.524c-.34.102-.65.14-1.187.145l-.054.006-.27.012c-.752.039-1.109.133-1.504.345-.412.22-.73.538-.95.95-.269.502-.363.99-.363 2.302v5.975c0 1.881.142 2.62.55 3.38.342.641.839 1.138 1.48 1.48.68.365 1.343.517 2.822.545L9.41 22h9.18l.558-.005c1.479-.028 2.141-.18 2.823-.545a3.543 3.543 0 001.48-1.48c.364-.68.516-1.343.544-2.822L24 16.59v-5.975l-.005-.455c-.021-.98-.123-1.407-.358-1.847a2.271 2.271 0 00-.95-.95c-.431-.23-.82-.325-1.687-.363l-.242-.002c-.476-.008-.769-.047-1.086-.143a2.766 2.766 0 01-.98-.524c-.255-.21-.45-.432-.72-.824l-.304-.452a2.777 2.777 0 00-.553-.632 1.74 1.74 0 00-.586-.313 2.777 2.777 0 00-.832-.11zM14 8.5A5.25 5.25 0 1114 19a5.25 5.25 0 010-10.5zm0 2a3.25 3.25 0 100 6.5 3.25 3.25 0 000-6.5z" fill="currentColor" fill-rule="nonzero" /></g></symbol>'})),u=!0)}var p=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),n.createElement(l.SvgIcon,(0,a.assign)({},e,{viewBox:c,id:d,width:isNaN(e.width)?28:+e.width,height:isNaN(e.height)?28:+e.height}))};p.mountIcon=h;const f=p},629629:(e,t,o)=>{o.d(t,{MAX_STORY_VIDEO_DURATION:()=>a,getStoryUploadUrl:()=>s,uploadStoryBlobToServer:()=>l,saveStoryOnServer:()=>c});var n=o(570655),r=o(917999),i=o(736557),a=16;function s(e){return new Promise((function(t,o){window.ajax.post((0,i.isMvk)()?"stories.php":"al_stories.php",(0,n.__assign)({act:"get_upload_url"},e),{onDone:t,onError:o,onFail:o})}))}function l(e,t){var o=new FormData,n=encodeURIComponent("edited_"+(0,r.irand)(0,99999)+".jpg");return o.append("file0",e,n),fetch(t,{method:"POST",body:o}).then((function(e){return e.json()}))}function c(e,t){return new Promise((function(o,n){window.ajax.post((0,i.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:o,onError:n,onFail:n})}))}},674995:(e,t,o)=>{o.d(t,{default:()=>c});var n=o(570655),r=o(667294),i=o(368284),a=o(791563),s=o(41437),l=o(138671).default;const c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var o=e||(0,s.getLang)("global_error");window.showFastBox({title:(0,s.getLang)("global_error")},o,(0,s.getLang)("global_close"),(function(){t(),window.curBox().hide()}))},t.save=function(e,o,n){var r;void 0===n&&(n={}),t.props.onClickSave(),window.StoryPublisher.saveStory(e,{attachment:JSON.stringify(t.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:t.props.miniAppId,situational_suggest_id:null===(r=t.props.serviceInfo)||void 0===r?void 0:r.situational_suggest_id,analytics:n.analytics,mediaEditorAnalytics:n.mediaEditorAnalytics,hash:n.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},n.storySaveHash).then((function(e){t.onClose(!0,!1,e),o()})).catch((function(e){return t.errorHandler(e,o),!0}))},t.onClose=function(e,o,n){var r,i;if(o)t.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,n);else{(null===(i=null===(r=window.cur.photoEditorStore)||void 0===r?void 0:r.getState())||void 0===i?void 0:i.past.length)>1?(0,a.showFastBox)({title:(0,s.getLang)("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},(0,s.getLang)("photos_pe_story_editor_close_text"),(0,s.getLang)("box_yes"),(function(){t.props.onClose(!1),window.curBox().hide()}),(0,s.getLang)("box_no"),(function(){window.curBox().hide()})):t.props.onClose(!1)}},t}return(0,n.__extends)(t,e),t.prototype.render=function(){var e=this,t=Math.min(900,window.innerHeight-100),o=t/1.78;return r.createElement(l,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},r.createElement(i.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:o,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers,serviceInfo:this.props.serviceInfo}))},t}(r.Component)},854595:(e,t,o)=>{o.d(t,{StoryPublisher:()=>d});var n=o(667294),r=o(973935),i=o(674995),a=o(368893),s=o(621260),l=o(116886),c=o(629629),d={init:function(e,t,o){var n=this;this.onClickSave=t||function(){},this.cb=o,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",o=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?(0,a.sendStat)(a.EVENTS.ADD_STORY_FROM_SHARING):(0,a.sendStat)(a.EVENTS.ADD_STORY);var s=document.querySelector(".StoryPublisher");s||((s=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(s)),r.render(n.createElement(i.default,{entrypoint:t,miniAppId:o,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers,serviceInfo:null==e?void 0:e.serviceInfo}),s)},destroy:function(e,t){var o=document.querySelector(".StoryPublisher");o&&r.unmountComponentAtNode(o),this.cb&&this.cb(e,t),delete window.cur.photoEditorStore,delete window.cur.renderImageFromState,e&&(0,s.showDoneBox)((0,l.getLang)("photos_pe_story_published"))},saveStory:function(e,t,o){return(0,c.getStoryUploadUrl)(t).then((function(t){return(0,c.uploadStoryBlobToServer)(e,t)})).then((function(e){var t=e.response;return(0,c.saveStoryOnServer)(t&&t.upload_result,o)}))}}},727458:(e,t,o)=>{var n=o(854595);window.StoryPublisher=n.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=n,e=[],i.O=(t,o,n,r)=>{if(!o){var a=1/0;for(d=0;d<e.length;d++){for(var[o,n,r]=e[d],s=!0,l=0;l<o.length;l++)(!1&r||a>=r)&&Object.keys(i.O).every((e=>i.O[e](o[l])))?o.splice(l--,1):(s=!1,r<a&&(a=r));if(s){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,n,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},o=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var a={};t=t||[null,o({}),o([]),o(o)];for(var s=2&n&&e;"object"==typeof s&&!~t.indexOf(s);s=o(s))Object.getOwnPropertyNames(s).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,i.d(r,a),r},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.e=()=>Promise.resolve(),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={5198:0};i.O.j=t=>0===e[t];var t=(t,o)=>{var n,r,[a,s,l]=o,c=0;for(n in s)i.o(s,n)&&(i.m[n]=s[n]);if(l)var d=l(i);for(t&&t(o);c<a.length;c++)r=a[c],i.o(e,r)&&e[r]&&e[r][0](),e[a[c]]=0;return i.O(d)},o=self.webpackChunkvk=self.webpackChunkvk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var a=i.O(void 0,[8592,4509,7113,6181],(()=>i(727458)));a=i.O(a)})();