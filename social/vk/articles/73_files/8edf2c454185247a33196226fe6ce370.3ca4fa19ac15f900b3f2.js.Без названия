(window.webpackJsonp=window.webpackJsonp||[]).push([["8edf2c454185247a33196226fe6ce370"],{"7juf":function(e,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return F})),o.d(t,"SimilarGroupsEventLog",(function(){return H}));o("HEwt"),o("a1Th"),o("Btvt"),o("rGqo"),o("rE2o"),o("ioFf"),o("91GP"),o("KKXr");var a=o("Egk5"),i=o("zxIV"),s=o("lXE5"),r=o("gdug"),n=o("t7n3"),l=o("v+DW"),d=o("q1tI"),c=o("i8i4"),g=o("Xu7z"),u=o("4+be"),h=o("FWc3"),_=o("6krn"),b=o("EasH"),m=o("Xrg9");function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],a=!0,i=!1,s=void 0;try{for(var r,n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){i=!0,s=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,a=new Array(t);o<t;o++)a[o]=e[o];return a}function j(){return(j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e}).apply(this,arguments)}var O="groups_edit_event_log",f="groups_edit_event_log",w=/act=a_event_log_extended/i,L=()=>{for(var e=ge("groups_edit_action_log_datepicker"),t=Object(i.domPN)(e),o=[],r=0;r<13;r++)o.push(Object(u.getLang)("month"+r+"_of"));function l(e){var t=e.startDate,a=e.endDate,i=Object(u.langDate)(t,Object(u.getLang)("global_short_date","raw"),0,o,!1),s=Object(u.langDate)(a,Object(u.getLang)("global_short_date","raw"),0,o,!1),r=Object(u.langDate)(t,["","{day} {month} {year}"],0,o,!1),n=Object(u.langDate)(a,["","{day} {month} {year}"],0,o,!1),l=Object(u.langDate)(t,["","{day} {month}"],0,o,!1),d=Object(u.langDate)(a,["","{day} {month}"],0,o,!1);return/\d/.test(i[0])||/\d/.test(s[0])?t.getYear()!==a.getYear()?r===n?r:r+" - "+n:l===d?l:l+" - "+d:i===s?i:i+" - "+s}var h=Object(n.intval)(Object(i.domData)(e,"start_date")),b=Object(n.intval)(Object(i.domData)(e,"end_date")),m={startDate:new Date,endDate:new Date};h&&b&&(m.startDate=new Date(1e3*h),m.endDate=new Date(1e3*b));var p=Object(u.getLang)("groups_edit_filter_all_time");nav.objLoc.start_date&&nav.objLoc.end_date&&(p=l(m)),val(e,p);var v=ce("div",{id:"groups_edit_action_log_datepicker_container"});Object(a.addEvent)(v,"click",e=>{Object(n.isFunction)(e.target.onclick)||window.cancelEvent(e)}),document.body.appendChild(v);var O=()=>{var t=e.getBoundingClientRect().height,o=e.getBoundingClientRect().left,a=e.getBoundingClientRect().top+Object(s.scrollGetY)();setStyle(v,{top:a+t+16+"px",left:o-110+"px",position:"absolute"})},f=!1;function w(t){var o=t.startDate,a=t.endDate;m={startDate:o,endDate:a},val(e,l(t)),window.GroupsEditEventLog.filterDate(m),c.unmountComponentAtNode(v),f=!1}var L=()=>{c.unmountComponentAtNode(v),f=!1},y=()=>{m={startDate:null,endDate:null},val(e,Object(u.getLang)("groups_edit_filter_all_time")),window.GroupsEditEventLog.filterDate(m),c.unmountComponentAtNode(v),f=!1};Object(a.addEvent)(t,"click",()=>{var e,t;f?L():(O(),e=v,t={onClose:y,onDone:w,ranges:{range1:m},minDate:new Date(2007,1)},c.render(d.createElement(g.default,j({closeText:Object(_.getLang)("groups_edit_filter_clear_date"),className:"groups_edit_datepicker",maxDate:new Date},t)),e),f=!0)});var D=o=>{o.target===v||o.target===e||o.target===t||hasClass(o.target,"Panel__arrow--plus")||hasClass(o.target,"Panel__arrow--minus")||L()};Object(a.addEvent)(window,"click",D),Object(a.addEvent)(window,"resize",O),Object(a.addEvent)(window,"scroll",D),cur.destroy.push(()=>Object(a.removeEvent)(window,"click",D)),cur.destroy.push(()=>Object(a.removeEvent)(window,"resize",O)),cur.destroy.push(()=>Object(a.removeEvent)(window,"scroll",D)),cur.destroy.push(()=>x())};var y=(e,t,o)=>(Object(a.cancelEvent)(o),function(e){var t="groups"+e+"Filter";return window.cur[t]||{}}(e).goToLink(t,o,!0),!1),D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=ge(f),a=clone(nav.objLoc);Object(n.each)(e,(e,t)=>{a[e]=t});var s=clone(a);delete s[0],delete s.act,cur.disableAutoMore=!0,o.xhr&&(o.xhr.abort(),delete o.xhr),o.xhr=ajax.post(A()+"?act=event_log",extend(s,{filter:1}),{showProgress(){Object(n.isFunction)(t.showProgress)?t.showProgress():C()},hideProgress(){Object(n.isFunction)(t.hideProgress)?t.hideProgress():T()},onDone(e){if(t.isMore){if(!e)return void I(!1);Object(i.sech)(e).forEach(e=>o.appendChild(e)),Object(n.isFunction)(t.onDone)&&t.onDone()}else nav.setLoc(a),scrollToTop(0),val(o,e);cur.disableAutoMore=!1,S(),window.tooltips&&tooltips.destroyAll(),t.clearAjaxCache&&x(),t.noHideItems&&M()}})},x=()=>{Object(n.each)(window.ajaxCache,e=>{w.test(e)&&delete window.ajaxCache[e]})},E=e=>`${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}`,C=()=>{show(O+"_loader"),hide(O+"_extended_button")},T=()=>{hide(O+"_loader"),show(O+"_extended_button")},k=O+"_more",I=e=>Object(i.toggle)(k,e),P=()=>{if(G(),!r.browser.mobile&&!cur.disableAutoMore){var e=document.documentElement,t=window.innerHeight||e.clientHeight||bodyNode.clientHeight,o=Object(s.scrollGetY)(),a=ge(k);Object(i.isVisible)(a)&&!Object(l.isButtonLocked)(a)&&o+3*t>a.offsetTop&&a.onclick()}},S=()=>{var e,t;e=Object(i.domLC)(ge(f)),t=Object(i.domData)(e,"date"),I(!!t),P(),G()},B=()=>{Object(a.removeEvent)(window,"scroll",P),Object(a.removeEvent)(window,"resize",P)},N=e=>{var t="";return e.forEach(e=>{t+=(e=>{var t="";e.fields.forEach(e=>{e.text?t+=Object(n.getTemplate)("eventLogItemFieldText",e):e.title?t+=Object(n.getTemplate)("eventLogItemFieldTitle",e):t+=Object(n.getTemplate)("eventLogItemField",e)});var o="";e.counter>1&&(o=Object(n.getTemplate)("eventLogItemRowCounter",{counter:e.counter}));var a="";e.photo&&(a=Object(n.getTemplate)("eventLogItemRowPhoto",{link:e.link,photo:e.photo,counter:o}));var i=e.id+(e.additional?"_main":""),s=Object(n.getTemplate)("eventLogItemRow",{date:e.date,row_id:i,actions:e.actions,fields:t,photo:a});return e.additional&&(s=Object(n.getTemplate)("eventLogItem",{id:e.id,item:s,additional:e.additional})),s})(e)}),t},G=()=>{var e=ge(O);if(e){var t=Object(s.scrollGetY)()+42,o=ge(O+"_controls"),a=window.innerHeight;if(e.scrollHeight<=a)Object(i.toggleClass)(o,O+"_controls_fixed",!1);else{var r=geByClass("_groups_edit_event_log_title",e),l=Object(i.getXY)(Object(i.domPN)(o))[1];if(Object(i.toggleClass)(o,O+"_controls_fixed",l<=t),r&&r.length){var d=!1,c=!1;for(var g in t+=47,r){if(Object(i.getXY)(r[g])[1]>=t)break;d=r[g];var u=Object(n.intval)(g)+1;c=!!r[u]&&Object(i.getXY)(r[u])[1]-t}var h=(e,t)=>{Object(i.toggleClass)(e,O+"_title_fixed",t),setStyle(e,{left:t?Object(i.getXY)(Object(i.domPN)(e))[0]:null}),!1===t&&Object(i.removeClass)(e,O+"_title_animating")};if(d){var _=Object(i.domFC)(d);d===e.fixedTitleWrap?setTimeout(()=>h(e.fixedTitle,!0)):(e.fixedTitle&&h(e.fixedTitle,!1),e.fixedTitle=_,h(_,!0),e.fixedTitleWrap=d);var b=!1!==c?c-48:0;b>=0&&(b=0),Object(n.intval)(Object(i.getStyle)(e.fixedTitle,"top"))!==b?(setStyle(e.fixedTitle,{top:b}),Object(i.addClass)(e.fixedTitle,O+"_title_animating")):Object(i.removeClass)(e.fixedTitle,O+"_title_animating")}else e.fixedTitle&&(h(e.fixedTitle,!1),e.fixedTitle=!1,e.fixedTitleWrap=!1)}}}},A=()=>nav.objLoc[0],M=()=>{var e=ge(f),t=JSON.parse(Object(i.domData)(e,"toggled")||"{}")||{};t&&(Object(n.each)(t,e=>{ge(`${O}_item_wrap${e}`)?window.GroupsEditEventLog.toggleItems(e):delete t[e]}),Object(i.domData)(e,"toggled",JSON.stringify(t)))};class F{showMore(){if(nav.objLoc.start_date&&nav.objLoc.end_date)I(!1);else{var e=Object(i.domLC)(ge(f)),t=Object(i.domData)(e,"date");if(!t)return I(!1);D({more_from:t},{showProgress:()=>Object(l.lockButton)(k),hideProgress:()=>Object(l.unlockButton)(k),isMore:!0,onDone(){var e=Object(i.domLC)(ge(f));Object(i.domData)(e,"date")===t&&I(!1)}})}}showToggleItemsTitle(e,t){var o=Object(i.domPN)(Object(i.domPN)(e)),a="";if(hasClass(o,O+"_item_wrap_active")){a=Object(u.getLang)("groups_edit_filter_hide");var s=geByClass1(t+"_additional",o);JSON.parse(Object(i.domData)(s,"additional")).length>1&&(a=Object(u.getLang)("groups_edit_filter_hide_all"))}else a=Object(u.getLang)("groups_edit_filter_more");Object(h.showTitle)(e,a,[-8,1,1],{needLeft:!0,className:O+"_tooltip_item"})}showExtendedButtonTitle(e){var t=Object(n.intval)(Object(i.domData)(e,"mode")),o="";1===t?o=Object(u.getLang)("groups_edit_action_log_simple_tooltip"):0===t&&(o=Object(u.getLang)("groups_edit_action_log_extended_tooltip")),Object(h.showTitle)(e,o,[-16,7,1],{needLeft:!0,className:O+"_tooltip"})}toggleItems(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=ge(`${O}_item_wrap${e}`);if(t&&t.target&&!o){var r=t.target;if(geByClass1(e+"_toggle",s)!==r&&("a"===r.nodeName.toLowerCase()||r.onclick||r.mousedown||r.mouseup||hasClass(r,"_no_toggle")))return;Object(a.cancelEvent)(t)}window.tooltips&&tooltips.destroyAll();var d=O+"_item_wrap_active",c=O+"_item_wrap_loading",g=O+"_item_wrap_focused",u=geByClass1(e+"_more",s),h=geByClass1(e+"_additional",s),_=geByClass1(e+"_content",s),b=JSON.parse(Object(i.domData)(h,"additional")),m=b.length,p=geByClass1(e+"_more_loader",s);if(!p.loading)if(u.inited||(u.inited=!0,Object(a.addEvent)(u,"click",()=>this.toggleItems(e,!1,!0))),!o&&hasClass(Object(i.domPN)(s),O+"_list")&&((e,t)=>{var o=ge(f),a=JSON.parse(Object(i.domData)(o,"toggled")||"{}")||{};t?a[e]||(a[e]=1):a[e]&&delete a[e],Object(i.domData)(o,"toggled",JSON.stringify(a))})(e,!hasClass(s,d)),!hasClass(s,d)||o){if(hasClass(s,c))return;h.page||(h.page=0);var v=b[h.page],j=()=>{var e=h.page<m;Object(i.toggle)(u,e),Object(i.toggle)(p,e)};j(),ajax.post(A()+"?act=a_event_log_extended",{hash:v[0],rows:JSON.stringify(v[1]),mode:Object(n.intval)(nav.objLoc.mode)},{cache:1,showProgress:()=>{o?(Object(l.showProgress)(p),p.loading=!0):Object(i.addClass)(s,c)},hideProgress:()=>{o?(Object(l.hideProgress)(p),p.loading=!1):Object(i.removeClass)(s,c)},onDone:e=>{Object(i.addClass)(s,d),h.page++,j(),isArray(e)&&(e=N(e)),o?Object(i.sech)(e).forEach(e=>_.appendChild(e)):(val(_,e),Object(i.addClass)(s,g),s.timeout&&(clearTimeout(s.timeout),delete s.timeout),s.timeout=setTimeout(()=>Object(i.removeClass)(s,g),1500))}})}else h.page=0,Object(i.removeClass)(s,d),Object(i.removeClass)(s,c)}toggleExtended(e){var t=1===Object(n.intval)(Object(i.domData)(e,"mode"))?0:1,o=O+"_extended_button_simple";1===t?Object(i.addClass)(e,o):Object(i.removeClass)(e,o),Object(i.domData)(e,"mode",t),D({mode:t},{clearAjaxCache:!0,noHideItems:!0})}filterDate(e){var t=e.startDate?E(e.startDate):null,o=e.endDate?E(e.endDate):null;D({start_date:t,end_date:o})}filterRole(e,t,o){return D({role:o}),y("Role",e,t)}filterActionType(e,t,o){return D({action_type:o}),y("ActionType",e,t)}viewPhoto(e){var t=`<img src="${p(e,1)[0]}" width="100%" height="auto" />`;Object(b.showFastBox)({title:Object(u.getLang)(O+"_photo_view_title"),width:700},t)}init(){L(),Object(a.addEvent)(window,"scroll",P),Object(a.addEvent)(window,"resize",P),cur.destroy.push(B),S()}restoreItem(e,t){if(e.loading)return!1;var o=Object(i.domPN)(e),a=geByClass1("_action_loader",o),s=Object(i.domData)(e,"action"),r=Object(i.domData)(e,"hash"),d=Object(n.intval)(nav.objLoc.mode),c=ge(`${O}_item_row${t}`);ajax.post(A()+"?act=a_restore_event_log_item",{action:s,hash:r,mode:d},{showProgress:()=>{e.loading=!0,Object(l.showProgress)(a)},hideProgress:()=>{e.loading=!1,Object(l.hideProgress)(a)},onDone(e){x();var t=se(N(e));domReplaceEl(c,t)}})}}class H{constructor(e){this.groupId=e,this.sendLogsTimeout=null,this.sendLogsProcess=!1,this.localStorageKey="groups_recommends",this.logsDataDelimiter="|"}sendLogs(){clearTimeout(this.sendLogsTimeout),this.sendLogsTimeout=setTimeout(this.sendLogsAccept.bind(this),3e3)}sendLogsAccept(){if(!this.sendLogsProcess){var e=this.getLogs(!0);e.length&&(this.sendLogsProcess=!0,this.clearLogs(),ajax.post("al_groups.php",{act:"a_recommends_logs",logs:e},{onDone:()=>{this.sendLogsProcess=!1},onFail:()=>(this.restoreLogs(e),this.sendLogsProcess=!1,!0)}))}}restoreLogs(e){var t=this.getLogs(),o=[...e.map(e=>e.split(this.logsDataDelimiter)),...t];m.default.set(this.localStorageKey,o)}getLogs(e){var t=m.default.get(this.localStorageKey)||[];return e&&(t=t.map(e=>e.join(this.logsDataDelimiter))),t}addLog(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],r=this.getLogs();r.push([this.groupId,e,t,o,a,i,s]),m.default.set(this.localStorageKey,r),this.sendLogs()}clearLogs(){m.default.remove(this.localStorageKey)}}},TSYQ:function(e,t,o){var a;!function(){"use strict";var o={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var s=typeof a;if("string"===s||"number"===s)e.push(a);else if(Array.isArray(a)&&a.length){var r=i.apply(null,a);r&&e.push(r)}else if("object"===s)for(var n in a)o.call(a,n)&&a[n]&&e.push(n)}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(a=function(){return i}.apply(t,[]))||(e.exports=a)}()},qJqe:function(e,t,o){"use strict";o.r(t),o.d(t,"EVENT_OPEN_GROUP",(function(){return l})),o.d(t,"EVENT_OPEN_BLOCK",(function(){return d})),o.d(t,"EVENT_HIDE_BLOCK",(function(){return c})),o.d(t,"ACTION_ENTER",(function(){return g})),o.d(t,"ACTION_LEAVE",(function(){return u})),o.d(t,"OPEN_BLOCK_MODE_SUBSCRIBE",(function(){return h})),o.d(t,"OPEN_BLOCK_MODE_FROM_MENU_ITEM",(function(){return _})),o.d(t,"SimilarGroups",(function(){return b}));var a=o("v+DW"),i=o("EasH"),s=o("4+be"),r=o("D1OX"),n=o("7juf"),l="open_group",d="open_group_block",c="hide_group_block",g="enter",u="leave",h="subscribe",_="menu_item";class b{init(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.ownerId=e,this.isEvent=t,this.hash=o,this.block=document.querySelector(".similar_groups_block"),this.block_title=document.querySelector(".similar_groups_block__title"),this.initGalleryBlock(),this.initMenuItem(),this.eventLog=new n.SimilarGroupsEventLog(Math.abs(this.ownerId)),this.issetSimilarGroups()&&isVisible(this.block)&&this.initGallery()}reInit(){this.init(this.ownerId,this.isEvent,this.hash)}initMenuItem(){this.menuItem=document.querySelector(".page_menu_group_similar_recommends"),this.updateMenuItemText()}updateMenuItemText(){null!==this.menuItem&&(isVisible(this.block)?this.menuItem.textContent=Object(s.getLang)("groups_similar_recommends_hide_menu_item"):this.isEvent?this.menuItem.textContent=Object(s.getLang)("groups_similar_events_show_menu_item"):this.menuItem.textContent=Object(s.getLang)("groups_similar_recommends_show_menu_item"))}issetSimilarGroups(){return null!==this.block&&null!==this.menuItem}initGalleryBlock(){this.gallery=document.querySelector(".similar_community_gallery")}initGallery(){null!==this.gallery&&new r.UIGallery(this.gallery)}toggleBlock(){this.issetSimilarGroups()&&(isVisible(this.block)?this.hide():this.show(_))}toggleSubscribeGroup(e,t,o){var a=e.closest(".wall_card"),r=a.dataset.action,n=a.dataset.in_group;if("0"!==a.dataset.group_closed&&"0"!==n&&r!==g)var l=Object(i.showFastBox)({title:Object(s.getLang)("global_warning"),bodyStyle:"padding: 20px; line-height: 160%;"},Object(s.getLang)("groups_group_leave2"),Object(s.getLang)("group_leave_group"),()=>{l.hide(),this._toggleSubscribeGroup(e,t,o)},Object(s.getLang)("global_cancel"));else this._toggleSubscribeGroup(e,t,o);t.preventDefault()}_toggleSubscribeGroup(e,t,o){var r=e.closest(".wall_card"),n=r.dataset.action,l=-r.dataset.group_id,d=n===g?"al_feed.php":"al_fans.php",c={act:n===g?"subscr":"unsub",hash:o,from:"similar_groups"};n===g?c.oid=l:c.id=l,this.eventLog.addLog(n,this.block.dataset.open_mode,r.dataset.index,Math.abs(l),r.dataset.add),ajax.post(d,c,{onDone(t){n===g?(e.classList.add("secondary"),r.dataset.action=u):(e.classList.remove("secondary"),r.dataset.action=g),e.innerHTML=t},onFail(e){if(e)return Object(i.showFastBox)({title:Object(s.getLang)("global_error"),onHide:nav.reload,bodyStyle:"padding: 20px; line-height: 160%;"},e),!0},showProgress:()=>Object(a.lockButton)(e),hideProgress:()=>Object(a.unlockButton)(e)})}show(e){this.issetSimilarGroups()&&(this.block.dataset.open_mode=e,this.isEvent?this.block_title.textContent=Object(s.getLang)("groups_similar_events_recommendations_title"):this.block_title.textContent=Object(s.getLang)("groups_similar_recommendations_title"),null===this.gallery?ajax.post("al_groups.php",{act:"a_recommends_get",owner_id:this.ownerId,hash:this.hash},{onDone:e=>{this.block.insertAdjacentHTML("beforeend",e),this.showBlock()},onFail(e){if(e)return Object(i.showFastBox)({title:Object(s.getLang)("global_error"),bodyStyle:"padding: 20px; line-height: 160%;"},e),!0},showProgress:Page.actionsDropdownLock.pbind(this.menuItem),hideProgress:Page.actionsDropdownUnlock.pbind(this.menuItem)}):this.showBlock())}showBlock(){show(this.block),this.initGalleryBlock(),this.initGallery(),this.updateMenuItemText();var e=[];this.gallery.querySelectorAll(".ui_gallery_item").forEach(t=>e.push(t.dataset.group_id)),this.eventLog.addLog(d,this.block.dataset.open_mode,-1,-1,"",e)}hide(){this.issetSimilarGroups()&&(hide(this.block),this.updateMenuItemText(),this.eventLog.addLog(c,this.block.dataset.open_mode),ajax.post("al_groups.php",{act:"a_recommends_hide",owner_id:this.ownerId,hash:this.hash}))}clickOnGroup(e,t){t.target.closest(".similar_group_subscribe")||this.eventLog.addLog(l,this.block.dataset.open_mode,e.dataset.index,e.dataset.group_id,e.dataset.add)}delRefFromUrl(){nav.objLoc&&"similar_groups_block"===nav.objLoc.from&&(delete nav.objLoc.from,nav.setLoc(nav.objLoc))}}}}]);try{stManager.done("cmodules/bundles/8edf2c454185247a33196226fe6ce370.3ca4fa19ac15f900b3f2.js")}catch(e){}