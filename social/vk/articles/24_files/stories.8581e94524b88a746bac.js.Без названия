!function(e){function t(t){for(var o,n,a=t[0],c=t[1],l=t[2],u=0,p=[];u<a.length;u++)n=a[u],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&p.push(r[n][0]),r[n]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(d&&d(t);p.length;)p.shift()();return s.push.apply(s,l||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],o=!0,a=1;a<i.length;a++){var c=i[a];0!==r[c]&&(o=!1)}o&&(s.splice(t--,1),e=n(n.s=i[0]))}return e}var o={},r={"web/stories":0},s=[];function n(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=o,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js/cmodules/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var d=c;s.push([256,"bundles/audioplayer","bundles/common","bundles/vendors"]),i()}({"+/AQ":function(e,t,i){"use strict";i.r(t),i.d(t,"getNativeOption",(function(){return r})),i.d(t,"setNativeOption",(function(){return s})),i.d(t,"createScroll",(function(){return l}));var o=i("ofcU");function r(e,t){return bodyNode[e]||document.documentElement[e]}function s(e,t,i){"scrollTop"===e&&window.scrollTo(0,t)}class n{constructor(e,t){this.el=e,this.opts=t,this.module=Object(o.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return r("scrollTop",this.el);s("scrollTop",e,this.el)}contHeight(){return r("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-i<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},i=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),i=t-this.prevScroll,o=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-i,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&o-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(o.destroyModule)(this.module)}}class a{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var i=this.scrollTop(),o=this.prevTop-i;this.prevTop=i,t.scrollChange&&t.scrollChange(i),t.onScroll&&t.onScroll(o,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class c{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function l(e,t){return t.noScroll?new c(e):t.nativeScroll?new n(e,t):new a(e,t)}},"0PSK":function(e,t,i){"use strict";i.r(t);var o=i("q1tI"),r=i.n(o);t.default=r.a.createContext(null)},"0Rlc":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class a extends o.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,i=e.checked,a=e.disabled,c=e.indeterminate,l=e.name,d=e.id,u=n(e,["children","checked","disabled","indeterminate","name","id"]),p=Object(r.classNames)("CheckBox",u.className,{"CheckBox--disabled":a,"CheckBox--indeterminate":c});return o.createElement("label",{className:p},o.createElement("input",s({},u,{className:"CheckBox__input",id:d,type:"checkbox",checked:i,name:l,disabled:a,onChange:this.onChange})),o.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,i){"use strict";i.r(t);i("91GP");var o=i("q1tI"),r=(i("17x9"),i("r7nW")),s=i("6aSF"),n=i("pemR");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}var c=e=>{var t=e.title,i=e.onClose,r=e.appearance,s=Object(n.classNames)("Modal__header","Modal__header--"+r);return o.createElement("div",{className:s},o.createElement("div",{className:"Modal__headerInner"},o.createElement("h1",{className:"Modal__headerTitle"},t),o.createElement("button",{className:"Modal__headerCross",type:"button",onClick:i},"Закрыть")))};c.defaultProps={appearance:"white"};var l=e=>{var t=e.children;return e.hasScroll?o.createElement(s.default,{className:"Modal__body"},t):o.createElement("div",{className:"Modal__body"},t)};l.defaultProps={children:null,hasScroll:!0};var d=e=>{var t=e.className,i=e.appearance,s=e.title,c=e.actionButtons,l=e.onClose,u=e.children,p=e.footerHint,_=e.hasScroll,h=Object(n.classNames)("Modal","Modal--"+i,t);return o.createElement(r.default,a({},e,{className:h}),o.createElement(d.Header,{title:s,onClose:l,appearance:i}),Boolean(u)&&o.createElement(d.Body,{hasScroll:_},u),o.createElement(d.Footer,{actionButtons:c,hint:p}))};d.Header=c,d.Body=l,d.Footer=e=>{var t=e.actionButtons,i=e.hint;return o.createElement("div",{className:"Modal__footer"},o.createElement("div",{className:"Modal__footerInner"},i&&o.createElement("div",{className:"Modal__footerHint"},i),t))},d.defaultProps=a({},r.default.defaultProps,{appearance:"white",hasScroll:l.defaultProps.hasScroll}),t.default=d},"16Al":function(e,t,i){"use strict";var o=i("WbBG");function r(){}function s(){}s.resetWarningCache=r,e.exports=function(){function e(e,t,i,r,s,n){if(n!==o){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var i={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:r};return i.PropTypes=i,i}},"17x9":function(e,t,i){e.exports=i("16Al")()},"22MJ":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=i("pemR"),s=i("dLHM");function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class c extends o.Component{constructor(){super(...arguments),this.getRef=e=>{this.element=e&&e.element}}render(){var e=this.props,t=e.className,i=a(e,["className"]);return o.createElement(s.default,n({},i,{className:Object(r.classNames)(t,"BlockSearchInput"),ref:this.getRef}))}}c.defaultProps=s.default.defaultProps},256:function(e,t,i){e.exports=i("uXyw")},"4Ch9":function(e,t,i){"use strict";i.r(t),i.d(t,"ID_ASHVETS",(function(){return u})),i.d(t,"ID_NSHKARUBA",(function(){return p})),i.d(t,"ID_PKALAYDIN",(function(){return h})),i.d(t,"CONSOLE_CUSTOM_NUM_FIELD",(function(){return m})),i.d(t,"init",(function(){return v})),i.d(t,"getParams",(function(){return k})),i.d(t,"setOption",(function(){return j})),i.d(t,"setUid",(function(){return T})),i.d(t,"setIp",(function(){return L})),i.d(t,"setUaHash",(function(){return B})),i.d(t,"setSpamtype",(function(){return M})),i.d(t,"setConditions",(function(){return I})),i.d(t,"setThreshold",(function(){return x})),i.d(t,"composeSearchLinkFromParams",(function(){return P})),i.d(t,"getNumericField",(function(){return D})),i.d(t,"getConditionsHint",(function(){return H})),i.d(t,"switchParams",(function(){return W})),i.d(t,"conditionsClear",(function(){return U})),i.d(t,"optionClear",(function(){return V})),i.d(t,"addPatternPart",(function(){return q})),i.d(t,"mount",(function(){return Q}));i("pIFo"),i("Vd3H"),i("rGqo"),i("Btvt"),i("HEwt"),i("SRfc");var o,r,s,n=i("ofcU"),a=i("b8yN"),c=i("awNS"),l=i("t7n3"),d=i("W28y"),u=1576215,p=138305184,_=163176673,h=143978,m="custom";function v(e){var t=e.conditions;t&&(ls.set(K(""),t),addClass(geByClass("conditions_clear_button")[0],"highlighted"));var i=e.conditions2;i&&(ls.set(K("2"),i),addClass(geByClass("conditions_clear_button")[1],"highlighted"))}function f(){return hasClass(c.consoleWrap,"console_locked")}function g(){f()||addClass(c.consoleWrap,"console_locked"),removeClass(c.consoleWrap,"console_show_message")}function b(){var e=geByClass1("_apply_pattern",c.patternWrap),t=geByClass1("_search_reports",c.patternWrap);f()&&removeClass(c.consoleWrap,"console_locked"),unlockButton(e),unlockButton(t)}function y(e,t){var i=geByClass1("_console_error",c.consoleWrap),o=geByClass("console_item");i.innerHTML="",e||(e="");var r=ce("div");e&&(r.innerHTML=e),r.className=t?"error":"info_msg",e.match(/\/pattern[0-9]+/)&&o&&o.forEach((function(e){e.className="console_item red_item"})),addClass(c.consoleWrap,"console_show_message"),i.appendChild(r),b()}function w(e){o&&clearTimeout(o),o=setTimeout(()=>{domData(c.consoleWrap,"failed",0)},3e3),domData(c.consoleWrap,"failed",1),console.error(e),y(e,!0)}function S(){var e=ge("queries",c.consoleWrap);return geByClass1("_queries_toggle",c.consoleWrap).innerHTML=isVisible(e)?"Показать запросы":"Скрыть запросы",toggle(e)}function k(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[],i=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i={},o=function(e){var t="conditions_input"===e.id?domPS(e):domNS(e);return hasClass(t,"option_cleared")},r=function(t){return e&&o(t)};i["type"+t]=cur["uiSpamtype"+t].val();var s=ge("pattern_input"+t);i["pattern"+t]=r(s)?E(s):s.value,i["threshold"+t]=ge("threshold_input"+t).value;var n=ge("uid_input"+t);i["uid"+t]=r(n)?E(n):n.value;var a=ge("ip_input"+t);i["ip"+t]=r(a)?E(a):a.value;var c=ge("uahash_input"+t);i["uahash"+t]=r(c)?E(c):c.value;var l=ge("time_start_input"+t);i["time_start"+t]=r(l)?E(l):l.value;var d=ge("time_finish_input"+t);i["time_finish"+t]=r(d)?E(d):d.value;var u=ge("conditions_input"+t);return i["conditions"+t]=r(u)?ls.get(K(t)):u.value,i},o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=[];Array.from(geByClass("option_cleared",e)).forEach((function(e){var t=geByTag1("input",domPN(e))||geByTag1("textarea",domPN(e));i.push(t.id)}));var o=[];return i.forEach(e=>{switch(e){case"pattern_input"+t:o|=cur.hideFieldsBitMasks.substring;break;case"ip_input"+t:o|=cur.hideFieldsBitMasks.ip;break;case"uahash_input"+t:o|=cur.hideFieldsBitMasks.uaHash;break;case"uid_input"+t:o|=cur.hideFieldsBitMasks.uid;break;case"time_finish_input"+t:o|=cur.hideFieldsBitMasks.timeFinish;break;case"time_start_input"+t:o|=cur.hideFieldsBitMasks.timeStart;break;case"conditions_input"+t:o|=cur.hideFieldsBitMasks.conditions}}),o};t.simplify=cur.uiSimplify.val(),t.duration=cur.uiDuration.val(),t.bantype=cur.uiBan.val(),t.search_period=cur.uiSearchPeriod.val();var r=cur.uiSearchPeriod.selectedItems();return r&&r.length>0&&(t.period_in_seconds=3===r[0].length&&1===r[0][2]?1:0),t.comment=ge("comment_input").value,t.all_actions=isChecked("all_actions")||!1,t.notbannedonly=isChecked("not_banned_only")||!1,t.linksonly=isChecked("links_only")||!1,t.wrap_actions=null===ge("wrap_actions")?1:isChecked("wrap_actions"),t.encode_entities=null===ge("encode_entities")?1:isChecked("encode_entities"),t.hidden_fields=o(geByClass1("pattern_part_root")),extend(t,i(e,"")),z()&&(t.hidden_fields2=o(geByClass1("pattern_part_child"),"2"),extend(t,i(e,"2"))),t}function E(e){return domData(e,"restore")}function O(e,t){return domData(e,"restore",t)}function C(){var e=ge("pattern_input"),t=geByClass1("_search_reports",c.patternWrap),i=k();if(!e.value)return scrollToTop(0),void notaBene(e);isButtonLocked(t)||(g(),lockButton(t),r&&(tooltips.destroy(r.el),r=!1),i.act="a_console_find_actions",ajax.post("noSpam.php",i,{onDone:e=>function(e){b(),geByClass1("_console",c.consoleWrap).innerHTML=e;var t=geByClass1("_console_numfield_ip1024",c.consoleWrap);t&&new InlineDropdown(t,{items:[[256,"/24 - 256"],[1024,"/22 - 1024"],[4096,"/20 - 4096"],[16384,"/18 - 16k"],[65536,"/16 - 65k"],[262144,"/14 - 262k"],[1048576,"/12 - 1kk"]],selected:256,withArrow:!0,keepTitle:!0,autoShow:!0,autoHide:300,onSelect:e=>D("ip"+e)})}(e),onFail:e=>w(e)}))}function j(e,t){"string"==typeof t&&(t=clean(t)),val(e,t),V(!1,ge(e),"reset")}function T(e){j("uid_input",e)}function L(e){j("ip_input",e)}function B(e){j("uahash_input",e)}function M(e){cur.uiSpamtype.selectItem(e)}function I(e,t){0!==e.length&&(ge("conditions_input").value+=ge("conditions_input").value?" "+(t?"||":"&&")+" "+e:e),U("reset")}function x(e){j("threshold_input",e)}function P(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(e=k(!0));var t=Object.keys(e);t.sort();for(var i=[],o=0;o<t.length;o++){var r=t[o],s=e[r];i.push(encodeURIComponent(r)+"="+encodeURIComponent(s))}return"/noSpam?"+i.join("&")}function R(){var e=P(),t=geByClass1("_get_pattern_link");t&&t.tt&&t.tt.destroy(),addClass(t,"progress"),ajax.post("noSpam.php",{act:"get_search_link",link:e},{onDone:function(e){removeClass(t,"progress"),showTooltip(t,{text:e,slide:15,center:1,black:1,nohide:1,hidedt:400,shift:[0,2,0],onShowEnd:()=>{(0,window.selectText)("shorten_link"),setTimeout(t.tthide,3e3)}})},onFail:function(e){removeClass(t,"progress"),topError(e,{dt:5})}})}function N(){var e=geByClass1("debug_pattern",c.patternWrap);if(!isButtonLocked(e)){var t=extend(k(),{act:"debug_pattern"});g(),ajax.post("noSpam.php",t,{onDone:e=>y(e),onFail:e=>w(e)})}}function D(e,t){var i=isChecked("values_hist"),o=k();o.need_hist=i,o.act="numeric_field",o.field=e,o.custom_condition=t||"",cur.numFieldSel=e,ajax.post("noSpam.php",o,{onDone:function(o,r){var s=clean(t||e);showFastBox({width:i?330:710,title:s,dark:1,containerClass:"nospam_hist_wrap",hideButtons:i},o).evalBox(r)},progress:"console_query_fields_progress"})}function A(e){s=e,geByClass1("_nospam_console_custom_num_condition_patterns").innerHTML=e}function H(e){var t=2===e?cur.uiSpamtype2.val():cur.uiSpamtype.val();return showBox("noSpam.php",{act:"conditions_hint",spamtype:t},{dark:1,containerClass:"nospam_hint_wrap"})}function F(){var e=k(),t=geByClass1("_apply_pattern",c.patternWrap);e.act="apply_pattern",isButtonLocked(t)||null===document.querySelector(".console_failed_queries")&&(g(),lockButton(t),ajax.post("noSpam.php",e,{onDone:e=>y(e),onFail:e=>w(e)}))}function W(e){["pattern_input","threshold_input","ip_input","uahash_input","time_finish_input","time_start_input","conditions_input"].forEach(e=>{var t=ge(e).value;ge(e).value=ge(e+"2").value,ge(e+"2").value=t});var t=cur.uiSpamtype.val();cur.uiSpamtype.selectItem(cur.uiSpamtype2.val()),cur.uiSpamtype2.selectItem(t),toggleClass(e,"switched")}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`nospam_conditions${e}_${vk.id}`}function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=ge("conditions_input"+t),o="option_cleared",r=domPS(i),s=function(){var e=i.value;ls.set(K(t),e),i.value="",e&&addClass(r,o)},n=function(){var e=ls.get(K(t));removeClass(r,o),removeClass(r,"highlighted"),e&&(ls.remove(K(t)),i.value=e)},a=function(){removeClass(r,o),removeClass(r,"highlighted"),ls.remove(K(t))};switch(e){case"clear":hasClass(r,o)?n():s();break;case"reset":a()}}function V(e,t,i){var o=ge(t),r=hasClass(e,"option_cleared");function s(i){var o=val(i);switch(O(i,o),t){case"pattern_input":case"pattern_input2":val(i,"/"),cur.uiSimplify.selectItem(32);break;case"threshold_input":case"threshold_input2":val(i,i.value&&"2"===i.value?"1":"2");break;default:val(i,"")}o&&addClass(e,"option_cleared")}switch(i){case"clear":r?function(){switch(t){case"threshold_input":case"threshold_input2":s(o);break;default:r&&(o.value=E(o))}removeClass(e,"option_cleared"),removeClass(e,"highlighted")}():s(o);break;case"reset":!function(){var e=geByClass1("option_clear",o.parentNode);O(o,""),removeClass(e,"option_cleared"),removeClass(e,"highlighted")}();break;case"reset_all":geByClass("option_clear").forEach((function(e){O(ge(e.getAttribute("data-option")),""),removeClass(e,"option_cleared"),removeClass(e,"highlighted")}))}}function z(){var e=geByClass1("_pattern_part_child");if(!isVisible(e))return!1;for(var t=geByClass("cloneable_input",e),i=0;i<t.length;i++)if(val(t[i]))return!0;return!1}function q(){var e=geByClass1("pattern_wrap");hasClass(e,"pattern_composite")?removeClass(e,"pattern_composite"):addClass(e,"pattern_composite")}function G(){}function Y(e){var t=ge(document.activeElement);if(e.altKey)switch(-1!==[49,50,51,52,53,67,70,83].indexOf(e.keyCode)&&t&&t.blur(),e.keyCode){case 83:Object(c.activeTab)()===c.tabPattern?C():Object(c.activeTab)()===c.tabReports&&Object(a.prepareReport)(Object(a.activeReportsType)(),Object(a.activeSubReportsType)());break;case 70:if(-1!==[u,p,_].indexOf(vk.id))return F();break;case 67:U("clear"),cur.conditions.deselectTemplate();break;case 49:cur.uiSearchPeriod.selectItem(1);break;case 50:cur.uiSearchPeriod.selectItem(24);break;case 51:cur.uiSearchPeriod.selectItem(72);break;case 52:cur.uiSearchPeriod.selectItem(240);break;case 53:cur.uiSearchPeriod.selectItem(2160)}}function Q(){var e=window.pageNode,t=window.browser.msie6?e:window,i=geByClass1("_pattern_buttons",c.patternWrap),o=Object(n.createModule)({handlers:(e,o)=>{o(i,"click","_search_reports",C),o(i,"click","_apply_pattern",F),o(i,"click","_get_pattern_link",R),o(i,"click","debug_pattern",N),o(c.consoleWrap,"click","_queries_toggle",S),o(c.consoleWrap,"click","_console_linkfield_action",e=>function(e){var t=domData(e.target,"field"),i=showFastBox.pbind({width:710,title:t,dark:1}),o=k();o.act="link_field",o.field=t,ajax.post("noSpam.php",o,{onDone:i,progress:"console_query_fields_progress"})}(e)),o(c.consoleWrap,"click","_console_numfield_action",e=>{var t=e.target,i=domData(t,"field");i!==m?D(i):function(e){var t="nospam_console_custom_num_condition",i=()=>{var e=ge("nospam_console_custom_num_condition"),t=val(e);if(t){var i={act:"a_numeric_field_add_condition",custom_condition:t};ajax.post("noSpam.php",i,{onDone:A.pbind()}),D(m,t)}else notaBene(e)},o={className:"nospam_console_custom_num_condition_wrap",text:getTemplate("nospam_console_custom_num_condition"),forcetodown:1,nohide:1,forceNoHide:1,shift:[10,8],showdt:0,onShowEnd:()=>{elfocus(ge("nospam_console_custom_num_condition"))},onShowStart:()=>{val("nospam_console_custom_num_condition",ls.get(t)||"")},init:o=>{r=o;var s=ge("nospam_console_custom_num_condition");addEvent(s,"keypress",e=>onEnter(i,e)),addEvent(s,"keyup",()=>ls.set(t,val(s)));var n=geByClass1("_nospam_console_custom_num_condition_close",domPN(s));addEvent(n,"click",()=>e.tthide())}};r?(r.show(),i()):showTooltip(e,o),s&&A(s)}(t)}),o(t,"click","_nospam_console_custom_num_condition_pattern",e=>{var t=e.target,i=Object(l.unclean)(domData(t,"pattern"));val("nospam_console_custom_num_condition",i)}),o(t,"click","_nospam_console_custom_num_condition_clear",e=>{var t=e.target,i={act:"a_numeric_field_delete_condition",custom_condition:Object(l.unclean)(domData(t,"pattern"))};ajax.post("noSpam.php",i,{onDone:A.pbind()})}),o(c.consoleWrap,"click","console_set_range",e=>{var t=e.target,i=domData(t,"time");i<0?j("time_finish_input",-i):i>0&&function(e){j("time_start_input",e)}(i)}),o(c.consoleWrap,"click","console_uid",e=>{if(e&&e.altKey){var t=clean(e.target.dataset.uid||"");e.ctrlKey?(removeClass(e.target,"console_intem_excluded"),T(t)):(addClass(e.target,"console_intem_excluded"),T(""),I("uid != "+t)),cancelEvent(e)}}),e(t,"scroll",G),e(document,"keydown",Y),o(c.patternWrap,"click","_option_clear",e=>{var t=e.target;V(t,domData(t,"option"),"clear")}),o(c.patternWrap,"click","_conditions_clear",e=>{U("clear",domNS(e.target).id.replace("conditions_input",""))}),o(document,"click","_console_conditions",e=>{var t=e.target;I(domData(t,"conditions"))}),o(c.consoleWrap,d.EVENT_MOUSEDOWN,"console_story",e=>{return t=e.target,i=domData(t,"owner_id"),o=domData(t,"story_id"),r=domData(t,"moderator_hash"),cur.noStoriesBack=!0,void window.showStory(`${i}/${i}_${o}/moderator_hash:${r}`);var t,i,o,r})}});cur.destroy.push(()=>{Object(n.destroyModule)(o)})}},"59zB":function(e,t,i){"use strict";i.r(t);i("pIFo"),i("KKXr");var o,r=i("gdug"),s=i("t7n3"),n=i("zxIV"),a=i("Egk5"),c=i("7jxN"),l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),d=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function u(e){o&&d(o),o=l(e)}function p(e){return Object(s.isString)(e)&&"_"===e[0]?geByClass1(e):ge(e)}function _(e,t){if((e=p(e))&&Object(s.isFunction)(t)){if(r.browser.msie9||r.browser.opera&&r.browser.version<13){var i=!1,o=!1,n=function e(){if(!a.contentDocument)return setTimeout(e,100);a.contentDocument.defaultView.removeEventListener("resize",t),a.contentDocument.defaultView.addEventListener("resize",t),t()},a=ce("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){o=!0,i&&n()}});return e.appendChild(a),e.__resizeSensor__=[a,function(){i=!0,o&&n()}]}var c=ce("div",{className:"ui_scroll_resize_sensor"}),l=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),d=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),u=ce("div"),_=ce("div"),h=null;return l.appendChild(u),d.appendChild(_),c.appendChild(l),c.appendChild(d),e.appendChild(c),e.__resizeSensor__=[c,l.onscroll=d.onscroll=function(){var i=(e.offsetWidth||1e4)+10,o=(e.offsetHeight||1e4)+10;u.style.width=i+"px",u.style.height=o+"px",l.scrollLeft=i,l.scrollTop=o,d.scrollLeft=i,d.scrollTop=o,h!==(h=i+" "+o)&&t()}]}}class h{constructor(e,t){if(!(e=p(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=extend({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1,noLazyLoadWatch:!1},t),this.options.native&&(this.options.shadows=!1),r.browser.mobile&&(this.options.stopScrollPropagation=!1),isArray(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,Object(s.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),Object(s.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),Object(s.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),Object(s.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),Object(s.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),Object(s.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),Object(s.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),Object(s.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),Object(s.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:ce("div",{className:"ui_scroll_overflow"}),outer:ce("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:ce("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:ce("div",{className:"ui_scroll_shadow_top"}),shadowBottom:ce("div",{className:"ui_scroll_shadow_bottom"}),content:ce("div",{className:"ui_scroll_content clear_fix"}),barContainer:ce("div",{className:"ui_scroll_bar_container"}),barOuter:ce("div",{className:"ui_scroll_bar_outer"}),barInner:ce("div",{className:"ui_scroll_bar_inner"})},Object(n.data)(this.el.container,"ui-scroll",this);var i=Object(n.cf)(),o=["ui_scroll_container"];for(each(isArray(this.options.theme)?this.options.theme:trim(this.options.theme+"").split(/\s+/),(function(e,t){t&&o.push("ui_scroll_"+t+"_theme")})),addClass(this.el.container,o.join(" ")),this.options.hidden&&addClass(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=ce("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),i.appendChild(this.el.overflow),this.options.native?addClass(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),i.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),r.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){var c=_(this.el.inner,this.resize.bind(this,!0)),l=_(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(c[0]),this.removeElements.push(l[0]),this.startResizeListening=function(){c[1](),l[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(i),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init(),this.options.noLazyLoadWatch||(window.LazyLoad&&LazyLoad.watch(this.el.outer),window.LazyLoad&&LazyLoad.scanDelayed());var d="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":r.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,d,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&Object(a.cancelEvent)(e):this.isScrollEventUnused(e)?Object(a.cancelEvent)(e):Object(a.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),each(this.options.scrollElements,function(e,t){this.addEvent(t,d,function(e){this.disabled||this.unnecessary||(this.scrollBy(h.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||Object(a.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;var t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){removeEvent(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,addClass(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||removeClass(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,i,o){return this.removeEvents.push([e,t,i]),addEvent(e,t,i,void 0,void 0,o?{passive:!0}:void 0),i}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),each(this.removeEvents,(function(e,t){removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){for(var e=Object(n.cf)();this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return Object(n.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),each(this.removeElements,(function(e,t){Object(n.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if(Object(s.isFunction)(e)){this.animation&&this.animation.stop();var t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if(Object(s.isFunction)(e)){this.animation&&this.animation.stop();var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){r.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),setStyle(this.el.container,"width",e?Object(n.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){var t=0,i=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,r.browser.mac&&r.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==i?15:2==i?450:1)}isScrollEventUnused(e){return h.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),Object(n.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),addEvent(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),addEvent(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,Object(a.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),setStyle(bodyNode,"cursor",""),removeClass(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);var t=(e.pageY-Object(n.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&Object(a.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(!this.disabled&&this.dragging&&!this.options.native){e||(e=window.event);var t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,setStyle(bodyNode,"cursor","pointer"),addClass(this.el.container,"ui_scroll_dragging")),Object(a.cancelEvent)(e),this.emitEvent("drag"),this.api}}scroll(e,t,i){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new c.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:c.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:Object(s.isFunction)(i)?i.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,Object(s.isFunction)(i)&&i(this.api)),this.api}scrollTop(e,t,i,o){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(Object(s.intval)(t),i,o)}scrollBottom(e,t,i,o){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-Object(s.intval)(t),i,o)}scrollBy(e,t,i){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+Object(s.intval)(e),t,i)}scrollIntoView(e,t,i,o){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=p(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){var r=Object(n.getXY)(t)[1],a=Object(n.getXY)(this.el.overflow)[1],c=Object(n.getSize)(t)[1];if(r<=a&&r+c>=a+this.api.data.viewportHeight||r>=a&&r+c<=a+this.api.data.viewportHeight)Object(s.isFunction)(o)&&(i?setTimeout(o.bind(this.api),0):o(this.api));else if(c>this.api.data.viewportHeight||r<a)this.scrollTop(!1,r-a+this.api.data.scrollTop-(this.options.shadows?Object(n.getSize)(this.el.shadowTop)[1]:0),i,o);else{var l=this.options.shadows?Object(n.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,r-a+this.api.data.scrollTop+c-this.api.data.viewportHeight+l,i,o)}}return this.api}update(e){var t,i;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));var o=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==o)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,o))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(!(i=(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight))<=this.api.data.viewportHeight)){var r=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==r)&&(this.barOuterHeight=r,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),u(()=>{var e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`})}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!i)&&Object(n.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!i),this.shadowBottom!=(this.api.data.scrollBottom&&!i)&&Object(n.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!i)),this.unnecessary!==i&&(Object(n.toggleClass)(this.el.container,"ui_scroll_unnecessary",i),this.unnecessary=i,this.options.stopScrollPropagation&&this.fixBlocker(),i&&this.barInnerHeight&&this.barOuterHeight&&u(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";var i=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${i}%)`}.bind(this)))}return this.emitEvent("update"),this.options.noLazyLoadWatch||window.LazyLoad&&LazyLoad.scanDelayed(this.el.outer),(!this.options.reversed||o>=0)&&this.more(),!0}return!1}more(){var e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}}h.addResizeSensor=_;t.default=h},"6aSF":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return c}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("+/AQ")),s=i("pemR");function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class c extends o.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,i=e.isShadows,o=e.neverHide,s=e.onScroll;this.scroller||(this.scroller=Object(r.createScroll)(this.wrapper,{shadows:i,nativeScroll:t,hidden:!o,onScroll:s}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,i=(e.isNative,e.isShadows,e.neverHide,e.className),r=void 0===i?"":i,c=a(e,["children","isNative","isShadows","neverHide","className"]);return o.createElement("div",n({},c,{className:Object(s.classNames)("Scroll",r),ref:this.getWrapperRef}),t)}}c.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6krn":function(e,t,i){"use strict";i.r(t),i.d(t,"getLang",(function(){return n}));var o=i("nAFc"),r=i("4+be"),s={};function n(e,t,i){void 0===t&&(t=!1);var n="number"==typeof t,a=t||n,c=e+(a?".raw":"");if(void 0===s[c]){var l=a?Object(r.getLang)(e,"raw"):Object(r.getLang)(e);"string"==typeof l?s[c]=Object(o.decodeHTMLEntities)(l):Array.isArray(l)&&(s[c]=l.map(o.decodeHTMLEntities))}if(n){var d=t;return Object(r.langNumeric)(d,s[c],i)}return s[c]||""}t.default={getLang:n}},"6raB":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR")),s=i("Q3mP"),n=i("Ht+d");function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class l extends o.Component{constructor(e){super(e),this.needRecalcSize=!1,this.state={}}render(){var e=this.props,t=e.className,i=e.loading,l=e.children,d=c(e,["className","loading","children"]),u=Object(r.classNames)("ButtonWithProgress",{"ButtonWithProgress--loading":i},t),p=["primary","positive"].some(t=>t===e.appearance);return o.createElement(n.default,a({},d,{className:u}),o.createElement("span",{className:"ButtonWithProgress__content"},l),i&&o.createElement(s.default,{inverted:p,className:"ButtonWithProgress__progress"}))}}l.defaultProps={appearance:"primary",size:"m",wide:!1,loading:!1}},"7hRE":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class a extends o.Component{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}render(){var e=this.props,t=e.photo,i=e.title,a=e.isOnline,c=e.isMobile,l=e.onlineSize,d=e.element,u=e.className,p=n(e,["photo","title","isOnline","isMobile","onlineSize","element","className"]),_=d||"div",h="Avatar--badge-"+l,m=Object(r.classNames)("Avatar",h,u,{"Avatar--online":a,"Avatar--mobile":c});return o.createElement(_,s({className:m},p),o.createElement("div",{className:"Avatar__wrapper"},o.createElement("img",{onError:this.onError,className:"Avatar__img",src:this.state.errored?"/images/camera_c.gif":t,alt:i})))}}a.defaultProps={isOnline:!1,isMobile:!1,onlineSize:"m"}},As6E:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i("91GP"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=i("i8i4"),s=(i("17x9"),i("pemR")),n=i("clTp");class a extends o.Component{constructor(e){super(e),this.onClick=()=>{if(!this.state.dropdown||this.state.dropdown.removed){var e=this.props,t=e.text,i=e.position,o=e.align,r=e.marginTop,s=e.marginLeft,a=Object(n.default)(this.el);this.update({text:t,position:i,align:o,rect:a,marginTop:r,marginLeft:s})}else this.update()},this.onMouseEnter=e=>{this.callerHovered=!0,this.timeouts.appear=setTimeout(()=>{if(this.el&&this.callerHovered){var e=this.props,t=e.position,i=e.align,o=e.marginTop,r=e.marginLeft,s=Object(n.default)(this.el);this.update({position:t,align:i,rect:s,marginTop:o,marginLeft:r})}},80)},this.onMouseLeave=e=>{this.callerHovered=!1,this.timeouts.callerDisappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250)},this.onDropdownMouseEnter=()=>{"hover"===this.props.trigger&&(this.hovered=!0)},this.onDropdownMouseLeave=e=>{"hover"===this.props.trigger&&(this.hovered=!1,this.timeouts.disappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250))},this.onDocumentClick=e=>{!this.state.dropdown||this.state.dropdown.removed||this.el.contains(e.target)||this.update()},this.onResize=e=>{if(this.state.dropdown&&!this.state.dropdown.removed){var t=this.props,i=t.text,o=t.position,r=t.align,s=t.marginTop,a=t.marginLeft,c=Object(n.default)(this.el);this.update({text:i,position:o,align:r,rect:c,marginTop:s,marginLeft:a})}},this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.dropdown&&this.state.dropdown.removed&&this.setState({dropdown:void 0})},this.onItemClick=(e,t)=>{t.separator||(this.update(),t.onClick(e))},this.state={},this.timeouts={}}componentDidMount(){this.el=r.findDOMNode(this),"click"===this.props.trigger?(this.el.addEventListener("click",this.onClick),document.addEventListener("mousedown",this.onDocumentClick),window.addEventListener("resize",this.onResize)):(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseleave",this.onMouseLeave))}componentWillUnmount(){Object.keys(this.timeouts).forEach(e=>{clearTimeout(this.timeouts[e])}),"click"===this.props.trigger?(this.el.removeEventListener("click",this.onClick),document.removeEventListener("mousedown",this.onDocumentClick),window.removeEventListener("resize",this.onResize)):(this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseleave",this.onMouseLeave)),this.defaultNode&&(this.defaultNode.parentNode.removeChild(this.defaultNode),delete this.defaultNode)}update(e){if(!e)return this.setState({dropdown:Object.assign({},this.state.dropdown,{removed:!0})});var t=e.position,i=e.align,o=e.rect,r=e.marginTop,s=e.marginLeft,n=o.left,a=o.top;switch(t){case"t":n+=.5*o.width;break;case"r":n+=o.width,a+=.5*o.height;break;case"b":n+=.5*o.width,a+=o.height;break;case"l":a+=.5*o.height}n=Math.round(n+s),a=Math.round(a+r),this.setState({dropdown:{position:t,align:i,x:n,y:a}})}renderDropdown(){if(!this.state.dropdown)return null;var e=this.state.dropdown,t=e.x,i=e.y,r=e.position,n=e.align,a=e.removed,c=Object(s.classNames)("Dropdown","Dropdown--"+r,{"Dropdown--removed":!!a,["Dropdown--align-"+n]:"t"===r||"b"===r},this.props.className);return o.createElement("div",{className:c,style:{top:i,left:t},onTransitionEnd:e=>this.onTransitionEnd(e),onMouseEnter:this.onDropdownMouseEnter,onMouseLeave:this.onDropdownMouseLeave},o.createElement("ul",{className:"Dropdown__in"},this.props.data.map((e,t)=>o.createElement("li",{className:Object(s.classNames)("Dropdown__item",{Dropdown__item_separator:e.separator}),onClick:t=>this.onItemClick(t,e),key:void 0!==e.id?e.id:t},e.text))))}render(){var e=this.renderDropdown();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),o.createElement(o.Fragment,null,this.props.children,r.createPortal(e,this.defaultNode))):this.props.children}}a.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,trigger:"click",className:""}},"BN/X":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class a extends o.Component{render(){var e=this.props,t=e.hovered,i=e.className,a=e.children,c=n(e,["hovered","className","children"]),l=Object(r.classNames)("Link",{"Link--hovered":!!t},i);return this.props.href?o.createElement("a",s({},c,{className:l}),a):o.createElement("span",s({},c,{className:l}),a)}}a.defaultProps={href:void 0,hovered:!1}},FThC:function(e,t,i){"use strict";i.r(t),i.d(t,"noSpamPatterns",(function(){return o.noSpamPatterns})),i.d(t,"abortPatternMild",(function(){return o.abortPatternMild})),i.d(t,"noSpamSuspicious",(function(){return r})),i.d(t,"noSpamTemplates",(function(){return n})),i.d(t,"dealSingleSpamer",(function(){return a.dealSingleSpamer})),i.d(t,"reportsTime",(function(){return a.reportsTime})),i.d(t,"onFiltersChange",(function(){return a.onFiltersChange})),i.d(t,"rollbackDocMailSpamer",(function(){return l})),i.d(t,"rollbackDocWallSpamer",(function(){return d})),i.d(t,"rollbackJpgMailSpamer",(function(){return u})),i.d(t,"rollbackJpgWallSpamer",(function(){return p})),i.d(t,"rollbackPngMailSpamer",(function(){return _})),i.d(t,"rollbackPngWallSpamer",(function(){return h})),i.d(t,"rollbackDocSpamer",(function(){return m})),i.d(t,"rollbackPhotoSpamer",(function(){return v})),i.d(t,"rollbackPhotoSpamerFromWall",(function(){return f})),i.d(t,"rollbackPhotoSpamerFromMail",(function(){return g})),i.d(t,"rollbackVideoSpamer",(function(){return b})),i.d(t,"rollbackVideoSpamerFromWall",(function(){return y})),i.d(t,"rollbackVideoSpamerFromMail",(function(){return w})),i.d(t,"entityDecode",(function(){return S})),i.d(t,"selectText",(function(){return k})),i.d(t,"removeSelectedText",(function(){return E})),i.d(t,"getSelectedText",(function(){return O})),i.d(t,"selectValue",(function(){return C})),i.d(t,"blockDomain",(function(){return j})),i.d(t,"removeFidSearch",(function(){return T})),i.d(t,"banFidZero",(function(){return L})),i.d(t,"banFidForever",(function(){return B})),i.d(t,"isClaimContent",(function(){return M}));var o=i("uRA3"),r={selected:"ua_hash",updateOnSelect:function(){return r.getByType(r.selected)},getSpamType:function(){return isObject(this.spamtype)?this.spamtype._selected[0]:"wall"},getPeriod:function(){return isObject(this.period)?this.period._selected[0]:1},getByType:function(e){var t=ge("suspicious_table"),i=geByClass1("summary_tab_sel","suspicious_tabs"),o=isVisible("suspicious_tabs")?0:1,r=this;this.selected=e;var s=ge("suspicious_spamtype"),n=ge("suspicious_period"),a=geByClass("_suspicious_msg"),c=geByClass1("_suspicious_"+e+"_msg");each(a,(function(e,t){hide(t)})),show(c),"hashtags"==e?hide(s):show(s),"users"==e&&hide(s,n),o&&(t=ge("suspicious")),removeClass(i,"summary_tab_sel");var l={act:"a_get_suspicious",type:e,spamtype:this.getSpamType(),period:this.getPeriod(),need_tabs:o};addClass("suspicious_"+e,"summary_tab_sel"),ajax.post("noSpam.php",l,{onDone:function(e){if(!e)return topError(getLang("nospam_suspicious_data_error"));t.innerHTML=e,r.initInlineDropdown()},progress:"suspicious_progress"})},initInlineDropdown:function(){var e={withArrow:!0,keepTitle:!0,autoShow:!0,autoHide:300,onSelect:r.updateOnSelect},t=extend({items:cur.options.spamtypes,selected:"wall"},e),i=extend({items:[[1,"Один час"],[2,"Два часа"],[5,"5 часов"],[10,"10 часов"],[24,"Сутки"]],selected:1},e);this.spamtype||(this.spamtype=new InlineDropdown("suspicious_spamtype",t)),this.spamtype._els.valueEl.innerHTML=this.spamtype._selected[1],this.period||(this.period=new InlineDropdown("suspicious_period",i)),this.period._els.valueEl.innerHTML=this.period._selected[1]}},s=(i("pIFo"),i("Vd3H"),i("4Ch9")),n=function(e){this.selected=0,extend(this,e),this.templates=JSON.parse(e.templates)};n.prototype={addTemplate:function(){showBox("noSpam.php",{act:this.acts.add},{params:{width:430,dark:1,progress:"add_template"}})},saveTemplate:function(e){var t=cur[e],i=t.selected||0;if(ge("add_template_title")&&ge("add_template_text")){var o=trim(ge("add_template_title").value),r=trim(ge("add_template_text").value);if(!o)return notaBene("add_template_title");if(!r)return notaBene("add_template_text");var s={act:t.acts.save,title:o,text:r,hash:t.hash,template_id:i};ajax.post("noSpam.php",s,{onDone:function(e,i){var o=ge(t.links);o.innerHTML=e,hasClass(o,"template_links")||addClass(o,"template_links"),t.templates=JSON.parse(i),curBox().hide()},progress:i?"edit_template":"add_template"})}},editTemplate:function(){var e={act:this.acts.edit,template_id:this.selected,hash:this.hash};showBox("noSpam.php",e,{params:{width:430,dark:1,progress:"edit_template"}})},deleteTemplate:function(){var e=this;if(!this.selected)return!1;showFastBox({title:"Удаление шаблона",width:430,dark:1,progress:"delete_condition"},getLang("nospam_delete_template"),getLang("global_delete"),(function(){var t=e.selected,i={act:e.acts.remove,template_id:t,hash:e.hash};ajax.post("noSpam.php",i,{onDone:function(t,i){var o=ge(e.links);o.innerHTML=t,e.deselectTemplate(),e.templates=JSON.parse(i),isObject(e.templates)||removeClass(o,"template_links"),curBox().hide()},progress:"delete_condition"})}),getLang("global_cancel"))},selectTemplate:function(e){if(e){var t=this.templates[e];this.selected=e;var i=entityDecode(t.text);Object(s.setConditions)(i),this.label.innerHTML=t.title+": ",addClass(this.wrap,"template_selected")}},selectCommentTemplate:function(e){if(e){var t=this.templates[e];this.selected=e;var i=entityDecode(t.text);this.editComment(i),this.label.innerHTML=t.answer_name+": ",addClass(this.wrap,"template_selected")}},editComment:function(e){if(val(this.input,e),this.input.autosize)return this.input.autosize.update();autosizeSetup("comment_input",{minHeight:32})},getFromLocal:function(e){var t=localStorage.comments_templates_storage;ge("get_local_comments");try{t=JSON.parse(t)}catch(e){}return t?t&&e?(each(t,(function(e,t){var i=function(e,t){var i=ge("comment_template_links");hasClass(i,"template_links")||addClass(i,"template_links"),cur.comment.links.innerHTML=e,cur.comment.templates=JSON.parse(t)};setTimeout((function(){var e=t[1];ajax.post("noSpam.php",{act:"save_comment_template",title:e.name,text:e.comment,hash:opts.comment_hash,template_id:0},{onDone:i})}),1e3*e)})),curBox().hide()):void showBox("noSpam.php",{act:"apply_comments_export"},{params:{width:430,dark:1,progress:"export_progress"}}):showFastBox({title:"Перенос шаблонов",dark:1},"К сожалению, не удалось найти ни одного комментария.")},deselectTemplate:function(){var e=this.selected,t=this.templates[e];if(t){var i=entityDecode(this.templates[e].text);t&&this.input.value==i&&val(this.input,""),this.label.innerHTML=this.label_html,removeClass(this.wrap,"template_selected"),delete this.selected}},editSort:function(){var e={act:this.acts.sort,hash:this.hash};showBox("noSpam.php",e,{params:{width:430,dark:1,progress:"sort_template"}})},saveSort:function(e,t,i,o,r){var s=cur[e],n={hash:t,act:s.acts.sort_save,tid:i.id.replace("template",""),tpos:i.dataset.pos,after_id:o&&o.dataset?o.dataset.pos:"",before_id:r&&r.dataset?r.dataset.pos:""};ajax.post("noSpam.php",n,{onDone:function(e,t){box=curBox(),box.content(e[2]),box.evalBox(t),box.setOptions({onHide:function(){debugLog(e),s.links.innerHTML=e[0],s.templates=JSON.parse(e[1])}})},progress:"sort_template"})}};var a=i("b8yN");function c(e){var t=ge("console_item_"+e);hasClass(t,"green_item")&&removeClass(t,"green_item"),addClass(t,"red_item")}function l(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_docmail_spamer",uid:e,hash:t,act_type:i,spam_date:o,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_docmail_spamer"+e).innerHTML=t,c(e)}})}function d(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_docwall_spamer",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_docwall_spamer"+e).innerHTML=t,c(e)}})}function u(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_jpgmail_spamer",uid:e,hash:t,act_type:i,spam_date:o,to_id:r,to_msg_id_id:s},{onDone:function(t){ge("rollback_jpgmail_spamer"+e).innerHTML=t,c(e)}})}function p(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_jpgwall_spamer",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_jpgwall_spamer"+e).innerHTML=t,c(e)}})}function _(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_pngmail_spamer",uid:e,hash:t,act_type:i,spam_date:o,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_pngmail_spamer"+e).innerHTML=t,c(e)}})}function h(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_pngwall_spamer",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_pngwall_spamer"+e).innerHTML=t,c(e)}})}function m(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_doc_spamer",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,doc_id:s},{onDone:function(t){ge("rollback_doc_spamer"+e).innerHTML=t,c(e)}})}function v(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_photo_spamer",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,photo_id:s},{onDone:function(t){ge("rollback_photo_spamer"+e).innerHTML=t,c(e)}})}function f(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_photo_spamer_from_wall",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_photo_spamer"+e).innerHTML=t,c(e)}})}function g(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_photo_spamer_from_mail",uid:e,hash:t,act_type:i,spam_date:o,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_photo_spamer"+e).innerHTML=t,c(e)}})}function b(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_video_spamer",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,video_id:s},{onDone:function(t){ge("rollback_video_spamer"+e).innerHTML=t,c(e)}})}function y(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_video_spamer_from_wall",uid:e,hash:t,act_type:i,spam_date:o,owner_id:r,msg_id:s},{onDone:function(t){ge("rollback_video_spamer"+e).innerHTML=t,c(e)}})}function w(e,t,i,o,r,s){ajax.post("noSpam.php",{act:"rollback_video_spamer_from_mail",uid:e,hash:t,act_type:i,spam_date:o,to_id:r,to_msg_id:s},{onDone:function(t){ge("rollback_video_spamer"+e).innerHTML=t,c(e)}})}function S(e){return se("<textarea>"+e+"</textarea>").value}function k(e){var t=document,i=t.getElementById(e);if(t.body.createTextRange)(o=t.body.createTextRange()).moveToElementText(i),o.select();else if(window.getSelection){var o,r=window.getSelection();(o=t.createRange()).selectNodeContents(i),r.removeAllRanges(),r.addRange(o)}}function E(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function O(){var e="";return window.getSelection?e=window.getSelection():document.getSelection?e=document.getSelection():document.selection&&(e=document.selection.createRange().text),e}function C(e){var t=ge(e);return t.options[t.selectedIndex].value}function j(e,t,i,o){ajax.post("noSpam.php",{act:"a_block_domain",domain:e,type:t,hash:i,warn_users:isChecked("warn_users")||0,comment:ge("linksban_comment").value,link_ex:o},{onDone:function(i){ge("block_domain_1_"+e).innerHTML="",ge("block_domain_2_"+e).innerHTML="",ge("block_domain_3_"+e).innerHTML="",ge("block_domain_"+t+"_"+e).innerHTML=i}})}function T(e,t){ajax.post("noSpam.php",{act:"a_remove_fid_search",fid:e,hash:t},{onDone:function(t){ge("remove_fid_search_"+e).innerHTML=t}})}function L(e,t){ajax.post("noSpam.php",{act:"a_ban_fid_zero",fid:e,hash:t},{onDone:function(t){ge("ban_fid_zero_"+e).innerHTML=t}})}function B(e,t){ajax.post("noSpam.php",{act:"a_ban_fid_forever",fid:e,hash:t},{onDone:function(t){ge("ban_fid_forever_"+e).innerHTML=t}})}function M(){return window.nav&&window.nav.objLoc&&window.nav.objLoc.claim}},"Ht+d":function(e,t,i){"use strict";i.r(t);var o,r=i("q1tI"),s=i("pemR"),n=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=function(){return(a=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(i[o[r]]=e[o[r]])}return i},l=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<i;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)o[r]=s[n];return o};var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.render=function(){var e=this.props,t=e.className,i=e.appearance,o=e.wide,n=e.overflow,d=e.size,u=c(e,["className","appearance","wide","overflow","size"]),p=e.disabled,_=s.classNames.apply(void 0,l(["Button"],function(e){return Array.isArray(e)?e.map((function(e){return"Button--"+e})):["Button--"+e]}(i),["Button--size-"+d,{"Button--wide":o,"Button--overflow":!!n,"Button--disabled":p},t]));return r.createElement("button",a({},u,{className:_}),e.children)},t.defaultProps={appearance:"primary",size:"m",wide:!1,disabled:!1},t}(r.Component);t.default=d},KkKZ:function(e,t,i){"use strict";i.r(t),t.default={disabled:!1}},L7cl:function(e,t,i){"use strict";i.r(t);i("HEwt"),i("a1Th"),i("Btvt"),i("rGqo"),i("rE2o"),i("ioFf");var o=i("zxIV"),r=i("FWc3");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}t.default={SCROLL_EDGE_BELOW_THRESHOLD:20,MAX_COMMENTS_NUM:150,MAX_LIKES_PER_BATCH:7,MAX_STICKERS_PER_BATCH:7,init(e,t){VideoChat.block&&VideoChat.destroy(),e&&(VideoChat.block=e,VideoChat.options=extend({},t),VideoChat.messagesWrap=domByClass(e,"mv_chat_messages_wrap"),VideoChat.stickersWrap=domByClass(e,"mv_chat_stickers_wrap"),VideoChat.scroll=new uiScroll(domFC(VideoChat.messagesWrap),{global:!0,hidden:t.scrollHidden,reversed:!0,preserveEdgeBelow:!0,preserveEdgeBelowThreshold:VideoChat.SCROLL_EDGE_BELOW_THRESHOLD,theme:"videoview",onupdate:VideoChat.onScrollUpdate}),this.scrollBottomBtnWrap=domByClass(e,"mv_chat_new_messages_btn_wrap"),VideoChat.replyForm=domByClass(e,"mv_chat_reply_form"),VideoChat.replyForm&&(VideoChat.replyInput=domByClass(e,"mv_chat_reply_input"),VideoChat.initReplyInput()),VideoChat.firstMsgIntro=domByClass(e,"mv_chat_first_message_intro"))},initReplyInput(){placeholderInit(VideoChat.replyInput,{editable:!0,global:!0}),stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){var e=Emoji.init(VideoChat.replyInput,{forceStickerPack:VideoChat.options.forceStickerPack,controlsCont:VideoChat.replyForm,noLineBreaks:1,noCtrlSend:1,ref:"video_chat",onSend:function(){VideoChat.sendMessage()},checkEditable:function(){VideoChat.checkFormHeight(),VideoChat.checkTextLen()},onStickerSend:function(e){VideoChat.sendSticker(e)}});Object(o.data)(VideoChat.replyForm,"optId",e)}))},checkFormHeight(){var e=VideoChat.replyForm,t=e.offsetHeight;if(e.lastHeight!==t){e.lastHeight=t;var i=!VideoChat.scroll.data.scrollBottom;setStyle(VideoChat.messagesWrap,{bottom:t+"px"}),i&&VideoChat.scroll.scrollBottom()}},checkTextLen(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VideoChat.replyInput,t=trim(Emoji.editableVal(e));if(e.lastLen!==t.length)if((e.lastLen=t.length)>mvcur.maxChatReplyLength){var i=cur.storyLayer?"stories_live_chat_msg_too_long":"video_live_chat_msg_too_long";Object(r.showTooltip)(e,{black:1,text:getLang(i),shift:!!cur.storyLayer&&[-30,10]})}else window.tooltips&&tooltips.destroy(e)},mentionOver:e=>window.mentionOver(e,{shift:[-20,7,7]}),stickerClick:(e,t,i)=>(stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.clickSticker(e,t,i)})),!1),onScrollUpdate(e){e.data.scrollBottom<VideoChat.SCROLL_EDGE_BELOW_THRESHOLD&&VideoChat.toggleScrollBottomBtn(!1)},receiveMessage(e,t,i,o,r,s,n,a,c){if(intval(c))VideoChat.appendSticker(c,i);else{var l=!1;window.replyAsList&&window.replyAsList.length&&each(window.replyAsList,(function(){if(this[0]==i)return l=!0,!1}));var d=Videoview.getMvData(),u=d.adminLevel,p=d.canDeleteComments,_="";(u>constants.Groups.GROUPS_ADMIN_LEVEL_USER||p||e==vk.id||i==vk.id||l)&&(_+=getTemplate("video_chat_message_action_del",{video_owner_id:e,msg_id:t}));var h=psr(getTemplate("video_chat_message",{author_href:s,author_photo:psr(r),author_name:o,message:a,video_owner_id:e,msg_id:t,actions:_,classes:i==e?"mv_chat_admin_message":""}));VideoChat.appendMessage(h,t)}},receiveDelete(e,t){var i="#mv_chat_msg"+mvcur.mvData.oid+"_"+t,o=VideoChat._messagesBatch&&VideoChat._messagesBatch.querySelector(i);o?re(o):(o=VideoChat.messagesWrap.querySelector(i))&&!hasClass(o,"_deleting")&&VideoChat.scroll.updateAbove((function(){re(o)}))},checkStickerFlood(e,t){var i=mvcur.queueBatchId;VideoChat._stickersLimits&&VideoChat._stickersLimits.batch==i||(VideoChat._stickersLimits={batch:i,like:0,sticker:0},VideoChat._stickersDelay=0);var o="like"==e?"like":"sticker",r="like"==o?VideoChat.MAX_LIKES_PER_BATCH:VideoChat.MAX_STICKERS_PER_BATCH;return!(++VideoChat._stickersLimits[o]>r&&t!=vk.id)},appendSticker(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!VideoChat.isHidden()&&!Videoview.isFS&&"hidden"!=document.visibilityState&&"animation"in bodyNode.style&&"onanimationend"in window){if(t==vk.id){var o=VideoChat.recentlySentSticker;if(o&&o.stickerId==e&&o.fromQueue!=i&&Date.now()-o.time<3e3)return;VideoChat.recentlySentSticker={stickerId:e,fromQueue:i,time:Date.now()}}else if(!VideoChat.checkStickerFlood(e,t))return;if("like"==e){var r=ce("div",{className:"mv_chat_like"});n(r),addEvent(r,"animationend",c),a(r)}else{var s=ce("img",{className:"mv_chat_sticker",src:Stickers.getStickerUrl(e,(isRetina()?128:64)+"b")});n(s),addEvent(s,"error animationend",c),addEvent(s,"load",a)}}function n(e){for(var i="",o=0,r=0,s=0,n=intval((VideoChat.getHeight()-80)/6),a=0;a<=100;a+=20){a>0&&(o+=irand(-4,4),r-=n,s+=irand(-4,4),n=intval(.9*n)),i+=`\n          ${a}% {\n            transform: translate(${o}px, ${r}px) rotate(${s}deg) scale(${a?1:.7});\n            opacity: ${0==a||100==a?0:1};\n          }\n        `}var c="mv_chat_sticker_animation_"+Date.now()+"_"+irand(0,1e9);i=`@keyframes ${c} {${i}}`,e.appendChild(ce("style",{innerHTML:i}));var l=irand(1500,2500)+"ms",d=(t==vk.id?0:VideoChat._stickersDelay+=100)+"ms";setStyle(e,{animation:[c,l,d,"linear"].join(" ")})}function a(e){var t=e.currentTarget||e;(VideoChat._stickersBatch||(VideoChat._stickersBatch=document.createDocumentFragment())).appendChild(t),VideoChat._appendStickerTimeout||(VideoChat._appendStickerTimeout=setTimeout((function(){VideoChat.appendStickersBatch(),VideoChat._appendStickerTimeout=null}),0))}function c(e){var t=e.currentTarget||e;removeEvent(t),re(t)}},appendStickersBatch(){var e=VideoChat._stickersBatch;e&&(VideoChat._stickersBatch=null,VideoChat.isHidden()||VideoChat.stickersWrap.appendChild(e))},removeStickers(){if(VideoChat.stickersWrap)for(var e;e=domFC(VideoChat.stickersWrap);)removeEvent(e),re(e)},appendMessage(e,t){var i=VideoChat._messagesBatch||(VideoChat._messagesBatch=document.createDocumentFragment()),o="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;if(!VideoChat.messagesWrap.querySelector(o)&&!i.querySelector(o)){i.appendChild(se(e));for(var r=i.childNodes;i.childNodes.length>VideoChat.MAX_COMMENTS_NUM;)re(r[0]);VideoChat.isHidden()||VideoChat._appendMessageTimeout||(VideoChat._appendMessageTimeout=setTimeout((function(){VideoChat.appendMessagesBatch(),VideoChat._appendMessageTimeout=null}),0))}},appendMessagesBatch(){if(!VideoChat.isHidden()){var e=VideoChat._messagesBatch;if(e){VideoChat._messagesBatch=null;var t=geByClass("mv_chat_message_author_thumb_img",e,"img");each(t,(function(e,t){attr(t,"src")||attr(t,"src",domData(t,"src"))})),VideoChat.firstMsgIntro&&(re(VideoChat.firstMsgIntro),VideoChat.firstMsgIntro=null);var i=VideoChat.scroll.content;VideoChat.scroll.updateBelow((function(){i.appendChild(e)})),VideoChat.scroll.updateAbove((function(){for(var e=i.childNodes;e.length>VideoChat.MAX_COMMENTS_NUM;)re(e[0])})),VideoChat.scroll.data.scrollBottom>100&&VideoChat.toggleScrollBottomBtn(!0)}}},toggleScrollBottomBtn(e){toggleClass(this.scrollBottomBtnWrap,"hidden",!e)},scrollBottom(){VideoChat.scroll.scrollBottom(0)},replyAsAnimate(e,t,i){var o=e&&geByClass1("mv_chat_reply_author_photo",e),r=o&&geByClass("mv_chat_reply_author_photo_img",o),s=hasClass(e,"mv_chat_author_secondary")?0:1;r&&r[s]&&(r[s].src=i),toggleClass(e,"mv_chat_author_secondary")},replyAsGroup(e,t){window.replyAsList?VideoChat.replyAsGroupTT(e,t):ajax.post("/al_groups.php?act=get_editor_clubs",{},{cache:1,onDone:function(i){window.replyAsList=i,window.replyAsData={},each(i,(function(e,t){var i=s(t,4),o=i[0];i[1],i[2],i[3];window.replyAsData[o]=this})),VideoChat.replyAsGroupTT(e,t)}})},replyAsGroupList(e,t){var i=[t];return each(window.replyAsList,(function(t,o){var r=s(o,4),n=r[0];r[1],r[2],r[3];n!=e&&i.push(this)})),i},replyAsGroupOver(e){var t=gpeByClass("mv_chat_reply_form",e);Object(r.showTooltip)(e,{text:function(){return domData(t,"from-oid")<0?getLang("global_on_behalf_group"):getLang("global_on_behalf_me")},black:1,shift:[9,8,8]})},replyAsGroupTT(e,t){var i=VideoChat.replyAsProfileData(),r=gpeByClass("mv_chat_reply_form",e),n=r&&domData(r,"from-oid"),a=Object(o.data)(e,"tt");if(!i)return!1;if(!a){var c=VideoChat.replyAsGroupList(t,i),l="";each(c,(function(e,t){var i=s(t,4),o=i[0],r=i[1],a=i[2],c=i[3];l+=getTemplate("video_chat_message_author_select_row",{author_id:o,author_href:a,author_photo:r,author_name:c,classes:n==o?" active":""})})),a=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+l+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"top",offset:function(){return[0,-5]},onFirstTimeShow:function(t){var i=geByClass("post_from_tt_row",t);each(i,(function(t,i){addEvent(i,"click",VideoChat.setReplyAsGroup.pbind(e,{from:domData(this,"from-oid")}))})),this.rows=i,this.scroll=new uiScroll(geByClass1("_post_scroll_wrap",t)),setTimeout((function(){a.scroll.update(),a.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(a.scroll){var t=geByClass1("active",e),i=t?t.offsetTop-(a.scroll.data.viewportHeight-getSize(t)[1])/2:0;a.scroll.scrollTop(i)}}),0)},onHide:function(e){}}),Object(o.data)(e,"tt",a)}t&&a.isShown()&&VideoChat.setReplyAsGroup(e,{from:n==vk.id?t:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),a.isShown()||a.show()},replyAsProfileData:()=>window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData,setReplyAsGroup(e,t){if(!e)return!1;var i=domClosest("mv_chat_reply_form",e),r=Object(o.data)(e,"tt"),s=t.from||(t.fromGroup?cur.oid:vk.id),n=s==vk.id?VideoChat.replyAsProfileData():window.replyAsData&&window.replyAsData[s];return!(domData(i,"from-oid")==s||!n||n[0]!=s)&&(domData(i,"from-oid",s),VideoChat.replyAsAnimate(i,n[2],n[1]),r&&r.rows&&each(r.rows,(function(){toggleClass(this,"active",domData(this,"from-oid")==s)})),e.setAttribute("aria-label",getLang(s<0?"wall_reply_as_group":"wall_reply_as_user")),!1)},sendMessage(){if(!VideoChat.messageSending){var e={message:trim(Emoji.val(VideoChat.replyInput))};if(e.message){if(vkNow()-VideoChat.lastMsgSent<1e3)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),void Object(r.showTooltip)(VideoChat.replyInput,{text:getLang("video_live_chat_too_fast"),black:1});var t=Videoview.getMvData(),i=geByClass1("mv_chat_reply_form",this.block);i&&domData(i,"from-oid")&&(e.from_oid=domData(i,"from-oid")),ajax.post("al_video.php?act=post_comment",Wall.fixPostParams(extend(e,{video:t.videoRaw,hash:t.hash,videoviewer_chat:1})),{onDone:function(e,t){VideoChat.messageSending=!1,e&&t&&VideoChat.appendMessage(e,t),Emoji.val(VideoChat.replyInput,""),VideoChat.checkFormHeight(),VideoChat.scroll.data.scrollBottom&&VideoChat.scrollBottom(),VideoChat.lastMsgSent=vkNow()},onFail:function(e){if(VideoChat.messageSending=!1,VideoChat.replyInput)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),Object(r.showTooltip)(VideoChat.replyInput,{text:e,showdt:200,forcetodown:0,slide:15,black:1}),elfocus(VideoChat.replyInput),!0}}),VideoChat.messageSending=!0}else elfocus(VideoChat.replyInput)}},sendSticker(e){var t=Videoview.getMvData();ajax.post("al_video.php?act=live_send_sticker",{sticker_id:e,owner_id:t.oid,video_id:t.vid,hash:t.hash},{onDone(){VideoChat.appendSticker(e,vk.id,!1)}})},deleteMessage(e,t){var i=ge("mv_chat_msg"+e);addClass(i,"_deleting"),ajax.post("al_video.php?act=delete_comment",{comment:e,hash:t,videoview_chat:1},{onDone(e){val(domByClass(i,"mv_chat_message_content"),e)}})},isHidden(){return!!this.hidden||Videoview.isMinimized()},setHidden(e){this.hidden=e},toggle(){var e=VideoChat.isHidden();this.setHidden(!e),VideoChat.toggleStateClasses(),e&&VideoChat.scroll&&(VideoChat.appendMessagesBatch(),VideoChat.updateScroll()),e||VideoChat.removeStickers()},toggleStateClasses(){var e=!!this.block,t=VideoChat.isHidden(),i=Videoview.isMinimized();toggleClass("mv_box","_has_chat",e&&!i),toggleClass("mv_box","_hide_chat",e&&!i&&t);var o="";e&&(VideoChat.appendMessagesBatch(),o=getLang(t?"video_aria_expand_chat":"video_aria_minimize_chat")),ge("mv_top_pl_toggle")&&attr("mv_top_pl_toggle","aria-label",o)},updateScroll(){VideoChat.scroll.update(),VideoChat.scroll.scrollBottom(),VideoChat.toggleScrollBottomBtn(!1)},onResize(){VideoChat.block&&(VideoChat._chatHeight=VideoChat.block.offsetHeight)},getHeight:()=>VideoChat.block?VideoChat._chatHeight||(VideoChat._chatHeight=VideoChat.block.offsetHeight):0,destroy(){if(VideoChat.block){if(VideoChat.scroll&&(VideoChat.scroll.destroy(),VideoChat.scroll=null),VideoChat.replyForm){var e=Object(o.data)(VideoChat.replyForm,"optId");void 0!==e&&Emoji.destroy(e),Object(o.removeData)(VideoChat.replyForm),Object(o.removeData)(VideoChat.replyInput),VideoChat.replyForm=VideoChat.replyInput=null}VideoChat.removeStickers(),Object(o.removeData)(VideoChat.block),re(VideoChat.block),VideoChat.block=null,VideoChat.messagesWrap=null,VideoChat.stickersWrap=null,VideoChat.options=null,clearTimeout(VideoChat._appendMessageTimeout),clearTimeout(VideoChat._appendStickerTimeout),VideoChat._appendMessageTimeout=null,VideoChat._appendStickerTimeout=null,VideoChat._messagesBatch=null,VideoChat.firstMsgIntro=null,VideoChat.messageSending=!1,VideoChat.toggleStateClasses()}}}},LkN3:function(e,t,i){"use strict";i.r(t);var o=i("q1tI"),r=(i("17x9"),i("pemR"));t.default=e=>{var t=e.children,i=e.className;return o.createElement("span",{className:Object(r.classNames)("TextTruncate",i)},t)}},NsuH:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return n}));var o=i("q1tI"),r=(i("17x9"),i("pemR")),s=i("BN/X");class n extends o.PureComponent{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}getPhotoImage(){var e=this.props,t=e.photo,i=e.title;return o.createElement("img",{src:this.state.errored?"/images/camera_c.gif":t,alt:i,onError:this.onError,className:"Entity__photo"})}render(){var e=this.props,t=e.className,i=e.style,n=e.size,a=e.photo,c=e.href,l=e.title,d=e.description,u=e.target,p={["Entity--size"+n]:!!n};return o.createElement("div",{className:Object(r.classNames)("Entity",t,p),style:i},o.createElement("div",{className:"Entity__aside"},"string"==typeof a?c?o.createElement("a",{href:c,target:u},this.getPhotoImage()):this.getPhotoImage():a),o.createElement("div",{className:"Entity__main"},l&&c?o.createElement("div",{className:"Entity__title"},o.createElement(s.default,{href:c,dangerouslySetInnerHTML:{__html:l},target:u})):o.createElement("div",{className:"Entity__title",dangerouslySetInnerHTML:{__html:l}}),"string"!=typeof d?o.createElement("div",{className:"Entity__description"},d):o.createElement("div",{className:"Entity__description",dangerouslySetInnerHTML:{__html:d}})))}}n.defaultProps={size:null,photo:"",title:"",description:"",href:"",target:null}},PjZB:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));i("rGqo"),i("a1Th"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR"));class s extends o.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var i=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(i=>i+":"+t[e][i]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${i}} @keyframes ${e} {${i}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,i=e.color,s=e.size,n=e.duration,a=e.strokeWidth,c=e.className,l=this.id,d=this.offset,u=this.animation,p=Object(r.classNames)("Spinner",c);return o.createElement("div",{className:p,style:t},o.createElement("svg",{className:"Spinner__svg",width:s,height:s,viewBox:`0 0 ${s} ${s}`,xmlns:"http://www.w3.org/2000/svg"},o.createElement("g",{style:{width:s,height:s,transformOrigin:.5*s+"px "+.5*s+"px"}},o.createElement("style",{dangerouslySetInnerHTML:{__html:u}}),o.createElement("circle",{className:"Spinner__path",fill:"none",stroke:i,strokeDasharray:d,strokeDashoffset:d,strokeWidth:a,style:{animationName:"dash"+l,animationTimingFunction:"ease-in-out",animationDuration:n+"s",animationIterationCount:"infinite"},cx:.5*s,cy:.5*s,r:.5*s-.5*a}))))}}s.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},Q3mP:function(e,t,i){"use strict";i.r(t);var o=i("q1tI"),r=i.n(o),s=i("pemR"),n=function(){return(n=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(i[o[r]]=e[o[r]])}return i},c=function(e){var t=e.inverted,i=e.size,o=e.className,c=a(e,["inverted","size","className"]),l=Object(s.classNames)("Progress",{"Progress--inverted":!!t},"Progress--size-"+i,o);return r.a.createElement("div",n({className:l},c),r.a.createElement("div",{className:"Progress__item"}),r.a.createElement("div",{className:"Progress__item"}),r.a.createElement("div",{className:"Progress__item"}))};c.defaultProps={inverted:!1,size:"s"},t.default=c},RdBX:function(e,t,i){"use strict";i.r(t),i.d(t,"vkIndexer",(function(){return o}));i("Vd3H"),i("OG14"),i("a1Th"),i("Btvt"),i("KKXr"),i("Oyvg");function o(e,t,i){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=i||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}o.prototype.delimiter=o.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),o.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),o.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},o.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},o.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},o.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var i=this.list[t];try{i._order=t}catch(e){}this.add(i)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},o.prototype.strToPrefixes=function(e){for(var t={},i=winToUtf(e).toLowerCase().split(this.delimiter),o=i.length;o--;){var r=i[o],s="";if(r){for(var n=0;n<6;n++){var a=r.charCodeAt(n);if(a){var c=this.toTranslit[a],l=r.substr(n,1);s+=null!=c?c:l}}t[s]=1}}return t},o.prototype.strToSearchPrefixes=function(e){for(var t=[],i=e.toLowerCase().split(this.delimiter),o=i.length;o--;){var r={},s=i[o],n="",a="",c="",l=s.length>1;if(s){for(var d=0;d<6;d++){var u=s.charCodeAt(d);if(u){var p=this.toTranslit[u],_=s.substr(d,1);if(n+=null!=p?p:_,l){var h=this.toLocalCase[_],m=this.toLocalTranslit[u];a+=null!=h?h:_,c+=null!=m?m:_}}}r[n]=1,l&&(r[a]=2,r[c]=3),t.push(r)}}return t},o.prototype.toIndexTree=function(e,t){for(var i=this.index,o=0;o<6;o++){var r=e.substr(o,1)||-1;i=i[r]?i[r]:i[r]=5==o?[]:{}}i.push(t)},o.prototype.remove=function(e){var t=this.prepareFunc(e),i=this.strToPrefixes(t);for(var o in i)if(i.hasOwnProperty(o)){for(var r=this.index,s=0;s<6;s++){var n=o.substr(s,1)||-1;if(!r[n])break;r=r[n]}if(r.length)for(var a in r)if(this.equals(r[a],e)){r.splice(a,1);break}}},o.prototype.equals=function(e,t){for(var i in e)if(e.hasOwnProperty(i))switch(typeof e[i]){case"object":if(!this.equals(e[i],t[i]))return!1;break;case"function":if(void 0===e[i]||e[i].toString()!=t[i].toString())return!1;break;default:if(e[i]!=t[i])return!1}for(var o in t)if(void 0===t[o])return!1;return!0},o.prototype.intersect=function(e,t){var i=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&i.push(e.shift()),t.shift());return i},o.prototype.add=function(e){var t=this.prepareFunc(e),i=this.strToPrefixes(t);for(var o in i)i.hasOwnProperty(o)&&this.toIndexTree(o,e)},o.prototype.search=function(e){var t=this.index,i=this.strToSearchPrefixes(e),o=[],r=!1;for(var s in i)if(i.hasOwnProperty(s)){if(r&&!o)break;var n=this.localSearch(i[s],0,t);n.sort((function(e,t){return e._order-t._order})),o=r?this.intersect(o,n):n,r=!0}for(var a=o[0],c=o.length+1,l=[],d=1;d<c;d++){var u=o[d];u!=a&&(l.push(a),a=u)}return l},o.prototype.localSearch=function(e,t,i){if(!i)return[];var o={};for(var r in e)if(e.hasOwnProperty(r)){var s=r.substr(t,1)||-1;o[s]||(o[s]={}),o[s][r]=1}if(6==t++||!i)return i;var n=[];for(var a in o)if(-1==a)for(var c in i)i.hasOwnProperty(c)&&n.push.apply(n,this.localSearch(o[a],t,i[c]));else{var l=this.localSearch(o[a],t,i[a]);n.push.apply(n,l)}return n}},TBLV:function(e,t,i){"use strict";i.r(t);i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var a=e=>{var t=e.className,i=e.children,a=n(e,["className","children"]),c=Object(r.classNames)("Radio",t,{"Radio--disabled":e.disabled});return o.createElement("label",{className:c},o.createElement("input",s({className:"Radio__input Radio__visuallyHidden",type:"radio"},a)),o.createElement("span",{className:"Radio__control"}),Boolean(i)&&o.createElement("span",{className:"Radio__text"},i))};a.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=a},"Tn+0":function(e,t,i){"use strict";i.r(t),i.d(t,"MODULE",(function(){return o})),i.d(t,"REPORT_CLASS",(function(){return r})),i.d(t,"BAN_PERIOD_FOREVER",(function(){return s})),i.d(t,"_getReportRawIdByElement",(function(){return n})),i.d(t,"_getReportDecisionRawIdByElement",(function(){return a}));i("pIFo");var o="sf",r="sf_report",s=1e3;function n(e){return gpeByClass(r,e).id.replace("report","")}function a(e){var t=gpeByClass(r,e),i=geByClass1("decision_result",t);return domData(i,"decision_raw_id")}},UCWv:function(e,t,i){"use strict";i.r(t),i.d(t,"STORIES_MANAGE_MODULE",(function(){return o})),i.d(t,"LONG_PRESS_DELAY_MS",(function(){return r})),i.d(t,"StickerTypes",(function(){return s})),i.d(t,"EMOJI_REACTIONS_ARR",(function(){return n})),i.d(t,"QUESTION_SELECT_MODE",(function(){return a})),i.d(t,"MAX_FEEDBACK_STORIES_SLICE_COUNT",(function(){return c})),i.d(t,"INIT_MAX_FEEDBACK_STORIES_COUNT",(function(){return l}));var o="stories_manage",r=200,s={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,app:13},n=[{code:"f09f9882",name:"face_with_tears_of_happiness"},{code:"f09f988d",name:"smiling_face_with_heart_eyes"},{code:"f09f918df09f8fbf",name:"thumbs_up"},{code:"f09f98ad",name:"loud_crying_face"},{code:"f09f98b1",name:"face_screaming_in_fear"},{code:"e298ba",name:"smiling_face"}],a={PUBLIC:0,AUTHOR_ONLY:1,ANONYMOUS:3},c=50,l=10},UlUB:function(e,t,i){"use strict";function o(e,t){var i,o,r=!1;return function s(){if(r)return i=arguments,void(o=this);e.apply(this,arguments),r=!0,setTimeout((function(){r=!1,i&&(s.apply(o,i),i=o=null)}),t)}}i.r(t),i.d(t,"throttle",(function(){return o}))},W28y:function(e,t,i){"use strict";i.r(t),i.d(t,"PHP_SECOND",(function(){return o})),i.d(t,"PHP_MINUTE",(function(){return r})),i.d(t,"PHP_HOUR",(function(){return s})),i.d(t,"PHP_DAY",(function(){return n})),i.d(t,"PHP_WEEK",(function(){return a})),i.d(t,"PHP_MONTH",(function(){return c})),i.d(t,"PHP_YEAR",(function(){return l})),i.d(t,"MILLISECONDS_MULTIPLIER",(function(){return d})),i.d(t,"SECOND",(function(){return u})),i.d(t,"MINUTE",(function(){return p})),i.d(t,"HOUR",(function(){return _})),i.d(t,"DAY",(function(){return h})),i.d(t,"WEEK",(function(){return m})),i.d(t,"MONTH",(function(){return v})),i.d(t,"YEAR",(function(){return f})),i.d(t,"TARGET_BLANK",(function(){return g})),i.d(t,"EVENT_MOUSEDOWN",(function(){return b})),i.d(t,"EVENT_KEYDOWN",(function(){return y})),i.d(t,"EVENT_SCROLL",(function(){return w})),i.d(t,"EVENT_CLICK",(function(){return S})),i.d(t,"getCurrentUrl",(function(){return k})),i.d(t,"updateUrl",(function(){return E})),i.d(t,"getUrlParam",(function(){return O})),i.d(t,"getAct",(function(){return C})),i.d(t,"openInNewTab",(function(){return j})),i.d(t,"getTime",(function(){return T})),i.d(t,"getCurrentDayBoundaries",(function(){return L})),i.d(t,"getDayBoundaries",(function(){return B})),i.d(t,"timestampToSeconds",(function(){return M})),i.d(t,"showLoading",(function(){return I})),i.d(t,"hideLoading",(function(){return x})),i.d(t,"hideCurrentBox",(function(){return P})),i.d(t,"initRadioButtons",(function(){return R})),i.d(t,"isSpecialKeyPressed",(function(){return N})),i.d(t,"isIntegerString",(function(){return D}));var o=1,r=60,s=3600,n=86400,a=604800,c=2592e3,l=31536e3,d=1e3,u=o*d,p=r*d,_=s*d,h=n*d,m=n*d,v=c*d,f=l*d,g="_blank",b="mousedown",y="keydown",w="scroll",S="click";function k(){return nav.strLoc}function E(e){var t={0:nav.objLoc[0],act:nav.objLoc.act};nav.setLoc(extend(t,e))}function O(e){return nav.objLoc[e]}function C(){return O("act")}function j(e){window.open(e,"_blank").focus()}function T(){return M(Date.now())}function L(){return B((new Date).getTime())}function B(e){var t=new Date(e),i=new Date(e);return t.setHours(0,0,0,0),i.setHours(23,59,59,999),[t.getTime(),i.getTime()]}function M(e){return Math.floor(e/d)}function I(){var e=new MessageBox;e.setOptions({title:!1,hideButtons:!0}).show(),hide(boxLayerBG),hide(e.bodyNode),show(boxLoader),boxRefreshCoords(boxLoader)}function x(){curBox&&curBox()&&curBox().hide()}function P(){curBox().hide()}function R(e,t,i){window.radioBtns[e]={val:i,els:Array.prototype.slice.apply(geByClass("radiobtn",geByClass1(t)))}}function N(e){return e.ctrlKey||e.metaKey&&browser.mac}function D(e){return/^-?(0|[1-9]\d*)$/.test(e)}},WbBG:function(e,t,i){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},aFGQ:function(e,t,i){"use strict";i.r(t);var o,r=i("q1tI"),s=i("i8i4"),n=i("pemR"),a=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),c=function(){return(c=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=i("dLHM").default,d=function(e){function t(t){var i,o=e.call(this,t)||this;return o.handleMouseDown=function(e){o.props.onFocus&&"function"==typeof o.props.onFocus&&o.props.onFocus(o.state.opened),"mousedown"===e.type&&0!==e.button||(e.stopPropagation(),e.preventDefault(),o.props.disabled||o.props.alwaysOpened||o.toggle(!o.state.opened))},o.getOptionByValue=function(e,t){return e.find((function(e){return"object"!=typeof e?e===t:e.value===t}))},o.setValue=function(e,t){"object"==typeof t&&o.props.searchable&&(t=t.props.title);var i={value:e,label:t.toString()},r={selected:i,opened:!o.props.alwaysOpened};o.fireChangeEvent(i),o.setState(r),o.toggle(!1)},o.fireChangeEvent=function(e){e!==o.state.selected&&o.props.onChange&&o.props.onChange({name:o.props.name,selected:e})},o.renderOption=function(e){var t=Object(n.classNames)("Select__option",{"Select__option--selected":e===o.state.selected}),i=void 0!==e.value?e.value:e.label||e,s=void 0!==e.label?e.label:e;return r.createElement("div",{key:i,className:t,onMouseDown:function(){return o.setValue(i,s)},onClick:function(){return o.setValue(i,s)},title:e.title},s)},o.buildMenu=function(){var e=o.state.filteredOptions.map((function(e){return"string"!=typeof e&&"group"===e.type?r.createElement("div",{className:"Select__group",key:e.name},e.name&&r.createElement("div",{className:"Select__title"},e.name),e.items&&e.items.map((function(e){return o.renderOption(e)}))):o.renderOption(e)}));return e.length?e:r.createElement("div",{className:"Select__noresults"},o.props.searchPlaceholder)},o.filterOptions=function(e,t){var i=e.toLowerCase();return t.filter((function(e){return"string"==typeof e?e.toLowerCase().includes(i):"string"==typeof e.label?e.label.toLowerCase().includes(i):"object"==typeof e.label?e.label.props.title.toLowerCase().indexOf(i)>=0:void 0}))},o.handleSearchType=function(e){var t=o.filterOptions(e.target.value,o.state.allOptions);o.setState({selected:{value:e.target.value,label:e.target.value},filteredOptions:t}),o.toggle(!0),o.props.onType&&o.props.onType(e.target.value)},o.handleEditableType=function(e){o.setState({opened:!0}),o.props.onEdit&&o.props.onEdit(e.target.value)},o.buildControl=function(e){var t,i="",s=o.props,n=s.searchable,a=s.editable;return e&&"string"==typeof e&&(i=e),e&&"object"==typeof e&&(e&&"string"==typeof e.label&&(i=e.label),e&&"object"==typeof e.label&&n&&(i=e.label.props.title||""),e&&"object"==typeof e.label&&!n&&(t=e.label)),n?r.createElement(l,c({placeholder:o.props.placeholder,className:"Select__input",value:i||"",onClick:o.handleMouseDown,onChange:o.handleSearchType.bind(o),onFocus:o.props.onInputFocus,onBlur:o.props.onInputBlur,disabled:o.props.disabled,isControlledOutside:!0},o.props.inputOtherProps)):a?r.createElement("div",{className:"Select__control",onClick:o.handleMouseDown},r.createElement(l,c({placeholder:o.props.placeholder,className:"Select__input Select__input--editable",id:o.props.id,value:i||"",onChange:o.handleEditableType,onFocus:o.props.onInputFocus,onBlur:o.props.onInputBlur,disabled:o.props.disabled,isControlledOutside:!0,autoComplete:"off"},o.props.inputOtherProps)),r.createElement("span",{className:"Select__arrow"})):r.createElement("div",{className:"Select__control",onClick:o.handleMouseDown},r.createElement("div",{className:"Select__placeholder"},i||t),r.createElement("span",{className:"Select__arrow"}))},o.handleDocumentClick=function(e){o.mounted&&o.state.opened&&o.el&&!o.el.contains(e.target)&&o.toggle(!1)},i=void 0!==t.value?t.editable&&void 0!==t.customValue?{label:t.customValue,value:t.customValue}:o.getOptionByValue(t.options,t.value):{label:o.getLabel(t),value:""},o.state={filteredOptions:t.options,allOptions:t.options,selected:i,opened:!!t.alwaysOpened},o.mounted=!0,o}return a(t,e),t.prototype.getLabel=function(e){return this.props.searchable?this.props.value||"":e.placeholder||"Select..."},t.prototype.componentWillReceiveProps=function(e){this.setState({filteredOptions:e.options,allOptions:e.options}),this.props.editable&&void 0!==e.customValue?this.setState({selected:{label:e.customValue,value:e.customValue}}):void 0!==e.value&&e.value!==this.state.selected?this.setState({selected:this.getOptionByValue(e.options,e.value)}):void 0===e.value&&this.setState({selected:{label:this.getLabel(e),value:""}})},t.prototype.componentDidMount=function(){this.el=s.findDOMNode(this),document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)},t.prototype.componentWillUnmount=function(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)},t.prototype.toggle=function(e){var t=this;this.setState({opened:e},(function(){t.state.opened?t.props.onShow():t.props.onHide()}))},t.prototype.render=function(){var e=this.props,t=e.className,i=e.appearance,o=e.style,s=e.searchable,a=e.editable,c=e.disabled,l=this.state,d=l.selected,u=l.opened,p=d&&"object"==typeof d&&!d.value||!1,_=s||a?"secondary":i,h=Object(n.classNames)("Select","Select--"+_,{"Select--opened":!!u,"Select--disabled":!!c,"Select--empty":p},t),m=this.buildControl(d);return r.createElement("div",{className:h,style:o},m,this.state.opened&&r.createElement("div",{className:"Select__menu"},this.buildMenu()))},t.defaultProps={appearance:"primary",searchPlaceholder:"No options found",searchable:!1,editable:!1,inputOtherProps:{},onShow:function(){},onHide:function(){}},t}(r.Component);t.default=d},awNS:function(e,t,i){"use strict";i.r(t),i.d(t,"consoleWrap",(function(){return o})),i.d(t,"patternWrap",(function(){return r})),i.d(t,"reportList",(function(){return s})),i.d(t,"reportTabs",(function(){return n})),i.d(t,"tabReports",(function(){return _})),i.d(t,"tabPattern",(function(){return h})),i.d(t,"tabPatterns",(function(){return m})),i.d(t,"switchTab",(function(){return v})),i.d(t,"getCurrentTab",(function(){return f})),i.d(t,"activeTab",(function(){return g})),i.d(t,"getCustomOption",(function(){return y})),i.d(t,"init",(function(){return k}));var o,r,s,n,a,c=i("4Ch9"),l=i("b8yN"),d=i("uRA3"),u=i("W28y"),p=i("ofcU"),_="reports",h="pattern",m="patterns";function v(e,t){var i=geByClass1("_nospam_tab_switch_"+e);uiTabs.switchTab(domFC(i)),t&&(i=domChildren(i));var o=geByClass("nospam_tab"),r=domData(i,"tab-id");return o.forEach((function(e){domData(e,"id")!=r?hide(e):show(e)})),Object(u.updateUrl)({tab:e}),e===m?d.noSpamPatterns.initUpdate():e===_?l.noSpamReports.initUpdate():e===h&&scrollToTop(),!1}function f(){return Object(u.getUrlParam)("tab")}function g(){var e=domPN(geByClass1("ui_tab_sel"));return domData(e,"tab-id")}function b(e){geByClass("_nospam_option_action",a).forEach(t=>{var i=domData(t,"option"),o=+e[i],r=window.cur.lang["nospam_options_"+i];r&&(t.innerHTML=r[o]),domData(t,"option-state",o)}),cur.options.custom_options=e}function y(e){var t=window.cur;return!!t.options.custom_options&&t.options.custom_options[e]}var w={width:185,height:500,multiselect:!1};function S(e){extend(cur,{uiSpamtype:new Dropdown(ge("spamtype"),e.spamtypes,extend(w,{selectedItems:cur.options.spamtype})),uiSpamtype2:new Dropdown(ge("spamtype2"),e.spamtypes,extend(w,{selectedItems:cur.options.spamtype2})),uiSimplify:new Dropdown(ge("simplify_select"),e.simplifies,extend(w,{selectedItems:cur.options.simplify})),uiBan:new Dropdown(ge("ban_select"),e.bans,extend(w,{selectedItems:cur.options.ban})),uiDuration:new Dropdown(ge("duration_select"),e.durations,extend(w,{selectedItems:cur.options.duration})),uiSearchPeriod:new Dropdown(ge("search_period_select"),e.searchperiods,extend(w,{selectedItems:cur.options.searchperiod}))}),placeholderSetup("comment_input"),val("comment_input")&&autosizeSetup("comment_input",{minHeight:30}),geByClass("conditions_input").forEach((function(e){placeholderSetup("comment_input"),val(e)&&autosizeSetup("comment_input",{minHeight:30})}));var t=ge("page_body");r=geByClass1("pattern_wrap",t),o=geByClass1("console_wrap",t),n=geByClass1("reports_tabs",t),s=geByClass1("_reports_list",t),a=geByClass1("_nospam_options",t);var i=geByClass1("nospam_patterns_wrap",t),u=Object(p.createModule)({handlers:(e,t)=>{t(i,"click","_abort_pattern_mild",e=>Object(d.abortPatternMild)(domData(e.target,"id"))),t(a,"click","_nospam_option_action",e=>{return t=e.target,i={act:"a_set_custom_option",name:domData(t,"option"),state:1^domData(t,"option-state")},void ajax.post("noSpam.php",i,{onDone:b,showProgress:lockActionsMenuItem.pbind(t),hideProgress:unlockActionsMenuItem.pbind(t)});var t,i})}});cur.destroy.push(()=>{Object(p.destroyModule)(u)}),Object(c.mount)(),Object(l.mount)()}function k(e){var t=Object(p.createMutations)(S);t.callMutations;(0,t.bindMutations)(e)}},b8yN:function(e,t,i){"use strict";i.r(t),i.d(t,"activeReportsType",(function(){return g})),i.d(t,"activeSubReportsType",(function(){return b})),i.d(t,"prepareReport",(function(){return y})),i.d(t,"switchReports",(function(){return w})),i.d(t,"dealSingleSpamer",(function(){return T})),i.d(t,"reportsTime",(function(){return B})),i.d(t,"onFiltersChange",(function(){return P})),i.d(t,"mount",(function(){return R})),i.d(t,"noSpamReports",(function(){return N}));i("HEwt"),i("a1Th"),i("rE2o"),i("ioFf"),i("KKXr"),i("rGqo"),i("Btvt");var o,r=i("1BRX"),s=i("4Ch9"),n=i("awNS");function a(){o=(new Date).getTime()}function c(){var e=(new Date).getTime(),t=(e-o)/1e3,i=Array.prototype.slice.call(arguments);i.push(t),debugLog.apply(null,i)}var l=i("W28y"),d=i("ofcU");function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var _={},h={},m=new Date,v=setTimeout(null),f=0;function g(){var e=geByClass1("active_filter",n.reportTabs);return domData(e,"type")}function b(){var e=geByClass1("_reports_subtabs",n.reportTabs),t=geByClass1("active_filter",e);return domData(t,"subtype")}function y(e,t){a();var i=geByClass1("_report_btn_update",n.reportList);if(!isButtonLocked(i)){var o=geByClass1("_reports_"+e+"_wrap",n.reportList);if(o){var r={act:"a_get_reports",encode_entities:1,type:e,sub_type:t,shift:cur.options.shift};"mail"===e&&"mail_group"===t&&(r=extend(r,function(){if("mail"===e||"mail_group"===t){var i=geByClass1("filters");return{hide_groups_with_disabled_messages:isChecked(geByClass1("hide_groups_with_disabled_messages_filter",i)),shift:isObject(cur.hoursShiftSlider)?23*cur.hoursShiftSlider._currValue:0,min_reporters_amount:val(geByClass1("min_reports_amount_filter",i)),sorting:radioval("group_messages_reports_sorting")}}console.log("Unsupported filters used")}())),ajax.post("noSpam.php",r,{onDone:function(t){if(c("actions fetch"),_={},0!==t.length){for(var i=0;i<t.length;i++){var r=t[i];r.ui_type=e;var s=S(r.ui_type,i);I(r.ua_hash,r.agent_name),delete r.agent_name,delete r.remix_seed,r.index=i,_[s]=r}o.innerHTML="",k(e,0),t=""}else o.innerHTML=getTemplate("nospam_reports_type_search_empty")},onFail:function(e){c("actions fetched fail"),topError(e),o.innerHTML=getTemplate("nospam_reports_type_search_error")},showProgress:lockButton.pbind(i),hideProgress:unlockButton.pbind(i)}),scrollToTop()}else topError("Can't find wrap for type: "+e)}}function w(e){var t=e.target,i=domData(t,"type"),o=domData(t,"subtype"),r=geByClass("report_filter",n.reportTabs),s=geByClass("report_subfilter",n.reportTabs),a=geByClass1("active_type",n.reportList);if(!i)return!1;r.forEach(e=>{hasClass(e,"active_filter")&&removeClass(e,"active_filter"),domData(e,"type")!==i||domData(e,"subtype")||addClass(e,"active_filter")});var c=!1,l=!1;s.forEach(e=>{removeClass(e,"report_subfilter_active"),removeClass(e,"active_filter"),domData(e,"type")===i&&(addClass(e,"report_subfilter_active"),c=!0),domData(e,"subtype")===o&&(addClass(e,"active_filter"),l=!0)});var d=geByClass1("hr",n.reportTabs);if(c?show(d):hide(d),c&&!l){var u=geByClass1("report_subfilter_active",n.reportTabs);addClass(u,"active_filter")}domData(a,"type")!==i&&(removeClass(a,"active_type"),addClass(ge("reports_"+i),"active_type")),y(i,o)}function S(e,t){return"report_"+e+"_"+t}function k(e,t,i){a(),i||(i=20);for(var o=geByClass1("_reports_"+e+"_wrap",n.reportList),r=domPN(o),s=geByClass1("_reports_type_show_more",r),l=0,d=0,p=0;l<i;){d=p,p++;var h=S(e,d),m=_[h];if(!(d<t)){if("object"!=typeof m){debugLog("empty reports after "+d,"need to shift "+t);break}if(m.uid&&!0!==m.showed){var v=ce("div",{id:"report_"+e+"_"+d});if(addClass(v,"clear_fix"),addClass(v,"report"),m.mem_banned||m.uid_base_info){if(Object(n.getCustomOption)("hide_banned"))continue;addClass(v,"banned")}m.ui_type=e;[C(m),u(O(m),1)[0],j(m,d)].forEach((function(e){v.appendChild(e)})),o.appendChild(v),l++}}}if(0!==l){s?isVisible(s)||show(s):(s=ce("div",{className:"reports_type_show_more _reports_type_show_more"}),r.appendChild(s));var f=parseInt(t)+20;s.innerHTML=getTemplate("nospam_reports_show_more",{need_shift:f}),c("actions to html")}else hide(s)}function E(){var e=getSelectionText();e?cur.uiSimplify.selectItem("0"):(e="/",cur.uiSimplify.selectItem("32")),val("pattern_input",e)}function O(e){var t,i="",o=e.type_name,r=parseInt(e.type),s=ce("div");switch(addClass(s,"report_body"),e.api_id>0&&(setStyle(s,"color","#bbbbbb"),i+=e.api_id>0?'<div class="report_api">Приложение ('+e.api_id+"):</div>":""),e.message&&(i+=getTemplate("nospam_reports_field",{class:"report_message",value:e.message})),e.kludges&&(i+=getTemplate("nospam_reports_field",{class:"reports_kludges",value:e.kludges})),e.attaches&&(i+=getTemplate("nospam_reports_attaches",{attaches:e.attaches})),r){case 500:case 510:case 545:t="<a href='/wall"+e.owner_id+"_"+e.msg_id+"' target='_blank'> "+o+"</a>";break;case 501:case 550:t="<a href='/wall"+e.owner_id+"_"+e.parent_id+"?reply="+e.msg_id+"' target='_blank'> "+o+"</a>",e.group_id&&e.group_link&&(i+=getTemplate("nospam_reports_group_id",{group_id:e.group_id,group_link:e.group_link}));break;case 100:i+=e.score?"<b>phone_cheat:</b> "+e.score:"",e.update_time&&(i+=getTemplate("nospam_reports_tag",{tag_label:e.update_time}));break;case 200:i+=getTemplate("nospam_reports_labeled_value",{label:"receivers_num",value:e.receivers_num}),i+=getTemplate("nospam_reports_labeled_value",{label:"chat_msg_id",value:e.chat_msg_id}),i+=getTemplate("nospam_reports_labeled_value",{label:"chat_title",value:e.chat_title});break;case 300:if(e.group_id&&e.group_link&&(i+=getTemplate("nospam_reports_group_id",{group_id:e.group_id,group_link:e.group_link})),e.admin_id&&e.admin_link){var n=e.admin_id;i+=getTemplate("nospam_reports_admin_id",{admin_id:n,admin_link:e.admin_link})}break;case 160:i+=e.title;break;case 161:i+=e.new_title;break;case 200:e.attaches;-152029297==e.uid&&e.original_user_link&&(i+=getTemplate("nospam_reports_molodec_label",{original_user_link:e.original_user_link}));case 2602:case 2647:t="<a href='/video"+e.owner_id+"_"+e.video_id+"' target='_blank'> "+o+"</a>";break;case 2600:case 2610:case 2611:case 2645:case 2650:t="<a href='/video"+e.owner_id+"_"+e.video_id+"' target='_blank'> "+o+"</a>",i+='<table class="report_video"><tr>',i+='<td style="width: 130px;"><a class="report_video_thumb" href="'+e.video.href+'" onclick="'+e.video.onclick+'" style="background-image: url(\''+e.video.thumb+'\')"><div class="report_video_duration"><span class="report_video_icon"></span><span class="report_video_duration_text">'+e.video.duration_text+"</span></div></a></td>",i+="<td>",i+=e.video.DELETED?"Видеозапись удалена":'<div class="report_video_title"><a href="'+e.video.href+'" onclick="'+e.video.onclick+'">'+e.video.title_short+"</a></div>",i+=!e.video.DELETED&&e.description?'<div class="report_video_description">'+e.video.description_short+"</div>":"",i+="</td>",i+="</tr></table>",i+='<div class="report_video_duration_second"><b>Duration:</b> <a class="_console_conditions" data-conditions="duration = '+e.duration+'">'+e.duration+"</a></div>",e.external&&(i+='<div class="report_video_external"><b>External:</b> '+e.external+"</div>");break;case 3504:case 3545:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+o+"</a>";break;case 13120:case 13121:t="<a href='/market"+e.owner_id+"?w=product"+e.owner_id+"_"+e.item_id+"' target='_blank'> "+o+"</a>";break;case 3500:case 3547:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+o+"</a>",i+='<table class="report_photo"><tr>',i+='<td><div class="report_photo_thumb">'+e.photo+"</div></td>",i+=e.description?'<td><div class="report_photo_description">'+e.description+"</div></td>":"",i+="</tr></table>",i+=e.album_id<0?'<div class="report_album_id"><b>album_id:</b> '+e.album_id+"</div>":"";break;case 3550:t="<a href='/photo"+e.owner_id+"_"+e.photo_id+"' target='_blank'> "+o+"</a>",i+=e.photo,i+=e.album_id<0?'<div class="report_album_id"><b>album_id:</b> '+e.album_id+"</div>":"";break;case 9258:i+=e.about;break;case 1800:i+=e.status;break;case 1531:case 1530:case 1534:i+=e.text;break;case 5e3:t="<a href='/topic-"+e.group_id+"_"+e.topic_id+"' target='_blank'> "+o+"</a>",i+=e.title;break;case 5001:case 5046:t="<a href='/topic-"+e.group_id+"_"+e.topic_id+"?post="+Math.abs(e.comment_id)+"' target='_blank'> "+o+"</a>";break;case 2131:var a=e.group_id;t="Группа: "+getTemplate("nospam_reports_id_link",{type:"club",id:a,label:a,color:"black"}),i+="<b>Название:</b>"+e.group_name+"<br>",i+="<b>Описание:</b>"+e.group_description+"<br>";break;case 7530:t="<a href='/app"+e.app_id+"' target='_blank'> "+o+"</a>",i+=e.app_name+"<br>";break;case 3670:var c=e.like_ref,l=e.like_type,d=e.owner_id+"_"+e.item_id,u="";switch(Number(l)){case 11:t="<a href='wall<a href='wall"+d+"' target='_blank'> "+o+"</a>",u+="(запись на стене), <a href='wall"+d+"' target='_blank'>vk.com/wall"+d+"</a>";break;case 12:t="<a href='wall"+d+"' target='_blank'> "+o+"</a>",u+="(комментарий на стене), <a href='wall"+d+"' target='_blank'>vk.com/wall"+d+"</a>";break;case 10:t="<a href='photo"+d+"' target='_blank'> "+o+"</a>",u+="(фотография), <a href='photo"+d+"' target='_blank'>vk.com/photo"+d+"</a>";break;case 24:case 8:t="<a href='photo"+d+"' target='_blank'> "+o+"</a>",u+="(видеозапись), <a href='video"+d+"' target='_blank'>vk.com/video"+d+"</a>";break;case 6:t="<a href='audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"' target='_blank'> "+o+"</a>",u+="(аудиозапись), <a href='audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"' target='_blank'>vk.com/audio.php?id="+e.owner_id+"&audio_id="+e.item_id+"</a>";break;case 22:t=o,u+="(комментарий к видео)";break;case 21:t=o,u+="(комментарий к фотографии)";break;case 20:t=o,u+="(комментарий на стене)";break;default:t=o,u+=" (незвестный тип) "+d}i+=getTemplate("nospam_reports_report_like",{like_ref:c,like_ref_id:e.ref,like_type:u,like_type_id:l});break;default:console.log("No type specified")}if(e.post_tags){var p=e.post_tags;Object.keys(p).forEach((function(e){p[e]&&(i=getTemplate("nospam_reports_tag",{tag_label:p[e]})+i)}))}return s.innerHTML=i,[s,t]}function C(e){var t,i,o=e.mem_banned,r=isObject(o),s=r?"Недавняя блокировка:<br>"+o.comment+"<br>"+L(new Date(1e3*o.time)):"",n="",a=S(e.ui_type,e.index),c=e.uid_base_info;""==s&&c&&(t=c[0].pattern_id,i=c[0].state,r=!0,s=(s=0==Number(i)?"Ожидает обработки noSpam ":"Обработан noSpam ")+"(шаблон номер <a href='/pattern"+Number(t)+"' target='_blank'>"+Number(t)+"</a>)");var l,d=ce("div");addClass(d,"report_info"),r&&addClass(d,"report_banned"),s&&(n=getTemplate("nospam_reports_report_ban_tooltip",{action_index:a}),_[a].ban_tt=s);var p,h=e.uid,m=Number(e.type),v=r?"red":"blue";return l=h>0?getTemplate("nospam_reports_id_link",{type:"id",id:h,label:h,color:v}):getTemplate("nospam_reports_id_link",{type:"club",id:-h,label:h,color:v}),p=u(O(e),2)[1],d.innerHTML=getTemplate("nospam_reports_report_info",{action_mention_link:l,action_tt:n,type:m,index:e.index,ip:e.ip,report_time:L(new Date(1e3*e.report_time)),action_time:L(new Date(1e3*e.time)),ua_hash:e.ua_hash,from_uid:e.from_uid,report_count:e.report_count>1?langNumeric(e.report_count,["","%s жалоба","%s жалобы","%s жалоб"]):"",report_type_link:p}),d}function j(e,t){var i="",o="report_"+e.ui_type+"_"+e.index,r=ce("div");(addClass(r,"report_steps"),"photo"!=e.ui_type&&"video"!=e.ui_type||cur.isSearchOnlyMode)||(i+="<span id = 'spamer_by_"+o+"'> <a onclick = \""+("dealSingleSpamer('"+e.ui_type+"', "+e.uid+", "+e.index+")")+'"> Забанить и откатить </a> </span>');return i+=getTemplate("nospam_reports_compose_button",{type:e.real_ui_type?e.real_ui_type:e.ui_type,ip:e.ip,ua_hash:e.ua_hash}),i+="<span id='selected_text_span"+t+"' style='display:none;'></span>",r.innerHTML=i,r}function T(e,t,i){var o="report_"+e+"_"+i;ajax.post("noSpam.php",{act:"a_single_spamer",uid:t,type:e,action:JSON.stringify(_[ge(o)])},{onDone:function(){ge("spamer_by_"+o).innerHTML="<span style = 'color: green'> Добавлен </span>"},onFail:function(){ge("spamer_by_"+o).innerHTML="<span style = 'color: red'> Неудача </span>"}})}function L(e){var t=e.getDate(),i=e.getMonth()+1;return(t<10?"0":"")+t+"."+(i<10?"0":"")+i+" в "+e.toLocaleTimeString()}var B={_sel:[],day:m.getDate(),month:m.getMonth(),months:[[0,"Января"],[1,"Февраля"],[2,"Марта"],[3,"Апреля"],[4,"Мая"],[5,"Июня"],[6,"Июля"],[7,"Августа"],[8,"Сентября"],[9,"Октября"],[10,"Ноября"],[11,"Декабря"]],year:m.getFullYear(),generateHMS:function(e){var t,i=[];switch(e){case"hour":t=23;break;case"minute":case"second":t=59}for(var o=0;o<=t;++o)i.push([o,o<10?"0"+o:o+""]);return i},generateDays:function(e,t){for(var i=[],o=Object(r.getLastDay)(e,t),s=1;s<=o;++s)i.push([s,s+""]);return i},updateDays:function(){var e=this._sel[0],t=this._sel[1].val(),i=this._sel[2].val();e.val()>Object(r.getLastDay)(i,t)&&e.clear(),e.setData(this.generateDays(i,t))},setControls:function(){var e=B,t=[["reports_day",55],["reports_month",95],["reports_year",60],["reports_hour",50],["reports_minute",50],["reports_second",50]],i=ce("div",{id:"reports_time_wrap",className:"reports_time_wrap"}),o=geByClass1("box_body");e.clear(),o.appendChild(i),t.forEach((function(i,r){var s=[],n=[],a=ce("div",{className:i[0]+" fl_l"}),c=ce("input",{type:"hidden",name:i[0],id:i[0]}),l=i[0].split("_")[1];switch(domLC(o).appendChild(a),a.appendChild(c),l){case"year":n=(s=[[e.year,e.year+""]])[0];break;case"month":s=e.months,n=e.month;break;case"day":n=(s=e.generateDays(e.year,e.month))[e.day-1];break;case"hour":s=e.generateHMS(l),n=m.getHours();break;case"minute":s=e.generateHMS(l),n=m.getMinutes();break;case"second":s=e.generateHMS(l),n=m.getSeconds();break;default:n=s=e[l]}var d={width:t[r][1],multiselect:!1,autocomplete:!1,selectedItems:n};"month"!==l&&"year"!==l||extend(d,{onChange:function(e){B.updateDays()}}),B._sel.push(new Dropdown(c,s,d))}))},setTime:function(){boxQueue.hideLast();var e=B,t=e._sel,i={day:t[0].val(),month:t[1].val(),year:t[2].val(),hour:t[3].val(),minute:t[4].val(),second:t[5].val()},o=new Date(i.year,i.month,i.day,i.hour,i.minute,i.second),r=e.tt;val(r,o.getTime()/1e3)},set:function(e,t){var i=this.setControls,o=this.setTime,r=domData(t,"part");m=new Date;var s=r?"time_"+e+"_input2":"time_"+e+"_input";this.tt=ge(s,n.patternWrap),showFastBox({width:435,title:"Время действия ("+("start"==e?"позже":"раньше")+", чем)",dark:1,containerClass:"nospam_report_time_box",onShow:i},'<div class="reports_time_label">Укажите дату:</div>',"Применить",o)},clear:function(){return this._sel=[]}};function M(e){Object(l.isSpecialKeyPressed)(e)?function(e){var t=Object(s.getParams)();if(t.type=domData(e,"type"),null===t.type)return!1;"post"!==t.type&&"comment"!==t.type||(t.type="wall");t.ip=domData(e,"ip"),t.uahash=domData(e,"ua-hash"),t.pattern=t.pattern||getSelectionText(),t.threshold=1;var i=Object(s.composeSearchLinkFromParams)(t);Object(l.openInNewTab)(i)}(e.target):function(e){var t=domData(e,"type"),i=domData(e,"ip"),o=domData(e,"ua-hash");if(null===t)return;"post"!=t&&"comment"!=t||(t="wall");Object(s.setIp)(i),Object(s.setUaHash)(o),Object(s.setThreshold)(1),cur.uiSpamtype.selectItem(t),Object(n.switchTab)(n.tabPattern),Object(s.optionClear)(!1,"reset_all")}(e.target)}function I(e,t){var i=h[e];h[e]?i&&i!==t&&debugLog("collision for "+e,t,i):h[e]=t}function x(){if(Object(n.getCurrentTab)()===n.tabReports){var e=g(),t=geByClass1("_reports_"+e+"_wrap",n.reportList),i=geByClass1("_report_show_more",domPN(t)),o=domPN(i),r=window.innerHeight||document.documentElement||bodyNode.clientHeight;f=scrollGetY(),isVisible(o)&&Object(n.activeTab)()===n.tabReports&&r+f>i.offsetTop&&i.click()}}function P(){clearTimeout(v),v=setTimeout(y.pbind(g(),b()),1e3)}function R(){var e=Object(d.createModule)({handlers:(e,t)=>{t(n.reportList,"mouseover","report_steps",E),t(n.reportList,"click","report_steps",e=>M(e)),t(n.reportList,"mouseover","report_info_ban_tooltip",e=>function(e){var t=e.target,i=domData(t,"action-index"),o=_[i].ban_tt;o&&showTooltip(t,{text:o,dir:"down",hasover:1,shift:[22,5,0]})}(e)),t(n.reportList,"mouseover","report_info_ua_hash",e=>function(e){var t=e.target,i=domData(t,"ua-hash"),o=h[i];showTooltip(t,{text:o||"[NULL]",dir:"down",hasover:1,shift:[22,5,0]})}(e)),e(document,"scroll",x),t(n.reportList,"click","_report_show_more",e=>{var t=domData(e.target,"need-shift");k(g(),t)}),t(n.reportTabs,"click","report_filter",e=>w(e)),t(n.reportList,"click","_report_btn_update",e=>{y(g(),b())}),t(n.reportTabs,"mouseover","settings_dots_wrap",e=>{var t=geByClass1("settings_dots_wrap");showTooltip(t,{black:!0,text:getTemplate("reports_group_message_tab_tooltip"),className:"group_messages_settings_tt",slideY:15,shift:[98,100,20],dir:"top",showdt:300,hidedt:100,hasover:!0,onCreate:function(){var e;e=ge("search_shift_filter"),cur.hoursShiftSlider=new Slider(e,{width:200,height:100,debounce:10,size:2,value:parseFloat(nav.objLoc.shift/23)||0,onChange:e=>{Object(l.updateUrl)({shift:parseInt(23*e)}),P()},formatHint:e=>langNumeric(parseInt(23*e),["","%s час назад","%s часа назад","%s часов назад"])}),Object(l.initRadioButtons)("group_messages_reports_sorting","sorting_radio_filter_wrap",1)}})})}});cur.destroy.push(()=>{Object(d.destroyModule)(e)})}var N={initUpdate:function(){scrollToY(f)}}},btP0:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("SRfc"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("zxIV"),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("o7bv"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("t7n3"),_web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("k487"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("Egk5"),_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("hmKL"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("gdug"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("98sY"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("lXE5"),uiSearch={destroy:function(e){var t=uiSearch.getFieldEl(e);uiSearch.stopEvents(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeData)(t)},getWrapEl:function(e){return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domClosest)("_wrap",e)},getFieldEl:function(e){return e=ge(e),hasClass("_field",e)?e:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domByClass)(uiSearch.getWrapEl(e),"_field")},stopEvents:function(e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[];each(t,(function(e,t){t.stop()}))},startEvents:function(e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[];each(t,(function(e,t){t.stop(),t.start()}))},init:function init(el,options){if(el&&(el=uiSearch.getFieldEl(el),el)){var wrapEl=uiSearch.getWrapEl(el),delayedInitOptions=!options&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(wrapEl,"init-options");if(delayedInitOptions){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(wrapEl,"init-options",null);var evalScript="(function() { return "+delayedInitOptions+" })()";try{uiSearch.init(el,eval(evalScript))}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,evalScript)}}else if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"inited")){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"inited",1);var onKeyDown=uiSearch.onKeyDown.pbind(el),onBuffer=function(e){if("input"===e.type&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.msie){var t=val(el);if(t===(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"prev-value")||""))return;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"prev-value",t)}setTimeout(uiSearch.onChanged.pbind(el,!1,e),0)},onBlur=uiSearch.onBlurred.pbind(el),mainHandler;if(Object(_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_2__.placeholderInit)(el),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"opts",options),options.suggester)options.suggester.instance=new Suggester(el,extend(options.suggester,{type:options.suggester.type,historyItems:!!options.suggester.history&&options.suggester.historyItems,onSearch:function(e,t,i){e||(options.allowFiltersForEmpty||uiSearch.removeAllFilters(el),uiSearch.hideProgress(el)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(wrapEl,"ui_search_field_empty",!e),options.onChange&&options.onChange.call(el,e,t,i)}})),mainHandler={start:function(){addEvent(el,"blur",onBlur),options.onBlur&&addEvent(el,"blur",options.onBlur),options.onFocus&&addEvent(el,"focus",options.onFocus)},stop:function(){removeEvent(el,"blur",onBlur),options.onBlur&&removeEvent(el,"blur",options.onBlur),options.onFocus&&removeEvent(el,"focus",options.onFocus)}};else{var searchBtn=geByClass1("_ui_search_button_search",wrapEl),onBtnClick=function(e){uiSearch.onEnter(el,e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(el)};mainHandler={start:function(){addEvent(el,"keydown",onKeyDown),addEvent(el,"paste cut input",onBuffer),addEvent(el,"blur",onBlur),options.onBlur&&addEvent(el,"blur",options.onBlur),options.onFocus&&addEvent(el,"focus",options.onFocus),searchBtn&&addEvent(searchBtn,"click",onBtnClick)},stop:function(){removeEvent(el,"keydown",onKeyDown),removeEvent(el,"paste cut input",onBuffer),removeEvent(el,"blur",onBlur),options.onBlur&&removeEvent(el,"blur",options.onBlur),options.onFocus&&removeEvent(el,"focus",options.onFocus),searchBtn&&removeEvent(searchBtn,"click",onBtnClick)}}}if(mainHandler.start(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"eventHandlers",[mainHandler]),options.params){var content=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.se)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(options.params.html));options.paramsTooltip=new _web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_4__.default(geByClass1("_ui_search_params_button",wrapEl),{appendTo:wrapEl,content,autoShow:!1,customShow:!0,offset:[0,-2],shift:options.params.shift?options.params.shift:0}),options.paramsTooltip.build(),setTimeout((function(){(function initScript(){try{eval(options.params.script)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,options.params.script)}}).call(el)}))}options.fixed&&uiSearch.setFixed(el),options.noAutoDestroy||cur.destroy.push(uiSearch.stopEvents.pbind(el)),uiSearch.initFilters(el,options),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.isFunction)(options.onInit)&&options.onInit(el,options)}}},getOptions:function(e){var t=uiSearch.getWrapEl(e),i=geByClass1("_field",t);return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"opts")},toggleParameters:function(e){var t=uiSearch.getWrapEl(e),i=geByClass1("_field",t),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"opts");o.paramsTooltip&&o.paramsTooltip.toggle()},saveHistorySearch:function(e,t,i,o,r,s){t||(t=val(e));var n=uiSearch.getOptions(e);n.suggester&&n.suggester.instance&&n.suggester.instance.saveHistoryItem(t,i,o,r,s)},onEnter:function(e,t){e=uiSearch.getFieldEl(e);var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts"),o=e.getValue();return i.onEnter&&i.onEnter(e,o,t),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t)},onKeyDown:function(e,t){if(cur.preventInputActions&&-1!=[KEY.RETURN,KEY.ESC,KEY.DOWN,KEY.UP].indexOf(t.keyCode))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t);if(t.keyCode==KEY.RETURN)return uiSearch.onEnter(e,t);if(t.keyCode==KEY.ESC){var i=!!val(e);return uiSearch.reset(e,!1,t),!i||Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t)}setTimeout.pbind(uiSearch.onChanged.pbind(e,!1,t),0)},onBlurred:function(e,t){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts");i.onBlur&&i.onBlur.call(e,t)},onChanged:function(e,t,i){e=uiSearch.getFieldEl(e);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts"),r=uiSearch.getWrapEl(e),s=e.getValue?e.getValue():e.value;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(r,"ui_search_field_empty",!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(s)),s||o.allowFiltersForEmpty||uiSearch.removeAllFilters(e),t||o.onChange&&o.onChange.call(e,s,i)},focus:function(e){e=uiSearch.getFieldEl(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(e)},reset:function(e,t,i){e=uiSearch.getFieldEl(e);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts")||{},r=uiSearch.getWrapEl(e);(e.getValue?e.getValue():e.value)?(val(e,""),uiSearch.onChanged(e,t,i),t||o.onEnter&&o.onEnter(e,""),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(e)):o.in_tabs&&_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_6__.default.hideSearch(r),window.tooltips&&tooltips.destroyAll()},showProgress:function(e){e=uiSearch.getFieldEl(e);var t=uiSearch.getWrapEl(e);addClass(t,"ui_search_loading");var i=e.getValue?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(e.getValue()):e.value;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(t,"ui_search_field_empty",!i)},hideProgress:function(e){e=uiSearch.getFieldEl(e);var t=uiSearch.getWrapEl(e);removeClass(t,"ui_search_loading");var i=e.getValue?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(e.getValue()):e.value;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(t,"ui_search_field_empty",!i)},scrollResize:function(e){if(!_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.mobile){e=uiSearch.getFieldEl(e);var t,i=uiSearch.getWrapEl(e),o=i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(i),r=i&&hasClass(i,"ui_search_fixed"),s=ge(cur.uiSearchPageBlock)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("page_block",e),n=vk.staticheader?Math.max(0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_header"))[1]-scrollNode.scrollTop):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_header"))[1],a=i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isAncestor)(i,boxLayerWrap);if(i&&o&&(a||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("scroll_fix",i))&&(!e.ignoreFixed||r)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(o))if(a?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(o,!0)[1]<0:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(o,!0)[1]<n){var c=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getStyle)(e,"width"));!r&&c&&(setStyle(o,"height",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(i)[1]),setStyle(i,"width",c),addClass(i,"ui_search_fixed"));var l=Math.min(0,Math.max(-bodyNode.scrollLeft,bodyNode.clientWidth-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_layout"))[0]));if(setStyle(i,{marginLeft:l}),s){var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(s)[1]+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(s)[1]-Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_9__.scrollGetY)()-e.offsetHeight;(t=Math.min(n,Math.max(-e.offsetHeight,d)))!==cur.lastUISearchPos&&(setStyle(i,"top",t),cur.lastUISearchPos=t)}}else r&&(setStyle(o,"height",""),setStyle(i,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,removeClass(i,"ui_search_fixed"))}},setStatic:function(e){e.ignoreFixed=!0;var t=uiSearch.getWrapEl(e),i=t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(t);t&&i&&(setStyle(i,"height",""),setStyle(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,removeClass(t,"ui_search_fixed"))},setFixed:function(e){if(e.ignoreFixed=!1,!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"resizeEventHandler")){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isAncestor)(e,boxLayerWrap)?boxLayerWrap:window,i=uiSearch.scrollResize.pbind(e),o={stop:removeEvent.pbind(t,"scroll",i),start:addEvent.pbind(t,"scroll",i)};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers",(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[]).concat([o])),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"resizeEventHandler",!0),o.start()}uiSearch.scrollResize(e)},initFilters:function(e,t){if(e){var i=uiSearch.getWrapEl(e),o=geByClass1("ui_search_fltr_control",i),r={start:function(){addEvent(o,"click",(function(e){hasClass(o,"shown")&&!hasClass(e.target,"ui_search_fltr_control")||n(o)})),addEvent(o,"mouseover",(function(){if(hasClass(o,"shown")){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer");e&&(clearTimeout(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer",0)),n(o,!0)}})),addEvent(o,"mouseout",(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer",setTimeout((function(){n(o,!1),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer",0)}),200))}))},stop:removeEvent.pbind(o,"click mouseover mouseout")};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers",(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[]).concat([r])),r.start();var s=uiSearch._getFiltersPane(e);addEvent(s,"click",(function(t){if(hasClass(t.target,"token_title")||hasClass(t.target,"token_del")){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("token",t.target),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(i,"id");uiSearch.removeFilter(e,o)}}))}function n(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(e,"shown",t)}},removeAllFilters:function(e){var t=uiSearch._getFiltersPane(e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(t,"cur_filters");each(extend({},i),(function(t){uiSearch.removeFilter(e,t,!0)}))},toggleFilter:function(e,t,i,o){o?uiSearch.addFilter(e,t,i):uiSearch.removeFilter(e,t)},addFilter:function(e,t,i){if(t&&i){var o=uiSearch._getFiltersPane(e),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters")||{};r[t]=i,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters",r),uiSearch._renderFilters(e)}},removeFilter:function(e,t,i){var o=uiSearch._getFiltersPane(e),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters")||{};if(r[t]){delete r[t],Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters",r);var s=uiSearch.getOptions(e);s.onFilterRemoved&&s.onFilterRemoved(t,e,i),uiSearch._renderFilters(e)}},_getFiltersPane:function(e){var t=uiSearch.getWrapEl(e)||e;return geByClass1("ui_search_filters_pane",t)},_renderFilters:function(e){clearTimeout(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"renderFiltersTO")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"renderFiltersTO",setTimeout(uiSearch._doRenderFilters.pbind(e)))},_doRenderFilters:function(e){var t=uiSearch._getFiltersPane(e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(t,"cur_filters")||{},o=geByClass1("ui_search_filters",t);if(o)if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.isEmpty)(i))removeClass(t,"expanded"),setTimeout((function(){o.innerHTML="",hide(t)}),200);else{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClassDelayed)(t,"expanded");var r=[],s={},n=0;each(i,(function(e,t){var i=!1,o=!1,a=e.match(/(.*?)_([^_]+)$/),c=a&&a[2]||!1;(a=a&&a[1]||!1)&&(void 0!==s[a]&&"from"===c?o=s[a]:void 0!==s[a]&&(i=s[a]+1),s[a]=n);var l=`<div class="token" id="token${e}" data-id="${e}">\n                         <div class="token_title">${Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.replaceEntities)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)(t))}</div>\n                         <div class="token_del"></div>\n                       </div>`;!1!==o?r.splice(o,0,l):!1!==i?r.splice(i,0,l):r.push(l),n++})),o.innerHTML=r.join("")}}};__webpack_exports__.default=uiSearch},clTp:function(e,t,i){"use strict";function o(e){var t=e.getBoundingClientRect(),i=document.body,o=document.documentElement,r=window.pageYOffset||o.scrollTop||i.scrollTop,s=window.pageXOffset||o.scrollLeft||i.scrollLeft,n=o.clientTop||i.clientTop||0,a=o.clientLeft||i.clientLeft||0;return{top:Math.round(t.top+r-n),left:Math.round(t.left+s-a),width:e.offsetWidth,height:e.offsetHeight}}i.r(t),i.d(t,"default",(function(){return o}))},dI71:function(e,t,i){"use strict";function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}i.r(t),i.d(t,"default",(function(){return o}))},dLHM:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=(i("17x9"),i("pemR"));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}class a extends o.Component{constructor(e){super(e),this.onChange=e=>{this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.getRef=e=>{this.element=e},void 0!==e.value||e.isControlledOutside?this.isControlledOutside=!0:this.state={value:e.initialValue||""}}render(){var e=this.props,t=e.alignment,i=e.value,a=(e.onChange,e.initialValue,e.className),c=(e.isControlledOutside,n(e,["alignment","value","onChange","initialValue","className","isControlledOutside"])),l={"Input--left":"left"===t,"Input--center":"center"===t,"Input--right":"right"===t};return o.createElement("input",s({},c,{className:Object(r.classNames)("Input",l,a),ref:this.getRef,value:this.isControlledOutside?i:this.state.value,onChange:this.onChange}))}}a.defaultProps={type:"text",initialValue:"",alignment:"left"}},dRu9:function(e,t,i){"use strict";i.r(t),i.d(t,"UNMOUNTED",(function(){return u})),i.d(t,"EXITED",(function(){return p})),i.d(t,"ENTERING",(function(){return _})),i.d(t,"ENTERED",(function(){return h})),i.d(t,"EXITING",(function(){return m}));var o=i("zLVn"),r=i("dI71"),s=(i("17x9"),i("q1tI")),n=i.n(s),a=i("i8i4"),c=i.n(a),l=i("KkKZ"),d=i("0PSK"),u="unmounted",p="exited",_="entering",h="entered",m="exiting",v=function(e){function t(t,i){var o;o=e.call(this,t,i)||this;var r,s=i&&!i.isMounting?t.enter:t.appear;return o.appearStatus=null,t.in?s?(r=p,o.appearStatus=_):r=h:r=t.unmountOnExit||t.mountOnEnter?u:p,o.state={status:r},o.nextCallback=null,o}Object(r.default)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===u?{status:p}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==_&&i!==h&&(t=_):i!==_&&i!==h||(t=m)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,i,o=this.props.timeout;return e=t=i=o,null!=o&&"number"!=typeof o&&(e=o.exit,t=o.enter,i=void 0!==o.appear?o.appear:t),{exit:e,enter:t,appear:i}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t){this.cancelNextCallback();var i=c.a.findDOMNode(this);t===_?this.performEnter(i,e):this.performExit(i)}else this.props.unmountOnExit&&this.state.status===p&&this.setState({status:u})},i.performEnter=function(e,t){var i=this,o=this.props.enter,r=this.context?this.context.isMounting:t,s=this.getTimeouts(),n=r?s.appear:s.enter;!t&&!o||l.default.disabled?this.safeSetState({status:h},(function(){i.props.onEntered(e)})):(this.props.onEnter(e,r),this.safeSetState({status:_},(function(){i.props.onEntering(e,r),i.onTransitionEnd(e,n,(function(){i.safeSetState({status:h},(function(){i.props.onEntered(e,r)}))}))})))},i.performExit=function(e){var t=this,i=this.props.exit,o=this.getTimeouts();i&&!l.default.disabled?(this.props.onExit(e),this.safeSetState({status:m},(function(){t.props.onExiting(e),t.onTransitionEnd(e,o.exit,(function(){t.safeSetState({status:p},(function(){t.props.onExited(e)}))}))}))):this.safeSetState({status:p},(function(){t.props.onExited(e)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(o){i&&(i=!1,t.nextCallback=null,e(o))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},i.onTransitionEnd=function(e,t,i){this.setNextCallback(i);var o=null==t&&!this.props.addEndListener;e&&!o?(this.props.addEndListener&&this.props.addEndListener(e,this.nextCallback),null!=t&&setTimeout(this.nextCallback,t)):setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===u)return null;var t=this.props,i=t.children,r=Object(o.default)(t,["children"]);if(delete r.in,delete r.mountOnEnter,delete r.unmountOnExit,delete r.appear,delete r.enter,delete r.exit,delete r.timeout,delete r.addEndListener,delete r.onEnter,delete r.onEntering,delete r.onEntered,delete r.onExit,delete r.onExiting,delete r.onExited,"function"==typeof i)return n.a.createElement(d.default.Provider,{value:null},i(e,r));var s=n.a.Children.only(i);return n.a.createElement(d.default.Provider,{value:null},n.a.cloneElement(s,r))},t}(n.a.Component);function f(){}v.contextType=d.default,v.propTypes={},v.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:f,onEntering:f,onEntered:f,onExit:f,onExiting:f,onExited:f},v.UNMOUNTED=0,v.EXITED=1,v.ENTERING=2,v.ENTERED=3,v.EXITING=4,t.default=v},hmKL:function(e,t,i){"use strict";i.r(t);var o=i("zxIV"),r=i("t7n3"),s=i("gdug"),n=i("Egk5"),a={initTabs:function(e,t){if(!(s.browser.msie&&Object(r.intval)(s.browser.version)<10||s.browser.opera&&Object(r.intval)(s.browser.version)<15||hasClass(e,"ui_tabs_sliding"))){var i=Object(o.getSize)(t)[0],n=t.offsetLeft,a=Object(o.geByClass1)("_ui_tabs_slider",e);if(!Object(o.domData)(e,"inited"))setStyle(a,{width:i+"px",marginLeft:n})}},tryInit:function(e){if(!Object(o.domData)(e,"inited")){var t=Object(o.geByClass1)("ui_tab_group_sel",e)||Object(o.geByClass1)("ui_tab_sel",e);t&&a.initTabs(e,t),Object(o.domData)(e,"inited",1)}},goTab:function(e,t,i){if(Object(n.checkEvent)(t))return!0;var r=Object(o.gpeByClass)("ui_tabs",e);return!(!i&&Object(o.geByClass1)("ui_tab_sel",r)==e)&&(a.switchTab(e),a.showProgress(r),nav.go(e,t,{tab:e}))},switchTab:function(e,t){var i=Object(o.gpeByClass)("ui_tabs",e),s=Object(o.geByClass1)("ui_tab_sel",i),n=null,c=null,l=hasClass(s,"ui_tab_group_item")?c=Object(o.gpeByClass)("ui_tab_group",s):s,d=hasClass(e,"ui_tab_group_item")?n=Object(o.gpeByClass)("ui_tab_group",e):e;if(e!=s){if(e!=d&&(a.toggleGroup(d,!1),a.resetLabel(d,e)),l){a.initTabs(i,l),(t=t||{}).noAnim||d===l||(addClass(i,"ui_tabs_sliding"),clearTimeout(cur.tabSlidingTO),cur.tabSlidingTO=setTimeout(removeClass.pbind(i,"ui_tabs_sliding"),300));var u=Object(o.geByClass1)("_ui_tabs_slider",i),p=Object(r.intval)(u.style.marginLeft),_={width:Object(o.getSize)(d)[0]+"px"};_[cssTransformProp]="translateX("+(d.offsetLeft-p)+"px)",setStyle(u,_),s!=l&&d!=l&&a.resetLabel(l),l!=s&&removeClass(l,"ui_tab_group_sel"),removeClass(s,"ui_tab_sel")}if(d!=e&&addClass(d,"ui_tab_group_sel"),addClass(e,"ui_tab_sel"),c&&removeClass(c,"ui_tab_hide_separator"),n){i=Object(o.geByClass1)("ui_tab_group_items",n,"div").children;var h=null;each(i,(function(e,t){"SPAN"===t.tagName?h=t:hasClass(Object(o.domFC)(t),"ui_tab_sel")||hasClass(t,"unshown")||(h=null)})),h&&addClass(n,"ui_tab_hide_separator")}}return!1},resetLabel:function(e,t){var i=Object(o.geByClass1)("ui_tab_group_label",e,"span");i&&(i.innerHTML=(t||i).getAttribute("data-default-label"))},toggleGroup:function(e,t){var i=Object(o.data)(e,"visibletimer");i&&clearTimeout(i),Object(o.data)(e,"visibletimer",setTimeout(o.toggleClass.pbind(e,"visible",t),t?0:100)),Object(o.toggleClass)(e,"shown",t)},showGroup:function(e){var t=Object(o.data)(e,"hidetimer");t&&(clearTimeout(t),Object(o.data)(e,"hidetimer",0)),a.toggleGroup(e,!0)},hideGroup:function(e){Object(o.data)(e,"hidetimer")||Object(o.data)(e,"hidetimer",setTimeout((function(){a.toggleGroup(e,!1),Object(o.data)(e,"hidetimer",0)}),200))},showProgress:function(e){hasClass(e,"ui_tabs")||(e=Object(o.gpeByClass)("ui_tabs",e)),addClass(e,"ui_tabs_loading")},hideProgress:function(e){hasClass(e,"ui_tabs")||(e=Object(o.gpeByClass)("ui_tabs",e)),removeClass(e,"ui_tabs_loading")},showSearch:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(Object(n.checkEvent)(t))return!0;var i=Object(o.gpeByClass)("ui_tabs",e),r=Object(o.domByClass)(i,"_field");return addClass(i,"ui_tabs_search_opened"),uiSearch.focus(r),!1},hideSearch:function(e,t){if(Object(n.checkEvent)(t))return!0;var i=Object(o.gpeByClass)("ui_tabs",e);return removeClass(i,"ui_tabs_search_opened"),!1}};t.default=a},lBJi:function(e,t,i){"use strict";i.r(t),i.d(t,"Emoji",(function(){return K}));i("a1Th"),i("rE2o"),i("ioFf"),i("Vd3H"),i("91GP"),i("KKXr"),i("rGqo"),i("Btvt"),i("HEwt"),i("Oyvg"),i("SRfc"),i("pIFo");var o=i("S6+Z"),r=i("TxR4"),s=i("yqpO"),n={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},a=Object.keys(n).reduce((e,t)=>(e[t]=n[t].map(e=>Object(r.emojiSymbolToByteHex)(e)),e),{});i("hhXQ");function c(e,t){var i=e;return e>68&&(i=68),t>68&&(i=68*e/t),[i,i*(t/e)]}var l=i("W9Tc"),d=i("t7n3"),u=i("zxIV");i("/8Fb");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var m=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],v=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],f=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],g=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],b=new RegExp(`(${g.join(")|(")})`);function y(e,t){return"amount"===e?function(e){var t=e.match(b);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var w=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...m,...v,...f,...g].join("|")}))+)\\s*$`),S=new RegExp(`(${m.join("|")})|(${v.join("|")})|(${f.join("|")})|(${g.join("|")})`,"gi"),k={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=e.toLowerCase().replace(/ё/g,"е").match(w);if(t){for(var i={input:e,request:t[1],send:t[2],context:t[3]};t=S.exec(i.context),t;)for(var o={receiver:t[1],subject:t[2],method:t[3],amount:t[4]},r=0,s=Object.entries(o);r<s.length;r++){var n=_(s[r],2),a=n[0],c=n[1];c&&(i[a]=y(a,c))}if(i.subject||i.method||i.amount)return i}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(this.introViewed){var s=[e,t,i,o].join("_");showBox("al_payments.php",{act:"money_transfer_box",tab:i,amount:o,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===s,onDone:()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=r.onSendStart)}}),this.lastBoxId=s}else showWiki(p({w:"moneysend_promo",fromId:e,toId:t,action:i},o?{amount:o}:{})),this.introViewed=!0}},E=i("jE6c");function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var j=Object.entries(o.EMOJI_HINTS).map(e=>{var t=O(e,2),i=t[0],o=O(t[1],2),r=(o[0],o[1]);return[new RegExp(`(\\s|^)(${Object(E.escapeRE)(r)}${r.endsWith(")")||r.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),i]}),T={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?T["\\"]="ё":T["`"]="ё";var L=new RegExp(`[${Object(E.escapeRE)(Object.keys(T).join(""))}]`,"gi"),B=e=>e.replace(L,e=>T[e]),M=Object.entries(T).reduce((e,t)=>{var i=O(t,2),o=i[0];return e[i[1]]=o,e}),I=new RegExp(`[${Object(E.escapeRE)(Object.keys(M).join(""))}]`,"gi"),x=e=>e.replace(I,e=>M[e]);var P=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=j.reduce((e,t)=>{var i=O(t,2),o=i[0],s=i[1];return e.replace(o,(e,t,i,o)=>(t||"")+Object(r.emojiByteHexToSymbol)(s)+(o||""))},e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var o=[e=Object(r.emojiRemoveSkinToneModifiers)(e)],s=0,n=[...o];s<n.length;s++){var a=n[s];o.push(B(a)),o.push(x(a))}for(var c=0,l=[...o];c<l.length;c++){var d=l[c];o.push(d.replace(/ё/g,"е")),o.push(d.replace(/е/g,"ё"))}for(var u=0,p=[...o];u<p.length;u++){var _=p[u];o.push(_.replace(/[.!?]+$/,""))}return Object.keys(o.reduce((e,t)=>(e[t]=1,e),{}))}isBotLinkEnabled(){return Object(l.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId}getBotLinkUrl(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"}getBotLinkImageUrl(e){return`/images/stickers_suggestions_bot_light_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return Object(l.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}},R=i("QGEU"),N=i("v+DW"),D=i("EasH"),A=i("FWc3"),H=i("4+be");function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return W(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return W(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var K={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},DELETE_FAV_STICKER_ELEMENTS_DELAY:500,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),init:function(e,t){var i=K.last;K.tabDefaultId=K.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=gpeByClass("_emoji_field_wrap",e),t.emojiWrap=domByClass(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=domByClass(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&Object(u.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=vkNow(),t.deletedFavoriteStickers=[],t.deleteFavoriteStickersTimeout=null,t.suggestions=new P(t.suggestionsConfig);var o=Object(d.isRetina)()?128:64;if(K.stickerSizes[o]=!0,t.forceTxt)t.editable=0,placeholderInit(e);else{if(t.editable=1,setTimeout((function(){placeholderInit(e,{editable:1,editableFocus:K.editableFocus,global:t.global}),t.shouldFocus&&K.editableFocus(e,!1,!0)}),0),browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}addEvent(window,"mousemove",K.preventMouseOverHandle),addEvent(e,browser.opera&&!browser.chrome?"click":"mousedown",(function(o){if(o.target&&"IMG"==o.target.tagName&&K.getCode(o.target))return K.editableFocus(e,o.target,o.offsetX>8),cancelEvent(o);K.shown&&K.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&addEvent(e,"blur",(function(t){e.textContent||e.innerText||each(geByTag("br",e),(function(e,t){re(t)}))})),addEvent(e,"keypress keydown keyup input paste",(function(o){if(o.canceled)return!1;if("keydown"===o.type){t.onChange&&(K.raw[i]=e.innerHTML);var r=t.ctrlSend?t.ctrlSend():t.noEnterSend;if(o.keyCode==KEY.RETURN||10==o.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),cancelEvent(o);var s=cur.ctrl_submit&&!t.noCtrlSend;if((s||r)&&(o.ctrlKey||browser.mac&&o.metaKey)||!s&&!o.shiftKey&&!(o.ctrlKey||browser.mac&&o.metaKey)){var n=Object(u.data)(e,"composer");if(!K.emojiEnter(i,o)||!K.stickerHintMove(o)||n&&n.wdd&&isVisible(n.wdd.listWrap))return!1;if(!r||o.ctrlKey||browser.mac&&o.metaKey)return K.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),cancelEvent(o)}if(t.noLineBreaks)return cancelEvent(o)}if(o.ctrlKey&&o.keyCode==KEY.RETURN){var a=this.value;if(t.editable)K.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var c=this.selectionStart;this.value=a.slice(0,c)+"\n"+a.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=c+1}else if(document.selection&&document.selection.createRange){this.focus();var d=document.selection.createRange();d.text="\r\n",d.collapse(!1),browser.opera&&!browser.chrome&&(d.moveEnd("character",0),d.moveStart("character",0)),d.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}var p=Object(R.hasAccessibilityMode)()&&Object(l.partConfigEnabled)("emoji_tooltip_a11y_mode");if(o.keyCode===KEY.TAB&&!(o.ctrlKey||browser.mac&&o.metaKey)&&!p){var _=geByClass1("_sticker_hints",domPN(t.txt));if(_&&isVisible(_)){var h=geByClass1("over",_);if(h?K.stickerHintKeyOut(i,h):K.stickerHintKeyOver(i,geByClass1("emoji_sticker_item",_)),!K.shown)return cancelEvent(o)}return K.shown?(K.editableFocus(e,!1,!0,void 0,!0),K.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0)):K.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!1,!0,void 0,!0),cancelEvent(o)}if(o.keyCode==KEY.ESC){var m=geByClass1("_sticker_hints",domPN(t.txt)),v=!1;if(m&&isVisible(m)&&(K.stickerHintKeyOut(i,geByClass1("emoji_sticker_item",m)),K.stickersHintsHide(m,t,100),v=!0),K.shown&&(K.editableFocus(e,!1,!0,void 0,!0),K.ttClick(i,geByClass1("emoji_smile",t.controlsCont),!0),v=!0),v)return cancelEvent(o);if(t.onEsc)return t.onEsc(o)}}return"paste"===o.type?(K.onEditablePaste(e,t,i,o),t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),K.checkStickersKeywords(i,t)):"keyup"===o.type?(!t.noLineBreaks||e.textContent||e.innerText||each(geByTag("br",e),(function(e,t){re(t)})),t.checkEditable&&t.checkEditable(i,e),K.checkStickersKeywords(i,t),t.onChange&&(K.raw[i]!=e.innerHTML&&K.onChange(t),delete K.raw[i])):"keydown"!==o.type&&"input"!==o.type||(t.checkEditable&&setTimeout(t.checkEditable.pbind(i,e),0),K.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(o),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(o),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,K.lcRecv,!0),K.initStickersKeywords(),K.initPromotedStickerUrls(),K.checkNewStickers(t),K.opts[K.last]=t,K.last++},setSuggestionsConfig:function(e,t){K.opts[e].suggestions.setConfig(t)},onChange:function(e){Object(E.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){K.preventMouseOver=!1},lcRecv:function(e){switch(e.act){case"updateTabs":K.updateTabs(e.newStickers,e.keywords)}},correctCaret:function(e){var t=e?function(e){var t=e.getBoundingClientRect(),i=null,o=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(i=(o=document.selection.createRange()).getClientRects()||[]).length||(o.text="_",o.moveStart("character",-1),i=o.getClientRects(),o.text=""),i=i[i.length-1];else if(window.getSelection){var r=getSelection();if(r.anchorNode){if((o=r.getRangeAt(0)).collapsed){var s=o.startOffset;o.setStart(o.startContainer,0),i=o.getClientRects(),o.setStart(o.startContainer,s)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var i=t.replace(/\n/g,"<br/>"),o=ce("div",{innerHTML:i});K.cleanCont(o),K.insertHTML(o.innerHTML)}},insertWithoutNL:function(e,t){if(t){var i=t.replace(/\n/g,""),o=ce("div",{innerHTML:i});K.cleanCont(o),K.insertHTML(o.innerHTML)}},focusTrick:function(e,t,i,o,r){r||(r=e);var s=ce("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(s),s.focus(),setTimeout((function(){var n=r.scrollTop;re(s),e.focus(),r.scrollTop=n,K.setRange(o),t(clean(val(s))),i(e)}),0)},finalizeInsert:function(e){K.cleanCont(e),setTimeout(K.correctCaret.pbind(e),10)},getClipboard:function(e){return e.clipboardData?clean(e.clipboardData.getData("text")):!!window.clipboardData&&clean(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,o){if(null!=e.clipboardData){var r=function(){var r=e.clipboardData;function s(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var r=new Image;return r.crossOrigin="anonymous",r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r,0,0,e.width,e.height),e.toBlob((function(e){!function(e){var o,r;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+irand(0,100)+".png",hasClass(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else o="post_field"==t.id?cur.wallAddMedia:(r=Object(u.data)(t,"composer"))&&r.addMedia;o&&Object(E.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,o,e)}(e)}),"image/png"),o(!0)},r.src=e}}if(r.items){for(var n=!1,a=0,c=r.items.length;a<c;a++){var l=r.items[a];if(l.type.match(/^image\//)){var d=new FileReader;d.onload=function(e){return s(e.target.result)},d.readAsDataURL(l.getAsFile()),n=!0}else if("text/plain"===l.type)return{v:o()}}return{v:n}}if(-1!==Array.prototype.indexOf.call(r.types,"text/plain"))return{v:o()};!function(e){for(var i=Math.floor(1e3*Math.random()),r=geByTag("img",t),s=0,n=r.length;s<n;s++){r[s]["_before_paste_"+i]=!0}setTimeout((function(){for(var r=geByTag("img",t),s=!1,n=0,a=r.length;n<a;n++){var c=r[n];c["_before_paste_"+i]||(e(c.src),re(c),s=!0)}s||o()}),1)}((function(e){return s(e)}))}();if("object"==typeof r)return r.v}else o()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;var t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;var i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,o,r){var s=!1;"true"===e.getAttribute("contenteditable")&&(s=K.getRange());var n=this.getClipboard(o),a=n&&s&&!r;this.detectInvalidClipboardData(o)&&cancelEvent(o),(this.processImagePaste(o,e,t,function(i){i||(a?(t.noLineBreaks?this.insertWithoutNL(s,n):this.insertWithBr(s,n),setTimeout(this.finalizeInsert.bind(this,e),0)):s&&this.focusTrick(e,t.noLineBreaks?this.insertWithoutNL.pbind(s):this.insertWithBr.pbind(s),this.finalizeInsert.bind(this,e),s))}.bind(this))||a)&&cancelEvent(o),K.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var i=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",K.cleanCont(t);else if("IMG"==t.tagName)K.getCode(t)||re(t);else if("BR"!=t.tagName){var r=K.editableVal(t,{saveEmoji:!0}),n=cf(clean(r).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(n,t)}break;case 3:var a=clean(t.textContent||t.innerText),c=Object(o.emojiRegex)();a&&a.match(c)&&(a=a.replace(c,s.emojiReplace),t.parentNode.replaceChild(cf(a),t))}t=i}},focus:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];K.editableFocus(e,!1,!0);var o=i||e.parentNode;if(t){var r=getXY(o)[1],s=scrollGetY(),n=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=getSize(o)[1];s+n<r+a?scrollToY(r-n+a+60,100):s>r&&scrollToY(r-60,100)}},destroy:function(e){if(K.opts.hasOwnProperty(e)){var t=K.opts[e];t.txt&&t.txt.blur(),t.imagesLoader&&t.imagesLoader.destroy(),e===K.shownId&&(K.shownId=!1,K.shown=!1),delete K.opts[e]}},editableFocus:function(e,t,i,o,r){if(!e||r&&document.activeElement===e)return!1;if((e=ge(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var s=window.getSelection();if(!browser.opera||browser.chrome||i){var n=document.createRange();t?n.selectNode(t):n.selectNodeContents(e),browser.mozilla&&"<br>"===e.innerHTML&&(e.innerHTML=""),o||n.collapse(!i),(s=window.getSelection()).removeAllRanges(),s.addRange(n)}else s.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(t||e),a.collapse(!i),a.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return K.editableVal(e);t=(t=Object(s.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,K.updateStickersHints();var i=Object(u.data)(e,"composer");return i&&window.Composer&&setTimeout(Composer.updateAutoComplete.pbind(i)),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return val(e);for(var i,o=e.firstChild,r="",s=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");o;){switch(o.nodeType){case 3:r+=i=o.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(i=K.editableVal(o),o.tagName&&o.tagName.match(s)&&i){"\n"!=i.substr(-1)&&(i+="\n");for(var n=o.previousSibling;n&&3==n.nodeType&&""==trim(n.nodeValue);)n=n.previousSibling;!n||n.tagName&&(n.tagName.match(s)||"BR"==n.tagName)||(i="\n"+i)}else if("IMG"==o.tagName){var a=K.getCode(o);a&&(t&&t.saveEmoji?i+=K.getEmojiHTML(a):i+=K.codeToChr(a))}else"BR"==o.tagName&&(i+="\n");r+=i}o=o.nextSibling}return r},cssEmoji:o.EMOJI_HINTS,getEmojiHTML:s.getEmojiHTML,codeToChr:r.emojiByteHexToSymbol,checkEditable:function(e,t,i){var o=t.scrollHeight,r=K.opts[e];if(!r)return!1;r.scPaddings||(r.scPaddings=intval(getStyle(t,"paddingTop"))+intval(getStyle(t,"paddingBottom"))),o-=r.scPaddings;var s=r.tt;if(o>i.height+(browser.mozilla&&r.isChat?0:5)){if(!r.isSized){setStyle(t,{height:i.height+"px",overflowY:"auto"});var n=geByClass1("emoji_smile",r.controlsCont),a=geByClass1("emoji_smile_icon_promo",r.controlsCont),c=ge("im_upload"),l=Object(N.sbWidth)();r.ttWrap&&(l+=getSize(r.ttWrap)[0]-(getXY(r.emojiBtn)[0]-getXY(r.ttWrap)[0])),setStyle(n,vk.rtl?{left:1+l}:{right:1+l}),a&&setStyle(a,vk.rtl?{left:2+l}:{right:2+l}),c&&setStyle(c.parentNode,vk.rtl?{left:1+l}:{right:1+l}),s&&setStyle(s,vk.rtl?{left:(r.ttDiff||31)+l}:{right:(r.ttDiff||31)+l}),r.isSized=!0}}else if(r.isSized){setStyle(t,{height:"auto",overflowY:"hidden"});var d=geByClass1("emoji_smile",r.controlsCont),u=geByClass1("emoji_smile_icon_promo",r.controlsCont),p=ge("im_upload");setStyle(d,vk.rtl?{left:1}:{right:1}),u&&setStyle(u,vk.rtl?{left:2}:{right:2}),p&&setStyle(p.parentNode,vk.rtl?{left:1}:{right:1}),s&&setStyle(s,vk.rtl?{left:r.ttDiff||31}:{right:r.ttDiff||31}),r.isSized=!1}r.onResize&&r.onResize()},stickersHintsShow:function(e,t,i){(isVisible(e)||fadeIn(e,i),t.stickerEventsInited)||((e&&geByClass1("_sticker_hints_inner",e)).addEventListener("wheel",K.onWheelStickersHints),addEvent(document,"keydown",K.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},addEvent(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&(removeEvent(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(o){if(t.hintsClicked)return cancelEvent(o),!0;K.stickersHintsHide(e,t,i)},addEvent(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);K.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){(fadeOut(e,i),removeEvent(document,"keydown",K.stickerHintMove),t.onHintsMouseDown&&removeEvent(e,"mousedown",K.onHintsMouseDown),t.onHintsWheel)&&(e&&geByClass1("_sticker_hints_inner",e)).removeEventListener("wheel",K.onWheelStickersHints);t.txt&&(t.onTxtBlur&&(removeEvent(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&removeEvent(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&geByClass1("_sticker_hints",domPN(t.txt));e&&!isVisible(e)&&(delete t.stickerHintsString,K.checkStickersKeywords(t.id,t,!1))},addEvent(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete K.shownHintId,K.sendHintsLog()},stickerHintOver:function(e){K.stickerHintOut(e),addClass(e,"over")},stickerHintOut:function(e){each(geByClass("over",domPN(e)),(function(){removeClass(this,"over")}))},stickerHintClick:function(e,t,i,o){var r=K.opts[e]||{},s=r.txt,n=s&&geByClass1("_sticker_hints",domPN(s)),a="suggestion_"+K.stickerSuggestionQuery;return"stories"===r.ref&&(a="story_suggestion_"+K.stickerSuggestionQuery),t<0?K.previewSticker(!1,o,{stickerId:-t,sticker_referrer:a}):(val(s,""),K.stickerClick(e,t,256,i,o,a),r.checkEditable&&r.checkEditable(e,s)),K.stickersHintsHide(n,r,0),!1},stickerHintKeyOver:function(e,t){K.stickerHintOver(t),K.shownHintId=e},stickerHintKeyOut:function(e,t){K.stickerHintOut(t),delete K.shownHintId},stickerHintMove:function(e){var t=K.shownHintId;if(void 0===t)return!0;var i=K.opts[t],o=i&&geByClass1("_sticker_hints",domPN(i.txt));if(o&&isVisible(o)){var r=geByClass1("over",o)||geByClass1("emoji_sticker_item",o);switch(e.keyCode){case KEY.LEFT:return(r=domPS(r))&&(K.stickerHintOver(r),K.checkStickersHintsScroll(r)),cancelEvent(e),!1;case KEY.RIGHT:return(r=domNS(r))&&(K.stickerHintOver(r),K.checkStickersHintsScroll(r)),cancelEvent(e),!1;case KEY.ENTER:return r.click(),cancelEvent(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&(addClass(e,"_margin_transition"),Object(u.removeClassDelayed)(e,"_margin_transition")),setStyle(e,{marginLeft:0});var o=getXY(e),r=getSize(e),s=K.getEmojiTtXY(t.tt);t.tt&&s&&s[0]&&o[0]+r[0]+10>s[0]&&o[1]+r[1]>s[1]&&setStyle(e,{marginLeft:s[0]-o[0]-r[0]-10}),domFC(e)||K.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&hasClass(e,K.SHOWN_TT_CLS)?getXY(e):[0,0]},hintaches:{},hintachesNotFoundStickers:{},checkHintaches:function(e,t,i){if(Object(l.partConfigEnabled)("hintach"))return K.hintaches[e]?requestAnimationFrame(()=>K.renderHintaches(e,t,i,K.hintaches[e])):void ajax.post("/hintach",{query:e},{onDone:o=>{K.hintaches[e]=o,K.renderHintaches(e,t,i,K.hintaches[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(i)){var o=K.opts[i]||{},r=o.txt,s=r&&geByClass1("_sticker_hints",domPN(r)),n=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var i=t[1],o=parseInt(t[2]),r=parseInt(t[3]),s=[o,r].join("_");return{type:i,ownerId:o,id:r,rawId:s}}(t);return n&&o.onHintachSend&&(val(r,""),o.onHintachSend(n.type,n.rawId),o.checkEditable&&o.checkEditable(i,r),K.stickersHintsHide(s,o,0)),!1}},renderHintaches:function(e,t,i,o){var r=t.txt,s=geByClass1("_sticker_hints",domPN(r)),n=isArray(o.photos)&&o.photos.length||isArray(o.docs)&&o.docs.length;if(e&&t.stickerHintsString&&n){var a=s&&geByClass1("_sticker_hints_inner",s);if(!a||t.noStickers)return!1;K.clearHintsLog(),K.hintachesNotFoundStickers[e]&&(a.innerHTML="");var l=a.querySelector(".Hintach");l||(l=a.appendChild(ce("div",{className:"Hintach"}))),l.setAttribute("data-opt",t.id),l.innerHTML="";var d=64*window.devicePixelRatio,u=64*window.devicePixelRatio;(o.photos||[]).forEach(e=>{var t=function(e,t,i){if(!e||!t||!i)return null;var o=Object.values(e).sort((e,t)=>e[1]-t[1]||e[2]-t[2]);return o.find(e=>e[1]>=t&&e[2]>=i)||o[parseInt(o.length/2)]||o[0]}(e.sizes,d,u);if(t){var i=F(t,3),o=i[0],r=F(c(i[1],i[2]),2),s=r[0],n=r[1],a=ce("div",{className:"Hintach__item Hintach__item--photo"});a.setAttribute("data-hint","photo"+e.id),a.appendChild(ce("div",{className:"Hintach__itemThumb"},{width:s,height:n,backgroundImage:`url(${o})`})),a.onclick=K.onHintachItemClick,l.appendChild(a)}}),(o.docs||[]).forEach(e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=F(e.preview.video||e.preview.graffiti,3),i=t[0],o=F(c(t[1],t[2]),2),r=o[0],s=o[1],n=ce("div",{className:"Hintach__item Hintach__item--doc"});n.setAttribute("data-hint","doc"+e.id);var a=n.appendChild(ce(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:i},{width:r,height:s}));e.preview.video&&(n.appendChild(ce("div",{className:"Hintach__itemType",innerHTML:"GIF"})),a.autoplay=!0,a.loop=!0),n.onclick=K.onHintachItemClick,l.appendChild(n)}}),l.childElementCount>0&&(K.stickersHintsShow(s,t,100),a.scrollLeft=0,K.checkStickersHintsScroll(s,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){var o=K.opts[e],r=o.txt.parentNode.querySelector("._sticker_hints");if(K.stickersHintsHide(r,o,0),"send"===t&&o.suggestions.isMoneySendEnabled()||"request"===t&&o.suggestions.isMoneyRequestEnabled()){var s=o.suggestions.config,n=s.fromId,a=s.peer;k.onClick(n,a,t,i,{onSendStart:()=>{o.clearText&&o.clearText()}});var c=K.moneyTransferTextMatch&&K.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","select",[t],c)}},renderMoneyTransferSuggestions:function(e,t){var i=K.opts[e],o=Object(d.isRetina)()?128:64,r={};return i.suggestions.isMoneyRequestEnabled()?r.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${o}.png" />\n      </a>`:r.request="",i.suggestions.isMoneySendEnabled()?r.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${o}.png" />\n      </a>`:r.send="",t.request?r.request+r.send:r.send+r.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var o=i?0:100,r=t.txt,s=geByClass1("_sticker_hints",domPN(r)),n=function(i,o){if(K.stickers[K.TAB_RECENT_STICKERS]){var r=K.sortStickersHints(window.stickersKeywords[i]),n=K.stickers[K.TAB_RECENT_STICKERS].promoted,a="";o&&(a+=K.renderMoneyTransferSuggestions(e,o)),each(r,(function(){a+=K.render.stickerHintRs(e,this,n[this])})),t.suggestions.isBotLinkEnabled()&&(a+=K.renderSuggestionsBotLink(e)),K.showStickersHints(s,t,a)}},a=function(){var a=t.suggestions.getQueries(K.val(r));if(a.length){var c=a[0],l=a[a.length-1],d=t.suggestions.isMoneyTransferEnabled()&&k.match(c,1);if(d&&(a=[k.DEFAULT_QUERY]),K.moneyTransferTextMatch=d,!s&&!(s=K.initStickersHints(r)))return!1;if(c!=t.stickerHintsString){var u=a.find(e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length);if(K.stickerSuggestionQuery=u,u)if(K.stickers[K.TAB_RECENT_STICKERS])n(u,d);else{var p=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){p&&p(),e&&(p?t.onRecentEmojiUpdate=p:delete t.onRecentEmojiUpdate,n(u,d))},K.emojiLoadMore(e)}else K.hintachesNotFoundStickers[l]=!0,K.stickersHintsHide(s,t,o);!d&&l&&l.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout(()=>{K.checkHintaches(l,t,i)},160)),t.stickerHintsString=c}}};i?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,s&&isVisible(s)?0:200))},showStickersHints:function(e,t,i){var o=e&&geByClass1("_sticker_hints_inner",e);if(!o||t.noStickers)return!1;K.clearHintsLog(),val(o,i),K.stickersHintsShow(e,t,100),o.scrollLeft=0,K.checkStickersHintsScroll(e,o.scrollLeft)},checkStickersHintsScroll:function(e,t){var i=domClosest("_sticker_hints",e),o=i&&geByClass1("_sticker_hints_inner",i),r=i&&geByClass1("_sticker_left",i),s=i&&geByClass1("_sticker_right",i);if(!o)return!1;var n=getSize(r)[0],a=getSize(s)[0];if(hasClass(e,"emoji_sticker_item")){var c=e.offsetLeft-8-n,l=e.offsetLeft+getSize(e)[1]+2+a-o.clientWidth;o.scrollLeft>c&&(o.scrollLeft=c),o.scrollLeft<l&&(o.scrollLeft=l),t=o.scrollLeft}var d=t>0,u=t+o.clientWidth<o.scrollWidth;toggle(r,d),toggleClass(i,"sticker_hints_left_pad",d),toggle(s,u),toggleClass(i,"sticker_hints_right_pad",u),t=void 0===t?o.scrollLeft:t;var p=o.querySelectorAll(".emoji_sticker_item"),_=d?n+8:0,h=u?a+2:0,m=Array.from(p).filter(e=>e.offsetLeft-_>=t&&e.offsetLeft+e.offsetWidth+h-o.clientWidth<=t);K.logHints(m.map(e=>intval(e.getAttribute("data-sticker-id"))).filter(e=>e));var v=m.map(e=>e.getAttribute("data-money-transfer-type")).filter(e=>e);if(v.length){var f=K.moneyTransferTextMatch&&K.moneyTransferTextMatch.input||"";statlogsValueEvent("stickers_money_transfer_suggestions","show",v,f)}},logHints:function(e){K.logHintsTimeout&&clearTimeout(K.logHintsTimeout),K.logHintsTimeout=setTimeout(()=>{K.hintsLogBuffer=e.reduce((e,t)=>(e[t]=1,e),K.hintsLogBuffer||{})},K.logHintsDelay)},clearHintsLog:function(){K.logHintsTimeout&&clearTimeout(K.logHintsTimeout),K.hintsLogBuffer={}},sendHintsLog:function(){var e=K.hintsLogBuffer&&Object.keys(K.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),K.clearHintsLog()},scrollStickersHints:function(e,t,i){var o=domClosest("_sticker_hints",e),r=o&&geByClass1("_sticker_hints_inner",o),s=o&&geByClass1("_sticker_left",o),n=o&&geByClass1("_sticker_right",o);if(!r)return!1;var a=r.scrollLeft+t*(r.clientWidth-2*getSize(e)[0]),c=geByClass("emoji_sticker_item",r);each(c,(function(e,i){return t>0&&i.offsetLeft-8-getSize(s)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-getSize(s)[0]||a,!1):t<0&&i.offsetLeft+getSize(i)[1]+2+getSize(n)[0]-r.clientWidth>a?(a=i.offsetLeft+getSize(i)[1]+2+getSize(n)[0]-r.clientWidth||a,!1):void 0})),a=Math.max(0,Math.min(r.scrollWidth-r.clientWidth,a)),animate(r,{scrollLeft:a},{duration:Math.abs(r.scrollLeft-a)+50,transition:Fx.Transitions.easeOutCubic}),K.checkStickersHintsScroll(r,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,K.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];K.stickers[-1]&&(t=K.stickers[-1].stickers);var i={},o=[];return each(t,(function(){inArray(this[0],e)&&!i[this[0]]&&(o.push(this[0]),i[this[0]]=1)})),each(e,(function(){i[this]||o.push(this)})),o},initStickersHints:function(e){return!!e&&domPN(e).insertBefore(se('<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);"></div>\n    </div>'),e)},updateStickersHints:function(e){K.opts&&each(K.opts,(function(t,i){e&&delete i.stickerHintsString,K.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){var t=K.opts[e].suggestions,i=Object(d.isRetina)()?128:64;return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var i=K.opts[t].suggestions;statlogsValueEvent(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initStickersKeywords:function(){if(!window.stickersKeywordsData){var e=ls.get("stickers_keywords");e&&e.time&&e.time>vkNow()-K.stickersKeywordsExpire&&(window.stickersKeywordsData=e.keywords)}window.stickersKeywordsData&&K.setStickersKeywords(window.stickersKeywordsData)},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>vkNow()-K.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:vkNow(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},setStickersKeywords:function(e,t){if(!e)return!1;window.stickersKeywords={};var i=ce("div"),o=[],r="";if(e.forEach((function(e){var t=e.words||[],i=e.user_stickers||[],s=e.promoted_stickers||[],n=i.concat(s.map((function(e){return-e})));t.forEach((function(e){r+="\n"+e,o.push(n)}))})),val(i,r),(r=i.textContent||i.innerText)&&r.slice("\n".length).split("\n").forEach((function(e,t){window.stickersKeywords[e]=o[t]})),!K.stickers[K.TAB_RECENT_STICKERS]){var s=ls.get("recent_stickers");s&&(K.stickers[K.TAB_RECENT_STICKERS]=s)}t&&(ls.set("stickers_keywords",{time:vkNow(),keywords:e}),K.updateStickersHints(!0))},emojiEnter:function(e,t){var i=K.opts[e],o=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(o?!(t.ctrlKey||browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){var r=geByTag1("img",i.emojiOvered)||geByTag1("i",i.emojiOvered);K.addEmoji(e,K.getCode(r),i.emojiOvered)}return cancelEvent(t)}return!0},insertHTML:function(e){if(browser.msie&&parseInt(browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var i=document.getSelection().getRangeAt(0),o=document.createElement("span");i.surroundContents(o),o.innerHTML=e,i.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t,i){if(!1===e||!1===t)return!1;var o=K.opts[e];if(!(vkNow()-o.ttShowT<K.CLICK_DELAY)){if(o.editable){var r=K.getEmojiHTML(t,K.codeToChr(t),!0),s=o.txt,n=!!window.getSelection&&window.getSelection(),a=!1;if(n&&n.rangeCount){var c=n.getRangeAt(0);a=c.commonAncestorContainer?c.commonAncestorContainer:c.parentElement?c.parentElement():c.item(0)}for(var l=a;l&&l!=s;)l=l.parentNode;var d=s.lastChild||{};browser.mozilla&&"BR"==d.tagName&&!d.previousSibling&&re(s.lastChild),l||K.editableFocus(s,!1,!0),K.insertHTML(r);var p=geByClass("emoji",s);for(var _ in p.push.apply(p,geByClass("emoji_css",s)),p)if(p.hasOwnProperty(_)){var h=p[_].previousSibling;if(h&&3==h.nodeType&&h.textContent&&32==h.textContent.charCodeAt(0)){var m=h.previousSibling;m&&3==m.nodeType&&m.textContent&&160==m.textContent.charCodeAt(m.textContent.length-1)&&re(h)}}s.check&&s.check(),setTimeout(K.correctCaret.pbind(s),5),K.onChange(o);var v=Object(u.data)(s,"composer");v&&window.Composer&&Composer.updateAutoComplete(v)}else{var f,g,b,y=o.txt,w=y.value;f=browser.iphone||browser.ipad?K.codeToChr(t):K.cssEmoji[t][1]+" ",null!=y.selectionStart&&null!=y.selectionEnd?(g=y.selectionEnd,y.value=w.slice(0,y.selectionStart)+f+w.slice(g),y.selectionStart=y.selectionEnd=g+f.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(y.focus(),(b=document.selection.createRange()).text=f,b.select())}o.checkEditable&&o.checkEditable(e,o.txt),K.checkStickersKeywords(e,o),o.saveDraft&&o.saveDraft(),o.onEmojiAdded&&o.onEmojiAdded(),K.incrRecentEmojiRate(e,t)}},showShadow:function(){return!(browser.msie&&browser.version<10)},scrollToggleArrow:function(e,t,i,o){var r=geByClass1("emoji_tabs_"+t+"_s",i.tt);o?(e?show:hide)(r):e?fadeIn(r,200):fadeOut(r,200),i[t+"Shown"]=e},scrollTabs:function(e,t){var i=K.opts[e];if(i){var o,r=geByClass1("emoji_tabs_wrap",i.tt),s=r.firstChild.clientWidth-r.clientWidth;if(t){if((o=2==t?r.scrollLeft:r.scrollLeft+170)>=s){o=s;var n=geByClass1("emoji_tabs_r_s",i.tt);fadeOut(n,200),i.rShown=!1,K.scrollToggleArrow(!1,"r",i)}o&&!i.lShown&&K.scrollToggleArrow(!0,"l",i)}t&&2!=t||((o=2==t?r.scrollLeft:Math.max(r.scrollLeft-170,0))<=0&&(o=0,K.scrollToggleArrow(!1,"l",i)),o<s&&!i.rShown&&K.scrollToggleArrow(!0,"r",i)),2!=t&&(i.scrollLeft=o,animate(r,{scrollLeft:o},300))}},scrollToTab:function(e,t){var i=K.opts[t],o=i.tt,r=geByClass1("emoji_tabs_wrap",o),s=geByClass1("emoji_tab_"+e,o);if(s){var n=Object(u.data)(r,"tween");if(!n||!n.isTweening||e!=i.curTab){var a=getSize(s)[0],c=s.offsetLeft,l=getSize(r)[0],d=c-l/2+10;c+a<r.scrollLeft?r.scrollLeft=Math.max(c,r.scrollLeft-l/2):c+a-r.scrollLeft>l&&(r.scrollLeft=Math.min(c+a-r.scrollLeft,r.scrollLeft+l/2)),animate(r,{scrollLeft:d},300,(function(){K.scrollTabs(t,2)})),K.selectTab(t,e,s)}}},selectTab:function(e,t,i){var o=K.opts[e],r=o.tt,s=geByClass1("emoji_tabs",r),n=geByClass1("emoji_tab_sel",s);removeClass(n,"emoji_tab_sel"),addClass(i,"emoji_tab_sel"),o.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t)},tabsWheel:function(e,t){cancelEvent(e);var i=K.opts[t],o=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,r=geByClass1("emoji_tabs_wrap",i.tt),s=r.scrollLeft;r.scrollLeft+=o,s!=r.scrollLeft&&K.scrollTabs(t,2)},show:function(e,t){var i=Object(u.data)(domPN(e),"optId");void 0!==i&&K.ttShow(i,e,t)},hide:function(e,t,i){var o=Object(u.data)(domPN(e),"optId");void 0!==o&&K.ttHide(o,e,t,i)},ttShow:function(e,t,i){var o=K.opts[e];clearTimeout(o.ctt),clearTimeout(o.stt),o.scrolling&&(o.afterScrollFn=!1),o.ttShown||(t?o.obj=t:t=o.obj,o.stt=setTimeout((function(){K.ttClick(e,t,!1,!0,i)}),K.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,o){var r=K.opts[e];if(clearTimeout(r.stt),r.ttShown)if(r.scrolling)r.afterScrollFn=K.ttHide.pbind(e,t,i,o);else{t=t||r.obj||geByClass1("emoji_smile",r.controlsCont);var s=function(){K.ttClick(e,t,!0,!1,i)};o?s():(clearTimeout(r.ctt),r.ctt=setTimeout(s,K.HIDE_TT_TIMEOUT))}},ttClick:function(e,t,i,o,r,s){var n=K.opts[e];if(n&&!(i&&!K.shown||o&&K.shown)&&(t||(t=K.shown||ge(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!n.tt&&n.sharedTT&&n.sharedTT.emojiTT&&(n.tt=n.sharedTT.emojiTT,n.emojiScroll=n.sharedTT.emojiScroll,n.allEmojiId=n.sharedTT.emojiAllId);var a,c=n.tt;if(!c){var l=ls.get("stickers_tab");l||(l=K.TAB_EMOJI),n.curTab=cur.stickersTab=K.TAB_EMOJI,l==K.TAB_EMOJI||n.noStickers||(K.stickers[K.TAB_RECENT_STICKERS]=ls.get("recent_stickers"),n.curTab=cur.stickersTab=l);var d='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabs('+e+', 0); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabs('+e+', 1); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';d+=K.getTabsCode([[0,1]],e),d+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',n.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(d+=K.getTabsCode(window.emojiStickers,e));var u="",p='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',_="showTooltip(this, {text: '"+Object(H.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";n.rPointer?p+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+_+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':p+=' onmouseover="'+_+'"',d+="</span></span>",n.noStickers||(d+='<a class="fl_r emoji_shop" '+p+'><div class="emoji_sprite emoji_shop_icon">'+(K.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(K.hasNewStickers)+"</div>":"")+"</div></a>"),K.showShadow()||(u+=" emoji_no_opacity"),(n.noStickers||n.hideStickersInitial)&&(u+=" emoji_no_tabs"),c=ce("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+u,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs clear_fix">'+d+"</div></div>",onmouseover:function(t){hasClass(c,"emoji_animated")||K.ttShow(e,!1,t)},onmouseout:function(t){hasClass(c,"emoji_animated")||K.ttHide(e,!1,t)}}),n.tt=c,K.reappendEmoji(e,c),K.emojiOver(e,geByClass1("emoji_scroll_smiles",c).firstChild),each(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){addEvent(geByClass1(this,n.tt),"DOMMouseScroll wheel",(function(t){K.tabsWheel(t,e)}))})),n.sharedTT&&(n.sharedTT.emojiTT=c),K.checkEmojiSlider(n)}if(clearTimeout(n.ttEmojiHide),!1!==K.shownId&&K.shownId!=e&&K.ttClick(K.shownId,geByClass1("emoji_smile",K.opts[K.shownId].controlsCont),!0),K.preventMouseOver=!1,n.emojiExpanded||K.emojiExpand(e,c),K.shown)K.hideTt(c),(a=geByClass1("_sticker_hints",domPN(n.txt)))&&isVisible(a)&&K.checkStickersHintsSize(a,n,!0),K.shown=!1,K.shownId=!1,n.ttShown=!1,n.emojiFocused=!1,n.emojiOvered=!1,cur.onMouseClick=!1,removeEvent(document,"keydown",K.emojiMove),removeClass(t,"emoji_smile_on"),n.onHide&&n.onHide(),K.favorite.deleteFavoriteStickerElements(e);else{if(n.needUpdateRecentStickers&&(K.updateRecentStickers(e),n.needUpdateRecentStickers=!1),!getXY(n.emojiBtn)[0]||!getXY(n.emojiBtn)[1])return;n.openedByTabKey=!!s,K.showTt(c),K.repositionEmoji(e,t,c),(a=geByClass1("_sticker_hints",domPN(n.txt)))&&isVisible(a)&&K.checkStickersHintsSize(a,n,!0),K.shownId=e,K.shown=t,cur.emojiList=geByClass1("emoji_list",c),n.ttShown=!0,n.ttShowT=vkNow(),n.emojiFocused=!0,removeEvent(document,"keydown",K.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){for(var i=t.target;i;){if("im_texts"==i.id||hasClass(i,"emoji_tt_wrap")||hasClass(i,"imw_emoji_wrap"))return!1;i=i.parentNode}K.ttClick(e,!1,!0)},addEvent(document,"keydown",K.emojiMove)}),0),addClass(t,"emoji_smile_on"),n.emojiScroll&&n.emojiExpanded&&(n.emojiScroll.update(),browser.msie&&0===n.curTab&&n.emojiOvered&&K.scrollToListEl(e,n.emojiOvered)),K.tabSwitch(n.curTab,n.curTab,e),n.onRecentEmojiUpdate&&n.onRecentEmojiUpdate(!0),n.onShow&&n.onShow()}return each(geByClass("emoji_smile_icon_promo"),(function(e,t){removeEvent(geByClass1("emoji_smile_icon",t.parentNode),"mouseover"),re(t),K.noNewStickers=!0})),n.noStickersStore?addClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):removeClass(geByClass1("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),cancelEvent(r)}},curEmojiKeys:{},curEmojiRecent:{},emojiLoadMore:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,o=K.opts[e];if(!o.emojiMoreSt){o.emojiMoreSt=1,t.act="get_emoji_list",K.stickerPacksToLoad&&(t.sticker_packs_to_load=K.stickerPacksToLoad.join(",")),K.hasNewStickers<0&&(t.new_shown=1);var r=Object.assign(t.sizes||{},K.stickerSizes);t.sizes=r&&Object.keys(r).join(","),ajax.post("al_im.php",t,{onDone:function(t,s,n,a,c,l){if(K.buildStickersIndex(t),void 0!==t[K.TAB_FAVORITE_STICKERS]){var d=t[K.TAB_FAVORITE_STICKERS];K.tabDefaultId=K.TAB_FAVORITE_STICKERS,K.favoriteAvailable=!0,K.favoriteRemindOn=!!d.remind_on,K.favoriteRemindOff=!!d.remind_off,K.favoriteLimit=d.limit,K.favoriteLimitNoticed=d.limit_noticed,K.sendHintsLogHash=c,k.setIntroViewed(l)}a&&extend(cur.lang,a),n?stManager.add([jsc("web/stickers.js")],(function(){K.updateEmojiList(t,s,e,o)})):K.updateEmojiList(t,s,e,o),Object.assign(K.stickerSizes,r),Object(E.isFunction)(i)&&i()},onFail:function(){o.emojiMoreSt=0}}),K.curEmojiRecent&&o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate()}},buildStickersIndex:function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers)for(var o=e[i].stickers,r=o.length;r--;){var s=o[r];t[s[0]]={sticker:s,packId:i}}K.stickersById=t},updateEmojiList:function(e,t,i,o){K.stickers=e,o.emojiMoreSt=0,K.stickers[-1]&&(ls.set("recent_stickers",K.stickers[-1]),K.updateRecentEmoji(i)),K.stickers[-2],o.allEmojiId=0,o.sharedTT&&(o.sharedTT.emojiAllId=0),K.onStickersLoad&&(o.afterLoad=1),K.onStickersLoad&&window.emojiStickers&&(K.onStickersLoad(),K.onStickersLoad=!1);var r=K.emojiGetRecentFromStorage();r?K.curEmojiRecent=K.filterEmoji(r):(K.emojiOldRecentPrepare(t,i),K.updateEmojiCont(i)),K.updateRecentEmoji(i),o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var i in a)if(a.hasOwnProperty(i))for(var o in a[i])if(a[i].hasOwnProperty(o)){var r=a[i][o],s=t.indexOf(r);if(-1!=s&&(t.splice(s,1),0==t.length))break e}var n={};for(var c in e)e.hasOwnProperty(c)&&-1==t.indexOf(c)&&(n[c]=e[c]);return t.length>0&&K.setRecentEmojiList(n),n},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],r=void 0,s=void 0;isString(o)?(r=1,s=o):(r=o,s=i),t[s]=r}K.setRecentEmojiList(K.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in K.curEmojiRecent)if(K.curEmojiRecent.hasOwnProperty(t)){var i=K.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(e[r][0]);return o.slice(0,20)},incrRecentEmojiRate:function(e,t){K.emojiRecentRateTime||(K.emojiRecentRateTime=Date.now()/1e3-6);var i=Date.now()/1e3-K.emojiRecentRateTime;if(i>=6){var o=Math.min(100,Math.floor(i/6));for(var r in K.curEmojiRecent)if(K.curEmojiRecent.hasOwnProperty(r)){if(r==t)continue;K.curEmojiRecent[r]*=Math.pow(.998076,o)}K.emojiRecentRateTime+=6*o}K.curEmojiRecent[t]||(K.curEmojiRecent[t]=0),K.curEmojiRecent[t]+=1;var s=K.getRecentEmojiSorted();a[-1]=s,s.length>=20&&-1==s.indexOf(t)&&(s.splice(-1),s.push(t));var n={};for(var c in s)if(s.hasOwnProperty(c)){var l=s[c];n[l]=K.curEmojiRecent[l]}K.setRecentEmojiList(n),window.Notifier&&Notifier.lcSend("recent_emoji_set",n)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),K.curEmojiRecent=e},updateEmojiCont:function(e){var t=K.opts[e];0==t.curTab&&(val(geByClass1("emoji_scroll_smiles",t.tt),K.getInitEmojiContent(e)),K.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var i="",o=K.emojiGetRecentFromStorage();o&&K.setRecentEmojiList(o),a[-1]=K.getRecentEmojiSorted();var r=t||K.SORTED_EMOJI_SECTIONS_CODES;for(var s in r)if(r.hasOwnProperty(s)){var n=r[s];i+=K.getEmojiCategoryHtml(e,n)}return i},getInitEmojiContent:function(e){K.setEmojiLastAddedCategoryIdx(e,1);return K.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var i="",o=a[t];if(!o.length)return i;var r=-1==t?"recent":t,s='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+Object(H.getLang)("global_emoji_cat_"+r)+"</div></div>";return i+=s+=K.emojiGetCatCont(e,o)},getEmojiLastAddedCategoryIdx:function(e){return K.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){K.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=K.opts[e],i=t.tt,o=K.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,o){var r=geByClass1("emoji_scroll_smiles",i);if(o++,K.SORTED_EMOJI_SECTIONS_CODES.length>o){var s=K.SORTED_EMOJI_SECTIONS_CODES[o];r.insertAdjacentHTML("beforeEnd",K.getEmojiCategoryHtml(e,s)),K.setEmojiLastAddedCategoryIdx(e,o),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else debugLog("No emoji last category idx")},hideTt:function(e){removeClass(e,K.SHOWN_TT_CLS)},showTt:function(e){addClass(e,K.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var i="",o="",r=t.length-1,s=0;s<=r;s++)o+=K.emojiWrapItem(e,t[s],s),(s>0&&s%10==9||s>=r)&&(i+='<div class="emoji_smiles_row">'+o+"</div>",o="");return i},updateRecentEmoji:function(e){var t=K.getRecentEmojiSorted(),i=K.emojiGetCatCont(e,t),o=ge("emoji_recent_list"+e+"_-1");if(o){for(var r=o.nextSibling;r&&(r=r.nextSibling,hasClass(r.previousSibling,"emoji_smiles_row"));)re(r.previousSibling);for(var s=ce("div",{innerHTML:i}),n=o.nextSibling,a=o.parentNode;r=s.firstChild;)a.insertBefore(r,n)}},updateRecentStickers:function(e){var t=K.opts[e];if(K.stickers[K.TAB_RECENT_STICKERS]&&t&&t.emojiExpanded){var i=ge("emoji_recent_stickers_cont"+e);if(i){val(i,"");for(var o=K.stickers[K.TAB_RECENT_STICKERS].stickers,r=cf(),s=0;s<o.length;s++){var n=K.render.sticker(e,K.TAB_RECENT_STICKERS,o[s]);r.appendChild(n);var a=68*Math.ceil((s+1)/4);t.needLoadStickers.unshift([e+"_"+K.TAB_RECENT_STICKERS+"_"+o[s][0],a])}i.appendChild(r),K.updateStickersPos(e)}}},findStickerIndex:function(e,t){if(e)for(var i=e.stickers,o=i.length;o--;)if(String(i[o][0])===String(t))return o;return-1},findSticker:function(e,t){var i=K.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return K.findStickerIndex(K.stickers[K.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return K.findSticker(K.stickers[K.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return K.findStickerIndex(K.stickers[K.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return K.findSticker(K.stickers[K.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(K.stickersById&&K.stickersById.hasOwnProperty(e))return K.stickersById[e].sticker},isStickersLoaded:function(){if(K.stickers)for(var e in K.stickers)if(K.stickers.hasOwnProperty(e)&&e!==String(K.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i=K.TAB_FAVORITE_STICKERS,o="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+i;if(cur.stickersTab===i&&(o+=" emoji_tab_sel"),0===t&&K.isStickersLoaded()){var r=K.stickers[i];t=r?r.stickers.length:0}return 0===t&&(o+=" unshown"),'<a class="'+o+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'}},favorite:{reminder:function(e){var t=hasClass(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(!K[i]){var o={text:function(){return Object(H.getLang)(t?"purchases_stickers_favorite_rm_tt":"purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},r=domClosest("ui_scroll_container",e);o.appendEl=r;var s=domClosest("ui_scroll_overflow",e),n=getXYRect(e),a=getXYRect(s),c=n.top-a.top,l=(a.right,n.right,a.bottom-n.bottom),d=n.left-a.left,u=(a.width||a.right-a.left)/2;(!vk.rtl&&d>u||vk.rtl&&d<u)&&(o.needLeft=!0,o.shift[0]=9),o.forcetodown=c<K.FAV_ICON_TT_MIN_HEIGHT,o.forcetoup=l<K.FAV_ICON_TT_MIN_HEIGHT,Object(A.showTooltip)(e,o),K[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},addFavoriteSticker:function(e,t,i){var o=K.stickers[K.TAB_FAVORITE_STICKERS];if(o){var r=K.findPackSticker(t);if(r){r[4]=1,o.stickers.unshift(r);var s=K.opts[e],n=s.deletedFavoriteStickers;for(s.deletedFavoriteStickers=[t];o.stickers.length>K.favoriteLimit;)K.favorite.deleteFavoriteSticker(e,o.stickers[o.stickers.length-1][0]);K.favorite.deleteFavoriteStickerElements(e),s.deletedFavoriteStickers=n;var a=K.findRecentSticker(t);a&&(a[4]=1);var c=ge("emoji_favorite_stickers_cont"+e);if(c){var l=K.opts[e].emojiScroll.data.scrollHeight,d=K.opts[e].emojiScroll.data.scrollTop,u=ge("emoji_sticker_item"+e+"_"+K.TAB_FAVORITE_STICKERS+"_"+t);if(!u){u=K.render.sticker(e,K.TAB_FAVORITE_STICKERS,r),K.render.stickerContent(e,u,!1);var p=domFC(c);p?domInsertBefore(u,p):c.appendChild(u),K.opts[e].emojiScroll.update();var _=K.opts[e].emojiScroll.data.scrollHeight-l;K.opts[e].emojiScroll.scrollTop(d+_),K.updateStickersPos(e)}}var h=geByClass1("emoji_tab_"+K.TAB_FAVORITE_STICKERS);if(hasClass(h,"unshown")&&(K.opts[e].curTab===K.TAB_FAVORITE_STICKERS&&removeClass(geByClass1("emoji_tab_"+K.TAB_RECENT_STICKERS),"emoji_tab_sel"),removeClass(h,"unshown")),K.favorite.updateFavoriteStickerElements(e,t,!0),K.opts[e].deletedFavoriteStickers.length>0){var m=indexOf(K.opts[e].deletedFavoriteStickers,t);-1!==m&&K.opts[e].deletedFavoriteStickers.splice(m,1)}}}},deleteFavoriteSticker:function(e,t,i){var o=K.stickers[K.TAB_FAVORITE_STICKERS];if(o){var r=K.findFavoriteStickerIndex(t);if(-1!==r){if(o.stickers.splice(r,1),K.opts[e].deletedFavoriteStickers.push(t),0===o.stickers.length&&i)addClass(geByClass1("emoji_tab_"+K.TAB_FAVORITE_STICKERS),"unshown"),domData(i.parentElement,"pack-id")===String(K.TAB_FAVORITE_STICKERS)&&addClass(geByClass1("emoji_tab_"+K.TAB_RECENT_STICKERS),"emoji_tab_sel");K.favorite.updateFavoriteStickerElements(e,t,!1);var s=K.findRecentSticker(t);s&&(s[4]=0);var n=K.findPackSticker(t);n&&(n[4]=0)}}},deleteFavoriteStickerElement:function(e,t){re("emoji_sticker_item"+e+"_"+K.TAB_FAVORITE_STICKERS+"_"+t)},deleteFavoriteStickerElements:function(e){var t=K.opts[e];t.deletedFavoriteStickers.length>0&&(t.deletedFavoriteStickers.forEach((function(t){K.favorite.deleteFavoriteStickerElement(e,t)})),t.deletedFavoriteStickers=[],K.updateStickersPos(e))},deleteFavoriteStickerElementsAsync:function(e){var t=K.opts[e];t.deleteFavoriteStickersTimeout||(t.deleteFavoriteStickersTimeout=setTimeout((function(){K.favorite.deleteFavoriteStickerElements(e),t.deleteFavoriteStickersTimeout=null}),K.DELETE_FAV_STICKER_ELEMENTS_DELAY))},updateFavoriteStickerElements:function(e,t,i){geByClass("sticker_item_"+t).forEach((function(e){domData(e,"fav",i?"1":null),toggleClass(e,"faved",i),toggleClass(geByClass1("emoji_sticker_item_fav",e),"on",i)}))}},updateEmojiCatTitle:function(e){var t=K.opts[e];if(t&&t.emojiScroll){var i,o,r,s=ge("emoji_block_"+e),n=geByClass("emoji_cat_title_helper",s),a=t.emojiScroll.data.scrollTop,c=geByClass1("emoji_cats_title_helper",t.tt);if(n.length){var l=n[0];i=K.getSizeCached(l)[1]}for(var d=n.length-1;d>=0;d--)if(a>n[d].offsetTop-i){o=n[d],r=d;break}if(!o)return debugLog("title not found");var u=intval(attr(o,"data-id"));if(t.curEmojiCatId!=u){t.curEmojiCatId=u;var p=[o],_=n[r-1];_&&(addClass(_,"emoji_cat_title_fix"),setStyle(_.firstChild,"transform","translateY("+(o.offsetTop-_.offsetTop-i)+"px)"));for(var h=o.nextSibling;h;)hasClass(h,"emoji_cat_title_fix")&&p.push(h),h=h.nextSibling;for(var m in p)p.hasOwnProperty(m)&&(removeClass(p[m],"emoji_cat_title_fix"),setStyle(p[m].firstChild,"transform","translateY(0px)"));val(c,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&a>=o.offsetTop&&a>0?(val(c,val(o)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(a<o.offsetTop||0==a)&&(val(c,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,i){var o,r=K.cssEmoji[t];o=r?' title="'+r[1]+'"':"";var s="";return browser.mobile||(s=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+o+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+s+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+K.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var i=K.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),clearTimeout(cur.ttEmojiHide),K.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||ge("page_header")&&K.getSizeCached(ge("page_header"))[1]||0;var o=(window.pageNode&&window.browser.mozilla?Math.min(getSize(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||getScroll()[3],r=window.scrollGetY?scrollGetY():getScroll()[1],s=getXY(t)[1],n=K.getSizeCached(t)[1],a=geByClass1("emoji_list",i),c=K.opts[e].emojiSmileHeigh,l=window.headH,d=K.opts[e].emojiRowsCount;isAncestor(t,pageNode)||(l=0),setStyle(a,{height:d*c+8});for(var p,_,h,m,v=r+l,f=r+o,g=i,b=getSize(i)[1];g!==bodyNode&&(g=Object(u.domClosestOverflowHidden)(g));){var y=getXY(g)[1];v=Math.max(v,y),f=Math.min(f,y+getSize(g)[1])}for(h=f-s-n-9,p=(_=s-9-v)<b&&h<b?_>=h:_>=b,K.opts[e].forceUp&&(p=!0),m=p?_:h;m<b&&d>3;)d--,b-=c;K.opts[e].emojiRowsCount=d,K.opts[e].emojiSmileHeigh=c,setStyle(a,{height:d*c+8}),toggleClass(i,"tt_down",p),toggleClass(i,"tt_up",!p)},repositionEmoji:function(e,t,i){var o,r=K.opts[e];if(r){if(i.parentNode&&getXY&&getStyle&&setStyle&&geByClass&&(o=geByClass1("emoji_rpointer",i))){var s=parseInt(getStyle(i,"width")),n=getXY(t)[0],a=parseInt(getStyle(t,"width")),c=getXY(i.parentNode)[0];n+a/2<283?(setStyle(i,"left",-s-c),setStyle(o,"left",n+a/2-20+"px")):(setStyle(i,"left",""),setStyle(o,"left",""))}else setStyle(i,"left","");var l=geByClass1("emoji_list",i),d=geByClass1("emoji_smile_cont",l);if(K.opts[e].emojiSmileHeigh=d&&K.getSizeCached(d)[1]||26,K.opts[e].emojiRowsCount=9,K.ttCalcHeight(e,t,i),r.ttWrap){var u=getSize(r.ttWrap)[0]-(getXY(r.emojiBtn)[0]-getXY(r.ttWrap)[0]);setStyle(i,"right",u-r.ttDiff+"px")}}},emojiOver:function(e,t,i){if(browser.mobile||i&&K.preventMouseOver)return!0;var o=K.opts[e];addClass(t,"emoji_over"),o.emojiOvered&&o.emojiOvered!=t&&removeClass(o.emojiOvered,"emoji_over"),o.emojiOvered=t},emojiExpand:function(e,t){var i=K.opts[e];addClass(t,"emoji_expanded"),K.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll(geByClass1("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,Object(E.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i.curTab==K.TAB_EMOJI?K.updateEmojiCategories(t,i,e):K.updateShownStickers(e)}}),i.imagesLoader=i.imagesLoader||imagesLoader(i.emojiScroll.scroller,{use_iframe:!0,need_load_class:"emoji_need_load"}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-K.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){K.addNextEmojiCategoty(i),K.updateEmojiCatTitle(i)}),0),K.updateEmojiCatTitle(i)},updateShownStickers:function(e,t){var i=K.opts[e];if(i.emojiScroll&&i.stickersSplitersPos){i.needLoadStickers||(i.needLoadStickers=[]);var o=i.emojiScroll.data.scrollTop,r=o,s=o+i.emojiScroll.data.viewportHeight,n=i.needLoadStickers;clearTimeout(i.preloadStickersTimer);for(var a=[],c=0;c<n.length;c++){var l=n[c];if(l[1]+72>=r&&l[1]<=s){var d=ge("emoji_sticker_item"+l[0]);if(!d||hasClass(d,"__loaded"))continue;var u=K.render.stickerContent(e,d,!0);a.push([u,l[0]])}}if(K.loadStickers(e,a),a.length||K.preloadStickers(e),!(t||i.scrollAnimation||K.onStickersLoad)){for(var p=-1,_=0;_<i.stickersSplitersPos.length;_++){var h=i.stickersSplitersPos[_];if(!(h[1]-30<o))break;p=h[0]}p!=K.TAB_FAVORITE_STICKERS&&K.favorite.deleteFavoriteStickerElementsAsync(e),i.curTab!=p&&K.scrollToTab(p,e)}}},loadStickers:function(e,t){var i=K.opts[e];if(t.length){for(var o={},r=0;r<t.length;r++){var s=t[r][0]+":"+t[r][1];i.imagesLoading[s]&&(o[s]=i.imagesLoading[s],delete i.imagesLoading[s],t.splice(r,1),r--)}for(var n in i.imagesLoading)if(i.imagesLoading.hasOwnProperty(n)){var a=i.imagesLoading[n];if(!a)return;a.src=""}for(var c in i.imagesLoading=o,t)if(t.hasOwnProperty(c)){var l=t[c][0]+":"+t[c][1];i.imagesLoading[l]=i.imagesLoader.iloader.add(t[c][0],K.onStickerLoaded,e+":"+t[c][1])}}},preloadStickers:function(e){var t=K.opts[e];t.imagesLoading&&Object.keys(t.imagesLoading).length>0||(clearTimeout(t.preloadStickersTimer),t.preloadStickersTimer=setTimeout((function(){var i=t.emojiScroll.data.scrollTop,o=t.emojiScroll.data.viewportHeight,r=i+o,s=i-o,n=i,a=r,c=r+o,l=geByClass1("emoji_scroll_stickers",t.tt);if(isVisible(l)){for(var d=l.firstChild,u=[];d;){if(hasClass(d,"emoji_sticker_item")&&!hasClass(d,"__loaded")){var p=d.offsetTop;if(p>=s&&p<=n||p>=a&&p<=c){var _=d.id.replace("emoji_sticker_item",""),h=K.render.stickerContent(e,d,!0);u.push([h,_])}}d=d.nextSibling}K.loadStickers(e,u)}}),50))},onStickerLoaded:function(e){var t=String(this).split(":"),i=t[1],o=intval(t[0]),r=K.opts[o],s=ge("emoji_sticker_item"+i);if(s){var n=geByTag1("img",s);if(n){addClass(s,"__loaded"),attr(n,"src",e),delete K.opts[o].imagesLoading[e+":"+i];for(var a=0;a<r.needLoadStickers.length;a++){if(i==r.needLoadStickers[a][0]){r.needLoadStickers.splice(a,1);break}}Object.keys(K.opts[o].imagesLoading).length||K.preloadStickers(o)}}},emojiMove:function(e){var t=K.shownId,i=K.opts[t];if(K.shown&&i&&i.emojiFocused&&i.openedByTabKey){var o=null;if(i.emojiOvered)switch(e.keyCode){case KEY.LEFT:o=K.getEmojiEl(i.emojiOvered,"left"),cancelEvent(e);break;case KEY.RIGHT:o=K.getEmojiEl(i.emojiOvered,"right"),cancelEvent(e);break;case KEY.UP:o=K.getEmojiEl(i.emojiOvered,"up");break;case KEY.DOWN:o=K.getEmojiEl(i.emojiOvered,"down");break;case KEY.ENTER:if(!K.emojiEnter(t,e))return cancelEvent(e),!1;break;default:return!0}else o=K.getFirstEmojiEl(t);if(o)return K.preventMouseOver=!0,K.emojiOver(t,o),K.scrollToListEl(t,o),!1}return!0},scrollToListEl:function(e,t){var i=K.opts[e];if(i&&i.emojiScroll){var o=t.offsetTop,r=Math.max(o+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,o-30));i.emojiScroll.data.scrollTop!=r&&i.emojiScroll.scrollTop(r)}},anim:function(e,t){clearInterval(cur._imAnim);var i=Math.floor(300/13),o=0,r=domLC(e),s=domFC(e),n=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){var d=++o>=i?a:n+1.95*o*(t?1:-1),u=d-45,p=o>=i?l:c+1/(300/13)*o*(t?-1:1),_=1-p;r.style.WebkitTransform=r.style.OTransform=r.style.transform="rotate("+d+"deg)",s.style.WebkitTransform=s.style.OTransform=s.style.transform="rotate("+u+"deg)",r.style.opacity=p,s.style.opacity=_,o>=i&&(clearInterval(cur._imAnim),(t?addClass:removeClass)(e,"emoji_smile_on"),r.style.WebkitTransform=r.style.OTransform=r.style.transform=s.style.WebkitTransform=s.style.OTransform=s.style.transform=r.style.opacity=s.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseover="return Emoji.show(this, event);" onmouseout="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:s.emojiToHTML,emojiReplace:s.emojiReplace,emojiRegex:Object(o.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},getTabCont:function(e,t){var i="";if(t){var o="",r="",s=K.opts[e].forceStickerPack;for(var n in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(n)){var a=window.emojiStickers[n][0],c=window.emojiStickers[n][1],l=window.emojiStickers[n][4]&&s==a;if(!c&&!l)continue;var d=K.stickers[a];if(!d)continue;var u=a===K.TAB_RECENT_STICKERS,p=a===K.TAB_FAVORITE_STICKERS,_='<div class="clear emoji_stickers_spliter" id="emoji_tab_cont_'+a+"_"+e+'"></div>';u?_+='<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont'+e+'">':p&&(_+='<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont'+e+'">');var h=d.stickers;for(var m in h)h.hasOwnProperty(m)&&(_+=K.render.stickerRs(e,a,h[m]));u?o=_+"</div>":p?r=_+"</div>":l?i=_+i:i+=_}i=r+o+i}else i=K.ttEmojiList(e);return i},updateStickersCont:function(e){var t=K.opts[e],i=K.getTabCont(e,K.tabDefaultId);geByClass1("emoji_scroll_stickers",t.tt).innerHTML=i,t.initedStickers=1,t.imagesLoading=[],clearTimeout(t.preloadStickersTimer),K.updateStickersPos(e)},updateStickersPos:function(e){for(var t=K.opts[e],i=[],o=[],r=geByClass1("emoji_scroll_stickers",t.tt).firstChild,s=!1,n=!1;r;){if(!s&&hasClass(r,"emoji_recent_stickers_cont")?(r=r.firstChild,s=!0):!n&&hasClass(r,"emoji_favorite_stickers_cont")&&r.firstChild&&(r=r.firstChild,n=!0),hasClass(r,"emoji_sticker_item")){var a=r.id.replace("emoji_sticker_item","");i.push([a,r.offsetTop])}else if(hasClass(r,"emoji_stickers_spliter")){var c=r.id.replace("emoji_tab_cont_","").split("_");o.push([intval(c[0]),r.offsetTop])}(!r.nextSibling&&s||!r.nextSibling&&n)&&(r=r.parentNode),r=r.nextSibling}t.needLoadStickers=i,t.stickersSplitersPos=o},stickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},stickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-opt-id="%optId%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%" data-pack-id="%selId%" data-src="%stickerUrl%" data-animation-path="%animationUrl%" data-fav="%fav%" data-fav-hash="%favHash%" class="emoji_sticker_item sticker_item_%stickerId% %favClass%" onclick="Emoji.stickerClick(%optId%, %stickerId%, %size%, \'%stickerUrl%\', this, \'%referrer%\');"></a>'},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i,o){if(null!=e){var r=K.opts[i],s=r.tt;"number"==typeof e&&(e=geByClass1("emoji_tab_"+e,s));var n=geByClass1("emoji_scroll_smiles",s),a=geByClass1("emoji_scroll_stickers",s),c=geByClass1("emoji_cats_title_helper",s);if(val(c,""),r.curEmojiCatId=null,t==K.TAB_EMOJI)hide(a),show(n),show(c),r.emojiInited||(val(n,K.getInitEmojiContent(i)),r.emojiInited=!0),r.imagesLoader&&r.imagesLoader.processLoad(),r.emojiOvered&&0===r.curTab&&K.emojiOver(i,K.getFirstEmojiEl(i)),r.curTab!=K.TAB_EMOJI&&r.emojiScroll&&r.emojiScroll.scrollTop(0),K.updateRecentEmoji(i),K.updateEmojiCatTitle(i);else{hide(n),show(a),hide(c);var l=K.stickers&&clone(K.stickers);l&&delete l[K.TAB_RECENT_STICKERS],!window.emojiStickers||!l||isEmpty(l)||!l[t]&&t!=K.TAB_RECENT_STICKERS?(K.onStickersLoad=function(){K.updateTabsOpt(i),K.tabSwitch(t,t,i,o)},K.stickersLoadingProgress(i,t,e),r.stickersInited=!1,r.curTab=null,K.emojiLoadMore(i)):r.stickersInited||(K.updateStickersCont(i),r.stickersInited=!0),(r.curTab!=t||r.afterLoad)&&(K.scrollToStickerPack(i,t,r.curTab==K.TAB_EMOJI),r.afterLoad=0),K.updateShownStickers(i,!0)}K.onStickersLoad&&t!=K.TAB_EMOJI||K.selectTab(i,t,e)}},getFirstEmojiEl:function(e){for(var t=K.opts[e],i=geByClass1("emoji_scroll_smiles",t.tt).firstChild;i;){if(hasClass(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){for(var i,o=0,r=e.parentNode,s=0,n=r.firstChild;n&&(s++,n!==e);)n=n.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)(i="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",s=10):(t="down",s=1));else{if("up"!=t&&"down"!=t)break;for(var a=r;a&&(a="up"==t?a.previousSibling:a.nextSibling)&&!hasClass(a,"emoji_smiles_row"););if(!a)break;if(s&&a)for(var c=0,l=a.firstChild;l&&c<s;){if(++c>=s){i=l;break}l=l.nextSibling}if(i||!a)break;i="up"==t||s&&"down"==t?a.lastChild:a.firstChild}if(++o>20){debugLog("ERR!!");break}}return i},stickerClick:function(e,t,i,o,r,s){var n=K.opts[e];if(!(Date.now()-n.ttShowT<K.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<K.CLICK_DELAY)){K.opts[e].preventDoubleClick=Date.now();var a=parseInt(attr(r,"data-pack-id")),c=!0;if(window.emojiStickers&&each(window.emojiStickers,(function(e,t){if(t[0]==a)return c=!!t[1],!1})),c){var l=K.findRecentStickerIndex(t);-1!==l?K.stickers[K.TAB_RECENT_STICKERS].stickers.splice(l,1):K.stickers[K.TAB_RECENT_STICKERS]||(K.stickers[K.TAB_RECENT_STICKERS]={stickers:[]});var d=domData(r,"animation-path")||"",u=domData(r,"fav"),p=domData(r,"fav-hash");K.stickers[K.TAB_RECENT_STICKERS].stickers.unshift([t,i,o,d,u,p]),ls.set("recent_stickers",K.stickers[K.TAB_RECENT_STICKERS]),n.needUpdateRecentStickers=!0}n.onStickerSend&&n.onStickerSend(t,s,"animation"),statlogsValueEvent("stickers_usage",n.ref,t,s),K.ttHide(e,!1,!1,!0),n.recentSticker=t}},stickerOver:function(e,t){var i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if(isObject(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){var o=(cur.tooltips||[]).length,r=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+o,e.image?"":"tt_text_only"];if(r=r.join(" "),e.show){var s={index:o,className:r,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,i=getSize(e.container)[1];if(!(i>=225)){var o=intval((225-i)/2)+10,r=intval(getStyle(t,"top",!0));setStyle(t,"top",r+o)}}};gpeByClass("_im_peer_history_w",t)&&(s.appendParentCls="_im_peer_history_w"),Object(A.showTooltip)(t,s)}}})},selectPeer:function(e){if(void 0!==e){var t=K.opts[e];if(t.peer)return t.peer}var i=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==i&&cur.wdd.imw_dd){var o=0;for(var r in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(r)&&(i=cur.wdd.imw_dd.selected[r][0],o+=1);o>1&&(i="")}return i},showMyStickers:function(){cur.boxMyStickers=showBox("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",jsc("web/sorter.js")]})},showStickersStore:function(e,t){var i={act:"stickers_store",peer:K.selectPeer(!1!==e?e:void 0),box:1},o=K.opts[e];t&&(i.ref=t),cur.boxStickersStore=showBox("al_im.php",i,{dark:1,stat:["im.css","imn.js","page_help.css",jsc("web/sorter.js")],params:{onDestroy:o&&o.onStoreHide}}),each(geByClass("emoji_smile_icon_promo"),(function(e,t){geByClass1("emoji_smile_icon",t.parentNode),re(t)})),each(geByClass("emoji_shop_icon_badge"),(function(e,t){re(t)})),K.hasNewStickers=!1},previewSticker:function(e,t,i,o){if(i=i||{},o&&checkEvent(o))return!0;var r={act:"sticker_preview",pack_id:e},s=K.selectPeer();if(i.peer?r.peer=i.peer:s&&(r.peer=s),i.preview&&(r.preview=1),i.gift&&(r.gift=1),i.giftTo&&(r.gift_to=i.giftTo),i.stickerId&&(r.sticker_id=i.stickerId),r.sticker_referrer=i.sticker_referrer||"store",i.name){var n=nav.objLoc[0].split("/");"stickers"==n[0]&&n[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=showBox("al_im.php",r,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),cancelEvent(o),!1},isStickerPackEnabled:function(e,t){var i=!1;if(!window.emojiStickers&&t)return ajax.post("al_im.php",{act:"a_stickers_list"},{onDone:function(e){window.emojiStickers=e,t()}}),0;if(!window.emojiStickers)return!1;for(var o in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(o)&&window.emojiStickers[o][0]==e){i=!!window.emojiStickers[o][1];break}return i},clickSticker:function(e,t,i){if(window.cur.emojiStickersDisabled&&window.cur.emojiStickersDisabled[e])return!0;var o;if(t){if(0===(o=K.isStickerPackEnabled(e,K.clickSticker.pbind(e,t,i))))return!1;if(o){var r=!1;if(t.getAttribute("contenteditable"))r=t;else{for(var s=t.parentNode,n=!1;(s=s.parentNode)&&!hasClass(s,"js-im-page");){if(hasClass(s,"fc_tab")){n=!0;break}if(hasClass(s,"mv_chat"))break}if(!s)return!1;n?r=geByClass1("fc_editable",s):hasClass(s,"js-im-page")?r=geByClass1("_im_text"):hasClass(s,"mv_chat")&&(r=domByClass(s,"mv_chat_reply_input"))}if(r){var a=K.opts[r.emojiId];K.ttClick(r.emojiId,geByClass1("_emoji_btn",r.parentNode.parentNode),!1,!0);var c=geByClass1("emoji_tab_"+e,a.tt),l=K.stickers&&clone(K.stickers);l&&delete l[-1],!l||isEmpty(l)?(K.onStickersLoad=K.tabSwitch.pbind(e,e,r.emojiId),K.stickersLoadingProgress(r.emojiId,e,c)):(a.initedStickers=0,K.tabSwitch(c,e,r.emojiId))}}}return t&&o||K.previewSticker(e,!1,{sticker_referrer:"message"}),i&&cancelEvent(i),!1},stickersLoadingProgress:function(e,t,i){var o=K.opts[e];removeClass(geByClass1("emoji_tab_sel",o.tt),"emoji_tab_sel"),addClass(i,"emoji_tab_sel"),geByClass1("emoji_scroll_stickers",o.tt).innerHTML='<div class="emoji_scroll_progress">'+rs(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,o,r){if(i&&hasClass(i,"secondary"))return!0;var s=K.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:o,peer:s,sticker_referrer:unclean(r)},{onDone:function(t,i,o,s,n,a){if(each(geByClass("_sticker_btn_"+e),(function(){this.innerHTML=s,this.onmouseover="",this.onclick="",addClass(this,"secondary")})),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),n&&cur.boxStickersStore&&cur.boxStickersStore.hide(),showDoneBox(t),i){K.stickers[K.TAB_RECENT_STICKERS].promoted=a,K.updateTabs(i,o,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===r&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var c=cur.tabbedStickersBox;if(c&&c.tbUpdate)for(var l in c.tbUpdate)c.tbUpdate.hasOwnProperty(l)&&(c.tbUpdate[l]=1);var d=cur.emojiId&&cur.emojiId[cur.peer];if(d){var u=geByClass1("emoji_tab_"+e,K.opts[d].tt);u&&K.tabSwitch(u,e,d)}},showProgress:N.lockButton.pbind(i),hideProgress:N.unlockButton.pbind(i),onFail:function(e){return e&&setTimeout(Object(D.showFastBox)(Object(H.getLang)("global_error"),e).hide,3e3),!0}}),cancelEvent(t)},stickerAct:function(e,t,i,o,r){if(r&&hasClass(e,"secondary"))return!0;var s=(r?hasClass(e,"secondary"):hasClass(e,"_im_sticker_activated"))?1:0,n=cur.tabbedStickersBox;if(n)for(var a in n.tbUpdate)n.tbUpdate.hasOwnProperty(a)&&(n.tbUpdate[a]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:s,from_btn:r?1:0},{onDone:function(i,o,n,a){r||(e.innerHTML=i,e.onmouseover="",setStyle(e,{width:"auto"}),toggleClass(e,"_im_sticker_activated",!s)),each(geByClass("_sticker_btn_"+t),(function(){this.innerHTML=a,this.onmouseover="",toggleClass(this,"secondary",!s)})),K.updateTabs(o,n,!0);var c=e.parentNode.parentNode;if(!r){if(cur.stickersSorter.destroy(),s){show("im_stickers_deact");var l=ge("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),setStyle(c,{cursor:"default"})}else{geByTag1("div","im_stickers_my_wrap").appendChild(c),ge("im_stickers_deact_wrap").childNodes.length||hide("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:N.lockButton.pbind(e),hideProgress:N.unlockButton.pbind(e)}),cancelEvent(o)},getTabsCode:function(e,t){var i=[];e&&i.push.apply(i,e),i.length>1&&(K.hasNewStickers=!1);var o=K.opts[t].forceStickerPack,r="",s="";for(var n in i)if(i.hasOwnProperty(n)){var a=i[n][0],c=i[n][1],l=i[n][3],d=i[n][4]&&a==o,u=i[n][5];if(!c&&!l&&!d)continue;var p=void 0;if(c||d?(a>0&&-1===K.stickerPacksToLoad.indexOf(a)&&K.stickerPacksToLoad.push(a),p="Emoji.tabSwitch(this, "+a+", "+t+"); return cancelEvent(event);"):p="Emoji.previewSticker("+a+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",i[n][2]&&(K.hasNewStickers=i[n][2]),a===K.TAB_RECENT_STICKERS){var _="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+a;cur.stickersTab==a&&(_+=" emoji_tab_sel"),r+='<a class="'+_+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(a===K.TAB_FAVORITE_STICKERS)r+=K.tabs.favoriteTabContent(p,i[n][6]);else if(a){var h="emoji_tab emoji_tab_img_cont emoji_tab_"+a;cur.stickersTab==a&&(h+=" emoji_tab_sel"),c||d||(h+=" emoji_tab_promo");var m='<a class="'+h+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+u+'" class="emoji_tab_img" /></a>';d?s=m+s:s+=m}else{var v="emoji_tab emoji_tab_"+a;cur.stickersTab==a&&(v+=" emoji_tab_sel"),c||(v+=" emoji_tab_promo"),r+='<a class="'+v+'" onmousedown="'+p+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+a+'"></div></a>'}}return r+s},updateTabsOpt:function(e,t){var i=K.opts[e];if(!i.noStickers){var o=ge("emoji_tabs_cont_"+e);o&&(o.innerHTML=K.getTabsCode(window.emojiStickers,e)),K.checkEmojiSlider(i),K.checkNewStickers(i),void 0!==typeof t&&(i.stickersInited=!!t)}},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var o=0;for(var r in void 0===t?(K.initStickersKeywords(),window.stickersKeywordsData||(o=1)):(window.stickersKeywordsData=t,K.setStickersKeywords(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:o,cache_time:K.cachedStickersKeywordsTime()},{onDone:K.updateTabs}):window.emojiStickers=e,K.opts)K.opts.hasOwnProperty(r)&&K.updateTabsOpt(r,!1);var s=K.stickers&&clone(K.stickers);s&&delete s[K.TAB_RECENT_STICKERS],K.onStickersLoad&&window.emojiStickers&&!isEmpty(s)&&(K.onStickersLoad(),K.onStickersLoad=!1)},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][2]){K.hasNewStickers=window.emojiStickers[i][2];break}K.hasNewStickers<0&&!K.noNewStickers&&setTimeout((function(){each(geByClass("emoji_smile_icon"),(function(e,t){var i=t.parentNode;geByClass1("emoji_smile_icon_promo",i)||(i.appendChild(ce("div",{className:"emoji_smile_icon_promo"})),addEvent(t,"mouseover",(function(){Object(A.showTooltip)(this,{text:Object(H.getLang)("global_store_stickers_new_available"),shift:[7,1,4],showdt:0,black:1})})))}))}),hasClass(t,"fc_editable")?200:0)}},checkEmojiSlider:function(e){var t=geByClass1("emoji_tabs_wrap",e.tt),i=!1;if(t){if(t.firstChild.clientWidth&&t.firstChild.clientWidth>t.clientWidth+t.scrollLeft)i=!0;else{var o=t.firstChild.childNodes;o.length>6&&(e.scrollLeft||0)<34*(o.length-6)-16&&(i=!0)}var r=vk.rtl?"l":"r";i?(e.sliderShown=!0,K.scrollToggleArrow(!0,r,e,!0)):e.sliderShown&&(e.sliderShown=!1,K.scrollToggleArrow(!1,r,e,!0))}},giftSticker:function(e,t,i,o){var r={act:"stickers_gift_box",pack_id:e,peers:t,ref:(o=o||{}).ref};return o.from&&(r.from=o.from),r.sticker_referrer=o.sticker_referrer||"store",boxLayerWrap.scrollTop=0,showBox("/al_im.php",r,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),cancelEvent(i)},showStickerTT:function(e){var t=e.getAttribute("data-title");t&&Object(A.showTooltip)(e,{text:t,slide:15,shift:[74-getSize(e)[0]/2,120,5],className:"sticker_hint_tt",hasover:1})},scrollToStickerPack:function(e,t,i){var o=K.opts[e],r=ge("emoji_tab_cont_"+t+"_"+e),s=r&&t!=K.tabDefaultId?r.offsetTop+getSize(r)[1]:0;o.scrollAnimation=1,o.emojiScroll.scrollTop(s,i?0:200,(function(){o.scrollAnimation=0})),K.scrollToTab(t,e)},toggleStickers:function(e,t){var i=K.opts[e];i&&i.tt?(i.noStickers=t,toggleClass(i.tt,"emoji_no_tabs",t),i.curTab&&K.tabSwitch(0,0,e)):i&&(i.hideStickersInitial=t)},getSizeCached:function(e){return(e=ge(e))?(void 0!==e[K.CACHED_WIDTH_PROP]&&void 0!==e[K.CACHED_HEIGHT_PROP]||(e[K.CACHED_WIDTH_PROP]=e.offsetWidth,e[K.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[K.CACHED_WIDTH_PROP],e[K.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=ge(e))&&(e[K.CACHED_WIDTH_PROP]=void 0,e[K.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=K.opts[t];return i&&"stories"===i.ref?K.STICKER_REFERRERS.STORY_KEYBOARD:e===K.TAB_RECENT_STICKERS?K.STICKER_REFERRERS.RECENT:e===K.TAB_FAVORITE_STICKERS?K.STICKER_REFERRERS.FAVORITE:K.STICKER_REFERRERS.KEYBOARD},render:{sticker:function(e,t,i){var o=K.render.stickerRs(e,t,i);return se(o)},stickerRs:function(e,t,i){var o={optId:e,selId:t,stickerId:i[0],size:i[1]?i[1]:256,stickerUrl:i[2],fav:i[4]||"",favHash:i[5]||"",referrer:K.getStickerReferrer(t,e),favClass:i[4]?"faved":""},r="";if(browser.msie&&!browser.msie_edge||!i[3])r=K.stickerItem();else{r=K.stickerItemAnimation();var s=rand(1,1e5);o.animationUrl=i[3],o.uniqId=s}return rs(r,o)},stickerHintRs:function(e,t,i){var o=t,r="";r=t<0?window.promotedStickerUrls&&window.promotedStickerUrls[-o]:i?i[2]:"";var s=i?i[3]:"",n={optId:e,selId:0,stickerId:o,stickerUrl:r,class:o<0?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+o+", '"+r+"', this)"},a="";return(!browser.msie||browser.msie_edge)&&s&&r?(a=K.hintsStickerItemAnimation(),n.animationUrl=s,n.class+=" sticker_animation"):r&&(a=K.hintsStickerItem()),rs(a,n)},stickerContent:function(e,t,i){var o=attr(t,"data-animation-path"),r=attr(t,"data-src"),s="/images/blank.gif";i||(s=r);var n=attr(t,"data-sticker-id"),a=attr(t,"data-fav-hash"),c=attr(t,"data-fav"),l="";o?l='<div data-uniq-id="'+attr(t,"data-uniq-id")+'" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" class="sticker_animation" data-sticker-id="'+n+'" data-animation-path="'+o+'"><img class="sticker_img emoji_sticker_image" src="'+s+'" data-src="'+r+'"/></div>':l='<img class="emoji_sticker_image" src="'+s+'" data-src="'+r+'"/>';if(K.favoriteAvailable){var d="";1==c&&(d="on"),l+=`<span role="link"\n               onmouseover="Emoji.favorite.reminder(this)"\n               class="emoji_sticker_item_fav ${d}"\n               data-sticker-id="${n}"\n               data-hash="${a}"\n               onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n               onclick="cancelEvent(event)"></span>`}return val(t,l),r}},__eof:1}},ofcU:function(e,t,i){"use strict";i.r(t),i.d(t,"createMutations",(function(){return c})),i.d(t,"createModule",(function(){return u})),i.d(t,"destroyModule",(function(){return p}));i("HEwt"),i("a1Th"),i("rE2o"),i("ioFf"),i("rGqo"),i("Btvt"),i("KKXr");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var s=new window.Map;function n(e){var t=s.get(e.currentTarget);if(t){var i=t[e.type];if(i)for(var r,n=0;n<i.length;n++){var a=o(i[n],2),c=a[0],l=a[1],d=void 0;if(hasClass(e.target,c)?d=l(e,e.target):(r=gpeByClass(c,e.target,e.currentTarget))&&(d=l(e,r)),!1===d)break}}}var a=i("Egk5");function c(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function l(e,t,i,o){Object(a.addEvent)(t,i,o),e._registeredHandlers.push({handlerType:"bind",elem:t,types:i,handler:o})}function d(e,t,i,o,r){!function(e,t,i,o){var r=s.get(e);r||(s.set(e,{}),r=s.get(e));for(var a=t.split(" "),c=0;c<a.length;c++){var l=a[c];r[l]||(r[l]=[],addEvent(e,l,n)),r[l].push([i,o])}}(t,i,o,r),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:i,selector:o,handler:r})}function u(e){var t={_registeredHandlers:[]};return e.handlers(l.bind(null,t),d.bind(null,t)),t}function p(e){e._registeredHandlers.forEach((function(e){var t,i,o,r,c;"delegate"===e.handlerType?(t=e.elem,i=e.types,o=e.selector,r=e.handler,(c=s.get(t))&&(i.split(" ").forEach(e=>{c[e]&&(c[e]=c[e].filter(e=>e[0]!==o||e[1]!==r),0===c[e].length&&removeEvent(t,e,n))}),0===Object.keys(c).map(e=>c[e].length).reduce((e,t)=>e+t)&&s.delete(t))):Object(a.removeEvent)(e.elem,e.types,e.handler)})),e._registeredHandlers=[]}},"p+C8":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return a}));i("91GP"),i("ioFf"),i("rGqo"),i("Btvt");var o=i("q1tI"),r=i("pemR");i("17x9");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function a(e){var t=e.icon,i=e.aside,a=e.chevron,c=e.selectable,l=e.border,d=e.className,u=e.children,p=e.active,_=e.canBeHovered,h=void 0===_||_,m=n(e,["icon","aside","chevron","selectable","border","className","children","active","canBeHovered"]),v={"ListItem--chevron":!!a,"ListItem--selectable":!!c,"ListItem--border":!!l,"ListItem--active":!!p,"ListItem--can-be-hovered":h};return o.createElement("li",s({},m,{className:Object(r.classNames)("ListItem",v,d)}),t&&o.createElement("div",{className:"ListItem__icon"},t),o.createElement("div",{className:"ListItem__main"},u),o.createElement("div",{className:"ListItem__aside"},i))}a.defaultProps={onClick:()=>{},icon:null,aside:null,chevron:!1,selectable:!0,border:!0}},pQ8y:function(e,t,i){"use strict";i.r(t);var o=i("wx14"),r=i("zLVn"),s=i("dI71");i("17x9");function n(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}var a=i("q1tI"),c=i.n(a),l=i("dRu9"),d=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return o=t,void((i=e).classList?i.classList.remove(o):"string"==typeof i.className?i.className=n(i.className,o):i.setAttribute("class",n(i.className&&i.className.baseVal||"",o)));var i,o}))},u=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,i){t.removeClasses(e,"exit"),t.addClass(e,i?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,i)},t.onEntering=function(e,i){var o=i?"appear":"enter";t.addClass(e,o,"active"),t.props.onEntering&&t.props.onEntering(e,i)},t.onEntered=function(e,i){var o=i?"appear":"enter";t.removeClasses(e,o),t.addClass(e,o,"done"),t.props.onEntered&&t.props.onEntered(e,i)},t.onExit=function(e){t.removeClasses(e,"appear"),t.removeClasses(e,"enter"),t.addClass(e,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){t.addClass(e,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){t.removeClasses(e,"exit"),t.addClass(e,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.getClassNames=function(e){var i=t.props.classNames,o="string"==typeof i,r=o?""+(o&&i?i+"-":"")+e:i[e];return{baseClassName:r,activeClassName:o?r+"-active":i[e+"Active"],doneClassName:o?r+"-done":i[e+"Done"]}},t}Object(s.default)(t,e);var i=t.prototype;return i.addClass=function(e,t,i){var o=this.getClassNames(t)[i+"ClassName"];"appear"===t&&"done"===i&&(o+=" "+this.getClassNames("enter").doneClassName),"active"===i&&e&&e.scrollTop,this.appliedClasses[t][i]=o,function(e,t){e&&t&&t.split(" ").forEach((function(t){return o=t,void((i=e).classList?i.classList.add(o):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(i,o)||("string"==typeof i.className?i.className=i.className+" "+o:i.setAttribute("class",(i.className&&i.className.baseVal||"")+" "+o)));var i,o}))}(e,o)},i.removeClasses=function(e,t){var i=this.appliedClasses[t],o=i.base,r=i.active,s=i.done;this.appliedClasses[t]={},o&&d(e,o),r&&d(e,r),s&&d(e,s)},i.render=function(){var e=this.props,t=(e.classNames,Object(r.default)(e,["classNames"]));return c.a.createElement(l.default,Object(o.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(c.a.Component);u.defaultProps={classNames:""},u.propTypes={};t.default=u},qrY5:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("pIFo"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Egk5"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("zxIV"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("t7n3"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("gdug"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("lXE5"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("98sY"),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("59zB"),uiActionsMenu={keyToggle:function(e,t){if(!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.checkKeyboardEvent)(t))return!1;var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);i&&uiActionsMenu.toggle(i,!hasClass(i,"shown"))},toggle:function toggle(el,s,options){var dummyMenu=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(el,"dummyMenu");dummyMenu&&(el=dummyMenu),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(el,"shown",s);var onhide=attr(el,"onHide");if(onhide&&!hasClass(el,"shown"))try{eval(onhide)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,onhide)}if(options&&options.onToggle){var script=options.onToggle.replace("{isShow}",""+s);try{eval(script)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,script)}}},show:function(e,t,i){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer");o&&(clearTimeout(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0));var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");if(r&&(o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(r,"hidetimer"))&&(clearTimeout(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)),i&&i.delay){cur.uiActionsMenuShowTimeout&&clearTimeout(cur.uiActionsMenuShowTimeout);var s=i.delay;return delete i.delay,void(cur.uiActionsMenuShowTimeout=setTimeout(uiActionsMenu.show.pbind(e,t,i),s))}if(cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout),i&&i.appendParentCls){var n,a,c=geByClass1("_ui_menu",e);if(c){a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(i.appendParentCls,c),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(`<div class="${n.className} ui_actions_menu_dummy_wrap" onmouseover="uiActionsMenu.show(this);" onmouseout="uiActionsMenu.hide(this);"></div>`);if(l.appendChild(c),a.appendChild(l),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu",l),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(l,"origMenu",e),e=l,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"top",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(c,"top"))),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"left",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(c,"left"))),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"right",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(c,"right"))),i.processHoverCls){var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(i.processHoverCls,n);addEvent(e,"mouseover",addClass.pbind(d,"hover")),addEvent(e,"mouseout",removeClass.pbind(d,"hover"))}}else e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu");var u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");c=geByClass1("_ui_menu",e),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",u),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(i.appendParentCls,c),setStyle(c,{display:"block"});var p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(a),_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(n),h=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"top"),m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"left"),v=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(c,"right"),f={top:_[1]-p[1]+h};v?f.right=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(a)[0]+p[0]-_[0]-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(n)[0]+v:f.left=_[0]-p[0]+m,setStyle(c,f)}var g=geByClass1("_ui_menu",e);if(i&&i.autopos&&g&&!hasClass(e,"shown")){removeClass(e,"ui_actions_menu_left");var b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(e)[1],y=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(e)[1],w=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(g)[1],S=i.dy||10,k=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(g)[0];removeClass(e,"ui_actions_menu_top"),addClass(e,"no_transition"),b+y+S+w>(_web_lib_browser__WEBPACK_IMPORTED_MODULE_4__.browser.mozilla?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)("page_wrap")[1]:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__.scrollGetY)()+(window.lastWindowHeight||0))&&addClass(e,"ui_actions_menu_top"),b-S-w<Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__.scrollGetY)()+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)("page_header_wrap")[1]&&removeClass(e,"ui_actions_menu_top"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(e,"ui_actions_menu_left",k<0),removeClass(e,"no_transition")}i&&i.hasOwnProperty("alwaysTop")&&g&&!hasClass(e,"shown")&&(removeClass(e,"ui_actions_menu_top"),i.alwaysTop&&addClass(e,"ui_actions_menu_top")),i&&i.scroll&&i.maxHeight&&(g.style.maxHeight=(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(i.maxHeight)||200)+"px",g.__uiScroll__||new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_7__.default(g)),uiActionsMenu.toggle(e,!0,i)},hide:function(e,t,i){cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay");o?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",!1):o=200,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",setTimeout((function(){uiActionsMenu.toggle(e,!1,i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)}),o))},hideDelay:function(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",t)}};__webpack_exports__.default=uiActionsMenu},r7nW:function(e,t,i){"use strict";i.r(t);var o=i("q1tI"),r=i("i8i4"),s=(i("17x9"),i("pemR"));class n extends o.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,i=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+i+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,i=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),i&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,i=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),i&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(s.classNames)("BaseModal",e);return o.createElement("div",{className:t,"aria-modal":"true"},o.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),o.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return r.createPortal(this.renderModal(),document.body)}}n.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=n},rudk:function(e,t,i){"use strict";i.r(t),i.d(t,"parseFwd",(function(){return n})),i.d(t,"convertKludgesToAttaches",(function(){return a})),i.d(t,"isReservedPeer",(function(){return c})),i.d(t,"isUserPeer",(function(){return l})),i.d(t,"isChatPeer",(function(){return d})),i.d(t,"convertAttachesToPhpMedia",(function(){return u}));var o=i("jE6c");function r(e,t){void 0===t&&(t=[]);var i=e.split("_");return[i[0],i[1],t]}var s={};function n(e){if(s[e])return s[e];for(var t=e?e.length:0,i=[],o=[],n="",a=0;a<t;a++){var c=e[a],l=c.charCodeAt(0);l>=48&&l<=57||"_"===c||"-"===c?n+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==n&&(o.push(n),i.push("id"),n=""),o.push(c),i.push(c))}n.length>0&&(o.push(n),i.push("id"));var d=function e(t,i,o,s){if(void 0===o&&(o=0),void 0===s&&(s=0),s>50)return[[],t.length];for(var n=[],a="";o<t.length;){var c=t[o];if("id"===c)a=i[o];else if(","===c&&a)n.push(r(a)),a="";else if("("===c){var l=e(t,i,o+1,s+1),d=l[0];o=l[1],n.push(r(a,d)),a=""}else if(")"===c)return""!==a&&n.push(r(a)),[n,o];o++}return a&&n.push(r(a)),[n,o]}(i,o)[0];return Object.keys(s).length>300&&(s={}),s[e]=d,d}function a(e,t){var i=[];e.fwd_count?i.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&i.push({type:"mail",id:-t,object:{fwd_count:n(e.fwd).length}});for(var r=1;e["attach"+r+"_type"];++r)"call"===e["attach"+r+"_type"]?i.push({type:e["attach"+r+"_type"],id:e["attach"+r],initiatorId:Object(o.intval)(e["attach"+r+"_call_initiator_id"]),state:e["attach"+r+"_call_state"],duration:Object(o.intval)(e["attach"+r+"_call_duration"]),receiverId:Object(o.intval)(e["attach"+r+"_call_receiver_id"])}):i.push({type:e["attach"+r+"_type"],id:e["attach"+r],kind:e["attach"+r+"_kind"],productId:e["attach"+r+"_product_id"]});return e.geo&&i.push({type:"geo",id:e.geo}),i}function c(e){return 0==e}function l(e){return e>0&&e<2e9}function d(e){return e>2e9}function u(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},uRA3:function(e,t,i){"use strict";i.r(t),i.d(t,"abortPatternMild",(function(){return c})),i.d(t,"noSpamPatterns",(function(){return l}));var o,r,s,n=i("awNS"),a={};function c(e){ajax.post("noSpam.php",{act:"a_abort_pattern_mild",pid:e},{onDone:function(){ge("abort_pattern_mild"+e).innerHTML="<span style = 'color: green'>остановлен</span>"},onFail:function(){ge("abort_pattern_mild"+e).innerHTML="<span style = 'color: red'>ошибка</span>"}})}var l={patternTooltip:function(e,t){var i={content:a[t]?a[t].tooltip:"",className:"pattern_tt_wrap",nohideover:0,showsp:150,slide:15,hasover:0,shift:[5,0,0]};return showTooltip(e,i)},updateProcess:function(e){var t=vkNow();"patterns"===Object(n.activeTab)()&&-1!=window._wf&&((t-r>5e3||e)&&(ajax.post("noSpam.php",{act:"a_in_process"},{onDone:function(e){var t=ge("in_process");if(t)return e>0?animateCount(t,e):t.innerHTML=e},onFail:function(e){ge("in_process").innerHTML=e||"Неизвестная ошибка (banProcess)"}}),r=t),(t-o>1e4||e)&&(ajax.post("noSpam.php",{act:"a_last_patterns"},{onDone:function(e){var t=geByClass1("in_process_wrap");if(t){show(t);var i=e.table;delete e.table,a=e,ge("patterns").innerHTML=i}},onFail:function(e){var t=geByClass1("in_process_wrap");if(t)return t.innerHTML=e||"Неизвестная ошибка (pProcess)"}}),o=t))},clearTimer:function(){clearInterval(s)},initUpdate:function(){this.updateProcess(!0),s||(s=setInterval(this.updateProcess,1e3),cur.destroy.push(this.clearTimer))}}},"uW+i":function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return s}));i("rGqo"),i("Btvt"),i("hhXQ");var o=i("q1tI"),r=(i("17x9"),i("pemR"));class s extends o.Component{constructor(e){super(e),this.getActiveTab=()=>{var e=this.props.active,t=[],i=null;return this.props.children.forEach(o=>{o.key===e?i=o:t.push(o)}),i||(Number.isInteger(e)&&t.length>e?t[e]:t[0])},this.onClick=(e,t)=>{if(t!==this.state.active){var i=this.refsStore[t],o=this.getTransform(i);this.setState({active:t,isAnimating:!0,transform:o}),this.props.onTabClick(e,t)}},this.onTransitionEnd=e=>{"transform"===e.propertyName&&this.setState({isAnimating:!1})},this.getRef=(e,t)=>{this.refsStore[e]=t};var t=this.getActiveTab();this.refsStore={},this.state={isAnimating:!1,active:t.key}}static reactifyTabs(e){return(Array.isArray(e)?e:Object.values(e)).map(e=>o.createElement("a",{key:e[0],href:e[2],onClick:()=>{}},e[1]?unclean(e[1]):""))}componentDidUpdate(e,t,i){this.props.active!==e.active&&this.setState({active:this.props.active})}getTransform(e){var t=e.offsetWidth;return`translateX(${e.offsetLeft-50+.5*t}px) scaleX(${t/100})`}componentDidMount(){var e=this.refsStore[this.state.active];this.setState({transform:this.getTransform(e)})}render(){var e={"Tabs--animating":this.state.isAnimating};return o.createElement("nav",{className:Object(r.classNames)("Tabs",this.props.className,e),style:this.props.style},o.createElement("ul",{className:"Tabs__list"},this.props.children.map((e,t)=>o.createElement("li",{className:Object(r.classNames)("Tabs__item",{"Tabs__item--active":this.state.active===(e.key||t)}),onClick:i=>this.onClick(i,e.key||t),ref:i=>this.getRef(e.key||t,i),key:e.key||t},e))),o.createElement("div",{style:{transform:this.state.transform},className:"Tabs__divider",onTransitionEnd:this.onTransitionEnd}))}}s.defaultProps={onTabClick:()=>{},active:0}},uXyw:function(e,t,i){"use strict";i.r(t);var o=i("q1tI"),r=i.n(o),s=i("i8i4"),n=i.n(s),a=i("zxIV"),c=i("t7n3"),l={},d={},u=[],p=!1,_=!1;function h(e,t,i){var o=d[e];if(o)for(var r=0;r<o.length;r++){var s=o[r];t?s.resolve(i):s.reject(),o.splice(r,1),r--}}function m(e){p&&p.postMessage({cmd:"load",url:e})}function v(e){return p||((p=new Worker("/js/cmodules/workers/stories_loader_worker.js")).onmessage=function(e){var t=e.data;switch(t.type){case"loaded":l[t.url]=t.data,h(t.url,!0,t.data);break;case"error":h(t.url,!1);break;case"inited":_=!0;for(var i=0;i<u.length;i++)m(u[i])}}),new Promise((function(t,i){if(e||t(""),l[e])return t(l[e]);switch(function(e){return e.match(/\.mp4/)?"video":e.match(/\.(png|jpg|jpeg|gif)/)?"image":void 0}(e)){case"video":case"image":d[e]||(d[e]=[]);var o=0===d[e].length;if(d[e].push({resolve:t,reject:i}),!o)return;_?m(e):u.push(e);break;default:window.vk.dev&&console.error("wrong media url")}}))}var f=!1;function g(e){var t;return f||(t=function(e){try{return e.contentDocument?e.contentDocument:e.contentWindow&&e.contentWindow.document?e.contentWindow.document:e.document}catch(e){}return!1}(window.utilsNode.appendChild(Object(a.ce)("iframe",{}))),f=t&&t.body?t.body:window.utilsNode.appendChild(Object(a.ce)("div",{},{display:"none"}))),e.match(/\.mp4/)?function(e){return new Promise((function(t,i){var o=Object(a.ce)("video",{});o.oncanplay=function(){t(),Object(a.re)(o)},o.onerror=function(){i(),Object(a.re)(o)},f.appendChild(o),o.src=e}))}(e):function(e){return new Promise((function(t,i){var o=Object(c.vkImage)();o.onload=function(){t(),Object(a.re)(o)},o.onerror=function(){i(),Object(a.re)(o)},f.appendChild(o),o.src=e}))}(e)}var b=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<i;t++)for(var s=arguments[t],n=0,a=s.length;n<a;n++,r++)o[r]=s[n];return o};function y(){var e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function w(e){window.ls.set("video_volume",e)}function S(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=[];return b(e).forEach((function(e){if(e)switch(typeof e){case"string":i.push(e);break;case"object":Object.keys(e).forEach((function(t){e[t]&&i.push(t)}));break;default:i.push(String(e))}})),i.join(" ")}var k=i("ErRf"),E=i("Egk5"),O=[],C=function(){window.cur.storyLayer&&window.cur.storyLayer.onVisibilityChange()},j=function(){window.cur.storyLayer&&window.cur.storyLayer.onResize()},T=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyDown(e)},L=function(e){window.cur.storyLayer&&window.cur.storyLayer.onKeyUp(e)};function B(e,t){window.cur.storyLayer&&window.cur.storyLayer.pauseLayer(),Object(a.ge)("stories_layers_background")||(document.body.appendChild(Object(a.ce)("div",{id:"stories_layers_background",className:"stories_layers_background"})),window.layerQueue.hide(),window.layerQueue.push(),window.layers.fullhide=I,Object(E.addEvent)(window,"visibilitychange",C,void 0,void 0,!0),Object(E.addEvent)(window,"resize",j),Object(E.addEvent)(document,"keydown",T),Object(E.addEvent)(document,"keyup",L)),window.cur.storyLayer=e,e.animateStory("expand",t.fromEl),O.push(e),e.length>1&&Object(a.addClass)(e.layerEl,"no_fill_bg"),Object(a.addClass)(document.body,"stories_layer_shown"),Object(k.cancelStackPush)("stories_layer_close"+O.length,(function(t){void 0===t&&(t={}),t.byTimer?e._sendNavigationStatEvents("close_auto_by_time"):e._sendNavigationStatEvents("close_tap"),O.length>1&&!t.isCloseBtnClick?e.back(!0):(e.hideAllLayers=t.isCloseBtnClick,e.hide(!1,!0))}))}function M(){O.length>1?O[O.length-2].setLayerVisibility(!0):Object(a.setStyle)("stories_layers_background","opacity",0)}function I(e){void 0===e&&(e=!1);for(var t=0;t<O.length;t++)O[t].hide(!0);if(window.layers.fullhide=!1,Object(a.removeClass)(document.body,"stories_layer_shown"),Object(a.re)("stories_layers_background"),Object(E.removeEvent)(window,"visibilitychange",C),Object(E.removeEvent)(window,"resize",j),Object(E.removeEvent)(document,"keydown",T),Object(E.removeEvent)(document,"keyup",L),e){var i=window.nav.objLoc;delete i.w,window.nav.setLoc(i)}window.cur.needUpdateFeedStories&&window.Stories.updateFeedStories(),O=[]}function x(){return O[O.length-2]}function P(e){for(var t=0;t<O.length;t++)O[t].onReplyDeleted(e)}window.LayersX=O;i("91GP"),i("pIFo"),i("17x9");var R=i("UCWv"),N=i("nAFc"),D=i("pemR"),A=i("6krn"),H=i("/PiP"),F=i("pp2G"),W=i("rEJs"),K=i("EasH"),U=i("Xrg9");function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}class z extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{var e=this.props,t=e.sticker,i=e.story;t.audioRestriction&&i.data.needMute&&i.video&&(i.video.muted=!0),this.playlist.on(this,W.events.ADDED,()=>{this.props.showMessage(Object(A.getLang)("stories_audio_added")),this.props.playStory()}),this.playlist.on(this,W.events.REMOVED,()=>{this.props.showMessage(Object(A.getLang)("stories_audio_deleted")),this.props.playStory()})},this.componentWillUnmount=()=>{this.playlist.off(this)},this.render=()=>{var e=this.props,t=e.story,i=e.sticker,r=t.data.needMute,s=i.audioRestriction,n=U.default.get("story_show_clickable_zones"),a=Object(D.classNames)("StorySticker",{"StorySticker--clickableZones":n});return o.createElement(o.Fragment,null,o.createElement("div",{className:a,style:this.getStickerStyle(),onClick:this.handleClick}),s&&r&&this.renderRestriction())},this.renderRestriction=()=>{var e=this.props.sticker.audioRestriction;return o.createElement("div",{className:"StoryRestriction"},o.createElement("div",{className:"StoryRestriction__inner"},o.createElement("span",{className:"StoryRestriction__title"},e.title),e.buttonUrl&&o.createElement("a",{className:"StoryRestriction__link",href:e.buttonUrl},e.buttonText)))},this.getStickerStyle=()=>{var e=this.props,t=e.sticker,i=e.originalWidth,o=e.originalHeight,r=e.widthViewBox,s=e.heightViewBox,n=r,a=s;return s/r>1.77?n=i*s/o:a=o*r/i,{top:t.top*a-(a-s)/2,left:t.left*n-(n-r)/2,width:t.width*n,height:t.height*a,transform:`rotate(${t.rotate}deg)`}},this.handleClick=e=>{switch(this.props.sticker.type){case R.StickerTypes.hashtag:this.handleClickHashtag(e);break;case R.StickerTypes.mention:this.handleClickMention(e);break;case R.StickerTypes.question:this.handleClickQuestion();break;case R.StickerTypes.place:this.handleClickPlace(e);break;case R.StickerTypes.music:this.handleClickMusic(e);break;case R.StickerTypes.marketItem:this.handleClickMarketItem(e);break;case R.StickerTypes.storyReply:this.handleClickStoryReply(e);break;case R.StickerTypes.owner:this.handleClickOwner(e);break;case R.StickerTypes.link:this.handleClickLink(e);break;case R.StickerTypes.post:this.handleClickPost(e);break;case R.StickerTypes.poll:this.handleClickPoll(e);break;case R.StickerTypes.app:this.handleClickApp()}},this.handleClickHashtag=e=>{var t=this.props.sticker.hashtag.replace("#","%23"),i=Object(A.getLang)("stories_show_hashtag_link"),r=o.createElement("a",{href:`/feed?q=${t}&section=search`,onClick:()=>this.onClickToTooltip("hashtag"),target:"_blank",className:"StoriesTooltip__link"},i);this.props.toggleTooltip(e,r),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"hashtag"}})},this.handleClickMention=e=>{var t=this.props.sticker,i=t.mentionedOwnerHref,r=t.mentionedText,s=t.mentionedPhotoUrl,n=o.createElement("a",{href:i,onClick:()=>this.onClickToTooltip("mention"),target:"_blank",className:"StoriesTooltip__link StoriesTooltip__link--mention"},o.createElement("div",{className:"StoriesTooltipMention"},o.createElement("div",{className:"StoriesTooltipMention__avatar",style:{backgroundImage:`url(${s})`}}),o.createElement("span",{className:"StoriesTooltipMention__text"},Object(N.decodeHTMLEntities)(r))));this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"mention"}})},this.handleClickQuestion=()=>{this.props.showQuestionModal(),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"question"}})},this.handleClickPlace=e=>{var t=this.props,i=t.sticker,r=t.list,s=i.placeId,n=Object(A.getLang)("stories_go_to_place");if(layerQueue.count()||r.includes("archive")){var a="/feed?section=search&w=place"+s,c=o.createElement("a",{href:""+a,onClick:()=>this.onClickToTooltip("place"),target:"_blank",className:"StoriesTooltip__link"},n);this.props.toggleTooltip(e,c)}else{var l=o.createElement("div",{className:"StoriesTooltip__link",onClick:()=>{this.onClickToTooltip("place"),layerQueue.count()?layerQueue.pop():layerQueue.push(),Object(H.showWiki)({w:"place"+s})}},n);this.props.toggleTooltip(e,l)}this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:i.id,type:"place"}})},this.handleClickMusic=e=>{var t=this.props,i=t.story,r=t.sticker,s=i.data.needMute,n=r.audioId,a=r.audioData;if(r.audioRestriction)s||F.AudioUtils.showAudioRestriction(JSON.parse(a),{onShow:()=>{this.props.pauseStory()},onHide:()=>{this.props.playStory()}});else{var c="added"===(F.AudioUtils.getAddRestoreInfo()[n]||{}).state?"stories_audio_delete":"stories_audio_add",l=o.createElement("ul",{className:"StoriesTooltipActions _audio_row","data-audio":a},o.createElement("li",{className:"StoriesTooltipActions__item",onClick:this.addAudio},Object(A.getLang)(c)),o.createElement("li",{className:"StoriesTooltipActions__item",onClick:this.setNext},Object(A.getLang)("stories_audio_next_audio")));this.props.toggleTooltip(e,l,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:r.id,type:"music"}})}},this.handleClickMarketItem=e=>{var t=this.props.sticker,i=t.photoUrl,r=t.link,s=t.isRestricted,n="market_item",a=s?{onClick:()=>{Object(K.showFastBox)(Object(A.getLang)("stories_market_access_error_title"),Object(A.getLang)("stories_market_access_error_text")),this.onClickToTooltip(n)}}:{onClick:()=>this.onClickToTooltip(n),href:r},c=o.createElement("a",V({},a,{target:"_blank",className:"StoriesTooltip__link"}),i&&!s?o.createElement("img",{className:"StoriesTooltip__marketItemThumb",src:i}):o.createElement("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub"}),o.createElement("span",{className:"StoriesTooltip__marketItemText"},Object(A.getLang)("stories_go_to_market_item")));this.props.toggleTooltip(e,c),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:n}})},this.handleClickStoryReply=e=>{var t=this.props,i=t.sticker,r=t.story,s=i.ownerId,n=i.storyId,a=(r.data.reply_to||{}).is_expired;if(a)this.handleClickOwner(e);else{var c=o.createElement("a",{className:"StoriesTooltip__link",onClick:()=>{window.showStory(`story${s}_${n}`),this.onClickToTooltip("story_reply")}},Object(A.getLang)("stories_go_to_story"));this.props.toggleTooltip(e,c),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:i.id,type:"story_reply"}})}},this.handleClickOwner=e=>{var t=this.props.sticker,i=t.ownerId,r=t.link,s=i>0?Object(A.getLang)("stories_go_to_profile"):Object(A.getLang)("stories_go_to_group"),n=o.createElement("a",{href:r,target:"_blank",className:"StoriesTooltip__link"},s);this.props.toggleTooltip(e,n)},this.handleClickLink=e=>{var t=this.props.sticker,i=t.link,r=t.tooltipText,s=o.createElement("a",{href:i,onClick:()=>this.onClickToTooltip("link"),target:"_blank",className:"StoriesTooltip__link"},r);this.props.toggleTooltip(e,s),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"link"}})},this.handleClickPost=e=>{var t=this.props.sticker,i=t.postOwnerId,r=t.postId,s=Object(A.getLang)("stories_go_to_post"),n=o.createElement("a",{href:`/wall${i}_${r}`,onClick:()=>this.onClickToTooltip("post"),target:"_blank",className:"StoriesTooltip__link"},s);this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"post"}})},this.handleClickPoll=e=>{var t=this.props.sticker.pollId;this.props.pauseStory(),showBox("al_voting.php",{act:"get_layout",voting_id:t,ref:"story",for_box:!0},{containerClass:"story_poll",params:{hideButtons:!0,width:510,onDestroy:()=>{this.props.playStory()}}}),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"poll"}})},this.handleClickApp=()=>{this.props.markAppNotificationsSeen(this.props.sticker),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"app"}})},this.addAudio=e=>{F.AudioUtils.addAudio(e.target,void 0,()=>{this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})}),this.props.hideTooltip()},this.setNext=e=>{var t=JSON.parse(this.props.sticker.audioData||"{}"),i=F.AudioUtils.asObject(t);this.playlist.setNext(e.target.parentNode,i,t),this.playlist.pause(),this.props.hideTooltip(),this.props.playStory()},this.onClickToTooltip=e=>{this.props.sendNavigationStatEvents("click_to_tooltip",!0,{clickable_sticker:{id:this.props.sticker.id,type:e}})},this.playlist=Object(H.getAudioPlayer)()}}var q,G=function(e){var t=e.clientX,i=void 0===t?0:t,o=e.clientY,s=void 0===o?0:o,a=e.position,c=void 0===a?"t":a,l=e.layerEl,d=e.children,u=Object(D.classNames)("StoriesTooltip","StoriesTooltip--"+c);return r.a.createElement(r.a.Fragment,null,n.a.createPortal(r.a.createElement("div",{className:u,style:{top:s,left:i}},d),l))},Y=i("6raB"),Q=i("0toi"),X=i("Ht+d"),$=i("aFGQ"),J=i("FWc3"),Z=(q=function(e,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),ee=function(e){function t(t){var i=e.call(this,t)||this;i.componentDidMount=function(){window.addEventListener("resize",i.handleResize)},i.componentWillUnmount=function(){window.removeEventListener("resize",i.handleResize)},i.componentDidUpdate=function(){i.askTextarea.current&&i.askTextarea.current.focus()},i.onDisableAreaMouseDown=function(e){i.props.onMouseDownHandle(e.target)},i.onDisableAreaMouseUp=function(e){i.props.onMouseUpHandle(e.target)},i.render=function(){var e=i.props,t=e.story,r=e.storyData,s=e.author,n=e.layerEl,a=e.showMessage,c=e.playStory,l=e.pauseStory,d=e.list,u=e.sendNavigationStatEvents,p=e.markAppNotificationsSeen,_=r.clickable_stickers,h=_.stickers,m=_.original_width,v=_.original_height,f=i.state,g=f.widthViewBox,b=f.heightViewBox,y=f.showTooltip,w=f.position,S=f.tooltipContent,k=f.showQuestionModal,E=f.clientX,O=f.clientY;return o.createElement("div",{className:"StoryStickers"},o.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:i.onDisableAreaMouseDown,onMouseUp:i.onDisableAreaMouseUp}),o.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:i.onDisableAreaMouseDown,onMouseUp:i.onDisableAreaMouseUp}),h.map((function(e,r){return o.createElement(z,{story:t,sticker:e,originalWidth:m,originalHeight:v,widthViewBox:g,heightViewBox:b,toggleTooltip:i.toggleTooltip,sendNavigationStatEvents:u,hideTooltip:i.hideTooltip,showQuestionModal:i.showQuestionModal,markAppNotificationsSeen:p,showMessage:a,playStory:c,pauseStory:l,list:d,key:r})})),y&&o.createElement(G,{clientX:E,clientY:O,layerEl:n,position:w},S),k&&o.createElement(Q.default,{title:Object(A.getLang)("stories_question_ask_box_title").replace("{name}",Object(N.decodeHTMLEntities)(s.name_get)),actionButtons:i.getQuestionModalActions(),className:"StoryQuestionAskForm",onClose:i.closeQuestionModal,appearance:"blue"},o.createElement("div",{className:"StoryQuestionAskForm__inner"},o.createElement("textarea",{ref:i.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:80,placeholder:Object(A.getLang)("stories_question_ask_placeholder"),onChange:i.handleChange,onKeyDown:i.handleKeyDown}))))},i.handleResize=function(){var e=Object(a.getSize)(i.props.el),t=e[0],o=e[1];i.setState({widthViewBox:t,heightViewBox:o,showTooltip:!1})},i.toggleTooltip=function(e,t,o){void 0===o&&(o="t"),e.preventDefault(),e.stopPropagation();var r=e.clientX,s=e.clientY,n=i.props,a=n.pauseStory,c=n.playStory,l=n.hideFeedbackTooltip,d=n.sendNavigationStatEvents;l(),i.setState({showTooltip:!i.state.showTooltip,tooltipContent:t,clientX:r,clientY:s,position:o}),setTimeout((function(){i.state.showTooltip?(d("click_on_clickable_sticker"),a()):c()}),0)},i.hideTooltip=function(){i.setState({showTooltip:!1})},i.isShownTooltip=function(){return i.state.showTooltip||i.state.showQuestionModal},i.showQuestionModal=function(){var e=i.props,t=e.storyData,o=e.showMessage,r=e.pauseStory,s=e.onModalShownChange;if(!t.can_ask)return o(Object(A.getLang)("stories_question_forbidden"));i.setState({showQuestionModal:!0}),i.hideTooltip(),s(!0),r()},i.closeQuestionModal=function(){var e=i.props,t=e.playStory,o=e.onModalShownChange;i.setState({showQuestionModal:!1}),o(!1),t()},i.handleChange=function(e){i.setState({questionText:e.target.value})},i.handleKeyDown=function(e){var t=i.state.questionText;Object(c.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==E.KEY.RETURN&&i.sendQuestion()},i.resetAskText=function(){i.setState({questionText:""})},i.getQuestionModalActions=function(){var e=i.props.storyData.can_ask_anonymous,t=i.state,r=t.isQuestionButtonLoading,s=t.questionText,n=[{value:R.QUESTION_SELECT_MODE.AUTHOR_ONLY,label:Object(A.getLang)("stories_question_select_author_only")},{value:R.QUESTION_SELECT_MODE.PUBLIC,label:Object(A.getLang)("stories_question_select_public")}];return e&&n.splice(1,0,{value:R.QUESTION_SELECT_MODE.ANONYMOUS,label:Object(A.getLang)("stories_question_select_anonymous")}),o.createElement("div",{className:"StoryQuestionAskForm__footer"},o.createElement("div",{className:"StoryQuestionAskForm__cell StoryQuestionAskForm__cell--select"},o.createElement($.default,{value:i.state.selected,options:n,onChange:i.onSelectChange,onShow:i.onSelectShow,onHide:i.onSelectHide})),o.createElement("div",{className:"StoryQuestionAskForm__cell"},o.createElement(X.default,{key:"b",appearance:"tertiary",onClick:i.closeQuestionModal},Object(A.getLang)("global_cancel")),o.createElement(Y.default,{key:"s",loading:r,disabled:!Object(c.trim)(s),onClick:i.sendQuestion},Object(A.getLang)("stories_question_reply_send"))))},i.onSelectChange=function(e){i.setState({selected:e.selected.value})},i.onSelectShow=function(){var e=i.props,t=e.storyData,o=e.author,r=t.can_ask_anonymous,s=document.querySelector(".StoryQuestionAskForm__cell--select");if(s){var n=r?"stories_question_about_user_tooltip":"stories_question_about_user_tooltip_without_anon",a=r?"stories_question_about_group_tooltip":"stories_question_about_group_tooltip_without_anon",c="";c=o.id>0?Object(A.getLang)(n).replace(/{name}/g,Object(N.decodeHTMLEntities)(o.firstName)):Object(A.getLang)(a),Object(J.showTooltip)(s,{text:c,width:350,slideX:15,className:"",nohide:!0,asrtl:!0,shift:[350,-15],dir:"left",showdt:1e3})}},i.onSelectHide=function(){var e=document.querySelector(".StoryQuestionAskForm__cell--select");e&&e.tt&&e.tt.destroy()},i.sendQuestion=function(){var e=i.state.questionText,t=i.props,o=t.showMessage,r=t.storyData,s=t.author,n=t.sendNavigationStatEvents,a=r.raw_id,c=r.askQuestionHash,l=r.accessKey,d=a.split("_"),u=d[0],p=d[1],_=!1,h=!1;i.state.selected===R.QUESTION_SELECT_MODE.PUBLIC?_=!0:i.state.selected===R.QUESTION_SELECT_MODE.ANONYMOUS&&(h=!0),window.ajax.post("al_stories.php",{act:"ask_question",story_owner_id:u,story_id:p,question_text:e,is_anonymous:+h,with_mention:+_,hash:c,access_key:l},{onDone:function(){switch(i.closeQuestionModal(),i.resetAskText(),o(Object(A.getLang)("stories_question_sent").replace("{name}",s.first_name_ins)),i.state.selected){case R.QUESTION_SELECT_MODE.PUBLIC:n("question_reply_publish");break;case R.QUESTION_SELECT_MODE.AUTHOR_ONLY:n("question_reply");break;case R.QUESTION_SELECT_MODE.ANONYMOUS:n("question_reply_anonymous")}},onFail:function(e){return i.closeQuestionModal(),i.resetAskText(),o(e),!0},showProgress:function(){return i.setState({isQuestionButtonLoading:!0})},hideProgress:function(){return i.setState({isQuestionButtonLoading:!1})}})};var r=Object(a.getSize)(i.props.el),s=r[0],n=r[1];return i.askTextarea=o.createRef(),i.state={widthViewBox:s,heightViewBox:n,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:R.QUESTION_SELECT_MODE.AUTHOR_ONLY,questionText:""},i}return Z(t,e),t}(o.Component),te=i("qrY5"),ie=function(e){var t=e.story;if(t.getCurStoryData().hide_settings)return null;var i,o=function(e){var t=[],i=e.getCurStoryData(),o=i.raw_id,r=i.can_hide_reply,s=i.report_hash,n=i.can_remove,a=i.can_share,l=i.narrative,d=i.is_ads,u=e.data.can_blacklist,p=o.split("_").map((function(e){return Object(c.intval)(e)}))[0],_=l&&!l.is_cover;!u||_||d||t.push({label:Object(A.getLang)("stories_add_blacklist_button"),onClick:function(){return e._addToBlacklist()}});r&&t.push({label:Object(A.getLang)("stories_hide_reply_button"),onClick:function(){return e._hideReply()}});l&&t.push({label:l.is_bookmarked?Object(A.getLang)("stories_narrative_remove_bookmark_button"):Object(A.getLang)("stories_narrative_add_bookmark_button"),onClick:function(){return e._sendNarrativeBookmarkButtonDidPress()}});a&&t.push({label:Object(A.getLang)("stories_share"),onClick:function(){return e.shareBox()}});l&&l.can_edit&&t.push({label:Object(A.getLang)("stories_narrative_edit_button"),onClick:function(){return e._sendNarrativeEditButtonDidPress()}});n&&e.getOwnerId()<0&&t.push({label:l?Object(A.getLang)("global_narrative_delete"):Object(A.getLang)("global_delete"),onClick:function(){return l?e.removeNarrativeBox():e.removeStoryBox()}});s&&t.push({label:Object(A.getLang)("stories_report"),onClick:function(){return e.report()}});p===window.vk.id||_||t.push({label:Object(A.getLang)("stories_settings"),onClick:function(){return window.Stories.showBlackList()}});return t}(t);if(0===o.length)return null;var s=r.a.createRef();return r.a.createElement("div",{className:"stories_button more ui_actions_menu_wrap _ui_menu_wrap ui_actions_menu_top stories_actions",onMouseEnter:function(e){clearTimeout(i),t.pauseStory(),te.default.show(s.current,e)},onMouseLeave:function(){te.default.hide(s.current),clearTimeout(i),i=setTimeout((function(){return t.autoResumeStory()}),300)},ref:s},r.a.createElement("div",{className:"ui_actions_menu _ui_menu"},o.map((function(e){var t=e.label,i=e.onClick;return r.a.createElement("div",{key:t,className:"ui_actions_menu_item",onClick:i},t)}))))};var oe=i("PjZB"),re=function(e){var t=e.title,i=e.subtitle,o=e.appearance,s=void 0===o?"preview":o;return r.a.createElement("div",{className:"InfoAside InfoAside--"+s},r.a.createElement("div",{className:"InfoAside__image"}),r.a.createElement("div",{className:"InfoAside__description"},r.a.createElement("span",{className:"InfoAside__title"},t),r.a.createElement("span",{className:"InfoAside__subtitle"},i)))},se=i("As6E"),ne=i("TBLV");class ae extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{var e=this.questionTextEl.current;e&&this.adjustQuestionTextSize(e)},this.componentDidUpdate=()=>{this.replyTextareaEl.current&&this.replyTextareaEl.current.focus()},this.render=()=>{var e=this.state,t=e.isOpenReplyModal,i=e.replyText,r=e.isOpenReportModal,s=e.reportReasons,n=this.props,a=n.question,c=n.storyUrl,l=a.author,d=a.canAnswer,u=a.text,p=Object(N.decodeHTMLEntities)(u),_=Object(D.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!d});return o.createElement("div",{className:"StoryQuestion"},o.createElement("div",{className:"StoryQuestion__content"},this.renderAuthor(),o.createElement("span",{className:_,title:p,ref:this.questionTextEl},p)),o.createElement("div",{className:"StoryQuestion__controls"},d&&o.createElement(X.default,{className:"StoryQuestion__reply",appearance:a.isPublished?"secondary":"primary",size:"s",wide:!0,onClick:this.openReplyModal},Object(A.getLang)("stories_question_reply"))),t&&o.createElement(Q.default,{title:Object(A.getLang)("stories_question_reply_box_title").replace("{name}",Object(N.decodeHTMLEntities)(l.nameDat)),actionButtons:this.getReplyModalActions(),className:"StoryQuestion__replyModal",onClose:this.closeReplyModal,appearance:"blue"},o.createElement("div",{className:"StoryQuestion__inner"},o.createElement("textarea",{ref:this.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:Object(A.getLang)("stories_question_reply_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:i}),o.createElement("img",{srcSet:c,className:"StoryQuestion__image"}))),r&&o.createElement(Q.default,{title:Object(A.getLang)("stories_question_report_title"),actionButtons:this.getReportModalActions(),className:"StoryQuestionReportForm",onClose:this.closeReportModal,appearance:"blue"},o.createElement("div",{className:"StoryQuestionReportForm__content"},o.createElement("h4",{className:"StoryQuestionReportForm__title"},Object(A.getLang)("stories_question_report_reason")),o.createElement("div",{className:"StoryQuestionReportForm__items"},!s&&o.createElement(oe.default,{size:15}),s&&s.map((e,t)=>o.createElement(ne.default,{key:e[0],name:"questionReport",value:e[0],defaultChecked:!t,onChange:()=>this.handleReason(e[0])},e[1]))))))},this.renderAuthor=()=>{var e=this.props.question,t=e.id,i=e.isAnonymous,r=e.author,s=Object(N.decodeHTMLEntities)(r.name);return o.createElement("div",{className:"StoryQuestion__header"},i&&o.createElement("span",{className:"StoryQuestion__author"},s),!i&&o.createElement("a",{href:r.link,className:"StoryQuestion__author",onClick:()=>cur.storyLayer._sendNavigationStatEvents("question_go_to_author",!0,{questionId:t})},s),o.createElement(se.default,{position:"b",align:"right",trigger:"hover",data:this.getActions()},o.createElement("a",{className:"StoryQuestion__actions"})))},this.getActions=()=>{var e=this.props.question,t=this.state.isAuthorBan,i=[{text:Object(A.getLang)("stories_question_delete"),onClick:()=>this.props.removeQuestion(e)}];return e.canBlocked&&(t?i.push({text:Object(A.getLang)("stories_question_author_unban"),onClick:this.unbanAuthor}):i.push({text:Object(A.getLang)("stories_question_author_ban"),onClick:this.banAuthor}),i.push({text:Object(A.getLang)("stories_question_author_report"),onClick:this.openReportModal})),i},this.adjustQuestionTextSize=e=>{if(e.scrollHeight>e.offsetHeight){var t=getComputedStyle(e),i=parseInt(t.fontSize)-.5,o=i+2.5,r=Math.floor(parseInt(t.height)/o);i>10&&(e.setAttribute("style",`font-size: ${i}px; line-height: ${o}px; -webkit-line-clamp: ${r};`),setTimeout(()=>{this.adjustQuestionTextSize(e)},0))}},this.getReplyModalActions=()=>{var e=this.state,t=e.isReplyButtonLoading,i=e.replyText;return[o.createElement(X.default,{key:"closeReplyModal",appearance:"tertiary",onClick:this.closeReplyModal},Object(A.getLang)("global_cancel")),o.createElement(Y.default,{key:"replySend",loading:t,disabled:!Object(c.trim)(i),onClick:this.sendReply},Object(A.getLang)("stories_question_reply_send"))]},this.openReplyModal=()=>{this.setState({isOpenReplyModal:!0})},this.closeReplyModal=()=>{this.setState({isOpenReplyModal:!1})},this.handleChange=e=>{this.setState({replyText:e.target.value})},this.handleKeyDown=e=>{var t=this.state.replyText;Object(c.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==KEY.RETURN&&this.sendReply()},this.resetReplyText=()=>{this.setState({replyText:""})},this.sendReply=()=>{var e=this.state.replyText,t=this.props,i=t.question,o=t.showMessage,r=i.text,s=i.id,n=i.ownerId,a=i.storyOwnerId,l=i.storyId,d=i.sendHash,u=`${e}\n\n🗣 ${Object(c.unclean)(r)}`,p=`story:${a}_${l}`;ajax.post("al_im.php",{act:"a_send",msg:u,hash:d,media:p,to:n},{onDone:()=>{this.closeReplyModal(),this.resetReplyText(),o(Object(A.getLang)("stories_answer_sent")),cur.storyLayer._sendNavigationStatEvents("question_send_message",!0,{questionId:s})},onFail:e=>(this.closeReplyModal(),this.resetReplyText(),o(e),!0),showProgress:()=>this.setState({isReplyButtonLoading:!0}),hideProgress:()=>this.setState({isReplyButtonLoading:!1})})},this.banAuthor=()=>{var e=this.props,t=e.question,i=e.showMessage,o=t.storyOwnerId,r=t.storyId,s=t.id,n=t.banHash,a=t.isAnonymous;ajax.post("al_stories.php",{act:"ban_author_question",story_owner_id:o,story_id:r,question_id:s,ban_hash:n},{onDone:()=>{this.setState({isAuthorBan:!0}),i(Object(A.getLang)("stories_question_author_blocked"));var e="question_ban_author";a&&(e="question_ban_anonymous_author"),cur.storyLayer._sendNavigationStatEvents(e,!0,{questionId:s})},onFail:e=>(i(e),!0)})},this.unbanAuthor=()=>{var e=this.props,t=e.question,i=e.showMessage,o=t.storyOwnerId,r=t.storyId,s=t.id,n=t.banHash;ajax.post("al_stories.php",{act:"unban_author_question",story_owner_id:o,story_id:r,question_id:s,ban_hash:n},{onDone:()=>{this.setState({isAuthorBan:!1}),i(Object(A.getLang)("stories_question_author_unblocked"))},onFail:e=>(i(e),!0)})},this.getReportModalActions=()=>{var e=this.state,t=e.isReportButtonLoading,i=e.reportReasons;return[o.createElement(X.default,{key:"closeReplyModal",appearance:"tertiary",onClick:this.closeReportModal},Object(A.getLang)("global_cancel")),o.createElement(Y.default,{key:"reportSend",disabled:!i,loading:t,onClick:this.sendReport},Object(A.getLang)("stories_question_report_send"))]},this.openReportModal=()=>{this.setState({isOpenReportModal:!0}),this.props.getReportReasons().then(e=>{this.setState({reportReasons:e})},e=>{this.closeReportModal(),this.props.showMessage(e)})},this.closeReportModal=()=>{this.setState({isOpenReportModal:!1})},this.handleReason=e=>{this.setState({selectReasons:e})},this.sendReport=()=>{var e=this.props.question,t=e.storyOwnerId,i=e.id,o=e.reportHash;ajax.post("al_stories.php",{act:"question_report",story_owner_id:t,question_id:i,reason:this.state.selectReasons,report_hash:o},{onDone:()=>{this.closeReportModal(),this.props.showMessage(Object(A.getLang)("stories_report_sent")),this.closeReportModal()},onFail:e=>(this.props.showMessage(e),this.closeReportModal(),!0),showProgress:()=>this.setState({isReportButtonLoading:!0}),hideProgress:()=>this.setState({isReportButtonLoading:!1})})},this.state={isAuthorBan:e.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isOpenReportModal:!1,isReportButtonLoading:!1,reportReasons:null,selectReasons:0},this.replyTextareaEl=o.createRef(),this.questionTextEl=o.createRef()}}var ce=function(e){var t=e.title,i=e.additionalTitle;return r.a.createElement("div",{className:"FeedbackTitle"},r.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),i&&r.a.createElement("span",{className:"FeedbackTitle__additional"},i))},le=function(e){var t=e.title,i=e.additionalTitle,o=e.needSeparator,s=void 0===o||o,n=e.className,a=e.children;return r.a.createElement("div",{className:Object(D.classNames)("FeedbackBaseBlock",n,{"FeedbackSeparator FeedbackSeparator--top":s})},r.a.createElement(ce,{title:t,additionalTitle:i}),a)},de=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ue=function(e){function t(t){var i=e.call(this,t)||this;return i.componentDidMount=function(){var e=i.scrollElement.current;e&&e.addEventListener("wheel",i.questionsMouseWheel)},i.componentWillUnmount=function(){var e=i.positionElement.current;e&&e.removeEventListener("wheel",i.questionsMouseWheel)},i.questionsMouseWheel=function(e){e.preventDefault(),i.props.questions.items.length<=1||i.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},i.setPosition=function(e){var t=i.positionElement.current;if(t){var o=i.state.scrollBlockPosition,r=Object(a.getSize)(t)[0],s=Math.max(0,Math.min(o+e,t.scrollWidth-r));i.setState({scrollBlockPosition:s})}},i.removeQuestion=function(e){var t=e.storyOwnerId,o=e.storyId,r=e.id,s=e.removeHash;window.ajax.post("al_stories.php",{act:"remove_question",story_owner_id:t,story_id:o,question_id:r,remove_hash:s},{onDone:function(){i.props.sendNavigationStatEvents("question_delete",!0,{question_id:r}),i.props.questions.items.length?i.setPosition(0):i.props.onQuestionRemove(r)}})},i.getReportReasons=function(){return new Promise((function(e,t){i.reportReasons.length?e(i.reportReasons):window.ajax.post("al_stories.php",{act:"question_report_box"},{onDone:function(t){return i.reportReasons=t,e(i.reportReasons),!0},onFail:function(e){return t(e),!0}})}))},i.state={scrollBlockPosition:0},i.reportReasons=[],i.scrollElement=o.createRef(),i.positionElement=o.createRef(),i}return de(t,e),t.prototype.render=function(){var e=this,t=this.props.questions,i=this.state.scrollBlockPosition,r=t.items;return o.createElement(le,{className:"FeedbackQuestionsBlock",title:t.title},o.createElement("div",{className:"FeedbackQuestionsBlock__questions"},o.createElement("div",{className:"FeedbackQuestionsBlock__wrapper",ref:this.scrollElement},o.createElement("div",{className:"FeedbackQuestionsBlock__items",style:{transform:"translateX(-"+i+"px)"},ref:this.positionElement},r.map((function(t,i){return o.createElement(ae,{question:t,storyUrl:e.props.storyUrl,showMessage:e.props.showMessage,removeQuestion:e.removeQuestion,getReportReasons:e.getReportReasons,key:i})}))))))},t}(o.Component),pe=i("BN/X"),_e=function(e){var t=e.stats,i=e.extendedStats,o=e.onExtendedStatsPreviewClick,s=e.onSettingsBtnClick,n=e.onPrivacyHintHide;return r.a.createElement(le,{className:"FeedbackStatsBlock",title:t.title},t.cells&&r.a.createElement("div",{className:"FeedbackTooltip__cells"},t.cells.map((function(e,t){return r.a.createElement("div",{className:"FeedbackTooltip__cell",key:t},r.a.createElement("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}}),r.a.createElement("div",{className:"FeedbackStatName"},e.name))}))),i&&r.a.createElement("div",{className:"FeedbackStatsBlock__extendedStatsPreview FeedbackSeparator FeedbackSeparator--top",onClick:o,role:"button"},r.a.createElement(re,{appearance:"preview",title:Object(A.getLang)("stories_detailed_stats"),subtitle:i.preview}),r.a.createElement("div",{className:"FeedbackStatsBlock__chevron"})),t.showPrivacyHint&&r.a.createElement("div",{className:"FeedbackStatsBlock__privacyHint FeedbackSeparator FeedbackSeparator--top"},Object(A.getLang)("stories_privacy_feedback_hint"),r.a.createElement("div",{className:"FeedbackStatsBlock__links"},r.a.createElement(pe.default,{href:"/settings?act=privacy",onClick:s},Object(A.getLang)("stories_go_to_settings")),r.a.createElement("span",{className:"dvd"}),r.a.createElement(pe.default,{onClick:n},Object(A.getLang)("global_hide_notify")))),t.showEmptyStatsPrivacyHint&&r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyHint"},r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyIcon"}),r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyText"},Object(A.getLang)("stories_privacy_empty_views_hint")),r.a.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyLink"},r.a.createElement(pe.default,{href:"/settings?act=privacy",onClick:s},Object(A.getLang)("stories_go_to_settings")))))},he=i("XuKo");function me(e){return e.items.some((function(e){return e.unread}))}var ve,fe=function(e){var t=e.storyPack,i=e.listName,o=e.source;return r.a.createElement("a",{href:t.author.href,className:Object(D.classNames)("StoryReply",{"StoryReply--new":me(t)}),onClick:function(e){e.metaKey||e.ctrlKey||(Object(he.showStory)(t.author.id+"/"+i,{fromEl:e.target,source:o}),e.preventDefault())},role:"button"},r.a.createElement("div",{className:"StoryReply__avatar"},r.a.createElement("div",{className:"StoryReply__image",style:{backgroundImage:"url("+t.author.photo+")"}})),r.a.createElement("div",{className:"StoryReply__caption"},t.author.firstName))},ge=i("4+be"),be=function(e){var t=e.replies,i=e.showMore,o=t.list,s=Boolean(t.moreRepliesCount);return r.a.createElement(le,{className:"FeedbackRepliesBlock",title:t.title,additionalTitle:t.additionalTitle},r.a.createElement("div",{className:"FeedbackRepliesBlock__replies"},null==o?void 0:o.map((function(e){return r.a.createElement(fe,{storyPack:e,listName:t.listName,source:t.source,key:e.author.id})}))),s&&r.a.createElement(X.default,{className:"FeedbackRepliesBlock__showMore",appearance:"tertiary",onClick:i},Object(ge.langNumeric)(Object(A.getLang)("stories_replies_more_button",t.moreRepliesCount))))};!function(e){e.photo="photo",e.gradient="gradient",e.default="default"}(ve||(ve={}));function ye(e){var t="";if(e.type===ve.photo)t="#"+e.backgroundColor;else if(e.type===ve.gradient){t="linear-gradient("+(e.angle-90)+"deg, "+e.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return t}function we(e){var t=e.ownerId,i=e.pollId;if(e.needShowResults)Object(H.showWiki)({w:"poll"+t+"_"+i},!1,void 0,{customRef:"story"});else{var o={act:"get_layout",voting_id:i,ref:"story",for_box:!0};Object(K.showBox)("al_voting.php",o,{containerClass:"story_poll",params:{hideButtons:!0,width:510}})}}var Se=function(e){var t=e.poll,i=function(e){var t=e.background;return r.a.createElement("div",{className:"PollSnippet__background",style:{background:ye(t)}},t.type===ve.photo&&r.a.createElement("div",{className:"PollSnippet__photo",style:{backgroundImage:"url("+t.photoUrl+")"}}))}(t);return r.a.createElement("div",{className:Object(D.classNames)("PollSnippet",{"PollSnippet--default":t.background.type===ve.default})},i,r.a.createElement("div",{className:"PollSnippet__question"},t.question),r.a.createElement("div",{className:"PollSnippet__countVoters"},t.votersCountText),r.a.createElement("div",{className:"PollSnippet__showResult",onClick:we.bind(null,t)},Object(A.getLang)("stories_voting_show_result")))},ke=function(e){var t=e.poll;return r.a.createElement(le,{className:"FeedbackPollBlock",title:t.title},r.a.createElement("div",{className:"FeedbackPollBlock__poll"},r.a.createElement(Se,{poll:t.data})))},Ee=i("7hRE");i("ioFf"),i("rGqo"),i("Btvt");function Oe(){return(Oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function Ce(e,t){if(null==e)return{};var i,o,r=function(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var je=e=>{var t=e.verifiedText,i=e.className,r=Ce(e,["verifiedText","className"]);return o.createElement("div",Oe({className:Object(D.classNames)("VerifiedMarker",i)},r,{"aria-label":t}),o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",className:"VerifiedMarker__icon","aria-hidden":"true"},o.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.25 6.75L4.5 9l5.25-5.25"})))},Te=i("LkN3"),Le=e=>{var t=e.children,i=e.isVerified,r=e.verifiedText,s=e.className;return o.createElement("div",{className:Object(D.classNames)("OwnerName",s)},o.createElement(Te.default,null,t),!!i&&o.createElement(je,{verifiedText:r,className:"OwnerName__verified"}))};Le.defaultProps={isVerified:!1,verifiedText:""};var Be=Le,Me=function(e){var t=e.user;return r.a.createElement("a",{href:t.url,className:"Viewer",role:"button"},r.a.createElement(Ee.default,{className:Object(D.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":t.isLiked}),title:t.name,photo:t.photoUrl}),r.a.createElement(Be,{className:"Viewer__name",isVerified:t.isVerified},Object(N.decodeHTMLEntities)(t.name)))},Ie=function(e){var t=e.viewers,i=e.isLoading,o=void 0!==i&&i,s=e.needSeparator,n=void 0===s||s;return r.a.createElement(le,{className:"FeedbackViewersBlock",title:t.title,needSeparator:n},t.hiddenReason&&r.a.createElement("span",{className:"FeedbackViewersBlock__hiddenReason"},t.hiddenReason),r.a.createElement("div",{className:"FeedbackViewersBlock__items"},t.items.map((function(e,t){return r.a.createElement(Me,{user:e,key:t})}))),o&&r.a.createElement("div",{className:"FeedbackViewersBlock__spinner"},r.a.createElement(oe.default,{size:18,color:"#6590c7",strokeWidth:2})))},xe=i("BJj/"),Pe=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Re=function(e){function t(t){var i=e.call(this,t)||this;return i.onQuestionRemove=function(e){i.props.onQuestionRemove(e)},i.close=function(){i.props.toggleFeedbackTooltip(!1)},i.onSettingsBtnClick=function(){i.props.sendNavigationStatEvents("go_to_settings")},i.onPrivacyHintHide=function(){i.props.onPrivacyHintHide()},i.onExtendedStatsPreviewClick=function(){var e=i.props.sendNavigationStatEvents;i.unObserveViewerScroll(),i.unObserveTitleChanges(),i.setState({extendedStatsActive:!0}),e("open_advanced_statistic")},i.onBackBtnClick=function(){i.unObserveTitleChanges(),i.setState({extendedStatsActive:!1})},i.state={isViewersLoading:!1,extendedStatsActive:!1},i.mounted=!1,i.scrollContainerRef=r.a.createRef(),i.viewsSentinelRef=r.a.createRef(),i.titles=[],i.viewsObserver=null,i.activeHeader=null,i.onScrollHandler=null,i}return Pe(t,e),t.prototype.render=function(){var e=this.props,t=e.feedback,i=e.showMessage,o=e.sendNavigationStatEvents,s=e.storyImageUrl,n=e.showMoreReplies,a=e.needShowEmptyStats,c=this.state,l=c.isViewersLoading,d=c.extendedStatsActive,u=null==t?void 0:t.stats,p=null==u?void 0:u.extendedStats,_=null==t?void 0:t.replies,h=null==t?void 0:t.poll,m=null==t?void 0:t.questions,v=null==t?void 0:t.viewers;return r.a.createElement("div",{className:Object(D.classNames)("FeedbackTooltip",{"FeedbackTooltip--empty":a}),onClick:function(e){return e.stopPropagation()}},r.a.createElement("div",{className:"FeedbackTooltip__wrapper"},r.a.createElement("div",{className:"FeedbackTooltip__close",onClick:this.close}),!t&&r.a.createElement("div",{className:"FeedbackTooltip__spinner"},r.a.createElement(oe.default,{size:36,color:"#6590c7",strokeWidth:3})),t&&r.a.createElement(r.a.Fragment,null,!d&&r.a.createElement("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef},r.a.createElement("div",{className:"FeedbackTooltip__content"},u&&r.a.createElement(_e,{stats:u,extendedStats:p,onExtendedStatsPreviewClick:this.onExtendedStatsPreviewClick,onSettingsBtnClick:this.onSettingsBtnClick,onPrivacyHintHide:this.onPrivacyHintHide}),_&&r.a.createElement(be,{replies:_,showMore:n}),h&&r.a.createElement(ke,{poll:h}),m&&r.a.createElement(ue,{showMessage:i,storyUrl:s,questions:m,sendNavigationStatEvents:o,onQuestionRemove:this.onQuestionRemove}),v&&r.a.createElement(Ie,{viewers:v,isLoading:l,needSeparator:!t.questions}),Boolean(null==v?void 0:v.nextFrom)&&r.a.createElement("div",{className:"FeedbackTooltip__sentinel",ref:this.viewsSentinelRef}))),p&&d&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"FeedbackTooltip__header FeedbackSeparator FeedbackSeparator--bottom"},r.a.createElement("div",{className:"FeedbackTooltip__back",onClick:this.onBackBtnClick},Object(A.getLang)("global_back")),Object(A.getLang)("stories_detailed_stats")),r.a.createElement("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef},r.a.createElement("div",{className:"FeedbackTooltip__content"},p.achievement&&r.a.createElement("div",{className:"FeedbackTooltip__achievement"},r.a.createElement(re,{appearance:"achievement",title:p.achievement,subtitle:p.achievementSubtitle})),p.categories.map((function(e,t){return r.a.createElement(le,{title:e.title,key:t},r.a.createElement("div",{className:"FeedbackTooltip__lines"},e.lines.map((function(e,t){return r.a.createElement("div",{className:"FeedbackTooltip__line",key:t},r.a.createElement("div",{className:"FeedbackStatName"},Object(N.decodeHTMLEntities)(e.name)),r.a.createElement("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}}))}))))}))))))))},t.prototype.componentDidMount=function(){var e=this,t=this.props,i=t.feedback,o=t.storyRawId,r=t.onFetchFeedbackData;if(this.mounted=!0,i)return this.observeTitleChanges(),void this.observeViewerScrollIfNeeded();window.ajax.post("al_stories.php",{act:"get_feedback",story_raw:o},{onDone:function(t){e.mounted&&r(t)},onFail:function(){return Object(K.showFastBox)(Object(A.getLang)("global_error"),Object(A.getLang)("global_unknown_error")),e.close(),!0}})},t.prototype.componentDidUpdate=function(e,t){!e.feedback&&this.props.feedback&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded()),!t.extendedStatsActive&&this.state.extendedStatsActive?this.observeTitleChanges():t.extendedStatsActive&&!this.state.extendedStatsActive&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded())},t.prototype.componentWillUnmount=function(){this.unObserveTitleChanges(),this.unObserveViewerScroll(),this.mounted=!1},t.prototype.loadViewers=function(){var e,t=this,i=this.props,o=i.storyRawId,r=i.feedback,s=i.onFetchViewers;(null===(e=null==r?void 0:r.viewers)||void 0===e?void 0:e.nextFrom)&&(this.setState({isViewersLoading:!0}),window.ajax.post("al_stories.php",{act:"get_viewers",story_raw:o,offset:r.viewers.nextFrom},{onDone:function(e){s(e),t.setState({isViewersLoading:!1})},onFail:function(){return Object(K.showFastBox)(Object(A.getLang)("global_error"),Object(A.getLang)("global_unknown_error")),t.setState({isViewersLoading:!1}),!0}}))},t.prototype.observeViewerScrollIfNeeded=function(){var e,t=this,i=this.props.feedback;if(null===(e=null==i?void 0:i.viewers)||void 0===e?void 0:e.nextFrom){var o=this.scrollContainerRef.current,r=this.viewsSentinelRef.current;if(!r)return;this.viewsObserver=new IntersectionObserver((function(e){e.forEach((function(e){e.intersectionRatio>0&&t.loadViewers()}))}),{threshold:[0],root:o,rootMargin:"0px 0px 336px 0px"}),this.viewsObserver.observe(r)}},t.prototype.unObserveViewerScroll=function(){this.viewsObserver&&this.viewsObserver.disconnect()},t.prototype.observeTitleChanges=function(){var e=this,t=this.scrollContainerRef.current;t&&(this.updateTitles(),this.onScrollHandler=Object(xe.debounce)((function(){!e.titles.some((function(t,i){if(t.offsetTop)return t===e.activeHeader||e.setActiveHeader(t),!0;if(e.titles[i+1]){var o=e.titles[i+1],r=e.titles[i+1].parentElement,s=r&&r.offsetHeight;return!!s&&(o.offsetTop+o.offsetHeight===s&&(t===e.activeHeader||e.setActiveHeader(t),!0))}return!1}))&&e.activeHeader&&(e.activeHeader.classList.remove("FeedbackTitle--active"),e.activeHeader=null)}),5),t.addEventListener("scroll",this.onScrollHandler))},t.prototype.updateTitles=function(){var e=this.scrollContainerRef.current;e&&(this.titles=Array.from(e.querySelectorAll(".FeedbackTitle")),this.titles.reverse())},t.prototype.unObserveTitleChanges=function(){this.scrollContainerRef.current&&this.onScrollHandler&&this.scrollContainerRef.current.removeEventListener("scroll",this.onScrollHandler),this.onScrollHandler=null,this.titles=[]},t.prototype.setActiveHeader=function(e){this.activeHeader&&this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=e,e.classList.add("FeedbackTitle--active")},t}(r.a.Component),Ne=i("pQ8y"),De=function(e){var t=e.story,i=t.getReplies(),o=t.getViews()||"",s=t.getCurStoryData(),n=s.can_manage,a=s.narrative,c=s.isNewQuestions,l=s.needShowEmptyStats,d=s.small_preview,u=a&&!a.is_cover,p=!(!n||!o&&!l),_=t.isActiveLive(),h=t.getRawId(),m=t.isFeedbackTooltipShow,v=t.toggleFeedbackTooltip,f=t.onFetchFeedbackData,g=t.onFetchViewers,b=t.onQuestionRemove,y=t.feedback,w=t.showMoreReplies,S=t.onPrivacyHintHide;if(u||_||!o&&!i&&!l)return null;var k=t._showMessage.bind(t),E=t.layer._sendNavigationStatEvents.bind(t.layer),O="stories_button views _views_button";return(l||c)&&(O+=" stories_button_new_notify "+(c?"stories_button_new_questions":"stories_button_new_hint")),r.a.createElement("div",{className:O,onClick:function(e){v(),l&&E("open_empty_feedback"),e.stopPropagation()}},i&&r.a.createElement("div",{className:"stories_button_replies"},i),p&&r.a.createElement("div",{className:"stories_button_views"},o),r.a.createElement(Ne.default,{in:m,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0},r.a.createElement(Re,{feedback:y,storyRawId:h,storyImageUrl:d,toggleFeedbackTooltip:v,onFetchFeedbackData:f,onFetchViewers:g,showMessage:k,sendNavigationStatEvents:E,onQuestionRemove:b,showMoreReplies:w,onPrivacyHintHide:S,needShowEmptyStats:l})))},Ae=i("vzBJ");class He extends o.Component{constructor(e){super(e),this.onMouseEnterSticker=e=>{Ae.StickersAnimation.loadAndPlaySticker(e.currentTarget)},this.state={}}render(){return o.createElement("div",{className:Object(D.classNames)("ReactionsPanel",this.props.className)},o.createElement("div",{className:"ReactionsPanel__container"},o.createElement("div",{className:"ReactionsPanel__title"},Object(A.getLang)("stories_reactions_title")),o.createElement("div",{className:"ReactionsPanel__items"},this.props.stickers.map((e,t)=>this.getStickerItemEl(e,t)))))}getStickerItemEl(e,t){var i=!!e.animationUrl?"sticker_img":"";return o.createElement("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,onMouseDown:()=>this.props.onStickerClick(e.id,t),onMouseEnter:this.onMouseEnterSticker,key:e.id},o.createElement("div",{className:Object(D.classNames)("ReactionsPanel__itemImage",i),style:{backgroundImage:`url(${e.imageUrl})`}}))}}var Fe=i("TxR4"),We=i("W9Tc"),Ke=i("L7cl"),Ue=i("o7bv"),Ve=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ze=function(){return(ze=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},qe=function(e){function t(t){var i=e.call(this,t)||this;return i._onReactionClick=function(e,t){i._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:R.EMOJI_REACTIONS_ARR[t].name})},i.emojiId=!1,i.state={story:t.story,sendFormHasText:!1,sendFormFocused:!1,linkObjectAudioPlaying:!1,isReactionsPanelShow:!1,reactionStickers:i._getReactionsStickers(),needAnimateLikeButton:!1},i}return Ve(t,e),t.prototype.componentDidMount=function(){this.emojiInit()},t.prototype.componentWillUnmount=function(){this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId,window.cur.reactionFeatureTooltipTimeoutId&&(clearTimeout(window.cur.reactionFeatureTooltipTimeoutId),window.cur.reactionFeatureTooltipTimeoutId=null))},t.prototype.componentDidUpdate=function(){this.emojiInit()},t.prototype.render=function(){var e=this.props.story,t=this.props.story.getCurStoryData();if(!e.story||!t)return"";var i={left_side_empty:this._leftSideIsEmpty()},r=t.canLike,s=this.state.reactionStickers;return o.createElement(o.Fragment,null,this.state.isReactionsPanelShow&&s.length>0&&o.createElement(He,{className:"stories_story_reactions",stickers:s,onStickerClick:this._onReactionClick}),o.createElement("div",{className:S("stories_story_bottom",i)},o.createElement("div",{className:"stories_story_bottom_controls",ref:"controls"},o.createElement(De,{story:e}),this._renderMessageForm(),this._renderLink(),r&&this._renderLike(),this._renderMask(),this._renderShare(),this._renderRemove(),o.createElement(ie,{story:e}),this._renderAppButton())))},t.prototype._renderAppButton=function(){var e=this,t=this.props.story.getSticker(R.StickerTypes.app);if(t){var i="stories_button app _stories_button_app";return t.hasNewInteractions&&(i+=" has_new"),o.createElement("a",{target:"_blank",className:i,onClick:function(){return e.props.markAppNotificationsSeen(t)}})}},t.prototype._renderLink=function(){var e=this,t=this.props.story.getCurStoryData().link;if(!Object(c.isObject)(t))return"";var i="stories_link";return t.object_type&&(i+=" story_link_object_"+t.object_type),this.state.linkObjectAudioPlaying&&(i+=" story_link_object_audio_playing"),o.createElement("div",{className:"stories_link_wrap"},o.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:i,href:t.url,title:t.text,onClick:function(i){e._linkDidPress(i,t)}},o.createElement("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:t.text}})))},t.prototype._renderMask=function(){return this.props.story.getCurStoryData().mask_id?o.createElement("div",{className:"stories_button mask _mask_button",onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(A.getLang)("stories_mask_tooltip")})},onClick:this._maskButtonDidPress.bind(this)}):""},t.prototype._renderShare=function(){return!0!==this.props.story.getCurStoryData().can_share?"":o.createElement("div",{className:"stories_button share _share_button",onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(A.getLang)("stories_share")})},onClick:this._shareButtonDidPress.bind(this)})},t.prototype._renderLike=function(){var e=this.state.needAnimateLikeButton,t=this.props.story.getCurStoryData().isLiked;return o.createElement("div",{className:S("stories_button stories_like",{"stories_button--isLiked":t,"stories_button--animating":e}),onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(A.getLang)("stories_like")})},onClick:this._likeButtonDidPress.bind(this)})},t.prototype._renderRemove=function(){var e=this.props.story;return!e.getCurStoryData().can_remove||e.getOwnerId()<0?"":o.createElement("div",{className:"stories_button remove _remove_button",onMouseOver:function(e){return Object(J.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:Object(A.getLang)("global_delete")})},onClick:this._removeButtonDidPress.bind(this)})},t.prototype._canMessage=function(){var e=this.props.story.getCurStoryData(),t=e.link,i=e.can_comment;return!(Object(c.isObject)(t)||!i||this.props.story.isLiveEnded())},t.prototype._renderMessageForm=function(){var e=this;if(this._canMessage())return o.createElement("div",{ref:"sendForm",className:"stories_send_form _emoji_field_wrap emoji_rpointer"},o.createElement("div",{className:"stories_send_form_text_wrap"},o.createElement("div",{contentEditable:!0,ref:"messageInput",className:"stories_send_form_text",placeholder:Object(A.getLang)("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this)})),o.createElement("div",{className:"stories_send_form_helper"},o.createElement("div",{className:S("stories_send_form_buttons _emoji_wrap",{shown:this.state.sendFormFocused||this.state.sendFormHasText})},o.createElement("div",{ref:"smileButton",className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:function(t){window.Emoji.clearSizeCached(e.refs.smileButton),window.Emoji.show(e.refs.smileButton,t.nativeEvent)},onMouseLeave:function(t){return window.Emoji.hide(e.refs.smileButton,t.nativeEvent)},onMouseDown:function(e){return Object(E.cancelEvent)(e.nativeEvent)}}),o.createElement("div",{className:S("stories_send_form_button send",{active:this.state.sendFormHasText}),onClick:this._onSendMessageButtonCLick.bind(this)}))))},t.prototype._isReactionAvailable=function(){return Object(We.partConfigEnabled)("story_reactions_web")&&!this.props.story.isActiveLive()},t.prototype._onChangeReactionsPanelVisibility=function(e){void 0===e&&(e=!1),this._isReactionAvailable()&&this.setState({isReactionsPanelShow:e})},t.prototype.emojiInit=function(){var e,t=this;if(!this.emojiId&&this.refs.messageInput){var i=this._isReactionAvailable();if(this.emojiId=window.Emoji.init(this.refs.messageInput,{ttDiff:29,ref:"stories",ttWrap:this.refs.controls,checkEditable:function(){t.props.story.isActiveLive()&&Ke.default.checkTextLen(t.refs.messageInput)},noStickers:!i,noStickersStore:!i,onSend:function(){return t._sendMessage()},onStickerSend:function(e,i,o){t._sendMessage([["sticker",e,o]],{sticker_referrer:i})},forceUp:!0,controlsCont:this.refs.sendForm,onKeyAction:function(){return t._emojiDidKeyAction()},onEmojiAdded:function(){return t._emojiDidKeyAction()},onStoreHide:function(){t._updateReactionStickers(),t.props.story.autoResumeStory()}}),Object(E.addEvent)(this.refs.smileButton,"click",E.cancelEvent),Object(Ue.placeholderInit)(this.refs.messageInput,{editable:!0}),!this._checkLoadedStickers()){var o=Object(c.isRetina)()?"256b":"128b";window.Emoji.emojiLoadMore(this.emojiId,{sizes:(e={},e[o]=!0,e)},(function(){t._updateReactionStickers()}))}}else this.emojiId&&!this.refs.messageInput&&(Object(E.removeEvent)(this.refs.smileButton,"click",E.cancelEvent),window.Emoji.destroy(this.emojiId),delete this.emojiId)},t.prototype._checkLoadedStickers=function(){return this._getReactionsStickers().length<R.EMOJI_REACTIONS_ARR.length},t.prototype._leftSideIsEmpty=function(){var e=this.props.story,t=this.props.story.getCurStoryData(),i=t.can_manage,o=t.link,r=t.can_comment,s=t.narrative,n=e.getReplies(),a=e.getViews();return!(a&&0!==parseInt(a)&&!s)&&(!n||!i)&&!Object(c.isObject)(o)&&!r||e.isLiveEnded()},t.prototype._sendFormDidFocus=function(){var e=this.props.story;this.setState({sendFormFocused:!0}),this._isReactionAvailable()&&this._checkReactionsPanel(),e._onSendFormFocus(),e.layer._sendNavigationStatEvents("comment_tap")},t.prototype._sendFormDidBlur=function(){this.props.story._onSendFormBlur(),this.setState({sendFormFocused:!1}),this._isReactionAvailable()&&this._hideReactionPanel(),this._emojiDidKeyAction()},t.prototype._emojiDidKeyAction=function(){var e=Object(c.trim)(window.Emoji.editableVal(this.refs.messageInput));this.setState({sendFormHasText:e.length>0}),this.refs.messageInput.check()},t.prototype._hideReactionPanel=function(){this._onChangeReactionsPanelVisibility(!1)},t.prototype._showReactionPanel=function(){this._onChangeReactionsPanelVisibility(!0)},t.prototype._checkReactionsPanel=function(){this._isReactionAvailable()&&(this.props.story._getSendText().length?this._hideReactionPanel():this._showReactionPanel())},t.prototype._shareButtonDidPress=function(){this.props.story.shareBox()},t.prototype._likeButtonDidPress=function(){this.setState({needAnimateLikeButton:!0}),this.props.story.toggleLikeStory()},t.prototype._removeButtonDidPress=function(){this.props.story.removeStoryBox()},t.prototype._maskButtonDidPress=function(){this.props.story.sendMask()},t.prototype._linkDidPress=function(e,t){if(t){var i=t.object_type,o=t.object,r=t.url.match(/\/narrative(-?\d+)_(\d+)/);if(r){e.preventDefault();var s=r[1],n=r[2];s&&n&&(this.props.story.pauseStory(),Object(he.showNarrative)(s+"_"+n,{fromEl:this.props.story.wrapEl,isOpenNarrativeFromFeed:!0,source:"narrative_story"}))}else this.props.story._sendStatEvent("url_view");switch(i){case"audio":this.state.linkObjectAudioPlaying?(window.getAudioPlayer().pause(),this.setState({story:ze(ze({},this.state.story),{audioPlaying:!1})}),window.cur.storyLayer.resumeLayer()):(window.getAudioPlayer().playAudio(o),this.setState({story:ze(ze({},this.state.story),{audioPlaying:!0})}),window.cur.storyLayer.pauseLayer()),this.setState({linkObjectAudioPlaying:!this.state.linkObjectAudioPlaying}),e.preventDefault()}}},t.prototype._updateReactionStickers=function(){this.setState({reactionStickers:this._getReactionsStickers()})},t.prototype._getReactionsStickers=function(){var e=[];if(window.stickersKeywords&&window.Emoji.stickersById){var t=window.Emoji.stickersById,i=Object(c.isRetina)()?"256b":"128b",o={};R.EMOJI_REACTIONS_ARR.forEach((function(r){var s=window.stickersKeywords[Object(Fe.emojiRemoveSkinToneModifiers)(window.Emoji.codeToChr(r.code))],n=s&&window.Emoji.sortStickersHints(s),a={};n&&n.every((function(e){return!(e>0&&t[e]&&t[e].sticker&&!o[e])||(a=t[e].sticker,!1)})),a[6]&&a[6][i]&&(e.push({id:a[0],packId:0,uniqId:Object(c.irand)(0,1e5),imageUrl:a[6][i],animationUrl:a[3]}),o[a[0]]=!0)}))}return e},t.prototype._hideStickerHints=function(){var e=Object(a.geByClass1)("_sticker_hints",Object(a.domPN)(this.refs.messageInput));e&&"number"==typeof this.emojiId&&window.Emoji.stickersHintsHide(e,window.Emoji.opts[this.emojiId],100)},t.prototype._onSendMessageButtonCLick=function(){this._sendMessage()},t.prototype._sendMessage=function(e,t,i){var o=this;void 0===e&&(e=[]),void 0===t&&(t={}),void 0===i&&(i={});var r=e.length;this._hideStickerHints(),this.props.story._onAnswerSend((function(){o._emojiDidKeyAction(),r&&o._updateReactionStickers()}),e,t,i)},t}(o.Component),Ge=(i("OG14"),i("VRzm"),i("r7nW")),Ye=i("uW+i"),Qe=i("vRp6"),Xe=i("p+C8"),$e=i("NsuH"),Je=i("22MJ"),Ze=i("0Rlc");class et extends o.Component{constructor(e){super(e),this.onTabClick=(e,t)=>new Promise(()=>{var e=this.state,i=e.allGroupsTabList,o=e.pinnedIdsMap,r=i.filter(e=>o[e.id]),s=i.filter(e=>!o[e.id]);this.resetScroll(),this.setState({pinnedGroupsTabList:r,unpinnedGroupsTabList:s,tabKey:t})}),this.onSearchChange=e=>{var t=e.target.value;this.state.searchQuery!==t&&(this.resetScroll(),this.setState({searchQuery:t}))},this.onGroupItemClick=e=>new Promise(()=>{var t=this.state.pinnedIdsLength,i=this.state.pinnedIdsMap,o=+e.currentTarget.getAttribute("data-id"),r=this.allGroupsMap[o];r.isUserAdmin||r&&(t+=i[o]?-1:1,i[o]=!i[o],this.props.sendNavigationStatEvents(i[o]?"set_pin":"set_unpin"),this.setState({pinnedIdsMap:i,pinnedIdsLength:t}))}),this.setScrollContainerRef=e=>{var t=e;if(e&&e.container)for(t=e;t.container;)t=t.container;this.scrollContainer=t},this.onPutGroupsBackCheckBoxChange=()=>{var e=!this.state.putGroupsBack;e&&this.props.sendNavigationStatEvents("pin_to_end"),this.setState({putGroupsBack:e})},this.onSave=()=>{var e=this.props,t=e.onClose,i=e.showMessage,o=e.hash,r=this.state,s=r.pinnedIdsMap,n=r.putGroupsBack,a=Object.keys(s).filter(e=>s[e]);ajax.post("al_stories.php",{act:"save_feed_settings",pinned_ids:a.join(","),put_groups_back:intval(n),hash:o},{onDone:()=>{t(),i(Object(A.getLang)("stories_settings_saved"))},onFail:e=>{t(),i(e)},showProgress:()=>this.setState({isRequestSending:!0}),hideProgress:()=>this.setState({isRequestSending:!1})})};var t=e.groups,i=e.putGroupsBack,o=t.filter(e=>!e.is_pinned),r=t.filter(e=>e.is_pinned),s=t.reduce((e,t)=>(e[t.id]=t.is_pinned,e),{});this.state={tabKey:"all",searchQuery:"",isRequestSending:!1,putGroupsBack:i,allGroupsTabList:t,unpinnedGroupsTabList:o,pinnedGroupsTabList:r,pinnedIdsMap:s,pinnedIdsLength:r.length},this.allGroupsMap=t.reduce((e,t)=>(e[t.id]=t,e),{}),this.scrollContainer=null,this.groupsSearchIndex=null,this.createSearchIndex().then(e=>{this.groupsSearchIndex=e})}resetScroll(){this.scrollContainer.scrollTop=0}createSearchIndex(){var e=this.props.groups;return new Promise(t=>{new vkIndexer(e,e=>e.name,e=>{t(e)})})}getCurrentGroups(){var e=this.state,t=e.allGroupsTabList,i=e.pinnedGroupsTabList,o=e.unpinnedGroupsTabList,r=e.tabKey,s=e.searchQuery,n=[];switch(r){case"all":n=t;break;case"pinned":n=i;break;case"unpinned":n=o}if(s){var a=this.groupsSearchIndex.search(s);return n.filter(e=>a.includes(e))}return n}render(){var e=this.props.onClose,t=this.state,i=t.allGroupsTabList,r=t.pinnedIdsLength,s=t.searchQuery,n=t.isRequestSending,a=t.putGroupsBack,c=this.getCurrentGroups(),l=i.length-r;return o.createElement(Ge.default,{onClose:e,className:Object(D.classNames)("SettingsModal",this.props.className)},o.createElement("div",{className:"SettingsModal__header"},o.createElement(Ye.default,{className:"SettingsModal__tabs",onTabClick:this.onTabClick},o.createElement("span",{key:"all"},Object(A.getLang)("stories_settings_box_tab_all")),r>0&&o.createElement("span",{key:"pinned"},Object(A.getLang)("stories_settings_box_tab_separately"),o.createElement("span",{className:"Tabs__desc"},r)),l>0&&o.createElement("span",{key:"unpinned"},Object(A.getLang)("stories_settings_box_tab_grouped"),o.createElement("span",{className:"Tabs__desc"},l))),o.createElement("div",{className:"SettingsModal__headerCross",onClick:e})),o.createElement("div",{className:"SettingsModal__content"},o.createElement(Je.default,{value:s,autoFocus:!0,placeholder:Object(A.getLang)("stories_settings_box_search_placeholder"),onChange:this.onSearchChange}),o.createElement(Qe.default,{className:"SettingsModal__scrollContainer",hasMore:!1,virtualized:!0,loadMore:()=>{},ref:this.setScrollContainerRef},c.map(e=>o.createElement(Xe.default,{className:Object(D.classNames)(this._getGroupItemClasses(e)),"data-id":e.id,key:e.id,onClick:this.onGroupItemClick},o.createElement($e.default,{target:"_blank",size:"34",photo:e.photoUrl,title:e.name,href:e.url}))))),o.createElement("div",{className:"SettingsModal__footer"},o.createElement("div",{className:"SettingsModal__footerInner"},o.createElement(Ze.default,{className:"SettingsModal__putBackBtn",checked:a,onChange:this.onPutGroupsBackCheckBoxChange},Object(A.getLang)("stories_settings_box_put_back")),o.createElement("div",{className:"SettingsModal__submitButtons"},o.createElement(X.default,{key:"closeModal",appearance:"tertiary",onClick:e},Object(A.getLang)("global_cancel")),o.createElement(Y.default,{key:"saveModal",onClick:this.onSave,loading:n},Object(A.getLang)("global_save"))))))}_getGroupItemClasses(e){var t="SettingsModal__groupItem";return this.state.pinnedIdsMap[e.id]&&(t+=" SettingsModal__groupItem--pinned"),e.isUserAdmin&&(t+=" SettingsModal__groupItem--disabled"),t}}var tt,it=i("HLtZ"),ot=function(){function e(e,t){this.data=e,this.opts=t,this.paused=!0,this.loaded=!1,this.elems={},this.startTs=0,this.isPausedByMetaScroll=!1;var i=e.is_expired,o=e.is_deleted,r=e.is_private,s=e.narrative,n=e.isOneTimeSeen;i?this._error("expired"):o?s?this._error("deleted-narrative"):this._error("deleted"):n?this._error("isOneTimeSeen"):r&&(s?this._error("private-narrative"):this._error("private")),(i||o||r||n)&&(this.failed=!0)}return e.prototype.render=function(){var e=this;this._isFailed()&&this.isNarrativeMetaStory||this.isGroupsMetaStory||this.isAppsMetaStory||(this.longLoadingTimer=setTimeout((function(){e.isLoaded()||e.opts.onLongLoading()}),1e3),this.opts.onLoadingStart())},e.prototype.renderNarrativeCover=function(){var e=this.data,t=e.narrative,i=e.photo_url,o=t&&t.views?Object(c.winToUtf)(" · "+t.views):"";return this.NarrativeCover=Object(a.se)('\n      <div class="stories_narrative_cover">\n        <div class="stories_narrative_cover_photo" id="stories_narrative_cover_photo" style="background-image: url('+a.data+')"></div>\n        <div class="stories_narrative_cover__info">\n          <span class="stories_narrative_cover__label">'+Object(ge.getLang)("global_type_narrative")+'</span>\n          <span class="stories_narrative_cover__views">'+o+'</span>\n        </div>\n        <div class="stories_narrative_cover__title">'+t.title+'</div>\n        <div class="stories_narrative_cover__author">'+t.owner_name+"</div>\n      </div>\n    "),v(i).then((function(e){var t=document.querySelector(".stories_narrative_cover_photo");t&&Object(a.setStyle)(t,"backgroundImage","url("+e+")")})).catch((function(e){Object(it.logError)(e)})),this.NarrativeCover},e.prototype.renderAppsMetaStory=function(){var e=this,t=Object(a.ce)("div",{className:"MetaStory"}),i=window.Stories._getList("apps");if(i){this.coverItems=i,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elems.recBlock=Object(a.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(a.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(a.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var o=Object(a.ce)("div",{className:"MetaStory__infoWrapper"}),r=Object(a.ce)("div",{className:"MetaStory__info"}),s=Object(a.ce)("a",{className:"MetaStory__appWrapper",href:this.data.app.url,target:"_blank"});s.appendChild(Object(a.ce)("div",{className:"MetaStory__appIcon"},{backgroundImage:"url("+this.data.app.photoUrl+")"})),s.appendChild(Object(a.ce)("div",{className:"MetaStory__appName",innerHTML:this.data.app.name})),s.appendChild(Object(a.ce)("span",{className:"MetaStory__appLink",innerHTML:Object(ge.getLang)("stories_go_to_app")})),r.appendChild(s),o.appendChild(r),Object(a.setStyle)(o,{paddingBottom:this.elemOffset+"px"}),Object(a.setStyle)(this.elems.recItems,{minHeight:"calc(100% - "+this.elemOffset+"px"}),t.appendChild(o);var n=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),c=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),l=Object(a.ce)("div",{className:"MetaStory__clickableArea"});l.appendChild(n),l.appendChild(c),Object(E.addEvent)(l,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),Object(E.addEvent)(l,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach((function(t){var i=t.items.filter((function(e){return e.unread})),o=!!i.length,r=t.items[0];o&&(r=i[0]);var s=Object(a.ce)("span",{className:"GridStoryPreview"+("live"===r.type?" GridStoryPreview--live":""),onclick:function(e){var i=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(t)+"/apps",{fromEl:i})}}),n=Object(a.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+t.author.href+'" data-author-id="'+t.author.id+'" class="GridStoryPreview__author'+(o?" GridStoryPreview__author--unread":"")+'" style="background-image: url(\''+t.author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+t.author.name+"</span>\n          "},{backgroundImage:"url('"+r.preview_url+"')"}),c=new Image;c.src=r.small_preview,c.onload=function(){Object(a.setStyle)(n,{backgroundImage:"url('"+r.small_preview+"')"})},s.appendChild(n),e.elems.recItems.appendChild(s)})),Object(E.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(l),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),t.appendChild(this.elems.recBlock)}return t},e.prototype.renderGroupsMetaStory=function(){var e=this,t=Object(a.ce)("div",{className:"MetaStory"}),i=window.Stories._getList("groups");if(i){this.coverItems=i,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elems.recBlock=Object(a.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(a.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(a.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var o=Object(a.ce)("div",{className:"MetaStory__infoWrapper"}),r=Object(a.ce)("div",{className:"MetaStory__info"});r.appendChild(Object(a.ce)("div",{className:"MetaStory__infoTitle",innerHTML:Object(ge.getLang)("stories_groups_grid_title")})),r.appendChild(Object(a.ce)("div",{className:"MetaStory__infoDescription",innerHTML:Object(ge.getLang)("stories_groups_grid_text")})),o.appendChild(r),Object(a.setStyle)(o,{paddingBottom:this.elemOffset+"px"}),Object(a.setStyle)(this.elems.recItems,{minHeight:"calc(100% - "+this.elemOffset+"px"}),t.appendChild(o);var s=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),n=Object(a.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),c=Object(a.ce)("div",{className:"MetaStory__clickableArea"});c.appendChild(s),c.appendChild(n),Object(E.addEvent)(c,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),Object(E.addEvent)(c,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach((function(t){var i=t.items.filter((function(e){return e.unread})),o=!!i.length,r=t.items[0];o&&(r=i[0]);var s=Object(a.ce)("span",{className:"GridStoryPreview"+("live"===r.type?" GridStoryPreview--live":""),onclick:function(e){var i=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(t)+"/groups",{fromEl:i})}}),n=Object(a.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+t.author.href+'" data-author-id="'+t.author.id+'" class="GridStoryPreview__author'+(o?" GridStoryPreview__author--unread":"")+'" style="background-image: url(\''+t.author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+t.author.name+"</span>\n          "},{backgroundImage:"url('"+r.preview_url+"')"}),c=new Image;c.src=r.small_preview,c.onload=function(){Object(a.setStyle)(n,{backgroundImage:"url('"+r.small_preview+"')"})},s.appendChild(n),e.elems.recItems.appendChild(s)})),Object(E.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(c),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),t.appendChild(this.elems.recBlock)}return t},e.prototype.renderNarrativeMetaStory=function(){var e=this,t=!(!window.cur.storyLayer||!window.cur.storyLayer.isOpenNarrativeFromFeed),i=window.cur.storyLayer.list,o=i+"_recommendations",r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),s=Object(a.ce)("div",{className:"MetaStory"}),n=Object(a.ce)("div",{className:"MetaStory__buttons"});n.appendChild(this.renderNarrativeButton("replay",(function(){window.cur.storyLayer._sendNavigationStatEvents("narrative_replay",!1),window.cur.storyLayer.changeStory(0)}))),t&&n.appendChild(this.renderNarrativeButton("go_to_stories",(function(){window.cur.storyLayer._sendNavigationStatEvents("narrative_go_to_stories",!1),window.cur.storyLayer.nextStory()}))),s.appendChild(n);var c=window.Stories._getList(o);return i.match(/narrative-?\d+_\d+$/)&&c&&(this.coverItems=c.map((function(e){return e.narrative_cover})),this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elems.recBlock=Object(a.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=Object(a.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=Object(a.ce)("div",{className:"MetaStory__rec-items"}),this.elems.recTitle=Object(a.ce)("div",{className:"MetaStory__rec-title",innerHTML:Object(ge.getLang)("stories_narrative_more")}),this.elemOffset=0,1===this.coverRowsCount?this.elemOffset=26.4:this.coverRowsCount>1&&(this.elemOffset=26.4*1.5),this.scrollOffset=r/100*this.elemOffset+53,Object(a.setStyle)(n,{paddingBottom:this.elemOffset+"vh"}),Object(a.setStyle)(this.elems.recTitle,{marginTop:"calc(100vh - "+this.elemOffset+"vh - 53px - 70px)"}),this.coverItems.forEach((function(t){var i=Object(a.ce)("span",{className:"GridStoryPreview",onclick:function(e){var i=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(t)+"/"+o,{fromEl:i,narrativeId:t.narrative.id,source:"narrative_recommendations"})}},{backgroundImage:"url('"+t.preview_url+"')"}),r=Object(a.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+c[0].author.href+'" class="GridStoryPreview__author" style="background-image: url(\''+c[0].author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+t.narrative.title+"</span>\n          "},{backgroundImage:"url('"+t.small_preview+"')"});i.appendChild(r),e.elems.recItems.appendChild(i)})),Object(E.addEvent)(this.elems.recBlock,"scroll wheel touchmove",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(this.elems.recTitle),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),s.appendChild(this.elems.recBlock)),s},e.prototype.renderNarrativeButton=function(e,t){var i="",o="";switch(t=Object(c.isFunction)(t)?t:function(){},e){case"replay":i="replay",o=Object(ge.getLang)("stories_narrative_repeat_bottom");break;case"go_to_stories":i="back",o=Object(ge.getLang)("stories_narrative_back_bottom")}var r=Object(a.ce)("div",{className:"narrative-meta-button__circle narrative-meta-button__circle_"+i,onclick:t}),s=Object(a.ce)("div",{className:"narrative-meta-button__text",innerHTML:o}),n=Object(a.ce)("div",{className:"narrative-meta-button"});return n.appendChild(r),n.appendChild(s),n},e.prototype.handleRecommendationsScroll=function(){var e=Math.min(this.elems.recInner.scrollTop/(this.scrollOffset/100),70)/100;Object(a.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, "+e+")"}),this.elems.recInner.scrollTop?(this.isPausedByMetaScroll=!0,Object(a.addClass)(this.elems.recBlock,"scroll"),this.pause()):(this.isPausedByMetaScroll=!1,this.play(),Object(a.removeClass)(this.elems.recBlock,"scroll"),Object(a.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, 0)"})),(this.data.is_groups_meta_story||this.data.is_apps_meta_story)&&(this.elems.blockHeader||(this.elems.blockHeader=window.cur.storyLayer.activeStory.authorButtons.querySelector(".stories_groups_settings_text")),this.elems.recInner.scrollTop&&Object(a.removeClass)(window.cur.storyLayer.activeStory.wrapEl,"paused"),this.elems.recInner.scrollTop>this.metaStoryGridMarginTop?(Object(a.removeClass)(window.cur.storyLayer.activeStory.wrapEl,"paused"),Object(a.removeClass)(this.elems.blockHeader,"stories_groups_settings_text_hide")):Object(a.addClass)(this.elems.blockHeader,"stories_groups_settings_text_hide"))},e.prototype.handleGridInfoWrapperMouseDown=function(){this.downTs=Object(c.vkNow)(),this.longTapTimer=setTimeout(this.longTapInfoWrapper.bind(this),R.LONG_PRESS_DELAY_MS)},e.prototype.handleGridInfoWrapperMouseUp=function(e){if(window.cur.storyLayer.activeStory){clearTimeout(this.longTapTimer);var t=!(Object(c.vkNow)()-this.downTs<R.LONG_PRESS_DELAY_MS);if(Object(a.hasClass)(e.target,"MetaStory__backBtn")&&!t)return window.cur.storyLayer.activeStory.prevStory();t?window.cur.storyLayer.activeStory.isPaused()&&window.cur.storyLayer.activeStory.playStory(!1,!!this.downTs):window.cur.storyLayer.activeStory._onPlayEnd()}},e.prototype.longTapInfoWrapper=function(){window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory._longTapHandle()},e.prototype.getContainer=function(){},e.prototype.play=function(){this.paused=!1,this.isLoaded()&&this.opts.onPlay()},e.prototype.pause=function(){this.paused=!0,this.opts.onPause()},e.prototype.setCurrentTime=function(e){void 0===e&&(e=0)},e.prototype.destroy=function(){Object(E.removeEvent)(this.elems.recBlock),clearTimeout(this.longLoadingTimer)},e.prototype.isPaused=function(){return this.paused},e.prototype.isLoaded=function(){return this.loaded},e.prototype.getCurrentTime=function(){return 0},e.prototype.getDuration=function(){return 0},e.prototype.getId=function(){return this.data.raw_id},e.prototype.getTrackCode=function(){return this.data.track_code},e.prototype.getDate=function(){return this.data.date},e.prototype.getViews=function(){return this.data.views},e.prototype.getReplies=function(){return this.data.replies},e.prototype.setViews=function(e){this.data.views=e},e.prototype.setReplies=function(e){this.data.repliesCountText=e},e.prototype.isOneTime=function(){return this.data.isOneTime&&this.data.authorId!==window.vk.id},e.prototype._onCanPlay=function(){if(clearTimeout(this.longLoadingTimer),this.loaded=!0,this.opts.onLoadingEnd(),this.startTs=Date.now(),this.data.seenProgress&&this.isOneTime()&&this.setCurrentTime(+(this.data.seenProgress*this.getDuration()/100).toFixed(1)),!this.isPaused()){var e=document.visibilityState;if(e&&"visible"!==e)return;this.play()}},e.prototype._loadingError=function(){this._error("load")},e.prototype._isFailed=function(){return this.failed},e.prototype._error=function(e){clearTimeout(this.longLoadingTimer),this.opts.onError(e)},e}(),rt=i("Ia1d"),st=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),nt=function(e){function t(t,i,o){var r=e.call(this,t,i)||this;return r.wrapEl=o,r.videoRaw=r.data.video.owner_id+"_"+r.data.video.video_id,r}return st(t,e),t.prototype.render=function(){var t=this;e.prototype.render.call(this),this.el=Object(a.ce)("div",{className:"stories_live"});var i=Object(a.ce)("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(i),this.chatEl=Object(a.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&window.Videoview.hide(!1,!0),setTimeout((function(){Object(rt.showInlineVideo)(t.videoRaw,"",{autoplay:1,module:"story",onLoaded:function(){t._onPlayerInited()}},!1,i)})),this.el},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._resetTimer(),window.mvcur={},this.player&&(this.player.destroy(),Ke.default.destroy()),window.cur.storyLayer._sendNavigationStatEvents("live_player_close",!1),delete this.el},t.prototype.getContainer=function(){return this.el||this.render()},t.prototype.onLiveEnded=function(){var e=this;this.liveEnded=!0,Object(a.hide)(Object(a.geByClass1)("_error_msg",Object(a.geByClass1)("videoplayer_error")));var t=this.mvData.oid<0?Object(ge.getLang)("stories_live_ended_desc_club"):Object(ge.langSex)(this.mvData.author_sex,Object(ge.getLang)("stories_live_ended_desc_user","raw"));t=t.replace("{name}",this.mvData.md_author);var i=this.mvData.oid<0?Object(ge.getLang)("stories_live_ended_open_club"):Object(ge.getLang)("stories_live_ended_open_user");Object(a.hide)(this.chatEl),Object(a.hide)(Object(a.domByClass)(this.player.ui.thumb,"videoplayer_big_play_btn"));var o=window.cur.storyLayer.storiesBlocks.length>1;this.el.appendChild(Object(a.se)('\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url('+this.mvData.author_photo+')"></div>\n      <div class="stories_live_end_title">'+Object(ge.getLang)("stories_live_ended_title")+'</div>\n      <div class="stories_live_end_desc">'+t+'</div>\n      <a href="'+this.mvData.author_href+'" class="stories_live_end_open_owner">'+i+'</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="'+(o?"":"display: none;")+'">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">'+Object(ge.getLang)("stories_live_ended_watch_next")+"</div>\n      </div>\n    </div>\n    ")),o&&setTimeout((function(){e._startTimer()}))},t.prototype.pause=function(){},t.prototype.play=function(){this.player&&!this.liveEnded&&(e.prototype.play.call(this),this.player&&this.player.play())},t.prototype.sendMessage=function(e,t){e.length>window.mvcur.maxChatReplyLength||(window.ajax.post("al_video.php?act=post_comment",{comment:e,video:this.videoRaw,hash:this.mvData.hash,videoviewer_chat:1}),window.cur.storyLayer.activeStory._onAnswerSent(t))},t.prototype.volumeUpdate=function(){this.player.setVolume(y())},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this),Object(a.setStyle)(this.el,"opacity",1)},t.prototype._onPlayerInited=function(){this._onCanPlay(),this.player=window.cur.videoInlinePlayer,this.play(),window.cur.storyLayer._sendNavigationStatEvents("live_player_show",!1),window.browser.safari&&this.player.toggleMute(!0,!1),this.mvData=window.Videoview.getMvData(),window.mvcur={chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion},Ke.default.init(this.chatEl,{scrollHidden:!0}),window.Videoview.queueCheckUpdates(this.mvData.queue_params)},t.prototype._startTimer=function(){var e=this;if(window.CanvasRenderingContext2D){var t=Object(a.domByClass)(this.el,"_timer_canvas"),i=t.getContext("2d");i.lineWidth=6,i.lineCap="round",i.strokeStyle="#fff";var o=Date.now(),r=function(){var t=(Date.now()-o)/5e3;t<1?(i.clearRect(0,0,100,100),i.beginPath(),i.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*t),i.stroke(),e._nextTO=setTimeout(r,16)):window.cur.storyLayer.nextStory()};Object(a.show)(t),this.timerInProgress=!0,r()}},t.prototype._resetTimer=function(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,Object(a.hide)(Object(a.domByClass)(this.el,"_timer_canvas")))},t}(ot),at=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ct=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.isFirstChunkLoaded=!1,o}return at(t,e),t.prototype.render=function(){var t=this;if(e.prototype.render.call(this),this.video)return this.video;var i=this.data.video_url;return this.video=document.createElement("video"),this.video.setAttribute("class","stories_video"),this.video.setAttribute("autoplay","false"),this.video.setAttribute("volume",Object(H.getAudioPlayer)().getVolume()),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),Object(E.addEvent)(this.video,"error",(function(){t._loadingError()})),this._isFailed()||(this.loaded&&(this.video.currentTime=0),Object(E.addEvent)(this.video,"canplay",this._onCanPlay.bind(this)),this.video.src=i,this.volumeUpdate()),this.video},t.prototype.getContainer=function(){return this.video||this.render()},t.prototype.getImage=function(){var e=Object(a.getSize)(this.video),t=document.createElement("canvas");t.setAttribute("width",e[0].toString()),t.setAttribute("height",e[1].toString());var i=t.getContext("2d");return i&&i.drawImage(this.video,0,0,e[0],e[1]),t.toDataURL()},t.prototype.destroy=function(){e.prototype.destroy.call(this),Object(E.removeEvent)(this.video),delete this.video},t.prototype.play=function(){var t=this;if(e.prototype.play.call(this),this.loaded&&this.video){var i=this.video.play();void 0!==i&&i.catch((function(){t.opts.onAutoPlayFail()}))}},t.prototype.pause=function(){e.prototype.pause.call(this),this.video&&this.video.pause()},t.prototype.setCurrentTime=function(e){void 0===e&&(e=0),e=+(e/1e3).toFixed(1),this.loaded&&this.video.currentTime<e&&(this.video.currentTime=e)},t.prototype.getCurrentTime=function(){return 1e3*this.video.currentTime},t.prototype.getDuration=function(){return 1e3*this.video.duration},t.prototype.volumeUpdate=function(){this.video.volume=y()},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this),!this.isFirstChunkLoaded&&window.cur.storyLayer&&(this.isFirstChunkLoaded=!0,window.cur.storyLayer._sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0})),Object(a.setStyle)(this.video,"opacity",1),Object(E.removeEvent)(this.video,"canplay")},t}(ot),lt=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),dt=function(e){function t(t,i){var o=e.call(this,t,i)||this;return o.pauseTime=0,o}return lt(t,e),t.prototype.render=function(){var t=this;if(e.prototype.render.call(this),this.photo)return this.photo;var i=this.data,o=i.photo_url,r=i.narrative;return this.photo=document.createElement("div"),this.photo.setAttribute("class","stories_photo"),this._isFailed()||v(o).then((function(e){t.photo&&(r&&r.is_cover?Object(a.addClass)(t.photo,"stories_narrative_cover_blur"):Object(a.setStyle)(t.photo,"backgroundImage","url("+e+")"),t._onCanPlay())})).catch((function(){t.isGroupsMetaStory||t.isAppsMetaStory?t._onCanPlay():t._loadingError()})),this.photo},t.prototype.getContainer=function(){return this.isNarrativeMetaStory||this.isGroupsMetaStory||this.isAppsMetaStory||this.photo||this.render()},t.prototype.destroy=function(){e.prototype.destroy.call(this),delete this.photo},t.prototype.play=function(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),e.prototype.play.call(this)},t.prototype.pause=function(){this.isPaused()||(e.prototype.pause.call(this),this.pauseTime=this.getCurrentTime())},t.prototype.setCurrentTime=function(e){void 0===e&&(e=0),this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)},t.prototype.getCurrentTime=function(){return Date.now()-this.startTs||0},t.prototype.getDuration=function(){return 5e3},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this);var t=this.isGroupsMetaStory?"group_feed_view":"view_story";window.cur.storyLayer._sendNavigationStatEvents(t,!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0}),Object(a.setStyle)(this.photo,"opacity",1)},t}(ot),ut=i("QChX"),pt=i("DM2o");function _t(e){if(ut.HAS_MEDIA_SESSION){var t=(tt=e).getCurStoryData();if(["video"].includes(t.type)&&!t.noSound){var i=Object(N.decodeHTMLEntities)(tt.data.author.name),o=Object(N.decodeHTMLEntities)(t.date),r=t.small_preview||t.photo_url||t.first_frame||t.preview_url,s=r?[{sizes:"800x1497",src:r}]:[];!function(){if(!ut.HAS_MEDIA_SESSION)return;navigator.mediaSession.setActionHandler("play",ht),navigator.mediaSession.setActionHandler("pause",mt),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",vt),navigator.mediaSession.setActionHandler("nexttrack",ft)}(),Object(ut.updateMediaSessionMetadata)({title:i,artist:o,album:"",artwork:s})}else Object(ut.clear)()}}function ht(){tt.playStory(),Object(pt.statlogsValueEvent)("global_media_controls","story_player","play")}function mt(){tt.pauseStory(),Object(pt.statlogsValueEvent)("global_media_controls","story_player","pause")}function vt(){tt.prevStory(),Object(pt.statlogsValueEvent)("global_media_controls","story_player","previous_track")}function ft(){tt.nextStory(),Object(pt.statlogsValueEvent)("global_media_controls","story_player","next_track")}var gt=i("lXE5"),bt=i("lBJi"),yt=i("k487"),wt=i("v+DW"),St=i("kcIO"),kt=i("rudk"),Et=i("FThC"),Ot=i("El3O"),Ct=function(){function e(e,t){var i=this;this.updateBottom=function(e){var t=Object(a.geByClass1)("stories_bottom_wrap",i.wrapEl);!i.isActive||e||!i.story||i.story.isNarrativeMetaStory||i.story.isGroupsMetaStory||i.story.isAppsMetaStory?(s.unmountComponentAtNode(t),Object(a.val)(t,"")):s.render(o.createElement(qe,{story:i,markAppNotificationsSeen:i.markAppNotificationsSeen}),t)},this.markAppNotificationsSeen=function(e){var t=i.getCurStoryData(),o=t.raw_id,r=void 0===o?"":o,s=t.accessKey;if(e.appId&&e.appRef){var n=r.split("_"),a=n[0],c=n[1];e.hasNewInteractions&&window.ajax.post("al_stories.php",{act:"mark_app_notifications_seen",owner_id:a,story_id:c,sticker_id:e.id,access_key:s,hash:e.hash},{onDone:function(){t.clickable_stickers&&t.clickable_stickers.stickers&&t.clickable_stickers.stickers.forEach((function(t){t.id===e.id&&t.type===R.StickerTypes.app&&(t.hasNewInteractions=!1)}));var i=document.querySelector("._stories_button_app");i&&i.classList.contains("has_new")&&i.classList.remove("has_new");var o=document.querySelector("#feed_story_"+a+" .stories_feed_preview_app");o&&o.classList.contains("has_new")&&o.classList.remove("has_new")}}),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),i.pauseStory(),Object(H.showWiki)({w:"app"+e.appId,app_ref:e.appRef,app_hash:e.appHash}),i.layer._sendNavigationStatEvents("click_to_app",!0,{clickable_sticker:{id:e.id,type:"app"}})}},this.toggleFeedbackTooltip=function(e){void 0===e&&(e=!i.isFeedbackTooltipShow),e?i.showFeedbackTooltip():i.hideFeedbackTooltip()},this.onFetchFeedbackData=function(e){var t,o,r;i.feedback=e;var s=null===(o=null==e?void 0:e.replies)||void 0===o?void 0:o.repliesTotalCountText,n=null===(r=null==e?void 0:e.viewers)||void 0===r?void 0:r.viewsTotalCountText,a=null==e?void 0:e.replies,l=null==a?void 0:a.listName,d=null==a?void 0:a.list;s&&i.setReplies(s),n&&i.setViews(n),a&&d&&(window.cur=Object(c.extend)(window.cur,((t={})["stories_list_"+l]=d,t)),a.list=d.length>R.INIT_MAX_FEEDBACK_STORIES_COUNT?d.slice(0,R.INIT_MAX_FEEDBACK_STORIES_COUNT):d,a.moreRepliesCount=d.length-a.list.length),i.updateBottom()},this.showMoreReplies=function(){var e,t=null===(e=i.feedback)||void 0===e?void 0:e.replies,o=null==t?void 0:t.listName,r=null==t?void 0:t.list;if(t&&r){var s=window.Stories._getList(o);t.list=s.slice(0,t.list.length+R.MAX_FEEDBACK_STORIES_SLICE_COUNT),t.moreRepliesCount=s.length-t.list.length,i.updateBottom()}},this.onFetchViewers=function(e){var t,o;(null===(o=null===(t=i.feedback)||void 0===t?void 0:t.viewers)||void 0===o?void 0:o.items)&&(i.feedback.viewers.items=i.feedback.viewers.items.concat(e.viewers),i.feedback.viewers.nextFrom=e.nextFrom,i.updateBottom())},this.onQuestionRemove=function(e){var t,o;(null===(o=null===(t=i.feedback)||void 0===t?void 0:t.questions)||void 0===o?void 0:o.items)&&(i.feedback.questions.items=i.feedback.questions.items.filter((function(t){return t.id!==e})),i.feedback.questions.items.length||delete i.feedback.questions,i.updateBottom())},this.onPrivacyHintHide=function(){var e,t;(null===(t=null===(e=i.feedback)||void 0===e?void 0:e.stats)||void 0===t?void 0:t.showPrivacyHint)&&(window.ajax.post("al_stories.php",{act:"hide_privacy_hint",privacy_hint_hash:i.feedback.stats.privacyHintHash}),i.feedback.stats.cells||i.feedback.stats.extendedStats?i.feedback.stats.showPrivacyHint=!1:delete i.feedback.stats,i.updateBottom())},this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormActive=!1,this.isModalShown=!1,this.isFeedbackTooltipShow=!1,this.feedback=null,this.story=!1,this.pressedStory=null,this.index=0,this._currentTimeLineAdditionalEl=null,this._currentTimeLineEl=null,this.preloadedStories={},this.layer=t.layer,this.longTapTimer}return e.prototype.destroy=function(){this._destroyStory(),Object(E.removeEvent)(Object(a.geByClass1)("stories_item_cont",this.contWrap)),Object(E.removeEvent)(Object(a.geByClass1)("stories_reply_to",this.replyToWrap)),Object(E.removeEvent)(this.shareButton),delete this.shareButton,Object(E.removeEvent)(this.followBtn),delete this.followBtn,Object(E.removeEvent)(this.pinButton),delete this.pinButton,Object(E.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);for(var e=Object(a.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)Object(E.removeEvent)(e[t]);Object(E.removeEvent)(this.viewsButton),Object(E.removeEvent)(Object(a.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.replyToWrap,delete this.descEl,delete this.replyToWrap,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl;var i=!1;for(t=0;t<this.data.items.length;t++)if(this.data.items[t].unread){i=!0;break}var o=x();if(!i&&o&&o.activeStory&&!this.data.is_apps){var r=Object(a.domQuery)("#feed_story_"+this.layer.getBlockKey(this.data),o.activeStory.wrapEl)[0];Object(a.removeClass)(r,"story_feed_new_item"),Object(a.removeClass)(r,"story_feed_new_item_promo")}Object(ut.clear)()},e.prototype._destroyTimeLine=function(){for(var e=Object(a.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)Object(E.removeEvent)(e[t])},e.prototype.getOwnerId=function(){return this.data.author.id},e.prototype.getIndex=function(){return this.index},e.prototype.isLastStory=function(){return this.index>=this.data.items.length-1},e.prototype.getRawId=function(){return!!this.story&&this.story.getId()},e.prototype.getTrackCode=function(){return!!this.story&&this.story.getTrackCode()},e.prototype.getReadHash=function(){return this.data.read_hash},e.prototype.getPinHash=function(){return this.data.stories_pin_hash},e.prototype.getGetGroupsSettingsHash=function(){return this.data.stories_get_groups_settings_hash},e.prototype.getSaveGroupsSettingsHash=function(){return this.data.stories_save_groups_settings_hash},e.prototype.getType=function(){return this.data.type},e.prototype.getItems=function(){return this.data.items},e.prototype.getItemsLength=function(){return this.getItems().length},e.prototype.render=function(){var e=this;this.wrapEl=Object(a.ce)("div",{className:"stories_item"}),this.contWrap=Object(a.ce)("div",{className:"stories_item_cont_wrap"}),this.contStickers=Object(a.ce)("div",{className:"stories_item_cont_sticker"}),this.storiesHeader=Object(a.ce)("div",{className:"stories_header"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);var t=Object(a.ce)("div",{className:"stories_item_cont"});return Object(E.addEvent)(t,"mousedown",(function(t){e._onMouseDownHandle(t.target)})),Object(E.addEvent)(t,"mouseup",(function(t){e._onMouseUpHandle(t.target)})),this.contWrap.appendChild(t),this.contWrap.appendChild(this.storiesHeader),this.storiesHeader.appendChild(this._renderAuthor()),this.storySendFormOverlay=Object(a.ce)("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild(Object(a.ce)("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),window.cur.noStoriesBack||(this.backButton=Object(a.ce)("div",{className:"stories_item_back"}),t.appendChild(this.backButton)),this.replyToWrap=t.appendChild(Object(a.ce)("div",{className:"stories_reply_to_wrap"})),this.inlineLoader=t.appendChild(Object(a.ce)("div",{className:"stories_inline_loader",innerHTML:Object(Ot.getProgressHtml)()})),this.contWrap.appendChild(Object(a.ce)("div",{className:"stories_play_button video_thumb_play",onclick:function(){e.story&&e.story.play()}})),this.isActiveLive()?Object(a.addClass)(this.wrapEl,"live"):this._initTimeLine(),Object(a.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl},e.prototype._canForceDeleteStories=function(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted},e.prototype._initTimeLine=function(){this.timeLineEl&&(this._destroyTimeLine(),Object(a.re)(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())},e.prototype._isActionsShown=function(){var e=Object(a.domClosest)("_ui_menu_wrap",this.wrapEl);return Object(a.hasClass)(e,"shown")},e.prototype._renderPreview=function(){return Object(a.se)('<div class="stories_preview"></div>')},e.prototype._renderMessage=function(e){return Object(a.se)('<div class="stories_message">\n  <div class="stories_message_text">'+e+"</div>\n</div>")},e.prototype._showMessage=function(e){var t=this;Object(a.re)(Object(a.geByClass1)("stories_message",this.contWrap));var i=this._renderMessage(e);return this.contWrap.appendChild(i),clearTimeout(this.showMessageTimer),new Promise((function(e){t.showMessageTimer=setTimeout((function(){t.contWrap.removeChild(i),e()}),3e3)}))},e.prototype._setPreview=function(e,t){var i=this,o=this.index,r=this.data.items[o].preview_url;r!==this.curPreviewUrl&&r&&(e=e||Object(a.geByClass1)("stories_preview",this.contWrap),v(r).then((function(s){o===i.index&&r!==i.curPreviewUrl&&(i.curPreviewUrl=r,Object(a.setStyle)(e,"backgroundImage","url("+s+")")),Object(a.setStyle)(e,"opacity",1),t&&setTimeout(t,0)})).catch((function(e){Object(it.logError)(e)})))},e.prototype.getPreview=function(){return this.data.items[this.index].preview_url},e.prototype._renderAuthor=function(){var e,t=this,i=this.data.author,o=i.photo,r=i.href,s=i.name,n=i.verify,c=this.data&&this.data.items[0]&&this.data.items[0].narrative,l="_self";if(this.layer.list.includes("place")&&(l="_blank"),this.data.is_groups)e='\n      <div class="stories_author_cont">\n        <a href="/groups" target="_blank" class="stories_author_name"><span>'+Object(ge.getLang)("stories_groups_feed_block")+'</span></a>\n        <div class="stories_desc"></div>\n      </div>';else if(this.data.is_narrative&&c&&!c.is_cover)e='\n      <div>\n          <div class="stories_narrative_title">'+c.title+'</div>\n          <span class="stories_narrative_author"><a href="'+r+'" target="'+l+'" class="stories_narrative_author_link">'+s+"</a> · "+Object(ge.getLang)("global_type_narrative")+"</span>\n      </div>";else{e='\n      <div class="stories_author_cont">\n        '+('<a href="'+r+'" class="stories_author_photo_wrap"><img src="'+o+'" class="stories_author_photo" /></a>')+'\n        <a href="'+r+'" target="'+l+'" class="stories_author_name"><span>'+s+"</span></a>\n        "+(n||"")+'\n        <div class="stories_desc"></div>\n      </div>'}var d=Object(a.se)('\n      <div class="stories_author">\n        <div class="stories_author_cont_wrap">\n          <div class="stories_author_inner">'+e+'</div>\n          <div class="stories_author_buttons"></div>\n         </div>\n      </div>\n    ');return Object(E.addEvent)(d,"click",(function(e){Object(a.domClosestByTag)("a",e.target)&&t.layer._sendNavigationStatEvents("go_to_author")})),!0===this.data.hide_owner&&Object(a.val)(Object(a.geByClass1)("stories_author_cont",d),""),Object(a.toggleClass)(this.wrapEl,"hide_owner",!0===this.data.hide_owner),this.descEl=Object(a.geByClass1)("stories_desc",d),this.authorButtons=Object(a.geByClass1)("stories_author_buttons",d),d},e.prototype._createPinButton=function(e){var t=this;void 0===e&&(e=!1);var i=Object(a.ce)("div",{className:"stories_group_btn stories_group_btn_pin"+(e?" stories_group_btn_unpin":"")});return Object(E.addEvent)(i,"click",(function(){var e=Object(a.hasClass)(i,"stories_group_btn_unpin");t.layer._sendNavigationStatEvents(e?"unpin":"pin"),t.toggleCurrentOwnerPin()})),this._showFeatureTooltipIfNeed(),i},e.prototype._showFeatureTooltipIfNeed=function(){var e=this;window.cur.stories_pin_feature_tooltip&&!window.cur.pinFeatureTooltip&&(window.cur.pinFeatureTooltipTimeoutId=setTimeout((function(){var t=Object(a.geByClass1)("stories_group_btn_pin",e.wrapEl);if(t){var i=Object(a.se)('\n        <div>\n          <div class="stories_pin_feature_tt_close" onclick="cur.pinFeatureTooltip.hide(); cancelEvent(event);"></div>\n          <div>'+Object(ge.getLang)("stories_groups_tooltip")+"</div>\n        </div>\n     ");Object(E.addEvent)(i,"click",(function(){window.cur.pinFeatureTooltip.hide()})),window.cur.pinFeatureTooltip=new yt.default(t,{appendToParent:!0,autoShow:!1,forceSide:"bottom",cls:"eltt_fancy stories_pin_feature_tt",offset:[4,-3],content:i,align:"right",onHide:e._closeFeatureTooltip.bind(e)}),e.pauseStory(),window.cur.pinFeatureTooltip.show(),clearTimeout(window.cur.pinFeatureTooltipTimeoutId)}}),2e3),window.cur.destroy&&window.cur.destroy.push((function(){return clearTimeout(window.cur.pinFeatureTooltipTimeoutId)})))},e.prototype._closeFeatureTooltip=function(e){void 0===e&&(e=!0),window.cur.pinFeatureTooltip&&(window.cur.stories_pin_feature_tooltip=!1,window.cur.pinFeatureTooltip.destroy(),window.cur.pinFeatureTooltip=null,e&&this.playStory(),window.ajax.post("al_index.php",{act:"hide_feature_tt",hash:Object(ge.getLang)("stories_pin_feature_tooltip_hash"),type:"stories_pin"},{onDone:function(){}}))},e.prototype._renderFollowButton=function(){var e=this;return this.followBtn=Object(a.ce)("div",{className:"stories_author_button stories_follow"}),Object(E.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),Object(E.addEvent)(this.followBtn,"mouseover",(function(){var t=Object(a.hasClass)(e.followBtn,"followed")?Object(ge.getLang)("stories_unfollow"):Object(ge.getLang)("stories_follow");Object(J.showTooltip)(e.followBtn,{black:1,center:1,shift:[0,5,0],text:t,appendEl:e.contWrap})})),this.followBtn},e.prototype._renderTimeLine=function(){var e=this;this.timeLineEl=Object(a.ce)("div",{className:"stories_time_line"});var t=this.data.author.id;return this.data.items.map((function(i,o){var r=Object(a.ce)("div",{className:"stories_time_line_item"});Object(E.addEvent)(r,"click",(function(){e.layer._sendNavigationStatEvents("go_to_story_click"),e.changeStory(o)}));var s=Object(a.ce)("div",{className:"stories_time_line_item_cont"});s.appendChild(Object(a.ce)("div",{className:"stories_time_line_item_cont_active"})),r.appendChild(s),i.isOneTime&&window.vk.id!==t&&(r.appendChild(Object(a.ce)("div",{className:"stories_time_line_item_wick"})),Object(a.addClass)(r,"stories_time_line_item_is_one_time")),e.timeLineEl.appendChild(r)})),this.timeLineEl},e.prototype.isPaused=function(){return!this.story||this.story.isPaused()},e.prototype.isLoaded=function(){return!this.story||this.story.isLoaded()},e.prototype._onMouseDownHandle=function(e){this.pressedStory=e,this.isActive&&(this.isLocked()||(Object(a.hasClass)(e,"stories_item_cont")||Object(a.hasClass)(e,"stories_item_back")||Object(a.hasClass)(e,"StoryStickers__disableArea"))&&!this.downTs&&(this.downTs=Object(c.vkNow)(),this.longTapTimer=setTimeout(this._longTapHandle.bind(this),R.LONG_PRESS_DELAY_MS)))},e.prototype._onMouseUpHandle=function(e){clearTimeout(this.longTapTimer);var t=this.downTs;if(delete this.downTs,e===this.pressedStory){this.pressedStory=null;var i=!(Object(c.vkNow)()-t<R.LONG_PRESS_DELAY_MS&&!this.isSendFormActive&&!Object(a.hasClass)(this.wrapEl,"autoplay_failed"));if(this.isActive&&(Object(a.hasClass)(e,"stories_item_back")||Object(a.hasClass)(e,"StoryStickers__disableArea--left"))&&!i&&!this.isTooltipOpened())return this.prevStory();if(Object(a.hasClass)(e,"stories_item_cont")||Object(a.hasClass)(e,"stories_item_back")||Object(a.hasClass)(e,"StoryStickers__disableArea"))if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),Object(a.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this._hideTooltip();else{if(!this.isActive){this.id>=this.layer.activeStory.id&&this._markSeenCurrentStory(!0);var o=this.layer.storiesBlocks;return o.indexOf(this.layer.getBlockKey(this))>o.indexOf(this.layer.blockKey)?this.layer._sendNavigationStatEvents("go_to_next_author"):this.layer._sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}i?this.isPaused()&&this.playStory(!1,!!t):this._onPlayEnd()}}},e.prototype._markSeenIfNeeded=function(e){this.isActiveStoryOneTime()&&this._markSeenCurrentStory(e)},e.prototype._markSeenCurrentStory=function(e){void 0===e&&(e=!1),this.opts.onSeen(this.layer.activeStory,e)},e.prototype._longTapHandle=function(){this.isActiveStoryOneTime()||(this.story&&this.story.pause(),Object(a.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer._sendNavigationStatEvents("pause_long_tap"))},e.prototype.isLocked=function(){return!!(this._getSendText()||!this.isActive||this.isSendFormActive||this.isModalShown||this.isFeedbackTooltipShow||document.hidden||this._isActionsShown()||Object(a.isVisible)(this.inlineLoader)||Object(a.hasClass)(this.wrapEl,"hiding_reply")||Object(St.curBox)()&&"stories"!==Object(St.curBox)().wkRaw||this.story&&this.story.isPausedByMetaScroll)},e.prototype.isSpaceLongTabAvailable=function(){return!this.story||!this.story.isPausedByMetaScroll},e.prototype.isGroupedStory=function(){return this.data.is_groups},e.prototype.autoResumeStory=function(e){void 0===e&&(e=!1),this.audioPlaying||this.story&&this.story.isNarrativeMetaStory||this.isTooltipOpened()||this.playStory(!1,e)},e.prototype.playStory=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLocked()||(Object(a.removeClass)(this.wrapEl,"paused"),Object(a.hide)(Object(a.ge)("box_layer_bg")),Object(a.hide)(Object(a.ge)("box_layer_bg").nextSibling),this.story&&!e||this._initStory(),this.story&&this.story.play(),t&&this.layer._sendNavigationStatEvents("resume_release"),delete this.downTs)},e.prototype.pauseStory=function(e){this.story&&(this.isPaused()||(e&&Object(a.addClass)(this.wrapEl,"paused"),this.story.pause()))},e.prototype.changeStory=function(e){if(this.index!==e&&!this.isSendFormActive){this._destroyStory(),this.index=e,this._hideTooltip();var t=this.getCurStoryData();t.narrative&&t.narrative.is_cover?this._setPreview(!1,this.playStory.bind(this)):(this._setPreview(),this.playStory())}},e.prototype.getWrap=function(){return this.wrapEl},e.prototype.stop=function(){this._destroyFeedBackTT(),this.isActive=!1,this._destroyStory(),this._stopLoader(),Object(a.val)(Object(a.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),Object(a.removeClass)(this.wrapEl,"autoplay_failed")},e.prototype.getCurStoryData=function(){var e=this.data.items[this.index];return e||{}},e.prototype.isActiveLive=function(){return"live"===this.getCurStoryData().type},e.prototype.isLiveEnded=function(){return!!this.story&&(this.isActiveLive()&&this.story.liveEnded)},e.prototype._initStory=function(){var e=this,t=this.getCurStoryData(),i=t.type,r=t.noSound;this.story&&this._destroyStory(),_t(this),Object.assign(t,{authorId:this.getOwnerId()});var n={onLoadingStart:this._onLoadingStart.bind(this),onLoadingEnd:this._onLoadingEnd.bind(this),onPlay:this._onPlay.bind(this),onPause:this._onPause.bind(this),onError:this._showError.bind(this),onLongLoading:this._showLoader.bind(this),onAutoPlayFail:this._onAutoPlayFail.bind(this)};if("live"===i)this.story=new nt(t,n,this.wrapEl);else{"video"===i?(this.story=new ct(t,n),r&&this.opts.restoreAudioPlay(),Object(a.addClass)(this.wrapEl,"video")):(this.story=new dt(t,n),this.opts.restoreAudioPlay(),Object(a.removeClass)(this.wrapEl,"video"));var c=this.story.getDate();t.isPromo?c=t.promoCaption:t.isAds&&(c=Object(ge.getLang)("stories_is_ad")),Object(a.val)(this.descEl,c),this.fillTimeLine()}"live"!==i&&"video"!==i||y()>0&&this.opts.onVideoPlay();this.opts.onStartStory(),Object(a.toggleClass)(this.wrapEl,"stories_can_comment",!0===t.can_comment),t.reply_to&&!this.hasSticker(R.StickerTypes.storyReply)&&this.replyToWrap.appendChild(this._renderReplyTo()),this.story.isNarrativeMetaStory=t.isNarrativeMetaStory,this.story.isGroupsMetaStory=t.is_groups_meta_story,this.story.isAppsMetaStory=t.is_apps_meta_story,!this.data.author.can_follow||this.data.is_promo||this.isActiveLive()||this.authorButtons.appendChild(this._renderFollowButton()),this.data.author.id<0&&this.data.author.showPin&&!this.story.isGroupsMetaStory&&(this.pinButton=this._createPinButton(this.data.author.isOwnerPinned),this.authorButtons.appendChild(this.pinButton)),this._destroyFeedBackTT(),this.story.isNarrativeMetaStory||this.story.isGroupsMetaStory||this.story.isAppsMetaStory||(this.updateBottom(),this.contWrap.appendChild(this.story.render())),t.clickable_stickers&&(this.stickerLayers=s.render(o.createElement(ee,{story:this.story,storyData:t,author:this.data.author,showMessage:this._showMessage.bind(this),playStory:this.playStory.bind(this),pauseStory:this.pauseStory.bind(this),hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer),markAppNotificationsSeen:this.markAppNotificationsSeen,list:this.layer.list,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)),this.story.data&&this.story.data.narrative&&this.story.data.narrative.is_cover&&(this.contWrap.appendChild(this.story.renderNarrativeCover()),Object(E.addEvent)(Object(a.geByClass1)("stories_narrative_cover",this.contWrap),"click",(function(t){e._showTooltip(t,e._createNarrativeTooltipLink())}))),this.story.isNarrativeMetaStory&&!this.story.failed&&(Object(a.re)(Object(a.geByClass1)("stories_photo",this.contWrap)),Object(a.re)(Object(a.geByClass1)("stories_video",this.contWrap)),Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),this.contWrap.appendChild(this.story.renderNarrativeMetaStory()),this.story._onCanPlay()),this.story.isGroupsMetaStory&&!this.modalSettingsWrapperEl&&(Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_groups"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild(Object(a.ce)("div",{className:"stories_group_btn stories_group_btn_settings",onclick:function(){e.layer._sendNavigationStatEvents("set_group_view"),e.pauseStory(),e.getStoriesSettings((function(t){e.showSettingsModal(t)}))}})),this.authorButtons.appendChild(Object(a.ce)("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:Object(ge.getLang)("stories_groups_grid_title")})),Object(a.re)(Object(a.geByClass1)("stories_photo",this.contWrap)),Object(a.re)(Object(a.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderGroupsMetaStory()),this.modalSettingsWrapperEl=Object(a.ce)("div",{className:"stories_meta_settings_wrapper"}),this.contWrap.appendChild(this.modalSettingsWrapperEl)),this.data.is_apps&&(this.story.isAppsMetaStory?(Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild(Object(a.ce)("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:Object(ge.getLang)("stories_groups_grid_title")})),Object(a.setStyle)(Object(a.geByClass1)("stories_preview",this.contWrap),{backgroundImage:""}),Object(a.re)(Object(a.geByClass1)("stories_photo",this.contWrap)),Object(a.re)(Object(a.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderAppsMetaStory())):(Object(a.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps")))},e.prototype.toggleCurrentOwnerPin=function(){var e=this;if(this.pinButton){var t=Object(a.hasClass)(this.pinButton,"stories_group_btn_unpin");Object(a.toggleClass)(this.pinButton,"stories_group_btn_unpin",!t),this.data.author.isOwnerPinned=!t,window.ajax.post("al_stories.php",{act:"toggle_pin",owner_id:this.getOwnerId(),need_pin:Number(!t),hash:this.getPinHash()},{onDone:function(){},onFail:function(){return e.data.author.isOwnerPinned=t,Object(a.toggleClass)(e.pinButton,"stories_group_btn_unpin",t),!0}})}},e.prototype.getStoriesSettings=function(e){var t=this,i=document.querySelector("#box_layer_wrap"),o=document.querySelector("#box_loader"),r=Object(a.isVisible)(i);Object(St.boxRefreshCoords)(o),Object(a.show)(o),r||Object(a.show)(i),window.ajax.post("al_stories.php",{act:"get_feed_settings",hash:this.getGetGroupsSettingsHash()},{onDone:function(t){e&&e(t)},onFail:function(e){return t._showMessage(e).catch((function(e){Object(it.logError)(e)})),!0},hideProgress:function(){Object(a.hide)(o),r||Object(a.hide)(i)}})},e.prototype.showSettingsModal=function(e){if(void 0===e&&(e={}),this.modalSettingsWrapperEl){var t=e.groups_info,i=e.put_groups_back;this.isModalShown=!0,s.render(o.createElement(et,{groups:t,putGroupsBack:i,onClose:this.hideSettingsModal.bind(this),sendNavigationStatEvents:this.layer._sendNavigationStatEvents.bind(this.layer),className:"stories_meta_settings",showMessage:this._showMessage.bind(this),hash:this.getSaveGroupsSettingsHash()}),this.modalSettingsWrapperEl)}},e.prototype.hideSettingsModal=function(){var e=this;this.modalSettingsWrapperEl&&(this.isModalShown=!1,s.unmountComponentAtNode(this.modalSettingsWrapperEl),setTimeout((function(){e.playStory()})))},e.prototype.hasSticker=function(e){var t=this.getCurStoryData();if(!t)return!1;var i=(t.clickable_stickers||{}).stickers;return!(!i||!Object(c.isArray)(i))&&i.some((function(t){return t.type===e}))},e.prototype.getSticker=function(e){var t=this.getCurStoryData();if(!t)return!1;var i=(t.clickable_stickers||{}).stickers;return!(!i||!Object(c.isArray)(i))&&i.find((function(t){return t.type===e}))},e.prototype._createNarrativeTooltipLink=function(){var e=this;if(this.story){var t=this.story.data;return Object(a.ce)("div",{className:"StoriesTooltip__link",innerHTML:Object(ge.getLang)("stories_narrative_show"),onclick:function(){e._hideTooltip(!0),Object(he.showNarrative)(t.narrative.owner_id+"_"+t.narrative.id,{isOpenNarrativeFromFeed:!0,source:"narrative_story"})}})}},e.prototype.isTooltipOpened=function(){return this.tooltip||this.stickerLayers&&this.stickerLayers.isShownTooltip()},e.prototype._showTooltip=function(e,t){if(this.isTooltipOpened())this._hideTooltip();else{this.tooltip=Object(a.ce)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltip.appendChild(t),this.layer.layerEl.appendChild(this.tooltip);var i=e.clientX,o=void 0===i?0:i,r=e.clientY,s=void 0===r?0:r;Object(a.setStyle)(this.tooltip,{top:s,left:o}),this.pauseStory()}},e.prototype._hideTooltip=function(e){void 0===e&&(e=!1),this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),this.tooltip&&(this.layer.layerEl.removeChild(this.tooltip),delete this.tooltip),e||this.playStory())},e.prototype.getReplies=function(){return this.story&&this.story.getReplies()},e.prototype.getViews=function(){return this.story&&this.story.getViews()},e.prototype.setReplies=function(e){return this.story&&this.story.setReplies(e)},e.prototype.setViews=function(e){return this.story&&this.story.setViews(e)},e.prototype.indexToUnread=function(e){void 0===e&&(e=!1);var t=this.data.items,i=0;for(var o in t)if(t[o].unread&&!this.layer._hasContext("all")){i=Number(o);break}if(e)return i;this.index=i,this._setPreview()},e.prototype.indexToStoryById=function(e){var t=this.data.items,i=-1;for(var o in t)if(t[o].raw_id===e){i=Number(o);break}this.layer._hasContext("all")&&(i=0),i>-1?(this.index=i,this._setPreview()):this.indexToUnread()},e.prototype.fillTimeLine=function(){var e=this.timeLineEl;if(e)for(var t=0;t<e.children.length;t++){var i=Object(a.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this._currentTimeLineEl=i,this._currentTimeLineAdditionalEl=Object(a.geByClass1)("stories_time_line_item_wick",e.children[t]));var o=t<this.index?100:0;Object(a.setStyle)(i,"transform","translateX("+o+"%)")}},e.prototype._destroyStory=function(){if(this.story){this.updateBottom(!0),window.tooltips&&window.tooltips.hideAll(),this._hideTooltip(),this._resetErrors(),this._destroyFeedBackTT(),this._closeFeatureTooltip(!1),this.story.pause(),Object(a.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),Object(a.re)(Object(a.geByClass1)("MetaStory",this.contWrap)),Object(a.removeClass)("stories_item_cont_wrap_meta_story_groups",this.contWrap),Object(a.removeClass)(this.contWrap,"stories_narrative_cover_blur"),Object(a.re)(Object(a.geByClass1)("stories_narrative_cover",this.contWrap)),Object(E.removeEvent)(Object(a.geByClass1)("stories_narrative_cover",this.contWrap));var e=this.getCurStoryData();e&&e.clickable_stickers&&(s.unmountComponentAtNode(this.contStickers),delete this.stickerLayers),e&&e.is_groups_meta_story&&this.modalSettingsWrapperEl&&delete this.modalSettingsWrapperEl,cancelAnimationFrame(this.timeLineAnim);try{this.contWrap.removeChild(this.story.getContainer()),this.story.destroy()}catch(e){Object(it.logError)(e)}this._replyHideEnd(),Object(E.removeEvent)(this.pinButton),Object(E.removeEvent)(this.followBtn),Object(a.val)(this.authorButtons,""),Object(E.removeEvent)(this.answersEl),Object(E.removeEvent)(Object(a.geByClass1)("stories_reply_to",this.replyToWrap)),Object(a.val)(this.replyToWrap,""),this.hideInlineLoader(),delete this.story}},e.prototype._timeLineUpdate=function(){var e=this.story;if(e&&!e.isPaused()&&!this.isActiveLive()){var t=this.getStoryProgressPercent(),i=t/100;if(Object(a.setStyle)(this._currentTimeLineEl,"transform","translateX("+t+"%) translateZ(0)"),this._currentTimeLineAdditionalEl&&this._currentTimeLineEl){var o=this._currentTimeLineEl.clientWidth*i;Object(a.setStyle)(this._currentTimeLineAdditionalEl,"transform","translateX("+o+"px) translateZ(0)")}t<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}},e.prototype.getStoryProgressPercent=function(){if(!this.story)return 0;var e=this.story.getCurrentTime(),t=this.story.getDuration();return Math.max(0,Math.min(100,e/t*100))},e.prototype._onLoadingStart=function(){this._loadingStartTime=new Date},e.prototype._onLoadingEnd=function(){this._loadingStartTime&&(this.loadingTime=Date.now()-this._loadingStartTime,this.layer._sendViewerStartTime(this.getRawId(),this.loadingTime),this._loadingStartTime=0)},e.prototype._onPlay=function(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),Object(a.removeClass)(this.wrapEl,"animate_story"),Object(a.removeClass)(this.wrapEl,"autoplay_failed"),this.data.is_groups||this.isAppsMetaStoryActive()||(this.data.items[this.getIndex()].unread=!1),this._updateFeedStoryPreview(),_t(this)},e.prototype._onPause=function(){cancelAnimationFrame(this.timeLineAnim),_t(this)},e.prototype._onPlayEnd=function(e){void 0===e&&(e=!1),this._markSeenIfNeeded(),this.nextStory(e)},e.prototype.nextStory=function(e){if(void 0===e&&(e=!1),!this.isLocked()){var t=this.data.items;e||this.layer._sendNavigationStatEvents("go_to_next_story_tap");var i=this.index+1;i<t.length?(e&&this.layer._sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(i)):(this.opts.onStoriesEnd(e),this._destroyStory())}},e.prototype.prevStory=function(){if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),!this.isLocked()){this.layer._sendNavigationStatEvents("go_to_previous_story");var e=this.index-1;e>=0?this.changeStory(e):(this.opts.playPrevOwner(),this._destroyStory())}},e.prototype.getOffsetLeft=function(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2},e.prototype.getWidth=function(){return this.wrapEl.offsetWidth},e.prototype.removeStoryBox=function(){var e=this;this.pauseStory(),Object(K.showFastBox)({title:Object(ge.getLang)("global_warning"),onHide:function(){e.playStory()}},Object(ge.getLang)("stories_remove_warning"),Object(ge.getLang)("stories_remove_confirm"),this.removeStory.bind(this),Object(ge.getLang)("global_cancel"))},e.prototype.removeStory=function(e){var t=this;this.pauseStory();var i=this.getIndex(),o=this.getRawId(),r={act:"remove_story",story_raw:o,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash};Object(Et.isClaimContent)()&&(r.claim=window.nav.objLoc.claim),window.ajax.post("al_stories.php",r,{onDone:function(e){t.layer._sendNavigationStatEvents("delete"),window.cur.module===R.STORIES_MANAGE_MODULE&&window.GeStories.storyDidRemove(o,e),Object(St.curBox)().hide(),t._popStoryAndClearList(i)},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}})},e.prototype.removeNarrativeBox=function(){var e=this;this.pauseStory(),Object(K.showFastBox)({title:Object(ge.getLang)("global_warning"),onHide:function(){e.playStory()}},Object(ge.getLang)("stories_narrative_remove_warning"),Object(ge.getLang)("stories_remove_confirm"),this.removeNarrative.bind(this),Object(ge.getLang)("global_cancel"))},e.prototype.removeNarrative=function(e){var t=this;this.pauseStory();var i=this.getCurStoryData().narrative,o=i.raw_id;window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:o,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:function(){Object(St.curBox)().hide(),t._popCoverAndCleanNarrativeList(i)},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}})},e.prototype._popCoverAndCleanNarrativeList=function(e){if(e.is_cover)this._popStoryAndClearList(this.getIndex());else{this.opts.removeList(),this._remove(!1,function(){window.cur.storyLayer.activeStory._popStoryAndClearList(window.cur.storyLayer.activeStory.getIndex())}.bind(this))}},e.prototype._sendNarrativeBookmarkButtonDidPress=function(){var e=this,t=this.getCurStoryData().narrative;window.ajax.post("al_bookmarks.php",{act:"bookmark",owner_id:t.owner_id,object_id:t.id,type:"narrative",state:t.is_bookmarked?1:0,hash:t.bookmark_hash,ref:window.cur.module},{onDone:function(i){Object(St.showDoneBox)(i||Object(ge.getLang)("stories_narrative_bookmark_deleted"),{className:"stories_done_msg"}),t.is_bookmarked=!t.is_bookmarked,e.updateBottom()}})},e.prototype._sendNarrativeEditButtonDidPress=function(){var e=this.getCurStoryData().narrative;window.open("https://"+location.hostname+this.data.author.href+"?act=narrative_edit&nid="+e.id)},e.prototype._popStoryAndClearList=function(e){this._removeStoryFromMemoryByIndex(e),0===this.data.items.length&&P(this.getOwnerId())},e.prototype._removeStoryFromMemoryByIndex=function(e,t){void 0===t&&(t=!1),this.data.items.splice(e,1);var i=this.data.items.length;i?(this._initTimeLine(),i>e?this.isActive&&this.playStory(!0):this.isActive&&this.nextStory()):this._remove(t)},e.prototype._remove=function(e,t){this.opts.onStoryRemoved(e,t)},e.prototype.shareBox=function(){var e=this;if(this.story){var t,i=this.getCurStoryData().narrative;t=i?"narrative"+i.raw_id:"story"+this.story.getId(),this.pauseStory(),Object(K.showBox)("like.php",{act:"publish_box",object:t,from:"wkview"},{onDone:function(){e.autoResumeStory()},params:{onHide:function(){e.autoResumeStory()}}})}},e.prototype.toggleLikeStory=function(){var e=this;if(this.story){var t=this.story.data,i=t.isLiked,o=t.likeHash,r=t.accessKey,s=this.getRawId(),n={act:i?"delete_like":"like",hash:o,story_raw_id:s};i||Object.assign(n,{access_key:r}),this.story.data.isLiked=!i,this.updateBottom(),window.ajax.post("al_stories.php",n,{onDone:function(){},onFail:function(){return e.data.isLiked=i,e.updateBottom(),!0}})}},e.prototype._onAnswerSend=function(e,t,i,o){var r=this;void 0===e&&(e=function(){}),void 0===t&&(t=[]),void 0===i&&(i={}),void 0===o&&(o={});var s=this._getSendText();if((s||t.length)&&this.story)if(this.isActiveLive())this.story.sendMessage(s,e);else{var n=this.story.data.narrative;n?t.push(["narrative",n.raw_id]):t.push(["story",this.story.getId()]),window.ajax.post("al_im.php",Object.assign({act:"a_send",msg:s,hash:this.data.send_hash,media:Object(kt.convertAttachesToPhpMedia)(t),entrypoint:"stories_comment",to:this.getOwnerId()},i),{onDone:function(){r._onAnswerSent(e,i,o)},onFail:function(e){return r._showMessage(e).catch((function(e){Object(it.logError)(e)})),!0},showProgress:function(){Object(a.val)(r.sendFormButton,r._getLoaderHtml()),Object(a.addClass)(r.sendFormButton,"sending")},hideProgress:function(){Object(a.val)(r.sendFormButton,""),Object(a.removeClass)(r.sendFormButton,"sending")}})}},e.prototype._onAnswerSent=function(e,t,i){var o=this;if(void 0===e&&(e=function(){}),void 0===t&&(t={}),void 0===i&&(i={}),!this.isActiveLive()){this._showMessage(Object(ge.getLang)("stories_answer_sent")).then((function(){o.playStory()})).catch((function(e){Object(it.logError)(e)}));var r=t.sticker_referrer||"",s={},n="";"story_keyboard"===r?n="sticker_keyboard_send":r.startsWith("story_suggestion_")?n="sticker_suggestion_send":"story_reaction"===r?(n="sticker_reaction_send",s.reaction_name=i.reactionName):n="comment_send",this.layer._sendNavigationStatEvents(n,!0,s)}Object(a.val)(Object(a.geByClass1)("stories_send_form_text",this.wrapEl),""),this._blurSendForm(),this.pauseStory(),e&&e()},e.prototype._onSendFormFocus=function(){var e=this;this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this._hideTooltip(!0),this.hideFeedbackTooltip(),Object(k.cancelStackPush)("stories_form_focus",(function(){bt.Emoji.shown||(e._resetFendForm(),e._blurSendForm())}))},e.prototype._toggleSendFormOverlay=function(e){void 0===e&&(e=!1),Object(a.toggleClass)(this.storySendFormOverlay,"stories_bottom_overlay_available",this.isSendFormActive=e)},e.prototype._blurSendForm=function(){var e=Object(a.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()},e.prototype._getSendText=function(){var e=bt.Emoji.editableVal(Object(a.geByClass1)("stories_send_form_text",this.wrapEl));return Object(c.trim)(e)},e.prototype._onSendFormBlur=function(){var e=this._getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this._resetFendForm()},e.prototype._unlockSendForm=function(){this.isSendFormActive&&(this.isSendFormActive=!1)},e.prototype._resetFendForm=function(){this._unlockSendForm(),this.playStory(),Object(a.val)(Object(a.geByClass1)("stories_send_form_text",this.wrapEl),"")},e.prototype._emojiOnKeyAction=function(){this._getSendText()?Object(a.addClass)(this.sendFormButton,"active"):Object(a.removeClass)(this.sendFormButton,"active")},e.prototype._getLoaderHtml=function(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'},e.prototype.preloadNextStory=function(e){if(void 0===e&&(e=this.index+1),!this.preloadedStories[e]){var t=this.data.items[e];if(t){this.preloadedStories[e]=!0;var i=t[t.type+"_url"];i&&("video"===t.type?g(i).catch((function(e){return Object(it.logError)(e)})):v(i).catch((function(e){return Object(it.logError)(e)})))}}},e.prototype._addToBlacklist=function(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),Object(K.showFastBox)({title:Object(ge.getLang)("stories_add_blacklist_title"),onHide:function(){window.cur.storyLayer&&window.cur.storyLayer.playStory()}},this.getOwnerId()<0?Object(ge.getLang)("stories_add_blacklist_message_group"):Object(ge.getLang)("stories_add_blacklist_message"),Object(ge.getLang)("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),Object(ge.getLang)("global_cancel"))},e.prototype._doAddToBlacklist=function(e){var t=this;window.ajax.post("al_stories.php",{act:"blacklist_add",owner_id:this.getOwnerId(),hash:this.data.blacklist_hash,source_story:this.getRawId()},{onDone:function(){t.data.can_blacklist=!1,t.layer._sendNavigationStatEvents("hide_from_stories"),Object(St.curBox)().hide(),t.opts.removeList(),t._remove()},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}})},e.prototype._resetErrors=function(){var e=Object(a.geByClass1)("stories_error_wrap",this.contWrap);e&&(Object(E.removeEvent)(Object(a.geByClass1)("stories_error_button",e)),Object(a.re)(e)),Object(a.removeClass)(this.wrapEl,"failed"),Object(a.removeClass)(this.wrapEl,"fatal_error")},e.prototype._showError=function(e){var t=this;if(this.contWrap){var i,o,r=e;switch(e){case"load":i=Object(ge.getLang)("stories_error_cant_load"),o=Object(a.ce)("div",{className:"stories_error_button",innerHTML:Object(ge.getLang)("stories_try_again")}),Object(E.addEvent)(o,"click",(function(){t._destroyStory(),t.playStory()}));break;case"expired":i=Object(ge.getLang)("stories_error_expired");break;case"deleted":i=Object(ge.getLang)("stories_error_deleted");break;case"private":i=Object(ge.getLang)("stories_error_private");break;case"deleted-narrative":i=Object(ge.getLang)("stories_error_deleted_narrative");break;case"private-narrative":i=Object(ge.getLang)("stories_error_private_narrative");break;case"isOneTimeSeen":i=Object(ge.getLang)("stories_error_one_time_seen");break;default:i=Object(ge.getLang)("global_unknown_error")}this._resetErrors(),this._stopLoader();var s=Object(a.ce)("div",{className:"stories_error_wrap"}),n=Object(a.ce)("div",{className:"stories_error"}),l=Object(a.ce)("div",{className:"stories_error_cont"});n.appendChild(l),l.appendChild(Object(a.ce)("div",{className:"stories_error_icon "+r})),l.appendChild(Object(a.ce)("div",{className:"stories_error_caption",innerHTML:i})),o&&l.appendChild(o),s.appendChild(n),this.contWrap.appendChild(s),Object(a.addClass)(this.wrapEl,"failed"),Object(c.inArray)(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&Object(a.addClass)(this.wrapEl,"fatal_error")}},e.prototype._stopLoader=function(){var e=this;setTimeout((function(){Object(a.re)(Object(a.geByClass1)("stories_loader",e.contWrap))}),0)},e.prototype._showLoader=function(){if(this._stopLoader(),this.isActive&&(!this.isLoaded()||this.isPaused())&&this.contWrap){var e=Object(a.ce)("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}},e.prototype._onFollowBtnClick=function(){var e,t,i=this;(this.pauseStory(),this.followBtnLock)||(this.followBtnLock=!0,this.data.author.id>0?(t="al_friends",e=this.data.author.can_follow?"add":"remove"):(t="al_groups",e=this.data.author.can_follow?"a_enter":"a_leave"),window.ajax.post(t+".php",{act:e,mid:this.getOwnerId(),gid:-this.getOwnerId(),hash:this.data.author.hash,from:"stories"},{onDone:function(){i.data.author.can_follow&&i._sendStatEvent("follow"),i.data.author.can_follow=!i.data.author.can_follow,Object(a.toggleClass)(i.followBtn,"followed",!i.data.author.can_follow),i._showMessage(Object(ge.getLang)(i.data.author.can_follow?"stories_unfollowed":"stories_followed")).then((function(){return i.playStory()})).catch((function(e){Object(it.logError)(e)})),window.tooltips&&window.tooltips.destroy(i.followBtn),Object(E.triggerEvent)(i.followBtn,"mouseover")},showProgress:function(){return i.showInlineLoader()},hideProgress:function(){i.hideInlineLoader(),i.followBtnLock=!1}}))},e.prototype._getDimensions=function(){var e=Object(a.getSize)(this.wrapEl),t=e[0],i=e[1],o=Object(a.getXY)(this.wrapEl),r=o[0];return{width:t,height:i,top:o[1]-Object(gt.scrollGetY)(),left:r-Object(gt.scrollGetX)()}},e.prototype.markAsActive=function(){this.isActive=!0,Object(a.addClass)(this.wrapEl,"animate_story")},e.prototype._renderReplyTo=function(){var e=this,t=this.getCurStoryData().reply_to,i=t.list,o=t.photo_url,r=t.name,s=t.is_deleted,n=t.is_private,c=t.is_expired,l=t.raw_id,d=Object(a.se)('<div class="stories_reply_to" style="background-image: url('+o+')">\n  <div class="stories_reply_to_error_msg"></div>\n  <div class="stories_reply_to_owner_name_wrap">\n    <div class="stories_reply_to_owner_name">'+r+"</div>\n  </div>\n</div>");Object(E.addEvent)(d,"click",(function(){e.layer._sendNavigationStatEvents("open_parent_story");var t=x();O.length>1&&t.getStoryRaw()===l?Object(k.cancelStackPop)():Object(he.showStory)(i,{fromEl:d,source:"reply_story"})}));var u="";return s?(Object(a.addClass)(d,"deleted"),u=Object(ge.getLang)("stories_deleted_story")):n?(Object(a.addClass)(d,"private"),u=Object(ge.getLang)("stories_private_story")):c&&(Object(a.addClass)(d,"expired"),u=Object(ge.getLang)("stories_expired_story")),u&&(Object(a.val)(Object(a.geByClass1)("stories_reply_to_error_msg",d),u),Object(a.re)(Object(a.geByClass1)("stories_reply_to_owner_name_wrap",d))),d},e.prototype.sendMask=function(){var e=this;if(this.layer._sendNavigationStatEvents("click_to_mask"),!this._maskSending){this._maskSending=!0,this.pauseStory();var t=this.getCurStoryData();window.ajax.post("al_stories.php",{act:"send_mask",mask_id:t.mask_id,hash:this.data.send_mask_hash},{onDone:function(t,i,o,r){"cant_send"===t?Object(K.showFastBox)({title:i,width:460,onHide:function(){e.playStory()}},o,r):e._showMessage(Object(ge.getLang)("stories_mask_sent")).then((function(){return e.playStory()})).catch((function(e){Object(it.logError)(e)}))},showProgress:function(){return e.showInlineLoader()},hideProgress:function(){e._maskSending=!1,e.hideInlineLoader()}})}},e.prototype._destroyFeedBackTT=function(){delete this.feedback,this.hideFeedbackTooltip()},e.prototype.hideFeedbackTooltip=function(){this.isFeedbackTooltipShow&&(this.isFeedbackTooltipShow=!1,this.autoResumeStory(),this.updateBottom(),Object(k.cancelStackPop)())},e.prototype.showFeedbackTooltip=function(){var e=this;this.isFeedbackTooltipShow||(this._hideTooltip(),this.pauseStory(),this.isFeedbackTooltipShow=!0,this.updateBottom(),this.layer._sendNavigationStatEvents("open_replies_list"),Object(k.cancelStackPush)("stories_feedback_tt",(function(){e.hideFeedbackTooltip()})))},e.prototype._onModalsShownChange=function(e){void 0===e&&(e=!1),this.isModalShown=e},e.prototype.showInlineLoader=function(){Object(a.show)(this.inlineLoader)},e.prototype.hideInlineLoader=function(){Object(a.hide)(this.inlineLoader)},e.prototype.volumeUpdate=function(){this.story&&this.story.volumeUpdate&&this.story.volumeUpdate()},e.prototype._onAutoPlayFail=function(){Object(a.addClass)(this.wrapEl,"autoplay_failed")},e.prototype._hideReply=function(){var e=this;Object(K.showFastBox)({title:Object(ge.getLang)("global_warning"),onHide:function(){e.autoResumeStory()}},Object(ge.getLang)("stories_hide_reply_warning"),Object(ge.getLang)("global_continue"),this._doHideReply.bind(this),Object(ge.getLang)("global_cancel"))},e.prototype._doHideReply=function(){var e=this;this.pauseStory(),Object(a.addClass)(this.wrapEl,"hiding_reply"),Object(St.curBox)().hide();var t=this.getIndex(),i=this.data.author.gender,o=Object(a.se)('<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">'+Object(Ot.getProgressHtml)()+'</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">'+Object(ge.getLang)("stories_reply_hidden")+'</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">'+Object(ge.getLang)("stories_hide_reply_continue")+'</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">'+Object(ge.langSex)(i,Object(ge.getLang)("stories_hide_all_replies"))+'</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">'+Object(ge.getLang)("stories_reply_add_to_blacklist")+"</div>\n  </div>\n</div>");Object(E.addEvent)(Object(a.geByClass1)("_stories_reply_restore",o),"click",this._restoreReply.bind(this)),Object(E.addEvent)(Object(a.geByClass1)("_stories_reply_continue",o),"click",(function(){return e._replyHideEnd(t)})),Object(E.addEvent)(Object(a.geByClass1)("_stories_hide_replies",o),"click",this._hideAllReplies.bind(this)),Object(E.addEvent)(Object(a.geByClass1)("_stories_reply_ban",o),"click",this._ban.bind(this)),this.contWrap.appendChild(o),window.ajax.post("al_stories.php",{act:"hide_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:function(){e.opts.removeList(),window.cur.needUpdateFeedStories=!0,Object(a.removeClass)(o,"loading")},onFail:function(){return e._resetReplyHide(),e.playStory(),!0}})},e.prototype._restoreReply=function(e){var t=this;Object(E.cancelEvent)(e);var i=Object(a.geByClass1)("stories_hide_reply_wrap",this.contWrap);window.ajax.post("al_stories.php",{act:"restore_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:function(){t._resetReplyHide(),t.playStory()},showProgress:function(){return Object(a.addClass)(i,"loading")},hideProgress:function(){return Object(a.removeClass)(i,"loading")}})},e.prototype._resetReplyHide=function(){Object(a.re)(Object(a.geByClass1)("stories_hide_reply_wrap",this.contWrap)),Object(a.removeClass)(this.wrapEl,"hiding_reply")},e.prototype._hideAllReplies=function(){var e=this.data.author.first_name_gen;Object(K.showFastBox)({title:Object(ge.getLang)("global_warning")},Object(ge.getLang)("stories_delete_all_replies_confirm").replace("{name}",e),Object(ge.getLang)("global_continue"),this._doHideAllReplies.bind(this),Object(ge.getLang)("global_cancel"))},e.prototype._doHideAllReplies=function(e){var t=this;window.ajax.post("al_stories.php",{act:"hide_all_replies",owner_id:this.getOwnerId(),hash:this.data.reply_hide_hash},{onDone:function(){Object(St.curBox)().hide(),t.opts.removeList(),t.data.items=[];var e=Object(a.geByClass1)("_stories_hide_replies",t.contWrap);Object(a.val)(e,Object(ge.getLang)("stories_all_replies_hidden")),Object(a.addClass)(e,"disabled")},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}})},e.prototype._ban=function(){var e=this.data.author.first_name_gen;Object(K.showFastBox)({title:Object(ge.getLang)("global_warning")},Object(ge.getLang)("stories_ban_confirm").replace("{name}",e),Object(ge.getLang)("global_continue"),this._doBan.bind(this),Object(ge.getLang)("global_cancel"))},e.prototype._doBan=function(e){var t=this;window.ajax.post("al_stories.php",{act:"ban",owner_id:this.getOwnerId(),hash:this.data.stories_ban_hash},{onDone:function(){Object(St.curBox)().hide(),t.opts.removeList(),t.data.items=[];var e=Object(a.geByClass1)("_stories_reply_ban",t.contWrap);Object(a.val)(e,Object(ge.getLang)("stories_banned")),Object(a.addClass)(e,"disabled")},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}})},e.prototype._replyHideEnd=function(e){Object(a.geByClass1)("stories_hide_reply_wrap",this.contWrap)&&(this.data.items.length<=1&&P(this.getOwnerId()),this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!Object(c.isNumeric)(e)))},e.prototype._feedbackRemoveReplyFromDom=function(e){var t=Object(a.geByClass1)("stories_feedback_content",this.wrapEl);if(t){var i=t.querySelector("#feed_story_"+e);i&&Object(a.addClass)(i,"removed")}},e.prototype.onReplyDeleted=function(e){this._feedbackRemoveReplyFromDom(e)},e.prototype._updateFeedStoryPreview=function(){var e=Object(a.ge)("feed_story_"+this.layer.getBlockKey(this.data));if(e&&!e.classList.contains("stories_feed_reply_item")&&e.classList.contains("stories_feed_preview_item")){var t=this.indexToUnread(!0);if(t){var i=this.data.items[t];i&&i.small_preview&&Object(a.setStyle)(e,"background-image","url("+i.small_preview+")"),e.classList.remove("stories_feed_sticker_icon_show")}}},e.prototype._sendStatEvent=function(e){var t=this.getCurStoryData();window.ajax.post("al_stories.php",Object(c.extend)({act:"stat",source_story:this.getRawId()},t.stats[e]),{onDone:function(){}})},e.prototype._sendStatStickerEvent=function(e,t){var i=this.getCurStoryData().clickable_stickers;window.ajax.post("al_stories.php",Object.assign({act:"stickers_stat",story_raw_id:this.getRawId(),action:e,hash:i.hash},t),{onDone:function(){}})},e.prototype.report=function(){var e=this,t=this.getCurStoryData(),i="story";this.isActiveLive()?i="live":t.narrative&&(i="narrative");var o=Object(K.showBox)("al_stories.php",{act:"report_box",type:i},{onDone:function(){var e=Object(a.geByClass)("radiobtn","stories_report");window.radioBtns.stories_report={val:0,els:e}},params:{onClean:function(){delete window.radioBtns.stories_report,e.playStory()}}});o.removeButtons(),o.addButton(Object(ge.getLang)("box_send"),this._sendReportButtonDidPress.bind(this)),o.addButton(Object(ge.getLang)("global_cancel"),!1,"no")},e.prototype._sendReportButtonDidPress=function(e){var t,i,o=this,r=this.index,s=this.getCurStoryData(),n=s.narrative,a=s.report_hash,c="groups"===this.layer.list,l=!!n;l?(t=n.raw_id,i=n.report_hash):(t=this.getRawId(),i=a),window.ajax.post("al_stories.php",{act:"report",type:l?"narrative":"story",item_raw:t,reason:window.radioBtns.stories_report.val,hash:i},{onDone:function(){Object(St.curBox)().hide(),o.layer._sendNavigationStatEvents("claim"),c||l||o._popStoryAndClearList(r),Object(St.showDoneBox)(Object(ge.getLang)("stories_report_sent"),{className:"stories_done_msg"})},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}})},e.prototype.onLiveEnded=function(e){void 0===e&&(e=!1),this.isActiveLive()&&(this.data.items[this.index].can_share=!e,this.story&&this.story.onLiveEnded(),this.updateBottom())},e.prototype.updateLiveViewersCount=function(e){Object(a.val)(this.descEl,e)},e.prototype.isActiveStoryOneTime=function(){return this.story&&this.story.isOneTime()},e.prototype.isAppsMetaStoryActive=function(){return!(!this.story||!this.story.isAppsMetaStory)},e}(),jt=i("mMuO"),Tt="user_personal_card",Lt="group_personal_card",Bt=i("Tn+0");i("HEwt"),i("a1Th"),i("rE2o"),i("KKXr");function Mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return It(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return It(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function xt(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,i=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return i>8?"wi-fi":"LTE"}return""}var Pt=[];var Rt=[];var Nt=i("98sY"),Dt=function(){function e(e,t,i,o,r){this.queue=[],this.storiesIdsSeen={};try{window.Videoview&&window.Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,i,o),Object(a.addClass)(this.layerEl,"shown"),this._source=r.source,this._initViewerSource(),this._sendOpeningEvents(),r.isOpenNarrativeFromFeed&&(this.isOpenNarrativeFromFeed=r.isOpenNarrativeFromFeed)}return e.prototype._init=function(e,t,i,o){var r=e.split("&"),s=r[0],n=r[1],a=void 0===n?"":n,c=s.split("_"),l=c[0],d=c[1];this.storyRaw=s,this.storyOwner=l,this.storyId=+d,this.blockKey=""+l+a,this.list=t,this.storiesList=i,this.extra=this.parseExtra(o),this.extraRaw=o||"",this.initStories().catch((function(){Object(Nt.debugLog)("init stories error")}))},e.prototype.initStories=function(){var e=this;return new Promise((function(t){e.storiesBlocks=e.storiesList.map((function(t){return e.getBlockKey(t)}));var i=!1,o=e.storiesBlocks.indexOf(e.blockKey);if(o>-1){var r=e.storiesList[o];i=r.items[r.items.length-1].unread}if(e.extra)switch(e.extra.context){case"new":i=!0;break;case"all":i=!1}i&&"replies"===e.list.substr(0,7)&&(i=!1);for(var s=0;s<e.storiesList.length;s++){var n=(l=e.storiesList[s]).items[l.items.length-1];l.is_narrative&&!n.isNarrativeMetaStory&&l.items.push({type:"photo",raw_id:n.raw_id,narrative:n.narrative,isNarrativeMetaStory:!0})}if(i){var c=[];for(s=0;s<e.storiesList.length;s++){var l;((l=e.storiesList[s]).items[l.items.length-1].unread||0===s&&e._hasContext("new"))&&c.push(l)}c.length&&(e.storiesList=c,e.storiesBlocks=e.storiesList.map((function(t){return e.getBlockKey(t)})))}e.renderedStories={};var d=e._renderStories().activeStory;e.scrollToStory(d,!0),1===e.storiesList.length&&Object(a.addClass)(e.stories,"one_story"),e._startFirstStory(d,e.extra.story_id),Object(a.addClass)(e.stories,"inited"),t()}))},e.prototype.getBlockKey=function(e){return e.hasOwnProperty("data")&&(e=e.data),e.items&&e.items.length&&"live"===e.items[0].type?e.author.id+"live":e.narrative||e.is_narrative?(e.author?e.author.id:e.narrative.owner_id)+"narrative"+(e.items?e.items[0].narrative.id:e.narrative.id):this.list.includes("place")?e.author.id+"place":""+e.author.id},e.prototype._renderStories=function(){for(var e=this,t=[],i=0;i<this.storiesList.length;i++)this.storiesList[i]&&t.push(this.storiesList[i]);var o,r=this._getScreenStoriesCount(),s=this._getCurStoryPos(t.map((function(t){return e.getBlockKey(t)}))),n=Math.floor(r/2),a=t.slice(Math.max(0,s-n)).slice(0,r),c=a.map((function(t){return e.getBlockKey(t)}));for(var l in this.renderedStories)if(this.renderedStories.hasOwnProperty(l)){var d=this.renderedStories[l];c.includes(l)||(d.story.destroy(),delete this.renderedStories[l])}if(a.map((function(t,i){var r=e.getBlockKey(t);if(!e.renderedStories[r]){var s=e.storiesBlocks.indexOf(r),a=t.author.id,c=new Ct(t,{id:i,layer:e,onSelect:e._onSelectStory.bind(e),onStoriesEnd:e._onStoriesEnd.bind(e,s),onStoryRemoved:function(t,i){return e._onStoryRemoved(a,s,t,i)},playPrevOwner:e._playPrevOwner.bind(e,s),onPlayStory:e._onPlayStory.bind(e,s),onSeen:e._readStories.bind(e),onVideoPlay:e._onVideoPlay.bind(e),restoreAudioPlay:e._restoreAudioPlay.bind(e),onStartStory:e._onStartStory.bind(e),removeList:function(){return window.Stories.removeList(e.list)}});i<=n&&e.stories.children[i]?e.stories.insertBefore(c.render(),e.stories.children[i]):e.stories.appendChild(c.render()),e.renderedStories[r]={story:c,index:s},r===e.blockKey&&(o=c)}})),!o){var u=c[0];o=this.renderedStories[u].story}return{activeStory:o}},e.prototype._sendOpeningEvents=function(){if(this._source){var e;switch(this._source){case"narrative_story":e="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":e="narrative_open";break;case"narrative_recommendations":e="narrative_other"}if(e&&this._sendNavigationStatEvents(e,!1),"narrative_fave"===this._source){var t=this.activeStory.getCurStoryData();if(t&&t.narrative){var i=t.narrative,o=i.owner_id,r=i.id;Object(pt.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:o,item_id:r,time:window.getServerTime()})}}}},e.prototype._destroyStories=function(){for(var e in this.renderedStories){if(this.renderedStories.hasOwnProperty(e))this.renderedStories[e].story.destroy()}},e.prototype.destroy=function(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),Object(E.removeEvent)(this.volumeControl),Object(E.removeEvent)(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&document.body.removeChild(this.layerEl)}catch(e){}delete window.cur.storyLayer},e.prototype.getList=function(){return"story"+this.activeStory.getRawId()+"/"+this.list+(this.extraRaw?"/"+this.extraRaw:"")},e.prototype.getStoryRaw=function(){return!!this.activeStory&&this.activeStory.getRawId()},e.prototype.initDOM=function(){this.layerEl=Object(a.ce)("div",{className:"stories_layer"});var e=Object(a.ce)("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=Object(a.ce)("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild(Object(a.ce)("div",{className:"stories_layer_close"})),Object(E.addEvent)(this.layerEl,"click",this._onLayerClick.bind(this)),document.body.appendChild(this.layerEl)},e.prototype.show=function(){window.onBodyResize()},e.prototype.hide=function(e){Object(a.addClass)(this.layerEl,"stories_layer_hiding"),this.hideAllLayers||M(),this._source&&this._source.startsWith("narrative")&&this._sendNavigationStatEvents("narrative_close",!1),this.activeStory&&(this.activeStory.pauseStory(),this.activeStory._hideTooltip(),this.activeStory.isActiveLive()&&this._sendNavigationStatEvents("live_player_close",!1),this._readStoriesIfNeeded(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.list)),!0!==e&&this.activeStory?this.animateStory("minimize").then(this.doHide.bind(this)).catch((function(){Object(Nt.debugLog)("error animate story")})):this.doHide(e),Object(a.removeClass)(this.layerEl,"shown")},e.prototype.doHide=function(e){if(this.destroy(),e||(O.pop(),window.cur.storyLayer=O[O.length-1],window.cur.storyLayer?window.cur.storyLayer.resumeLayer():(I(!0),window.layerQueue.pop())),window.wkcur&&window.wkcur.shown&&window.WkView.restoreLayer({}),"group_stories"===this.list&&window.Stories.groupStoriesBlockUpdate(),this.list.startsWith("archive")&&!1!==this.hideAllLayers&&!e){if(!window._message_boxes[window.cur.storiesArchiveBoxGUID])return;window._message_boxes[window.cur.storiesArchiveBoxGUID].forceHide=!1,window._message_boxes[window.cur.storiesArchiveBoxGUID]._show(!0,!1,!0),window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition()}Object(ut.clear)()},e.prototype.back=function(){this.hideAllLayers=!1;var e=window.cancelStack[window.cancelStack.length-1];e&&"stories_form_focus"===e.name&&Object(k.cancelStackPop)(),this.hide(!1)},e.prototype._getScreenStoriesCount=function(){return 2*Math.floor(window.innerWidth/(.563*window.innerHeight))+1},e.prototype._getCurStoryPos=function(e){return(e||this.storiesBlocks).indexOf(this.blockKey)},e.prototype._startFirstStory=function(e,t){var i=this;this.activeStory=e,Object(a.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.storyRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout((function(){Object(a.addClass)(i.stories,"animated"),i.inited=!0,"open"===i.extra.replies&&i.activeStory.showFeedbackTooltip()}))},e.prototype._markReadRestStories=function(e){e.data.is_groups?this._onGroupsStoriesBlockViewEnd(e):e.data.is_apps?this._onAppsStoriesBlockViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.data.items.length),this._updateBadge(e))},e.prototype._onGroupsStoriesBlockViewEnd=function(e){var t=this,i=window.Stories._getList("groups");if(i){var o=Object(a.ge)("feed_story_"+this.getBlockKey(e)),r=i.map((function(e){return e.author.id}));this._readAllStoriesByOwners(r,(function(){i.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))})),e.data.items[0].unread=!1,t._updateMetaStoryItems(),t._resetGroupsBlockPreview(i[0],o),Object(a.removeClass)(o,"story_feed_new_item")}))}},e.prototype._onAppsStoriesBlockViewEnd=function(e){var t=this,i=window.Stories._getList("apps");if(i){var o=Object(a.ge)("feed_story_"+this.getBlockKey(e)),r=i.map((function(e){return e.author.id}));this._readAllStoriesByOwners(r,(function(){i.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))})),e.data.items[1].unread=!1,t._updateMetaStoryItems(),Object(a.removeClass)(o,"story_feed_new_item")}))}},e.prototype._readAllStoriesByOwners=function(e,t){void 0===t&&(t=function(){}),window.ajax.post("al_stories.php",{act:"mark_owners_seen",owners_ids:e.join(","),hash:this.storiesReadHash},{onDone:function(){t()}})},e.prototype._resetGroupsBlockPreview=function(e,t){var i=e.items[0];t.classList.contains("stories_feed_preview_item")&&i&&i.small_preview&&Object(a.setStyle)(t,"background-image","url("+i.small_preview+")")},e.prototype._onSelectStory=function(e){var t,i=this;this.activeStory&&(t=this.activeStory.getWrap(),this.activeStory.stop()),e.id-this.activeStory.id>0&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e),clearTimeout(this.timer),Object(a.addClass)(this.stories,"animated"),this.timer=setTimeout((function(){Object(a.removeClass)(t,"active"),Object(a.addClass)(e.getWrap(),"active"),i.scrollToStory(),i.timer=setTimeout((function(){i.activeStory&&e.id!==i.activeStory.id||!i.activeStory||(e.indexToUnread(),i._startActiveStory(),i._renderStories(),i.scrollToStory(e,!0))}),200)}))},e.prototype._startActiveStory=function(){var e=this.activeStory;e.markAsActive(),e.playStory(!0)},e.prototype._onStartStory=function(){var e=this.activeStory,t=this.list;if(e){var i=window.nav.objLoc;i.w="story"+e.getRawId(),t.match(/^-?(\d+)_(\d+)$/)||(i.w+="/"+t),t.match(/^narrative-?\d+_\d+/)&&(i.w="narrative"+this.activeStory.getCurStoryData().narrative.raw_id),window.nav.setLoc(window.nav.toStr(i))}},e.prototype.scrollToStory=function(e,t){var i=this,o=this._getScrollLeft(e);t?(Object(a.removeClass)(this.stories,"animated"),this._setScrollLeft(o)):this.inited&&Object(a.addClass)(this.stories,"animated"),setTimeout((function(){i._setScrollLeft(o)}))},e.prototype._setScrollLeft=function(e){Object(a.setStyle)(this.stories,"transform","translateX("+Math.round(e)+"px) translateZ(0)")},e.prototype._getScrollLeft=function(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()},e.prototype._onStoriesEnd=function(e,t){for(var i=-1,o=e+1;o<this.storiesList.length;o++){if(this.storiesList[o]){i=o;break}}var r=this._getStoryInstanceByIndex(i);if(i>-1)t&&this._sendNavigationStatEvents("go_to_next_story_auto_by_time"),this._onSelectStory(r);else{window.cur.storyLayer.activeStory.data.is_groups&&this._onGroupsStoriesBlockViewEnd(window.cur.storyLayer.activeStory),window.cur.storyLayer.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.list),window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._onAppsStoriesBlockViewEnd(window.cur.storyLayer.activeStory);var s=window.cancelStack[window.cancelStack.length-1];s&&"stories_form_focus"===s.name&&Object(k.cancelStackPop)(),Object(k.cancelStackPop)({byTimer:t})}},e.prototype._playPrevOwner=function(e){for(var t=-1,i=e-1;i>=0;i--){if(this.storiesList[i]){t=i;break}}t>-1?this._onSelectStory(this._getStoryInstanceByIndex(t)):Object(k.cancelStackPop)()},e.prototype._markReadStoriesInRange=function(e,t,i){for(var o=e.data.items,r=t;r<i;r++){var s=o[r];s.unread&&(s.unread=!1)}},e.prototype._markReadPrevStories=function(e){this._markReadStoriesInRange(e,0,e.index)},e.prototype._updateBadge=function(e){var t=Object(a.ge)("feed_story_"+this.getBlockKey(e)),i=Object(a.geByClass1)("_stories_feed_item_replies",t);if((Object(a.hasClass)(t,"story_feed_new_item")||""!==Object(a.val)(i))&&!e.data.is_groups&&!e.data.is_apps){var o=e.data.items||[],r=o[e.index]||{};(r.answers||{}).new_count=0,r.unread=!1;var s=!0,n=0;o.forEach((function(e){var t=e.answers||{};n+=t.new_count||0,e.unread&&(s=!1)})),n>0?Object(a.val)(i,n):(Object(a.val)(i,""),s&&(Object(a.removeClass)(t,"story_feed_new_item"),Object(a.removeClass)(t,"story_feed_new_item_promo")))}},e.prototype._onPlayStory=function(e){var t=this._getStoryInstanceByIndex(e);t&&(this.storiesReadHash=t.getReadHash(),t.data.is_groups||t.isAppsMetaStoryActive()||t.isActiveStoryOneTime()||(this._readStories(t),this._markReadPrevStories(t)),this._updateBadge(t));var i=this._getStoryInstanceByIndex(e+1);i&&i.preloadNextStory(i.getIndex())},e.prototype._getStoryInstanceByIndex=function(e){var t=this.storiesList[e];if(!t)return!1;var i=this.getBlockKey(t);return this.renderedStories[i].story},e.prototype._onStoryRemoved=function(e,t,i,o){for(var r=0;r<this.storiesList.length;r++)this.storiesList[r]&&this.storiesList[r].author.id===e&&(this.storiesList[r]=!1);!i&&this._onStoriesEnd(t),window.Stories.updateFeedStories(null,{cb:o})},e.prototype.onVisibilityChange=function(){"visible"===document.visibilityState?window.cur.storyLayer&&window.cur.storyLayer.playStory():window.cur.storyLayer&&window.cur.storyLayer.pauseStory()},e.prototype.onResize=function(){this.activeStory&&window.cur.storyLayer.scrollToStory(this.activeStory,!0)},e.prototype.pauseStory=function(e){this.activeStory&&this.activeStory.pauseStory(e)},e.prototype.playStory=function(e){void 0===e&&(e=!1),this.activeStory&&this.activeStory.autoResumeStory(e)},e.prototype._onLayerClick=function(e){var t=Object(a.hasClass)(e.target,"stories_layer_close");(Object(a.hasClass)(e.target,"stories_layer_cont")||t)&&(this.storiesBlocks.length-1!==this._getCurStoryPos()||t||(this._readStories(this.activeStory,!0),this._markReadRestStories(this.activeStory)),Object(k.cancelStackPop)({isCloseBtnClick:t}))},e.prototype._getCurrentStoriesBlockIdx=function(){var e=this.renderedStories[this.getBlockKey(this.activeStory)];return e&&e.index},e.prototype._checkKeyEvents=function(e){return!(Object(a.attr)(e.target,"contenteditable")||Object(c.inArray)(e.target.tagName,["INPUT","TEXTAREA"])||window.curBox())},e.prototype.onKeyDown=function(e){if(window.cur.storiesKeyDown)window.cur.storyLayer&&window.cur.storyLayer._checkKeyEvents(e)&&Object(E.cancelEvent)(e);else if(window.cur.storiesKeyDown=e.keyCode!==E.KEY.ESC,[E.KEY.PAGEDOWN,E.KEY.PAGEUP].includes(e.keyCode))Object(E.cancelEvent)(e);else if(window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case E.KEY.LEFT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.prevStory();break;case E.KEY.RIGHT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory();break;case E.KEY.SPACE:Object(E.cancelEvent)(e);var t=window.cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(window.cur.storiesKeyDownLong=setTimeout(t._longTapHandle.bind(t),R.LONG_PRESS_DELAY_MS))}window.cur.storiesKeyDownTs=Object(c.vkNow)()}},e.prototype.onKeyUp=function(e){window.cur.storiesKeyDown=!1,clearTimeout(window.cur.storiesKeyDownLong),window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)&&e.keyCode===E.KEY.SPACE&&(Object(E.cancelEvent)(e),Object(c.vkNow)()-window.cur.storiesKeyDownTs>R.LONG_PRESS_DELAY_MS?window.cur.storyLayer.playStory(!0):(this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory()))},e.prototype.nextStory=function(){this.activeStory&&this.activeStory.nextStory()},e.prototype.prevStory=function(){this.activeStory&&this.activeStory.prevStory()},e.prototype.changeStory=function(e){this.activeStory&&this.activeStory.changeStory(e)},e.prototype._readStoriesIfNeeded=function(e,t){void 0===t&&(t=!1),e.isActiveStoryOneTime()&&this._readStories(e,t)},e.prototype._readStories=function(e,t){var i=this;if(void 0===t&&(t=!1),e){var o=e.getRawId();if(o&&(!this.storiesIdsSeen[o]||t)&&e.isLoaded()){var r,s,n=e.getTrackCode(),a=0;e.isActiveStoryOneTime()&&(a=Math.max(Math.round(e.getStoryProgressPercent()),1)),n||(n=""),window.ajax.post("al_stories.php",{act:"read_stories",story_id:o,track_code:n,all:Number(t),progress:a,source:this._getSource(),navigation_stats:(s=Pt.map(e=>[e.ownerId,e.storyId,e.source,e.action].join(",")).join(";"),Pt=[],s),loading_stats:(r=Rt.map(e=>[e.ownerId,e.storyId,e.source,e.time].join(",")).join(";"),Rt=[],r),connection_type:xt(),hash:e.getReadHash()},{onDone:function(){}}),this.storiesIdsSeen[o]=!0,t&&e.getItems().forEach((function(e){return i.storiesIdsSeen[e.raw_id]=!0}))}}},e.prototype._getSource=function(){var e="list";return this._source?this._source:([Tt,Lt,R.STORIES_MANAGE_MODULE,Bt.MODULE].includes(window.cur.module)&&(e=window.cur.module),e)},e.prototype._sendNavigationStatEvents=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i={});var o=this.activeStory,r=this.getStoryRaw()||o.getCurStoryData().raw_id,s=this._getSource();t&&this._sendProductAnalyticEvents(e,i),this._updateLastStoryOpenAction(e),function(e){var t=e.storyRawId,i=e.source,o=e.action,r=Mt(t.split("_"),2);"reply"===i&&(i="replies_list");var s={ownerId:r[0],storyId:r[1],source:i,action:o};Pt.push(s)}({storyRawId:r,source:s,action:e})},e.prototype._sendProductAnalyticEvents=function(e,t){void 0===t&&(t={});var i=this.activeStory,o=(this.getStoryRaw()||i.getCurStoryData().raw_id).split("_"),r=o[0],s=o[1],n=i.getIndex(),a=i.getItemsLength()-n,c=i.story,l=this._getSource(),d=i.isGroupedStory(),u=0;if(e&&i&&c&&r&&s){d&&(s=0,r=0,u=0),"groups"===this.list&&(u=1);var p={event_type:e,story_owner_id:r,story_id:s,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),volume:100*y(),view_entry_point:l,stories_author_before:n,stories_author_after:a,nav_screen:window.cur.module,view_event_timeline_position:c.getCurrentTime(),story_type:d?"group_feed":"",is_grouped:u};Object.assign(p,t),Object(We.partConfigEnabled)("web_stats_transport_story_view")?Object(jt.saveStoryViewStats)(p):Object(pt.statlogsValueEvent)("story_product_analytics",p)}},e.prototype._updateLastStoryOpenAction=function(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}},e.prototype._initViewerSource=function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.section;break;default:this.viewerSource=e}},e.prototype._sendViewerStartTime=function(e,t){!function(e){var t=e.storyRawId,i=e.source,o=e.time,r=Mt(t.split("_"),2),s={ownerId:r[0],storyId:r[1],source:i,time:o};Rt.push(s)}({storyRawId:e,source:this.viewerSource,time:t})},e.prototype._onVideoPlay=function(){this.activeStory.getCurStoryData().noSound||(window.Notifier.lcSend("stories_video_start"),window.getAudioPlayer().isPlaying()&&(Object(H.getAudioPlayer)().pause(),this.needAudioReset=!0))},e.prototype._onVideoEnd=function(){this._restoreAudioPlay()},e.prototype._restoreAudioPlay=function(){window.Notifier.lcSend("stories_video_end"),this.needAudioReset&&(window.getAudioPlayer().play(),delete this.needAudioReset)},e.prototype._renderBackButton=function(){return this.backButton=Object(a.se)('<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">'+Object(ge.getLang)("global_back")+"</div>\n  </div>\n</div>"),Object(E.addEvent)(this.backButton,"click",(function(){Object(k.cancelStackPop)()})),this.backButton},e.prototype.showBackButton=function(){Object(a.show)(this.backButton),this.hideAllLayers=!0,Object(a.addClass)(this.layerEl,"with_back_button")},e.prototype.parseExtra=function(e){for(var t={},i=0,o=String(e).split(";");i<o.length;i++){var r=o[i].split(":"),s=r[0],n=r[1];s&&n&&(t[s]=n)}return t},e.prototype.getAnimateFromElem=function(){if(!this.hideAllLayers){var e=this.getBlockKey(this.activeStory);if(Object(a.hasClass)(this.animateFromEl,"stories_feed_reply_item")){var t=Object(a.domQuery)("#feed_story_"+e,Object(a.domPN)(this.animateFromEl))[0];if(t)return t}else if("feed"===window.cur.module&&!Object(a.isVisible)(this.backButton)){var i=Object(a.ge)("feed_story_"+e);if(i)return window.Stories.feedScrollToOwner(e),i}}return this.animateFromEl},e.prototype.animateStory=function(e,t){var i=this;return new Promise((function(o){if("expand"===e&&!t||"minimize"===e&&!i.animateFromEl)return Object(a.setStyle)("stories_layers_background","opacity",1),o();i.pauseStory(),Object(a.addClass)(i.layerEl,"animation"),Object(a.removeClass)(i.stories,"animated");var r="expand"===e?t:i.getAnimateFromElem();if(i.hideAllLayers&&"minimize"===e){var s=O[0];r=s.getAnimateFromElem(),function(){for(var e=O.length-2;e>=0;e--)O[e].doHide(!0);O.splice(0,O.length-1)}(),M()}Object(a.removeClass)(r,"stories_feed_item_ava_animate");var n=Object(a.getXY)(r),c=n[0],l=n[1],d=Object(a.getSize)(r),u=window.innerHeight,p=Math.min(540,Math.max(320,.563*u)),_=1.78*p,h=Math.max(0,(u-_)/2),m=Math.max(0,(window.innerWidth-p)/2);c=m-c+p/2-d[0]/2+Number(Object(gt.scrollGetX)()),l=h-l+_/2-d[1]/2+Number(Object(gt.scrollGetY)()),c=-c,l=-l;var v={};"expand"===e&&(v.transform="translate("+c+"px, "+l+"px) scale(0)",i.animateFromEl=t),Object(a.setStyle)(i.activeStory.wrapEl,v),"minimize"===e&&Object(a.setStyle)(r,"transform","scale(0)"),i.animationTimer=setTimeout((function(){Object(a.addClass)(i.stories,"animated"),Object(a.addClass)(r,"stories_feed_item_ava_animate"),i.animationTimer=setTimeout((function(){"expand"===e?(Object(a.setStyle)("stories_layers_background","opacity",1),Object(a.setStyle)(i.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):(Object(a.setStyle)(i.activeStory.wrapEl,"transform","translate("+c+"px, "+l+"px) scale(0.01)"),Object(a.setStyle)(r,"transform","scale(1)")),i.animationTimer=setTimeout((function(){o(),"expand"===e?(Object(a.setStyle)(i.activeStory.wrapEl,"transform",""),Object(a.removeClass)(i.layerEl,"animation"),Object(a.removeClass)(i.stories,"animated"),i.playStory(),O.length>1&&(O[O.length-2].setLayerVisibility(!1),O[O.length-1].showBackButton())):(Object(a.removeClass)(r,"stories_feed_item_ava_animate"),Object(a.setStyle)(r,"transform",""))}),330)}),30)}),30)}))},e.prototype.pauseLayer=function(){this.pauseStory(),Object(a.addClass)(this.layerEl,"paused")},e.prototype.resumeLayer=function(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&!this.activeStory.story.isNarrativeMetaStory&&(window.cur.storyLayer.activeStory.data.is_groups&&window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._updateMetaStoryItems(),this.activeStory.isFeedbackTooltipShow&&this.activeStory.updateBottom(),this.playStory(),Object(a.removeClass)(this.layerEl,"paused"))},e.prototype._updateMetaStoryItems=function(){if(window.cur.storyLayer&&window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.story&&(window.cur.storyLayer.activeStory.data.is_groups||window.cur.storyLayer.activeStory.isAppsMetaStoryActive())){var e="groups";window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&(e="apps");var t=window.cur.storyLayer.activeStory.story.elems.recItems.querySelectorAll(".GridStoryPreview:not(.GridStoryPreview--live)"),i=window.Stories._getList(e);if(!i)return this.hideAllLayers=!0,void this.hide();var o=0;t.forEach((function(e){var t=e.querySelector(".GridStoryPreview__author"),r=e.querySelector(".GridStoryPreview__inner");if(t&&r){var s=Number(t.getAttribute("data-author-id")),n=i.find((function(e){return e&&e.author.id===s&&"live"!==e.items[0].type}));if(!n)return++o,void e.remove();var c=n.items.findIndex((function(e){return e.unread}));-1===c&&(c=0,Object(a.removeClass)(t,"GridStoryPreview__author--unread"));var l=n.items[c],d=new Image;d.src=l.small_preview,d.onload=function(){Object(a.setStyle)(r,{backgroundImage:"url('"+l.small_preview+"')"})}}})),t.length-o<3&&(this.hideAllLayers=!0,this.hide())}},e.prototype.setLayerVisibility=function(e){Object(a.toggle)(this.layerEl,e)},e.prototype._renderVolumeControl=function(){return this.volumeControl=Object(a.se)('<div class="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),Object(E.addEvent)(Object(a.geByClass1)("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),Object(E.addEvent)(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=Object(a.ce)("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer},e.prototype._volumeControlOnMouseDown=function(e){var t=this;Object(a.addClass)(this.volumeControlContainer,"changing");var i=Object(a.geByClass1)("stories_volume_control_slide",this.volumeControl),o=Object(a.geByClass1)("stories_volume_control_slide_indicator",i),r=Object(a.getXY)(i)[0],s=Object(a.getSize)(i)[0],n=function(e){var i=Math.max(0,Math.min(e.pageX-r,s))/s*100;Object(a.setStyle)(o,"width",i+"%"),w(i/100),t.activeStory.volumeUpdate()},c=function(){Object(E.removeEvent)(window,"mousemove",n),Object(E.removeEvent)(window,"mouseup",c),t._updateVolumeButton(),Object(a.removeClass)(t.volumeControlContainer,"changing")};Object(E.addEvent)(window,"mousemove",n),Object(E.addEvent)(window,"mouseup",c),n(e)},e.prototype._updateVolumeButton=function(){var e=100*y();Object(a.toggleClass)(this.volumeControl,"low",e>0&&e<50),Object(a.toggleClass)(this.volumeControl,"high",e>=50);var t=Object(a.geByClass1)("stories_volume_control_slide_indicator",this.volumeControl);Object(a.setStyle)(t,"width",e+"%")},e.prototype._volumeControlOnClick=function(e){if(!Object(a.hasClass)(e.target,"stories_volume_control_slide_wrap")&&!Object(a.hasClass)(this.volumeControlContainer,"changing")){var t=y();w(t=t?0:1),this._updateVolumeButton(),this.activeStory.volumeUpdate()}},e.prototype.onReplyDeleted=function(e){this.activeStory&&this.activeStory.onReplyDeleted(e)},e.prototype._hasContext=function(e){return this.extra&&this.extra.context&&this.extra.context===e},e}(),At=i("btP0"),Ht=i("59zB"),Ft=i("RdBX"),Wt={},Kt={show:function(e,t){if(void 0===t&&(t={}),e.match(/story/)&&(e=this._parseList(e)),window.cur.storyLayer&&window.cur.storyLayer.list===e.split("/")[1])return!1;this.getList(e).then((function(e){var i=e.blockKey,o=e.list,r=e.items,s=e.extra;B(new Dt(i,o,r,s,t),t);var n=Object(St.curBox)();n&&(t.fromEl=null,"stories"===n.wkRaw?(n._hide(!1,!0,!0),n.forceHide=!0,window.cur.storiesArchiveBoxGUID=n.guid):n.hide())})).catch((function(e){Object(it.logError)(e),Object(K.showFastBox)(Object(ge.getLang)("global_error"),Object(ge.getLang)("global_unknown_error"))}))},_getUnreadStory:function(e,t){e=Object(c.intval)(e);for(var i=!1,o=0;o<t.length;o++)if(t[o].author.id===e){for(var r=t[o].items,s=0;s<r.length;s++)if(r[s].unread){i=r[s];break}i||(i=r[0]);break}return i},getList:function(e){return new Promise((function(t,i){var o=e.split("/"),r=o[0],s=o[1],n=o[2],a={blockKey:r,list:s,extra:n},l=Kt._getList(s);Object(c.isArray)(l)?(a.items=l,t(a)):window.ajax.post("al_stories.php",{act:"get_list",list:s,story_raw:r,extra:n},{loader:!0,onDone:function(e){window.cur["stories_list_"+s]=e.list,a.items=e.list,e.recommendations&&(window.cur["stories_list_"+s+"_recommendations"]=e.recommendations),t(a)},onFail:function(){return i(),!0}})}))},_getList:function(e){return window.cur["stories_list_"+e]},_setList:function(e,t){window.cur["stories_list_"+e]=t},removeList:function(e){delete window.cur["stories_list_"+e]},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i),i=t[1],o=t[2],r=t[4],s=t[6],n=i+"_"+o;return e.match(/from_feed\=1/)?r="feed":e.match(/profile\=1/)?r="profile":r||(r=n),n+"/"+r+"/"+s},initFeed:function(e){var t=this;void 0===e&&(e="stories_feed_items_container"),"string"==typeof e&&(e=Object(a.ge)(e));var i=Object(a.geByClass1)("stories_feed_items",e),o=Object(a.attr)(i,"id");Kt.updateFeedArrows(o);var r=function(){Object(E.addEvent)(e,"wheel",t.feedMouseWheel)},s=function(){Object(E.removeEvent)(e,"wheel",t.feedMouseWheel)};Object(E.addEvent)(e,"mouseenter",r),Object(E.addEvent)(e,"mouseleave",s),window.cur.destroy&&window.cur.destroy.push((function(){Object(E.removeEvent)(e,"wheel",this.feedMouseWheel),Object(E.removeEvent)(e,"mouseenter",r),Object(E.removeEvent)(e,"mouseleave",s)}))},feedNext:function(e){var t=Object(a.ge)("stories_feed_wrap");return e&&(t=Object(a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("next",null,t)},feedPrev:function(e){var t=Object(a.ge)("stories_feed_wrap");return e&&(t=Object(a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("prev",null,t)},feedPaging:function(e,t,i){i||(i=Object(a.ge)("stories_feed_wrap"));var o=Object(a.geByClass1)("stories_feed_items",i),r=Object(a.attr)(o,"id"),s=r+"_position",n=Wt[s]||0,l=Object(a.getSize)(i)[0];if(Object(c.isNumeric)(e))n+=e;else{var d=l-100;"next"===e?n+=d:n-=d}Wt[s]=Math.max(0,Math.min(n,o.scrollWidth-l)),t?Object(a.removeClass)(o,"animated"):Object(a.addClass)(o,"animated"),Object(a.setStyle)(o,"transform","translateX(-"+Wt[s]+"px)"),Kt.updateFeedArrows(r)},feedScrollToOwner:function(e){var t=Object(a.ge)("feed_story_"+e);if(t){var i=Object(a.domClosest)("stories_feed_items",t),o=i.offsetWidth,r=Object(a.attr)(i,"id")+"_position",s=t.offsetWidth,n=t.offsetLeft,c=Object(a.domClosest)("stories_feed_wrap",i);Wt[r]=n-o+o/2+s/2,Kt.feedPaging(0,!0,c)}},updateFeedStories:function(e,t,i){var o=this;void 0===i&&(i="stories_feed_items");var r=Object(a.ge)(i),s=Object(a.domClosest)("stories_feed_wrap",r);if(e=e||"news",r)if(Object(c.inArray)(e,["news","search"])){var n=function(e,r){t&&t.cb&&t.cb(),Object.keys(r).forEach((function(e){return o._setList(e,r[e])})),window.cur.storyLayer&&window.cur.storyLayer._updateMetaStoryItems();var n=Object(a.ge)(i);n&&(e?(Object(a.setStyle)(n,"transform","translateX(0px)"),Object(a.val)(n,e),n.children.length<6?Object(a.addClass)(s,"stories_feed_not_nav_buttons"):Object(a.removeClass)(s,"stories_feed_not_nav_buttons"),Wt[i+"_position"]=0,Kt.updateFeedArrows(i),Object(a.show)(s)):Object(a.hide)(s))};if(t&&t.stories){var l=t.section,d=t.q,u=t.stories,p=u.html,_=u.js,h=_.feed?_.feed:[];return"search"!==l||d&&h.length?void n(p,_):void Object(a.hide)(s)}window.ajax.post("al_stories.php",{act:"feed_stories"},{onDone:n})}else Object(a.hide)(s)},feedMouseWheel:function(e){var t=Object(a.domClosest)("stories_feed_wrap",e.target);if(!Object(a.hasClass)(t,"stories_feed_not_nav_buttons")){Object(E.cancelEvent)(e);var i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;Kt.feedPaging(i,!0,t)}},updateFeedArrows:function(e){void 0===e&&(e="stories_feed_items");var t=Object(a.ge)(e),i=e+"_position";if(t){Wt[i]||(Wt[i]=0);var o=Object(a.geByClass1)("stories_feed_wrap").offsetWidth,r=t.scrollWidth-o,s=Object(a.geByClass1)("stories_feed_arrow_left",Object(a.domPN)(t)),n=Object(a.geByClass1)("stories_feed_arrow_right",Object(a.domPN)(t));0===Wt[i]?Object(a.addClass)(s,"disabled"):Object(a.removeClass)(s,"disabled"),Wt[i]===r||r<=0?Object(a.addClass)(n,"disabled"):Object(a.removeClass)(n,"disabled")}},showBlackList:function(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),Object(K.showBox)("al_stories.php",{act:"black_list"},{onDone:function(){window.cur.storiesBlackListScroll=new Ht.default("stories_black_list_result")},params:{onHide:function(){window.cur.storyLayer&&window.cur.storyLayer.playStory()}}})},blackListItemClick:function(e,t){Object(E.cancelEvent)(t);var i=Object(c.intval)(Object(a.attr)(e,"data-id"));window.cur.storiesBlackListShown[i]?(delete window.cur.storiesBlackListShown[i],Object(a.removeClass)(e,"olist_item_wrap_on")):(window.cur.storiesBlackListShown[i]=1,Object(a.addClass)(e,"olist_item_wrap_on"))},saveBlackList:function(e){var t=Object.keys(window.cur.storiesBlackListShown);0!==t.length?window.ajax.post("al_stories.php",{act:"save_blacklist",hash:window.cur.storiesBlackList.hash,list:t.join(",")},{onDone:function(){Kt.updateFeedStories(),Object(St.curBox)().hide()},showProgress:function(){return Object(wt.lockButton)(e)},hideProgress:function(){return Object(wt.unlockButton)(e)}}):Object(St.curBox)().hide()},blacklistUpdateUsers:function(e){var t=e;if(e=Object(c.trim)(e).toLowerCase(),window.cur.storiesBlacklistLastQ!==e){window.cur.storiesBlacklistLastQ=e;var i=e?window.cur.storiesIndexer.search(e):window.cur.storiesBlackList.users,o=[];if(e)for(var r=0;r<e.length;r++)o.push(e.substr(r,1));var s=new RegExp(o.join(".*?"),"i"),n="";for(r=0;r<i.length;r++){var l=i[r],d=e?l.name.replace(s,(function(e){return"<em>"+e+"</em>"})):l.name;n+=window.cur.storiesBlackList.tpl.replace(/\{id\}/g,l.id).replace("{photo}",l.photo).replace("{name}",d).replace("{href}",l.href).replace("{class_name}",window.cur.storiesBlackListShown[l.id]?" olist_item_wrap_on":"")}n||(n='<div class="no_rows">'+Object(ge.getLang)("global_search_not_found").replace("{search}",Object(c.clean)(t))+"</div>"),Object(a.val)(Object(a.geByClass1)("olist","stories_black_list_result"),n)}},blackListInit:function(e){window.cur.storiesBlackListShown={},window.cur.storiesBlackList=e,Object(St.curBox)().setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),window.cur.storiesBlackListScroll&&window.cur.storiesBlackListScroll.destroy()}}).removeButtons(),window.cur.storiesBlackList.users.length?(window.cur.storiesBlacklistLastQ=!1,window.cur.storiesIndexer=new Ft.vkIndexer(window.cur.storiesBlackList.users,(function(e){return e.name}),(function(){Kt.blacklistUpdateUsers("")})),At.default.init("stories_blacklist"),At.default.focus("stories_blacklist"),Object(St.curBox)().addButton(Object(ge.getLang)("global_save"),this.saveBlackList).addButton(Object(ge.getLang)("global_cancel"),void 0,"no")):Object(St.curBox)().addButton(Object(ge.getLang)("global_close"))},preloadUrl:function(e){v(e).catch((function(e){Object(it.logError)(e)}))},groupStoriesBlockUpdate:function(){var e=Kt._getList("group_stories"),t=e&&e[0]&&e[0].items;if(t){for(var i=0,o=0;o<t.length;o++){t[o].unread&&i++}var r=Object(a.geByClass1)("stories_groups_block_stories_wrap"),s=Object(a.geByClass1)("stories_groups_block_stories_button",r);Object(a.toggleClass)(r,"has_unread",i>0),Object(a.toggleClass)(r,"has_stories",t.length>0),Object(a.toggleClass)(s,"has_stories",t.length>0);var n=Object(c.clone)(window.cur.storiesPreviews),l=n.splice(n.length-i,3);l.length<3&&(l=l.concat(n.slice(0,3-l.length))),l.reverse();var d="";for(o=l.length-1;o>=0;o--)d+=window.cur.storiesPreviewsRowHtml.replace("{url}",l[o]);Object(a.val)(Object(a.geByClass1)("stories_groups_block_stories_rows",r),d)}},isLiveShown:function(e){return!!(window.cur.storyLayer&&window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.isActiveLive())&&window.cur.storyLayer.activeStory.story.videoRaw===e},activeLiveEnded:function(e){window.cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount:function(e){var t=e?Object(ge.getLang)("stories_live_N_watching",e,!0):"";window.cur.storyLayer.activeStory.updateLiveViewersCount(t)}};window.Stories=Kt;try{window.stManager.done(window.jsc("web/stories.js"))}catch(e){}},vRp6:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return l}));i("HEwt"),i("a1Th"),i("Btvt"),i("rGqo"),i("rE2o"),i("ioFf");var o=i("q1tI"),r=(i("17x9"),i("UlUB")),s=i("PjZB"),n=i("pemR");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(o=(n=a.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==a.return||a.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}class l extends o.Component{constructor(e){super(e),this.checkLoad=Object(r.throttle)(e=>{var t=a(e,3),i=t[0],o=t[1],r=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(o-i-r<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var i=this.state,o=this.getChildrenData(e,t||this.getScrollData()),r=o.start,s=o.end,n=o.before,a=o.after;r===i.start&&s===i.end&&n===i.before&&a===i.after||this.setState(o)}getChildrenData(e,t){var i=a(t,3),o=i[0],r=i[1],s=i[2],n=this.useWindowScroll?window:this.container,c=n&&n.offsetHeight;if(!n||0===r||0===s)return{start:0,end:0,before:0,after:e.length};s=Math.max(s,c);var l=e.length,d=Math.max(Math.floor(o/this.props.itemHeight)-1,0),u=Math.min(Math.floor((o+2*s)/this.props.itemHeight+1),l);return{start:d,end:u,before:d,after:l-u}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return o.createElement("div",{className:Object(n.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&o.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&o.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||o.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},o.createElement(s.default,null))))}}l.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vzBJ:function(e,t,i){"use strict";i.r(t),i.d(t,"StickersAnimation",(function(){return o}));i("VRzm"),i("Btvt"),i("a1Th");var o=function(){var e,t,i,r=!1,s=!1,n={},a={},c={},l={};function d(e){var t=_(e),i=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var o=attr(e,"data-loop-count");o=parseInt(o),isNaN(o)&&(o=3),-1!==o&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function r(s){i++;var n=!0;o>=i&&(n=!1),n&&(p(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",r),t.stop())}))}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function p(e,t){l[u(e)]=t}function _(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var i=a[t];return i||!1}function h(e,t){var o=_(e);if(o)"function"==typeof t&&t(o);else{var r=attr(e,"data-uniq-id");if(!l[u(e)]){p(e,!0);var s=attr(e,"data-animation-path"),c=attr(e,"data-sticker-id"),d=!1;if(c&&(d=(n[c]||s)&&v(e)),d){var h={container:e,renderer:"svg",loop:!0,autoplay:!1,name:r,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation"}};n[c]?h.animationData=n[c]:h.path=s;var m=geByClass1("svg_sticker_animation",e);if(m&&re(m),o=i.loadAnimation(h),!n[c])return void o.addEventListener("data_ready",(function(){n[c]=o.animationData,a[r]=o,"function"==typeof t&&t(o)}))}"function"==typeof t&&(a[r]=o,"function"==typeof t&&t(o))}}}function m(){return t().then(e=>(i=e,e))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),i=geByClass1("sticker_animation",t);o.loadAndPlaySticker(i)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(`.msg_id_${e} .sticker_animation`);o.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var i="_msg"+e;t&&(i="msg_id_"+e);var r=geByClass1("sticker_animation",geByClass1(i));o.loadAndPlayStickerWithTimer(r,500)},loadAutoplayAnimationStickers:function(e){if(i){if(e){if(s)return;s=!0}if(!r){r=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){h(t,(function(){d(t)}))})),r=!1}}else m().then(()=>{o.loadAutoplayAnimationStickers(e)})},loadAndPlaySticker:function(e){e&&(i?requestAnimationFrame(()=>{h(e,(function(){d(e)}))}):m().then(()=>{o.loadAndPlaySticker(e)}))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!c[e]){t||(t=1e3);var i=ge(e);hasClass(i,"sticker_animation_disabled_timer")||(c[e]=setTimeout((function(){!i&&(i=ge(e),hasClass(i,"sticker_animation_disabled_timer"))||(o.loadAndPlaySticker(i),clearTimeout(c[e]),c[e]=!1)}),t))}},reloadStickers:function(){a={}},touchStartSticker:function(t){t.addEventListener("contextmenu",o.preventContextMenu,!1),e=setTimeout((function(){o.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function v(e){var t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;return t<window.innerHeight&&i>=0&&isVisible(e)}}(),r=i("Jph1");o.init({animatorLoader:()=>Promise.resolve(r.default)})},wx14:function(e,t,i){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}i.r(t),i.d(t,"default",(function(){return o}))},zLVn:function(e,t,i){"use strict";function o(e,t){if(null==e)return{};var i,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)i=s[o],t.indexOf(i)>=0||(r[i]=e[i]);return r}i.r(t),i.d(t,"default",(function(){return o}))}});