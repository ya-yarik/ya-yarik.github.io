!function(e){function t(t){for(var n,i,s=t[0],c=t[1],u=t[2],d=0,f=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&f.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);f.length;)f.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={"web/story_publisher":0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;a.push([260,"bundles/common","bundles/vendors","bundles/1c6a9b415901224f27daf60c6bc90be0"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t),r.d(t,"Provider",(function(){return y})),r.d(t,"connectAdvanced",(function(){return x})),r.d(t,"ReactReduxContext",(function(){return u})),r.d(t,"connect",(function(){return ne})),r.d(t,"batch",(function(){return de.unstable_batchedUpdates})),r.d(t,"useDispatch",(function(){return ie})),r.d(t,"useSelector",(function(){return ue})),r.d(t,"useStore",(function(){return ae})),r.d(t,"shallowEqual",(function(){return N}));var n=r("JX7q"),o=r("dI71"),a=r("q1tI"),i=r.n(a),s=r("17x9"),c=r.n(s),u=i.a.createContext(null);var l=function(e){e()},d={notify:function(){}};function f(){var e=l,t=[],r=[];return{clear:function(){r=null,t=null},notify:function(){var n=t=r;e((function(){for(var e=0;e<n.length;e++)n[e]()}))},get:function(){return r},subscribe:function(e){var n=!0;return r===t&&(r=t.slice()),r.push(e),function(){n&&null!==t&&(n=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}}var p=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=d,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=f())},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=d)},e}(),h=function(e){function t(t){var r;r=e.call(this,t)||this;var o=t.store;r.notifySubscribers=r.notifySubscribers.bind(Object(n.default)(r));var a=new p(o);return a.onStateChange=r.notifySubscribers,r.state={store:o,subscription:a},r.previousState=o.getState(),r}Object(o.default)(t,e);var r=t.prototype;return r.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},r.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},r.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new p(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},r.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},r.render=function(){var e=this.props.context||u;return i.a.createElement(e.Provider,{value:this.state},this.props.children)},t}(a.Component);h.propTypes={store:c.a.shape({subscribe:c.a.func.isRequired,dispatch:c.a.func.isRequired,getState:c.a.func.isRequired}),context:c.a.object,children:c.a.any};var y=h,m=r("wx14"),v=r("zLVn"),g=r("2mql"),_=r.n(g),b=r("QLaP"),E=r.n(b),w=r("TOwV"),S=[],O=[null,null];function T(e,t){var r=e[1];return[t.payload,r+1]}var P=function(){return[null,0]},C="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?a.useLayoutEffect:a.useEffect;function x(e,t){void 0===t&&(t={});var r=t,n=r.getDisplayName,o=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,s=r.methodName,c=void 0===s?"connectAdvanced":s,l=r.renderCountProp,d=void 0===l?void 0:l,f=r.shouldHandleStateChanges,h=void 0===f||f,y=r.storeKey,g=void 0===y?"store":y,b=r.withRef,x=void 0!==b&&b,k=r.forwardRef,L=void 0!==k&&k,N=r.context,R=void 0===N?u:N,D=Object(v.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);E()(void 0===d,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),E()(!x,"withRef is removed. To access the wrapped instance, use a ref on the connected component");E()("store"===g,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var I=R;return function(t){var r=t.displayName||t.name||"Component",n=o(r),s=Object(m.default)({},D,{getDisplayName:o,methodName:c,renderCountProp:d,shouldHandleStateChanges:h,storeKey:g,displayName:n,wrappedComponentName:r,WrappedComponent:t}),u=D.pure;var l=u?a.useMemo:function(e){return e()};function f(r){var o=Object(a.useMemo)((function(){var e=r.forwardedRef,t=Object(v.default)(r,["forwardedRef"]);return[r.context,e,t]}),[r]),c=o[0],u=o[1],d=o[2],f=Object(a.useMemo)((function(){return c&&c.Consumer&&Object(w.isContextConsumer)(i.a.createElement(c.Consumer,null))?c:I}),[c,I]),y=Object(a.useContext)(f),g=Boolean(r.store),_=Boolean(y)&&Boolean(y.store);E()(g||_,'Could not find "store" in the context of "'+n+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+n+" in connect options.");var b=r.store||y.store,x=Object(a.useMemo)((function(){return function(t){return e(t.dispatch,s)}(b)}),[b]),k=Object(a.useMemo)((function(){if(!h)return O;var e=new p(b,g?null:y.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[b,g,y]),L=k[0],N=k[1],R=Object(a.useMemo)((function(){return g?y:Object(m.default)({},y,{subscription:L})}),[g,y,L]),D=Object(a.useReducer)(T,S,P),j=D[0][0],A=D[1];if(j&&j.error)throw j.error;var M=Object(a.useRef)(),B=Object(a.useRef)(d),F=Object(a.useRef)(),U=Object(a.useRef)(!1),H=l((function(){return F.current&&d===B.current?F.current:x(b.getState(),d)}),[b,j,d]);C((function(){B.current=d,M.current=H,U.current=!1,F.current&&(F.current=null,N())})),C((function(){if(h){var e=!1,t=null,r=function(){if(!e){var r,n,o=b.getState();try{r=x(o,B.current)}catch(e){n=e,t=e}n||(t=null),r===M.current?U.current||N():(M.current=r,F.current=r,U.current=!0,A({type:"STORE_UPDATED",payload:{latestStoreState:o,error:n}}))}};L.onStateChange=r,L.trySubscribe(),r();return function(){if(e=!0,L.tryUnsubscribe(),t)throw t}}}),[b,L,x]);var Y=Object(a.useMemo)((function(){return i.a.createElement(t,Object(m.default)({},H,{ref:u}))}),[u,t,H]);return Object(a.useMemo)((function(){return h?i.a.createElement(f.Provider,{value:R},Y):Y}),[f,Y,R])}var y=u?i.a.memo(f):f;if(y.WrappedComponent=t,y.displayName=n,L){var b=i.a.forwardRef((function(e,t){return i.a.createElement(y,Object(m.default)({},e,{forwardedRef:t}))}));return b.displayName=n,b.WrappedComponent=t,_()(b,t)}return _()(y,t)}}var k=Object.prototype.hasOwnProperty;function L(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function N(e,t){if(L(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(!k.call(t,r[o])||!L(e[r[o]],t[r[o]]))return!1;return!0}var R=r("ANjH");function D(e){return function(t,r){var n=e(t,r);function o(){return n}return o.dependsOnOwnProps=!1,o}}function I(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function j(e,t){return function(t,r){r.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=I(e);var o=n(t,r);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=I(o),o=n(t,r)),o},n}}var A=[function(e){return"function"==typeof e?j(e):void 0},function(e){return e?void 0:D((function(e){return{dispatch:e}}))},function(e){return e&&"object"==typeof e?D((function(t){return Object(R.bindActionCreators)(e,t)})):void 0}];var M=[function(e){return"function"==typeof e?j(e):void 0},function(e){return e?void 0:D((function(){return{}}))}];function B(e,t,r){return Object(m.default)({},r,e,t)}var F=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var n,o=r.pure,a=r.areMergedPropsEqual,i=!1;return function(t,r,s){var c=e(t,r,s);return i?o&&a(c,n)||(n=c):(i=!0,n=c),n}}}(e):void 0},function(e){return e?void 0:function(){return B}}];function U(e,t,r,n){return function(o,a){return r(e(o,a),t(n,a),a)}}function H(e,t,r,n,o){var a,i,s,c,u,l=o.areStatesEqual,d=o.areOwnPropsEqual,f=o.areStatePropsEqual,p=!1;function h(o,p){var h,y,m=!d(p,i),v=!l(o,a);return a=o,i=p,m&&v?(s=e(a,i),t.dependsOnOwnProps&&(c=t(n,i)),u=r(s,c,i)):m?(e.dependsOnOwnProps&&(s=e(a,i)),t.dependsOnOwnProps&&(c=t(n,i)),u=r(s,c,i)):v?(h=e(a,i),y=!f(h,s),s=h,y&&(u=r(s,c,i)),u):u}return function(o,l){return p?h(o,l):(s=e(a=o,i=l),c=t(n,i),u=r(s,c,i),p=!0,u)}}function Y(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,o=t.initMergeProps,a=Object(v.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),i=r(e,a),s=n(e,a),c=o(e,a);return(a.pure?H:U)(i,s,c,e,a)}function W(e,t,r){for(var n=t.length-1;n>=0;n--){var o=t[n](e);if(o)return o}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+n.wrappedComponentName+".")}}function K(e,t){return e===t}var X,G,z,V,q,$,Z,J,Q,ee,te,re,ne=(z=(G=void 0===X?{}:X).connectHOC,V=void 0===z?x:z,q=G.mapStateToPropsFactories,$=void 0===q?M:q,Z=G.mapDispatchToPropsFactories,J=void 0===Z?A:Z,Q=G.mergePropsFactories,ee=void 0===Q?F:Q,te=G.selectorFactory,re=void 0===te?Y:te,function(e,t,r,n){void 0===n&&(n={});var o=n,a=o.pure,i=void 0===a||a,s=o.areStatesEqual,c=void 0===s?K:s,u=o.areOwnPropsEqual,l=void 0===u?N:u,d=o.areStatePropsEqual,f=void 0===d?N:d,p=o.areMergedPropsEqual,h=void 0===p?N:p,y=Object(v.default)(o,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),g=W(e,$,"mapStateToProps"),_=W(t,J,"mapDispatchToProps"),b=W(r,ee,"mergeProps");return V(re,Object(m.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:g,initMapDispatchToProps:_,initMergeProps:b,pure:i,areStatesEqual:c,areOwnPropsEqual:l,areStatePropsEqual:f,areMergedPropsEqual:h},y))});function oe(){var e=Object(a.useContext)(u);return E()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function ae(){return oe().store}function ie(){return ae().dispatch}var se="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,ce=function(e,t){return e===t};function ue(e,t){void 0===t&&(t=ce),E()(e,"You must pass a selector to useSelectors");var r,n=oe(),o=n.store,i=n.subscription,s=Object(a.useReducer)((function(e){return e+1}),0)[1],c=Object(a.useMemo)((function(){return new p(o,i)}),[o,i]),u=Object(a.useRef)(),l=Object(a.useRef)(),d=Object(a.useRef)();try{r=e!==l.current||u.current?e(o.getState()):d.current}catch(e){var f="An error occured while selecting the store state: "+e.message+".";throw u.current&&(f+="\nThe error may be correlated with this previous error:\n"+u.current.stack+"\n\nOriginal stack trace:"),new Error(f)}return se((function(){l.current=e,d.current=r,u.current=void 0})),se((function(){function e(){try{var e=l.current(o.getState());if(t(e,d.current))return;d.current=e}catch(e){u.current=e}s({})}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[o,c]),r}var le,de=r("i8i4");le=de.unstable_batchedUpdates,l=le},"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("/MKj"),a=r("ANjH"),i=r("/TnQ"),s=r("sINF"),c=r("xYVc"),u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:c.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},d=function(e,t){switch(void 0===e&&(e=l),t.type){case"SET_DATA_LOADED":return u(u({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return u(u({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return u(u({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return u(u({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return u(u({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return u(u({},e),{stickerHeaderScrollPosition:t.value});default:return e}},f=function(){return(f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p={color:c.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:c.default.FONTS[0]},h=function(e,t){switch(void 0===e&&(e=p),t.type){case"SET_SETTING_COLOR":return f(f({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return f(f({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return f(f({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return f(f({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return f(f({},e),{fontStyle:t.fontStyle});default:return e}},y=function(){return(y=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},m=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},v={currentIndex:null,items:[]},g=function(e,t){switch(void 0===e&&(e=v),t.type){case"SET_CURRENT_LAYER":return y(y({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return y(y({},e),{items:m(e.items,[t.payload])});case"UPDATE_LAYER":return y(y({},e),{items:e.items.map((function(r,n){return e.currentIndex===n?y(y({},r),t.payload):r}))});case"DELETE_LAYER":return{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))};default:return e}},_=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},b=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return _(e,[t.payload]);case"UNDO_DRAWING":return e.filter((function(t,r){return r!==e.length-1}));default:return e}},E=function(){return(E=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},w={currentBackgroundType:c.default.BACKGROUND_MODES.PHOTO,currentPhotoUrl:null,currentBackgroundId:1},S=function(e,t){switch(void 0===e&&(e=w),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return E(E({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return E(E({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return E(E({},e),{currentBackgroundId:t.value});default:return e}},O=function(){return(O=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},T=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return O(O({},e),t.payload);default:return e}},P=Object(a.combineReducers)({ui:d,settings:h,layers:g,drawings:b,background:S,data:T}),C=r("mYgU"),x=r.n(C),k=r("ufMw"),L=r("nAFc"),N=r("jE6c"),R=function(e){return{type:"SET_CURRENT_LAYER",index:e}},D=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var a=o().layers.items;n({type:e,payload:t}),r&&n(R(a.length))}},I=function(e,t){return function(r,n){var o,a,i=n(),s=i.data,u=i.settings,l=s.artboardWidth/2,d=s.artboardHeight/2-(parseInt(null===(o=s.addons)||void 0===o?void 0:o.photoOffsetTop)||0),f=Object(L.decodeHTMLEntities)(s.placeholders[Object(N.irand)(0,s.placeholders.length-1)]),p=0,h=!1,y=u.fontStyle,m=u.color,v=u.fontSize;t&&(l=void 0!==t.x?t.x:l,d=void 0!==t.y?t.y:d,f=void 0!==t.text?t.text:f,p=void 0!==t.rotate?t.rotate:p,h=void 0!==t.isEdit?t.isEdit:h,y=void 0!==t.style?t.style:y,m=void 0!==t.color?t.color:m,v=void 0!==t.fontSize?t.fontSize:v,a=t.initialFontSize),Object(k.sendStat)(k.EVENTS.ADD_TEXT),e&&r(F(c.default.TABS.TEXT)),r(D("ADD_LAYER_TEXT",{type:c.default.LAYER_TYPES.TEXT,text:f,x:l,y:d,rotate:p,isFixed:!1,isEdit:h,fontSize:v,initialFontSize:a,fontStyle:y,color:m,scale:1},e))}},j=function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"UPDATE_LAYER",payload:e})}},A=function(){return function(e,t){var r=t().layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&(a.type===c.default.LAYER_TYPES.STICKER?Object(k.sendStat)(k.EVENTS.DELETE_STICKER):a.type===c.default.LAYER_TYPES.TEXT&&Object(k.sendStat)(k.EVENTS.DELETE_TEXT),e(B(!1)),e({type:"DELETE_LAYER",index:n}))}}},M=function(){return function(e,t){var r=t().layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&a.type===c.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(j({isEdit:!1})):e(A()))}}},B=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},F=function(e){return function(t,r){var n=r().layers,o=n.items,a=n.currentIndex;null!==a&&(o[a].type===c.default.LAYER_TYPES.TEXT&&t(M()),e===c.default.TABS.PAINT&&t(R(null))),t({type:"SET_CURRENT_TAB",value:e})}},U=function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(j({color:e})),t({type:"SET_SETTING_COLOR",color:e})}},H=function(){return Object(k.sendStat)(k.EVENTS.CANCEL_GRAFFITI),{type:"UNDO_DRAWING"}},Y=r("i8i4");function W(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e}))}function K(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o}}function X(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function G(){return new Promise((function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var n=r.target;if(!n)return t();if(!n.files)return t();var o=n.files[0],a=URL.createObjectURL(o);W(a).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,a=2;a<o;){if(n.getUint16(a+2,!1)<=8)return t(-1);var i=n.getUint16(a,!1);if(a+=2,65505==i){if(1165519206!=n.getUint32(a+=2,!1))return t(-1);var s=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,s);var c=n.getUint16(a,s);a+=2;for(var u=0;u<c;u++)if(274==n.getUint16(a+12*u,s))return t(n.getUint16(a+12*u+8,s))}else{if(65280!=(65280&i))break;a+=n.getUint16(a,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(o).then((function(r){-1===r||-2===r||1===r?e(a):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,a=o.height,i=document.createElement("canvas"),s=i.getContext("2d");if(!s)return n();switch(4<t&&t<9?(i.width=a,i.height=e):(i.width=e,i.height=a),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,a);break;case 4:s.transform(1,0,0,-1,0,a);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,a,0);break;case 7:s.transform(0,-1,-1,0,a,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(i.toDataURL())},o.src=e}))}(a,r).then((function(t){e(t)})).catch((function(){t()}))})).catch((function(){t()}))})).catch((function(){t()}))},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()}))}function z(e,t,r,n,o,a,i){var s=0,c=0;switch(e){case"left_top":s=n+a,c=o+i;break;case"left_center":s=n+a,c=r/2+i;break;case"left_bottom":s=n+a,c=r-o+i;break;case"center_top":s=t/2+a,c=o+i;break;case"center":s=t/2+a,c=r/2+i;break;case"center_bottom":s=t/2+a,c=r-o+i;break;case"right_top":s=t-n+a,c=o+i;break;case"right_center":s=t-n+a,c=r/2+i;break;case"right_bottom":s=t-n+a,c=r-o+i}return{x:s,y:c}}var V,q=(V=function(e,t){return(V=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}V(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),$=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){return r.props.drawings.length!==e.drawings.length&&r.renderDrawings(e.drawings),!1},r.renderDrawings=function(e){var t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*c.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=X(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===c.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=K(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var a=r.props.settings;r.props.addDrawing({color:a.color,width:a.brushWidth,opacity:a.brushOpacity,path:r.currentDrawing}),r.renderDrawings(r.props.drawings)}},r.drawProcess=function(e){var t=K(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings(r.props.drawings)},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvasDoubleClick=function(){r.props.ui.currentMode!==c.default.TABS.PAINT&&r.props.addLayerText(!0,{isEdit:!0})},r.canvas=n.createRef(),r.currentDrawing=[],r}return q(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--draw",onDoubleClick:this.canvasDoubleClick,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t}(n.Component),Z=Object(o.connect)((function(e){return{ui:e.ui,settings:e.settings,drawings:e.drawings,data:e.data}}),(function(e){return{addDrawing:function(t){return e(function(e){return Object(k.sendStat)(k.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}}(t))},addLayerText:function(t,r){return e(I(t,r))}}}))($),J=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Q=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},ee=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props.background;return t.currentBackgroundId===e.background.currentBackgroundId&&t.currentBackgroundType===e.background.currentBackgroundType&&t.currentPhotoUrl===e.background.currentPhotoUrl||r.renderImage(e.background),!1},r.getBackgroundById=function(e){var t=r.props.data.backgrounds,n=t.gradients,o=t.emojies;return Q(n,o).filter((function(t){return t.id===e}))[0]},r.getCurrentImageUrl=function(e){var t,n=e||r.props.background,o=n.currentBackgroundType,a=n.currentPhotoUrl,i=n.currentBackgroundId;o===c.default.BACKGROUND_MODES.PHOTO?t=a:t=r.getBackgroundById(i).url;return t},r.renderImage=function(e){var t=r.canvas.current;if(t){var n=r.getCurrentImageUrl(e);n&&W(n).then((function(e){var r=t.getContext("2d");if(r){var n,o,a=+(e.height/e.width).toFixed(2);if(a>1.77?(o=t.height,n=t.height/a):(n=t.width,o=t.width*a),r.save(),r.clearRect(0,0,t.width,t.height),r.filter="blur(135px)",r.drawImage(e,0,0,t.width,t.height),r.restore(),"none"!==r.filter){var i=function(e){var t,r={r:0,g:0,b:0};if(!e)return r;try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,o=0;(n+=20)<t.data.length;)++o,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/o),r.g=~~(r.g/o),r.b=~~(r.b/o),r}(r);r.fillStyle="rgb("+i.r+", "+i.g+", "+i.b+")",r.fillRect(0,0,t.width,t.height)}r.drawImage(e,t.width/2-n/2,t.height/2-o/2,n,o)}})).catch((function(e){console.error(e)}))}},r.canvas=n.createRef(),r}return J(t,e),t.prototype.componentDidMount=function(){this.renderImage()},t.prototype.render=function(){var e=this.props.data;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:e.originalWidth,height:e.originalHeight,style:{width:this.props.width,height:this.props.height}})},t}(n.Component),te=Object(o.connect)((function(e){return{data:e.data,background:e.background}}))(ee),re=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.layer=t.props.layer,t.layer.type===c.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth,t.height=n.offsetHeight}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=K(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var a={x:n-t.layer.x,y:o-t.layer.y},i=180*(Math.atan2(a.y,a.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(c.default.LAYER_MIN_SIZE,Math.sqrt(a.x*a.x+a.y*a.y))/t.distanceToZero,u=Math.floor(t.width*s),l=Math.floor(t.height*s);t.layer.type===c.default.LAYER_TYPES.TEXT?t.props.updateLayer({fontSize:t.layer.fontSize*s,rotate:i}):t.props.updateLayer({width:u,height:l,scale:s,rotate:i})}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return re(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),oe=r("Xrg9"),ae=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ae(t,e),t.prototype.render=function(){return oe.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,o=100*Math.abs(r[1].x-r[0].x),a=100*Math.abs(r[2].y-r[1].y);return n.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:o+"%",height:a+"%"}})})):null},t}(n.Component),se=r("pemR"),ce=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ue=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderLayerSticker=function(e,r,o){var a=t.props.getStickerUrlById(e.id,c.default.STICKER_LARGE);return n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+a+"')"}},t.props.currentIndex===r&&n.createElement(ne,{layer:e,updateLayer:t.props.updateLayer})))},t.renderLayerImage=function(e,r,o){return n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+e.url+"')"}},t.props.currentIndex===r&&n.createElement(ne,{layer:e,updateLayer:t.props.updateLayer}),e.clickableZones&&n.createElement(ie,{clickableZones:e.clickableZones})))},t.renderLayerText=function(e,r,o){var a=Math.max(2,e.fontSize*e.scale*c.default.FONT_SIZE_COEFFICIENT);o+=" PhotoEditorFontStyle--"+e.fontStyle;var i={fontSize:a,color:e.color};return t.props.currentIndex===r&&e.isEdit?null:n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:i,onDoubleClick:t.handleDoubleClick},n.createElement("div",null,Object(L.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),t.props.currentIndex===r&&n.createElement(ne,{layer:e,updateLayer:t.props.updateLayer})))},t.handleDoubleClick=function(){t.props.updateLayer({isEdit:!0})},t}return ce(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,a=Object(se.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--drag":t.isFixed,"EditorLayer--hide":t.isHide});switch(t.type){case c.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,a);break;case c.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,a);break;case c.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,a)}return t.isFixed?Y.createPortal(o,document.body):o},t}(n.Component),le=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return le(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,a=Object(se.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":this.props.currentMode===c.default.TABS.PAINT});return n.createElement("div",{className:a,id:"EditorCanvas__layers"},r.map((function(t,r){return n.createElement(ue,{key:r,index:r,currentIndex:o,layer:t,updateLayer:e.props.updateLayer,getStickerUrlById:e.props.getStickerUrlById})})))},t}(n.Component),fe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pe=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=.5*c.default.FONT_SIZE_COEFFICIENT;return e.initialFontSize&&(t=e.initialFontSize*c.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(L.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,a=-1;o<t.length;o++){var i=t.charAt(o);if(" "!=i&&"-"!=i&&"+"!=i||(a=o),r.value+=i,r.scrollWidth>n){var s="";if(a>=0){for(var c=a+1;c<o;c++)s+=t.charAt(c);a=-1}s+=i,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(k.sendStat)(k.EVENTS.EDIT_TEXT),r}return fe(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontStyle!==this.props.layer.fontStyle&&this.onChange()},t}(n.Component),he=r("4+be"),ye=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),me=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},ve=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,a=t.items,i=null!==o&&a[o],s=i&&i.type===c.default.LAYER_TYPES.TEXT&&i.isEdit,u=i&&i.type===c.default.LAYER_TYPES.STICKER&&i.isHide,l="";return i&&(i.type===c.default.LAYER_TYPES.STICKER?l=Object(he.getLang)("photos_pe_delete_sticker"):i.type===c.default.LAYER_TYPES.TEXT&&(l=Object(he.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==c.default.BACKGROUND_MODES.BACKGROUND||i||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,i&&!s&&!u&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},l),i&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(he.getLang)("photos_pe_save_action")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(he.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(he.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===c.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(he.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds||{},o=t.gradients,a=void 0===o?{}:o,i=t.emojies,s=void 0===i?{}:i,c=r.scrollElement.current,u=c?e+c.offsetWidth:0,l=!!e,d=!c||!!(c.scrollWidth-u);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},me(a,s).map((function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(se.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})}))),l&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),d&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:i})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return ye(t,e),t}(n.Component),ge=Object(o.connect)((function(e){return{context:e.data.context,layers:e.layers,addons:e.data.addons}}),(function(e){return{deleteLayer:function(){return e(A())},closeTextEditor:function(){return e(M())}}}))(ve),_e=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),be=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===c.default.BACKGROUND_MODES.PHOTO?Object(k.sendStat)(k.EVENTS.CLICK_TO_CAMERA_ICON):e===c.default.BACKGROUND_MODES.BACKGROUND&&Object(k.sendStat)(k.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return _e(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(c.default.BACKGROUND_MODES).map((function(t){var r=Object(se.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})})))},t}(n.Component),Ee=r("6krn"),we=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Se=r("XpgC").default,Oe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?Y.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,a=e.data,i=a.addons,s=a.artboardWidth,u=a.artboardHeight,l=a.attachment,d=t.props.layers,f=d.currentIndex,p=d.items,h=null!==f&&p[f],y=h&&h.type===c.default.LAYER_TYPES.TEXT&&h.isEdit,m=t.props.ui.isDataLoaded&&t.props.data.context===c.default.CONTEXT_TYPES.STORY,v=u;i&&i.photoHeight&&(v=i.photoHeight);var g=0;return i&&i.photoOffsetTop&&(g=i.photoOffsetTop),n.createElement(n.Fragment,null,n.createElement("div",{style:{width:s,height:v,marginTop:g},className:"EditorCanvas"},n.createElement(de,{updateLayer:t.props.updateLayer,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),y&&h?n.createElement(pe,{layer:h,onChange:t.onChangeText}):m&&n.createElement(n.Fragment,null,!!l&&n.createElement(Se,{text:Object(Ee.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),n.createElement(be,{current:o.currentBackgroundType,setMode:t.setMode})),t.props.ui.isDataLoaded&&n.createElement(Z,{width:s,height:v}),t.props.ui.isDataLoaded&&n.createElement(te,{width:s,height:v})),t.props.ui.isDataLoaded&&n.createElement(ge,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onChangeText=function(e){t.props.updateLayer({text:e})},t.setMode=function(e){var r=t.props.background,n=r.currentBackgroundType,o=r.currentPhotoUrl;t.props.setCurrentLayer(null),e===c.default.BACKGROUND_MODES.PHOTO&&!o||n===c.default.BACKGROUND_MODES.PHOTO&&n===e?t.uploadPhoto((function(){t.props.setBackgroundType(e)})):t.props.setBackgroundType(e)},t.uploadPhoto=function(e){G().then((function(r){e&&e(),t.props.setCurrentPhotoUrl(r)})).catch((function(){window.showFastBox({title:Object(Ee.getLang)("global_error")},Object(Ee.getLang)("stories_create_image_incorrect"))}))},t}return we(t,e),t}(n.Component),Te=Object(o.connect)((function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}}),(function(e){return{setCurrentBackgroundId:function(t){return e(function(e){return Object(k.sendStat)(k.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}}(t))},updateLayer:function(t){return e(j(t))},setCurrentLayer:function(t){return e(R(t))},setBackgroundType:function(t){return e({type:"SET_CURRENT_BACKGROUND_TYPE",value:t})},setCurrentPhotoUrl:function(t){return e(function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}}(t))}}}))(Oe),Pe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pe(t,e),t.prototype.render=function(){var e=this.props,t=e.current,r=e.change;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,(function(e){var o=Object(se.classNames)("EditorTabs__item","EditorTabs__item--"+e.props["data-mode"],{"EditorTabs__item--current":t===e.props["data-mode"]});return n.createElement("div",{className:o,key:e.props["data-mode"],onClick:function(){return r(e.props["data-mode"])}})}))),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,(function(e){var r={className:Object(se.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)}))))},t}(n.Component),xe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ke=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return xe(t,e),t.prototype.render=function(){var e=this,t=Object(se.classNames)("DropBox__inner",{"DropBox__inner--hover":this.state.onHover});return n.createElement("div",{className:"DropBox"},n.createElement("div",{className:t,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},n.createElement("div",{className:"DropBox__icon"},this.renderIcon()),n.createElement("span",{dangerouslySetInnerHTML:{__html:Object(Ee.getLang)("photos_pe_drag_to_remove")}})))},t.prototype.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50px",height:"50px",viewBox:"0 0 50 50"},n.createElement("path",{d:"M15 19H35V37C35 38.1 34.1 39 33 39H17C15.9 39 15 38.1 15 37V19Z",fill:"white"}),n.createElement("path",{d:"M37 15C37 13.9 36.1 13 35 13H28.4C28.4 11.9 27.5 11 26.4 11H23.6C22.5 11 21.6 11.9 21.6 13H15C13.9 13 13 13.9 13 15C13 15 13 13.5 13 15V17H37V15C37 15 37 13.4 37 15Z",fill:"white",className:"cap"}))},t}(n.Component),Le=r("t7n3"),Ne=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Re=r("vRp6").default,De=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.setState({})},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,a=r.props.ui,i=a.stickerHeaderScrollPosition,s=a.currentStickerPackIndex,u=r.scrollElement.current,l=!!i,d=!1,f=0;u&&(f=i+u.offsetWidth,d=!!(u.scrollWidth-f));var p=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,p=[],r.setState({}));for(var h=[],y=0,m=p.length;y<m;y+=3)h.push(p.slice(y,y+3));return n.createElement("div",{className:"StickersPanel"},r.props.ui.isShowDropBox&&n.createElement(ke,{onDelete:r.props.deleteLayer}),n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+i+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},t.map((function(e,t){var o=e.id,a=r.getTabPreviewUrl(t);if(!a)return null;var i=!Object(Le.inArray)(o,["recent","editor"]),c=Object(se.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:c,style:i?{backgroundImage:"url('"+a+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})}))),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),d&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(Re,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},h.map((function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map((function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[c.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))})))}))))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[c.default.STICKER_SMALL]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(i)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return Ne(t,e),t}(n.Component),Ie=Object(o.connect)((function(e){return{ui:e.ui,stickers:e.data.stickers}}),(function(e){return{deleteLayer:function(){return e(A())},setCurrentStickerPackIndex:function(t){return e(function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}}(t))},setHeaderScrollPosition:function(t){return e(function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}}(t))}}}))(De),je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return je(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},c.default.COLORS.map((function(t){var r=Object(se.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:t,className:r,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})})))},t}(n.Component),Me=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Be=r("Cb16").default,Fe=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,a=e.setBrushWidth,i=e.setBrushOpacity;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:"270",height:"80"}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__sliderTitle"},Object(Ee.getLang)("photos_pe_intensity")),n.createElement(Be,{color:"#5181b8",defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__sliderTitle"},Object(Ee.getLang)("photos_pe_line_width")),n.createElement(Be,{color:"#5181b8",defaultValue:t.brushWidth,onChange:function(e){return a(e)}}))),n.createElement(Ae,{color:t.color,setColor:o}),!!r.props.drawings.length&&n.createElement("div",{className:"DrawPanel__undo",onClick:r.undoDrawing},Object(Ee.getLang)("photos_pe_undo_last_action")))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,a=o.width,i=o.height,s=.2*a,u=.25*i,l=.8*a,d=u,f=a/2,p=1.2*i;n.clearRect(0,0,a,i),n.beginPath(),n.moveTo(s,u),n.quadraticCurveTo(f,p,l,d);var h="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*c.default.BRUSH_WIDTH_COEFFICIENT,n.strokeStyle=X(h,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke()}}},r.undoDrawing=function(){r.props.undoDrawing()},r.previewCanvas=n.createRef(),r}return Me(t,e),t}(n.Component),Ue=Object(o.connect)((function(e){return{settings:e.settings,drawings:e.drawings}}),(function(e){return{setColor:function(t){return e(U(t))},setBrushWidth:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}}(t))},setBrushOpacity:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}(t))},undoDrawing:function(){return e(H())}}}))(Fe),He=r("Ht+d"),Ye=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),We=r("TBLV").default,Ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,a=e.layer,i=e.fontsPlaceholders,s=a&&a.isEdit,u=a&&a.fontStyle,l=a&&a.color;return n.createElement("div",{className:"TextPanel"},t.props.ui.isShowDropBox&&n.createElement(ke,{onDelete:t.props.deleteLayer}),s?n.createElement(He.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(he.getLang)("photos_pe_save_action")):n.createElement(He.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(he.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(he.getLang)("photos_pe_font")),c.default.FONTS.map((function(e,o){return n.createElement(We,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:u?u===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font PhotoEditorFontStyle--"+e},i[o]))}))),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(he.getLang)("photos_pe_color")),n.createElement(Ae,{color:l||r.color,setColor:o})))},t}return Ye(t,e),t}(n.Component),Xe=Object(o.connect)((function(e){var t=e.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{ui:e.ui,settings:e.settings,layer:o,fontsPlaceholders:e.data.fontsPlaceholders}}),(function(e){return{addLayerText:function(t,r){return e(I(t,r))},setColor:function(t){return e(U(t))},setFontSize:function(t){return e(function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(j({fontSize:e})),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}}(t))},setFontStyle:function(t){return e(function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(j({fontStyle:e})),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}}(t))},deleteLayer:function(){return e(A())},closeTextEditor:function(){return e(M())}}}))(Ke),Ge=r("3oLO"),ze=r("Egk5"),Ve=r("zxIV"),qe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$e=function(){return($e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Ze=r("6raB").default,Je=r("PjZB").default,Qe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then((function(e){var r=e.stickers,n=e.backgrounds,o=e.storyUploadUrlHash,a=e.storySaveHash,i={};r.forEach((function(e){e.items.forEach((function(e){i[e.id]=e}))})),t.props.setData({stickers:r,stickersMap:i,backgrounds:n,placeholders:Object(Ee.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object(Ee.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:o,storySaveHash:a}),t.props.setDataLoaded(),t.props.background.currentBackgroundType===c.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)})).catch((function(){window.showFastBox({title:Object(Ee.getLang)("global_error")},Object(Ee.getLang)("global_error"),Object(Ee.getLang)("global_close"),(function(){window.curBox().hide(),t.props.data.close(!1,!0)}))}))},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise((function(e,t){Ge.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},t.render=function(){var e,r=t.props,o=r.ui,a=r.data,i=r.drawings,s=r.layers;return a.artboardContainer||(e={width:a.artboardWidth,height:parseInt(a.artboardHeight)+c.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,a.context===c.default.CONTEXT_TYPES.STORY?t.isSaveDisabled=!1:t.isSaveDisabled=!s.items.length&&!i.length,n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(a.artboardHeight)+c.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(Te,{getStickerUrlById:t.getStickerUrlById})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(Je,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e=Object(Ee.getLang)("photos_pe_save_action");return t.props.data.context===c.default.CONTEXT_TYPES.STORY&&(e=Object(Ee.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(Ce,{current:t.props.ui.currentMode,change:t.props.setMode},n.createElement("div",{"data-mode":c.default.TABS.STICKERS},n.createElement(Ie,{stickerMouseDown:t.stickerDragStart})),n.createElement("div",{"data-mode":c.default.TABS.TEXT},n.createElement(Xe,null)),n.createElement("div",{"data-mode":c.default.TABS.PAINT},n.createElement(Ue,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement(He.default,{appearance:"secondary",onClick:t.props.data.close},Object(Ee.getLang)("photos_pe_cancel_action")),n.createElement(Ze,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},e)))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},c.default.FONTS.map((function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})})))},t.save=function(){t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),t.renderFinalImage().then((function(e){var r=e.blob,n=e.width,o=e.height,a=t.props,i=a.layers,s=a.drawings,c=a.background,u=Object(k.prepareStat)(i.items,s,c.currentBackgroundType,c.currentBackgroundId),l=[];t.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(r){l.push(t.getPreparedClickableZone(e,r))}))}));var d={original_width:n,original_height:o,clickable_stickers:l};t.props.data.save(r,(function(){t.props.setSaveLoading(!1)}),{attachment:t.props.data.attachment,storyUploadUrlHash:t.props.data.storyUploadUrlHash,storySaveHash:t.props.data.storySaveHash,analytics:JSON.stringify(u),clickableStickers:JSON.stringify(d)})})).catch((function(e){console.error(e)}))},t.getPreparedClickableZone=function(e,r){var n,o=t.props.data.originalWidth/t.props.data.artboardWidth,a=e.rotate*(Math.PI/180),i=e.x-e.width/2,s=e.y-e.height/2,c=parseFloat(e.x)+(i-e.x)*Math.cos(a)-(s-e.y)*Math.sin(a),u=parseFloat(e.y)+(s-e.y)*Math.cos(a)+(i-e.x)*Math.sin(a),l=null===(n=r.clickable_area)||void 0===n?void 0:n.map((function(t){var r=t.x*e.width,n=t.y*e.height,i=r*Math.cos(a)-n*Math.sin(a),s=r*Math.sin(a)+n*Math.cos(a);return{x:(c+i)*o,y:(u+s)*o}})),d={type:r.action_type,clickable_area:l};return"link"===r.action_type?(d.link=r.action.link,r.action.tooltip_text_key&&(d.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(d.app_id=r.action.app_id,r.action.app_context&&(d.app_id=r.action.app_id)),d},t.renderFinalImage=function(){return new Promise((function(e){var r=document.createElement("canvas"),n=r.getContext("2d"),o=document.querySelector(".EditorCanvas__canvas--bg"),a=document.querySelector(".EditorCanvas__canvas--draw"),i=document.getElementById("EditorCanvas__layers");if(n&&o&&a&&i){r.width=o.width,r.height=o.height,n.drawImage(o,0,0),n.drawImage(a,0,0);var s=t.props.data,c=s.artboardWidth,u=s.artboardHeight,l=s.addons,d=u;l&&l.photoHeight&&(d=l.photoHeight),x.a.toCanvas(i,{width:c,height:d,filter:function(e){return e.nodeType===Node.TEXT_NODE||!e.classList.contains("EditorLayer--sticker")&&!e.classList.contains("EditorClickableZone")}}).then((function(o){n.drawImage(o,0,0,r.width,r.height),t.renderCanvasLayers(n).then((function(){r.toBlob((function(t){e({blob:t,width:r.width,height:r.height})}),"image/jpeg",1)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}}))},t.renderCanvasLayers=function(e){return new Promise((function(r,n){var o=t.props.data.originalWidth/t.props.data.artboardWidth,a=[];t.props.layers.items.forEach((function(r){r.type===c.default.LAYER_TYPES.STICKER&&a.push(t.renderCanvasSticker(e,r,o))})),Promise.all(a).then(r).catch((function(e){n(e)}))}))},t.renderCanvasSticker=function(e,r,n){return W(t.getStickerUrlById(r.id,c.default.STICKER_LARGE)).then((function(t){var o=r.width*n,a=r.height*n,i=(r.x-r.width/2)*n,s=(r.y-r.height/2)*n;e.save(),e.translate(i,s),e.translate(o/2,a/2),e.rotate(r.rotate*Math.PI/180),e.translate(-o/2,-a/2),e.drawImage(t,0,0,o,a),e.restore()}))},t.handleKeyDown=function(e){if((e.ctrlKey||e.metaKey)&&90===e.keyCode&&t.props.ui.currentMode===c.default.TABS.PAINT&&t.props.undoDrawing(),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(e.keyCode===ze.KEY.DEL)e.preventDefault(),t.props.deleteLayer();else if([ze.KEY.UP,ze.KEY.DOWN,ze.KEY.LEFT,ze.KEY.RIGHT].includes(e.keyCode)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.keyCode){case ze.KEY.UP:n.y-=o;break;case ze.KEY.DOWN:n.y+=o;break;case ze.KEY.LEFT:n.x-=o;break;case ze.KEY.RIGHT:n.x+=o}t.props.updateLayer({x:n.x,y:n.y})}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if(r&&r.isFixed)t.layerDragFinish(e);else if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void(t.props.ui.currentMode!==c.default.TABS.PAINT&&(r&&r.type===c.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null))))},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e,r){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var n,o=e.target.closest("[data-index]");n=o?+Object(Ve.domData)(o,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==n&&t.props.setCurrentLayer(n);var a=K(e,document.querySelector(".EditorCanvas__canvas--draw")),i=a.x,s=a.y,c=a.xOrigin,u=a.yOrigin;t.currentLayer=t.getCurrentLayer(),t.currentLayer&&(t.fromPanel=r,t.clientX=e.clientX,t.clientY=e.clientY,t.fromPanel?(t.shiftX=0,t.shiftY=0,t.shiftBodyX=0,t.shiftBodyY=0):(t.shiftX=i-t.currentLayer.x,t.shiftY=s-t.currentLayer.y,t.shiftBodyX=t.clientX-(t.currentLayer.x+c),t.shiftBodyY=t.clientY-(t.currentLayer.y+u)))},t.layerDragProcess=function(e){void 0!==t.shiftBodyX&&void 0!==t.shiftBodyY&&(t.props.updateLayer({x:Math.round(e.clientX-t.shiftBodyX),y:Math.round(e.clientY-t.shiftBodyY),isFixed:!0,isHide:!1}),t.fromPanel||t.props.ui.isShowDropBox||t.props.setShowDropBox(!0))},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=K(e,r),o=n.x,a=n.y,i=r.getBoundingClientRect(),s=i.width,c=i.height,u=o-t.shiftX,l=a-t.shiftY,d=!1;if(t.fromPanel){var f=t.currentLayer.width/2,p=t.currentLayer.height/2;t.clientX===e.clientX&&t.clientY===e.clientY?(u=r.offsetWidth/2,l=r.offsetHeight/2):(u+f<0||u-f>s||l+p<0||l-p>c)&&(d=!0)}t.props.updateLayer({x:Math.round(u),y:Math.round(l),isFixed:!1,isHide:!1}),d&&t.props.deleteLayer(),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.shiftBodyX,delete t.shiftBodyY,delete t.fromPanel,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.stickerDragStart=function(e,r){e.persist();var n=t.getCurrentLayer();if(!n||!n.isFixed){var o=document.querySelector(".EditorCanvas__canvas--draw");if(o){var a=c.default.LAYER_DEFAULT_SIZE/2,i=Math.floor(o.width/c.default.CANVAS_SCALE/2-a),s=Math.floor(o.height/c.default.CANVAS_SCALE/2-a);t.props.addLayerSticker({id:r,x:i,y:s,width:c.default.LAYER_DEFAULT_SIZE,height:c.default.LAYER_DEFAULT_SIZE,rotate:0,isHide:!0,isFixed:!1}),setTimeout((function(){t.layerDragStart(e.nativeEvent,!0)}),0)}}},t.prepareStickers=function(e){var r=t.props.data,n=r.artboardWidth,o=r.artboardHeight;e.forEach((function(e){var r=e.sticker.transform||{},a=r.gravity,i=void 0===a?"center":a,s=r.rotation,u=void 0===s?0:s,l=r.translation_x,d=void 0===l?0:l,f=r.translation_y,p=void 0===f?0:f,h=r.relation_width;if(d=Math.min(Math.max(d,-1),1),p=Math.min(Math.max(p,-1),1),h&&(h=Math.min(Math.max(h,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,i,d,p,h).then((function(e){var r=e.url,n=e.x,o=e.y,a=e.stickerWidth,i=e.stickerHeight,s=e.clickableZones;t.props.addLayerImage({url:r,x:n,y:o,width:Math.round(a),height:Math.round(i),rotate:-u,isFixed:!1,clickableZones:s})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var y=h?n*h:c.default.LAYER_DEFAULT_SIZE,m=h?n*h:c.default.LAYER_DEFAULT_SIZE,v=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[v]){var g=z(i,n,o,y/2,m/2,d*n,p*o),_=g.x,b=g.y;t.props.addLayerSticker({id:v,x:_,y:b,width:y,height:m,rotate:-u,isHide:!1,isFixed:!1})}break;case"text":var E=.5;h&&(E=t.getFontSize(e.sticker.action.text,n*h,e.sticker.action.style));var w=t.getTextRect(e.sticker.action.text,E*c.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),S=(y=w.width,m=w.height,z(i,n,o,y/2,m/2,d*n,p*o));_=S.x,b=S.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:E,initialFontSize:E,rotate:-u,x:_,y:b})}}))},t.prepareRenderableSticker=function(e,r,n,o,a){var i=t.props.data,s=i.artboardWidth,c=i.artboardHeight,u=i.originalWidth/s;return new Promise((function(t,i){"string"!=typeof e.url&&"string"!=typeof e.blob&&i();var l=e.url||e.blob||"";W(l).then((function(i){var d=i.height/i.width,f=0,p=0;a?p=(f=s*a)*d:(f=i.width/u,p=i.height/u,f>s&&(p=(f=s)*d));var h,y=z(r,s,c,f/2,p/2,n*s,o*c),m=y.x,v=y.y;e.clickable_zones&&(h=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/i.width,y:e.y/i.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],$e($e({},e),{clickable_area:t})}))),t({url:l,x:m,y:v,stickerWidth:f,stickerHeight:p,clickableZones:h})})).catch((function(){i()}))}))},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.append(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t}return qe(t,e),t}(n.Component),et=Object(o.connect)((function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}}),(function(e){return{setMode:function(t){return e(F(t))},addLayerSticker:function(t){return e(function(e){return Object(k.sendStat)(k.EVENTS.ADD_STICKER),D("ADD_LAYER_STICKER",{type:c.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isHide:e.isHide,isFixed:e.isFixed})}(t))},addLayerText:function(t,r){return e(I(t,r))},addLayerImage:function(t){return e(function(e){return D("ADD_LAYER_IMAGE",{type:c.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isFixed:e.isFixed,clickableZones:e.clickableZones})}(t))},updateLayer:function(t){return e(j(t))},undoDrawing:function(){return e(H())},deleteLayer:function(){return e(A())},setCurrentLayer:function(t){return e(R(t))},setDataLoaded:function(){return e({type:"SET_DATA_LOADED"})},setShowDropBox:function(t){return e(B(t))},setSaveLoading:function(t){return e(function(e){return{type:"SET_SAVE_LOADING",value:e}}(t))},closeTextEditor:function(){return e(M())},setData:function(t){return e(function(e){return{type:"SET_DATA",payload:e}}(t))}}}))(Qe),tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=c.default.CONTEXT_TYPES,r=c.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return tt(t,e),t.prototype.render=function(){var e,t=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},Object(a.createStore)(P,e,i.composeWithDevTools(Object(a.applyMiddleware)(s.default))));return n.createElement(o.Provider,{store:t},n.createElement(et,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:c.default.STORY_BASE_WIDTH,originalHeight:c.default.STORY_BASE_HEIGHT},t}(n.Component);t.default=rt},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function a(e,t,r,a,i,s){o(e)&&n(t,r,a,i,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return o})),r.d(t,"statlogsProbValueEvent",(function(){return a}))},260:function(e,t,r){e.exports=r("8o6h")},"2mql":function(e,t,r){"use strict";var n=r("TOwV"),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function c(e){return n.isMemo(e)?i:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=i;var u=Object.defineProperty,l=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,p=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(h){var o=p(r);o&&o!==h&&e(t,o,n)}var i=l(r);d&&(i=i.concat(d(r)));for(var s=c(t),y=c(r),m=0;m<i.length;++m){var v=i[m];if(!(a[v]||n&&n[v]||y&&y[v]||s&&s[v])){var g=f(r,v);try{u(t,v,g)}catch(e){}}}}return t}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"6krn":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",(function(){return i}));var n=r("nAFc"),o=r("4+be"),a={};function i(e,t,r){void 0===t&&(t=!1);var i="number"==typeof t,s=t||i,c=e+(s?".raw":"");if(void 0===a[c]){var u=s?Object(o.getLang)(e,"raw"):Object(o.getLang)(e);"string"==typeof u?a[c]=Object(n.decodeHTMLEntities)(u):Array.isArray(u)&&(a[c]=u.map(n.decodeHTMLEntities))}if(i){var l=t;return Object(o.langNumeric)(l,a[c],r)}return a[c]||""}t.default={getLang:i}},"8o6h":function(e,t,r){"use strict";r.r(t);var n=r("qJhe");window.StoryPublisher=n.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",(function(){return s})),r.d(t,"combineReducers",(function(){return u})),r.d(t,"bindActionCreators",(function(){return d})),r.d(t,"applyMiddleware",(function(){return y})),r.d(t,"compose",(function(){return h})),r.d(t,"__DO_NOT_USE__ActionTypes",(function(){return a}));var n=r("bCCX"),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},a={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function i(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(s)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var c=e,u=t,l=[],d=l,f=!1;function p(){d===l&&(d=l.slice())}function h(){if(f)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return u}function y(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(f)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return p(),d.push(e),function(){if(t){if(f)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,p();var r=d.indexOf(e);d.splice(r,1)}}}function m(e){if(!i(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(f)throw new Error("Reducers may not dispatch actions.");try{f=!0,u=c(u,e)}finally{f=!1}for(var t=l=d,r=0;r<t.length;r++){(0,t[r])()}return e}function v(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");c=e,m({type:a.REPLACE})}function g(){var e,t=y;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(h())}return r(),{unsubscribe:t(r)}}})[n.default]=function(){return this},e}return m({type:a.INIT}),(o={dispatch:m,subscribe:y,getState:h,replaceReducer:v})[n.default]=g,o}function c(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function u(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var i,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:a.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:a.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+a.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var n=!1,o={},a=0;a<s.length;a++){var u=s[a],l=r[u],d=e[u],f=l(d,t);if(void 0===f){var p=c(u,t);throw new Error(p)}o[u]=f,n=n||f!==d}return n?o:e}}function l(e,t){return function(){return t(e.apply(this,arguments))}}function d(e,t){if("function"==typeof e)return l(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;o<r.length;o++){var a=r[o],i=e[a];"function"==typeof i&&(n[a]=l(i,t))}return n}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){f(e,t,r[t])}))}return e}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return p({},r,{dispatch:n=h.apply(void 0,a)(r.dispatch)})}}}},Cb16:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));r("91GP");var n=r("q1tI");r("17x9");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}class a extends n.Component{constructor(e){if(super(e),this.props.defaultValue<0||this.props.defaultValue>1)throw new Error("Bad defaultValue specified to Slider");this.containerRef=n.createRef()}componentDidUpdate(e){this.props.value!==e.value&&this.sliderElement.setValue(this.props.value,!0)}componentDidMount(){this.sliderElement=new window.Slider(this.containerRef.current,o({size:1,value:this.props.defaultValue,formatHint:this.props.formatHint,onChange:this.props.onChange},this.props))}render(){return n.createElement("div",{className:`Slider Slider--${this.props.color} ${this.props.className}`,ref:this.containerRef})}}a.defaultProps={color:"blue",defaultValue:.5,formatHint:e=>Math.round(100*e)}},D2Nl:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r("JHWP")),a=r("Iwry"),i=/url\((['"]?)([^'"]+?)\1\)/g;function s(e){var t=[];return e.replace(i,(function(e,r,n){return t.push(n),e})),t.filter((function(e){return!a.isDataUrl(e)}))}function c(e,t,r,n){var i=r?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;var r=document.implementation.createHTMLDocument(),n=r.createElement("base"),o=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(o),t&&(n.href=t),o.href=e,o.href}(t,r):t;return Promise.resolve(i).then((function(e){return o.default(e,n)})).then((function(e){return a.toDataURL(e,a.getMimeType(t))})).then((function(r){return e.replace(new RegExp("(url\\(['\"]?)("+function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}(t)+")(['\"]?\\))","g"),"$1"+r+"$3")})).then((function(e){return e}),(function(){return i}))}function u(e){return-1!==e.search(i)}t.shouldEmbed=u,t.default=function(e,t,r){return u(e)?Promise.resolve(e).then(s).then((function(n){return n.reduce((function(e,n){return e.then((function(e){return c(e,n,t,r)}))}),Promise.resolve(e))})):Promise.resolve(e)}},Iwry:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o="application/font-woff",a={woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function i(e){var t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function s(e){var t=i(e).toLowerCase();return a[t]||""}function c(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=r,n.crossOrigin="anonymous",n.src=e}))}function u(e){return e.split(/,/)[1]}function l(e,t){var r=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(r.replace("px",""))}function d(){return window.devicePixelRatio||1}t.uuid=(n=0,function(){return n+=1,"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+n}),t.parseExtension=i,t.getMimeType=s,t.delay=function(e){return function(t){return new Promise((function(r){setTimeout((function(){r(t)}),e)}))}},t.createImage=c,t.isDataUrl=function(e){return-1!==e.search(/^(data:)/)},t.toDataURL=function(e,t){return"data:"+t+";base64,"+e},t.getDataURLContent=u,t.canvasToBlob=function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var r=window.atob(e.toDataURL().split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a+=1)o[a]=r.charCodeAt(a);t(new Blob([o],{type:"image/png"}))}))}(e)},t.toArray=function(e){for(var t=[],r=0,n=e.length;r<n;r+=1)t.push(e[r]);return t},t.getNodeWidth=function(e){var t=l(e,"border-left-width"),r=l(e,"border-right-width");return e.scrollWidth+t+r},t.getNodeHeight=function(e){var t=l(e,"border-top-width"),r=l(e,"border-bottom-width");return e.scrollHeight+t+r},t.getPixelRatio=d,t.svgToDataURL=function(e){return Promise.resolve().then((function(){return(new XMLSerializer).serializeToString(e)})).then(encodeURIComponent).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))},t.getBlobFromImageURL=function(e){return c(e).then((function(t){var r=t.width,n=t.height,o=document.createElement("canvas"),a=o.getContext("2d"),i=d();return o.width=r*i,o.height=n*i,o.style.width=""+r,o.style.height=""+n,a.scale(i,i),a.drawImage(t,0,0),u(o.toDataURL(s(e)))}))}},JHWP:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");t.default=function(e,t){return t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),(window.fetch?window.fetch(e).then((function(e){return e.blob()})).then((function(e){return new Promise((function(t,r){var n=new FileReader;n.onloadend=function(){return t(n.result)},n.onerror=r,n.readAsDataURL(e)}))})).then(n.getDataURLContent).catch((function(){return new Promise((function(e,t){t()}))})):new Promise((function(t,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var a=new FileReader;a.onloadend=function(){t(n.getDataURLContent(a.result))},a.readAsDataURL(o.response)}else r(new Error("Failed to fetch resource: "+e+", status: "+o.status))},o.ontimeout=function(){r(new Error("Timeout of 30000ms occured while fetching resource: "+e))},o.responseType="blob",o.timeout=3e4,o.open("GET",e,!0),o.send()}))).catch((function(r){var n="";if(t.imagePlaceholder){var o=t.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}var a="Failed to fetch resource: "+e;return r&&(a="string"==typeof r?r:r.message),a&&console.error(a),n}))}},JX7q:function(e,t,r){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.r(t),r.d(t,"default",(function(){return n}))},PjZB:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));r("rGqo"),r("a1Th"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));class a extends n.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var r=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(r=>r+":"+t[e][r]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${r}} @keyframes ${e} {${r}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,r=e.color,a=e.size,i=e.duration,s=e.strokeWidth,c=e.className,u=this.id,l=this.offset,d=this.animation,f=Object(o.classNames)("Spinner",c);return n.createElement("div",{className:f,style:t},n.createElement("svg",{className:"Spinner__svg",width:a,height:a,viewBox:`0 0 ${a} ${a}`,xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{style:{width:a,height:a,transformOrigin:.5*a+"px "+.5*a+"px"}},n.createElement("style",{dangerouslySetInnerHTML:{__html:d}}),n.createElement("circle",{className:"Spinner__path",fill:"none",stroke:r,strokeDasharray:l,strokeDashoffset:l,strokeWidth:s,style:{animationName:"dash"+u,animationTimingFunction:"ease-in-out",animationDuration:i+"s",animationIterationCount:"infinite"},cx:.5*a,cy:.5*a,r:.5*a-.5*s}))))}}a.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,a,i,s){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,n,o,a,i,s],l=0;(c=new Error(t.replace(/%s/g,(function(){return u[l++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},SLVX:function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",(function(){return n}))},TBLV:function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=e=>{var t=e.className,r=e.children,s=i(e,["className","children"]),c=Object(o.classNames)("Radio",t,{"Radio--disabled":e.disabled});return n.createElement("label",{className:c},n.createElement("input",a({className:"Radio__input Radio__visuallyHidden",type:"radio"},s)),n.createElement("span",{className:"Radio__control"}),Boolean(r)&&n.createElement("span",{className:"Radio__text"},r))};s.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=s},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,o=!1;return function a(){if(o)return r=arguments,void(n=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,r&&(a.apply(n,r),r=n=null)}),t)}}r.r(t),r.d(t,"throttle",(function(){return n}))},WfVW:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("JHWP")),i=n(r("D2Nl"));function s(e,t){return e instanceof Element?Promise.resolve(e).then((function(e){return function(e,t){var r=e.style.getPropertyValue("background");return r?Promise.resolve(r).then((function(e){return i.default(e,null,t)})).then((function(t){return e.style.setProperty("background",t,e.style.getPropertyPriority("background")),e})):Promise.resolve(e)}(e,t)})).then((function(e){return function(e,t){return e instanceof HTMLImageElement&&!o.isDataUrl(e.src)?Promise.resolve(e.src).then((function(e){return a.default(e,t)})).then((function(t){return o.toDataURL(t,o.getMimeType(e.src))})).then((function(t){return new Promise((function(r,n){e.onload=r,e.onerror=n,e.src=t}))})).then((function(){return e}),(function(){return e})):Promise.resolve(e)}(e,t)})).then((function(e){return function(e,t){var r=o.toArray(e.childNodes).map((function(e){return s(e,t)}));return Promise.all(r).then((function(){return e}))}(e,t)})):Promise.resolve(e)}t.default=s},XpgC:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("91GP");var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("pemR")),i=r("clTp");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=e=>{var t=e.position,r=e.align,n=e.text,o=e.rect,a=e.marginTop,i=e.marginLeft,s=e.maxWidth,c=e.appearance,u=e.className,l=o.left,d=o.top;switch(t){case"t":l+=.5*o.width;break;case"r":l+=o.width,d+=.5*o.height;break;case"b":l+=.5*o.width,d+=o.height;break;case"l":d+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:l=Math.round(l+i),y:d=Math.round(d+a),maxWidth:s,appearance:c,className:u}}};class u extends n.Component{constructor(e){super(e),this.onMouseEnter=e=>{if(this.state.el){var t=this.props,r=t.text,n=t.position,o=t.align,a=t.marginTop,s=t.marginLeft,c=t.maxWidth,u=t.appearance,l=t.className,d=Object(i.default)(this.state.el);this.update({text:r,position:n,align:o,rect:d,marginTop:a,marginLeft:s,maxWidth:c,appearance:u,className:l})}},this.onMouseLeave=e=>this.update(),this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.tooltip&&this.setState({tooltip:void 0})},this.renderTooltip=()=>{if(!this.state.tooltip)return null;var e=this.state.tooltip,t=e.x,r=e.y,o=e.position,i=e.align,s=e.text,c=e.removed,u=e.maxWidth,l=e.appearance,d=e.className,f=Object(a.classNames)("Tooltip","Tooltip--"+o,"Tooltip--"+l,{"Tooltip--removed":!!c,["Tooltip--align-"+i]:"t"===o||"b"===o},d);return n.createElement("div",{className:f,style:{top:r,left:t},onTransitionEnd:this.onTransitionEnd},n.createElement("div",{className:"Tooltip__in",style:{maxWidth:u},dangerouslySetInnerHTML:{__html:s}}))},this.state={}}componentDidMount(){var e=o.findDOMNode(this);this.setState({el:e}),e.addEventListener("mouseenter",this.onMouseEnter),e.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.state.el.removeEventListener("mouseenter",this.onMouseEnter),this.state.el.removeEventListener("mouseleave",this.onMouseLeave)}static getDerivedStateFromProps(e,t){return t.tooltip&&["text","position","align","maxWidth","appearance"].some(r=>e[r]!==t.tooltip[r])?c(s({},e,{rect:Object(i.default)(t.el)})):null}update(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(c(e))}render(){var e=this.renderTooltip();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),n.createElement(n.Fragment,null,this.props.children,o.createPortal(e,this.defaultNode))):this.props.children}}u.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"}},Ya8i:function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("D2Nl"));function i(e){if(void 0===e)return[];var t=e,r=[],n=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi");t=t.replace(n,"");for(var o,a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(o=a.exec(t));)r.push(o[0]);t=t.replace(a,"");for(var i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");null!==(o=i.exec(t));)r.push(o[0]);return r}function s(e,t){return fetch(e).then((function(t){return{url:e,cssText:t.text()}}),(function(e){console.log("ERROR FETCHING CSS: ",e.toString())}))}function c(e){return e.cssText.then((function(t){var r=t,n=(r.match(/url\([^)]+\)/g)||[]).map((function(t){var n=t.replace(/url\(([^]+)\)/g,"$1");if(!n.startsWith("https://")){var o=e.url;n=new URL(n,o).href}return new Promise((function(e,o){fetch(n).then((function(e){return e.blob()})).then((function(n){var o=new FileReader;o.addEventListener("load",(function(n){r=r.replace(t,"url("+o.result+")"),e([t,o.result])})),o.readAsDataURL(n)})).catch(o)}))}));return Promise.all(n).then((function(){return r}))}))}function u(e){var t=[],r=[];return e.forEach((function(t){if("cssRules"in t)try{o.toArray(t.cssRules).forEach((function(e){e.type===CSSRule.IMPORT_RULE&&r.push(s(e.href).then(c).then((function(e){i(e).forEach((function(e){t.insertRule(e,t.cssRules.length)}))})).catch((function(e){console.log("Error loading remote css",e.toString())})))}))}catch(o){var n=e.find((function(e){return null===e.href}))||document.styleSheets[0];null!=t.href&&r.push(s(t.href).then(c).then((function(e){i(e).forEach((function(e){n.insertRule(e,t.cssRules.length)}))})).catch((function(e){console.log("Error loading remote stylesheet",e.toString())}))),console.log("Error inlining remote css file",o.toString())}})),Promise.all(r).then((function(){return e.forEach((function(e){if("cssRules"in e)try{o.toArray(e.cssRules).forEach((function(e){t.push(e)}))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}})),t}))}function l(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return a.shouldEmbed(e.style.getPropertyValue("src"))}))}function d(e){return new Promise((function(t,r){e.ownerDocument||r(new Error("Provided element is not within a Document")),t(o.toArray(e.ownerDocument.styleSheets))})).then(u).then(l)}t.parseWebFontRules=d,t.default=function(e,t){return d(e).then((function(e){return Promise.all(e.map((function(e){var r=e.parentStyleSheet?e.parentStyleSheet.href:null;return a.default(e.cssText,r,t)})))})).then((function(e){return e.join("\n")})).then((function(t){var r=document.createElement("style"),n=document.createTextNode(t);return r.appendChild(n),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e}))}},bCCX:function(e,t,r){"use strict";r.r(t),function(e,n){var o,a=r("SLVX");o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var i=Object(a.default)(o);t.default=i}.call(this,r("yLpj"),r("3UD+")(e))},clTp:function(e,t,r){"use strict";function n(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,a=window.pageXOffset||n.scrollLeft||r.scrollLeft,i=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+o-i),left:Math.round(t.left+a-s),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",(function(){return n}))},dI71:function(e,t,r){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.r(t),r.d(t,"default",(function(){return n}))},mYgU:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r("yOtm")),a=n(r("Ya8i")),i=n(r("WfVW")),s=n(r("xkiS")),c=n(r("t0N9")),u=r("Iwry");function l(e,t){return void 0===t&&(t={}),{width:t.width||u.getNodeWidth(e),height:t.height||u.getNodeHeight(e)}}function d(e,t){void 0===t&&(t={});var r=l(e,t),n=r.width,u=r.height;return o.default(e,t.filter,!0).then((function(e){return a.default(e,t)})).then((function(e){return i.default(e,t)})).then((function(e){return c.default(e,t)})).then((function(e){return s.default(e,n,u)}))}function f(e,t){return void 0===t&&(t={}),d(e,t).then(u.createImage).then(u.delay(100)).then((function(r){var n=document.createElement("canvas"),o=n.getContext("2d"),a=u.getPixelRatio(),i=l(e,t),s=i.width,c=i.height;return n.width=s*a,n.height=c*a,n.style.width=""+s,n.style.height=""+c,o.scale(a,a),t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,n.width,n.height)),o.drawImage(r,0,0),n}))}function p(e,t){void 0===t&&(t={});var r=l(e,t),n=r.width,o=r.height;return f(e,t).then((function(e){return e.getContext("2d").getImageData(0,0,n,o).data}))}function h(e,t){return void 0===t&&(t={}),f(e,t).then((function(e){return e.toDataURL()}))}function y(e,t){return void 0===t&&(t={}),f(e,t).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))}function m(e,t){return void 0===t&&(t={}),f(e,t).then(u.canvasToBlob)}t.toSvgDataURL=d,t.toCanvas=f,t.toPixelData=p,t.toPng=h,t.toJpeg=y,t.toBlob=m,t.default={toSvgDataURL:d,toCanvas:f,toPixelData:p,toPng:h,toJpeg:y,toBlob:m}},qJhe:function(e,t,r){"use strict";r.r(t),r.d(t,"StoryPublisher",(function(){return v}));var n,o=r("q1tI"),a=r("i8i4"),i=r("0fW4"),s=r("jE6c"),c=r("EasH"),u=r("6krn"),l=r("3oLO"),d=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),f=r("r7nW").default,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var r=e||Object(u.getLang)("global_error");window.showFastBox({title:Object(u.getLang)("global_error")},r,Object(u.getLang)("global_close"),(function(){t(),window.curBox().hide()}))},t.save=function(e,r,n){void 0===n&&(n={}),t.props.onClickSave(),l.ajax.post("al_stories.php",{act:"get_upload_url",attachment:JSON.stringify(t.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:t.props.miniAppId,analytics:n.analytics,hash:n.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},{onDone:function(o){t.sendToServer(e,o,n.storySaveHash,r)},onFail:function(e){return t.errorHandler(e,r),!0}})},t.sendToServer=function(e,r,n,o){var a=new FormData,i=encodeURIComponent("edited_"+Object(s.irand)(0,99999)+".jpg");a.append("file0",e,i),fetch(r,{method:"POST",body:a}).then((function(e){return e.json()})).then((function(e){var r=e.response.upload_result;t.saveOnServer(r,n,o)})).catch((function(e){console.error(e)}))},t.saveOnServer=function(e,r,n){l.ajax.post("al_stories.php",{act:"save",upload_result:e,hash:r},{onDone:function(e){t.onClose(!0,!1,e),n()},onFail:function(){return t.errorHandler("",n),!0}})},t.onClose=function(e,r,n){r?t.props.onClose(!1):e?(window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,n)):t.box?(t.box.hide(),delete t.box):t.box=Object(c.showFastBox)({title:Object(u.getLang)("photos_pe_are_you_sure_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(u.getLang)("photos_pe_are_you_sure_close_text"),Object(u.getLang)("box_yes"),(function(){t.props.onClose(!1),t.box.hide()}),Object(u.getLang)("box_no"))},t}return d(t,e),t.prototype.render=function(){var e=this,t=window.innerHeight-100,r=t/1.78;return o.createElement(f,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},o.createElement(i.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:r,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers}))},t}(o.Component),h=r("ufMw"),y=r("kcIO"),m=r("4+be"),v={init:function(e,t,r){var n=this;this.onClickSave=t||function(){},this.cb=r,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?Object(h.sendStat)(h.EVENTS.ADD_STORY_FROM_SHARING):Object(h.sendStat)(h.EVENTS.ADD_STORY);var n=document.querySelector(".StoryPublisher");n||((n=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(n)),a.render(o.createElement(p,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers}),n)},destroy:function(e,t){var r=document.querySelector(".StoryPublisher");r&&a.unmountComponentAtNode(r),this.cb&&this.cb(e,t),e&&Object(y.showDoneBox)(Object(m.getLang)("photos_pe_story_published"))}}},qT12:function(e,t,r){"use strict";var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,c=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,f=n?Symbol.for("react.concurrent_mode"):60111,p=n?Symbol.for("react.forward_ref"):60112,h=n?Symbol.for("react.suspense"):60113,y=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,_=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,E=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case d:case f:case i:case c:case s:case h:return e;default:switch(e=e&&e.$$typeof){case l:case p:case v:case m:case u:return e;default:return t}}case a:return t}}}function S(e){return w(e)===f}t.AsyncMode=d,t.ConcurrentMode=f,t.ContextConsumer=l,t.ContextProvider=u,t.Element=o,t.ForwardRef=p,t.Fragment=i,t.Lazy=v,t.Memo=m,t.Portal=a,t.Profiler=c,t.StrictMode=s,t.Suspense=h,t.isAsyncMode=function(e){return S(e)||w(e)===d},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===l},t.isContextProvider=function(e){return w(e)===u},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return w(e)===p},t.isFragment=function(e){return w(e)===i},t.isLazy=function(e){return w(e)===v},t.isMemo=function(e){return w(e)===m},t.isPortal=function(e){return w(e)===a},t.isProfiler=function(e){return w(e)===c},t.isStrictMode=function(e){return w(e)===s},t.isSuspense=function(e){return w(e)===h},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===f||e===c||e===s||e===h||e===y||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===m||e.$$typeof===u||e.$$typeof===l||e.$$typeof===p||e.$$typeof===_||e.$$typeof===b||e.$$typeof===E||e.$$typeof===g)},t.typeOf=w},r7nW:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("pemR"));class i extends n.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+r+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(a.classNames)("BaseModal",e);return n.createElement("div",{className:t,"aria-modal":"true"},n.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),n.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return o.createPortal(this.renderModal(),document.body)}}i.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=i},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},t0N9:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e.style;return t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=t.width+"px"),t.height&&(r.height=t.height+"px"),t.style&&Object.assign(r,t.style),e}},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",(function(){return s})),r.d(t,"sendStat",(function(){return c})),r.d(t,"prepareStat",(function(){return u}));var n=r("1y80"),o=r("98sY"),a=r("xYVc"),i=r("W9Tc"),s={ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",CANCEL_GRAFFITI:"cancel_graffiti",SELECT_BACKGROUND:"select_background"};function c(e){if(window.cur.storyPublishContext){var t={event_type:e,story_type:"photo"};Object(i.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(t),Object(n.statlogsValueEvent)("story_create_product_analytics",t)}}function u(e,t,r,n){var o=0,i="photo";r===a.default.BACKGROUND_MODES.BACKGROUND&&(i=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:i,background_id:o},c=[],u=[],l=[];return e.forEach((function(e){if(e.type===a.default.LAYER_TYPES.STICKER){var t=(i=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);c.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===a.default.LAYER_TYPES.TEXT){var i=e;u.push({text:i.text,font:i.fontStyle,size:Math.round(i.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:i.color.slice(1),background:"none",align:"center"})}})),u.length&&(s.has_text=1,s.texts=u),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach((function(e){l.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),l.length&&(s.has_graffiti=1,s.graffities=l),s}},vRp6:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf");var n=r("q1tI"),o=(r("17x9"),r("UlUB")),a=r("PjZB"),i=r("pemR");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class u extends n.Component{constructor(e){super(e),this.checkLoad=Object(o.throttle)(e=>{var t=s(e,3),r=t[0],n=t[1],o=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(n-r-o<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var r=this.state,n=this.getChildrenData(e,t||this.getScrollData()),o=n.start,a=n.end,i=n.before,s=n.after;o===r.start&&a===r.end&&i===r.before&&s===r.after||this.setState(n)}getChildrenData(e,t){var r=s(t,3),n=r[0],o=r[1],a=r[2],i=this.useWindowScroll?window:this.container,c=i&&i.offsetHeight;if(!i||0===o||0===a)return{start:0,end:0,before:0,after:e.length};a=Math.max(a,c);var u=e.length,l=Math.max(Math.floor(n/this.props.itemHeight)-1,0),d=Math.min(Math.floor((n+2*a)/this.props.itemHeight+1),u);return{start:l,end:d,before:l,after:u-d}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return n.createElement("div",{className:Object(i.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&n.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&n.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||n.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},n.createElement(a.default,null))))}}u.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vTYg:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");function o(e,t,r){var o="."+e+":"+t,a=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return n.toArray(e).map((function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")+";"})).join(" ")}(r);return document.createTextNode(o+"{"+a+"}")}t.default=function(e,t){[":before",":after"].forEach((function(r){return function(e,t,r){var a=window.getComputedStyle(e,r),i=a.getPropertyValue("content");if(""!==i&&"none"!==i){var s=n.uuid(),c=document.createElement("style");c.appendChild(o(s,r,a)),t.className=t.className+" "+s,t.appendChild(c)}}(e,t,r)}))}},wx14:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.r(t),r.d(t,"default",(function(){return n}))},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3");t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#E64646","#FF9300","#FFCB00","#62DA37","#00AEF9","#CC74E1"],FONTS:["classic","cursive","marker","italics","typewriter","poster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"}}},xkiS:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");t.default=function(e,t,r){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),i=document.createElementNS(o,"foreignObject");return a.setAttributeNS("","width",""+t),a.setAttributeNS("","height",""+r),i.setAttributeNS("","width","100%"),i.setAttributeNS("","height","100%"),i.setAttributeNS("","x","0"),i.setAttributeNS("","y","0"),i.setAttributeNS("","externalResourcesRequired","true"),a.appendChild(i),i.appendChild(e),n.svgToDataURL(a)}},yOtm:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("vTYg"));function i(e){return e instanceof HTMLCanvasElement?o.createImage(e.toDataURL()):e.tagName&&"svg"===e.tagName.toLowerCase()?Promise.resolve(e).then((function(e){return o.svgToDataURL(e)})).then(o.createImage):Promise.resolve(e.cloneNode(!1))}function s(e,t){return t instanceof Element?Promise.resolve().then((function(){return function(e,t){var r=window.getComputedStyle(e),n=t.style;r.cssText?n.cssText=r.cssText:o.toArray(r).forEach((function(e){n.setProperty(e,r.getPropertyValue(e),r.getPropertyPriority(e))}))}(e,t)})).then((function(){return a.default(e,t)})).then((function(){return function(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}(e,t)})).then((function(){return t})):t}function c(e,t,r){return r||!t||t(e)?Promise.resolve(e).then(i).then((function(r){return function(e,t,r){var n=o.toArray(e.childNodes);return 0===n.length?Promise.resolve(t):n.reduce((function(e,n){return e.then((function(){return c(n,r)})).then((function(e){e&&t.appendChild(e)}))}),Promise.resolve()).then((function(){return t}))}(e,r,t)})).then((function(t){return s(e,t)})):Promise.resolve(null)}t.default=c},zLVn:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}r.r(t),r.d(t,"default",(function(){return n}))}});