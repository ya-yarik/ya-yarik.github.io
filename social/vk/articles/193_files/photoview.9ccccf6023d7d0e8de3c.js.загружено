(()=>{"use strict";var __webpack_modules__={664547:(e,t,o)=>{function r(){return{icon:'<svg width="12" height="16" viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg"><g id="chevron_16__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="chevron_16__chevron_16"><path id="chevron_16__Bounds" d="M0 0h12v16H0z"/><path d="M7.23 8L3.86 4.64a.9.9 0 111.28-1.28l4 4a.9.9 0 010 1.28l-4 4a.9.9 0 11-1.28-1.28L7.23 8z" id="chevron_16__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"chevron_16"}}o.d(t,{getIcon16Chevron:()=>r})},732553:(e,t,o)=>{function r(){return{icon:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0a4 4 0 014 4h1.4c.55 0 .76.06.96.17.2.1.36.27.47.47.11.2.17.4.17.96v5.23c0 1.45-.15 1.98-.43 2.5-.29.54-.7.95-1.23 1.24-.53.28-1.06.43-2.5.43H5.16c-1.45 0-1.98-.15-2.5-.43-.54-.29-.95-.7-1.24-1.23-.28-.53-.43-1.06-.43-2.5V5.6c0-.55.06-.76.17-.96.1-.2.27-.36.47-.47.2-.11.4-.17.96-.17H4a4 4 0 014-4zM4.77 5.5h-.04a.82.82 0 00-.4.09.6.6 0 00-.24.24.82.82 0 00-.09.4v.04c0 .17.03.3.09.4.05.1.14.19.24.24.1.06.23.09.4.09h.04c.17 0 .3-.03.4-.09a.6.6 0 00.24-.24c.06-.1.09-.23.09-.4v-.04a.82.82 0 00-.09-.4.6.6 0 00-.24-.24.82.82 0 00-.4-.09zm6.5 0h-.04a.82.82 0 00-.4.09.6.6 0 00-.24.24.82.82 0 00-.09.4v.04c0 .17.03.3.09.4.05.1.14.19.24.24.1.06.23.09.4.09h.04c.17 0 .3-.03.4-.09a.6.6 0 00.24-.24c.06-.1.09-.23.09-.4v-.04a.82.82 0 00-.09-.4.6.6 0 00-.24-.24.82.82 0 00-.4-.09zM8 1.5A2.5 2.5 0 005.5 4h5A2.5 2.5 0 008 1.5z" fill="currentColor"/></svg>',name:"market_16"}}o.d(t,{getIcon16Market:()=>r})},362856:(e,t,o)=>{var r=o(760050);window.Photoview=r.Photoview;try{stManager.done(jsc("web/photoview.js"))}catch(e){}},376690:(e,t,o)=>{o.d(t,{default:()=>s});o(66108),o(296253);var r=o(414914),a=o(917685),_=o(927663),i={init:function(e,t){cur.lSTL&&(0,r.re)(cur.lSTL);var o=(t=t||{}).parent=t.parent||boxLayerWrap;extend(cur,{lSTLWrap:o,lSTL:o.appendChild(ce("div",{id:"layer_stl",innerHTML:`<div id="layer_stl_bg" class="fixed"></div><div id="layer_stl_cl"></div><nobr id="layer_stl_text" class="fixed">${getLang("global_to_top")}</nobr>`,el:e.bodyNode,onclick:a.cancelEvent,onmousedown:i.lSTLDown,sc:i.onScroll})),lSTLText:ge("layer_stl_text",o),lSTLShown:0,lSTLWas:0,lSTLWasSet:0,lSTLOpts:t}),e&&e.setOptions({onShow:i.show,onHide:i.hide}),e&&e.scrollInited||(addEvent(o,"scroll",i.onScroll),e&&(e.scrollInited=!0)),onBodyResize(),i.onScroll()},hide:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=cur.lSTLOpts;e&&e.parent&&(removeEvent(e.parent,"scroll",i.onScroll),hide(cur.lSTL),cur.lSTLShown=0,e.onHide&&e.onHide())})),show:function(){var e=cur.lSTLOpts;e&&e.parent&&(addEvent(e.parent,"scroll",i.onScroll),setTimeout(i.onScroll,0),e.onShow&&e.onShow())},lSTLDown:function(e){if(e=e||window.event,!(0,a.checkEvent)(e)){var t=cur.lSTLWrap;if(!__afterFocus){var o=0,r=t.scrollTop;cur.lSTLWasSet&&cur.lSTLWas?(o=cur.lSTLWas,cur.lSTLWas=0):cur.lSTLWas=r,t.scrollTop=o}return(0,a.cancelEvent)(e)}},onScroll:function(){if(cur.lSTL){var e=cur.lSTLWrap.scrollTop,t=200,o=cur.lSTLWas||e>t,a=0;if(cur.lSTL.style.marginTop=Math.min(e,boxLayer.scrollHeight-cur.lSTL.scrollHeight-1)+"px",vk.staticheader){var i=(0,r.getSize)("page_header_wrap")[1];cur.lSTLText.style.marginTop=Math.max(-Math.min((0,_.scrollGetY)(),bodyNode.clientHeight-(window.lastWindowHeight||0)),-i)+"px"}o?(1!==cur.lSTLShown&&((0,r.show)(cur.lSTL),cur.lSTLShown=1),cur.lSTLWas&&e>500&&(cur.lSTLWas=0),e>t?(a=(e-t)/t,cur.lSTLWasSet&&(cur.lSTLWasSet=0,val((0,r.domLC)(cur.lSTL),getLang("global_to_top")),removeClass((0,r.domLC)(cur.lSTL),"down"))):(a=(t-e)/t,cur.lSTLWas&&(cur.lSTLWasSet||(cur.lSTLWasSet=1,val((0,r.domLC)(cur.lSTL),""),addClass((0,r.domLC)(cur.lSTL),"down"))))):0!==cur.lSTLShown&&(hide(cur.lSTL),cur.lSTLShown=0),setStyle(cur.lSTL,{opacity:Math.min(Math.max(a,0),1)})}}};const s=i},76691:(e,t,o)=>{o.d(t,{default:()=>p});o(530522),o(991181),o(579665),o(95767),o(59357),o(976142),o(66108),o(296253);var r=o(830242);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],r=!0,a=!1,_=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(o.push(i.value),!t||o.length!==t);r=!0);}catch(e){a=!0,_=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw _}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var i="friends_dropdown__list_item",s="friends_dropdown__list_item system_message",n="add_term_tag";const p=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=extend({onUserSelected:()=>!1,onEscapePress:()=>!1,onKeyUp:()=>!1},e),cur.pvServerFriendsIndex&&cur.pvServerFriendsIds||(cur.pvServerFriendsIndex=new vkIndexer([],(e=>{var t=a(e,2);t[0];return t[1]})),cur.pvServerFriendsIds=[]),this.topUsers=new vkIndexer([],(e=>{var t=a(e,2);t[0];return t[1]})),this.isInited=!1,this.lastSeachTerm="",this.hoverItem=null,this.keyboardNavigation=!1,this.freeTerm=null,this._handleInputKeyEvent=this._handleInputKeyEvent.bind(this),this._handleMouseMoveOnce=this._handleMouseMoveOnce.bind(this)}init(){this.isInited&&this.friendsdListNode||((0,r.getIndexedFriends)()||this.fetchFriendsList(),this.isInited=!0,this._initElement(),this._initScroll());return this.friendsdListNode}update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._resetScroll(),this.setTopUsers(e),this._hideDropdown()}setTopUsers(e){this.topUsers.list.forEach((e=>{this.topUsers.remove(e)})),e.forEach((e=>{this.topUsers.add(e)})),this.topUsers.list=e}_hideDropdown(){removeClass(this.friendsdListNode,"show-dropdown")}_getItemHtml(e,t,o,r){return`<div class="${i}" data-id="${e}" data-name="${t}">\n      <img src="${r}" alt="${t}" class="friends_dropdown__list_image">\n      <div class="friends_dropdown__list_info">\n        <div class="friends_dropdown__list_name">${t} ${e===vk.id.toString()?`(${getLang("photos_tags_user_you")})`:""}</div>\n        <div class="friends_dropdown__list_label">${o}</div>\n      </div>\n    </div>`}_initElement(){this.friendsdListNode=ce("div",{className:"friends_dropdown__list"}),this.listInput=ce("input",{className:"friends_dropdown__list_input",placeholder:`${replaceEntities(getLang("photos_tags_dropdown_placeholder"))}`}),this.listDropdown=ce("div",{className:"friends_dropdown__list_dropdown"}),this.listContent=ce("div",{className:"friends_dropdown__list_content"}),this.listDropdown.appendChild(this.listContent),this.friendsdListNode.appendChild(this.listInput),this.friendsdListNode.appendChild(this.listDropdown),this._setListHTML(`<div class="${s}">${getLang("box_loading")}</div>`),addEvent(this.friendsdListNode,"click",cancelEvent),addEvent(this.listDropdown,"click",(e=>{this._handleItemSelected(e.target)})),addEvent(this.listDropdown,"mouseover",(e=>{if(!this.keyboardNavigation){var t=hasClass(e.target,i)?e.target:gpeByClass(i,e.target);this._setHoverItem(t)}})),addEvent(this.listInput,"keyup keydown keypress",this._handleInputKeyEvent),addEvent(this.listInput,"click",(()=>{this.show()}))}_handleItemSelected(e){var t=hasClass(e,i)?e:gpeByClass(i,e),o=domData(t,"name"),r=domData(t,"id");r&&this.options.onUserSelected(r,o),hasClass(e,n)&&this.freeTerm&&this.options.onUserSelected(0,this.freeTerm)}_getItemEleById(e){return window.domQuery1(`[data-id="${e}"]`,this.listDropdown)}_setListHTML(e){(this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent).innerHTML=e}_setHoverItem(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=domData(e,"id");if(o&&o!==this.hoverItem){if(this.hoverItem){var r=this._getItemEleById(this.hoverItem);removeClass(r,"hover")}this.hoverItem=o,addClass(e,"hover"),t&&this.scroll&&this.scroll&&this.scroll.scrollIntoView(e)}}show(e){hasClass(this.friendsdListNode,"show-dropdown")||(this._renderFriendsList(this.lastSeachTerm,e),addClass(this.friendsdListNode,"show-dropdown"),this._resetScroll(),this.scroll&&this.scroll.update())}_renderFriendsList(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e=trim(e),(0,r.getIndexedFriends)()){var o=this._doSearch(e);this._renderFriendsDropdown(e,o,t)}else this._setListHTML(`<div class="${s}">${getLang("box_loading")}</div>`);clearTimeout(this.requestTimeout),e.length>0&&e!==this.lastSeachTerm&&(this.requestTimeout=setTimeout((()=>{this.fetchFriendsWithQuery(e)}),300))}_initScroll(){browser.safari||stManager.add(["ui_common.css","ui_common.js"],(()=>{this.scroll=new window.uiScroll(this.listContent,{global:!0})}))}_handleInputKeyEvent(e){if("keyup"===e.type){switch(e.keyCode){case KEY.ENTER:this._handleEnter();break;case KEY.ESC:return this.options.onEscapePress(),void this._hideDropdown();default:var t=e&&e.target.value;t!==this.lastSeachTerm&&(this._renderFriendsList(t),this.lastSeachTerm=t,this.hoverItem=null)}this.options.onKeyUp(),this.show()}else switch(e.keyCode){case KEY.UP:case KEY.DOWN:this._handleArrows(e.keyCode===KEY.DOWN)}}_handleArrows(){var e,t,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.keyboardNavigation||(this.keyboardNavigation=!0,addEvent(this.listDropdown,"mousemove",this._handleMouseMoveOnce)),this.hoverItem)e=this._getItemEleById(this.hoverItem),t=o?domNS(e):domPS(e);else{var r=this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent;t=domFC(r)}t&&this._setHoverItem(t,!0)}_handleMouseMoveOnce(){this.keyboardNavigation=!1,removeEvent(this.listDropdown,"mousemove",this._handleMouseMoveOnce)}_handleEnter(){if(this.hoverItem){var e=this._getItemEleById(this.hoverItem);this._handleItemSelected(e)}}_doSearch(){var e,t,o,_,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=(0,r.getPhotoData)("tagged"),n=(0,r.getIndexedFriends)();i.length>0?(t=this.topUsers.search(i),o=n.search(i),_=cur.pvServerFriendsIndex.search(i)):(t=this.topUsers.list,o=n.list,_=cur.pvServerFriendsIndex.list),e=t.concat(o,_);var p=[];return(e=e.filter((e=>{var t=a(e,1)[0],o=p.indexOf(t)<0&&(!s||!s[t]);return p.push(t),o}))).length>20&&(e=e.slice(0,20)),e}_renderFriendsDropdown(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";if(t.forEach((e=>{var t=a(e,4),o=t[0],_=t[1],i=t[2],s=t[3],n=`id${o}`;r+=this._getItemHtml(o,_,i,s,n)})),!r&&o){this.freeTerm=e,e=clean(e);var _=getLang("photos_tags_not_found_tag_text").replace("{tagName}",`<span class="add_term_tag">${e}</span>`);r=`<div class="${s}">${_}</div>`,this._setListHTML(r)}else r&&(this._setListHTML(r),this.freeTerm=null,this._resetScroll());this.hoverItem=null}focus(){this.listInput.focus()}reset(){this.listInput.value="",this.lastSeachTerm="",this.hoverItem=null,this._resetScroll()}_resetScroll(){this.scroll?this.scroll.scrollTop():this.listContent.scrollTop=0}fetchFriendsList(){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags"},{onDone:e=>{(0,r.setIndexedFriends)(e,(()=>{this._renderFriendsList(this.lastSeachTerm)}))}})}fetchFriendsWithQuery(e){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags",str:e,photo:(0,r.getPhotoData)("id")},{onDone:t=>{this._handleFetchFriends(e,t)}})}_handleFetchFriends(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.lastSeachTerm===e){var o,_=0,i=(0,r.getPhotoData)("tagged");(o=i?t.filter((e=>{var t=a(e,1)[0];return!i[t]})):t).forEach((e=>{var t=e[0];cur.pvServerFriendsIds.indexOf(t)<0&&(cur.pvServerFriendsIds.push(t),cur.pvServerFriendsIndex.add(e),_++)})),(_>0||0===o.length)&&this._renderFriendsList(e,!0)}}}},772200:(e,t,o)=>{o.d(t,{FullscreenPV:()=>a});o(21466);var r=o(414914),a={init(){if(cur.pvCanvas&&!cur.pvFSControls){var e=positive(getCookie("remixfsss")),t=Math.min(positive(getCookie("remixfsdt"))||5,15);cur.pvFSControls=cur.pvCanvas.appendChild((0,r.ce)("div",{id:"pv_fs_controls",innerHTML:`\n<div id="pv_fs_topright" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_num"></div>\n      </td>\n      <td>\n        <div id="pv_fs_close" onclick="Photoview.fullscreenStop()">\n          <div id="pv_fs_close_btn"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_bottomleft" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_slide_check" onclick="FullscreenPV.startSlide()">\n          <div class="pv_fs_slide_check_icon"></div>${getLang("photos_slideshow")}\n        </div>\n      </td>\n      <td>\n        <div id="pv_fs_slide_speed_wrap">\n          <div id="pv_fs_slide_about"></div>\n          <div id="pv_fs_slide_speed" onmousedown="FullscreenPV.startSlideEdit(event)">\n            <div id="pv_fs_slide_speed_back"></div>\n            <div id="pv_fs_slide_speed_line">\n              <div id="pv_fs_slide_speed_ctrl"></div>\n            </div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_left_wrap" class="pv_fs_controls">\n  <div id="pv_fs_left"></div>\n</div>\n\n<div id="pv_fs_right_wrap" class="pv_fs_controls">\n  <div id="pv_fs_right"></div>\n</div>\n`,onmouseover:a.over,onmouseout:a.out})),extend(cur,{pvFSInfo:(0,r.ge)("pv_fs_num"),pvFSSlideCheck:(0,r.ge)("pv_fs_slide_check"),pvFSSlideSpeedWrap:(0,r.ge)("pv_fs_slide_speed_wrap"),pvFSSlideLine:(0,r.ge)("pv_fs_slide_speed_line"),pvFSSlideAbout:(0,r.ge)("pv_fs_slide_about"),pvFSSlideCont:(0,r.ge)("pv_fs_bottomleft"),pvFSSlideDelta:t,pvFSLeft:(0,r.ge)("pv_fs_left"),pvFSRight:(0,r.ge)("pv_fs_right")}),cur.pvFSSlideLine.style.width=Math.floor(100*(t-1)/14)+"%",(0,r.val)(cur.pvFSSlideAbout,getLang("photos_seconds",t)),e&&(0,r.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),a.slide(),addEvent(cur.pvCanvas,"mousemove",a.showControls),addEvent(cur.pvCanvas,"mousedown",a.onClick),addEvent(cur.pvCanvas,"mouseup",a.endSlideEdit),a.showControls(!0),cur.pvPhoto.blur(),a.updateInfo()}},over(e){var t=e||window.event,o=t.target||t.srcElement||document;cur.pvFSOver=!o.id.match(/^pv_fs_(left|right)(_wrap)?$/)},out(){cur.pvFSOver=!1},onClick:e=>(__afterFocus||e&&(2==e.button||3==e.which)||(0,r.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSLeftShown?Photoview.show(cur.pvListId,cur.pvIndex-1):cur.pvFSRightShown&&Photoview.show(cur.pvListId,cur.pvIndex+1)),!!e&&cancelEvent(e)),showControls(e){var t,o,_=cur.pvFSrX=e.pageX,i=cur.pvFSrY=e.pageY;cur.pvFSSlideEdit&&a.updateSlide(),void 0!==cur.pvFSX&&void 0!==cur.pvFSY&&Math.abs(_-cur.pvFSX)+Math.abs(i-cur.pvFSY)<4||(cur.pvFSControlsTimer||((0,r.removeClass)(cur.pvCanvas,"pv_fs_nocursor"),clearTimeout(cur.pvFSHideControlsTimer),(0,r.show)(cur.pvFSControls),(0,r.addClass)(cur.pvFSControls,"pv_fs_shown")),clearTimeout(cur.pvFSControlsTimer),cur.pvFSOver||cur.pvFSSlideEdit||(cur.pvFSControlsTimer=setTimeout(a.hideControls,3e3)),(t=!cur.pvFSOver&&(_<100||cur.pvFSWidth&&_<(cur.pvScrWidth-cur.pvFSWidth)/2))&&!cur.pvFSLeftShown?(0,r.addClass)(cur.pvFSLeft,"pv_fs_over"):!t&&cur.pvFSLeftShown&&(0,r.removeClass)(cur.pvFSLeft,"pv_fs_over"),cur.pvFSLeftShown=t,(o=!cur.pvFSOver&&!t)&&!cur.pvFSRightShown?(0,r.addClass)(cur.pvFSRight,"pv_fs_over"):!o&&cur.pvFSRightShown&&(0,r.removeClass)(cur.pvFSRight,"pv_fs_over"),cur.pvFSRightShown=o,cur.pvFSX=_,cur.pvFSY=i)},hideControls(){(0,r.addClass)(cur.pvCanvas,"pv_fs_nocursor"),(0,r.removeClass)(cur.pvFSControls,"pv_fs_shown"),clearTimeout(cur.pvFSHideControlsTimer),cur.pvFSHideControlsTimer=setTimeout(r.hide.pbind(cur.pvFSControls),300),cur.pvFSControlsTimer=!1},startSlide(){(0,r.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")?(clearTimeout(cur.pvFSTimer),(0,r.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),setCookie("remixfsss",0)):((0,r.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),a.slide(),setCookie("remixfsss",1),clearTimeout(cur.hideAboutTO),cur.hideAboutTO=setTimeout((function(){(0,r.removeClass)(cur.pvFSSlideAbout,"highlighted")}),3e3),(0,r.addClass)(cur.pvFSSlideAbout,"highlighted"))},updateSlide(){var e=Math.floor(15*Math.max(Math.min((vk.rtl?cur.pvFSrLeft+cur.pvFSrWidth-cur.pvFSrX:cur.pvFSrX-cur.pvFSrLeft)/cur.pvFSrWidth,.99),0))+1;cur.pvFSSlideDelta!=e&&(setCookie("remixfsdt",cur.pvFSSlideDelta=e),cur.pvFSSlideLine.style.width=Math.floor(100*(e-1)/14)+"%",(0,r.val)(cur.pvFSSlideAbout,getLang("photos_seconds",e)))},startSlideEdit(e){if(cur.pvFSrX&&cur.pvFSrY)return extend(cur,{pvFSSlideEdit:!0,pvFSrLeft:(0,r.getXY)((0,r.domPN)(cur.pvFSSlideLine))[0],pvFSrWidth:(0,r.getSize)((0,r.domPN)(cur.pvFSSlideLine))[0]}),(0,r.addClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),a.updateSlide(),clearTimeout(cur.pvFSTimer),cancelEvent(e||window.event)},endSlideEdit(){cur.pvFSSlideEdit&&(cur.pvFSSlideEdit=!1,(0,r.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),a.slide(),cur.pvFSOver||(clearTimeout(cur.pvFSControlsTimer),cur.pvFSControlsTimer=setTimeout(a.hideControls,3e3)))},slide(){clearTimeout(cur.pvFSTimer),!(0,r.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")||cur.pvFSSlideEdit||(0,r.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSTimer=setTimeout((function(){cur.pvSlideNeedAnimation=!0,Photoview.show(cur.pvListId,cur.pvIndex+1)}),1e3*cur.pvFSSlideDelta))},updateInfo(){var e=((cur.pvData||{})[cur.pvListId]||[]).length,t=cur.pvIndex+1;(0,r.val)(cur.pvFSInfo,t+" / "+e),(0,r.toggle)(cur.pvFSInfo,e>1),(e>1?r.removeClass:r.addClass)(cur.pvCanvas,"pv_fs_one")}};window.FullscreenPV=a},526224:(e,t,o)=>{o.d(t,{default:()=>h});o(530522),o(66108),o(579665),o(95767),o(751876),o(59357),o(991181),o(296253);var r=o(414914),a=o(791563),_=o(116886),i=o(924400),s=o(830242),n=o(775478),p=o(486353),d=o(713208);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],r=!0,a=!1,_=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(o.push(i.value),!t||o.length!==t);r=!0);}catch(e){a=!0,_=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw _}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var v="area_hover",u="visible_all";const h=class{constructor(e,t){this.imageNode=e,this.containerNode=t,this.activeAreaId=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this._handleImageMouseMove=this._handleImageMouseMove.bind(this),this._handleAreaClick=this._handleAreaClick.bind(this),this._removeActiveAreaAfterTimeout=this._removeActiveAreaAfterTimeout.bind(this),this._queueCheckUpdates=this._queueCheckUpdates.bind(this),this._queueReceiveUpdates=this._queueReceiveUpdates.bind(this),this._userSelectedCallback=this._userSelectedCallback.bind(this),this._handleSuggestionDeclined=this._handleSuggestionDeclined.bind(this),this.updatePhotoViewTags=this.updatePhotoViewTags.bind(this),this.deleteTag=this.deleteTag.bind(this),this._init(),this._queueCheckUpdates()}_init(){var e=(0,p.partConfigEnabled)("photo_recognition_web");this.photoTooltip=new i.default(window.layer,{onMouseLeave:this._removeActiveAreaAfterTimeout,onUserSelected:this._userSelectedCallback,onDeleteClicked:this.deleteTag,onEscapePressed:this._removeActiveAreaAfterTimeout,onSuggestionDeclined:this._handleSuggestionDeclined,hideAfterDecline:e}),this.photoView=window.Photoview,this.areasContainer=ce("div",{className:"photo_tags_suggested_areas_list"}),this.containerNode.innerHTML="",this.containerNode.appendChild(this.areasContainer),addEvent(this.imageNode,"mousemove",this._handleImageMouseMove),addEvent(this.imageNode,"mouseleave",this._removeActiveAreaAfterTimeout),addEvent(this.imageNode,"mouseenter",this.showAllSuggestedAreas.bind(this)),addEvent(this.areasContainer,"mouseleave",this._removeActiveAreaAfterTimeout),addEvent(this.areasContainer,"click",this._handleAreaClick),this.renderTagAreas()}_handleImageMouseMove(e){if(!this.areasHidden){var t=getXY(e.target),o=Math.round(100*(e.pageX-t[0])/e.target.offsetWidth),r=Math.round(100*(e.pageY-t[1])/e.target.offsetHeight);for(var a in clearTimeout(this.areasTimeOut),this.areasTimeOut=setTimeout((()=>{this.photoTooltip.isActive||this.activeAreaId||this.hideAllSuggestedAreas()}),700),this.showAllSuggestedAreas(),this.areas)if(this.areas.hasOwnProperty(a)){var _=this.areas[a],i=_.x,s=_.y,n=_.x2,p=_.y2;if(o>parseInt(i)&&o<parseInt(n)&&r>parseInt(s)&&r<parseInt(p)){if(a===this.activeAreaId)return void(this.tagAreaFound=!0);if(this.tagAreaFound=this.showTagArea(a),this.tagAreaFound)return}}this.tagAreaFound=!1,this._removeActiveAreaAfterTimeout()}}_handleAreaClick(e){cancelEvent(e),this.photoTooltip.showAndFocusFriendsList(e)}showTagArea(e){var t=this.areas[e];return!(!t||t.isDeleted)&&(null!==this.activeAreaId&&this.areas[this.activeAreaId]&&(0,r.removeClass)(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=e,(0,r.addClass)(this.areas[e].ele,"active"),this.showTooltip(e),this.showAllSuggestedAreas(),!0)}hideTagArea(){clearTimeout(this.waitTimeout),null!==this.activeAreaId&&this.areas[this.activeAreaId]&&(0,r.removeClass)(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=null,this.photoTooltip.hide(),this.hideAllSuggestedAreas()}_removeActiveAreaAfterTimeout(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.activeAreaId&&!this.waitToRemove&&(this.waitToRemove=!0,clearTimeout(this.waitTimeout),this.waitTimeout=setTimeout((()=>{!this.photoTooltip.isActive&&!this.tagAreaFound&&!this.photoTooltip.interaction&&this.hideTagArea(),this.waitToRemove=!1}),e))}showTooltip(e){if(!this.tooltipsPaused){var t=this.areas[e].ele,o=this._getTooltipOptions(e);if(t){var a=(0,r.getXYRect)(t,!0),_=a.top,i=a.right,s=a.bottom,n=a.left;this.photoTooltip.show({top:_,right:i,bottom:s,left:n},o)}}}showAllSuggestedAreas(){(0,r.addClass)(this.areasContainer,u),(0,r.removeClass)(this.areasContainer,v),this.activeAreaId&&(0,r.addClass)(this.areasContainer,v)}hideAllSuggestedAreas(){(0,r.removeClass)(this.areasContainer,u)}pauseTooltips(){this.hideTagArea(),this.tooltipsPaused=!0}resumeTooltips(){this.tooltipsPaused=!1}_createTagElement(e,t,o,r){var a=cur.pvPhWidth,_=cur.pvPhHeight/a,i=o-e,s=r-t,n=ce("div",{className:"photo_tags_suggested_area"},{left:`${e}%`,marginTop:_*t+"%",width:`${i}%`}),p=ce("div",{},{paddingBottom:100*_*(s/i)+"%"});return n.appendChild(p),n}renderTagAreas(){this.areas={},this.areasContainer.innerHTML="";var e=(0,s.getPhotoData)("tags"),t=(0,s.getPhotoData)("suggested_tags"),o=(0,p.partConfigEnabled)("photo_recognition_web");for(var r in!o&&cur.postTo&&cur.postTo<0&&(t=[]),e)if("0"!==r&&e.hasOwnProperty(r)){var a=c(e[r],7),_=a[0],i=a[1],n=a[2],d=a[3],l=a[4],v=a[5],u=a[6],h=this._createTagElement(_,i,n,d);this.areas[r]={ele:h,x:_,y:i,x2:n,y2:d,userName:l,userHref:v,canDeleteTag:Boolean(u),confirmedTag:!1},this.areasContainer.appendChild(h)}for(var g in t)if(g&&t.hasOwnProperty(g)){var m=c(t[g],7),w=m[0],P=m[1],b=m[2],f=m[3],E=m[4],T=m[5],D=m[6],C=this._createTagElement(w,P,b,f),L=void 0;E&&(L=`/id${E}`),this.areas[g]={ele:C,x:w,y:P,x2:b,y2:f,userHref:L,suggestedUserId:E,suggestedUserName:T,usersList:D,confirmedTag:!1},this.areasContainer.appendChild(C)}}_userSelectedCallback(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(0,s.getPhotoData)("tags"),a=(0,s.getPhotoData)("suggested_tags"),_=(0,p.partConfigEnabled)("photo_recognition_web"),i=this.activeAreaId,n=this.areas[i],d=n.x,c=n.y,l=n.x2,v=n.y2,u=`/id${e}`,h=cur.pvAskForAutoTag&&o,g=clean(t),m={suggestedUserId:!1,suggestedUserName:!1,usersList:[],userId:e,userName:g,userHref:u,canDeleteTag:!0},w=this.activeAreaId;_?this.confirmSuggestedTags([i],(()=>{this.activeAreaId=w,this.photoTooltip.updateState(m),this.showTagArea(w),this._removeActiveAreaAfterTimeout(1e3)})):(r[i]=[d,c,l,v,g,u,!0],delete a[i],this._confirmSuggestedTag(i,e,t,_,(()=>{this.activeAreaId=w,this.areas[w]=extend(n,m),this.photoTooltip.updateState(m),this.showTagArea(w),this._removeActiveAreaAfterTimeout(1e3),h&&(cur.pvAskForAutoTag=!1,this.showSettingsBox())})))}showSettingsBox(){showBox("/al_photos.php",{act:"show_autotag_settings"},{params:{containerClass:"autotag_settings_box",grey:!0,width:450}})}confirmAlert(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=cur.pvOneSuggestHintId,o=cur.pvOneSuggestHintHash;e?(t=cur.pvSomeSuggestsHintId,o=cur.pvSomeSuggestsHintHash,cur.pvNeedShowAlertForSomeSuggests=!1):cur.pvNeedShowAlertForOneSuggest=!1,window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:t,hash:o},{onDone:()=>{},onFail:()=>(console.error("something wrong with help hint"),!0)})}deleteTag(e){e||(e=this.activeAreaId,this.photoView.deleteTag(e)),this.hideTagArea();var t=this.areas[e];e&&t&&(t=extend(t,{isDeleted:!0}),(0,r.addClass)(t.ele,"deleted"))}_getTooltipOptions(e){var t=this.areas[e],o=t.suggestedUserId,r=t.suggestedUserName;return{suggestedUserId:o,userName:t.userName,userHref:t.userHref,suggestedUserName:r,usersList:t.usersList,canDeleteTag:t.canDeleteTag}}_handleSuggestionDeclined(){var e=this.activeAreaId,t=this.areas[e];if(t){var o=(0,s.getPhotoData)("suggested_tags"),r=(0,p.partConfigEnabled)("photo_recognition_web");this.areas[e]=extend(t,{suggestedUserId:!1,suggestedUserName:!1,userHref:null}),o&&o[e]&&(o[e][4]=0),r?this.declineSuggestedTags([e]):(this.showTagArea(e),this._declineSuggestedTag(e))}}declineSuggestedTags(e,t,o){var a=(0,s.getPhotoData)("id"),i=(0,s.getPhotoData)("hash"),p=cur.pvListId,d=cur.pvIndex,c=cur.pvData[p][d],l=(0,s.getPhotoData)("tags"),v=e.map((e=>`${a}_${e}`)).join(",");ajax.post("al_photos.php",{act:"decline_suggested_tags",tag_raw_ids:v,hash:i,extended:1},{onDone:(o,i,s)=>{this.decrementLeftMenuCounterIfNeeded(e),this.updatePhotoViewSuggestedTags(o,i,c),this.dispatchEvent(n.TagEventTypes.DECLINE_SUGGESTED_TAGS,{tagIds:e.map(Number),photoRawId:a}),p===cur.pvListId&&d===cur.pvIndex&&(!c.taginfo&&c.actions.tag&&l[0]<cur.pvMaxTags?(0,r.show)(cur.pvTagLink):(0,r.hide)(cur.pvTagLink),o||i||this.photoView.toggleTopInfoPanel((0,_.getLang)("photos_tag_deleted"),s)),t&&t()},onFail:e=>(e||(e=(0,_.getLang)("global_unknown_error")),o&&o(),this.handleTagRequestFail(e))})}confirmSuggestedTags(e,t,o){var i=cur.pvListId,p=cur.pvIndex,d=cur.pvData[i][p],c=(0,s.getPhotoData)("id"),l=(0,s.getPhotoData)("hash"),v=(0,s.getPhotoData)("suggested_tags"),u=e.length>1,h=e[0],g=v[h][4],m=()=>{var a=e.map((e=>`${c}_${e}`)).join(",");ajax.post("al_photos.php",{act:"confirm_suggested_tags",tag_raw_ids:a,hash:l,extended:1},{onDone:(o,a,_,s,l)=>{this.decrementLeftMenuCounterIfNeeded(e),this.updatePhotoViewTags(o,a,_,d),this.updatePhotoViewSuggestedTags(s,l,d),this.dispatchEvent(n.TagEventTypes.CONFIRM_SUGGESTED_TAGS,{tagIds:e.map(Number),photoRawId:c}),i===cur.pvListId&&p===cur.pvIndex&&(!d.taginfo&&d.actions.tag&&o[0]<cur.pvMaxTags?(0,r.show)(cur.pvTagLink):(0,r.hide)(cur.pvTagLink)),t&&t()},onFail:e=>(e||(e=(0,_.getLang)("global_unknown_error")),o&&o(),this.handleTagRequestFail(e))})};if(cur.pvNeedShowAlertForOneSuggest&&!u&&g!==window.vk.id||cur.pvNeedShowAlertForSomeSuggests&&u){var w="",P="",b="";if(u){var f=e.reduce(((e,t)=>{var o=v[t],r=o&&o[4];return r&&r!==window.vk.id&&(e[r]=!0),e}),{}),E=Object.keys(f).length;P=(0,_.getLang)("photo_recognition_some_tag_alert",E),w=(0,_.getLang)("photo_recognition_some_friends_alert_text",E),b=(0,_.getLang)("photo_recognition_some_friends_submit_btn")}else{var T=v[h][5],D=v[h][7];P=(0,_.getLang)("photo_recognition_one_tag_alert"),w=(0,_.langSex)(D,(0,_.getLang)("photo_recognition_one_tag_alert_text","raw")).replace("{name}",T),b=(0,_.getLang)("photo_recognition_one_friend_submit_btn")}var C=(0,a.showFastBox)(P,w,b,(()=>{C.hide(),m(),this.confirmAlert(u)}),(0,_.getLang)("global_cancel"),(()=>{C.hide(),o&&o()}))}else m()}decrementLeftMenuCounterIfNeeded(e){var t=(0,s.getPhotoData)("suggested_tags");e.forEach((e=>{var o=t[e],r=o&&o[4];r&&r===window.vk.id&&(0,d.decrementLeftMenuPhotoCounter)()}))}_confirmSuggestedTag(e,t,o,r,a){var _=(0,s.getPhotoData)("id"),i=(0,s.getPhotoData)("hash");ajax.post("al_photos.php",{act:"confirm_suggested_tag",tag:e,tagged_id:t,name:o,photo:_,hash:i},{onDone:(e,t,o)=>{this.updatePhotoViewTags(e,t,o),a()},onFail:this.handleTagRequestFail})}_declineSuggestedTag(e){var t=(0,s.getPhotoData)("id"),o=(0,s.getPhotoData)("hash");ajax.post("al_photos.php",{act:"decline_suggested_tag",tag:e,photo:t,hash:o},{onFail:this.handleTagRequestFail})}dispatchEvent(e,t){this.areasContainer.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0}))}handleTagRequestFail(e){var t=(0,_.getLang)("global_error");return setTimeout((0,a.showFastBox)(t,e).hide,3e3),!0}unMount(){removeEvent(this.imageNode,"mousemove",this._handleImageMouseMove),removeEvent(this.areasContainer,"click",this._handleAreaClick),this.containerNode.innerHTML=""}hideAreas(){this.areasHidden=!0,(0,r.hide)(this.areasContainer),this.photoTooltip.hide()}showAreas(){this.areasHidden=!1,(0,r.show)(this.areasContainer),removeEvent(this.imageNode,"mousemove",this._handleImageMouseMove),addEvent(this.imageNode,"mousemove",this._handleImageMouseMove)}reload(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hideTagArea(),this.resumeTooltips(),this.renderTagAreas(),e&&(this.imageNode=e),this.activeAreaId=null,this.waitToRemove=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this.showAreas()}_queueCheckUpdates(){cur.pvTagsQueueParams&&window.Notifier&&Notifier.addKey(cur.pvTagsQueueParams,this._queueReceiveUpdates)}updatePhotoViewTags(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(r=r||(0,s.getCurrentPhoto)())&&(r.tags=e,r.tagged=t,r.tagshtml=o,this.photoView.setTags(o))}updatePhotoViewSuggestedTags(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(o=o||(0,s.getCurrentPhoto)())&&(e&&Object.keys(e).length?o.suggested_tags=e:delete o.suggested_tags,t?(o.suggestedTagsInfo=t,this.photoView.showSuggestedInfoTopPanel(cur.pvCurPhoto)):(delete o.suggestedTagsInfo,this.photoView.toggleTopInfoPanel(!1)),this.reload())}_queueReceiveUpdates(e,t){t.events&&t.events.forEach((e=>{var t=e.split("<!>"),o=t[1],r=t[2],a=JSON.parse(r),_=JSON.parse(t[3]),i=JSON.parse(t[4]),n=t[5];if((0,s.getPhotoData)("id")===o)(0,s.setPhotoData)("suggested_tags",a),this.updatePhotoViewTags(_,i,n),this.renderTagAreas();else if(cur.pvData){var p=function(e){if(cur.pvData.hasOwnProperty(e)){var t=cur.pvData[e];t.length&&t.forEach(((t,r)=>{if(t.id&&t.id===o){var s=cur.pvData[e][r];s.suggested_tags=a,s.tags=_,s.tagged=i,s.tagshtml=n}}))}};for(var d in cur.pvData)p(d)}}))}}},924400:(e,t,o)=>{o.d(t,{default:()=>i});o(59357);var r=o(76691),a=o(116886),_="right_top";const i=class{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options=extend({closeOnClick:!0,resetDropdownOnShow:!0,onUserSelected:()=>!1,onMouseLeave:()=>!1,onEscapePressed:()=>!1,onDeleteClicked:()=>!1,onSuggestionDeclined:()=>!1},t),this.container=e,this.friendsDropdown=new r.default({onUserSelected:this._handleUserSelected.bind(this),onEscapePress:this._handleEscapePress.bind(this),onKeyUp:this._handleStartInteraction.bind(this)}),this.friendsDropdownNode=this.friendsDropdown.init(),this._handleConfirmedTooltipClick=this._handleConfirmedTooltipClick.bind(this),this._handleDocumentClick=this._handleDocumentClick.bind(this),this.renderTooltip()}renderTooltip(){this.tooltipNode=ce("div",{className:"photo_tooltip"},{display:"none"});var e=ce("div",{className:"photo_tooltip__content"});this.sugggestionNode=ce("div"),this.nameNode=ce("div",{className:"photo_tooltip__name"},{display:"none"}),this.listNode=ce("div",{className:"photo_tooltip__suggestion"}),this.listNode.appendChild(this.friendsDropdownNode),addEvent(this.nameNode,"click",this._handleConfirmedTooltipClick),e.appendChild(this.nameNode),e.appendChild(this.sugggestionNode),e.appendChild(this.listNode),this.tooltipNode.appendChild(e),this.container.appendChild(this.tooltipNode),addEvent(this.tooltipNode,"mouseenter",(()=>{this.isActive=!0})),addEvent(this.sugggestionNode,"click",(e=>{switch(cancelEvent(e),window.domData(e.target,"button")){case"yes":this.options.onUserSelected(this.suggestedUserId,this.suggestedUserName,!0);break;case"no":this.options.onSuggestionDeclined(),hide(this.sugggestionNode),this.userHref=null,this.options.hideAfterDecline?this.hide():(this.showFriendsList(),this.showAndFocusFriendsList())}})),addEvent(this.tooltipNode,"mouseleave",(()=>{this.interaction||(this.isActive=!1,this.options.onMouseLeave())})),this.options.closeOnClick&&addEvent(document,"click",this._handleDocumentClick)}_handleDocumentClick(e){this.options.onMouseLeave(),this.interaction=!1,this.isActive=!1,this.hide()}_handleUserSelected(e,t){this.isActive=!1,this.options.onUserSelected(e,t)}_handleEscapePress(){this.isActive=!1,this.interaction=!1,this.friendsDropdown.reset(),this.options.onEscapePressed()}_handleStartInteraction(){this.interaction=!0}_handleConfirmedTooltipClick(e){cancelEvent(e),"button"===e.target.tagName.toLowerCase()?this.options.onDeleteClicked():this.userHref&&this._go(this.userHref,e)}updatePosition(e){var t=e.top,o=e.right,r=e.bottom,a=e.left,i=o-a,s=getSize(this.tooltipNode),n=s[0]?s[0]:280,p="bottom",d=a+Math.floor(i/2)-n/2,c=r;if((d<10||this.hasDropdown&&r>window.clientHeight()-300)&&(p=_),p===_){d=o,c=t;var l=window.clientHeight()-t;l<300&&(c=t-300+l)}domData(this.tooltipNode,"dir",p),setStyle(this.tooltipNode,{top:c,left:d})}updateSuggestionQuestion(e,t){this.sugggestionNode.innerHTML=this._getSuggestionHTML(e,t),this.suggestedUserName=t,this.suggestedUserId=e}_getSuggestionHTML(e,t){var o=e===vk.id?getLang("photos_tags_user_you"):t;return`<div class="suggested_tag_user">\n      ${(0,a.langTag)("<div>","</div>",getLang("photos_tags_suggestion_question"),"tag_span").replace("{userName}",`<div class="suggested_tag_user__name">&nbsp;${o}</div>`)}\n      <div class="suggested_tag_user__actions">\n        <button data-button="yes" class="yes">${getLang("box_yes")}</button>\n        <span>&middot;</span>\n        <button data-button="no">${getLang("box_no")}</button>\n      </div>\n    </div>`}updateState(e){var t=e.suggestedUserName,o=e.suggestedUserId,r=e.usersList,a=e.userName,_=e.userHref,i=e.canDeleteTag;this.suggestedUserName=!1,this.suggestedUserId=!1,this.userHref=_,this.hasDropdown=!1,removeClass(this.tooltipNode,"tagged"),a?(this.nameNode.innerHTML=`${a} ${i?"<button>Delete</button>":""}`,toggleClass(this.nameNode,"show_delete",i),show(this.nameNode),hide(this.listNode),hide(this.sugggestionNode),addClass(this.tooltipNode,"tagged")):o?(this.updateSuggestionQuestion(o,t),hide(this.nameNode),hide(this.listNode),show(this.sugggestionNode)):(this.friendsDropdown.update(r),hide(this.nameNode),hide(this.sugggestionNode),this.showFriendsList(),this.hasDropdown=!0)}showFriendsList(){show(this.listNode),this.options.resetDropdownOnShow&&this.resetFriendsDropdown()}resetFriendsDropdown(){this.friendsDropdown.reset()}show(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.isActive=!1,this.interaction=!1,this.updateState(t),this.updatePosition(e),show(this.tooltipNode),o&&this.friendsDropdown.show(!0),this.friendsDropdown.focus()}hide(){hide(this.tooltipNode)}showAndFocusFriendsList(e){this.userHref?this._go(this.userHref,e):(this.friendsDropdown.focus(),this.friendsDropdown.show())}unMount(){removeEvent(document,"click",this._handleDocumentClick),re(this.tooltipNode)}_go(e,t){t&&t.ctrlKey?window.open(e):nav.go(e,t)}}},177273:(e,t,o)=>{o.d(t,{Phototag:()=>i});o(991181),o(296253);var r=o(924400),a=o(775478),_=o(830242),i={startTag(){if(!cur.pvTagger&&cur.pvPhoto.firstChild&&(!cur.pvTaggerTooltip&&window.layer?cur.pvTaggerTooltip=new r.default(layer,{closeOnClick:!1,resetDropdownOnShow:!1,onUserSelected:i.addTag,onEscapePressed:i.stopTag}):cur.pvTaggerTooltip.resetFriendsDropdown(),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(getLang("photos_select_tag_area"),`<button class="flat_button" onclick="Phototag.stopTag()">${getLang("global_done")}</button>`),Photoview.toggleNavControls(""),Photoview.toggleOnPhotoControls(!1),layerWrap.scrollTop=0,cur.pvTagger="loading",cur.pvTagger)){var e={minw:30,minh:30,onStart(){cur.pvPhotoTags&&cur.pvPhotoTags.pauseTooltips(),cur.pvTaggerTooltip.hide()},onFinish:i.showFriends};Photoview.updatePhotoDimensions(),cur.pvTagger=window.photoTagger(cur.pvPhoto.firstChild,extend(e,{zstart:50})),cur.pvPhotoTags&&cur.pvPhotoTags.hideAllSuggestedAreas()}},stopTag(){cur.pvTagger&&"loading"!=cur.pvTagger?((0,_.getPhotoData)("suggestedTagsInfo")?Photoview.showSuggestedInfoTopPanel(cur.pvCurPhoto):Photoview.toggleTopInfoPanel(!1),hide(cur.pvFriends),cur.pvTaggerTooltip&&cur.pvTaggerTooltip.hide(),cur.pvListId&&cur.pvData[cur.pvListId].length>1&&Photoview.toggleNavControls("left close right"),Photoview.toggleOnPhotoControls(!0),cur.pvTagger.destroy(),cur.pvTagger=!1,Photoview.updatePhotoDimensions(),cur.pvPhotoTags&&cur.pvPhotoTags.reload()):cur.pvTagger=!1},addTag(e,t){if(!cur.pvTagger||"loading"==cur.pvTagger)return!1;var o=cur.pvTagger.result();if(!e&&!t||!o[2])return!1;var r=(0,_.getPhotoData)("id"),s=(0,_.getPhotoData)("suggested_tags"),n=cur.pvListId,p=cur.pvIndex,d=cur.pvData[n][p],c=getSize(cur.pvPhoto.firstChild),l=o[0]/c[0]*100,v=o[1]/c[1]*100,u=(o[0]+o[2])/c[0]*100,h=(o[1]+o[3])/c[1]*100;return ajax.post("al_photos.php",{act:"add_tag",mid:e,photo:d.id,name:t,hash:d.hash,x:l,y:v,x2:u,y2:h},{onDone(e,t,o,_,c){if(cur.pvPhotoTags.updatePhotoViewTags(e,t,o,d),_&&c&&cur.pvPhotoTags.updatePhotoViewSuggestedTags(_,c,d),s){var l=Object.keys(s),v=_?l.filter((e=>!_[e])):l;cur.pvPhotoTags.dispatchEvent(a.TagEventTypes.DELETE_TAG,{tagIds:v.map(Number),photoRawId:r})}cur.pvListId==n&&cur.pvIndex==p&&(re(Photoview.actionInfo()),(!d.taginfo&&d.actions.tag&&e[0]<cur.pvMaxTags?show:hide)(cur.pvTagLink),cur.pvTaggerTooltip.hide(),cur.pvTagger.reset(),cur.pvPhotoTags.renderTagAreas(),cur.pvTaggerTooltip.resetFriendsDropdown(),s&&c&&i.stopTag())},onFail:cur.pvPhotoTags.handleTagRequestFail}),!1},showFriends(){if(cur.pvTagger&&"loading"!=cur.pvTagger){var e=cur.pvTagger.result(),t=e[0],o=e[1],r=e[2],a=e[3],_=getXYRect(cur.pvPhoto.firstChild,!0),i=_.left+t,s=_.top+o,n=_.left+t+r,p=_.top+o+a;cur.pvTaggerTooltip.hide(),cur.pvPhotoTags&&cur.pvPhotoTags.resumeTooltips(),cur.pvTaggerTooltip.show({left:i,top:s,right:n,bottom:p},{},!0)}}}},760050:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Photoview:()=>Photoview});var core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(530522),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(579665),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(95767),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(175115),core_js_modules_es7_object_entries__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(83276),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(66108),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(991181),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(296253),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(21466),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(751876),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(59357),_icons_desktop_getIcon16Chevron__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(664547),_icons_desktop_getIcon16Market__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(732553),_icons_desktop_getIcon24Cancel__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(978787),_web_photos_photos__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(410329),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(772200),_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(177273),_photo_tags__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(526224),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(519921),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(469433),_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(414914),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(917685),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(442699),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(376690),_web_page_wall__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(88181),_internal_nospam_common__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(432338),_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(705456),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(791563),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(719016),_web_lib_fx__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(190148),_web_lib_utils__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(907851),_photoview_utils__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(830242),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(486353),_web_photos_types__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(775478),_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(713208),_web_reports_reports__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(496495);function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var o=[],r=!0,a=!1,_=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(o.push(i.value),!t||o.length!==t);r=!0);}catch(e){a=!0,_=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw _}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var Photoview={MIN_WIDTH:600,MIN_HEIGHT:450,PE_MIN_WIDTH:750,PE_MIN_HEIGHT:500,SIDE_COLUMN_WIDTH:310,SIDE_MIN_GAP:40,VERTICAL_MIN_GAP:15,BOTTOM_BAR_HEIGHT:52,SIDE_NAV_PANELS_MAX_WIDTH:120,SIDE_NAV_PANELS_MIN_WIDTH:25,LEFT_RIGHT_NAV_RATIO:.25,blank:"/images/blank.gif",blankf:()=>{},cacheSize:3,allSizes:["x","y","z","w"],PE_V1:1,PE_V2:2,PE_V3:4,_getViewedPhotoFullId(){var e=cur.pvListId,t=cur.pvIndex;return cur.pvData[e][t].id},changeThumbs(e,t,o){if(e){var r=[ge("photo_row"+cur.filterPhoto),ge("photos_add_thumb"+cur.filterPhoto)],a=geByClass("page_post_thumb_wrap");for(var _ in a.push.apply(a,geByClass("page_preview_photo")),a.push.apply(a,geByClass("im_preview_photo")),a.push.apply(a,geByClass("photo")),a.push.apply(a,geByClass("page_square_photo")),a.push.apply(a,geByClass("photos_row")),a)if(a.hasOwnProperty(_)){var i=a[_].getAttribute("onclick");if(!i){var s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(a[_]);i=!!s&&s.getAttribute("onclick")}i&&-1!=i.indexOf(`'${cur.filterPhoto}'`)&&r.push(a[_])}for(var n in r)if(r[n]){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(r[n],"page_square_photo")||r[n].style.backgroundImage){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(r[n],{backgroundImage:`url('${e}')`});continue}var p=geByTag1("img",r[n]);p&&(p.src=e,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(p,{height:"auto"}))}if(cur.pvNoTemp||(cur.pvNoTemp={}),cur.pvNoTemp[cur.filterPhoto]=!0,window.ThumbsEdit&&t){var d=ThumbsEdit.cache();for(var c in d)if(d.hasOwnProperty(c)){var l=d[c].previews||[],v=!1;for(var u in l)l.hasOwnProperty(u)&&"photo"==l[u].type&&l[u].photo.id=="photo"+o&&(l[u].photo.sizes=t,delete l[u].photo.restrictionBlur,v=!0);v&&ThumbsEdit.refresh(c)}}}},openStickersEditor(e){cur.pvEditorMode||(e||(e=cur.pvCurPhoto),Photoview.stopTagger(),cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas(),Photoview.toggleNavControls(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvLikeFSWrap),Photoview.hideTag(!0),cur.pvEditorMode=!0,cur.pvEditorSaved=!1,Photoview.updatePhotoDimensions(),stManager.add([jsc("web/spe.js"),"photo_editor.css"],(()=>{SPE.init(e,((t,o,r,a)=>{var _=document.querySelector(`.photos_photo_edit_row[data-id="${t.id}"] .photos_photo_edit_row_thumb`);_&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(_,"background-image",`url(${o})`);var i=t.id!=e.id;if(cur.pvEditorSaved=!0,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),e.closeOnPEEdit){if(t&&o&&window.ThumbsEdit&&r){var s=ThumbsEdit.cache();for(var n in s)if(s.hasOwnProperty(n)){var p=n.replace("thumbs_edit",""),d=cur.addMedia[p],c=s[n].previews||[],l=!1;for(var v in c)if(c.hasOwnProperty(v)&&"photo"==c[v].type&&c[v].photo.id=="photo"+e.id){var u=c[v].photo;if(i){u.id="photo"+t.id,u.pid=t.id.split("_")[1];var h=d.getMedias();each(h,(function(){if("photo"==this[0]&&this[1]==e.id)return this[1]=t.id,!1}))}c[v].click=d.showPhoto.pbind(t.id,t.list,parseJSON(a)),c[v].itemId=u.pid,u.sizes=r,l=!0}l&&(ThumbsEdit.refresh(n),d.onChange&&d.onChange())}}return Photoview.changeThumbs(o,r,t.id),Photoview.hide(0)}if(cur.pvListId){var g=cur.pvListId,m=cur.pvData[g],w=cur.pvIndex;if(!m)return nav.reload();var P=m[w];if(i){var b=extend({},t);w=++cur.pvIndex,m.splice(w,0,b),P=b,cur.pvCommsLikes[P.id]=[P.comments,0,vkNow(),!1],delete P.comments,delete P.likes}var f=cur.pvShown&&g==cur.pvListId&&w==cur.pvIndex;t&&o&&!i&&(Photoview.changeThumbs(o,r,e.id),delete P.x_,delete P.x_src,delete P.y_,delete P.y_src,delete P.z_,delete P.z_src,extend(P,t)),P.peType=Photoview.PE_V3,f&&(cur.pvCurData=Photoview.genData(P,Photoview.getPhotoSize()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto).src=Photoview.blank,setTimeout(Photoview.show.pbind(cur.pvListId,cur.pvIndex),0))}}),(()=>{if(delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),e.closeOnPEEdit)return Photoview.hide(0);show(cur.pvLikeFSWrap),Photoview.toggleNavControls(["left","right","close"]),setTimeout(Photoview.updatePhotoDimensions,1)}))})))},genUrl:(e,t)=>t?(t.match(/\.[a-z]{3}(?:\?|$)/i)||(t+=".jpg"),t.match(/https?:\/\//i)?t:(e||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+t):"",genData(e,t){for(var o,r,a="x"==t?3:"y"==t?2:"z"==t?1:0,_=["w","z","y","x"].slice(a),i=0;i<4-a;++i){var s=_[i];if(o=e[s+"_"])break;if(r=e[s+"_src"])break}return o||(o=[r]),{src:Photoview.genUrl(e.base,o[0]),width:o[2]&&o[1],height:o[1]&&o[2],restrictionBlur:e.restrictionBlur,restrictionGeo:e.restrictionGeo,restrictionTitle:e.restrictionTitle,restrictionText:e.restrictionText,photoRaw:e.photoRaw,unblurHash:e.unblurHash}},actionInfo:()=>ge("pv_action_info")||domPN(cur.pvTags).insertBefore(ce("div",{id:"pv_action_info",className:"pv_right_block"}),cur.pvTags),locNav(e,t,o,r){if(cur.pvListId=="newtag"+vk.id+(o.rev?"/rev":"")&&o[0]=="albums"+vk.id&&"added"==o.act)return Photoview.hide(r.hist),!1;if((o=nav.toStr(o)).replace("?rev=1","/rev")==cur.pvListId&&cur.pvShown)return Photoview.hide(r.hist),!1;var a=o.match(/^photo(-?\d+_\d+)\??((all=1|newtag=\d+)(&rev=1)?|(rev=1&)?tag=\d+|rev=1)?$/);if(a){var _=cur.pvListId;_&&cur.pvShown||(_="added"==nav.objLoc.act?"newtag"+vk.id+(nav.objLoc.rev?"/rev":""):nav.strLoc.replace("?rev=1","/rev"));var i=cur.pvData[_];if(i)for(var s=0,n=i.length;s<n;++s)if(i[s]&&i[s].id==a[1])return Photoview.show(_,s,!1,cur.pvRoot),!1}},updateLocNav(){if(cur.pvRoot){for(var e=0,t=cur.nav.length;e<t;++e)if(cur.nav[e]==Photoview.locNav)return;cur.nav.push(Photoview.locNav)}else for(var o=0,r=cur.nav.length;o<r;++o)cur.nav[o]==Photoview.locNav&&(cur.nav.splice(o,1),--o,--r)},toggleOnPhotoControls(e){e=!!e,toggle(cur.pvFSWrap,e)},checkLayerVisibility(){if(cur.pvShown)return!0;debugLog("layerqueue.hide from photoview"),layerQueue.hide(),addEvent(window,"resize",Photoview.onResize),addEvent(document,"keydown",Photoview.onKeyDown),addEvent(layerWrap,"click",Photoview.onLayerClick),boxQueue.hideAll(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(layerBG,{opacity:""}),layers.show(),layers.fullhide=Photoview.hide},emojiShowTT:(e,t)=>void 0!==cur.pvEmoji&&Emoji.ttShow(cur.pvEmoji,e,t),emojiHideTT:(e,t)=>void 0!==cur.pvEmoji&&Emoji.ttHide(cur.pvEmoji,e,t),onImageWrapMouseDown(e){if(2!=e.button&&!cur.pvEditorMode){if(e.target.closest(".pv_attach_product_badge"))return!1;if(cur.pvAttachedProducts.isProcess)return Photoview.attachProductPoint(e),!1;if(!cur.pvTagger&&!1===(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.checkEvent)(e)){var t=cur.pvIndex;return Photoview.updateNavBtnsLeftThreshold(),e.pageX<cur.pvLeftBtnAmount?t-=1:t+=1,cur.pvPointerPosition=[e.pageX,e.pageY],Photoview.show(!1,t,e)}}},onImageWrapMouseLeave(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(cur.pvNavBtnLeft,"pv_nav_btn_show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(cur.pvNavBtnRight,"pv_nav_btn_show"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(cur.pvImageAreaWrap,"pv_init_hover"),Photoview.updateNavBtnsLeftThreshold(!0)},onImageWrapMouseMove(e){Photoview.updateNavBtnsLeftThreshold(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",e.pageX<cur.pvLeftBtnAmount),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvNavBtnRight,"pv_nav_btn_show",e.pageX>cur.pvLeftBtnAmount)},toggleLightModeClass(e){e=!!e&&cur.pvIsLightMode,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvBox,"pv_light_mode",!!e),e=!!e&&cur.pvShowBottomActions,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvBox,"pv_show_bottom_actions",!!e)},isPhotosList:()=>!!(cur.pvVideoTagsShown||cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown),createLayer(){cur.pvLayerCreated=!0,delete cur.pvLeftBtnAmount,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(layerWrap,"pv_layer_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(layerBG,"pv_layer");var e=Photoview.isPhotosList(),t=nav.objLoc[0].match(/^faq(\d)+$/),o=nav.objLoc[0].match(/^bug(\d)+$/),r=cur.translationBoxOpened;cur.pvIsLightMode=o||0==nav.objLoc[0].indexOf("blog/")||t||inArray(nav.objLoc[0],["blog","about","support","helpdesk","tutorial","market","bugs","translation","restore2"])||r||cur.pvOptions&&cur.pvOptions.isLightMode,cur.pvShowBottomActions=!cur.pvIsLightMode||t||inArray(nav.objLoc[0],["helpdesk","support"]);var a="display: none",_=cur.pvAlbumsShown?cur.pvAlbumsData[cur.pvAlbumsShown].html:"",i=cur.pvVideoTagsShown?cur.pvVideoTagsData.html:"",s=e?a:"",n=e?"":a,p=cur.pvAlbumsShown?"":a,d=cur.pvVideoTagsShown?"":a,c=cur.pvAlbumShown?cur.pvAlbumData[cur.pvAlbumShown].html:"",l=cur.pvAlbumShown?"":a;cur.pvPhotoTagShown&&(c=cur.pvPhotoTagData[cur.pvPhotoTagShown].html,l=""),ge("pv_comments")&&(cur.pvBackupComments=ge("pv_comments"),domPN(ge("pv_comments")).removeChild(ge("pv_comments")));var v=`\n    <div style="${n}" class="box_title_wrap box_grey">\n      <div class="box_x_button" onclick="Photoview.hide(0)">${(0,_icons_desktop_getIcon24Cancel__WEBPACK_IMPORTED_MODULE_33__.getIcon24Cancel)().icon}</div>\n      <div class="box_title_controls"></div>\n      <div class="box_title"></div>\n    </div>\n    `,u=cur.pvIsLightMode?"":'\n      <div class="pv_fs_wrap">\n        <div class="pv_fs_btn" onmousedown="return Photoview.fullscreen(event);"><div></div></div>\n      </div>\n    ',h=`\n      <div class="pv_bottom_info clear_fix">\n        <div>\n          <div class="pv_bottom_info_left">\n            <span class="pv_album_name" onmouseover="setTitle(this)"></span>\n            <span class="pv_counter"></span></div>\n            ${cur.pvShowBottomActions?'<div class="pv_bottom_actions"></div>':""}\n        </div>\n      </div>`,g=cur.pvIsLightMode?"":'\n      <div class="pv_narrow_column_wrap">\n        <div class="pv_narrow_column_cont wall_module">\n          <div class="narrow_column" id="pv_narrow"></div>\n        </div>\n      </div>',m=getProgressHtml("pv_image_progress");layer.innerHTML=`\n    <div class="pv_cont">\n      <div id="pv_box" class="_scroll_node pv_box" tabindex="0" onclick="cur.pvClicked = true;" onmouseenter="removeClass(layerWrap, 'pv_mouse_out_layer')" onmouseleave="addClass(layerWrap, 'pv_mouse_out_layer')">\n        ${v}\n        <div class="clear_fix pv_photo_wrap" style="${s}">\n          <div class="pv_close_btn" onclick="Photoview.hide(0)"></div>\n          <div class="no_select pv_left_wrap">\n            <div class="no_select pv_image_wrap">\n              <div id="pv_tag_info" class="PhotoViewTopPanel">\n                <div class="pv_tag_info_text"></div>\n                <div class="pv_tag_info_buttons_wrap"></div>\n              </div>\n              <div id="pv_tag_frame"></div>\n              <div id="pv_tag_faded"></div>\n              <div id="pv_tag_person" onmouseout="Photoview.hideTag()"></div>\n              <div class="pv_photo_tags" id="pv_photo_tags"></div>\n              <div class="pv_img_area_wrap pv_init_hover" onmouseleave="return Photoview.onImageWrapMouseLeave(event)" onmousedown="return Photoview.onImageWrapMouseDown(event)" onmousemove="Photoview.onImageWrapMouseMove(event)">\n                <div class="pv_img_progress_wrap">${m}</div>\n                <div id="pv_photo"></div>\n                \n      <div class="pv_nav_btn" id="pv_nav_btn_left" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex - 1, event);">\n        <div class="pv_nav_btn_icon"></div>\n      </div>\n      <div class="pv_nav_btn" id="pv_nav_btn_right" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex + 1, event);"><div class="pv_nav_btn_icon"></div></div>\n    \n                <div class="pv_like_fs_wrap">\n                ${u}\n                </div>\n              </div>\n            </div>\n            ${h}\n          </div>\n          ${g}\n        </div>\n        <div id="pv_albums_wrap" class="pv_white_bg photos_container_albums" style="${p}">${_}</div>\n        <div id="pv_album_wrap" class="pv_white_bg" style="${l}">${c}</div>\n        <div id="pv_vtagged_wrap" class="pv_white_bg" style="${d}">${i}</div>\n      </div>\n    </div>`,cur.pvYourComment&&domPN(ge("pv_your_comment")).replaceChild(cur.pvYourComment,ge("pv_your_comment")),extend(cur,{pvCont:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(layer),pvBox:ge("pv_box"),pvImageAreaWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_img_area_wrap"),pvLeftWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_left_wrap"),pvTitle:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("box_title_wrap"),pvTitleText:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("box_title"),pvImageWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_image_wrap"),pvNavBtnLeft:ge("pv_nav_btn_left"),pvNavBtnRight:ge("pv_nav_btn_right"),pvNavBtnClose:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_close_btn"),pvNarrowColumnWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_narrow_column_wrap"),pvNarrowColumn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_narrow_column_cont"),pvPhotoWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_photo_wrap"),pvAlbumWrap:ge("pv_album_wrap"),pvAlbumsWrap:ge("pv_albums_wrap"),pvVTagsWrap:ge("pv_vtagged_wrap"),pvPhotoTagsContainer:ge("pv_photo_tags"),pvTagInfo:ge("pv_tag_info"),pvTagFrame:ge("pv_tag_frame"),pvTagFaded:ge("pv_tag_faded"),pvTagPerson:ge("pv_tag_person"),pvPhoto:ge("pv_photo"),pvTagInfoText:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_tag_info_text"),pvTagInfoButtons:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_tag_info_buttons_wrap"),pvBottomInfo:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_bottom_info"),pvAlbumName:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_album_name"),pvCounter:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_counter"),pvBottomActions:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_bottom_actions"),pvBottomLeft:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_bottom_info_left"),pvNarrow:ge("pv_narrow"),pvWide:ge("pv_wide"),pvImgProgress:ge("pv_image_progress"),pvLikeFSWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_like_fs_wrap"),pvFSWrap:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_fs_wrap"),pvFS:ge("pv_fs"),pvFSFg:ge("pv_fs_fg"),pvActions:ge("pvs_actions"),pvYourComment:ge("pv_your_comment"),pvAddMedia:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(ge("pv_add_media")),pvMediaPreview:ge("pv_media_preview"),pvCommentSend:ge("pv_comment_send"),pvComment:ge("pv_comment")}),addEvent(layerWrap,"scroll",Photoview.scrollResize),addEvent(layerWrap,"mousemove",Photoview.onLayerMouseMove),Photoview.updateSize(),e&&_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_20__.default.init(!1,{parent:layerWrap});var w=layerWrap.scrollTop;elfocus((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("_scroll_node",cur.pvCont)),layerWrap.scrollTop=w},doShowAlbums(e,t){if(e=intval(e),!t||2!=t.button&&3!=t.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);var o=(cur.pvAlbumsData||{})[e];if(o){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),cur.pvShown=!0,cur.pvAlbumsShown=e,val("pva_owner")!=e&&extend(cur,{pvaOffset:o.opts.offset,pvaCount:o.opts.count,pvaPhotosOffset:o.opts.photos_offset,pvaPhotosCount:o.opts.photos_count,pvShowAllAlbums:!1}),cur.pvLayerCreated?(val("pva_owner")!=e&&val(cur.pvAlbumsWrap,o.html),isVisible(cur.pvAlbumsWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvPhotoWrap,cur.pvAlbumWrap,cur.pvVTagsWrap),show(cur.pvAlbumsWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pva_scroll"))):Photoview.createLayer(!0),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_20__.default.show(),show(cur.pvTitle),show(cur.pvAlbumsWrap),cur.pvTitleText.innerHTML=o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId?extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex}):(!browser.msie||browser.version>8)&&(cur.pvClicked=!1),Photoview.toggleNavControls(),cur.pvListId=!1;var r=extend(nav.objLoc,{z:"albums"+cur.pvAlbumsShown});return nav.strLoc!=nav.toStr(r)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(r)),Photoview.updatePeriods(),!!t&&cancelEvent(t)}}},jumpToAlbums(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="albums"+val("pva_owner")||cur.pvJumpTo.z!=nav.objLoc.z)?(e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_16__.showAlbums)(val("pva_owner"),{noHistory:!0})},jumpToAlbum(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="album"+val("pvsa_album")||cur.pvJumpTo.z!=nav.objLoc.z)?(e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_16__.showAlbum)(val("pvsa_album"),{noHistory:!0})},jumpToTagged(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="tag"+val("pvsa_tag")||cur.pvJumpTo.z!=nav.objLoc.z)?(cur.pvJumpTo.z=="tag"+val("pvsa_tag")&&(cur.pvJumpTo.z="photo_"+cur.pvJumpTo.z),e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Photoview.showTagged(val("pvsa_tag"),{noHistory:!0})},doShowAlbum(e,t){if(!t||2!=t.button&&3!=t.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);var o=(cur.pvAlbumData||{})[e];if(o){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),cur.pvShown||cur.pvAlbumShown||cur.pvAlbumsShown||layerQueue.push(),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_20__.default.show(),cur.pvShown=!0,cur.pvAlbumShown=e,cur.pvLayerCreated&&val("pvsa_album")==e||extend(cur,{pvsaOffset:o.opts.offset,pvsaCount:o.opts.count}),cur.pvLayerCreated?(val("pvsa_album")!=e&&val(cur.pvAlbumWrap,o.html),isVisible(cur.pvAlbumWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),show(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pvsa_scroll"))):Photoview.createLayer(),show(cur.pvTitle),show(cur.pvAlbumWrap);var r=o.opts.author||"";if(cur.pvTitleText.innerHTML=(r?r+'<span class="divider"></span> ':"")+o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var a=(cur.pvListId||"").split("/");a[0]&&Photoview.showRepeat(ge(a[0]))}else(!browser.msie||browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var _=extend(nav.objLoc,{z:"album"+cur.pvAlbumShown});return nav.strLoc!=nav.toStr(_)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(_)),!!t&&cancelEvent(t)}}},doShowTagged(e,t){if(e=intval(e),!t||2!=t.button&&3!=t.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);var o=(cur.pvPhotoTagData||{})[e];if(o){if(Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),cur.pvShown=!0,cur.pvPhotoTagShown=e,cur.pvLayerCreated&&val("pvsa_tag")==e||extend(cur,{pvsaOffset:o.opts.offset,pvsaCount:o.opts.count}),cur.pvLayerCreated?(val("pvsa_tag")!=e&&val(cur.pvAlbumWrap,o.html),isVisible(cur.pvAlbumWrap)||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),show(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pvsa_scroll"))):Photoview.createLayer(),show(cur.pvTitle),show(cur.pvAlbumWrap),cur.pvTitleText.innerHTML=o.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var r=(cur.pvListId||"").split("/");r[0]&&Photoview.showRepeat(ge(r[0]))}else(!browser.msie||browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var a=extend(nav.objLoc,{z:"photo_tag"+cur.pvPhotoTagShown});return nav.strLoc!=nav.toStr(a)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(a)),!!t&&cancelEvent(t)}}},toggleNavControls(e){each([cur.pvNavBtnRight,cur.pvNavBtnLeft,cur.pvNavBtnClose],(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(this)})),isString(e)&&(e=e.split(" ")),each(e||[],(function(e,t){switch(t){case"close":show(cur.pvNavBtnClose);break;case"left":show(cur.pvNavBtnLeft);break;case"right":show(cur.pvNavBtnRight)}}))},getPhotoSize(){var e;switch(cur.pvVeryBig){case 3:e="w";break;case 2:case 1:e="z";break;default:e="y"}return e},show(e,t,o,r){if(!cur.pvEditorMode&&(cur.pvAttachedProducts=cur.pvAttachedProducts||{},cur.pvAttachedProducts.badges&&cur.pvAttachedProducts.badges.forEach((e=>e.remove())),!o||2!=o.button&&3!=o.which))if(cur.cancelClick)delete cur.cancelClick;else{if(Photoview.destroyPeriod(),clearTimeout(window.__pvhideTimer),"temp"==e&&cur.pvShown){if(cur.pvListId&&"temp"!=cur.pvListId)return;cur.pvWasShown=!0}else cur.pvWasShown=!1;if(__afterFocus)return!!o&&cancelEvent(o);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),!1!==o))return!!o&&cancelEvent(o);if(!1===e){if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown){if(cur.pvOldListId)return extend(cur,{pvJumpTo:cur.pvOldJumpTo,pvJumpFrom:cur.pvOldJumpFrom,pvJumpSteps:cur.pvOldJumpSteps}),t==cur.pvOldIndex+1&&++cur.pvOldIndex,Photoview.show(cur.pvOldListId,cur.pvOldIndex,o,r);Photoview.toggleNavControls()}e=cur.pvListId}var a=((cur.pvData||{})[e]||{}).length,_=e!=cur.pvListId;if(a){o&&o.pageX&&o.pageY&&extend(cur,{pvOldX:o.pageX,pvOldY:o.pageY,pvOldT:vkNow()}),(cur.pvOptions||{}).queue&&(layerQueue.push(),cur.pvOptions.queue=!1,cur.pvHistoryLength=0),Photoview.checkLayerVisibility()||(_=!0);var i=t+(t<0?a:t>=a?-a:0),s=_?1:cur.pvIndex>t?-1:1;if(!_&&!cur.pvCanvas){if(cur.pvJumpTo){if(cur.pvJumpSteps+=t-cur.pvIndex,i===cur.pvJumpFrom&&cur.pvJumpSteps>=a)return extend(cur,{pvOldJumpFrom:cur.pvJumpFrom,pvOldJumpSteps:cur.pvJumpSteps-(t-cur.pvIndex),pvOldJumpTo:cur.pvJumpTo}),Photoview.jumpToAlbums(cur.pvJumpSteps<0);if(s>0&&(i<cur.pvJumpFrom&&i+4>cur.pvJumpFrom||i<cur.pvJumpFrom+a&&i+4>cur.pvJumpFrom+a)){vkImage().src=stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":"")+".png?3";var n=cur.pvJumpTo.z.match(/^albums(-?\d+)$/);n&&(cur.pvAlbumsData||(cur.pvAlbumsData={}),cur.pvAlbumsData[n[1]]||(cur.pvAlbumsData[n[1]]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:n[1],other:1},{onDone:Photoview.loadedAlbums})))}cur.pvJumpSteps<=-a&&(cur.pvJumpSteps+=a)}if(1==a&&t!=cur.pvIndex&&("temp"!=e||cur.pvOptions.temp_final))return Photoview.hide(),!!o&&cancelEvent(o)}_&&"temp"!=e&&(!1===cur.pvJumpFrom&&(cur.pvJumpFrom=i),cur.pvRoot=r,Photoview.updateLocNav()),t=i;var p=cur.pvData[e][t];if(p&&(p.x_||p.x_src)){cur.pvIndex=t,cur.pvShown=!0,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1,cur.pvListId=e,Photoview.calculateVeryBig();var d=Photoview.getPhotoSize();return cur.pvCurData=Photoview.genData(p,d),cur.pvLayerCreated||Photoview.createLayer(),cur.pvCurrent&&(cur.pvCurrent.onload=Photoview.blankf,cur.pvCurrent.src=Photoview.blank),delete cur.pvCurrent,cur.pvCurrent=vkImage(),cur.pvCurrent.onload=Photoview.preload.pbind(t,s),cur.pvCurrent.src=cur.pvCurData.src,_&&Photoview.toggleNavControls(a>1?"left right close":"close"),hideProgress(cur.pvCounter),"temp"!=e||cur.pvOptions.temp_final?"temp"==e&&cur.pvOptions.temp_final&&cur.pvOptions.temp_summary||(cur.pvCounter.innerHTML=a>1?getLang("photos_photo_counter_num_of_N").replace("%s",cur.pvIndex+1).replace(/%s|{count}/,a):""):(((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(cur.pvCurData)||cur.pvCurData.restrictionGeo)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvImgProgress),showProgress(cur.pvCounter,"","pr_baw")),cur.pvCurPhoto=p,cur.pvCurData.width&&cur.pvCurData.height?Photoview.doShow():(cur.pvCurData=cur.pvCurrent,cur.pvTimerPassed=0,clearTimeout(cur.pvTimer),cur.pvTimer=setTimeout(Photoview.doShow,0)),cur.pvBox&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown),!!o&&cancelEvent(o)}}}},_checkWebGL:()=>navigator.userAgent.indexOf("Windows NT 5.1")>=0?-1:function(){try{var e=document.createElement("canvas");e.width=e.height=100;var t={preserveDrawingBuffer:!0,premultipliedAlpha:!1};return!!window.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t))}catch(e){return!1}}()?1:browser.safari?(debugLog("photo editor: webgl enable needed"),-2):(debugLog("photo editor: webgl not suported"),-1),openEditor(e,t){function o(o){return o||debugLog("photo editor: CORS not available ("+t+")"),showBox("al_photos.php",{act:"edit_photo",photo:e||cur.pvData[cur.pvListId][cur.pvIndex].id,webgl:Photoview._checkWebGL(),cors:o},{dark:1,stat:["ui_controls.css","ui_controls.js"]})}t=t||cur.pvCurData.src;var r=vkImage();r.onerror=()=>o(0),r.onload=()=>o(1),r.crossOrigin="",r.src=t},showReportPhotoForm(){if(!cur.pvCurPhoto.reported){var e=_slicedToArray(Photoview._getViewedPhotoFullId().split("_"),2),t=e[0],o=e[1];(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_32__.showReportForm)("photo",t,o,(()=>{cur.pvCurPhoto.reported=!0,val(ge("pv_more_act_spam"),getLang("global_report_sent"))}))}},showReportPhotoCommentForm(e,t){(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_32__.showReportForm)("photo_comment",e,t,(()=>(0,_web_reports_reports__WEBPACK_IMPORTED_MODULE_32__.afterCommentReportSubmit)("photo",e,t)))},doShow(){var e=cur.pvCurData;if((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(e)||show(cur.pvImgProgress),(!e.width||!e.height)&&cur.pvTimerPassed<5e3)return clearTimeout(cur.pvTimer),cur.pvTimerPassed+=100,void(cur.pvTimer=setTimeout(Photoview.doShow,100));if(cur.pvShown)if(cur.pvCanvas)Photoview.pvCanvasSet();else{Photoview.toggleLightModeClass(!0),isVisible(cur.pvAlbumsWrap)&&(val("pva_scroll",layerWrap.scrollTop),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvAlbumsWrap),show(cur.pvPhotoWrap),Photoview.updateSize()),isVisible(cur.pvAlbumWrap)&&(val("pvsa_scroll",layerWrap.scrollTop),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvAlbumWrap),show(cur.pvPhotoWrap),Photoview.updateSize()),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_20__.default.hide(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvTitle),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--geo",!!e.restrictionGeo),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvPhoto,"ZPhotosRestriction--blur",(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(e));var t=cur.pvPhoto&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto);if(t&&t.src){var o=/https?:\/\/[a-z0-9\.\-]+/;(t.src.replace(o,"")!=e.src.replace(o,"")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(t,"ZPhotosRestriction")||e.restrictionGeo||e.restrictionBlur)&&V(e)}else V(e);if(addEvent((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto),"load",(()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvImgProgress))),Photoview.updatePhotoDimensions(),window.tooltips&&tooltips.destroyAll(cur.pvBox),"temp"==cur.pvListId)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvCommentsData),Photoview.toggleOnPhotoControls(!1),void Photoview.updateVerticalPosition();Photoview.toggleOnPhotoControls(!0);var r=cur.pvCurPhoto;if(r.peData)return r.closeOnPEEdit=!0,void Photoview.openStickersEditor(r);var a=!(r.commshown>=0)&&-r.commshown;cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),Photoview.hideTag(!0),(e.width<200||e.height<200)&&(r.actions.prof=!1,r.actions.dialog=!1);var _="";("NA"!=r.album&&2!=a||r.graffiti)&&(_=r.album);var i=!r.album||!r.author;if(!cur.pvIsLightMode&&!i){var s="";s+='<div class="pv_author_block clear_fix">';var n="";"NA"!=r.author&&(n=r.author),n&&(r.author_href&&(s+=`<a class="pv_author_img fl_l" href="${r.author_href}">`),s+=`<div class="ow_ava ow_ava_comm" style="background-image: url('${r.author_photo}');"></div>`,r.author_href&&(s+="</a>")),s+=`\n        <div class="pv_author_info">\n          <div id="pv_author_name">${n}</div>\n          <div class="pv_date_info_wrap">\n            <span id="pv_date_info">${r.date}</span>\n          </div>\n        </div>\n      </div>`,s+=getProgressHtml("pv_progress");var p=cur.pvCommsLikes[r.id],d=p[0],c=p[1];s+=Likes.makeTemplate(r.likes_tpl,{object_raw:r.id,likes_count:c||"",liked:r.liked,share_count:r.shares||"",share_opts:{list:cur.pvListId,to:"mail"}});var l=1&r.actions.edit||r.desc,v="";if(l){var u=r.desc||`<span class="pv_desc_edit">${getLang("photos_edit_desc")}</span>`,h="";1&r.actions.edit?(h+='class="pv_can_edit pv_desc_cont"',h+='onclick="Photoview.editInline(event)"'):h+='class="pv_desc_cont"',v=`<div ${h}>${u}</div>`}1==r.was_edited?s+=`<div id="pv_edit_info" class="pv_right_block">${getLang("photos_was_edited")}</div>`:r.was_edited&&(s+=`\n          <div id="pv_edit_info" class="pv_right_block" onmouseover="showTooltip(this, {\n            text: '${r.was_edited}',\n            black: 1\n          });">${getLang("photos_was_edited")}</div>`),s+='<div id="pv_desc" class="pv_right_block" style="'+(l?"":"display: none")+'">'+v+"</div>",s+='<div id="pv_attached_products_list"></div>',s+='<div id="pv_microdata">'+(r.microdata_html?r.microdata_html:"")+(r.microdata_preview_button?r.microdata_preview_button:"")+"</div>",r.microdata_html&&shortCurrency(),s+='<div id="pv_tags"'+(r.tagshtml?"":' style="display: none"')+' class="pv_right_block">'+getLang("photos_onthisphoto")+": "+r.tagshtml+"</div>",s+='<div id="pv_place" class="pv_right_block">'+(r.place?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+r.place+"</a>":"")+"</div>",s+=d.tagName?'<div id="pv_comments_place"></div>':trim(d),cur.pvReplyForm&&re(cur.pvReplyForm),cur.pvReplyForm=null,s+='<div id="pv_rotate"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>',cur.pvNarrow.innerHTML="",Photoview.updateRightBlock(),cur.pvNarrow.innerHTML=s;var g=_slicedToArray(Photoview.generateMarketList(r.attached_tags.tags),2),m=g[0],w=g[1];r.attached_tags.tags&&r.attached_tags.tags.length&&document.getElementById("pv_attached_products_list").appendChild(m),cur.pvImageAreaWrap.appendChild(w);var P=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_closed_commments_placeholder"),b=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_no_commments_placeholder");if(a||!r.actions.comm?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(P,"unshown"),a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(b,"unshown")):r.reply_form&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(P,"unshown"),r.replyFormEl=cur.pvReplyForm=r.replyFormEl||se(r.reply_form),cur.pvNarrowColumn.appendChild(cur.pvReplyForm),cur.onReplyFormSizeUpdate=cur.onMediaChanged=e=>{cur.pvShown&&Photoview.updateRightBlock()},cur.onReplyFormFocus=()=>{Photoview.updateRightBlock(!0),cur.pvNarrowScrollbar.scrollBottom(0,!0)}),d.tagName){each(geByClass("page_gif_loading",d),(()=>{Page.hideGif(this,!1)}));var f=ge("pv_comments_place");domPN(f).replaceChild(d,f)}if(cur.pvNarrowScrollbar=new uiScroll(cur.pvNarrow,{global:!0}),r.reply_form){var E=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("reply_field",cur.pvNarrowColumn);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(E,"send",Photoview.sendComment),placeholderInit(E,{editable:1}),cur.pvOptions.commentFocusInit){delete cur.pvOptions.commentFocusInit;var T=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("submit_post_field",cur.pvReplyForm);T&&T.focus()}}cur.editing=!1,Photoview.updateRightBlock()}var D=[];if(_=_||"",cur.pvAlbumName.innerHTML=_,toggle(cur.pvBottomInfo,!cur.pvIsLightMode||cur.pvShowBottomActions||_),vk.id&&r.actions.share&&D.push(`<a id="pv_share" onclick="Photoview.sendPhoto()">${getLang("photos_share_from_view")}</a>`),!r.taginfo&&r.actions.tag&&r.tags[0]<cur.pvMaxTags&&!(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(r)&&D.push(`\n          <a id="pv_tag_link" onclick="stManager.add([jsc('web/photo_tagger_mode.js'), 'tagger.css', jsc('web/tagger.js')], () => {\n            Phototag.startTag();\n          })">${getLang("photos_tagperson")}</a>`),r.actions.del&&D.push(`<a id="pv_delete" onclick="Photoview.deletePhoto()">${getLang("photos_pv_act_delete")}</a>`),r.actions.save&&D.push(`<a id="pv_save_to_me" onclick="Photoview.savePhoto()">${getLang("photos_pv_act_save")}</a>`),cur.pvShowBottomActions&&!i){var C=[];if(r.actions.spam){var L=cur.pvCurPhoto.reported?getLang("global_report_sent"):getLang("photos_report");C.push(["spam",L,"Photoview.showReportPhotoForm()"]),C.push("sep")}if(r.actions.forbid){var M=Photoview._getViewedPhotoFullId().split("_"),I=M[0],O=M[1];C.push(["atfr",getLang("reports_atfr"),"sfof("+I+", "+O+", 1)"])}if(r.actions.blur){var S=Photoview._getViewedPhotoFullId().split("_"),A=S[0],y=S[1];C.push(["b",getLang("reports_b"),"scblf('photo', "+A+", "+y+")"])}if(r.actions.geoBlock){var B=Photoview._getViewedPhotoFullId().split("_"),k=B[0],W=B[1];C.push(["gb",getLang("reports_gb"),"scgbf('photo', "+k+", "+W+")"])}if(r.actions.edit&&(r.peType&Photoview.PE_V1||r.peType&Photoview.PE_V2)&&C.push(["pe",getLang("photos_pv_act_photoeditor"),"Photoview.openEditor()"]),vk.id&&r.actions.pe&&r.peType&Photoview.PE_V3&&(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_16__.isPhotoeditor3Available)()&&!inArray(nav.objLoc[0],["support","helpdesk"])&&!r.restrictionGeo&&!(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(r)){var x=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_29__.partConfigEnabled)("web_photo_editor_hide_entrypoint")?getLang("photos_pv_act_photoeditor"):getLang("global_pe_edit");C.push(["spe",x,"Photoview.openStickersEditor()"])}if(r.actions.rotate?(C.push(["rotate_ccw",getLang("photos_pv_act_rotate_ccw"),"Photoview.rotatePhoto(-1)"]),C.push(["rotate_cw",getLang("photos_pv_act_rotate_cw"),"Photoview.rotatePhoto(1)"]),C.push("sep")):r.actions.rot&&(C.push(["rotate_ccw",getLang("photos_pv_act_rotate_ccw"),"Photoview.rotatePhotoOld(-1)"]),C.push(["rotate_cw",getLang("photos_pv_act_rotate_cw"),"Photoview.rotatePhotoOld(1)"]),C.push("sep")),r.actions.place&&C.push(["place",getLang("photos_edit_add_place"),"Photoview.editPlace()"]),r.attached_tags&&r.attached_tags.hash){var R=`<div class="pv_more_act_item_icon">${(0,_icons_desktop_getIcon16Market__WEBPACK_IMPORTED_MODULE_34__.getIcon16Market)().icon}</div>`;C.push(["market",`${R} ${getLang("photos_edit_add_market")}`,"Photoview.selectProductInBox()"])}if(r.actions.prof&&r.profile_data){var U=JSON.stringify(r.profile_data);C.push(["to_profile",getLang("photos_pv_act_to_avatar"),"","",`data-task-click='Page/owner_set_exist_photo' data-options='${U}'`])}if(r.actions.dialog&&C.push(["to_dialog",getLang("photos_load_to_dialog"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${r.id}', oid: ${r.actions.dialog}, list: '${cur.pvListId}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]});`]),r.actions.move){var F=r.id.split("_")[0];C.push(["move_to",getLang("photos_pv_act_move_to_album"),`\n            showBox('al_photos.php', {act: 'a_move_to_album_box', photo_id: '${r.id}', owner_id: ${F}}, {stat: ['page.js', 'page.css', 'wide_dd.js', 'wide_dd.css']})\n          `]),r.actions.cover&&C.push(["as_title",getLang("photos_album_to_cover"),`\n              ajax.post('al_photos.php', {act: 'a_set_as_album_title', photo: '${r.id}', hash: '${r.hash}'}, {onDone: showDoneBox})\n            `])}var K="";each(C,((e,t)=>{"sep"===t?0!==e&&e!==C.length-1&&(K+='<div class="pv_more_act_item_sep"></div>'):K+=`\n              <div class="pv_more_act_item" onmouseover="${t[3]||""}" onclick="${t[2]||""}" id="pv_more_act_${t[0]}" ${t[4]||""}>\n                ${t[1]}\n              </div>\n            `})),r.restrictionGeo||(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(r)||(K+=`<a\n          class="pv_more_act_item"\n          id="pv_more_act_download"\n          target="_blank"\n          rel="noopener"\n          href="${Photoview.genData(r,"w").src}\n        ">\n            ${getLang("photos_pv_act_open_original")}\n        </a>`),K=`<div class="pv_more_acts">${K}</div>`,C.length?(C=(C=JSON.stringify(C)).replace(/\"/g,"&quot;"),D.push(`<a class="pv_actions_more" data-items="${C}">${getLang("photos_actions_more")}</a>`)):inArray(nav.objLoc[0],["support","helpdesk"])&&D.push(`\n            <a id="pv_more_act_download" target="_blank" rel="noopener" href="${Photoview.genData(r,"w").src}">\n              ${getLang("photos_pv_act_open_original")}\n            </a>\n          `),D=D.join('<span class="divider"></span>'),cur.pvIsLightMode&&(D+='<div id="pv_rotate" style="display:none;"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>'),cur.pvBottomActions.innerHTML=D;var N=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_actions_more");N&&(cur.pvMoreActionsTooltip=new ElementTooltip(N,{id:"pv_more_acts_tt",forceSide:"top",elClassWhenShown:"pv_more_shown",content:K,offset:[0,-5],autoShow:!0,noHideOnClick:!0}))}if(Photoview.updatePhotoDimensions(),extend(cur,{pvTagLink:ge("pv_tag_link"),pvLikeIcon:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_like_icon"),pvLikeLink:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_like_link"),pvDesc:ge("pv_desc"),pvTags:ge("pv_tags"),pvEditing:!1,pvProgress:ge("pv_progress")}),r.deleted||!r.author)cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),isArray(r.deleted)&&Photoview.toggleTopInfoPanel(r.deleted[0],r.deleted[1]),i||Photoview.toggleDeletedState(!0);else if(r.taginfo){cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");var H=getLang("photos_confirm_tag"),j=getLang("photos_delete_tag"),$=`\n        <button class="flat_button" id="pv_confirm_tag" onclick="Photoview.confirmTag(${r.tagid}, this)">\n          ${H}\n        </button>\n        <button class="flat_button secondary black" id="pv_delete_tag" onclick="Photoview.deleteTag(${r.tagid}, this)">\n          ${j}\n        </button>\n      </div>\n      `;Photoview.toggleTopInfoPanel(r.taginfo,$),show(cur.pvCommentsData)}else r.suggestedTagsInfo?Photoview.showSuggestedInfoTopPanel(r):(Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1));(cur.pvOptions||{}).scroll&&cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollTop(cur.pvOptions.scroll),cur.pvBodyScrollTop=bodyNode.scrollTop,setTimeout((function(){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop)}),0),Photoview.updateVerticalPosition();var z=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto);cur.pvPhotoTags?cur.pvPhotoTags.reload(z):vk.id&&(cur.pvPhotoTags=new _photo_tags__WEBPACK_IMPORTED_MODULE_14__.default(z,cur.pvPhotoTagsContainer)),setTimeout(Photoview.afterShow,2)}function V(e){var t="";if((0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(e)){var o=`event.stopPropagation(); Page.unblurPhoto('${e.photoRaw}', '${e.unblurHash}', this);`;t=`<div class="ZPhotosRestriction__title">${e.restrictionTitle||" "}</div><div class="ZPhotosRestriction__text">${e.restrictionText}</div><button class="ZPhotosRestriction__button" onmousedown="${o}">${getLang("photos_restriction_button_watch")}</button>`}e.restrictionGeo&&(t=`<div class="ZPhotosRestriction__title">${e.restrictionText||" "}</div>`),cur.pvPhoto.innerHTML='<img src="'+(e.src||"/images/blank.gif")+'" />'+t}},toggleTopInfoPanel(e,t){var o=!!isString(e)||!!e;void 0!==e&&(cur.pvTagInfoText.innerHTML=e),void 0!==t&&(cur.pvTagInfoButtons.innerHTML=t),cur.pvTagInfo.classList.toggle("PhotoViewTopPanel--show",o),Photoview.updatePhotoTagsContainerDimensions(),Photoview.updatePhotoDimensions()},toggleDeletedState(e){e=!!e,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvCont,"pv_deleted_state",e),Photoview.updateRightBlock()},showSuggestedInfoTopPanel(e){if((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_29__.partConfigEnabled)("photo_recognition_web")&&e.suggestedTagsInfo){cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags");var t=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.getPhotoData)("suggested_tags");if(t){var o=Object.keys(t);if(o.length){var r="",a="";if(o.length>1)r=getLang("photo_tag_confirm_all"),a=getLang("photo_recognition_decline_all");else t[o[0]][4]===vk.id?(r=getLang("photo_recognition_item_confirm_me"),a=getLang("photo_recognition_item_decline_me")):(r=getLang("photos_confirm_tag"),a=getLang("photos_delete_tag"));var _=`\n        <button class="flat_button" id="pv_confirm_suggested_tags" onclick="Photoview.confirmAllSuggestedTags(this)">\n          ${r}\n        </button>\n        <button class="flat_button secondary black" id="pv_decline_suggested_tags" onclick="Photoview.declineAllSuggestedTags(this)">\n          ${a}\n        </button>\n      </div>\n      `;Photoview.toggleTopInfoPanel(e.suggestedTagsInfo,_)}}}},updatePhotoTagsContainerDimensions(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto);if(t){e||(e=t.offsetWidth);var o=t.offsetLeft,r=t.offsetTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvPhotoTagsContainer,{top:r+"px",left:o+"px",width:e+"px"})}},updateTagFrameDimensions(e,t,o){var r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto);if(r){var a=r.offsetLeft,_=r.offsetTop;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagFaded,{width:cur.pvPhWidth+"px",height:cur.pvPhHeight+"px",left:a+"px",top:_+"px"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagFrame,{left:a+"px",top:_+"px"}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagPerson,{left:a+"px",top:_+"px"}),e&&t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvTagFrame),{width:e,height:t,marginTop:intval(o)})}},afterShow(){cur.pvPhoto.href="/photo"+cur.pvCurPhoto.id,cur.pvPhoto.focus(),4&cur.pvCurPhoto.actions.edit&&1&cur.pvCurPhoto.actions.edit&&!cur.pvCurPhoto.desc&&Photoview.editInline(),cur.pvTagFrame.innerHTML='<img src="'+(cur.pvCurData.src||"/images/blank.gif")+'" />',Photoview.updateTagFrameDimensions(),(cur.pvOptions||{}).scroll&&(layerWrap.scrollTop=cur.pvOptions.scroll,cur.pvOptions.scroll=0),Photoview.updateLoc(),Photoview.updatePhotoDimensions()},pvCanvasUpdate(e){var t=cur.pvCurData;if(cur.pvCanvas&&t&&t.width&&t.height){cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight;var o,r=t.width||604,a=t.height||453,_=cur.pvScrWidth/r,i=ge("pv_fs_img_fade")||ge("pv_fs_img_wrap"),s=i&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(i);a*_>cur.pvScrHeight&&(_=cur.pvScrHeight/a),_>1.25&&(_=1.25),r=Math.floor(r*_),a=Math.floor(a*_),o=Math.floor((cur.pvScrHeight-a)/2),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(s,"ZPhotosRestriction--geo",!!t.restrictionGeo),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(s,"ZPhotosRestriction--blur",(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(t));var n="";n=t.restrictionGeo?`<div class="ZPhotosRestriction__title">${t.restrictionText||" "}</div>`:(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.isImgBlurred)(t)?`<div class="ZPhotosRestriction__title">${t.restrictionTitle||" "}</div>`:"",s.innerHTML!==n&&(s.innerHTML=n),(cur.pvFSWidth!=r||cur.pvFSHeight!=a||cur.pvFSTop!=o||e)&&(cur.pvFSWidth=r,cur.pvFSHeight=a,cur.pvFSTop=o,s&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(s,{marginTop:o,width:r,height:a}),s.style.backgroundImage=`url('${t.src}')`))}},pvCanvasSet(){var e=cur.pvCurData;if(cur.pvCanvas&&e){var t,o=vkImage(),r=()=>{ge("pv_fs_img_fade")&&(re("pv_fs_img_wrap"),ge("pv_fs_img_fade").id="pv_fs_img_wrap")};r(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(ge("pv_fs_img_wrap"))&&cur.pvSlideNeedAnimation?(cur.pvSlideNeedAnimation=!1,cur.pvCanvas.insertBefore(se(`<div id="pv_fs_img_fade"><div style="background-image: url('${e.src}')" /></div>`),ge("pv_fs_img_wrap")),t=()=>{cssAnim(ge("pv_fs_img_wrap"),{opacity:0},{duration:1e3},(()=>{r(),Photoview.fullscreenOnLoad()})),cssAnim(ge("pv_fs_img_fade"),{opacity:1},{duration:1e3})}):(val(ge("pv_fs_img_wrap"),`<div style="background-image: url('${e.src}')" /></div>`),t=Photoview.fullscreenOnLoad),Photoview.pvCanvasUpdate(!0),o.onload=t,o.src=e.src,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_12__.FullscreenPV.updateInfo()}},updateLoc(){var e,t=cur.pvListId;cur.pvRoot?(e={0:"photo"+cur.pvCurPhoto.id},"photos"==t.substr(0,6)?e.all=1:"tag"==t.substr(0,3)?e.tag=intval(t.substr(3)):"newtag"==t.substr(0,6)&&(e.newtag=intval(t.substr(6))),-1!=t.indexOf("/rev")&&(e.rev=1),(0,_internal_nospam_common__WEBPACK_IMPORTED_MODULE_22__.isClaimContent)()&&(e.claim=window.nav.objLoc.claim,e.dmcah=window.nav.objLoc.dmcah)):e=extend(nav.objLoc,{z:"photo"+cur.pvCurPhoto.id+"/"+(cur.pvCurPhoto.list_override||t)}),nav.strLoc!=nav.toStr(e)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(e),(cur.pvOptions||{}).fromQueue&&(cur.pvNoHistory=!0,cur.pvHistoryLength=0)),cur.pvOptions&&(cur.pvOptions.fromQueue=!1)},canFullscreen(){var e=browser,t=floatval(browser.version);return!e.mobile&&(document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||e.safari&&t>5)},fullscreenOnLoad(){_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_12__.FullscreenPV.slide()},fullscreenEnd(e){var t=cur.pvCanvas;t&&(cleanElems(t),re(t),clearTimeout(cur.pvFSTimer),clearTimeout(cur.pvFSControlsTimer),cur.pvCanvas=cur.pvFSControls=cur.pvFSTimer=cur.pvFSControlsTimer=!1,removeEvent(document,"webkitfullscreenchange mozfullscreenchange fullscreenchange webkitfullscreenerror mozfullscreenerror fullscreenerror"),show(pageNode),cur.pvCanvasUpdateTO&&clearInterval(cur.pvCanvasUpdateTO),void 0!==cur.pvScrWasY&&(scrollToY(cur.pvScrWasY,0),delete cur.pvScrWasY),!0!==e&&(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex)))},fullscreen(e){if(!cur.pvCanvas&&!cur.pe){var t=cur.pvCanvas=bodyNode.appendChild(ce("div",{className:"fixed",id:"pv_fullscreen",innerHTML:'<div id="pv_fs_img_wrap"></div>'})),o=t.requestFullscreen||t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullscreen;cur.pvFinishing=!1,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_12__.FullscreenPV.init(),addEvent(document,"webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",Photoview.onFullscreen),addEvent(document,"webkitfullscreenerror mozfullscreenerror MSFullscreenError fullscreenerror",Photoview.fullscreenEnd.pbind(!0));try{o.call(t)}catch(e){cur.pvPartScreen=!0,Photoview.onFullscreen()}return cancelEvent(e)}},fullscreenStop(e){cur.pvFinishing=!0===e,cur.pvPartScreen=!1;var t=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen;try{t.call(document)}catch(e){Photoview.onFullscreen()}setTimeout(Photoview.fullscreenEnd,30)},onFullscreen(){(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_27__.isFullScreen)()?(cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight,cur.pvScrWasY=scrollGetY(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(pageNode),cur.pvCanvasUpdateTO=setInterval(Photoview.pvCanvasUpdate.pbind(!1),100),cur.pvFinishing||(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex))):Photoview.fullscreenEnd(cur.pvFinishing)},showDD(e,t){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(e,"pv_report_blocked")&&t&&(clearTimeout(cur.hideShareTimer),e.blur(),!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(t,"pv_dd_hiding"))){if(isVisible(t))return fadeIn(t,0);cur.ddShown&&Photoview.hideDD(0),cur.ddShown=t,setTimeout(addEvent.pbind(document,"click",Photoview.hideDD),1),show(t)}},hideDD(e){if(e>0)cur.hideShareTimer=setTimeout(Photoview.hideDD.pbind(0),e);else{var t=cur.ddShown;t&&(-1==e?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(t):((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(t,"pv_dd_hiding"),fadeOut(t,200,(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(t,"pv_dd_hiding")}))),removeEvent(document,"click",Photoview.hideDD),cur.ddShown=!1)}},createDD:(e,t)=>`\n      <div onmouseover="Photoview.showDD(this.previousSibling, this);" onmouseout="Photoview.hideDD(500)" onclick="Photoview.hideDD(-1)" class="pvs_dd fixed">\n        <table cellspacing="0" cellpadding="0">\n          <tr>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n            <td>\n              <div class="pvs_header_wrap">\n                <div class="pvs_header">\n                  <span class="pvs_header_text">${t}</span>\n                </div>\n              </div>\n              <div class="pvs_acts">${e}</div>\n              <div class="pvs_sh1"></div>\n              <div class="pvs_sh2"></div>\n            </td>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n          </tr>\n        </table>\n       </div>\n    `,showShare(){clearTimeout(cur.hideShareTimer);var e=ge("pvs_dd");if(ge("pv_share").blur(),isVisible(e))return fadeIn(e,0);setTimeout(addEvent.pbind(document,"click",Photoview.hideShare),1),show(e)},hideShare(e){if(e>0)cur.hideShareTimer=setTimeout(Photoview.hideShare.pbind(0),e);else{var t=ge("pvs_dd");t&&(-1==e?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(t):fadeOut(t,200),removeEvent(document,"click",Photoview.hideShare))}},savePhoto(){var e=cur.pvListId,t=cur.pvData[e][cur.pvIndex];ajax.post("al_photos.php",{act:"save_me",photo:t.id,list:e,hash:t.hash},{onDone:()=>{var e=document.getElementById("pv_save_to_me");domPN(e).replaceChild(ce("div",{className:"pv_save_to_me_saved",innerHTML:getLang("photos_pv_act_save_saved")}),e),t.actions.save=0},onFail:e=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_24__.showFastBox)(getLang("global_error"),e),!0)})},sendPhoto(){var e=cur.pvListId,t=cur.pvIndex,o=cur.pvData[e][t];showBox("like.php",{act:"publish_box",object:"photo"+o.id,list:e,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",jsc("web/sharebox.js")]})},moveToAlbumBox:(e,t,o)=>!showBox("al_photos.php",{act:"a_move_to_album_box",photo_id:e+"_"+t,owner_id:e,from:o},{stat:["page.js","page.css","wide_dd.js","wide_dd.css"]}),moveToAlbum(e,t,o){ajax.post("al_photos.php",{act:"a_move_photo",photo:e,album_id:t,hash:o},{onDone:e=>{curBox().hide();var t=ge("pv_album_name");t&&(t.innerHTML=e),cur.pvCurPhoto.album=e,showDoneBox('<div class="pv_done_box">'+getLang("photos_move_to_album_success").replace("{album}",e)+"</div>")}})},setTags(e){Photoview.hideTag(),e?(show(cur.pvTags),window.tooltips&&each(geByClass("delete",cur.pvTags),(()=>{tooltips.destroy(this)})),cur.pvTags.innerHTML=getLang("photos_onthisphoto")+": "+e):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvTags)},preload(e,t){window.updateWndVScroll&&updateWndVScroll();var o=cur.pvListId,r=((cur.pvData||{})[o]||{}).length;if(r){var a=cur.pvVeryBig>2?"w":cur.pvVeryBig?"z":"y",_=cur.pvVeryBig>1||cur.pvVeryBig?"z":"y",i=cur.pvVeryBig>1?"z":cur.pvVeryBig?"y":"x",s=cur.pvVeryBig>1?"y":cur.pvVeryBig?"x":0;cur.pvLastFrom=e,cur.pvLastDirection=t;for(var n=Photoview.allSizes,p=0;p<Math.min(Photoview.cacheSize,r-Photoview.cacheSize);++p){for(var d=e+(p+1)*-t;d>=r;)d-=r;for(;d<0;)d+=r;var c=cur.pvData[o][d];if(c)for(var l=0,v=n.length;l<v;++l){var u=n[l];c[u]&&c[u].src&&(c[u].src=Photoview.blank,delete c[u])}}var h=function(n){for(var p=e+(n+1)*t;p>=r;)p-=r;for(;p<0;)p+=r;var d=cur.pvData[o][p];return d&&d.id?d[a]?"continue":d[a+"_src"]?(d[a]=vkImage(),d[a].src=d[a+"_src"],"continue"):(d[a]=1,d[_]?"continue":d[_+"_src"]?(d[_]=vkImage(),d[_].src=d[_+"_src"],"continue"):(d[_]=1,d[i]?"continue":d[i+"_src"]?(d[i]=vkImage(),d[i].src=d[i+"_src"],"continue"):(d[i]=1,d[s]?"continue":d[s+"_src"]?(d[s]=vkImage(),d[s].src=d[s+"_src"],"continue"):(d[s]=1,d.x?"continue":(d.x=vkImage(),void(d.x.src=d.x_src)))))):((!d||vkNow()-d>3e3)&&(cur.pvData[o][p]=vkNow(),setTimeout((()=>{ajax.post("al_photos.php",{act:"show",gid:cur.gid,list:o,offset:Photoview.realOffset(o,p,-1),direction:t},{onDone:Photoview.loaded})}),10)),"break")};e:for(var g=0;g<Photoview.cacheSize;++g){switch(h(g)){case"break":break e;case"continue":continue}}}},hide(e,t){if(Photoview.hideTag(!0),cur.pvShown&&(!__afterFocus||!0===t)){if(cur.pvCanvas&&Photoview.fullscreenStop(!0),cur.prevPhotoWidth=cur.prevPhotoHeight=0,(cur.pvJumpTo||{}).z=="albums"+val("pva_owner")&&!cur.pvAlbumsShown&&0===e)return Photoview.jumpToAlbums(!0);if((cur.pvJumpTo||{}).z=="album"+val("pvsa_album")&&!cur.pvAlbumShown&&0===e)return Photoview.jumpToAlbum(!0);if((cur.pvJumpTo||{}).z=="tag"+val("pvsa_tag")&&!cur.pvPhotoTagShown&&0===e)return Photoview.jumpToTagged(!0);if("temp"==cur.pvListId)cur.pvCancelLoad();else if(!cur.pvNoHistory&&!e&&cur.pvHistoryLength>0&&cur.pvHistoryLength<10)return cur.pvNoHistory=!0,__adsUpdate("very_lazy"),cur.pvBodyScrollTop=bodyNode.scrollTop,history.go(-cur.pvHistoryLength);var o;if(!0!==e&&!layerQueue.count())cur.pvRoot?("newtag"==cur.pvListId.substr(0,6)?(o="albums"+vk.id+"?act=added",-1!=cur.pvListId.indexOf("/rev")&&(o+="&rev=1")):o=cur.pvListId.replace(/^photos/,"albums").replace("/rev","?rev=1"),nav.setLoc(o)):delete(o=clone(nav.objLoc)).z,nav.strLoc!=nav.toStr(o)&&nav.setLoc(o),__adsUpdate("very_lazy");window.__pvhideTimer=setTimeout(Photoview.doHide.pbind(cur),0),__adsUpdate(),cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1}},doHide(e){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop),cur.pvTaggerTooltip&&(cur.pvTaggerTooltip.unMount(),delete cur.pvTaggerTooltip),e.pvHistoryLength=0,cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag(),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),e.pvFriends&&(cleanElems("pv_add_tag","pv_cancel_tag",e.pvFriends.firstChild.firstChild,e.pvFriends),re(e.pvFriends),e.pvFriends=e.pvFriendName=!1),_web_page_wall__WEBPACK_IMPORTED_MODULE_21__.default.cancelEdit(!0);var t=Photoview.allSizes,o=e.pvListId,r=((e.pvData||{})[o]||{}).length;if(e.pvLastDirection&&r){for(var a=0;a<Photoview.cacheSize;++a){for(var _=e.pvLastFrom+(a+1)*e.pvLastDirection;_>=r;)_-=r;for(;_<0;)_+=r;var i=e.pvData[o][_];if(i)for(var s=0,n=t.length;s<n;++s){var p=t[s];i[p]&&i[p].src&&(i[p].src=Photoview.blank,delete i[p])}}e.pvLastDirection=e.pvLastFrom=!1}if(cur.pvYourComment=re(cur.pvYourComment),layers.hide(),layers.fullhide=!1,delete cur.pvLayerCreated,window.tooltips&&tooltips.destroyAll(cur.pvBox),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(layerWrap,"pv_layer_wrap"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(layerBG,"pv_layer"),layerBG.style.opacity="",e.pvShown=e.pvListId=e.pvClicked=!1,removeEvent(window,"resize",Photoview.onResize),removeEvent(document,"keydown",Photoview.onKeyDown),removeEvent(layerWrap,"click",Photoview.onLayerClick),removeEvent(layerWrap,"scroll",Photoview.scrollResize),removeEvent(layerWrap,"mousemove",Photoview.onLayerMouseMove),cur.pvOptions){var d=cur.pvOptions.onHide;cur.pvOptions.onHide=!1,d&&d()}if(layerQueue.pop(),Photoview.destroyPeriod(),e.pvPreloaded&&e===cur){for(var c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("photos_container"),l=ce("div",{innerHTML:e.pvPreloaded});l.firstChild;)c.appendChild(l.firstChild);c.qsorter&&setTimeout(qsorter.added.pbind(c),0),e.pvPreloaded=!1}_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_20__.default.hide(),Photoview.toggleFastChats(!0),delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&(cur.pvPhotoTags.unMount(),delete cur.pvPhotoTags)},editPhoto(){},descTT:e=>(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_25__.showTooltip)(e,{text:getLang("photos_edit_desc"),black:1,shift:[-160,13,0],showdt:0,appendParentCls:"narrow_column"}),editInline(e){if("A"!=((e||window.event||{}).target||{}).tagName&&!cur.pvEditing){window.tooltips&&window.tooltips.hideAll();var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o],a=e=>{if(cur.pvShown&&cur.pvListId==t&&cur.pvIndex==o&&!cur.pvEditing){cur.pvEditing=[t,o];var r=ge("pv_caption_warn"),a=getLang("photos_edit_desc_intro"),_=cur.pvDesc.appendChild(ce("div",{innerHTML:`\n          <textarea\n            class="dark"\n            id="pv_edit_text"\n            onkeydown="onCtrlEnter(event, Photoview.saveInline)"\n            onkeyup="checkTextLength(cur.pvCaptionLimit, this, ${r});"\n            placeholder="${a}"\n          >${e}</textarea>\n          <div id="pv_caption_warn"><div>`},{display:"none"})),i=ge("pv_edit_text");autosizeSetup(i,{minHeight:21,maxHeight:350}),setTimeout((()=>{show(_),elfocus(i),addEvent(i,"blur",Photoview.saveInline),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvDesc.firstChild),cur.pvNarrowScrollbar.scrollTop(0)}),1)}};!r.desc?a(""):ajax.post("al_photos.php",{act:"edit_desc",photo:r.id},{onDone:a,progress:cur.pvProgress})}},cancelInline(){cur.pvEditing=!1,removeEvent(ge("pv_edit_text"),"blur"),show(cur.pvDesc.firstChild),re(cur.pvDesc.firstChild.nextSibling)},saveInline(){if(cur.pvEditing){removeEvent(ge("pv_edit_text"),"blur");var e=cur.pvEditing[0],t=cur.pvEditing[1],o=cur.pvData[e][t],r=trim(val("pv_edit_text"));if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_desc_edit",cur.pvDesc)&&!r)return Photoview.cancelInline();ajax.post("al_photos.php",{act:"save_desc",photo:o.id,hash:o.hash,text:r},{onDone:r=>{if(o.desc=r,cur.pvShown&&e==cur.pvListId&&t==cur.pvIndex){cur.pvEditing=!1;var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvDesc);val(a,r||'<span class="pv_desc_edit">'+getLang("photos_edit_desc")+"</span>"),a.onmouseover=r?Photoview.descTT.pbind(a):()=>{},show(a),re(domNS(a))}},progress:cur.pvProgress})}},cmp(e,t){var o=e.length,r=t.length;return o<r?-1:o>r?1:e<t?-1:e>t?1:0},receiveComms(e,t,o,r,a,_){if(e==cur.pvListId&&t==cur.pvIndex){for(var i=ce("div",{innerHTML:o}),s=ge("pv_comments_list"),n=domLC(s),p=getXY(c,!0)[1],d=cur.pvData[e][t],c=n,l=domLC(i);l;l=domLC(i)){for(d.actions.comm&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(l,"reply_replieable");c&&Photoview.cmp(c.id,l.id)>0;)c=domPS(c);c&&!Photoview.cmp(c.id,l.id)?(s.replaceChild(l,c),c=l):(c&&domNS(c)?s.insertBefore(l,domNS(c)):!c&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(s)?!0===a?(--d.commshown,i.removeChild(l)):s.insertBefore(l,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(s)):s.appendChild(l),++d.commshown)}_&&n&&(layerWrap.scrollTop+=getXY(n,!0)[1]-p),cur.pvCommsLikes[d.id][0]=ge("pv_comments"),extend(cur.pvReplyNames,r),Photoview.updateComms()}},commSaved(e){if(cur.pvShown){var t=ge("pv_comments"),o=!!t&&cur.pvData[cur.pvListId][cur.pvIndex],r=e.match(/^(-?\d+)photo(_\d+)/);o&&r&&ge("pv_comment"+r[1]+r[2])&&(cur.pvCommsLikes[o.id][0]=t)}},comments(e){if(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(ge("pv_comments")).id||"";if(!isVisible("pv_comments_header")||Photoview.cmp(t,"pv_comment"+e)<0)return}var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r],_=ge("pv_comments_header");ajax.post("al_photos.php",{act:"photo_comments",offset:a.commshown,photo:a.id,list_id:cur.pvListId},{onDone:(t,a)=>{Photoview.receiveComms(o,r,t,a,!1,e),e&&ge("pv_comment"+e)&&Photoview.showComment(e)},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((()=>{_.innerHTML="",showProgress(_)})),hideProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((()=>{hideProgress(_)}))})},updateComms(e){var t=cur.pvData[cur.pvListId][cur.pvIndex],o=ge("pv_comments_header"),r="";t.commcount>t.commshown&&(r=getLang("photos_show_prev_comments",t.commcount-t.commshown)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(ge("pv_comments_list"),"unshown",!e&&0==t.commcount),toggle(o,r),toggle((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_no_commments_placeholder"),0==t.commcount&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("_post_content",cur.pvBox)),o.innerHTML=r},commentChanged(){checkTextLength(cur.pvCommLimit,cur.pvComment),cur.pvCommenting=cur.pvData[cur.pvListId][cur.pvIndex].id},updateRightBlock(e){function t(){var e=getSize(cur.pvLeftWrap)[1]-(cur.pvReplyForm?getSize(cur.pvReplyForm)[1]:0);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvNarrow,"height",e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pv_no_commments_placeholder_wrap");if(t&&(isVisible(t.children[0])||isVisible(t.children[1]))){var o=getSize(t)[1],r=getSize("pv_comments_list")[1],a=e-ge("pv_comments").offsetTop-r;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(t,"margin-top",Math.max(0,a/2-o/2))}}t(),clearTimeout(cur.pvRightBlockUpdateTO),cur.pvRightBlockUpdateTO=setTimeout(t)},getReplyAsGroupEl:()=>ge("pv_reply_as_group"),sendComment(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=cur.pvListId,a=cur.pvIndex,_=cur.pvData[r][a],i=ge("reply_field"+e),s=i&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.data)(i,"composer"),n=(cur.pvReplyNames[(cur.reply_to||{})[0]]||[])[1],p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("addpost_button",cur.pvReplyForm),d={},c=o.stickerId;if(c)d={message:"",attach1_type:"sticker",attach1:c,sticker_referrer:o.sticker_referrer};else{if((d=s?Composer.getSendParams(s,Photoview.sendComment.pbind(e)):{message:trim(Emoji.editableVal(i))}).delayed)return;if(!d.attach1_type&&(!d.message||n&&!n.indexOf(d.message)))return void Emoji.editableFocus(i,!1,!0)}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)("reply_warn"+e);var l=Photoview.getReplyAsGroupEl();ajax.post("al_photos.php",_web_page_wall__WEBPACK_IMPORTED_MODULE_21__.default.fixPostParams(extend(d,{act:"post_comment",photo:_.id,hash:_.hash,from_group:l&&domData(domClosest("_submit_post_box",ge(l)),"from-oid")<0?1:"",reply_to:(cur.reply_to||{})[1]})),{onDone:(o,n)=>{++_.commcount,Photoview.receiveComms(r,a,o,n,!0),c||(s?Composer.reset(s):Emoji.val(i,"")),i.autosize&&i.autosize.update(),browser.mobile?_web_page_wall__WEBPACK_IMPORTED_MODULE_21__.default.hideEditReply(e):(Emoji.editableFocus(i,!1,!0),_web_page_wall__WEBPACK_IMPORTED_MODULE_21__.default.cancelReplyTo(e,t)),re("reply_link"+e),_web_page_wall__WEBPACK_IMPORTED_MODULE_21__.default.hideEditPostReply(null,!0),cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollBottom(),Photoview.updateRightBlock()},showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(p)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(p)}})},highlightComment(e){if(e=ge(e)){var t=getXY(e,!0)[1],o=animate.pbind(e,{backgroundColor:"#ECEFF3"},200,(()=>{setTimeout((()=>{animate(e,{backgroundColor:"#FFF"},200,(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(e,{backgroundColor:""})}))}),1e3)}));t<0||t>lastWindowHeight-200?animate(layerWrap,{scrollTop:layerWrap.scrollTop+t-50},300,o):o()}},showComment(e){var t=ge("pv_comment"+e);return t?Photoview.highlightComment(t):Photoview.comments(e),!1},commDone(node,text,del,script){if(node){var fc=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(node),msg=domNS(fc),ph=null!=cur.pvListId&&null!=cur.pvIndex&&cur.pvData[cur.pvListId][cur.pvIndex];if(!text)return show(fc),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(msg),void(ph?(++ph.commcount,++ph.commshown,Photoview.updateComms()):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_11__.photos.recache(cur.offset,1));if(msg?(msg.innerHTML=text,show(msg)):node.appendChild(ce("div",{innerHTML:text})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(fc),del&&(ph?(--ph.commshown,--ph.commcount,Photoview.updateComms(del)):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_11__.photos.recache(cur.offset,-1)),ph&&(cur.pvCommsLikes[ph.id][0]=ge("pv_comments")),script)try{eval(script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_15__.logEvalError)(e,script)}}},commProgress(e,t){var o=ge("pv_actions"+e);if(o){var r=o.firstChild.nextSibling;if(!0!==t)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(r),void show(o.firstChild);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(o.firstChild),r||(r=o.appendChild(ce("div",{className:"progress"}))),show(r)}},commParams:(e,t)=>({onDone:Photoview.commDone.pbind(e,t),progress:"pv_progress"+e+t,stat:[jsc("web/privacy.js"),"privacy.css"]}),commAction(e,t,o,r){if("spam"!==e){var a=gpeByClass("reply",t),_=gpeByClass("post_actions",t),i="post_actions_progress";(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(a,i)||ajax.post("al_photos.php",{act:e+"_comment",comment:o,hash:r},{onDone:Photoview.commDone.pbind(a),showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass.pbind(_,i),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass.pbind(_,i)})}else{var s=_slicedToArray(o.split("_"),2),n=s[0],p=s[1];this.showReportPhotoCommentForm(n,p)}},_isOverLayer:e=>e.target==layer||e.target==cur.pvCont,_isOverLayerLeft(e){if(Photoview._isOverLayer(e)){var t=getXY(cur.pvBox),o=getSize(cur.pvBox);return e.pageX<t[0]&&e.pageY>t[1]&&e.pageY<t[1]+o[1]}},onLayerMouseMove(e){if(Photoview._isOverLayer(e)){var t=Photoview._isOverLayerLeft(e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(layerWrap,"pv_left_panel_over",t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvNavBtnLeft,"pv_nav_btn_show",t)}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(layerWrap,"pv_left_panel_over")},onLayerClick(e,t){if(Photoview._isOverLayer(e)&&Photoview._isOverLayerLeft(e))return Photoview.show(!1,cur.pvIndex-1,e);Photoview._doLayerClick(e,t)},_doLayerClick(e,t){if(cur.pvClicked&&!t||__afterFocus||e&&cur.__mdEvent&&e.target!=cur.__mdEvent.target)cur.pvClicked=!1;else if(!e||2!=e.button&&3!=e.which&&!e.pvHandle){e&&(e.pvHandle=!0);var o=e.pageX,r=e.pageY;if(null==o&&null!=e.clientX){var a=document.documentElement,_=bodyNode;o=e.clientX+(a&&a.scrollLeft||_&&_.scrollLeft||0)-(a.clientLeft||0),r=e.clientY+(a&&a.scrollTop||_&&_.scrollTop||0)-(a.clientTop||0)}var i=Math.abs(o-intval(cur.pvOldX)),s=Math.abs(r-intval(cur.pvOldY));(i>3||s>3)&&vkNow()-intval(cur.pvOldT)>300&&(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag():cur.pvEditorMode?e.target!=layerWrap&&e.target!=layer||SPE.attemptHide((()=>{Photoview.hide(0)})):Photoview.hide(0))}},onKeyDown(e){if(!1===e.returnValue)return!1;if((!window.SPE||!window.SPE.editor)&&inArray(e.keyCode,[KEY.DOWN,KEY.UP])&&cur.pvNarrowScrollbar&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(e.target,"reply_field"))return cur.pvNarrowScrollbar.scrollBy(e.keyCode==KEY.DOWN?70:-70),cancelEvent(e);if(e.keyCode==KEY.ESC&&cur.pvEditing)return Photoview.cancelInline(),cancelEvent(e);e.altKey&&e.keyCode==KEY.RETURN&&Photoview.canFullscreen()&&(cur.pvCanvas?Photoview.fullscreenStop():Photoview.fullscreen()),e.keyCode==KEY.SPACE&&cur.pvCanvas&&(_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_12__.FullscreenPV.startSlide(),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_12__.FullscreenPV.showControls(!0));var t=e.target.contentEditable;return!!(window.Emoji&&Emoji.shown||e.target&&("INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName||"DIV"==e.target.tagName&&t&&"inherit"!=t))||(e.keyCode==KEY.ESC?(cur.pvCanvas?Photoview.fullscreenStop():cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag():e.vkCanceled||curBox()||(cur.pvEditorMode?SPE.attemptHide((()=>{Photoview.hide(0)})):Photoview.hide(0)),cancelEvent(e)):(cur.pvTagger||boxQueue.count()||cur.pvComment&&cur.pvComment.focused||e.ctrlKey||(e.keyCode==KEY.RIGHT?Photoview.show(cur.pvListId,cur.pvIndex+1):e.keyCode==KEY.LEFT&&Photoview.show(cur.pvListId,cur.pvIndex-1)),!cur.pvCanvas&&void 0))},updateVerticalPosition(e){if(cur.pvCont){var t=getSize(cur.pvCont),o=window.clientHeight()/2-t[1]/2-intval(e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(layer,"margin-top",Math.round(o))}},calculateVeryBig(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0);cur.pvVeryBig=e>1800?3:e>1200?2:e>800&&1,window.devicePixelRatio>1&&(cur.pvVeryBig+=1,cur.pvVeryBig=Math.min(3,cur.pvVeryBig))},updateNavBtnsLeftThreshold(e){var t=getSize(cur.pvImageWrap)[0],o=getXY(cur.pvImageWrap)[0];cur.pvLeftBtnAmount&&!e||(cur.pvLeftBtnAmount=o+Photoview.LEFT_RIGHT_NAV_RATIO*t)},updatePhotoDimensions(e){if(!Photoview.isPhotosList()&&!cur.pvEditorModeDimensionsUpdated){var t=Photoview.MIN_WIDTH,o=Photoview.MIN_HEIGHT;cur.pvEditorMode&&(t=Photoview.PE_MIN_WIDTH,o=Photoview.PE_MIN_HEIGHT,cur.pvEditorModeDimensionsUpdated=!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(cur.pvBottomInfo,"pv_with_line_break");var r=isVisible(cur.pvTagInfo),a=r?getSize(cur.pvTagInfo)[1]:0,_=Math.max(document.documentElement.clientWidth,window.innerWidth||0),i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),s=getSize(cur.pvBottomInfo)[1],n=Math.max(t,_-Photoview.SIDE_COLUMN_WIDTH-2*Photoview.SIDE_MIN_GAP),p=Math.max(o,i-s-2*Photoview.VERTICAL_MIN_GAP-a);Photoview.calculateVeryBig();var d=clone(cur.pvCurData||{width:t,height:o});d.width=d.width||t,d.height=d.height||o;var c=d.width/d.height,l=Math.min(n,d.width),v=l/c;v=Math.min(p,v),l=Math.ceil(v*c);var u=getXY(cur.pvBottomLeft)[0]+getSize(cur.pvBottomLeft)[0]>getXY(cur.pvBottomActions)[0]-20;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvBottomInfo,"pv_with_line_break",u),e&&(cur.prevPhotoWidth=cur.prevPhotoHeight=0);var h=cur.prevPhotoWidth=Math.max(l,t,cur.prevPhotoWidth||0),g=cur.prevPhotoHeight=Math.max(v,o,(cur.prevPhotoHeight||0)-a),m=Math.max(0,g/2-v/2);if(m>0&&!r){var w=(getSize(cur.pvPhoto)[1]+s)/2-v/2;w>s&&(m=w)}cur.pvAttachedProducts.photoSize={width:l,height:v,top:m},(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvPhoto,{width:h,height:g}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(cur.pvPhoto),{width:l,height:v,marginTop:m}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagInfo,{width:h}),cur.pvTagFrame&&Photoview.updateTagFrameDimensions(l,v,m),cur.pvPhotoTagsContainer&&Photoview.updatePhotoTagsContainerDimensions(l),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvImgProgress,"marginTop",m+v/2);var P=(cur.pvIsLightMode?0:Photoview.SIDE_COLUMN_WIDTH)+h;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvCont,{width:P,paddingLeft:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.sbWidth)()}),Photoview.updateRightBlock(),Photoview.updateVerticalPosition(),cur.pvPhWidth=l,cur.pvPhHeight=v,Photoview.updateNavBtnsLeftThreshold();var b=getXY(cur.pvCont),f=getSize(cur.pvCont),E=b[1]+f[1],T=_-(b[0]+f[0])<85||i-E<60;Photoview.toggleFastChats(!T)}},toggleFastChats(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)("chat_onl_wrap","hidden",!e),each(geByClass("rb_box_wrap"),(()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(this,"hidden",!e)}))},onResize(){if(cur.pvCanvas){var e=cur.pvVeryBig,t=cur.pvCanvas.offsetWidth,o=cur.pvCanvas.offsetHeight;return cur.pvVeryBig=t>1280||o>1280?2:(t>807||o>807)&&1,void(e!=cur.pvVeryBig&&setTimeout(Photoview.preload.pbind(cur.pvIndex,cur.pvLastDirection||1),10))}if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvCont,"width",800):Photoview.updatePhotoDimensions(!0),cur.pvPhoto){if(browser.mozilla&&cur.pvPhoto.firstChild){var r=cur.pvPhoto.firstChild.offsetLeft,a=(lastWindowWidth-cur.pvActualWidth)%2&&(cur.pvActualWidth-cur.pvPhWidth)%2?4:3;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagFrame,{left:r-a+"px"})}Photoview.scrollResize(),Photoview.stopTagger()}},stopTagger(){cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag()},updateSize(){cur.pvBox&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown||!!cur.pvAlbumShown),onBodyResize(),Photoview.onResize()},activate(e){e&&e.timeout?(clearTimeout(e.timeout),removeAttr(e,"timeout")):isVisible(e)&&fadeTo(e,200,vk.pvdark?1:.7)},deactivate(e){e&&isVisible(e)&&!e.timeout&&(e.timeout=setTimeout((()=>{removeAttr(e,"timeout"),fadeTo(e,200,.4)}),1))},deletePhoto(e){var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o],a=curBox();if(cur.deletionProgress=cur.deletionProgress||{},!cur.deletionProgress[r.id])if(cur.deletionProgress[r.id]=!0,cur.pvTagger)Photoview.stopTagger();else{cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas();var _={act:"delete_photo",photo:r.id,hash:r.hash,set_prev:isChecked("pvb_prev_check"),sure:intval(e)};(0,_internal_nospam_common__WEBPACK_IMPORTED_MODULE_22__.isClaimContent)()&&(_._nol=JSON.stringify(window.nav.objLoc)),ajax.post("al_photos.php",_,{onDone:(e,_)=>{if(cur.deletionProgress[r.id]=!1,a)return a.hide(),nav.go("/id0",!1,{nocur:!0});t==cur.pvListId&&o==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(_||getLang("photo_deleted"),e),r.deleted=[cur.pvTagInfoText.innerHTML,cur.pvTagInfoButtons.innerHTML],Photoview.toggleDeletedState(!0),Photoview.updatePhotoDimensions())}})}},restorePhoto(e){var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o];(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.isButtonLocked)(e)||ajax.post("al_photos.php",{act:"restore_photo",photo:r.id,hash:r.hash},{onDone:e=>{r.deleted=!1,t==cur.pvListId&&o==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1),Photoview.updatePhotoDimensions()),cur.pvPhotoTags&&cur.pvPhotoTags.showAreas()},onFail:e=>((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_24__.showFastBox)(getLang("global_error"),e),!0),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton.pbind(e)})},spamPhoto(e,t){var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r];(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.isButtonLocked)(t)||(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_13__.Phototag.stopTag():ajax.post("al_photos.php",{act:"spam_photo",photo:a.id,hash:a.hash,spam_hash:e,pv:1},{onDone:(e,t)=>{t&&(a.deleted=e),o==cur.pvListId&&r==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(getLang("photo_marked_as_spam_restore"),""),t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvCommentsData))},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton.pbind(t),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton.pbind(t)}))},rotatePhoto(e){var t=ge("pv_rotate_progress");if(!isVisible(t)){e%=4,Photoview.stopTagger(),show(t);var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r],_=a.id,i=a.rotate_hash;window.ajax.post("/al_photos.php?act=make_rotate",{type:"view",list_id:o,hash:i,photo:_,index:r,to:e},{onDone:Photoview.rotatePhotoDone,onFail:Photoview.rotatePhotoDone})}},rotatePhotoOld(e){var t=document.querySelector("#pv_rotate_progress");if(!isVisible(t)){Photoview.stopTagger(),show(t),ge("pv_rotate").appendChild(ce("div",{id:"pv_rotate_frame",className:"upload_frame",innerHTML:'<iframe name="pv_rotate_frame"></iframe>'}));var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r],_=ge("pv_rotate_form");_.innerHTML="",_.action=a.rotate[0];var i=extend({act:"do_rotate",to:e,list_id:o,index:r,fid:a.id},a.rotate);if(e=(e+4)%4,"rotate_photo"==i.act&&(i.angle=(i.angle+e)%4),i["rot"+e])return i.act="done_rotate",i.complete=1,void window.ajax.post("/al_photos.php",i,{onDone:Photoview.rotateDone,onFail:()=>{Photoview.rotateDone()}});for(var s in i)0!=s&&_.appendChild(ce("input",{type:"hidden",name:s,value:i[s]}));_.submit()}},rotatePhotoDone(e){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)("pv_rotate_progress"),e){var t=e.list_id;if(t){var o=e.index,r=cur.pvData[t][o];r&&(Object.entries(e.photos).forEach((function(e){var t=_slicedToArray(e,2),o=t[0],a=t[1];r[`${o}_`]=a,r[`${o}_src`]=a[0]})),t===cur.pvListId&&o===cur.pvIndex&&Photoview.show(t,o),cur.pvPhotoTags&&cur.pvPhotoTags.reload())}}},rotateDone(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)("pv_rotate_progress");var t=ge("pv_rotate_frame");if(t&&(re(t),e)){var o=e.list_id,r=e.index,a=cur.pvData[o][r];extend(a,{x_src:e.x_src,y_src:e.y_src,z_src:e.z_src,w_src:e.w_src,base:e.base,x_:e.x_,y_:e.y_,z_:e.z_,w_:e.w_,x:0,y:0,z:0,w:0,tags:e.tags,tagged:e.tagged,suggested_tags:e.suggested_tags,tagshtml:e.html}),extend(a.rotate,{photo:e.photo,hash:e.hash,rhash:e.rhash,angle:e.angle,rot1:e.rot1,rot3:e.rot3}),o==cur.pvListId&&r==cur.pvIndex&&Photoview.show(o,r),cur.pvPhotoTags&&cur.pvPhotoTags.reload()}},likeUpdate(e,t,o){t=intval(t);var r=ge("pv_like"),a=domByClass(r,"_count");if(a){var _=r.tt||{},i=clone(_.opts||{}),s=domByClass(_.container,"_value"),n=domByClass(_.container,"_content"),p=domByClass(_.container,"_title");o&&p&&val(p,o),_&&(_.likeInvalidated=!0),s&&(s.value=t),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_26__.animateCount)(a,t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(r,"pv_liked",e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(r,"no_likes",!t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.toggleClass)(n,"me_hidden",!e),t?!_.el||isVisible(_.container)||o||tooltips.show(_.el,extend(i,{showdt:0})):_.el&&_.hide()}},tagOver(e){animate(e,{backgroundColor:"#6B8DB1"},200),(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_25__.showTooltip)(e,{text:getLang("photos_delete_tag"),shift:[0,-2,0]})},tagOut(e){e.parentNode&&e.parentNode.parentNode&&animate(e,{backgroundColor:"#C4D2E1"},200)},deleteTag(e,t){var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r];if(a.tagid){if(isVisible("pv_tag_handling"))return}else if(ge("pv_action_progress"))return;var _=t?1:0;ajax.post("al_photos.php",{act:"delete_tag",photo:a.id,tag:e,hash:a.hash,top_panel:_,extended:1},{onDone:(t,_,i,s)=>{a.tagid?((0,_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_31__.decrementLeftMenuPhotoCounter)(),cur.pvPhotoTags&&cur.pvPhotoTags.dispatchEvent(_web_photos_types__WEBPACK_IMPORTED_MODULE_30__.TagEventTypes.DECLINE_USER_TAG,{tagId:e,photoRawId:a.id}),a.taginfo=a.tagid=!1,cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(getLang("photos_tag_deleted"),t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(cur.pvTagInfoButtons,"no_events"),setTimeout((()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(cur.pvTagInfoButtons,"no_events")}),1e3)):Photoview.actionInfo().innerHTML=t,void 0!==_&&(a.tags=_,a.tagged=i,a.tagshtml=s,cur.pvListId==o&&cur.pvIndex==r&&(Photoview.setTags(s),(!a.taginfo&&a.actions.tag&&_[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvTagLink))),cur.pvPhotoTags&&cur.pvPhotoTags.deleteTag(e)},onFail:e=>{if(e)return Photoview.actionInfo().innerHTML=e,!0},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((()=>{if((0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(t),a.tagid);else{var e=Photoview.actionInfo();e.innerHTML="",showProgress(e)}})),hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(t),a.tagid||re(Photoview.actionInfo())}})},restoreTag(e){if(!ge("pv_action_progress")){var t=cur.pvListId,o=cur.pvIndex,r=cur.pvData[t][o];ajax.post("al_photos.php",{act:"restore_tag",photo:r.id,tag:e,hash:r.hash},{onDone:(e,a,_,i)=>{void 0!==a&&(r.tags=a,r.tagged=_,r.tagshtml=i,cur.pvListId==t&&cur.pvIndex==o&&(Photoview.setTags(i),(!r.taginfo&&r.actions.tag&&a[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvTagLink)),cur.pvPhotoTags&&cur.pvPhotoTags.renderTagAreas()),Photoview.actionInfo().innerHTML=e},onFail:e=>{if(e)return Photoview.actionInfo().innerHTML=e,!0},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((()=>{var e=Photoview.actionInfo();e.innerHTML="",showProgress(e)})),hideProgress:()=>{re(Photoview.actionInfo())}})}},confirmTag(e,t){var o=cur.pvListId,r=cur.pvIndex,a=cur.pvData[o][r];isVisible("pv_tag_handling")||ajax.post("al_photos.php",{act:"confirm_tag",tag:e,photo:a.id,hash:a.hash,extended:1},{onDone:(t,_,i)=>{a.tags=t,a.tagged=_,a.tagshtml=i,a.taginfo=a.tagid=!1,cur.pvPhotoTags&&cur.pvPhotoTags.dispatchEvent(_web_photos_types__WEBPACK_IMPORTED_MODULE_30__.TagEventTypes.CONFIRM_USER_TAG,{tagId:e,photoRawId:a.id}),(0,_web_photos_photo_tag_utils__WEBPACK_IMPORTED_MODULE_31__.decrementLeftMenuPhotoCounter)(),o==cur.pvListId&&r==cur.pvIndex&&(Photoview.setTags(i),(!a.taginfo&&a.actions.tag&&t[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(cur.pvTagLink),a.suggestedTagsInfo&&!a.taginfo&&t[0]<cur.pvMaxTags?Photoview.showSuggestedInfoTopPanel(a):(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done","pv_confirm_suggested_tags","pv_decline_suggested_tags"),Photoview.toggleTopInfoPanel(!1)))},showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(t)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(t)}})},confirmAllSuggestedTags(e){if(cur.pvPhotoTags){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(e);var t=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.getPhotoData)("suggested_tags"),o=Object.keys(t);cur.pvPhotoTags.confirmSuggestedTags(o,(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)}),(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)}))}},declineAllSuggestedTags(e){if(cur.pvPhotoTags){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(e);var t=(0,_photoview_utils__WEBPACK_IMPORTED_MODULE_28__.getPhotoData)("suggested_tags"),o=Object.keys(t);cur.pvPhotoTags.declineSuggestedTags(o,(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)}),(()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)}))}},toProfileTag(){var e=cur.pvData[cur.pvListId][cur.pvIndex].tagged[vk.id];e&&!cur.pvTagger&&Photoview.showTag(e)},showTag(e){cur.pvPhotoTags&&cur.pvPhotoTags.showTagArea(e)},showDynTag(e){if(clearTimeout(cur.pvHidingTag),cur.pvShowingTag!=e){var t=clone(cur.pvData[cur.pvListId][cur.pvIndex].tags[e]),o=ge("pv_tag"+e);if(o){each(t,((e,o)=>{t[e]=positive(o*cur[e%2?"pvPhHeight":"pvPhWidth"]/100)}));var r=0;isVisible(cur.pvTagInfo)&&(r=getSize(cur.pvTagInfo)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagPerson,{marginLeft:t[0]+"px",marginTop:r+t[3]+"px",minWidth:t[2]-t[0]+"px"}),cur.pvTagPerson.innerHTML=o.firstChild.innerHTML;var a=getSize(cur.pvTagPerson);t[3]+a[1]>cur.pvPhHeight&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(cur.pvTagPerson,{marginTop:cur.pvPhHeight-a[1]+"px"}),cur.pvTagPerson.onmouseover=Photoview.showDynTag.pbind(e),cur.pvShowingTag=e,browser.msie?show(cur.pvTagPerson):fadeIn(cur.pvTagPerson,200)}}},hideTag(){cur.pvPhotoTags&&cur.pvPhotoTags.hideTagArea()},realOffset(e,t,o){var r=t;if(!cur.pvData||!cur.pvData[e])return r;for(var a=0;a<t;a++)cur.pvData[e][a]&&(cur.pvData[e][a].deleted||cur.pvData[e][a].moved)&&(r+=o);return r},realCount(e,t){var o=t;if(!cur.pvData||!cur.pvData[e])return o;for(var r=0;r<cur.pvData[e].length;r++)cur.pvData[e][r]&&(cur.pvData[e][r].deleted||cur.pvData[e][r].moved)&&o++;return o},list(e,t,o){"deleted"!=o&&(cur.pvList||(cur.pvList={}),cur.pvList[e+"_"+t]=o)},loaded(e,t,o,r,a){if("deleted"!=e){if(a&&(extend(cur,{lang:extend(cur.lang||{},a.lang),pvHash:a.hash,pvCommLimit:a.commlimit,pvCaptionLimit:a.captionlimit,pvMaxTags:a.maxtags,pvReasons:a.reasons,pvReplyNames:extend(cur.pvReplyNames||{},a.names||{}),pvAskForAutoTag:a.ask_for_autotag,pvNeedShowAlertForOneSuggest:a.need_show_alert_for_one_suggest,pvNeedShowAlertForSomeSuggests:a.need_show_alert_for_some_suggests,pvOneSuggestHintId:a.one_suggest_hint_id,pvOneSuggestHintHash:a.one_suggest_hint_hash,pvSomeSuggestsHintId:a.some_suggests_hint_id,pvSomeSuggestsHintHash:a.some_suggests_hint_hash,pvTagsQueueParams:a.qparams}),window.pvcur=extend(window.pvcur||{},{wallTpl:a.wallTpl,rmedia_types:a.rmedia_types}),cur.wallTpl=cur.wallTpl||a.wallTpl,cur.options||(cur.options={}),cur.options.share||(cur.options.share=a.share),val((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.domFC)(ge("pv_add_media")),getLang("global_add_media"))),t=Photoview.realCount(e,t),o=Photoview.realOffset(e,o,1),cur.pvData||(cur.pvData={}),cur.pvCommsLikes||(cur.pvCommsLikes={}),cur.pvData[e])if(cur.pvData[e].length<t)for(var _=cur.pvData[e].length;_<t;++_)cur.pvData[e].push(void 0);else cur.pvData[e].length>t&&(cur.pvData[e]=cur.pvData[e].slice(0,t));else cur.pvData[e]=new Array(t);for(var i=0,s=r.length;i<s;++i){for(var n=clone(r[i]),p=o+i;p>=t;)p-=t;cur.pvCommsLikes[n.id]=[n.comments,n.likes,vkNow(),!1],delete n.comments,delete n.likes,cur.pvData[e][p]=n}}},showDeleted(e,t,o){cur.pvShown&&"temp"==cur.pvListId&&(t+="<br><br>"+o),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_24__.showFastBox)({title:getLang("global_error"),onHide:()=>{cur.pvShown&&"temp"==cur.pvListId&&Photoview.hide(!0)}},t)},spamDeleted(e,t,o){isVisible(curBox().progress)||ajax.post("al_photos.php",{act:"spam_photo",photo:t,hash:o,from:"deleted"},{onDone:t=>{domPN(e).replaceChild(ce("span",{innerHTML:t}),e)},showProgress:curBox().showProgress,hideProgress:curBox().hideProgress})},showPhoto(e,t,o,r){if(cur.pvShown&&("temp"!=cur.pvListId||cur.pvWasShown)&&void 0===o.noHistory||(debugLog("in showPhoto noHistory: "+o.noHistory),cur.pvNoHistory=o.noHistory,cur.pvHistoryLength=o.noHistory?0:o.histLen||0),extend(cur,{pvJumpTo:o.jumpTo||!1,pvJumpFrom:!1,pvJumpSteps:0}),t=cur.pvList&&cur.pvList[e+"_"+t]||t,cur.pvData&&cur.pvData[t]){var a=cur.pvData[t],_=cur.pvOptions&&cur.pvOptions.onHide,i=!0;cur.pvOptions=o,cur.pvOptions.onHide||(cur.pvOptions.onHide=_);for(var s=0,n=a.length;s<n;++s)if(a[s]){if(a[s].id===e)return Photoview.show(t,s,!1,o.root),o.onShow&&o.onShow(),!1}else i=!1;return i&&r?(o.onEmpty&&o.onEmpty(),!1):void 0}},loadedAlbums(e,t,o,r){cur.pvAlbumsData&&(ajax.preload("al_photos.php",extend({offset:r.offset,part:1,owner:e},{act:"show_albums"}),o),cur.curYear=r.cur_year,cur.pvAlbumsData[e]={html:t,opts:r},cur.pvAlbumsShowing==e&&(Photoview.doShowAlbums(e,!1),boxRefreshCoords(layer)))},showAlbums(e,t){e=intval(e),cur.pvAlbumsData||(cur.pvAlbumsData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=0,cur.pvAlbumsShowing=e;var o=t.onFail;cur.pvAlbumsData[e]?"loading"!=cur.pvAlbumsData[e]&&(Photoview.doShowAlbums(e,!1),boxRefreshCoords(layer)):(cur.pvAlbumsData[e]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:e},extend(t,{onDone:Photoview.loadedAlbums,onFail:t=>(o&&o(t),delete cur.pvAlbumsData[e],cur.pvAlbumsData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedAlbum(e,t,o,r){cur.pvAlbumData&&(o&&ajax.preload("al_photos.php",extend({offset:r.offset,part:1,album:e},{act:"show_album"}),o),cur.pvAlbumData[e]={html:t,opts:r},cur.pvAlbumShowing==e&&(Photoview.doShowAlbum(e,!1),boxRefreshCoords(layer)))},showAlbum(e,t){cur.pvAlbumData||(cur.pvAlbumData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=0,cur.pvAlbumShowing=e;var o=t.onFail;cur.pvAlbumData[e]?"loading"!=cur.pvAlbumData[e]&&(Photoview.doShowAlbum(e,!1),boxRefreshCoords(layer)):(cur.pvAlbumData[e]="loading",ajax.post("al_photos.php",{act:"show_album",album:e},extend(t,{onDone:Photoview.loadedAlbum,onFail:t=>(o&&o(t),delete cur.pvAlbumData[e],cur.pvAlbumData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedTagged(e,t,o){cur.pvPhotoTagData&&(cur.pvPhotoTagData[e]={html:t,opts:o},cur.pvPhotoTagShowing==e&&(Photoview.doShowTagged(e,!1),boxRefreshCoords(layer)))},showTagged(e,t){e=intval(e),cur.pvPhotoTagData||(cur.pvPhotoTagData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=0,cur.pvPhotoTagShowing=e;var o=t.onFail;cur.pvPhotoTagData[e]?"loading"!=cur.pvPhotoTagData[e]&&(Photoview.doShowTagged(e,!1),boxRefreshCoords(layer)):(cur.pvPhotoTagData[e]="loading",ajax.post("al_photos.php",{act:"show_tag",mid:e},extend(t,{onDone:Photoview.loadedTagged,onFail:t=>(o&&o(t),delete cur.pvPhotoTagData[e],cur.pvPhotoTagData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},updatePeriods(){Photoview.periods=geByClass("photos_period_delimiter")},destroyPeriod(){Photoview.fixedPeriod&&(re(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)},fixPeriod(){if(Photoview.periods&&Photoview.periods.length){var e=scrollGetY(),t=getSize(Photoview.periods[0])[1],o=!1,r=!1;for(var a in Photoview.periods)if(Photoview.periods.hasOwnProperty(a)){if(getXY(Photoview.periods[a])[1]>=e)break;o=Photoview.periods[a];var _=intval(a)+1;r=!!Photoview.periods[_]&&getXY(Photoview.periods[_])[1]-e}if(o){o==Photoview.fixedPeriodEl||(Photoview.fixedPeriod?Photoview.fixedPeriod.innerHTML=o.innerHTML:(Photoview.fixedPeriod=ce("div",{innerHTML:o.innerHTML,className:"pva_period_fixed"},{left:getXY(o)[0]+"px"}),utils.appendChild(Photoview.fixedPeriod)),Photoview.fixedPeriodEl=o);var i=!1!==r?r-t:0;i>=0&&(i=0),Photoview.fixedPeriodTop!==i&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.setStyle)(Photoview.fixedPeriod,{top:i+"px"}),Photoview.fixedPeriodTop=i)}else!o&&Photoview.fixedPeriod&&(re(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)}},scrollResize(){if(!browser.mobile&&cur.pvShown&&(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown||cur.pvVideoTagsShown)){var e=ge("ui_pv_photos_load_more"),t=ge("ui_pva_more_load_more"),o=3*lastWindowHeight;isVisible(e)&&o>getXY(e)[1]-(browser.msie6?0:scrollGetY())&&(cur.pvVideoTagsShown?Photoview.loadVideoTags():cur.pvPhotoTagShown?Photoview.loadTaggedPhotos():cur.pvAlbumsShown?Photoview.loadAlbumsPhotos():Photoview.loadAlbumPhotos()),cur.pvAlbumsShowing&&Photoview.fixPeriod(),cur.pvAlbumsShown&&cur.pvShowAllAlbums&&isVisible(t)&&o>getXY(t)[1]-(browser.msie6?0:scrollGetY())&&Photoview.loadAlbums()}},loadAlbums(){cur.pvShowAllAlbums=!0,Photoview.loadAlbumsPhotos(!0)},loadedAlbumsPhotos(e,t,o,r){if(cur.pvaLoading=0,cur.pvAlbumsShown){o?cur.pvaOffset=e:cur.pvaPhotosOffset=e,r&&(cur.curYear=r);var a=o?ge("pva_content"):ge("pva_content_photos"),_=o?ge("ui_pva_more_load_more"):ge("ui_pv_photos_load_more"),i=o?{act:"show_albums"}:{act:"show_albums",only_photos:1,cur_year:cur.curYear},s=o?cur.pvaOffset:cur.pvaPhotosOffset,n=o?cur.pvaCount:cur.pvaPhotosCount;if(a){for(var p=ce("div",{innerHTML:t});p.firstChild;){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hasClass)(p.firstChild,"photos_period_delimiter")){var d=domData(p.firstChild,"year");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("photos_period_delimiter_"+d)){re(p.firstChild);continue}}a.appendChild(p.firstChild)}Photoview.onResize(),Photoview.updatePeriods(),e>=n||!t?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(_):o&&(cur.pvaLoading=1,ajax.post("al_photos.php",extend({offset:s,part:1,owner:cur.pvAlbumsShown},i||{}),{onDone(){debugLog("preload done: "+cur.pvaLoading),2==cur.pvaLoading?Photoview.loadedAlbumsPhotos.apply(window,arguments):cur.pvaLoading=!1},onFail:()=>(cur.pvaLoading=0,!0)}))}}},loadAlbumsPhotos(e){var t=e?ge("ui_pva_more_load_more"):ge("ui_pv_photos_load_more"),o=e?{act:"show_albums"}:{act:"show_albums",only_photos:1},r=e?cur.pvaOffset:cur.pvaPhotosOffset;cur.pvAlbumsShown&&t&&isVisible(t)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.isButtonLocked)(t)&&(cur.pvaLoading?cur.pvaLoading=2:ajax.post("al_photos.php",extend({offset:r,part:1,owner:cur.pvAlbumsShown},o||{}),{cache:o.only_photos?0:1,onDone:Photoview.loadedAlbumsPhotos,onFail:()=>(cur.pvaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(t)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(t)}}))},loadedAlbumPhotos(e,t){if(cur.pvaLoading=0,cur.pvAlbumShown){cur.pvsaOffset=e;var o=ge("pvsa_content_photos"),r=ge("ui_pv_photos_load_more");if(o){if(o.appendChild(cf(t)),!cur.pvAlbumData[cur.pvAlbumShown].opts.no_known_count&&e>=cur.pvsaCount||!t)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(r),void Photoview.onResize();setTimeout((()=>{Photoview.onResize()}),10),cur.pvsaLoading=1,ajax.post("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},{onDone(){2==cur.pvsaLoading?Photoview.loadedAlbumPhotos.apply(window,arguments):(cur.pvsaLoading=!1,ajax.preload("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},arguments))},onFail:()=>(cur.pvsaLoading=0,!0)})}}},loadAlbumPhotos(){var e=ge("ui_pv_photos_load_more"),t=cur.pvsaOffset;cur.pvAlbumShown&&e&&isVisible(e)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.isButtonLocked)(e)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_album",album:cur.pvAlbumShown,offset:t,part:1},{onDone:Photoview.loadedAlbumPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(e)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)},cache:!0}))},loadedTaggedPhotos(e,t){if(cur.pvaLoading=0,cur.pvPhotoTagShown){cur.pvsaOffset=e;var o=ge("pvsa_content_photos"),r=ge("ui_pv_photos_load_more");o&&(o.appendChild(cf(t)),Photoview.onResize(),e>=cur.pvsaCount||!t?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)(r):(cur.pvsaLoading=1,ajax.post("al_photos.php",extend({offset:cur.pvsaOffset,part:1,mid:cur.pvPhotoTagShown},{act:"show_tag"}),{onDone(){debugLog("preload done: ",cur.pvsaLoading),2==cur.pvsaLoading?Photoview.loadedTaggedPhotos.apply(window,arguments):cur.pvsaLoading=!1},onFail:()=>(cur.pvsaLoading=0,!0)})))}},loadTaggedPhotos(){var e=ge("ui_pv_photos_load_more"),t=cur.pvsaOffset;cur.pvPhotoTagShown&&e&&isVisible(e)&&!(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.isButtonLocked)(e)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_tag",mid:cur.pvPhotoTagShown,offset:t,part:1},{onDone:Photoview.loadedTaggedPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(e)},hideProgress:()=>{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)},cache:1}))},thumbOver(e,t){clearTimeout((cur.pvHideTO||{})[t]);var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pva_title",e),r=o.previousSibling,a=getSize((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pva_desc",e))[1];a<5||(animate(o,{marginTop:146-(a+7)},{duration:200,transition:Fx.Transitions.easeOutCirc}),"pva_repeat"==r.className&&animate(r,{marginTop:43-Math.floor((a+7)/2)},{duration:200,transition:Fx.Transitions.easeOutCirc}))},thumbOut(e,t){cur.pvHideTO||(cur.pvHideTO={}),cur.pvHideTO[t]=setTimeout((()=>{var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pva_title",e),o=t.previousSibling;animate(t,{marginTop:146},200),"pva_repeat"==o.className&&animate(o,{marginTop:43},200)}),150)},fsMove(e){if(!(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown)&&cur.pvCurPhoto.author){var t=getXY(cur.pvActions),o=getSize(cur.pvActions),r=Math.max(100,.2*cur.pvPhWidth);e.pageX>t[0]-r&&e.pageX<t[0]+o[0]+r&&e.pageY>t[1]-r&&e.pageY<t[1]+o[1]+r?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.addClass)(cur.pvActions,"visible"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.removeClass)(cur.pvActions,"visible")}},showRepeat(e){if(e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pva_repeat",e)){var t=stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":""),o=getLang("photos_repeat_album");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pva_link",e).insertBefore(ce("div",{className:"pva_repeat",innerHTML:`\n        <div class="pva_repeat_blob">\n         <div class="pva_repeat_cont">\n         <img class="pva_repeat_img png" src="${t}.png?3" />\n         <span class="pva_repeat_text">${o}</span></div>\n        </div>`}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.geByClass1)("pva_title",e))}},showPlace(){var e=cur.pvCurPhoto.geohash;showBox("al_places.php",{act:"show_photo_place",geohash:e,photo:cur.pvCurPhoto.id},{cache:1})},editPlace(){var e=cur.pvCurPhoto.geohash;showBox("al_places.php",{act:"show_photo_place",edit:1,geohash:e||"",photo:cur.pvCurPhoto.id})},updatePlace(e,t){var o=ge("pv_edit_place");t?(o&&(o.innerHTML=t?t+".":""),ge("pv_place").innerHTML=t?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+t+"</a>":"",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_17__.hide)("pv_add_place")):setTimeout((()=>{ajax.post("al_photos.php",{act:"get_photo_place",photo:e},{onDone:t=>{Photoview.updatePlace(e,t)}})}),1e3)},reportComment(e,t,o){var r=_slicedToArray(o.split("_"),2),a=r[0],_=r[1];this.showReportPhotoCommentForm(a,_)},selectProductInBox:function(){var e=cur.pvData[cur.pvListId][cur.pvIndex].attached_tags,t=(e.tags?e.tags.length:0)>=e.max_tags_per_object;if(e.tags&&t)return(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_24__.showFastBox)(getLang("global_error"),getLang("market_attach_products_overflow",e.max_tags_per_object)),!1;(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_16__.showAttachProductBox)(window.event,Photoview.attachProduct)},attachProduct:function(e){curBox().hide(),Photoview.toggleTopInfoPanel(`<span class="attach_market_title">${getLang("market_product_attach_photo")} "${e.title}</span>`,`<button id="attach_market_cancel" class="flat_button secondary_dark black">${getLang("groups_cancel2")}</button>\n      <button id="attach_market_save" class="flat_button" disabled>${getLang("Save")}</button>`);var t=()=>{Photoview.toggleTopInfoPanel();var e=cur.pvAttachedProducts;e.point&&e.point.remove(),cur.pvAttachedProducts.isProcess=!1};cur.pvAttachedProducts.isProcess=!0,document.getElementById("attach_market_cancel").addEventListener("click",t),document.getElementById("attach_market_save").addEventListener("click",(function(){t();var o,r=cur.pvAttachedProducts;if(Object.assign(e,r.tempTag),!r.tempTag)return!1;if(document.getElementById("MarketList")){var a=_slicedToArray(Photoview.generateMarketListItem(e),2),_=a[0],i=a[1];o=_,document.getElementById("MarketList").appendChild(_),cur.pvImageAreaWrap.appendChild(i)}else{var s=_slicedToArray(Photoview.generateMarketList([e],!0),3),n=s[0],p=s[1],d=s[2];o=d,cur.pvImageAreaWrap.appendChild(p),document.getElementById("pv_attached_products_list").appendChild(n)}var c=cur.pvData[cur.pvListId][cur.pvIndex],l="link"===e.type?e.url:e.url.match(/product-?\d+_\d+/)[0],v=_slicedToArray(c.id.split("_"),2),u=v[0],h=v[1];e.x=r.tempTag.x,e.y=r.tempTag.y,ajax.post("al_market.php",{act:"add_tag_content_product",owner_id:u,item_id:h,type:"photo",hash:c.attached_tags.hash,tag_object:l,x:r.tempTag.x,y:r.tempTag.y},{onDone:t=>{o.id=t,c.attached_tags.tags=c.attached_tags.tags||[],e.tag_id=t,c.attached_tags.tags.push(e)}})}))},attachProductPoint:function(e){var t=document.getElementById("pv_product_point");t||((t=document.createElement("div")).classList.add("attach_market_point"),t.id="pv_product_point");var o=cur.pvImageAreaWrap,r=cur.pvAttachedProducts;r.tempTag=r.tempTag||{},document.getElementById("attach_market_save").removeAttribute("disabled");var a=e.currentTarget.getBoundingClientRect(),_=cur.pvAttachedProducts.photoSize,i=e.clientX-a.left-(a.width-_.width)/2,s=e.clientY-a.top-(a.height-_.height)/2;i>0&&s>0&&i<_.width&&s<_.height&&(document.getElementById("pv_product_point")||o.appendChild(t),r.tempTag.y=(e.clientY-a.top-_.top)/_.height,r.tempTag.x=(e.clientX-a.left-(a.width-_.width)/2)/_.width,t.style.top=e.clientY-a.top+"px",t.style.left=e.clientX-a.left+"px"),r.point=t},generateMarketList:function(e){var t=document.createElement("span");t.innerHTML=getLang("photos_attached_goods"),t.classList.add("pv_photo_product_attach_label");var o,r=document.createElement("ul");r.id="MarketList",r.classList.add("AttachedProductsList");var a=document.createDocumentFragment(),_=document.createDocumentFragment();e&&e.forEach((function(t){var r=Photoview.generateMarketListItem(t);1===e.length&&(o=r[0]),a.appendChild(r[0]),_.appendChild(r[1])})),r.appendChild(a);var i=document.createElement("div");return i.appendChild(t),i.appendChild(r),[i,_,o]},generateMarketListItem:function(e){var t=document.createElement("li");t.id=e.tag_id,t.classList.add("AttachedProductsList__item");var o=document.createElement("a");o.href=e.url,o.setAttribute("target","_blank");var r=t=>{(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_18__.checkEvent)(t)||(layerQueue.push(),cancelEvent(t),showWiki({w:e.url.match(/product-?\d+_\d+/)[0]},!1,t))};"link"!==e.type&&o.addEventListener("click",r),o.classList.add("AttachedProductsList__content");var a=document.createElement("div");a.classList.add("AttachedProductsList__img"),a.style.backgroundImage="url("+(e.thumb||"/images/market/attach_product_list_placeholder.png")+")",o.appendChild(a);var _=document.createElement("span");_.classList.add("AttachedProductsList__title"),_.innerHTML=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.unclean)(e.title)),o.appendChild(_);var i=document.createElement("span");i.classList.add("AttachedProductsList__price"),i.innerHTML=e.price,o.appendChild(i),t.appendChild(o);var s=cur.pvData[cur.pvListId][cur.pvIndex],n=document.createElement("button");s.attached_tags&&s.attached_tags.hash&&(n.classList.add("AttachedProductsList__cross"),t.appendChild(n));var p=document.createElement("a");p.href=e.url,p.setAttribute("target","_blank"),"link"!==e.type&&p.addEventListener("click",r),p.classList.add("pv_attach_product_badge"),p.innerHTML=`\n      <div class="pv_attach_product_badge_text">\n        <div class="pv_attach_product_badge_title">${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.unclean)(e.title))}</div>\n        <div class="pv_attach_product_badge_price">${e.price}</div>\n      </div>\n      <div class="pv_attach_product_badge_icon">\n        ${(0,_icons_desktop_getIcon16Chevron__WEBPACK_IMPORTED_MODULE_35__.getIcon16Chevron)().icon}\n      </div>\n    `;var d=cur.pvImageAreaWrap.getBoundingClientRect(),c=cur.pvAttachedProducts.photoSize,l=176,v=54,u=14,h={top:Math.floor(e.y*c.height)+(d.height-c.height)/2,left:Math.floor(e.x*c.width)+(d.width-c.width)/2,height:v+u,width:l};p.style.top=`${h.top}px`,p.style.left=`${h.left}px`,p.style.opacity="1";var g=Photoview.getBadgePositioningClass({photoSize:c,badgeRect:h});p.classList.add(g);var m=_slicedToArray(s.id.split("_"),2),w=m[0],P=m[1];return s.attached_tags&&s.attached_tags.hash&&n.addEventListener("click",(e=>{ajax.post("al_market.php",{act:"delete_tag_content_product",owner_id:w,item_id:P,type:"photo",access_key:cur.pvCurPhoto.hash,hash:s.attached_tags.hash,tag_id:e.target.parentElement.id});var t=cur.pvData[cur.pvListId][cur.pvIndex];return t.attached_tags.tags=t.attached_tags.tags.filter((t=>t.tag_id!=e.target.parentElement.id)),p.remove(),document.getElementById("MarketList").childElementCount>1?e.target.parentElement.outerHTML="":document.getElementById("pv_attached_products_list").innerHTML="",cancelEvent(e)})),n.addEventListener("mouseover",(e=>{(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_25__.showTooltip)(e.target,{text:getLang("photos_pv_act_delete"),black:1,center:!0,shift:[0,3]})})),t.addEventListener("mouseover",(function(){p.style.opacity="1"})),t.addEventListener("mouseout",(function(e){if(t.contains(e.relatedTarget))return!1;p.style.opacity="0"})),cur.pvImageAreaWrap.addEventListener("mouseover",(function(){cur.pvEditorMode||(p.style.opacity="1")})),cur.pvImageAreaWrap.addEventListener("mouseout",(function(e){if(cur.pvImageAreaWrap&&cur.pvImageAreaWrap.contains(e.relatedTarget))return!1;p.style.opacity="0"})),cur.pvAttachedProducts.badges=cur.pvAttachedProducts.badges||[],cur.pvAttachedProducts.badges.push(p),[t,p]},isBadgeWiderThanPhoto:e=>{var t=e.photoWidth;return e.badgeWidth>t},getRequiredBadgeSideSize:e=>e/2,isBadgeCroppedFromLeft:e=>{var t=e.photoSize,o=e.badgeRect;if(Photoview.isBadgeWiderThanPhoto({photoWidth:t.width,badgeWidth:o.width}))return!1;var r=Photoview.getRequiredBadgeSideSize(o.width);return o.left<r},isBadgeCroppedFromRight:e=>{var t=e.photoSize,o=e.badgeRect;if(Photoview.isBadgeWiderThanPhoto({photoWidth:t.width,badgeWidth:o.width}))return!1;var r=Photoview.getRequiredBadgeSideSize(o.width);return o.left+o.width>t.width-r},isBadgeCroppedFromBottom:e=>{var t=e.photoSize,o=e.badgeRect;return!(o.height>t.height)&&o.top>t.height-o.height},getBadgePositioningClass:e=>{var t={photoSize:e.photoSize,badgeRect:e.badgeRect},o=Photoview.isBadgeCroppedFromLeft(t),r=Photoview.isBadgeCroppedFromRight(t),a=Photoview.isBadgeCroppedFromBottom(t),_="pv_attach_product_badge",i=`${_}--down-middle`;return o||r||a?o&&r&&!a?i:o?a?`${_}--up-right`:`${_}--down-right`:r?a?`${_}--up-left`:`${_}--down-left`:a?`${_}--up-middle`:i:i}}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(o.exports,o,o.exports,__webpack_require__),o.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,o,r)=>{if(!t){var a=1/0;for(n=0;n<deferred.length;n++){for(var[t,o,r]=deferred[n],_=!0,i=0;i<t.length;i++)(!1&r||a>=r)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[i])))?t.splice(i--,1):(_=!1,r<a&&(a=r));if(_){deferred.splice(n--,1);var s=o();void 0!==s&&(e=s)}}return e}r=r||0;for(var n=deferred.length;n>0&&deferred[n-1][2]>r;n--)deferred[n]=deferred[n-1];deferred[n]=[t,o,r]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var o=Object.create(null);__webpack_require__.r(o);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var a=2&t&&e;"object"==typeof a&&!~leafPrototypes.indexOf(a);a=getProto(a))Object.getOwnPropertyNames(a).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,__webpack_require__.d(o,r),o},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={1036:0};__webpack_require__.O.j=t=>0===e[t];var t=(t,o)=>{var r,a,[_,i,s]=o,n=0;for(r in i)__webpack_require__.o(i,r)&&(__webpack_require__.m[r]=i[r]);if(s)var p=s(__webpack_require__);for(t&&t(o);n<_.length;n++)a=_[n],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[_[n]]=0;return __webpack_require__.O(p)},o=self.webpackChunkvk=self.webpackChunkvk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var __webpack_exports__=__webpack_require__.O(void 0,[8288,8592,4509,1437,8102,8003,8816,613,1140,7586],(()=>__webpack_require__(362856)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();