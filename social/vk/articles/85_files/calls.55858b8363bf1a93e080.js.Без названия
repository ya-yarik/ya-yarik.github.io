!function(e){function t(t){for(var a,i,l=t[0],c=t[1],s=t[2],A=0,d=[];A<l.length;A++)i=l[A],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&d.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(u&&u(t);d.length;)d.shift()();return o.push.apply(o,s||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,l=1;l<n.length;l++){var c=n[l];0!==r[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={"web/calls":0},o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/cmodules/";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var u=c;o.push([152,"common","palette","9b5c1549562b5997058328b940973c18","vendors","98128115ad232d3b37413c0ed0fd40c7","7ed9e4d544bccc8a5ada0a712a9cf1ad","1fe1df46cdb12c3eb98af3fc95e7c624"]),n()}({152:function(e,t,n){e.exports=n("7ylw")},"1nu5":function(e,t,n){"use strict";n.r(t),n.d(t,"VkIndexer",(function(){return a}));var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),r=a.length;r--;){var o=a[r],i="";if(o){for(var l=0;l<6;l++){var c=o.charCodeAt(l);if(c){var s=this.toTranslit[c],u=o.substr(l,1);i+=null!=s?s:u}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var r={},o=n[a],i="",l="",c="",s=o.length>1;if(o){for(var u=0;u<6;u++){var A=o.charCodeAt(u);if(A){var d=this.toTranslit[A],p=o.substr(u,1);if(i+=null!=d?d:p,s){var m=this.toLocalCase[p],f=this.toLocalTranslit[A];l+=null!=m?m:p,c+=null!=f?f:p}}}r[i]=1,s&&(r[l]=2,r[c]=3),t.push(r)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var r=e.substr(a,1)||-1;n=n[r]?n[r]:n[r]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var r=this.index,o=0;o<6;o++){var i=a.substr(o,1)||-1;if(!r[i])break;r=r[i]}if(r.length)for(var o in r)if(this.equals(r[o],e)){r.splice(o,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(r(e[0])||r(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],r=!1;for(var o in n)if(n.hasOwnProperty(o)){if(r&&!a)break;var i=this.localSearch(n[o],0,t);i.sort((function(e,t){return e._order-t._order})),a=r?this.intersect(a,i):i,r=!0}for(var l=a[0],c=a.length+1,s=[],u=1;u<c;u++){var A=a[u];A!=l&&(s.push(l),l=A)}return s},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var r in e)e.hasOwnProperty(r)&&(a[i=r.substr(t,1)||-1]||(a[i]={}),a[i][r]=1);if(6==t++)return n;var o=[];for(var i in a)if("-1"===i)for(var l in n)n.hasOwnProperty(l)&&o.push.apply(o,this.localSearch(a[i],t,n[l]));else{var c=this.localSearch(a[i],t,n[i]);o.push.apply(o,c)}return o},e}();function r(e){return!isNaN(e)}},"6Rqf":function(e,t,n){"use strict";function a(e,t){var n=r(t),a=e.includes("?");return e+(a?"&":"?")+n}function r(e){return Object.keys(e).map((function(t){var n=e[t];return(t=encodeURIComponent(t||""))+"="+encodeURIComponent(n||"")})).join("&")}function o(e){return e.split("&").reduce((function(e,t){var n=t.split("=");return e[n[0]]=n[1],e}),{})}function i(e,t){var n=r(t);return fetch(e,{method:"POST",body:n,mode:"cors",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.json()}))}n.r(t),n.d(t,"corsRequest",(function(){return i})),n.d(t,"makeParams",(function(){return r})),n.d(t,"makeUrl",(function(){return a})),n.d(t,"parseParams",(function(){return o}))},"7pkf":function(e,t,n){"use strict";n.r(t),n.d(t,"setApiWrappers",(function(){return o})),n.d(t,"getApiWrapper",(function(){return i}));var a=null,r=null,o=function(e,t){a=e,r=t},i=function(e){return void 0===e&&(e=!0),e?a:r}},"7ylw":function(e,t,n){"use strict";n.r(t);n("91GP"),n("VRzm"),n("Btvt");var a,r=n("q1tI"),o=n.n(r),i=n("i8i4"),l=(n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("/MKj")),c=n("icuC"),s=n("xt6h"),u=function(){return(u=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},A=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(a||(a={}));var d=function(e){var t=e.icon,n=e.text,r=e.type,i=e.className,l=A(e,["icon","text","type","className"]),c=Object(s.classNames)("CallButton","CallButton--"+r,i,{"CallButton--withText":!!n}),d=u(u({},l),{onMouseDown:function(e){e.preventDefault(),l.onMouseDown&&l.onMouseDown(e)}});return o.a.createElement("button",u({className:c},d,{disabled:r===a.DISABLED}),o.a.createElement("figure",{className:"CallButton__icon"},t),n)},p=function(){return(p=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},m=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},f=function(e){var t=m(e,[]);return o.a.createElement("svg",p({height:"14",width:"21",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M11.154 0c1.337 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31v6.31c0 1.336-.14 1.821-.4 2.31a2.726 2.726 0 01-1.135 1.134c-.489.262-.974.401-2.31.401h-7.31c-1.336 0-1.821-.14-2.31-.4A2.726 2.726 0 01.4 12.464C.139 11.976 0 11.491 0 10.155v-6.31c0-1.336.14-1.821.4-2.31A2.726 2.726 0 011.536.4C2.024.139 2.509 0 3.845 0zM20.8 2.897a1 1 0 01.2.6v7.006a1 1 0 01-1.6.8L17.2 9.65a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652a1 1 0 011.4.199z"}))},_=function(){return(_=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},E=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},h=function(e){var t=E(e,[]);return o.a.createElement("svg",_({height:"18",width:"18",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M11.112 12.259c1.354-1.354 3.486-1.48 4.903-.287l1.025.863c1.168.983 1.287 2.757.263 3.96a3.318 3.318 0 01-2.195 1.133c-3.273.44-6.707-1.137-10.303-4.733C1.21 9.6-.369 6.165.072 2.892a3.25 3.25 0 01.159-.752c.19-.56.527-1.058.974-1.443C2.41-.327 4.181-.21 5.165.96l.862 1.024c1.194 1.416 1.07 3.55-.284 4.903l-.736.735a.712.712 0 00-.164.748c.267.732.95 1.645 2.046 2.74 1.096 1.097 2.01 1.78 2.74 2.048.26.095.553.03.749-.166z"}))},v=function(){return(v=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},g=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},O=function(e){var t=g(e,[]);return o.a.createElement("svg",v({height:"14",width:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M13.3.7a.99.99 0 00-1.4 0L7 5.6 2.1.7A.99.99 0 00.7 2.1L5.6 7 .7 11.9a.99.99 0 001.4 1.4L7 8.4l4.9 4.9a.99.99 0 001.4-1.4L8.4 7l4.9-4.9a.99.99 0 000-1.4z"}))},C=n("17x9"),b=n.n(C);function y(e){var t=e.id,n=e.disablePhoto,a=e.photo,o=e.className,i=e.children,l=t%6+1,u=a&&a!==c.DEFAULT_AVATAR,A=Object(s.classNames)("BlurredBackground",o,"BlurredBackground--"+l,{"BlurredBackground--noPhoto":!n&&!u});return r.createElement("div",{className:A},r.createElement("div",{className:"BlurredBackground__in"},!n&&u&&r.createElement("div",{className:"BlurredBackground__inner",style:{backgroundImage:`url(${a})`}})),r.createElement("div",{className:"BlurredBackground__content"},i))}y.defaultProps={photo:"",children:"",disablePhoto:!1};var S=n("Aegd"),N=function(){return(N=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},I=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},F=function(e){var t=I(e,[]);return o.a.createElement("svg",N({width:"10",height:"10",viewBox:"0 0 10 10",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M6.80486 3.06621L9.19457 3.30079C10.0261 3.38241 10.2811 4.21346 9.63901 4.75944L7.76813 6.35033L8.46267 8.94201C8.69075 9.79313 7.98312 10.3084 7.27435 9.79614L5.0011 8.15325L2.72785 9.79614C2.02194 10.3063 1.31141 9.79324 1.53953 8.94201L2.23406 6.35033L0.363183 4.75944C-0.281598 4.21116 -0.0275869 3.38278 0.807493 3.30079L3.19677 3.06621L4.24943 0.583062C4.57908 -0.194562 5.42332 -0.194173 5.75269 0.583142L6.80486 3.06621Z"}))},T=function(e){var t=e.className,n=e.type;return o.a.createElement("div",{className:Object(s.classNames)("UserBadge","UserBadge--"+n,t)},o.a.createElement(F,null))},P=function(e){var t=e.id,n=e.waves,a=void 0!==n&&n,r=e.size,i=void 0===r?"m":r,l=e.photo,u=void 0===l?"":l,A=e.alt,d=e.letter,p=e.showCreatorBadge,m=e.showAdminBadge,f=Object(s.classNames)("CallPhoto__photo","CallPhoto--"+i,{"CallPhoto--waves":!!a});return u&&u!==c.DEFAULT_AVATAR?o.a.createElement("div",{className:"CallPhoto"},o.a.createElement("img",{src:u,className:f,alt:A}),p?o.a.createElement(T,{className:"CallPhoto__badge",type:"creator"}):m?o.a.createElement(T,{className:"CallPhoto__badge",type:"admin"}):null):o.a.createElement("div",{className:"CallPhoto"},o.a.createElement(S.ConversationNoPhoto,{id:t,text:d||A.slice(0,1),size:i,className:f}),p?o.a.createElement(T,{className:"CallPhoto__badge",type:"creator"}):m?o.a.createElement(T,{className:"CallPhoto__badge",type:"admin"}):null)};function w(e){var t=e.title,n=e.description,a=e.className;return r.createElement("header",{className:Object(s.classNames)("CallHeader",a)},r.createElement("h1",{className:"CallHeader__title"},t),r.createElement("div",{className:"CallHeader__description"},n))}var D=function(){return(D=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},L=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},M=Object(r.forwardRef)((function(e,t){var n,a=e.type,r=e.isActive,i=e.icon,l=e.className,c=L(e,["type","isActive","icon","className"]),u=Object(s.classNames)("CallIconButton",l,((n={"CallIconButton--active":r})["CallIconButton--"+a]=!!a,n)),A=D(D({},c),{onMouseDown:function(e){e.preventDefault(),c.onMouseDown&&c.onMouseDown(e)}});return o.a.createElement("button",D({},A,{className:u,ref:t}),i)})),R=n("s0Wt"),j=o.a.createContext({getLang:function(e){return e},langSex:function(e,t){return t},langNumeric:function(e,t){return""+t},langShortDateTime:function(e){return""+e}});function k(e){var t=e.id,n=e.photo,a=e.title,o=e.description,i=e.onCollapseCall,l=e.children,c=r.useContext(j).getLang;return r.createElement("section",{className:"IncomingCall"},r.createElement(y,{id:t,photo:n}),r.createElement(R.default,{position:"b",text:c("calls_collapse"),marginTop:-6},r.createElement(M,{type:"collapse",className:"IncomingCall__collapse",onClick:i})),r.createElement(w,{title:a,description:o}),r.createElement(P,{id:t,waves:!0,photo:n,alt:a||""}),r.createElement("footer",{className:"IncomingCall__footer"},l))}var B=n("e87a"),U=n("1nu5"),G=function(e,t,n){var a=Object(r.useRef)(null);a.current=a.current?a.current:new U.VkIndexer(e,t);var o=a.current,i=Object(r.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),l=Object(r.useState)(e),c=l[0],s=l[1],u=Object(r.useState)(i(e)),A=u[0],d=u[1];return Object(r.useEffect)((function(){var t=i(e),a=e.filter((function(e){return!A[n(e)]})),r=c.filter((function(e){return!t[n(e)]}));(a.length||r.length)&&(a.forEach((function(e){o.add(e)})),r.forEach((function(e){o.remove(e)})),s(e),d(t))}),[e]),o};var x=function(e){var t=e.onClose,n=e.onBackdropClick,a=e.isIncoming,i=void 0!==a&&a,s=e.isCautionBoxShown,u=void 0!==s&&s,A=e.children,d=Object(l.useDispatch)();Object(r.useEffect)((function(){return document.body.classList.add("layers_shown"),function(){document.body.classList.remove("layers_shown")}}),[]);var p=u?function(){d({type:c.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:i||!1})}:t;return o.a.createElement(B.default,{className:"CallModal",disableBodyScroll:!0,onClose:p,onBackdropClick:n},A)};function H(e){return e>0&&e<2e9}function V(e){return e>2e9}var Q=function(e){return 0===e||V(e)};function W(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function z(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var a=e.browser.hasMicrophonePermission(),r=e.browser.hasCameraPermission(),o=n&&!a,i=t&&!r;return o||i?function(e,t,n){return e.browser.getUserMedia(t,n).then((function(e){e.getTracks().forEach((function(e){return e.stop()}))}))}(e,i,o):Promise.resolve()}var Y=function(){return(Y=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},K=new(function(){function e(){}return e.prototype.setActionStatCollector=function(e){this.actionStatCollector=e},e.prototype.logEvent=function(e){var t,n=Y(Y({},e),{peer_id:e.peer_id.toString(),session_id:e.session_id||"",lib_version:"calls_v2"});this.actionStatCollector&&this.actionStatCollector.logEvent(((t={type:"type_voip_call_item"}).type_voip_call_item=n,t))},e}());function Z(e,t,n){void 0===t&&(t=!0);var a="";return e&&t?a=n("calls_error_no_cam_and_mic"):e?a=n("calls_error_no_cam"):t&&(a=n("calls_error_no_mic")),a}function X(e,t){var n;return((n={})[c.MediaError.CAMERA_PERMISSION]=t("calls_error_no_cam"),n[c.MediaError.MIC_PERMISSION]=t("calls_error_no_mic"),n[c.MediaError.CAMERA_ACCESS]=t("calls_error_cameralock"),n[c.MediaError.MIC_ACCESS]=t("calls_error_miclock"),n[c.MediaError.MIC_NOT_FOUND]=t("calls_error_nomic"),n[c.MediaError.SCREEN_PERMISSION]=t("calls_error_screenpermission"),n[c.MediaError.SCREEN_ACCESS]=t("calls_error_screenlock"),n)[e]}function J(e){var t=e.SDK,n=Object(l.useSelector)((function(e){return[e.peer,e.callData,e.participants]})),r=n[0],i=n[1],s=n[2],u=Object(l.useDispatch)(),A=o.a.useContext(j).getLang,p=Q(r)?i.conversation:s[r],m=i.type===c.CallType.VIDEO,_=A(m?"calls_incoming_videocall":"calls_incoming_audiocall"),E=A(m?"calls_reply_with_audio":"calls_reply"),v=A(m?"calls_reject_call":"calls_reject"),g=function(e,n){return z(t,e,n).then((function(){return t.acceptCall(e,n)})).then((function(t){var n=t.acceptTime;u({type:c.CHANGE_MODE,mode:c.Mode.CALL,ts:n}),K.logEvent({call_event_type:c.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:i.callId,peer_id:r,is_group_call:Q(r),reason:e?c.CallType.VIDEO:c.CallType.AUDIO})})).catch((function(t){u({type:c.ERROR,text:Z(e,!0,A),handleType:c.ErrorHandleType.DECLINE}),console.error(t)}))};return o.a.createElement(x,{onClose:t.declineCall,isIncoming:!0,isCautionBoxShown:!0},o.a.createElement(k,{id:r,title:(null==p?void 0:p.tab)||"",description:_,photo:(null==p?void 0:p.photo)||"",onCollapseCall:function(){u({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED})}},m&&o.a.createElement(d,{text:A("calls_reply_with_video"),type:a.POSITIVE,icon:o.a.createElement(f,null),onClick:function(){return g(!0,!0)}}),o.a.createElement(d,{text:E,type:m?a.REGULAR:a.POSITIVE,icon:o.a.createElement(h,null),onClick:function(){return g(!1,!0)}}),o.a.createElement(d,{text:v,type:a.NEGATIVE,icon:o.a.createElement(O,null),onClick:function(){t.declineCall(),K.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:i.callId,peer_id:r,is_group_call:Q(r),reason:"none"})}})))}n("pIFo"),n("hhXQ"),n("KKXr");function q(e,t){return new Promise((function(n){setTimeout(n.bind(null,t),1e3*e)}))}var $=navigator.userAgent.toLowerCase(),ee={version:($.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test($)&&/webkit|safari|khtml/i.test($)},te=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"']];function ne(e){return te.reduce((function(e,t){var n=t[0],a=t[1];return e.replace(new RegExp(a,"ig"),n)}),e)}function ae(e){return te.reduce((function(e,t){var n=t[0],a=t[1];return e.replace(new RegExp(n,"ig"),a)}),e).replace(/&#(\d+);/g,(function(e,t){return String.fromCodePoint(t)}))}var re=function(){return(re=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},oe=function(e){var t=e.id,n=e.photo_400_orig,a=e.sex,r=e.first_name,o=e.last_name,i=e.screen_name,l=e.name,c=e.photo_400;return re({id:+t,peerId:+t,name:l||r+" "+o,firstName:r,shortName:ue(r,o,l),link:i&&"/"+i,sex:a},n||c?{photo:n||c}:{})};function ie(){return(ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function le(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function se(e){var t=e.shortName,n=e.firstName;e.lastName;if(!t||!n){var a=le(e.name.split(" "),2);t=ue(n=a[0],a[1],e.name)}return ie({},e,{peerId:+e.id,tab:e.name,shortName:t,firstName:n})}function ue(e,t,n){if(e){var a=t?t.length>2?t.substring(0,1)+".":t:"";return a?`${e} ${a}`:e}return n}function Ae(e){var t=le(e,2),n=t[0],a=t[1];return[n&&("peerId"in n?n:se(n)),a?a.map(se):[]]}function de(e){var t=e.items,n=e.profiles,a=le(t,1)[0],r=function(e){if(e.chat_settings){var t={peerId:e.peer.id,tab:e.chat_settings.title,name:e.chat_settings.title,canAddMembers:e.chat_settings.acl.can_invite};return e.chat_settings.photo&&(t.photo=e.chat_settings.photo.photo_100),t}return{canAddMembers:!0,peerId:e.peer.id}}(a),o=function(e){return e.map(oe)}(n);return[ie({},r,{tab:r.name}),H(r.peerId)?[ie({},o&&o.filter(e=>e.peerId===r.peerId)[0],{},r)]:o,a]}function pe(e){var t=e.caller_info,n=e.chat_info;return n?2e9+n.chat_id:t.user_id}function me(e){return!!e.payload.chat_info}function fe(e){return Object.values(e.participants).filter(t=>t.peerId===e.me||t.status)}function _e(e){return!!Object.values(e.participants).find(t=>(t.peerId===e.me||t.wasConnected)&&t.mediaSettings&&t.mediaSettings.isVideoEnabled)}function Ee(e){var t=Date.now(),n=Math.max(0,Math.floor((t-e)/1e3));return n<=599?"0"+Object(s.formatDuration)(n):Object(s.formatDuration)(n)}function he(e){ee.safari&&+ee.version.split(".")[0]<13&&window.setTimeout(()=>{e&&e.current&&(e.current.volume=1e-4)},10)}var ve=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return function(){return n.reduce((e,t)=>t(e),e)(...arguments)}};var ge=(e,t)=>function(){for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t(...a).catch(n=>{if(n.error===c.FatalError.AUTH)return e().then(()=>t(...a));throw n})};function Oe(e,t,n,a,r){var o=e=>ae(n(e)||"");if(e.length>t.length){var i=e.length-t.length,l=e.slice(0,3).map(o).join(", ");return r(i,"calls_members_list_label",a("calls_members_list_label",i)).replace("{name}",l)}if(t.length>1){var c=t.length>2?e.slice(0,2).map(o).join(", "):o(e[0]),s=o(e[t.length-1]);return a("calls_and").replace("{before}",c).replace("{after}",s)}return 1===t.length?o(e[0]):""}function Ce(e){return"current"in e?e.current:e}function be(e,t){var n=t.join_link,a=t.preview,r=t.profiles,o=[...t.anonyms,...r].map(oe);return{joinLink:n,title:a.title,membersCount:a.members_count,photo_100:a.photo.photo_100,photo_200:a.photo.photo_200,members:o,conversationData:{peerId:0,canAddMembers:!0,tab:e("calls_new_call_title"),photo:"/images/call_convo_stub.png"}}}function ye(){return(ye=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Se(e){var t=e.hasVideo,n=e.stream,a=e.isMe,o=e.isVideoVisible,i=e.isScreenShareStream,l=e.setVideoVisibility,c=e.className,u=e.allowContain,A=r.useRef(null),d=t&&n,p={autoPlay:!0,controls:!1,crossOrigin:"anonymous",playsInline:"playsinline",preload:"metadata",onLoadedData:()=>d&&!o&&l&&l(!0)},m=u&&function(e,t){if(t&&t.active){var n=t.getVideoTracks();if(!n||0===n.length)return!1;var a=n[0].getSettings(),r=void 0!==a.width?a.width:e?e.videoWidth:0;return(void 0!==a.height?a.height:e?e.videoHeight:0)>=r}return!1}(A.current,n)||i,f=Object(s.classNames)("Video",c,{"Video--contain":d&&n&&m,"Video--visible":d&&o,"Video--mirrored":a&&d&&!i});return r.useEffect(()=>{d&&A.current&&(A.current.srcObject=n,A.current.volume=0,he(A)),!d&&o&&l&&l(!1)},[e.hasVideo,e.stream,o]),d?r.createElement("video",ye({className:f,ref:A},p)):null}Se.defaultProps={hasVideo:!1,isMe:!1,isVideoVisible:!1,allowContain:!0,isScreenShareStream:!1};var Ne=n("85vT"),Ie=n("8tCR");function Fe(e){var t=e.isInverted,n=Object(s.classNames)("CallingStatus",{"CallingStatus--inverted":!!t});return o.a.createElement("div",{className:n},o.a.createElement("span",{className:"CallingStatus__part"}),o.a.createElement("span",{className:"CallingStatus__part"}),o.a.createElement("span",{className:"CallingStatus__part"}))}var Te,Pe=function(e){var t=e.id,n=e.photo,a=e.photoSize,r=void 0===a?"m":a,i=e.status,l=e.wasConnected,u=e.alt,A=e.letter,d=e.className;return o.a.createElement(Ie.default,{className:Object(s.classNames)("ParticipantCard",d)},o.a.createElement("span",{className:"ParticipantCard__in"},o.a.createElement(P,{id:t,photo:n,size:r,alt:u||"",letter:A}),i!==c.CallStatus.CONNECTED&&!l&&o.a.createElement("div",{className:"ParticipantCard__status"},o.a.createElement(Fe,{isInverted:!0}))))},we=function(){return(we=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},De=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Le=function(e){var t=De(e,[]);return o.a.createElement("svg",we({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 21 24"},t),o.a.createElement("path",{d:"M21.442 10.058c.513.77.588 1.831.192 2.663l-2.679 5.625C17.435 21.538 13.54 24 9.998 24H9c-4.422 0-8-3.58-8-8.009V8.128a2.746 2.746 0 013.5-2.642v-.732a2.75 2.75 0 013.571-2.629A2.749 2.749 0 0110.75 0c1.47 0 2.67 1.15 2.746 2.604A2.748 2.748 0 0117 5.254v4.264c1.299-1.278 3.357-1.087 4.442.54zM3.75 7.383a.746.746 0 00-.75.745v7.863A5.998 5.998 0 009 22h.998c2.773 0 5.964-2.02 7.152-4.514l2.678-5.625a.787.787 0 00-.05-.694c-.428-.642-1.123-.65-1.55-.01l-2.177 3.267c-.576.864-1.051.726-1.051-.323V5.255a.748.748 0 00-.75-.755.746.746 0 00-.75.747v5.757c0 .55-.448.996-1 .996-.556 0-1-.446-1-.995V2.752a.75.75 0 10-1.5 0v8.253c0 .54-.448.995-1 .995-.556 0-1-.446-1-.997v-6.25A.756.756 0 007.25 4a.75.75 0 00-.75.754v6.738c0 .551-.448 1.008-1 1.008-.556 0-1-.447-1-.999V8.138a.751.751 0 00-.75-.755z"}))},Me=function(){return(Me=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Re=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},je=function(e){var t=Re(e,[]);return o.a.createElement("svg",Me({width:"12",height:"20",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M4 3a2 2 0 104 0 2 2 0 00-4 0zm0 7a2 2 0 104 0 2 2 0 00-4 0zm2 9a2 2 0 110-4 2 2 0 010 4z",fill:"currentColor"}))},ke=n("6x0M"),Be=function(){return(Be=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ue=function(e){var t=e.children,n=e.items,a=Object(r.useState)(!1),i=a[0],l=a[1],c=Object(r.useRef)(null),u=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),l(!i)}),[i]),A=function(e){c.current&&c.current.contains(e.target)||l(!1)};return Object(r.useEffect)((function(){return document.documentElement.addEventListener("click",A),function(){return document.documentElement.removeEventListener("click",A)}}),[]),i?o.a.createElement(ke.Popper,{content:o.a.createElement("ul",{className:"CallsDropdown",ref:c},n.map((function(e,t){return o.a.createElement("li",{className:"CallsDropdown__item",key:e.key||t},function(e,t,n){void 0===n&&(n=!1);var a=Object(s.classNames)("CallsDropdown__button",{"CallsDropdown__button--disabled":n});return"href"in e&&"onClick"in e&&void 0!==e.onClick?o.a.createElement("a",{href:e.href,rel:"noopener noreferrer",target:"_blank",onClick:n?void 0:function(n){n.stopPropagation(),e.onClick(n),t(!1)},className:a},e.text):"href"in e?o.a.createElement("a",{href:e.href,rel:"noopener noreferrer",target:"_blank",onClick:n?void 0:function(e){e.stopPropagation(),t(!1)},className:a},e.text):"onClick"in e?o.a.createElement("button",{onClick:n?void 0:function(n){n.stopPropagation(),e.onClick(n),t(!1)},className:a},e.text):null}(e,l,e.disabled))}))),mode:"point"},o.a.cloneElement(t,Be(Be({},t.props),{onClick:u,"data-active":i}))):o.a.cloneElement(t,Be(Be({},t.props),{onClick:u}))},Ge=function(){return(Ge=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},xe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},He=function(e){var t=xe(e,[]);return o.a.createElement("svg",Ge({width:"25",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M10 8a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"}),o.a.createElement("path",{d:"M6.558 10a.024.024 0 00-.017.04l3.254 3.255-2.947 2.948a1 1 0 001.414 1.414l2.948-2.948 3.25 3.25c.015.015.04.005.04-.017v-2.114c0-1.81.72-3.547 2-4.828l1.658-.414a.2.2 0 00.093-.336l-4-4a.2.2 0 00-.336.093L13.5 8a6.828 6.828 0 01-4.829 2H6.558z"}))},Ve=function(e){var t=e.id,n=e.isOrator,a=void 0!==n&&n,i=e.isInfoShown,l=e.isPinned,u=e.isPinnedByAdmin,A=e.isHandRaised,d=e.photo,p=e.hasVideo,m=e.hasAudio,f=e.isSharingScreen,_=e.isSpeaking,E=void 0!==_&&_,h=e.stream,v=e.isMe,g=void 0!==v&&v,O=e.photoSize,C=e.name,b=e.letter,S=e.status,N=void 0===S?c.CallStatus.CONNECTED:S,I=e.wasConnected,F=void 0===I||I,T=e.onClickParticipant,P=e.onDblClickParticipant,w=e.onShow,D=e.onHide,L=e.allowContain,M=void 0!==L&&L,R=e.actions,k=o.a.useContext(j).getLang,B=o.a.useRef(null),U=!!T||!!P,G=Object(s.classNames)("Participant",{"Participant--isInteractive":U,"Participant--isPinned":l,"Participant--isSpeaking":E,"Participant--isOrator":a}),x=o.a.useState(!1),H=x[0],V=x[1];o.a.useEffect((function(){if(w&&D){w(t);var e=new IntersectionObserver((function(e){e[0].isIntersecting?w(t):D(t)}),{root:null,rootMargin:"0px",threshold:0});return B.current&&e.observe(B.current),function(){return e.disconnect()}}return function(){}}),[B]),o.a.useEffect((function(){p&&h||V(!1)}),[p,h,H]);var Q=!(p&&h)||!H,W=Object(r.useCallback)((function(e){T&&T(e,t)}),[T]),z=Object(r.useCallback)((function(e){P&&P(e,t)}),[P]);return o.a.createElement("article",{ref:B,className:G,onClick:W,onDoubleClick:z},R&&R.length>0&&o.a.createElement(Ue,{items:R},o.a.createElement("button",{className:"Participant__more","aria-label":k("calls_actions")},o.a.createElement(je,null))),U&&!u&&o.a.createElement("header",{className:"Participant__header"},l&&o.a.createElement("div",{className:"Participant__pin"})),u&&o.a.createElement("header",{className:"Participant__header"},o.a.createElement(He,{className:"Participant__icon"})),Q&&o.a.createElement(y,{id:t,photo:d,className:"Participant__main"},o.a.createElement(Pe,{id:t,photo:d,photoSize:O,status:N,wasConnected:F||g,alt:C||"",letter:b,className:i?"Participant__offsetCard":""})),A&&o.a.createElement("div",{className:"Participant__handIndicator"},o.a.createElement(Le,{className:"Participant__handIcon"})),p&&o.a.createElement(Se,{className:"Participant__main",hasVideo:p,stream:h,isMe:g,isVideoVisible:H,isScreenShareStream:f,setVideoVisibility:V,allowContain:M}),i&&o.a.createElement("footer",{className:"Participant__footer"},o.a.createElement(Ne.default,{className:"Participant__name"},C),(F||g)&&!m&&o.a.createElement("span",{className:"Participant__statusIcon Participant__statusIcon--mic"})))},Qe=function(e){var t=e.id,n=e.name,a=e.letter,r=e.hasAudio,i=e.hasVideo,l=e.isSharingScreen,c=e.stream,u=e.wasConnected,A=e.opponentId,d=e.opponentHasAudio,p=e.opponentHasVideo,m=e.opponentIsSharingScreen,f=e.opponentStream,_=e.opponentPhoto,E=e.opponentName,h=e.opponentLetter,v=e.opponentWasConnected,g=Object(s.classNames)("OneToOne",{"OneToOne--hasVideo":i,"OneToOne--opponentHasVideo":p});return o.a.createElement("div",{className:g},o.a.createElement("aside",{className:"OneToOne__local"},o.a.createElement(Ve,{id:t,hasVideo:i,hasAudio:r,isSharingScreen:l,stream:c,isMe:!0,name:n,letter:a,photoSize:"m",wasConnected:u})),o.a.createElement("main",{className:"OneToOne__remote"},o.a.createElement(Ve,{id:A,hasVideo:p,hasAudio:d,isSharingScreen:m,stream:f,photo:_,name:E,letter:h,photoSize:"l",wasConnected:v})))},We=function(){return(We=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ze=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ye=function(e){var t=e.children,n=e.className,a=e.alignX,r=e.alignY,i=e.size,l=void 0===i?"m":i,c=ze(e,["children","className","alignX","alignY","size"]),u=Object(s.classNames)("CallIconButtonGroup","CallIconButtonGroup--"+a,"CallIconButtonGroup--"+r,"CallIconButtonGroup--size-"+l,n);return o.a.createElement("div",We({className:u},c),t)},Ke=function(){return(Ke=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ze=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Xe=function(e){var t=Ze(e,[]);return o.a.createElement("svg",Ke({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M4.3 4.3a1 1 0 011.4 0l6.3 6.29 6.3-6.3a1 1 0 111.4 1.42L13.42 12l6.3 6.3a1 1 0 01-1.42 1.4L12 13.42l-6.3 6.3a1 1 0 01-1.4-1.42L10.58 12l-6.3-6.3a1 1 0 010-1.4z"}))},Je=function(){return(Je=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},qe=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},$e=Object(r.forwardRef)((function(e,t){var n=e.unreadCount,a=void 0===n?0:n,r=qe(e,["unreadCount"]),i="",l="";switch(!0){case!a:i="none";break;case a<=9:i="single",l=a.toString();break;case a<=99:i="double",l=a.toString();break;case a>99:i="max",l="99+"}var c=Object(s.classNames)("ChatIconButton","ChatIconButton--"+i);return o.a.createElement("button",Je({className:c},r,{ref:t}),l&&o.a.createElement("div",{className:"ChatIconButton__count "},l))})),et=function(){return(et=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},tt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},nt=function(e){var t=tt(e,[]);return o.a.createElement("svg",et({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M1.721 2.307L4 4.586v-.002l7.029 7.029 4.693 4.695a1 1 0 01-1.414 1.414l-1.938-1.937A8.482 8.482 0 019 16.941V19a1 1 0 01-1.993.117L7.001 19v-2.06c-3.234-.384-5.995-2.611-6.955-5.646a.995.995 0 01.681-1.25 1.035 1.035 0 011.287.662C2.808 13.216 5.257 15 7.999 15c1.03 0 2.016-.25 2.89-.695l-1.538-1.539A4 4 0 014 9V7.414L.307 3.721a1 1 0 011.414-1.414zm13.55 7.737c.544.162.85.72.684 1.249a7.825 7.825 0 01-.75 1.666l-1.51-1.51c.113-.239.21-.487.29-.742a1.035 1.035 0 011.287-.663zM8 0a4 4 0 014 4v5c0 .237-.02.468-.06.694L4.433 2.188A4 4 0 018 0z"}))},at=function(){return(at=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},rt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ot=function(e){var t=rt(e,[]);return o.a.createElement("svg",at({height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"}),o.a.createElement("path",{d:"M1.1 10c-.551 0-.982.486-.843 1.02A8.007 8.007 0 007.1 16.95v2.15a.9.9 0 101.8 0v-2.15a8.007 8.007 0 006.843-5.93c.139-.534-.292-1.02-.843-1.02-.45 0-.826.329-.953.76a6.203 6.203 0 01-11.894 0C1.926 10.33 1.55 10 1.1 10z"}))},it=function(){return(it=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},lt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ct=function(e){var t=lt(e,[]);return o.a.createElement("svg",it({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M17 12.5c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714h-6.09c.158-.488.237-1.062.237-1.714 0-1.723-.631-3.067-1.672-4.062.783-.16 1.548-.224 2.172-.224zm-9 0c2.294 0 6.5.857 6.5 4.286 0 1.5-.382 1.714-1.147 1.714H2.647c-.765 0-1.147-.214-1.147-1.714C1.5 13.357 5.706 12.5 8 12.5zM8 5a3 3 0 110 6 3 3 0 110-6zm9 0a3 3 0 110 6 3 3 0 110-6z"}))},st=function(){return(st=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ut=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},At=function(e){var t=ut(e,[]);return o.a.createElement("svg",st({width:"24",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M3.86 14c-.24 0-.47.02-.7.06a1 1 0 11-.33-1.98 6.14 6.14 0 017.08 7.08 1 1 0 01-1.97-.33A4.14 4.14 0 003.85 14z"}),o.a.createElement("path",{d:"M4 20a2 2 0 100-4 2 2 0 000 4zM10.96 4h2.08c1.37 0 2.45 0 3.33.07.9.07 1.65.23 2.35.58a6 6 0 012.63 2.63c.35.7.5 1.46.58 2.35.07.88.07 1.33.07 1.33v2.08s0 .45-.07 1.33c-.07.9-.23 1.65-.58 2.35a6 6 0 01-2.63 2.63c-.7.35-1.46.5-2.35.58-.88.07-1.96.07-3.33.07H13a1 1 0 110-2c1.42 0 2.42 0 3.2-.06a4.23 4.23 0 001.62-.38 4 4 0 001.74-1.74c.2-.37.31-.85.38-1.62.06-.78.06-1.2.06-1.2v-2s0-.42-.06-1.2a4.23 4.23 0 00-.38-1.62 4 4 0 00-1.74-1.74c-.37-.2-.85-.31-1.62-.38C15.42 6 14.42 6 13 6h-2c-1.42 0-2.42 0-3.2.06-1.78.15-3.35 1.23-3.66 3.1a1 1 0 11-1.97-.32 5.8 5.8 0 013.1-4.19c.7-.35 1.47-.5 2.36-.58C8.51 4 9.6 4 10.96 4z"}))},dt=function(){return(dt=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},pt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},mt=function(e){var t=pt(e,[]);return o.a.createElement("svg",dt({width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M6 5.18c.65 0 1 .54 1 1.2v5.48c0 .22.26.4.47.4.23 0 .52-.18.52-.4V4c0-.66.33-1.2.99-1.2.65 0 1.02.54 1.02 1.2v7.08c0 .22.29.4.5.4.22 0 .5-.18.5-.4V3.19c0-.66.31-1.2.97-1.2.66 0 1.04.54 1.04 1.2v7.88c0 .22.24.4.46.4.22 0 .52-.18.52-.4V4.79c0-.67.32-1.18.98-1.18.66 0 1.02.51 1.02 1.17v10.73l2.29-2.67c.33-.45 1-.68 1.65-.26.34.2.86.81.2 1.68 0 0-2.45 3.09-3.81 4.74-1.3 1.65-3.81 2.5-5.51 2.5C5.25 21.5 5 17.71 5 16.43V6.37c0-.65.33-1.19 1-1.19z"}))},ft=function(){return(ft=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},_t=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Et=function(e){var t=_t(e,[]);return o.a.createElement("svg",ft({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M6.1 9a.9.9 0 01.9.9v4.2a.9.9 0 11-1.8 0v-2.027l-3.664 3.663a.9.9 0 11-1.272-1.272L3.927 10.8H1.9a.9.9 0 110-1.8zM15.736.264a.9.9 0 010 1.272L12.073 5.2h2.025a.9.9 0 010 1.8H9.9a.9.9 0 01-.9-.9V1.9a.9.9 0 111.8 0v2.027L14.464.264a.9.9 0 011.272 0z"}))},ht=function(){return(ht=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},vt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},gt=function(e){var t=vt(e,[]);return o.a.createElement("svg",ht({height:"16",width:"16",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M6.5 15a1 1 0 01-1 1H1a1 1 0 01-1-1v-4.5a1 1 0 012 0v2.071l3.363-3.364a1 1 0 011.414 0l.016.016a1 1 0 010 1.414L3.428 14H5.5a1 1 0 011 1zM14 3.428l-3.363 3.365a1 1 0 01-1.414 0l-.016-.016a1 1 0 010-1.414L12.571 2H10.5a1 1 0 010-2H15a1 1 0 011 1v4.5a1 1 0 01-2 0z"}))},Ot=function(){return(Ot=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ct=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},bt=function(e){var t=Ct(e,[]);return o.a.createElement("svg",Ot({height:"16",width:"22",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t),o.a.createElement("path",{d:"M1.514.242A.9.9 0 00.286 1.558l1.092 1.02C1.13 3.053 1 3.548 1 4.846v6.308c0 1.338.14 1.822.4 2.311.262.49.646.873 1.135 1.134.489.262.974.401 2.31.401h7.31c1.207 0 1.72-.114 2.168-.328l1.163 1.086a.9.9 0 001.228-1.316L1.514.242zM15.999 11.346L4.924 1h7.23c1.338 0 1.822.14 2.311.4.49.262.873.646 1.134 1.135.262.489.401.974.401 2.31 0 2.167.023 4.335-.001 6.501zM22 4.497v7.006c0 .815-.964 1.277-1.6.8l-2.2-1.653a.5.5 0 01-.2-.4v-4.5a.5.5 0 01.2-.4l2.2-1.652c.651-.49 1.6.003 1.6.8z"}))},yt=function(){return(yt=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},St=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function Nt(e){var t=e.children,n=e.content,a=e.position,i=void 0===a?"auto":a,l=e.align,c=void 0===l?"auto":l,u=e.appearance,A=void 0===u?"dark":u,d=e.open,p=void 0!==d&&d,m=e.onOpen,f=e.onClose,_=e.delay,E=void 0===_?50:_,h=St(e,["children","content","position","align","appearance","open","onOpen","onClose","delay"]),v=Object(r.useState)(p?Te.OPENED:Te.CLOSED),g=v[0],O=v[1],C=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=null,t=null,n=function(){e&&(clearTimeout(e),e=null)},a=function(){n(),e=window.setTimeout((function(){O(Te.OPENED),m&&m()}),E)},r=function(){n(),t=window.setTimeout((function(){g===Te.OPENED?O(Te.IS_CLOSING):(O(Te.CLOSED),f&&f())}),0)};return C&&C.current&&(C.current.addEventListener("mouseenter",a),C.current.addEventListener("mouseleave",r)),function(){C&&C.current&&(C.current.removeEventListener("mouseenter",a),C.current.removeEventListener("mouseleave",r)),n(),t&&(window.clearTimeout(t),t=null)}}),[C,g]),Object(r.useEffect)((function(){var e=p?Te.OPENED:Te.CLOSED;g!==e&&O(e)}),[p]);var b=Object(r.useCallback)((function(){g===Te.IS_CLOSING&&(O(Te.CLOSED),f&&f())}),[g]),y=Object(s.classNames)("TooltipNew",{"TooltipNew--removed":"isClosing"===g,"TooltipNew--dark":"dark"===A,"TooltipNew--light":"light"===A}),S=o.a.createElement("div",{className:y,onTransitionEnd:b},n);return o.a.createElement(ke.Popper,yt({content:S,position:i,align:c,open:g!==Te.CLOSED,ref:C},h),t)}!function(e){e.OPENED="opened",e.IS_CLOSING="isClosing",e.CLOSED="closed"}(Te||(Te={}));var It=function(){return o.a.createElement("svg",{height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator"},o.a.createElement("mask",{id:"MicIconWithSpeakingIndicatorMask"},o.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"})),o.a.createElement("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"}),o.a.createElement("g",{mask:"url(#MicIconWithSpeakingIndicatorMask)"},o.a.createElement("g",{className:"MicIconWithSpeakingIndicator__scale"},o.a.createElement("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"}),o.a.createElement("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"}))))};function Ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Pt(e){var t=e.id,n=e.photo,o=e.disablePhoto,i=e.info,l=e.chatUnreadCount,c=void 0===l?0:l,u=e.callMenuActions,A=e.isAudioAllowed,p=e.isVideoAllowed,m=e.isVideoEnabled,_=e.isAudioEnabled,E=e.isScreenSharingEnabled,h=e.isOratorMode,v=e.isFullScreen,g=e.onToggleVideo,O=e.onToggleAudio,C=e.onLeaveCall,b=e.onCollapseCall,S=e.onToggleOratorMode,N=e.onChat,I=e.onHandClick,F=e.onToggleScreenShare,T=e.onFullScreenToggle,P=e.isParticipantControlActive,w=e.isLayoutSwitchShown,D=e.isScreenShareControlShown,L=e.isHandRaised,R=e.isHandControlShown,k=e.isChatControlShown,B=e.onParticipantsClick,U=e.onTooltipChange,G=e.onHidePanel,x=e.notification,H=e.tooltips,V=e.amISpeaking,Q=e.children,W=r.useContext(j).getLang,z=Object(s.classNames)("Call",{"Call--fullscreen":v}),Y=r.useRef(null),K=function(e,t){var n=Ft(r.useState(!0),2),a=n[0],o=n[1],i=r.useRef(null),l=r.useRef(!1),c=r.useRef(!1),u=()=>{l.current||c.current?c.current=!1:(i.current&&window.clearTimeout(i.current),o(!0),i.current=window.setTimeout(()=>{o(!1),i.current=null,t&&t()},5e3))};return r.useEffect(()=>{u();var t=Object(s.throttle)(()=>{u()},1e3);return e.current.addEventListener("mousemove",t),()=>{l.current=!0,i.current&&window.clearTimeout(i.current),e.current.removeEventListener("mousemove",t)}},[]),[a,e=>{e?o(!0):(o(!1),c.current=!0)}]}(Y,G),Z=Ft(K,2),X=Z[0],J=Z[1],q=Object(s.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!X}),$=Object(s.classNames)("Call__controlPanel",{"Call__controlPanel--hideBottom":!X},"Call__curtain"),ee=Object(s.classNames)("Call__buttons","Call__controlPanel",{"Call__controlPanel--hideBottom":!X});return r.createElement("section",{className:z,onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),ref:Y},i,r.createElement("div",{className:"Call__content"},r.createElement(y,{id:t,photo:n,disablePhoto:o},Q)),r.createElement("div",{className:$}),r.createElement(Ye,{alignX:"l",alignY:"b",className:q},k&&r.createElement(Nt,{content:W("calls_chat"),open:H.chat,delay:300,onOpen:()=>U("chat",!0),onClose:()=>U("chat",!1)},r.createElement($e,{unreadCount:c,onClick:N})),R&&r.createElement(Nt,{content:W(L?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:H.hand,delay:300,onOpen:()=>U("hand",!0),onClose:()=>U("hand",!1)},r.createElement(M,{icon:r.createElement(mt,null),type:"hand",isActive:L,onClick:I})),D&&r.createElement(Nt,{content:W(E?"calls_stop_screen_share":"calls_start_screen_share"),open:H.screenShare,delay:300,onOpen:()=>U("screenShare",!0),onClose:()=>U("screenShare",!1)},r.createElement(M,{icon:r.createElement(At,null),isActive:E,onClick:F}))),r.createElement(Ye,{alignX:"r",alignY:"b",style:v?{right:"70px"}:void 0,className:q},w&&r.createElement(Nt,{content:W(h?"calls_show_grid":"calls_show_orator"),open:H.layout,delay:300,onOpen:()=>U("layout",!0),onClose:()=>U("layout",!1)},r.createElement(M,{type:h?"changeToGrid":"changeToOrator",onClick:S})),r.createElement(Ue,{items:u},r.createElement(M,{type:"settings"})),r.createElement(Nt,{content:W("calls_collapse"),open:H.collapse,delay:300,onOpen:()=>U("collapse",!0),onClose:()=>U("collapse",!1)},r.createElement(M,{type:"collapse",onClick:b})),r.createElement(Nt,{content:W(v?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:H.fullscreen,delay:300,onOpen:()=>U("fullscreen",!0),onClose:()=>U("fullscreen",!1)},r.createElement(M,{onClick:T,icon:v?r.createElement(Et,null):r.createElement(gt,null)}))),r.createElement("footer",{className:"Call__footer"},x&&r.createElement("div",{className:"Call__notification"},x),r.createElement("div",{className:ee},r.createElement(d,{type:P?a.OFF:a.ON,icon:r.createElement(ct,null),onClick:B,className:"Call__footerButton"}),r.createElement(d,{type:p?m?a.ON:a.OFF:a.DISABLED,icon:m?r.createElement(f,null):r.createElement(bt,null),onClick:g,className:"Call__footerButton"}),r.createElement(d,{type:A?_?a.ON:a.OFF:a.DISABLED,icon:_?V?r.createElement(It,null):r.createElement(ot,null):r.createElement(nt,null),onClick:O,className:"Call__footerButton"}),r.createElement(d,{type:a.NEGATIVE,icon:r.createElement(Xe,null),onClick:C,className:"Call__footerButton"}))))}var wt=function(e){var t=e.limit,n=e.children,a=r.Children.toArray(n),i=Math.min(a.length,t),l=Object(s.classNames)("CallGridNew","CallGridNew--c"+i);return o.a.createElement("section",{className:l},o.a.createElement("div",{className:"CallGridNew__in"},a.map((function(e,t){return o.a.createElement("article",{className:"CallGridNew__item",key:e.key||t},e)}))))},Dt=function(){return(Dt=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Lt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Mt=function(e){var t=Lt(e,[]);return o.a.createElement("svg",Dt({width:"25",height:"24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.541 10.04a.024.024 0 01.017-.04h2.114c1.811 0 3.548-.72 4.829-2l.414-1.657a.2.2 0 01.335-.093l4 4a.2.2 0 01-.092.336L16.5 11a6.828 6.828 0 00-2 4.828v2.114a.024.024 0 01-.04.017l-3.25-3.25-2.948 2.948a1 1 0 11-1.414-1.414l2.947-2.948-3.254-3.254z"}))},Rt=function(e){var t=e.children,n=e.orator,a=e.onToggleParticipantsAside,i=e.isShownParticipantsAside,l=e.isPinned,c=e.isPinnedByAdmin,u=e.isUnpinAllowed,A=e.onUnpin,d=e.tooltips,p=e.onTooltipChange,m=Object(r.useContext)(j).getLang,f=o.a.Children.toArray(t),_=Object(s.classNames)({CallOrator:!0,"CallOrator--withoutOthers":!i}),E=Object(s.classNames)({CallOrator__others:!0,"CallOrator__others--hide":!i}),h=Object(s.classNames)({CallOrator__toggleArrow:!0,"CallOrator__toggleArrow--toLeft":i,"CallOrator__toggleArrow--toRight":!i});return o.a.createElement("article",{className:_},o.a.createElement("main",{className:"CallOrator__orator"},(c||l)&&o.a.createElement(Nt,{position:"b",align:"center",content:m(c&&u?"calls_hint_admin_pin_for_admin":c?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:d.oratorPin,delay:300,onOpen:function(){return p("oratorPin",!0)},onClose:function(){return p("oratorPin",!1)}},o.a.createElement("div",{className:"CallOrator__pinButtonWrapper"},o.a.createElement("button",{className:"CallOrator__pinButton",onClick:function(){p("oratorPin",!1),A()},disabled:!u},c?o.a.createElement(He,null):o.a.createElement(Mt,null)))),n),o.a.createElement("button",{className:"CallOrator__toggleOthers",onClick:a},o.a.createElement("div",{className:"CallOrator__toggleIcon"},o.a.createElement("div",{className:h}))),o.a.createElement("aside",{className:E},o.a.createElement("ul",{className:"CallOrator__list"},f.map((function(e){return o.a.createElement("li",{className:"CallOrator__participant",key:"key"in e?e.key:void 0},e)})))))},jt=function(e){var t=e.children,n=e.className,a=Object(s.classNames)("CallNotification",n);return o.a.createElement("div",{className:a},t)},kt=function(){return(kt=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Bt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Ut=function(e){var t=Bt(e,[]);return o.a.createElement("svg",kt({width:"14",height:"12",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),o.a.createElement("path",{d:"M9.574 11.13a.751.751 0 001.061-1.06L1.48.92A.75.75 0 10.42 1.98l.82.82c-.153.282-.24.606-.24.95v4.5a2 2 0 002 2h5a2 2 0 00.601-.092l.973.972zM13.897 3.664A.454.454 0 0114 3.95v4.075c0 .415-.392.602-.825.382-.475-.24-1.572-.789-1.572-.789a.233.233 0 01-.103-.19v-2.88c0-.075.038-.146.103-.19 0 0 1.378-.694 1.572-.79.193-.094.55-.115.722.096zM10 7.425V3.75a2 2 0 00-2-2H4.32L10 7.425z"}))},Gt=function(){var e=Object(l.useSelector)((function(e){return e})),t=Object(l.useDispatch)(),n=o.a.useContext(j),a=n.getLang,i=n.langSex,s=Object(r.useMemo)((function(){return function(e,t,n){if(!e.notification)return null;switch(e.notification.type){case c.NotificationType.SPEAKING_ON_MUTE:return o.a.createElement(Ne.default,null,t("calls_notification_mic_is_mute"));case c.NotificationType.SCREEN_SHARING_STARTED:if(!(r=e.participants[e.notification.data])||!r.name)return o.a.createElement(Ne.default,null,t("calls_notification_screen_sharing_started"));var a=n(r.sex,"calls_notification_user_started_screen_sharing",t("calls_notification_user_started_screen_sharing",!0));return o.a.createElement(Ne.default,null,a.replace("{user}",r.name));case c.NotificationType.RAISED_HAND:var r=e.participants[e.notification.data];a=n(r.sex,"calls_notification_raised_hand",t("calls_notification_raised_hand",!0));return o.a.createElement(Ne.default,null,a.replace("{user}",r.name));case c.NotificationType.BAD_NETWORK_CONNECTION:return o.a.createElement(Ne.default,null,t("calls_notification_bad_network_connection"));case c.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[o.a.createElement(Ut,{key:"icon"}),o.a.createElement(Ne.default,{key:"text"},t("calls_notification_bad_network_connection_disable_camera"))];case c.NotificationType.ADMIN_MUTE:return o.a.createElement(Ne.default,{key:"text"},t("calls_notification_admin_mute"));case c.NotificationType.ADMIN_MUTE_PERMANENT:return o.a.createElement(Ne.default,{key:"text"},t("calls_notification_admin_permanent_mute"));case c.NotificationType.ADMIN_ROLE_GRANTED:return o.a.createElement(Ne.default,{key:"text"},t("calls_notification_admin_role_granted"));case c.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE:r=e.participants[e.notification.data];var i=t("calls_notification_user_granted_with_admin_role").replace("{name}",r.shortName||r.name);return o.a.createElement(Ne.default,{key:"text"},i);case c.NotificationType.PINNED_BY_ADMIN:return o.a.createElement(Ne.default,{key:"text"},t("calls_notification_admin_pinned_self"));case c.NotificationType.USER_PINNED_BY_ADMIN:r=e.participants[e.notification.data],i=t("calls_notification_admin_pinned_user").replace("{name}",r.shortName||r.name);return o.a.createElement(Ne.default,{key:"text"},i);default:return null}}(e,a,i)}),[e.notification]),u=Object(r.useRef)(0);return Object(r.useEffect)((function(){return u.current&&window.clearTimeout(u.current),e.notification&&0!==e.notification.timer&&(u.current=window.setTimeout((function(){t({type:c.CALL_NOTIFICATION,notification:null}),u.current=0}),e.notification.timer||c.defaultNotificationLifeSpan)),function(){u.current&&window.clearTimeout(u.current)}}),[e.notification]),e.notification?o.a.createElement(jt,null,s):null};var xt=n("o4aG"),Ht=function(e){return e<0},Vt=function(e){return(null==e?void 0:e.peerId)?e.isAnonym?{id:e.peerId.toString(),type:xt.ExternalIdType.ANONYM}:e.peerId.toString():null},Qt=function(e,t,n,a,r,o,i,l){var s=a.peerId===e.me,u=Ht(a.peerId)||a.isAnonym,A=Q(e.peer),d=e.participants[e.me],p=[];return s||!r||u||p.push({text:o("calls_go_to_profile"),onClick:function(e){l(e,a.link)}}),s||u||Ht(e.me)||p.push({text:o("calls_go_to_chat_with_participant"),onClick:function(){n({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED}),n({type:c.MANAGEMENT,isOpen:!1}),i(a.peerId)}}),s||!A||Ht(e.me)||!function(e){return $t(e)||en(e)}(d)||en(a)||p.push({text:o("calls_participant_menu_kick"),onClick:function(){var e=Vt(a);e&&t.removeParticipant(e)}}),e.callsAdminMode&&!s&&A&&!Ht(e.me)&&tn(d)&&p.push({text:o("calls_participant_menu_mute_audio_video"),onClick:function(){n({type:c.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:c.ParticipantsManagementMode.SINGLE,participant:a}})}}),s||A||Ht(e.me)||!tn(d)||p.push({text:o("calls_participant_menu_mute"),onClick:function(){var e=Vt(a);e&&t.muteParticipant(e,[c.MediaOption.AUDIO],!1).catch(console.log)}}),e.callsAdminMode&&!s&&A&&!Ht(e.me)&&tn(e.participants[e.me])&&!function(e){if(!e.mediaSettings)return!1;var t=e.mediaSettings,n=t.isAudioEnabled,a=t.isVideoEnabled,r=t.isScreenSharingEnabled;return n&&(a||r)}(a)&&p.push({text:o("calls_participant_menu_enable_media_request"),onClick:function(){t.unmuteRequest(Vt(a),[c.MediaOption.AUDIO,c.MediaOption.VIDEO]).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.ASK_USER_TO_UNMUTE,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Q(e.peer)})}}),!e.callsAdminMode||s||!A||Ht(e.me)||Ht(a.peerId)||!nn(e.participants[e.me])||$t(a)||en(a)||p.push({text:o("calls_participant_menu_assign_admin_role"),onClick:function(){n({type:c.TOGGLE_ADMIN_ASSIGNMENT,data:{participant:a}})}}),e.callsAdminMode&&!s&&A&&!Ht(e.me)&&nn(e.participants[e.me])&&$t(a)&&p.push({text:o("calls_participant_menu_revoke_admin_role"),onClick:function(){var r=Vt(a);r&&(t.grantRoles(r,[c.UserRole.ADMIN],!0).then((function(){n({type:c.CHANGE_PARTICIPANT_ROLES,participantId:a.peerId,data:a.roles.filter((function(e){return e!==c.UserRole.ADMIN}))})})).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.RETRIEVE_ADMIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Q(e.peer)}))}}),e.callsAdminMode&&A&&!Ht(e.me)&&qt(e.participants[e.me])&&!Jt(e,a)&&p.push({text:o("calls_participant_menu_pin"),onClick:function(){var r=Vt(a);r&&(t.pinParticipant(r,!1).then((function(){n({type:c.SET_ADMIN_PINNED_PARTICIPANT,data:a.peerId}),n({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0})})).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.ADMIN_PIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Q(e.peer)}))}}),e.callsAdminMode&&A&&!Ht(e.me)&&qt(e.participants[e.me])&&Jt(e,a)&&p.push({text:o("calls_participant_menu_pin_cancel"),onClick:function(){var r=Vt(a);r&&(t.pinParticipant(r,!0).then((function(){n({type:c.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.ADMIN_UNPIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Q(e.peer)}))}}),p},Wt=function(e,t){var n=e.participants[t];return n&&(n.peerId===e.me||!!n.status)};function zt(e,t){var n,a,r,o=e.pinnedParticipant||e.orator;if(o)return e.participants[o];for(var i=0,l=Object.values(e.participants);i<l.length;i++){var c=l[i];if(c.peerId!==e.me&&c.wasConnected&&(r||(r=c),!t||(null===(n=c.mediaSettings)||void 0===n?void 0:n.isVideoEnabled)))return c}var s=e.participants[e.me];return!r&&t&&(null===(a=s.mediaSettings)||void 0===a?void 0:a.isVideoEnabled)?s:r}function Yt(e,t){return Object.values(e.participants).reduce((function(n,a){return(void 0===t||t(a))&&a.peerId!==e.me&&a.status&&n.push(a),n}),[e.participants[e.me]])}function Kt(e){var t=e.participants,n=0;for(var a in t)t.hasOwnProperty(a)&&Xt(e,t[a])&&n++;return n}function Zt(e){return Object.values(e.participants).filter((function(e){return e.status===c.CallStatus.CONNECTED})).concat(e.participants[e.me])}function Xt(e,t){return t.peerId===e.me||t.status}function Jt(e,t){return e.adminPinnedParticipant===t.peerId}function qt(e){return $t(e)||en(e)}function $t(e){return!!(null==e?void 0:e.roles)&&e.roles.some((function(e){return e===c.UserRole.ADMIN}))}function en(e){return!!(null==e?void 0:e.roles)&&e.roles.some((function(e){return e===c.UserRole.CREATOR}))}function tn(e){return!!e.roles&&(en(e)||$t(e))}function nn(e){return!!e.roles&&(en(e)||$t(e))}var an=function(){return(an=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},rn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},on=function(e){var t=e.children,n=e.className,a=rn(e,["children","className"]),r=Object(s.classNames)("ActivityIndicator",n);return o.a.createElement("span",an({},a,{className:r}),t)};on.propTypes={className:b.a.string,children:b.a.node};var ln=on,cn=function(e){var t=e.participant,n=o.a.useContext(j).getLang,a=t.status,r=t.wasConnected;switch(a){case c.CallStatus.WAITING:return r?o.a.createElement(ln,null,n("calls_status_waiting")):o.a.createElement(Fe,{isInverted:!0});case c.CallStatus.CONNECTING:case c.CallStatus.RECONNECT:return o.a.createElement(ln,null,n("calls_status_connecting"));case c.CallStatus.ERROR:return n("calls_error");case c.CallStatus.HANGUP:return o.a.createElement(ln,null,n("calls_status_hangup"));case c.CallStatus.PERMISSIONS:return n("calls_status_no_permissions");case c.CallStatus.CONNECTED:default:return null}},sn=function(e){var t=e.duration;return o.a.createElement("div",{className:"CallTimer","aria-label":t,"data-duration":t})},un=function(){var e=Object(l.useSelector)((function(e){return e})),t=o.a.useContext(j).getLang,n=o.a.useRef(e);o.a.useEffect((function(){n.current=e}),[e]);var a=e.peer,r=Q(a)?e.callData.conversation:e.participants[a],i=o.a.useState(),c=i[0],s=i[1],u=o.a.useState(""),A=u[0],d=u[1];return(null==r?void 0:r.status)!==c&&(d(An(n,t)),s(null==r?void 0:r.status)),o.a.useEffect((function(){d(An(n,t));var e=setInterval((function(){return d(An(n,t))}),1e3);return function(){return clearInterval(e)}}),[e]),o.a.createElement(o.a.Fragment,null,A)};function An(e,t){var n=e.current;if(!n)return"";var a=n.peer;return Q(a)?pn(n)||dn(t):function(e,t){if(e.hangupType)switch(e.hangupType){case c.HANGUP_TYPE_BUSY:return t("calls_busy");case c.HANGUP_TYPE_CALLEE_IS_OFFLINE:return t("calls_callee_is_offline");case c.HANGUP_TYPE_REJECTED:return t("calls_rejected_status");case c.HANGUP_TYPE_CANCELED:case c.HANGUP_TYPE_MISSED:case c.HANGUP_TYPE_HUNGUP:case c.HANGUP_TYPE_REMOVED:return null;case c.HANGUP_TYPE_CALLER_IS_BLOCKED:case c.HANGUP_TYPE_EXTERNAL_API_ERROR:case c.HANGUP_TYPE_FAILED:case c.HANGUP_TYPE_NOT_FRIENDS:case c.HANGUP_TYPE_OLD_VERSION:case c.HANGUP_TYPE_SERVICE_DISABLED:case c.HANGUP_TYPE_UNKNOWN_ERROR:case c.HANGUP_TYPE_UNSUPPORTED:return t("calls_error")}return null}(n,t)||function(e,t){var n=e.participants[t];return n&&n.status!==c.CallStatus.CONNECTED?o.a.createElement(cn,{participant:n}):null}(n,a)||pn(n)||dn(t)}function dn(e){return o.a.createElement(ln,null,e("calls_status_waiting"))}function pn(e){var t=e.callData.ts;return t?o.a.createElement(sn,{duration:Ee(t)}):null}var mn=function(){return(mn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},fn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},_n=function(e){var t=fn(e,[]);return o.a.createElement("svg",mn({width:"28px",height:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 28 10"},t),o.a.createElement("path",{fill:"#F2F3F5",fillRule:"evenodd",d:"M1 0a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2H2V1a1 1 0 00-1-1zm7 1a1 1 0 112 0v8a1 1 0 11-2 0V1zm15-1a1 1 0 00-1 1v8a1 1 0 001 1h4a1 1 0 100-2h-3V6h3a1 1 0 100-2h-3V2h3a1 1 0 100-2h-4zm-8.325 9.31l-2.55-7.824a.993.993 0 01-.117-.363L12 1.1h.005A1 1 0 1113.995.9L14 .9l2 6.4 2-6.4h.005a1 1 0 011.99.2H20l-.008.023a.993.993 0 01-.118.363l-2.55 7.824a1 1 0 01-.95.69h-.748a1 1 0 01-.95-.69z",clipRule:"evenodd"}))},En=function(){return(En=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},hn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},vn=function(e){var t=hn(e,[]);return o.a.createElement("svg",En({width:"10px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 10 11"},t),o.a.createElement("path",{fill:"#F5F5F5",d:"M.5 2.5A.5.5 0 011 3v2.5a.5.5 0 001 0v-4a.5.5 0 011 0V5a.5.5 0 001 0V1a.5.5 0 011 0v4.063a.5.5 0 001 0V1.938a.5.5 0 011 0V7.5l-.28-.032L8.494 5.57a.67.67 0 01.995.9 232.32 232.32 0 00-2.615 3.029C5.935 10.624 4.56 11 3.526 11 .15 11 0 8.727 0 7.958V3a.5.5 0 01.5-.5z"}))},gn=function(e){var t=e.isGroupCall,n=e.handsCount,a=void 0===n?0:n,i=e.isTranslationOn,l=void 0!==i&&i,c=e.hasTranslationPermission,u=void 0!==c&&c,A=e.translationHost,d=e.onStopTranslation,p=e.onShareTranslation,m=e.callStatus,f=e.participantCount,_=e.speakers,E=Object(r.useContext)(j).getLang,h=Object(s.classNames)("CallInfo",{"CallInfo--full":t}),v=Object(s.classNames)("CallInfo__hands",{"CallInfo__hands--visible":a>0});return o.a.createElement("div",{className:h},o.a.createElement("div",{className:"CallInfo__status"},o.a.createElement("div",{className:"CallInfo__statusMain"},m,t&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"CallInfo__dot"}," · "),E("calls_participants_plural",f))),o.a.createElement("div",{className:v},o.a.createElement(vn,null)," ",a),l&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"CallInfo__pipe",key:"pipe"}),o.a.createElement("div",{className:"CallInfo__translation",key:"translation"},o.a.createElement(_n,{className:"CallInfo__translationIndicator"}),u&&o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{className:"CallInfo__translationButton",key:"stop",onClick:d},E("calls_translation_stop")),p&&o.a.createElement("button",{className:"CallInfo__translationButton",key:"share",onClick:p},E("calls_info_translation_share"))),!u&&o.a.createElement("div",{className:"CallInfo__translationInfo"},A?E("calls_translation_host_info").replace("{name}",A):E("calls_translation_host_info_unknown"))))),t&&_&&o.a.createElement("div",{className:"CallInfo__speakers"},_))};function On(){var e=Object(l.useSelector)((function(e){return e})),t=Object(l.useDispatch)(),n=Q(e.peer),a=Object(r.useContext)(j),i=a.getLang,s=a.langNumeric,u=Object(r.useState)(0),A=u[0],d=u[1],p=Object(r.useState)(null),m=p[0],f=p[1],_=Object(r.useState)(0),E=_[0],h=_[1],v=Object(r.useState)(null),g=v[0],O=v[1],C=Object(r.useState)(!1),b=C[0],y=C[1],S=Object(r.useCallback)((function(){t({type:c.TOGGLE_POPUP,data:c.POPUP_TRANSLATION_STOP})}),[]),N=Object(r.useCallback)((function(){t({type:c.TOGGLE_POPUP,data:c.POPUP_TRANSLATION_SHARE})}),[]);return Object(r.useEffect)((function(){var t;(null===(t=e.translation.host)||void 0===t?void 0:t.id)?y(+e.translation.host.id===e.me):b&&y(!1)}),[e.translation,e.translationEnabled]),Object(r.useEffect)((function(){var t,n;if(null===(t=e.translation.host)||void 0===t?void 0:t.id){var a=e.participants[null===(n=e.translation.host)||void 0===n?void 0:n.id],r=(null==a?void 0:a.shortName)||(null==a?void 0:a.name);r!==g&&O(r)}else g&&O(null)}),[e.translation,e.translationEnabled]),Object(r.useEffect)((function(){var t=function(e){var t,n,a=e.participants,r=0;for(var o in a)a.hasOwnProperty(o)&&Xt(e,a[o])&&(null===(n=null===(t=a[o])||void 0===t?void 0:t.statusData)||void 0===n?void 0:n.hand)&&r++;return r}(e);t!==E&&h(t)}),[e.participants]),Object(r.useEffect)((function(){d(Kt(e))}),[e]),Object(r.useEffect)((function(){if(n){var t=e.speakersInHeader.reduce((function(t,n){return e.participants[n]&&(e.participants[n].shortName||e.participants[n].name)&&t.push(e.participants[n]),t}),[]);f(t.length>0?i("calls_participants_speak",t.length).replace("{names}",Oe(t,t.slice(0,3),(function(e){return e.shortName||e.name}),i,s)):null)}}),[e.participants,e.speakersInHeader]),o.a.createElement(gn,{isGroupCall:n,handsCount:E,isTranslationOn:!!e.translationEnabled&&e.translation.isOn,hasTranslationPermission:!!e.translationEnabled&&b,translationHost:e.translationEnabled?g:null,onStopTranslation:S,onShareTranslation:N,callStatus:o.a.createElement(un,null),participantCount:A,speakers:m})}var Cn=function(){return(Cn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},bn={acc:{},timer:0,tasks:0};function yn(e,t,n,a){In(t,n,(function(t){e({type:c.UPDATE_PARTICIPANTS_BATCH,data:t})}),a,bn)}var Sn={acc:{},timer:0,tasks:0};function Nn(e,t,n,a){In(t,n,(function(t){e({type:c.SET_VISIBLE_PARTICIPANTS,data:t})}),a,Sn)}function In(e,t,n,a,r){var o;void 0===a&&(a=30),r.timer?(r.acc[e]=r.acc[e]&&"object"==typeof r.acc[e]?Object.assign(r.acc[e],t):t,r.tasks++):function e(t){n(t),r.timer=window.setTimeout((function(){r.tasks>0&&(e(r.acc),r.acc={},r.tasks=0),clearTimeout(r.timer),r.timer=0}),a)}(((o={})[e]=t,o))}var Fn=function(){return(Fn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function Tn(e){var t,n,a,i,s,u,A,d,p=e.SDK,m=e.navigateToConvo,f=e.navigateToProfile,_=Object(l.useSelector)((function(e){return e})),E=Object(l.useDispatch)(),h=Object(r.useContext)(j).getLang,v=_.peer,g=Q(v),O=g?_.callData.conversation:_.participants[v],C=_.participants[_.me],b=C.mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},y=C.permissions,S=Yt(_),N=S.length>1,I=N||b.isVideoEnabled,F=function(e){return Zt(e).filter((function(e){return!Ht(e.peerId)})).length}(_),T=g&&($t(C)||en(C))&&F>1&&1===function(e){return Zt(e).filter((function(e){return $t(e)||en(e)})).length}(_),w=g||S.length>2,D=w&&I&&!_.isOratorMode,L=w&&I&&_.isOratorMode,M=null!==_.adminPinnedParticipant,R=!M&&null!==_.pinnedParticipant,k=_.uiMode===c.UIMode.FULLSCREEN,B=Object(r.useMemo)((function(){return p.browser.isScreenCapturingSupported()}),[]),U=null===(t=_.callData)||void 0===t?void 0:t.canFinishCall,G=function(e){return E({type:c.CHANGE_UI_MODE,mode:e})},H=Object(r.useCallback)((function(){_.uiMode===c.UIMode.FULLSCREEN?(q(.3,null).then((function(){G(c.UIMode.COLLAPSED)})),G(c.UIMode.DEFAULT)):G(c.UIMode.COLLAPSED)}),[_.uiMode]),V=Object(r.useCallback)((function(){E({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!_.isOratorMode})}),[_.isOratorMode]),W=Object(r.useCallback)((function(){E({type:c.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!_.isShownParticipantsAside})}),[_.isShownParticipantsAside]),Y=Object(r.useCallback)((function(e,t){E({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:_.pinnedParticipant===t?null:t})}),[_.pinnedParticipant]),Z=Object(r.useCallback)((function(e,t){_.isOratorMode||E({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0}),_.pinnedParticipant!==t&&E({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}),[_.isOratorMode,_.pinnedParticipant]),X=Object(r.useCallback)((function(){E({type:c.MANAGEMENT,isOpen:!0})}),[]),J=Object(r.useCallback)((function(){var e=!b.isVideoEnabled||b.isScreenSharingEnabled;(e?z(p,!0,!1):Promise.resolve()).then((function(){b.isScreenSharingEnabled&&p.captureScreen(!1),p.toggleLocalVideo(e)})),K.logEvent({call_event_type:e?c.CallActionEventType.VIDEO_ENABLED:c.CallActionEventType.VIDEO_DISABLED,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer),reason:e?void 0:"manual"})}),[b]),$=Object(r.useCallback)((function(){p.captureScreen(!b.isScreenSharingEnabled),K.logEvent({call_event_type:b.isScreenSharingEnabled?c.CallActionEventType.SCREEN_SHARING_STOPPED:c.CallActionEventType.SCREEN_SHARING_STARTED,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer)})}),[b.isScreenSharingEnabled,_.screenSharers]),ee=Object(r.useCallback)((function(){H(),m(_.peer)}),[_.peer,_.uiMode]),te=Object(r.useCallback)((function(){var e,t,n=!(null===(e=C.statusData)||void 0===e?void 0:e.hand);p.changeParticipantState({hand:n?c.SdkHandType.RAISED:c.SdkHandType.LOWERED}),E({type:c.CHANGE_PARTICIPANT_STATE,participantId:C.peerId,data:Fn(Fn({},C.statusData),{hand:!(null===(t=C.statusData)||void 0===t?void 0:t.hand)})}),K.logEvent({call_event_type:n?c.CallActionEventType.HAND_RAISED:c.CallActionEventType.HAND_LOWERED,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer)})}),[null===(n=C.statusData)||void 0===n?void 0:n.hand]),ne=Object(r.useCallback)((function(){E({type:c.TOGGLE_POPUP,data:c.POPUP_EXIT})}),[]),ae=o.a.useCallback((function(){E({type:c.TOGGLE_POPUP,data:c.POPUP_TRANSFER_ADMIN_RIGHTS})}),[]),re=function(){p.hangup(),K.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer),reason:"none",group_call_users_count:Kt(_)})},oe=Object(r.useCallback)((function(){E({type:c.CHANGE_UI_MODE,mode:k?c.UIMode.DEFAULT:c.UIMode.FULLSCREEN}),E({type:c.SET_TOOLTIP,tooltips:null})}),[_.uiMode]),ie=Object(r.useCallback)((function(e,t){var n;E({type:c.SET_TOOLTIP,tooltips:(n={},n[e]=t,n)})}),[]),le=Object(r.useCallback)((function(){E({type:c.SET_TOOLTIP,tooltips:null})}),[]),ce=Object(r.useCallback)((function(e){Nn(E,e,!1,1e3)}),[]),se=Object(r.useCallback)((function(e){Nn(E,e,!0,1e3)}),[]),ue=[{text:h("calls_call_menu_settings"),key:"settings",onClick:function(){z(p,!0,!0).then((function(){E({type:c.TOGGLE_POPUP,data:c.POPUP_SETTINGS})}))},disabled:!1}];_.translationEnabled&&!Ht(_.me)&&ue.push({text:h("calls_call_menu_translation"),key:"translation",onClick:function(){E({type:c.TOGGLE_POPUP,data:c.POPUP_TRANSLATION})},disabled:!(!(null===(a=_.translation)||void 0===a?void 0:a.isOn)||!(null===(s=null===(i=_.translation)||void 0===i?void 0:i.host)||void 0===s?void 0:s.id))&&+(null===(A=null===(u=_.translation)||void 0===u?void 0:u.host)||void 0===A?void 0:A.id)!==_.me}),Object(r.useEffect)((function(){return function(){E({type:c.SET_TOOLTIP,tooltips:null})}}),[]);var Ae=Object(r.useCallback)((function(){M&&qt(C)?(p.pinParticipant(_.adminPinnedParticipant,!0).then((function(){E({type:c.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.ADMIN_UNPIN,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer)})):E({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:null})}),[M,qt(C)]);return tn(C)&&(_.callsAdminMode&&g&&ue.push({text:o.a.createElement(Ne.default,null,h("calls_call_menu_mute_audio_video_all")),key:"muteAll",onClick:function(){E({type:c.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:c.ParticipantsManagementMode.ALL}})}}),!_.callsAdminMode&&N&&ue.push({text:o.a.createElement(Ne.default,null,h("calls_call_menu_mute_all")),key:"muteAll",onClick:function(){p.muteParticipant(),K.logEvent({call_event_type:c.CallActionEventType.ALL_MICS_DISABLED,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer)})}})),_.callsAdminMode&&tn(C)&&g&&N&&ue.push({text:o.a.createElement(Ne.default,null,h("calls_call_menu_enable_media_request")),key:"unmuteRequest",onClick:function(){p.unmuteRequest(void 0,[c.MediaOption.AUDIO,c.MediaOption.VIDEO]).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.ASK_ALL_TO_UNMUTE,session_id:_.callData.callId,peer_id:_.peer,is_group_call:Q(_.peer)})}}),o.a.createElement(x,{onClose:T?ae:re,isCautionBoxShown:!T,onBackdropClick:H},o.a.createElement(Pt,{id:v,photo:O&&O.photo||"",disablePhoto:I,info:o.a.createElement(On,null),callMenuActions:ue,isVideoAllowed:y.video>0,isAudioAllowed:y.audio>0,isVideoEnabled:b.isVideoEnabled&&!b.isScreenSharingEnabled,isAudioEnabled:b.isAudioEnabled,isScreenSharingEnabled:b.isScreenSharingEnabled,isOratorMode:_.isOratorMode,isFullScreen:k,onToggleVideo:J,onToggleAudio:function(){var e=!b.isAudioEnabled;(e?z(p,!1,!0):Promise.resolve()).then((function(){var t;(null===(t=_.notification)||void 0===t?void 0:t.type)===c.NotificationType.SPEAKING_ON_MUTE&&E({type:c.CALL_NOTIFICATION,notification:null}),p.toggleLocalAudio(e)}))},onToggleScreenShare:$,onLeaveCall:T?ae:U?ne:re,onCollapseCall:H,onToggleOratorMode:V,onFullScreenToggle:oe,onTooltipChange:ie,onHidePanel:le,onChat:ee,onHandClick:te,isParticipantControlActive:_.isManagementOpen,isLayoutSwitchShown:g&&N,isHandRaised:null===(d=C.statusData)||void 0===d?void 0:d.hand,isHandControlShown:g,isChatControlShown:!!v,isScreenShareControlShown:y.screenSharing>0&&B,onParticipantsClick:X,chatUnreadCount:_.chatUnreadCount,notification:o.a.createElement(Gt,null),tooltips:_.tooltips,amISpeaking:!!_.speakers[_.me]},!w&&o.a.createElement(Qe,Fn({},function(e,t,n,a){var r,o,i=e[t],l=e[n],c=i.mediaSettings,s=l.mediaSettings;return{hasAudio:!!(null==c?void 0:c.isAudioEnabled),hasVideo:!!(null==c?void 0:c.isVideoEnabled),isSharingScreen:!!(null==c?void 0:c.isScreenSharingEnabled),stream:i.stream,id:t,name:a("calls_own_label"),letter:null===(r=i.name)||void 0===r?void 0:r.slice(0,1),wasConnected:!!i.wasConnected,opponentHasAudio:!!(null==s?void 0:s.isAudioEnabled),opponentHasVideo:!!(null==s?void 0:s.isVideoEnabled),opponentIsSharingScreen:!!(null==s?void 0:s.isScreenSharingEnabled),opponentStream:l.stream,opponentPhoto:l.photo,opponentId:n,opponentName:l.name||n.toString(),opponentLetter:null===(o=l.name)||void 0===o?void 0:o.slice(0,1),opponentWasConnected:!!l.wasConnected}}(_.participants,_.me,_.peer,h))),D&&o.a.createElement(wt,{limit:_.participantLimit},S.map((function(e,t,n){var a,r,i=e.mediaSettings||{},l=i.isVideoEnabled,c=i.isAudioEnabled,s=i.isScreenSharingEnabled,u=e.peerId===_.me?h("calls_own_label"):e.shortName?e.shortName:e.name;return o.a.createElement(Ve,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:e.peerId===_.me,isHandRaised:null===(a=e.statusData)||void 0===a?void 0:a.hand,hasVideo:!!l,hasAudio:!!c,isSharingScreen:!!s,isSpeaking:!!_.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:n.length<=8||k?"s":"xs",name:u,letter:null===(r=e.name)||void 0===r?void 0:r.slice(0,1),status:e.status,wasConnected:e.wasConnected,onDblClickParticipant:Z,onShow:se,onHide:ce,actions:Qt(_,p,E,e,!0,h,m,f)})}))),L&&o.a.createElement(Rt,{orator:Pn(_,h),onToggleParticipantsAside:W,isShownParticipantsAside:_.isShownParticipantsAside,isPinned:R,isPinnedByAdmin:M,isUnpinAllowed:qt(C)||!M,onUnpin:Ae,tooltips:_.tooltips,onTooltipChange:ie},S.map((function(e){var t,n,a=e.mediaSettings||{},r=a.isVideoEnabled,i=a.isAudioEnabled,l=a.isScreenSharingEnabled,c=e.peerId===_.me,s=c?h("calls_own_label"):e.shortName?e.shortName:e.name;return o.a.createElement(Ve,{id:e.peerId,key:e.peerId,isInfoShown:!0,isMe:c,isPinned:e.peerId===_.pinnedParticipant,isPinnedByAdmin:e.peerId===_.adminPinnedParticipant,isHandRaised:null===(t=e.statusData)||void 0===t?void 0:t.hand,hasVideo:!!r,hasAudio:!!i,isSharingScreen:!!l,isSpeaking:!!_.speakers[e.peerId],stream:e.stream,photo:e.photo,photoSize:"xxs",name:s,letter:null===(n=e.name)||void 0===n?void 0:n.slice(0,1),status:e.status,wasConnected:e.wasConnected,onClickParticipant:Y,onShow:se,onHide:ce,actions:Qt(_,p,E,e,!0,h,m,f)})}))),w&&!I&&o.a.createElement(Ie.default,null,o.a.createElement(P,{id:v,photo:O&&O.photo||"",size:"l",waves:!0,alt:O&&O.tab||""}))))}function Pn(e,t){var n,a=e.participants[e.adminPinnedParticipant||e.pinnedParticipant||e.orator||e.me],r=a.mediaSettings||{},i=r.isVideoEnabled,l=r.isAudioEnabled,c=r.isScreenSharingEnabled,s=a.peerId===e.me;return o.a.createElement(Ve,{id:a.peerId,key:a.peerId,isOrator:!0,isInfoShown:!0,isMe:s,hasVideo:!!i,hasAudio:!!l,isSharingScreen:!!c,stream:a.stream,photo:a.photo,photoSize:"l",name:s?t("calls_own_label"):a.name,letter:null===(n=a.name)||void 0===n?void 0:n.slice(0,1),status:a.status,wasConnected:a.wasConnected,allowContain:!0})}var wn=function(e){var t=e.children;return o.a.createElement("div",{className:"CollapsedCall"},t)},Dn=function(e){var t=e.id,n=e.photo,a=e.title,r=e.status,i=e.isIncoming,l=e.onClick,c=e.children;return o.a.createElement("div",{className:"CallWidget",onClick:l},o.a.createElement(y,{id:t,photo:n,className:"CallWidget__background"}),o.a.createElement(P,{id:t,photo:n,size:"xs",waves:i,alt:a||""}),o.a.createElement("h1",{className:"CallWidget__name"},a),o.a.createElement("div",{className:"CallWidget__status"},r),c)},Ln=function(e){var t=e.localVideoStream,n=e.isLocalAudioEnabled,a=e.isLocalScreenSharing,i=e.participantId,l=e.isMe,c=e.isWithVideo,s=e.isWithAudio,u=e.isScreenSharing,A=e.stream,d=e.photo,p=e.name,m=e.onRestoreCall,f=e.onToggleAudio,_=e.children,E=o.a.useContext(j).getLang,h=Object(r.useState)(!1),v=h[0],g=h[1];Object(r.useEffect)((function(){t||g(!1)}),[t,v]);var O=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),m()}),[m]),C=Object(r.useCallback)((function(e){e.preventDefault(),e.stopPropagation(),f()}),[f]);return o.a.createElement("div",{className:"CallVideoWidget",onClick:m},t&&o.a.createElement(Se,{stream:t,hasVideo:!0,isMe:!0,isVideoVisible:v,isScreenShareStream:a,setVideoVisibility:g,className:"CallVideoWidget__local",allowContain:!0}),o.a.createElement(Ve,{id:i,hasVideo:c,hasAudio:s,isSharingScreen:u,isMe:l,stream:A,photo:d,name:p,photoSize:"s"}),_,o.a.createElement(Ye,{alignX:"l",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},o.a.createElement(R.default,{position:"t",align:"left",marginTop:6,text:E(n?"calls_mute":"calls_unmute")},o.a.createElement(M,{type:n?"mute":"unmute",onClick:C}))),o.a.createElement(Ye,{alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons"},o.a.createElement(R.default,{position:"t",align:"right",text:E("calls_restore"),marginTop:6},o.a.createElement(M,{type:"restore",onClick:O}))))},Mn=function(){return(Mn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Rn=function(e){var t,n,a,i=e.SDK,s=Object(l.useSelector)((function(e){return e})),u=Object(l.useDispatch)(),A=o.a.useContext(j).getLang,d=s.peer,p=_e(s),m=Q(d)?s.callData.conversation:s.participants[d],f=s.participants[s.me],_=zt(s,p),E=(null===(t=f.mediaSettings)||void 0===t?void 0:t.isVideoEnabled)&&_&&_.peerId!==s.me,h=Object(r.useCallback)((function(){u({type:c.CHANGE_UI_MODE,mode:c.UIMode.DEFAULT})}),[]),v=Object(r.useCallback)((function(){var e;i.toggleLocalAudio(!(null===(e=f.mediaSettings)||void 0===e?void 0:e.isAudioEnabled))}),[s]);return o.a.createElement(wn,null,s.mode===c.Mode.INCOMING&&o.a.createElement(Dn,{id:d,title:(null==m?void 0:m.tab)||"",photo:(null==m?void 0:m.photo)||"",status:A("calls_incoming_collapsed"),isIncoming:!0,onClick:h}),s.mode===c.Mode.CALL&&!p&&o.a.createElement(Dn,{id:(_?_.peerId:null==m?void 0:m.peerId)||0,title:(null==m?void 0:m.tab)||"",photo:(_?_.photo:null==m?void 0:m.photo)||"",status:o.a.createElement(un,null),onClick:h}),s.mode===c.Mode.CALL&&p&&o.a.createElement(Ln,Mn({localVideoStream:E?f.stream:void 0,isLocalAudioEnabled:!!(null===(n=f.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),isLocalScreenSharing:!!(null===(a=f.mediaSettings)||void 0===a?void 0:a.isScreenSharingEnabled)},function(e,t,n){var a,r,o;return e?{participantId:e.peerId,isMe:e.peerId===n,isWithVideo:!!(null===(a=e.mediaSettings)||void 0===a?void 0:a.isVideoEnabled),isWithAudio:!!(null===(r=e.mediaSettings)||void 0===r?void 0:r.isAudioEnabled),isScreenSharing:!!(null===(o=e.mediaSettings)||void 0===o?void 0:o.isScreenSharingEnabled),stream:e.stream,photo:e.photo,name:e.name}:{participantId:t&&t.peerId||0,isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,stream:void 0,photo:t&&t.photo||"",name:t&&t.tab||""}}(_,m,s.me),{onRestoreCall:h,onToggleAudio:v})))};var jn=function(){return(jn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function kn(e){var t,n=e.onBeforeCallStart,a=e.onAfterCallFinish,i=e.callSounds,s=Object(l.useSelector)((function(e){return e})),u=Object(r.useRef)(),A=((t={}).incoming=Object(r.useRef)(null),t.outgoing=Object(r.useRef)(null),t.connecting=Object(r.useRef)(null),t.connected=Object(r.useRef)(null),t.end=Object(r.useRef)(null),t),d={controls:!1,preload:"auto"},p=Object(r.useCallback)((function(e){var t=A[e].current;t&&t.paused&&t.play().catch((function(){}))}),[]),m=Object(r.useCallback)((function(e){var t=A[e].current;t&&!t.paused&&(t.pause(),t.currentTime=0)}),[]),f=Object(r.useCallback)((function(){Object.keys(A).forEach(m)}),[]),_=Object(r.useCallback)((function(e){var t=A[e].current;if(t){var n=t.volume;t.volume=0,t.play().catch((function(){})),t.pause(),t.currentTime=0,t.volume=n}}),[]),E=Object(r.useCallback)((function(){n&&n()}),[n]),h=Object(r.useCallback)((function(){a&&a()}),[a]);return Object(r.useEffect)((function(){return ee.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(A).forEach(_),document.body.removeEventListener("mousedown",e)})),function(){f(),h()}}),[]),Object(r.useEffect)((function(){var e,t,n=u.current||s,a=s;n.mode!==a.mode&&(n.mode!==c.Mode.READY||a.mode!==c.Mode.INCOMING&&a.mode!==c.Mode.CALL||E(),n.mode===c.Mode.INCOMING&&m("incoming"),a.mode===c.Mode.INCOMING&&p("incoming"),a.mode!==c.Mode.READY||n.mode!==c.Mode.INCOMING&&n.mode!==c.Mode.CALL||(f(),p("end"),h()));var r=a.me,o=n.participants,i=a.participants,l=null===(e=o[r])||void 0===e?void 0:e.status,A=null===(t=i[r])||void 0===t?void 0:t.status;l!==A&&(l===c.CallStatus.CONNECTING&&m("connecting"),A===c.CallStatus.CONNECTING&&p("connecting"));var d=Object.keys(i).some((function(e){return o[e]&&o[e].status===c.CallStatus.CONNECTED})),_=Object.keys(i).some((function(e){var t=o[e],n=i[e];return t&&t.status!==n.status&&n.status===c.CallStatus.CONNECTED}));!d&&_&&p("connected"),a.mode===c.Mode.CALL&&(!function(e,t,n,a){for(var r=!1,o=0,i=Object.values(e);o<i.length;o++){var l=i[o];if(l.peerId!==t){if(l.status===c.CallStatus.CONNECTED)return!1;l.status===c.CallStatus.WAITING&&(!a||n.has(l.peerId))&&(r=!0)}}return r}(i,r,a.participantsAddedByMe,Q(s.peer))?m("outgoing"):p("outgoing")),u.current=s}),[s]),o.a.createElement(o.a.Fragment,null,o.a.createElement("audio",jn({src:i.incoming,ref:A.incoming,loop:!0},d)),o.a.createElement("audio",jn({src:i.outgoing,ref:A.outgoing,loop:!0},d)),o.a.createElement("audio",jn({src:i.connected,ref:A.connected,loop:!1},d)),o.a.createElement("audio",jn({src:i.connecting,ref:A.connecting,loop:!0},d)),o.a.createElement("audio",jn({src:i.end,ref:A.end,loop:!1},d)))}var Bn=n("BiHW"),Un=n("euvX"),Gn=n("5PZO"),xn=function(e){var t=e.title,n=e.onCloseModal,a=e.hint,r=e.actionButtons,i=e.isWithBackButton,l=e.onBackClick,c=e.children,s=o.a.useContext(j).getLang;return o.a.createElement(B.default,{className:"CallManagementModal",disableBodyScroll:!1,onClose:n},o.a.createElement(Un.ModalHeader,{title:t,onClose:n,appearance:"blue",backText:i?s("calls_back"):void 0,onBack:l}),o.a.createElement("div",{className:"CallManagementModal__content"},o.a.Children.toArray(c).map((function(e,t){return o.a.createElement("div",{className:"CallManagementModal__section",key:t},e)}))),(r||a)&&o.a.createElement(Gn.ModalFooter,{actionButtons:r||[],hint:a}))},Hn=n("F0+T"),Vn=function(e){var t=e.tokens,n=e.onRemoveToken,a=e.value,r=e.onChange,i=e.onSelect,l=e.renderSuggest,c=e.data,s=o.a.useContext(j).getLang;return o.a.createElement(Hn.default,{className:"CallsMultiSelect",tokens:t,removeTokenPlaceholder:s("calls_remove_token"),onRemoveToken:n,placeholder:s("calls_search_participants_placeholder"),value:a,onChange:r,onSelect:i,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:function(){},notFoundText:s("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:l,data:c})},Qn=function(e){var t=e.headingElement,n=void 0===t?"h3":t,a=e.extra,r=e.className,i=e.children,l=n;return o.a.createElement("header",{className:Object(s.classNames)("ListHeader",r)},o.a.createElement(l,{className:"ListHeader__text"},i),o.a.createElement("span",{className:"ListHeader__extra"},a))},Wn=n("5R8M"),zn=n("Hri0");function Yn(e){var t=e.member,n=e.selected,a=e.disabled,o=Object(s.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":n,"ParticipantSuggest--disabled":a});return r.createElement("div",{className:o,"data-id":t.id},r.createElement(zn.default,{size:"34",title:t.name,photo:t.photo}))}Yn.defaultProps={selected:!1,disabled:!1};var Kn=function(){return(Kn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Zn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Xn=function(e){var t=e.children,n=e.className,a=Zn(e,["children","className"]);return o.a.createElement("button",Kn({className:Object(s.classNames)("ListMore",n)},a),t)},Jn=function(){return(Jn=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},qn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},$n=function(e){var t=qn(e,[]);return o.a.createElement("svg",Jn({width:"16",height:"16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M9.3 9.99c.93-.93 2.32-.75 3.63.35.94.79.82 2.85-1.18 3.12s-4.11-.7-6.32-2.9c-2.2-2.2-3.1-4.1-2.9-6.3a1.8 1.8 0 013.12-1.18c1.06 1.25 1.38 2.6.36 3.62-.48.48-.67.6-.56.91.41 1.1 2.19 2.65 2.94 2.93.35.13.46-.1.9-.55z"}))},ea=function(e){var t=e.data,n=e.onClick,a=e.selected,r=e.disabled;if("type"in t)switch(t.type){case c.SearchResultType.HEADER:return o.a.createElement(Qn,{className:"CallsSearchResult CallsSearchResult--header",extra:t.count},t.text);case c.SearchResultType.CALL_ALL_IN_CHAT:return o.a.createElement("div",{className:"CallsSearchResult CallsSearchResult--select"},o.a.createElement(Bn.default,{appearance:"secondary",wide:!0,onClick:n},o.a.createElement("span",{className:"CallsSearchResult__icon"},o.a.createElement($n,null)),t.text));case c.SearchResultType.MEMBERS_MORE:case c.SearchResultType.FRIENDS_MORE:return o.a.createElement(Xn,{onClick:n},t.text)}return o.a.createElement(Wn.default,{"data-id":t.peerId,onClick:n,selectable:!r},o.a.createElement(Yn,{member:t,selected:a,disabled:r}))},ta=function(){return(ta=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},na=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a},aa=function(e){return ne(e.replace(/\t/g,"\n"))},ra=function(e){var t=e.onChange,n=e.onClickCallAll,a=Object(l.useSelector)((function(e){return e})),i=o.a.useContext(j).getLang,s=Object(r.useState)(""),u=s[0],A=s[1],d=Object(r.useState)({}),p=d[0],m=d[1],f=Object(r.useState)(!1),_=f[0],E=f[1],h=Object(r.useState)(!1),v=h[0],g=h[1],O=Object(r.useState)(function(e,t){var n=e.reduce((function(e,t){return e[t.id]=!0,e}),{});return t.filter((function(e){return!n[e.id]}))}(a.chatMembers,a.friends))[0],C=Object(r.useState)(function(e,t){return[].concat(t,e).reduce((function(e,t){return e[t.id]=t,e}),{})}(a.chatMembers,O))[0],b=(a.preselectedIds||[]).filter((function(e){return!Ht(e)&&C[e]})),y=Object(r.useState)(b),S=y[0],N=y[1],I=Object(r.useCallback)((function(e){return e.name}),[]),F=Object(r.useCallback)((function(e){return e.peerId}),[]),T=G(na(a.chatMembers,O),I,F),P=Object(r.useCallback)((function(e){return e?T.search(e):function(e,t,n,a,r,o){var i={type:c.SearchResultType.MEMBERS_MORE,text:o("calls_show_all_members")},l={type:c.SearchResultType.FRIENDS_MORE,text:o("calls_show_all_friends")},s={type:c.SearchResultType.HEADER,text:o("calls_chat_members"),count:e.length},u={type:c.SearchResultType.HEADER,text:o("calls_friends")},A={type:c.SearchResultType.CALL_ALL_IN_CHAT,text:o("calls_call_all")},d=[];if(e.length>0)if(d.push(s),e.length<=r&&d.push(A),n||e.length<=5)d.push.apply(d,e);else{for(var p=0;p<5;p++)d.push(e[p]);d.push(i)}if(d.push(u),a||t.length<=10)d.push.apply(d,t);else{for(p=0;p<10;p++)d.push(t[p]);d.push(l)}return d}(a.chatMembers,O,_,v,a.participantLimit,i)}),[a,_,v]),w=Object(r.useState)(P(u)),D=w[0],L=w[1],M=function(e){N(e),t(e)},R=Object(r.useCallback)((function(e){return M(na(S,[+e]))}),[S]),k=Object(r.useCallback)((function(e){return M(S.filter((function(t){return t!==+e})))}),[S]),B=Yt(a).map((function(e){return{id:e.peerId.toString(),text:aa(e.name),locked:!0}})).concat(S.map((function(e){return{text:aa(C[e].name),id:e.toString(),locked:!1}})));Object(r.useEffect)((function(){m(S.reduce((function(e,t){return e[t]=!0,e}),{}))}),[]),Object(r.useEffect)((function(){L(P(u))}),[S,_,v]);var U=Object(r.useCallback)((function(e){A(e.target.value),L(P(e.target.value))}),[]),x=Object(r.useCallback)((function(e){var t;return k(e),m(ta(ta({},p),((t={})[e]=!1,t))),Promise.resolve()}),[p]),H=Object(r.useCallback)((function(e){var t,n;return oa(e,a,p)?(k(e),m(ta(ta({},p),((t={})[e]=!1,t)))):ia(e,a,B,p)||(R(e),m(ta(ta({},p),((n={})[e]=!0,n))),A(""),L(P(""))),Promise.resolve()}),[S,a,p]),V=Object(r.useCallback)((function(){var e=Yt(a).reduce((function(e,t){return e[t.peerId]=!0,e}),{}),t=a.chatMembers.reduce((function(t,n){var r=n.peerId;return e[r]||ia(r||0,a,B,p)||t.push(r),t}),[]);n(t)}),[a,S,p]),Q=Object(r.useCallback)((function(e,t){if(!("type"in e))return t;switch(e.type){case c.SearchResultType.CALL_ALL_IN_CHAT:return function(){return V()};case c.SearchResultType.MEMBERS_MORE:return function(){return E(!0)};case c.SearchResultType.FRIENDS_MORE:return function(){return g(!0)};default:return function(){}}}),[V]);return o.a.createElement(Vn,{tokens:B,onRemoveToken:x,value:u,onChange:U,onSelect:H,renderSuggest:function(e,t){return o.a.createElement(ea,{data:e,onClick:Q(e,t),selected:oa("peerId"in e&&e.peerId||0,a,p),disabled:ia("peerId"in e&&e.peerId||0,a,B,p),key:"peerId"in e&&e.peerId||"text"in e&&e.text||void 0})},data:D})};function oa(e,t,n){return n&&n[e]||Wt(t,e)}function ia(e,t,n,a){return!!Wt(t,e)||!oa(e,t,a)&&(n.length>=t.participantLimit||!H(e))}var la=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a},ca=function(e){var t=e.SDK,n=e.isWithBackButton,a=e.onBackClick,i=Object(l.useSelector)((function(e){return e})),s=Object(l.useDispatch)(),u=o.a.useContext(j).getLang,A=Object(r.useState)(i.preselectedIds||[]),d=A[0],p=A[1],m=Object(r.useState)(Kt(i))[0]+d.length,f=function(){s({type:c.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),s({type:c.MANAGEMENT,isOpen:!1})},_=0===d.length,E=function(e){f(),s({type:c.MANUAL_ADD_PARTICIPANTS,participants:e}),e.forEach(t.addParticipant);var n=Ae(function(e,t){var n=e.chatData||e.callData.conversation,a=t.reduce((function(t,n){return e.participants[n]||t.set(n,!0),t}),new Map);if(0===a.size)return[n,[]];var r=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,o=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,i=r.reduce((function(e,t){return a.get(t.id)&&(e.smallerListData.push(t),e.smallerListMap.set(t.id,!0)),e}),{smallerListData:[],smallerListMap:new Map}),l=i.smallerListData,c=i.smallerListMap;if(l.length===a.size)return[n,l];var s=o.filter((function(e){return!c.get(e.id)&&a.get(e.id)}));return[n,la(l,s)]}(i,e)),a=n[0],r=n[1];s({type:c.LOAD_PEERS,conversation:a,members:r}),K.logEvent({call_event_type:c.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:i.callData.callId,peer_id:i.peer.toString(),is_group_call:Q(i.peer),group_call_users_count:d.length})},h=Object(r.useCallback)((function(){E(d)}),[d]);return o.a.createElement(xn,{title:u("calls_add_participants_to_call"),onCloseModal:f,actionButtons:o.a.createElement(Bn.default,{key:"add",disabled:_,onClick:h},u("calls_add")),hint:sa(m,i.participantLimit,u),isWithBackButton:n,onBackClick:n?a:function(){}},o.a.createElement(ra,{onChange:p,onClickCallAll:function(e){E(e)}}))};function sa(e,t,n){return e<2?n("calls_management_add_warning"):n("calls_selected").replace("{selected}",""+e).replace("{limit}",""+t)}var ua=n("hN/p"),Aa=function(){return(Aa=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},da=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},pa=function(e){var t=e.isSingleLine,n=e.className,a=e.children,r=da(e,["isSingleLine","className","children"]),i=Object(s.classNames)("InputStub",n,{"InputStub--singleLine":t});return o.a.createElement("div",Aa({className:i},r),a)},ma=n("b8Q7");function fa(){return(fa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var _a=r.useRef,Ea=r.useEffect;function ha(e){var t=e.cameras,n=e.mics,a=e.noiseCancellationOptions,o=e.currentCamId,i=e.currentMicId,l=e.currentNoiseCancellation,c=e.isCamAvailable,s=e.isMicAvailable,u=e.onCameraChange,A=e.onMicChange,d=e.onNoiseCancellationChange,p=e.callsNoiseCancellation,m=r.useContext(j).getLang,f=_a(null),_=_a(null),E=_a(null),h=_a(null),v={controls:!1,crossOrigin:"anonymous",playsInline:"playsinline"};return ga({kind:"video",mediaElRef:f,streamRef:E,deviceId:o,isActive:c}),ga({kind:"audio",mediaElRef:_,streamRef:h,deviceId:i,isActive:s}),r.createElement("div",{className:"CallSettings"},r.createElement("div",{className:"CallSettings__camera"},c?r.createElement("video",fa({ref:f},v,{className:"CallSettings__cameraStream CallSettings__cameraContent"})):r.createElement("div",{className:"CallSettings__cameraStub CallSettings__cameraContent"},m("calls_no_camera"))),s&&r.createElement("audio",fa({ref:_},v)),r.createElement("div",{className:"CallSettings__block"},r.createElement("div",{className:"CallSettings__label"},m("calls_settings_camera")),c?r.createElement(ua.default,{options:t.map(va),value:o,onChange:e=>{var t=e.selected;return u(t.value)},appearance:"secondary",className:"CallSettings__field"}):r.createElement(pa,{className:"CallSettings__field"},m("calls_settings_no_camera"))),r.createElement("div",{className:"CallSettings__block"},r.createElement("div",{className:"CallSettings__label"},m("calls_settings_mic")),s?r.createElement(ua.default,{options:n.map(va),value:i,onChange:e=>{var t=e.selected;return A(t.value)},appearance:"secondary",className:"CallSettings__field"}):r.createElement(pa,{className:"CallSettings__field"},m("calls_settings_no_mic"))),p&&r.createElement("div",{className:"CallSettings__block"},r.createElement("div",{className:"CallSettings__label"},r.createElement(Ne.default,null,m("calls_settings_noise"))),s?r.createElement(ua.default,{options:a,value:l,onChange:e=>{var t=e.selected;return d(t.value)},appearance:"secondary",className:"CallSettings__field"}):r.createElement(pa,{className:"CallSettings__field"},m("calls_settings_no_mic")),r.createElement(R.default,{className:"CallSettings__tooltip",text:m("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320},r.createElement(ma.default,{className:"CallSettings__hint","aria-label":m("calls_settings_noise_description")}))))}function va(e){return{value:e.deviceId,label:e.label}}function ga(e){var t=e.kind,n=e.mediaElRef,a=e.streamRef,r=e.deviceId,o=e.isActive,i={video:!1,audio:!1};Ea(()=>{o&&navigator.mediaDevices.getUserMedia(fa({},i,{[t]:{deviceId:r}})).then(e=>{var t=a.current;t&&t.getTracks().forEach(e=>e.stop());var r=n.current;r&&(a.current=e,r.srcObject=e,r.volume=0,r.play(),he(n))}).catch(e=>{console.error("Error occurred: "+e)})},[r,o]),Ea(()=>()=>{var e=a.current;e&&e.getTracks().forEach(e=>e.stop());var t=n.current;t&&(t.srcObject=null)},[])}ha.defaultProps={cameras:[],mics:[],noiseCancellationOptions:[],currentCamId:"",currentMicId:"",currentNoiseCancellation:"",isCamAvailable:!1,isMicAvailable:!1,callsNoiseCancellation:!1};var Oa=n("GSQL");function Ca(e){var t=e.onClose,n=e.onSubmit,a=e.children,o=r.useContext(j).getLang;return r.createElement(Oa.default,{onClose:t,title:o("calls_settings"),appearance:"blue",actionButtons:r.createElement(r.Fragment,null,r.createElement(Bn.default,{onClick:t,appearance:"tertiary"},o("calls_cancel")),r.createElement(Bn.default,{onClick:n},o("calls_save"))),className:"CallSettingsModal"},a)}var ba=o.a.useState;function ya(e){var t=e.SDK,n=o.a.useContext(j).getLang,a=[{label:n("calls_noise_neural"),value:c.NoiseCancellationTypes.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:n("calls_noise_simple"),value:c.NoiseCancellationTypes.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:n("calls_noise_none"),value:c.NoiseCancellationTypes.NONE,data:{denoise:!1,denoiseAnn:!1}}],r=Object(l.useSelector)((function(e){return e})),i=Object(l.useSelector)((function(e){var t;return[e.mode,null===(t=e.participants[e.me].mediaSettings)||void 0===t?void 0:t.isVideoEnabled]})),s=i[0],u=i[1],A=Object(l.useDispatch)(),d=t.browser.getCameras(),p=t.browser.getMicrophones(),m=t.browser.hasCamera()&&t.browser.hasCameraPermission(),f=t.browser.hasMicrophone()&&t.browser.hasMicrophonePermission(),_=t.browser.getSavedCamera(),E=t.browser.getSavedMicrophone(),h=m&&(_&&_.deviceId||d[0].deviceId),v=f&&(E&&E.deviceId||p[0].deviceId),g=ba(h),O=g[0],C=g[1],b=ba(v),y=b[0],S=b[1],N=ba(r.noiseCancellation),I=N[0],F=N[1];return o.a.createElement(Ca,{onClose:function(){A({type:c.TOGGLE_POPUP})},onSubmit:function(){var e,n=[Promise.resolve()];!_&&h===O&&s!==c.Mode.READY&&!u||_&&_.deviceId===O||n.push(t.changeDevice("videoinput",O)),E&&E.deviceId===y||n.push(t.changeDevice("audioinput",y)),r.noiseCancellation!==I&&n.push(t.setMediaModifiers(null===(e=a.find((function(e){return e.value===I})))||void 0===e?void 0:e.data).then((function(e){console.log("noise: ",e),A({type:c.SET_NOISE_CANCELLATION,data:I})}))),Promise.all(n).then((function(){A({type:c.TOGGLE_POPUP})})).catch((function(e){console.error("Device change failed",e),A({type:c.TOGGLE_POPUP})}))}},o.a.createElement(ha,{mics:p,cameras:d,noiseCancellationOptions:a,currentCamId:O,currentMicId:y,currentNoiseCancellation:I,isCamAvailable:m,isMicAvailable:f,onCameraChange:function(e){return C(e)},onMicChange:function(e){return S(e)},onNoiseCancellationChange:function(e){return F(e)},callsNoiseCancellation:r.callsNoiseCancellation}))}class Sa extends r.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){switch(this.props.mode){case c.Mode.CALL:this.props.SDK.hangup();break;case c.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)}render(){return this.state.hasError?null:this.props.children}}var Na,Ia=n("p9ed");!function(e){e.BLUE="blue",e.GREEN="green",e.GRAY="gray",e.RED="red"}(Na||(Na={}));var Fa=function(e){var t=e.icon,n=e.color;return o.a.createElement("div",{className:Object(s.classNames)("ListIcon","ListIcon--"+n)},t)},Ta=function(){return(Ta=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Pa=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},wa=function(e){var t=Pa(e,[]);return o.a.createElement("svg",Ta({width:"14",height:"14",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{"aria-hidden":"true"}),o.a.createElement("path",{d:"M6.022 9.184a.837.837 0 01-1.187-.001 3.861 3.861 0 010-5.419l2.618-2.643a3.772 3.772 0 015.366 0c1.261 1.274 1.557 3.033.67 4.508-.296.49-.947.47-1.325.09-.275-.276-.254-.707-.077-1.019.465-.817.24-1.683-.456-2.379a2.094 2.094 0 00-2.997 0L6.023 4.956a2.143 2.143 0 00-.001 3.025.83.83 0 010 1.202zm1.95-3.166c.833.835.832 2.19-.001 3.025L5.36 11.68a2.094 2.094 0 01-2.998 0c-.695-.696-.91-1.555-.446-2.371.178-.313.199-.744-.076-1.019-.379-.38-1.03-.4-1.325.09-.888 1.474-.602 3.226.659 4.5a3.772 3.772 0 005.367 0l2.617-2.643a3.861 3.861 0 000-5.419.837.837 0 00-1.187 0 .83.83 0 000 1.2z"}))},Da=function(e){var t=e.text,n=e.onCopyDone,a=e.children,i=Object(r.useRef)(null),l=Object(r.useCallback)((function(e){i.current&&(i.current.focus(),i.current.select(),document.execCommand("copy"),e.preventDefault(),e.stopPropagation(),n&&n())}),[n]);return o.a.createElement("div",{className:"CopyText",onClick:l},o.a.createElement("input",{type:"text",readOnly:!0,value:t||"",ref:i,className:"CopyText__input"}),a)},La=n("x9XA"),Ma=n("zgoX"),Ra=function(e){var t=e.value,n=e.copyText,a=e.doneText,i=e.className,l=Object(r.useState)(!1),c=l[0],u=l[1],A=Object(r.useCallback)((function(){u(!0)}),[]),d=Object(r.useCallback)((function(){u(!1)}),[]),p=Object(s.classNames)("ListCopyControl",i,{"ListCopyControl--copied":c});return o.a.createElement("div",{className:p},o.a.createElement(Da,{text:t,onCopyDone:A},o.a.createElement(La.default,{className:"ListCopyControl__copyButton"},n)),o.a.createElement(Ma.default,{shown:c,callback:d,className:"ListCopyControl__copyDone"},a))},ja=function(e){var t=e.isLinkBlockShown,n=e.linkBlockTitle,a=e.onLinkBlockClick,r=e.callUrlLink,i=o.a.useContext(j).getLang;return o.a.createElement(Ia.default,null,t&&o.a.createElement(Wn.default,{onClick:a,chevron:!0,icon:o.a.createElement(Fa,{icon:o.a.createElement(wa,null),color:Na.GREEN})},n,r&&o.a.createElement(Ra,{value:r,copyText:i("calls_menu_link_copy"),doneText:i("calls_menu_link_copied")})))},ka=n("h7Kf"),Ba=n("IrTF"),Ua=function(e){var t=e.link,n=void 0===t?"":t,a=e.isLinkLoading,i=o.a.useContext(j).getLang,l=Object(r.useState)(!1),c=l[0],s=l[1],u=Object(r.useCallback)((function(){return s(!0)}),[]),A=Object(r.useCallback)((function(){return s(!1)}),[]);return o.a.createElement("div",{className:"CallLink"},o.a.createElement("p",{className:"CallLink__info"},i("calls_management_link_info")),a?o.a.createElement(pa,{className:"CallLink__input"},o.a.createElement(Ba.default,null)):o.a.createElement(ka.default,{readOnly:"readonly",className:"CallLink__input",value:n}),o.a.createElement(Da,{text:n,onCopyDone:u},o.a.createElement(Bn.default,{disabled:a},i("calls_link_copy"))),o.a.createElement(Ma.default,{className:"CallLink__copied",shown:c,callback:A},i("calls_link_copied")))},Ga=n("CGHU"),xa=function(e){var t=e.searchQuery,n=e.onSearchChange,a=e.length,r=e.children,i=o.a.useContext(j).getLang;return o.a.createElement("div",{className:"CallParticipantList"},o.a.createElement(Ga.BlockSearchInput,{value:t,placeholder:i("calls_search_participants_placeholder"),onChange:n,onInput:n,onPaste:n,className:"CallParticipantList__input"}),o.a.createElement(Qn,{extra:a||""},i("calls_participant_list_header")),o.a.createElement(Ia.default,{border:!1,className:"CallParticipantList__list"},r))},Ha=function(){return(Ha=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Va=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Qa=function(e){var t=e.element,n=void 0===t?"span":t,a=e.alt,r=e.className,i=Va(e,["element","alt","className"]),l=n,c=Object(s.classNames)("ListActionsControl",r);return o.a.createElement(l,Ha({"aria-label":a,className:c},i),o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"5",viewBox:"0 0 10 5",fill:"currentColor","aria-hidden":"true"},o.a.createElement("path",{d:"M5 4.8c-.2 0-.3 0-.4-.1l-4.3-3.2c-.3-.3-.4-.8-.2-1.1.2-.3.7-.4 1-.2l3.9 2.9 3.8-2.9c.3-.3.8-.2 1 .1.3.3.2.8-.1 1.1l-4.2 3.2c-.2.1-.3.2-.5.2z"})))},Wa=n("yuXj"),za=function(e){var t=e.position,n=e.align,a=e.trigger,r=e.marginTop,i=e.marginLeft,l=e.actions;return l.length>0?o.a.createElement(Wa.default,{position:t,align:n,trigger:a,marginTop:r,marginLeft:i,className:"ParticipantMenu__dropdown",data:l},o.a.createElement(Qa,null)):null},Ya=function(e){var t=e.SDK,n=e.participant,a=e.navigateToConvo,r=e.navigateToProfile,i=Object(l.useSelector)((function(e){return e})),c=Object(l.useDispatch)(),s=o.a.useContext(j).getLang,u=Qt(i,t,c,n,!1,s,a,r);return u.length>0?o.a.createElement(za,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:u}):null},Ka=function(){return(Ka=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Za=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Xa=function(e){var t=Za(e,[]);return o.a.createElement("svg",Ka({height:"13",width:"12",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 13",fill:"currentColor"},t),o.a.createElement("path",{d:"M3.497 5.06v.44a2.501 2.501 0 002.91 2.467l1.199 1.198a4.005 4.005 0 01-5.521-2.822.75.75 0 00-1.469.314A5.508 5.508 0 005.25 10.95v1.301a.75.75 0 001.501 0v-1.3a5.472 5.472 0 001.973-.669l1.25 1.25a.751.751 0 001.062-1.061L1.88 1.32A.75.75 0 10.82 2.38l2.677 2.68zM9.672 7.097l1.117 1.117a5.463 5.463 0 00.594-1.557.75.75 0 10-1.468-.314 3.963 3.963 0 01-.243.754zM3.827 1.258l4.644 4.64c.02-.13.031-.263.031-.398v-3a2.502 2.502 0 00-4.675-1.242z"}))},Ja=function(){return(Ja=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},qa=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},$a=function(e){var t=qa(e,[]);return o.a.createElement("svg",Ja({width:"15",height:"15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M2.75 3a.75.75 0 01.75.75V7.5a.5.5 0 001 0V2A.75.75 0 016 2v4.75a.5.5 0 001 0v-5.5a.75.75 0 011.5 0v5.5a.5.5 0 001 0V2.5a.75.75 0 011.5 0v7.25l1.614-1.796a.9.9 0 011.36 1.177c-.73.873-2.044 2.449-2.809 3.367C9.913 14 8.08 14.5 6.701 14.5 2.2 14.5 2 11.47 2 10.444V3.75A.75.75 0 012.75 3z"}))},er=function(){return o.a.createElement("div",{className:"VolumeMeterAnimation"})},tr=function(e){var t=e.showSpeaking,n=e.showAudioDisabled,a=e.showRaisedHand,i=e.showConnecting,l=e.showRaisedHandTooltip,c=e.onRaisedHandClick,u=Object(r.useContext)(j).getLang,A=o.a.createElement("span",{className:Object(s.classNames)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==c}),onClick:null!=c?c:void 0},o.a.createElement($a,{className:"ParticipantIndicators__hand"}));return o.a.createElement("span",{className:"ParticipantIndicators"},t&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(er,null)),n&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(Xa,{className:"ParticipantIndicators__muted"})),a?l?o.a.createElement(R.default,{className:"ParticipantIndicators__tooltip",text:u("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light"},A):A:null,i&&o.a.createElement("span",{className:"ParticipantIndicators__item"},o.a.createElement(Fe,null)))},nr=n("d8ub"),ar=function(e){var t=e.SDK,n=e.onAddClick,a=e.navigateToProfile,i=e.navigateToConvo,s=Object(l.useSelector)((function(e){return e})),u=o.a.useContext(j).getLang,A=function(e){return Object.values(e.participants).reduce((function(t,n){return(n.peerId===e.me||n.status)&&(t[0].push(n),n.name&&t[1].push(n)),t}),[[],[]])}(s),d=A[0],p=A[1],m=Object(r.useState)(""),f=m[0],_=m[1],E=Object(r.useCallback)((function(e){return e.name}),[]),h=Object(r.useCallback)((function(e){return e.peerId}),[]),v=G(p,E,h),g=tn(s.participants[s.me]),O=f?v.search(f):d,C=Object(r.useCallback)((function(e){_(e.target.value)}),[]),b=!Ht(s.me);return o.a.createElement(xa,{searchQuery:f,onSearchChange:C,length:O.length},!f&&b&&o.a.createElement(Wn.default,{selectable:!1,border:!1,key:"add"},o.a.createElement(nr.ListAddControl,{onClick:n},u("calls_add_participants"))),O.length>0&&O.map((function(e){var n,r,l,u=e.peerId!==s.me&&e.status===c.CallStatus.WAITING,A=!u&&!(null===(n=e.mediaSettings)||void 0===n?void 0:n.isAudioEnabled),d=!u&&!(null===(r=e.mediaSettings)||void 0===r?void 0:r.isVideoEnabled),p=!u&&!!(null===(l=e.statusData)||void 0===l?void 0:l.hand),m=!!s.speakers[e.peerId],f=u||A||p||m,_=e.peerId===s.me,E=!u&&(A||d)&&g&&!_;return o.a.createElement(Wn.default,{selectable:!1,border:!1,key:e.peerId,aside:o.a.createElement(o.a.Fragment,null,f&&o.a.createElement(tr,{showSpeaking:m,showRaisedHand:p,showAudioDisabled:A,showConnecting:u,showRaisedHandTooltip:E,onRaisedHandClick:E?function(){return function(e){var n=s.participants[e],a=Vt(n);a&&t.unmuteRequest(a,[c.MediaOption.AUDIO,c.MediaOption.VIDEO]).catch(console.log)}(e.peerId)}:void 0,key:"indicators"}),o.a.createElement(Ya,{SDK:t,participant:e,key:"menu",navigateToConvo:i,navigateToProfile:a}))},o.a.createElement(zn.default,{onLinkClick:a,photo:o.a.createElement(P,{id:e.peerId,photo:e.photo,alt:e.name||"",size:"xxxs",showCreatorBadge:en(e),showAdminBadge:$t(e)}),title:e.name,href:e.link,target:"_blank"}))})),f&&0===O.length&&o.a.createElement(Ie.default,null,u("calls_participants_not_found")))};var rr=n("Db7M"),or=n("Nc7d"),ir=n("evbW"),lr=n("7pkf"),cr=[or.UsersFields.PHOTO_400,or.UsersFields.PHOTO_400_ORIG,or.UsersFields.SEX,or.UsersFields.SCREEN_NAME],sr=["photo_400",ir.BaseUserGroupFields.PHOTO_400_ORIG,ir.BaseUserGroupFields.SEX,ir.BaseUserGroupFields.SCREEN_NAME],ur=[ir.BaseUserGroupFields.NAME,ir.BaseUserGroupFields.PHOTO_100,"can_upload_video"],Ar=function(e){return Object(lr.getApiWrapper)()(rr.api)("messages.getConversationsById",{peer_ids:[e],extended:1,fields:sr})},dr=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{attempts:10,timeout:0};return function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return n.attempts>0?q(n.timeout).then(()=>t(...r)).catch(()=>(!n.timeout&&(n.timeout=1),n.attempts--,n.timeout=Math.min(2*n.timeout,300),e(t,n)(...r))):Promise.reject()}}((function(e){return Object(lr.getApiWrapper)()(rr.api)("messages.getCallToken",{env:e?"development":"production"})})),pr=function(e,t){return void 0===t&&(t=!1),Object(lr.getApiWrapper)(!t)(rr.api)("messages.getCallPreview",{link:e,fields:sr,device_id:"anyId"})},mr=function(e,t,n,a,r){void 0===a&&(a=!1);for(var o=[],i=t;i.length;)i.length>100?(o.push(i.slice(0,100)),i=i.slice(100)):(o.push(i),i=[]);var l=Promise.resolve({secret:r,count:0});return o.reduce((function(t,r){return t.then((function(t){return function(t,r){var o=a?{call_id:e,peer_ids:r,fields:sr,device_id:"anyId",secret:t.secret,user_id:n}:{call_id:e,peer_ids:r,fields:sr};return Object(lr.getApiWrapper)(!a)(rr.api)("messages.getCallParticipants",o).then((function(e){return{count:e.count+t.count,secret:e.secret,profiles:(t.profiles||[]).concat(e.profiles||[]),anonyms:(t.anonyms||[]).concat(e.anonyms||[])}}))}(t,r)}))}),l)},fr=function(e){return Object(lr.getApiWrapper)()(rr.api)("users.get",e)};function _r(e){return new Promise((t,n)=>{var a=new Image;a.src=e,a.onload=t,a.onerror=n})}function Er(e){var t=[].concat(...e).map(e=>{var t=e.photo;return t?_r(t):Promise.resolve()});return Promise.all(t).then(()=>e).catch(()=>e)}var hr=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a};function vr(e,t){return Ce(e).friends.length>0?Promise.resolve():(window.curFastChat&&window.curFastChat.friends?Promise.resolve((n=window.curFastChat.friends,Object.entries(n).map((function(e){var t=e[0],n=e[1],a=n[0],r=n[1],o=n[2],i=n[4],l=n[5];return{id:parseInt(t),peerId:parseInt(t),name:a,photo:r,firstName:o,link:l,sex:i}})))):Object(lr.getApiWrapper)()(rr.api)("friends.get",{fields:cr,order:"hints"}).then((function(e){return e.items.map(oe)}))).then((function(e){t({type:c.SET_FRIENDS,data:e})}));var n}function gr(e,t,n,a){return function(e){return Object(lr.getApiWrapper)()(rr.api)("messages.getConversationMembers",{peer_id:e,fields:cr})}(n).then((function(n){var r=n.profiles;r&&t({type:c.SET_CHAT_INFO,data:r.map(oe).sort((function(t,n){var a=Ce(e).me;return t.peerId===a?-1:n.peerId===a?1:0})),conversation:a})}))}function Or(e,t,n){return Ar(n).then((function(e){var n=de(e),a=n[0],r=n[1],o=n[2];return Ir(t,o),Er([a,r])})).then((function(e){var a=e[0],r=e[1];t({type:c.LOAD_PEERS,conversation:a,members:r,peerId:n})}))}function Cr(e,t,n){return n?Ar(n).then((function(e){var n=e.items[0];Ir(t,n)})):Promise.resolve()}var br,yr={acc:[],timer:0,tasks:0,timeout:300};function Sr(e,t,n,a,r){var o=Ce(e).me,i=Ce(e).anonymSecret,l=o<0?o:void 0;return mr(n,hr(a,[o]),l,o<0,i).then((function(e){var n=e.profiles,a=void 0===n?[]:n,o=e.anonyms,i=void 0===o?[]:o,l=e.secret;l&&t({type:c.UPDATE_ANON_SECRET,secret:l});var s=hr(i,a).map(oe),u=Er([{},s]);return r.awaitImages?u.then((function(){return[null,s]})):[null,s]})).then((function(e){var n=e[1];t({type:c.LOAD_PEERS,members:n})})).catch((function(e){return console.error(e)}))}function Nr(e,t){return function(e){return Object(lr.getApiWrapper)()(rr.api)("messages.getJoinLink",{call_id:e})}(t).then((function(t){var n=t.join_link;return e({type:c.CALL_STATE,callData:{callUrlLink:n}}),n}))}function Ir(e,t){if(t&&t.call_in_progress){var n=t.unread_count,a=t.last_message_id,r=t.call_in_progress.has_link,o=t.call_in_progress.can_finish_call;e({type:c.CALL_STATE,callData:{canFinishCall:o,hasUrlLink:r}}),(n||a)&&e({type:c.SET_UNREAD_COUNT,chatUnreadCount:n,chatUpToMsgId:a})}}function Fr(e,t){return function(e){return Object(lr.getApiWrapper)()(rr.api)("video.startStreaming",{name:e.name,description:e.description,wallpost:e.wallpost,stories_post:e.stories_post,group_id:e.group_id,privacy_view:e.privacy_view,privacy_comment:e.privacy_comment,no_comments:e.no_comments,latitude:e.latitude,longitude:e.longitude,category_id:e.category_id,publish:e.publish,call:e.call})}(t).then((function(e){return Object(xt.startStream)(!1,null,e.stream.ov_id)})).catch((function(e){return console.error(e)}))}function Tr(e,t,n,a){var r=t.callData.callId||"";n({type:c.SHOW_LOADER,isLoaderVisible:!0}),function(e){return Object(lr.getApiWrapper)()(rr.api)("messages.forceCallFinish",{call_id:e})}(r).catch((function(e){console.error(e),n({type:c.ERROR,text:a("calls_error_force_call_finish"),handleType:c.ErrorHandleType.FATAL})})).finally((function(){n({type:c.SHOW_LOADER,isLoaderVisible:!1})}))}!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS"}(br||(br={}));var Pr=function(e){var t,n,a=e.SDK,i=e.navigateToConvo,s=e.navigateToProfile,u=Object(l.useSelector)((function(e){return e})),A=Object(l.useDispatch)(),d=Object(r.useState)(u.callData.callUrlLink||""),p=d[0],m=d[1],f=Object(r.useState)(br.MAIN),_=f[0],E=f[1],h=Object(r.useState)(!1),v=h[0],g=h[1],O=!!(null===(t=u.callData.conversation)||void 0===t?void 0:t.canAddMembers),C=null===(n=u.callData)||void 0===n?void 0:n.canFinishCall,b=o.a.useContext(j).getLang,y=Object(r.useCallback)((function(){A({type:c.MANAGEMENT,isOpen:!1})}),[]),S=Object(r.useCallback)((function(){E(br.MAIN)}),[]),N=Object(r.useCallback)((function(){if(E(br.CALL_LINK),!p){var e=u.callData.callId||"";g(!0),Nr(A,e).then((function(e){m(e),g(!1)})).catch((function(e){console.error(e),g(!1),A({type:c.ERROR,text:b("calls_get_url_link_error_text")}),E(br.MAIN)}))}}),[u.callData.callId,p]),I=Object(r.useCallback)((function(){A({type:c.SHOW_LOADER,isLoaderVisible:!0});var e=[vr(u,A)].concat(V(u.peer)?[gr(u,A,u.peer,u.callData.conversation)]:[]);return Promise.all(e).then((function(){A({type:c.SHOW_LOADER,isLoaderVisible:!1}),E(br.ADD_PARTICIPANTS)})).catch((function(e){console.error(e),A({type:c.SHOW_LOADER,isLoaderVisible:!1})}))}),[u.peer,u.callData]),F=Object(r.useCallback)((function(){A({type:c.TOGGLE_POPUP}),Tr(0,u,A,b)}),[u.callData.callId,u.imHash]);return o.a.createElement(o.a.Fragment,null,_===br.MAIN&&o.a.createElement(xn,{title:b("calls_management_participants"),actionButtons:(C?[o.a.createElement(Bn.default,{onClick:F,key:"forceCallFinish",appearance:"secondary"},b("calls_force_call_finish"))]:[]).concat([o.a.createElement(Bn.default,{onClick:a.hangup,key:"leave"},b("calls_leave_call"))]),onCloseModal:y},o.a.createElement(ja,{isLinkBlockShown:O,linkBlockTitle:b("calls_menu_link"),onLinkBlockClick:N,callUrlLink:p}),o.a.createElement(ar,{SDK:a,onAddClick:I,navigateToProfile:s,navigateToConvo:i})),_===br.CALL_LINK&&o.a.createElement(xn,{title:b("calls_management_link"),hint:b("calls_management_add_warning"),onCloseModal:y,isWithBackButton:!0,onBackClick:S},o.a.createElement(Ua,{link:p,isLinkLoading:v})),_===br.ADD_PARTICIPANTS&&o.a.createElement(ca,{SDK:a,isWithBackButton:!0,onBackClick:S}))},wr=function(e){var t=e.children;return o.a.createElement("h2",{className:"JoinHeader"},t)},Dr=function(e){var t=e.children;return o.a.createElement("div",{className:"VisuallyHidden"},t)},Lr=function(e){var t=e.items;return o.a.createElement("figure",{className:"AvatarsStack"},o.a.createElement(Dr,null,o.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},o.a.createElement("defs",null,o.a.createElement("clipPath",{id:"users-mask"},o.a.createElement("path",{d:"M43.56 8.25a25 25 0 100 33.5A27.88 27.88 0 0138 25c0-6.28 2.07-12.08 5.56-16.75z"}))))),t.map((function(e,t){return"src"in e?o.a.createElement("img",{src:e.src,className:"AvatarsStack__item",alt:e.alt,key:e.key||t}):o.a.createElement(S.ConversationNoPhoto,{text:e.text,id:e.id,size:"50",className:"AvatarsStack__item",key:e.key||t})})))},Mr=function(){return(Mr=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Rr=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},jr=function(e){var t=Rr(e,[]);return o.a.createElement("svg",Mr({width:"16",height:"16",fill:"currentColor"},t,{xmlns:"http://www.w3.org/2000/svg"}),o.a.createElement("path",{d:"M3.14 3C1.96 3 1 3.96 1 5.14v5.72C1 12.04 1.96 13 3.14 13h5.72c1.18 0 2.14-.96 2.14-2.14V5.14C11 3.96 10.04 3 8.86 3H3.14zM14.95 4.87c.23-.17.55 0 .55.28v5.7c0 .28-.32.45-.55.28L12 9.01V6.99l2.95-2.12z"}))},kr=function(e){var t=e.isAnonym,n=e.title,a=e.label,r=e.items,i=e.onChangeName,l=e.name,c=e.namePlaceholder,u=e.joinWithVideoText,A=e.joinWithAudioText,d=e.onJoinWithVideo,p=e.onJoinWithAudio,m=e.disabled,f=e.inputDisabled;return o.a.createElement("div",{className:Object(s.classNames)("JoinScreen",{"JoinScreen--anonym":t})},o.a.createElement(wr,null,o.a.createElement(Ne.default,{className:""},n)),o.a.createElement("div",{className:"JoinScreen__members"},o.a.createElement(Lr,{items:r}),o.a.createElement("div",{className:"JoinScreen__membersLabel"},a)),o.a.createElement("footer",{className:"JoinScreen__footer"},t&&o.a.createElement(ka.default,{onChange:i,className:"JoinScreen__input",value:l,placeholder:c,disabled:f,maxLength:25,onKeyDown:function(e){"Enter"===e.key&&d()}}),o.a.createElement(Bn.default,{appearance:"primary",onClick:d,disabled:m,type:"submit"},o.a.createElement(jr,{className:"JoinScreen__icon"}),o.a.createElement("span",null,u)),o.a.createElement(Bn.default,{appearance:"primary",title:A,"aria-label":A,onClick:p,disabled:m},o.a.createElement($n,{className:"JoinScreen__icon"}))))};function Br(e,t,n){void 0===n&&(n={baseURL:""});var a=n.enabled,r=n.isTab,o=n.baseURL;return!a&&t?t:r?'<i class="emoji @'+e+'" emoji="'+e+'"'+(t?' title="'+t+'"':"")+"></i>":'<img class="emoji" src="'+o+"/emoji/e/"+e+(window.devicePixelRatio>=2?"_2x":"")+'.png"'+(t?' alt="'+t+'"':"")+">"}function Ur(e){return Br(function(e){return encodeURIComponent(e.replace(/\uFE0F/giu,"")).replace(/%/gi,"").toLowerCase()}(e),ne(e).replace(/[\u00A0-\u9999<>\&]/gim,(function(e){return"&#"+e.charCodeAt(0)+";"})),{enabled:!0})}var Gr=function(e){var t=e.isAnonym,n=e.joinLink,a=e.vkJoinLink,i=e.title,l=e.members,c=e.conversationData,s=e.withPopup,u=e.onBeforeCallStart,A=e.onAfterCallFinish,d=e.onClose,p=e.bridge,m=e.entryPoint,f=e.tabIsMaster,_=e.tabIsIdle,E=e.onError,h=e.isDev,v=e.okPublicKey,g=o.a.useContext(j),O=g.getLang,C=g.langNumeric,b=Object(r.useState)(""),y=b[0],S=b[1],N=Object(r.useState)(null),I=N[0],F=N[1],T=Object(r.useState)(!1),P=T[0],w=T[1],D=!1,L=l?l.slice(0,3).map((function(e){var t=e.firstName||e.shortName||e.name||"";return e.photo_100?{src:e.photo_100,alt:t,key:e.peerId}:{id:e.peerId,text:t.slice(0,1)}})):[],M=Object(r.useCallback)((function(e){S(e.target.value)}),[]),R=Object(r.useCallback)((function(e){if(t)return D?Promise.resolve():(D=!0,function(e,t,n,a,r,o){if(e)return Promise.resolve(e);return pr(n,!0).then((function(e){var i=e.secret,l=void 0===i?"":i,c=e.user_id,s=void 0===c?0:c,u=e.preview;return function(e,t,n,a){return Object(lr.getApiWrapper)(!1)(rr.api)("messages.getAnonymCallToken",{link:e,user_id:t,name:n,secret:a,device_id:"anyId"})}(n,s,a,l).then((function(e){var n=e.token,i=e.secret,l=void 0===i?"":i,c={is_dev:xr(o),key:r,token:n,ok_user:s,secret:l,is_anonym:!0,me:{canAddMembers:!1,firstName:a,peerId:s,id:s,sex:0,shortName:a,name:a,lastName:"",link:"",photo:"",photo_100:""}},A={callPreview:{tab:u.title,photo:u.photo.photo_200},callsCredentials:c,participantLimit:128,callsLogLongpollPush:!1,callsOkStaging:xr(o),callsAdminMode:!0,callsNoiseCancellation:!1,callsTranslation:!0,callsForceStopVideoStream:!0};return t(A),A}))}))}(I,F,a,y,v,h).then((function(e){return function(e){var t=e.bridge,n=e.inited,a=e.setInited,r=e.data,o=e.onBeforeCallStart,i=e.onAfterCallFinish,l=e.tabIsMaster,c=e.tabIsIdle,s=e.langUtils;if(n)return Promise.resolve();var u=r.callPreview,A=r.callsCredentials,d=r.participantLimit,p=r.callsOkStaging,m=r.callsAdminMode,f=r.callsNoiseCancellation,_=r.callsTranslation,E=r.callsLogLongpollPush,h=r.callsForceStopVideoStream;return t.init({callPreview:u,callsCredentials:A,imHash:"",participantLimit:d,callsOkStaging:p,callsAdminMode:m,callsNoiseCancellation:f,callsTranslation:_,callsLogLongpollPush:E,onBeforeCallStart:o,onAfterCallFinish:i,tabIsMaster:l,tabIsIdle:c,langUtils:s,callsForceStopVideoStream:h}).then((function(){return a(!0)}))}({bridge:p,inited:P,setInited:w,data:e,onBeforeCallStart:u,onAfterCallFinish:A,tabIsMaster:f,tabIsIdle:_,langUtils:g})})).then((function(){return p.joinCallByLink(n,null,e,m)})).catch((function(e){var t="string"==typeof e?e:O("calls_unknown_error");E&&E(t)})).finally((function(){D=!1})));if(d&&d(),!c)throw Error("no peer_id to join");return p.joinCallByLink(n,[c,l],e,m),Promise.resolve()}),[n,d,y,I,P,v]),k=Object(r.useCallback)((function(){d&&d()}),[d]),U=Object(r.useMemo)((function(){var e=/\u{1F3F4}(?:\u{E0067}\u{E0062}(?:\u{E0065}\u{E006E}\u{E0067}|\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074})\u{E007F}|\u{200D}\u{2620}\u{FE0F}?)|\u{1F469}\u{200D}\u{1F469}\u{200D}(?:\u{1F466}\u{200D}\u{1F466}|\u{1F467}\u{200D}[\u{1F466}\u{1F467}])|\u{1F468}(?:\u{200D}(?:\u{2764}\u{FE0F}?\u{200D}(?:\u{1F48B}\u{200D})?\u{1F468}|[\u{1F468}\u{1F469}]\u{200D}(?:\u{1F466}\u{200D}\u{1F466}|\u{1F467}\u{200D}[\u{1F466}\u{1F467}])|\u{1F466}\u{200D}\u{1F466}|\u{1F467}\u{200D}[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|\u{1F469}\u{200D}(?:\u{2764}\u{FE0F}?\u{200D}(?:\u{1F48B}\u{200D}[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|\u{1F469}\u{200D}\u{1F466}\u{200D}\u{1F466}|(?:\u{1F441}\u{FE0F}?\u{200D}\u{1F5E8}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2695}\u{2696}\u{2708}]|\u{1F468}(?:[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2695}\u{2696}\u{2708}]|\u{200D}[\u{2695}\u{2696}\u{2708}])|(?:[\u{26F9}\u{1F3CB}\u{1F3CC}\u{1F575}]\u{FE0F}?|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u{200D}[\u{2640}\u{2642}]|[\u{26F9}\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2640}\u{2642}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9D6}-\u{1F9DD}](?:[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{2640}\u{2642}]|\u{200D}[\u{2640}\u{2642}])|\u{1F469}\u{200D}[\u{2695}\u{2696}\u{2708}])\u{FE0F}?|\u{1F469}\u{200D}\u{1F467}\u{200D}[\u{1F466}\u{1F467}]|\u{1F469}\u{200D}\u{1F469}\u{200D}[\u{1F466}\u{1F467}]|\u{1F468}(?:\u{200D}(?:[\u{1F468}\u{1F469}]\u{200D}[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|[\u{1F3FB}-\u{1F3FF}])|\u{1F3F3}\u{FE0F}?\u{200D}\u{1F308}|\u{1F469}\u{200D}\u{1F467}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]\u{200D}[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}]|\u{1F469}\u{200D}\u{1F466}|\u{1F1F6}\u{1F1E6}|\u{1F1FD}\u{1F1F0}|\u{1F1F4}\u{1F1F2}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|[#\*0-9]\u{FE0F}?\u{20E3}|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{26F9}\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]|[\u{261D}\u{270A}-\u{270D}\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F470}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F4AA}\u{1F574}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F918}-\u{1F91C}\u{1F91D}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F936}\u{1F9B5}\u{1F9B6}\u{1F9D1}-\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u{231A}\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25FD}\u{25FE}\u{2614}\u{2615}\u{2648}-\u{2653}\u{267F}\u{2693}\u{26A1}\u{26AA}\u{26AB}\u{26BD}\u{26BE}\u{26C4}\u{26C5}\u{26CE}\u{26D4}\u{26EA}\u{26F2}\u{26F3}\u{26F5}\u{26FA}\u{26FD}\u{2705}\u{270A}\u{270B}\u{2728}\u{274C}\u{274E}\u{2753}-\u{2755}\u{2757}\u{2795}-\u{2797}\u{27B0}\u{27BF}\u{2B1B}\u{2B1C}\u{2B50}\u{2B55}\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6F9}\u{1F910}-\u{1F93A}\u{1F93C}-\u{1F93E}\u{1F940}-\u{1F945}\u{1F947}-\u{1F970}\u{1F973}-\u{1F976}\u{1F97A}\u{1F97C}-\u{1F9A2}\u{1F9B0}-\u{1F9B9}\u{1F9C0}-\u{1F9C2}\u{1F9D0}-\u{1F9FF}]|[\xA9\xAE\u{203C}\u{2049}\u{2122}\u{2139}\u{2194}-\u{2199}\u{21A9}\u{21AA}\u{231A}\u{231B}\u{2328}\u{23CF}\u{23E9}-\u{23F3}\u{23F8}-\u{23FA}\u{24C2}\u{25AA}\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2600}-\u{2604}\u{260E}\u{2611}\u{2614}\u{2615}\u{2618}\u{261D}\u{2620}\u{2622}\u{2623}\u{2626}\u{262A}\u{262E}\u{262F}\u{2638}-\u{263A}\u{2648}-\u{2653}\u{265F}\u{2660}\u{2663}\u{2665}\u{2666}\u{2668}\u{267B}\u{267E}\u{267F}\u{2692}-\u{2697}\u{2699}\u{269B}\u{269C}\u{26A0}\u{26A1}\u{26AA}\u{26AB}\u{26B0}\u{26B1}\u{26BD}\u{26BE}\u{26C4}\u{26C5}\u{26C8}\u{26CE}\u{26CF}\u{26D1}\u{26D3}\u{26D4}\u{26E9}\u{26EA}\u{26F0}-\u{26F5}\u{26F7}-\u{26FA}\u{26FD}\u{2702}\u{2705}\u{2708}-\u{270D}\u{270F}\u{2712}\u{2714}\u{2716}\u{271D}\u{2721}\u{2728}\u{2733}\u{2734}\u{2744}\u{2747}\u{274C}\u{274E}\u{2753}-\u{2755}\u{2757}\u{2763}\u{2764}\u{2795}-\u{2797}\u{27A1}\u{27B0}\u{27BF}\u{2934}\u{2935}\u{2B05}-\u{2B07}\u{2B1B}\u{2B1C}\u{2B50}\u{2B55}\u{3030}\u{303D}\u{3297}\u{3299}\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6F9}\u{1F910}-\u{1F93A}\u{1F93C}-\u{1F93E}\u{1F940}-\u{1F945}\u{1F947}-\u{1F970}\u{1F973}-\u{1F976}\u{1F97A}\u{1F97C}-\u{1F9A2}\u{1F9B0}-\u{1F9B9}\u{1F9C0}-\u{1F9C2}\u{1F9D0}-\u{1F9FF}]\u{FE0F}?|[\u{261D}\u{26F9}\u{270A}-\u{270D}\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F469}\u{1F46E}\u{1F470}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9D1}-\u{1F9DD}]/gu;return ne(ae(i)).replace(e,Ur)}),[i]),G=o.a.createElement(kr,{isAnonym:t,name:y,onChangeName:M,namePlaceholder:O("calls_name_placeholder"),title:U,label:Oe(l||[],L,(function(e){return e.firstName}),O,C),items:L,joinWithVideoText:O("calls_join_with_video"),joinWithAudioText:O("calls_join_with_audio"),onJoinWithVideo:function(){return R(!0)},onJoinWithAudio:function(){return R(!1)},disabled:t&&!/^[A-Za-zА-Яа-яЁё0-9_\- ]{2,25}$/.test(y),inputDisabled:!!I});return s?o.a.createElement(B.default,{onClose:k},o.a.createElement(Un.ModalHeader,{appearance:"blue",title:O("calls_invite"),onClose:k}),G):G},xr=function(e){return void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv};var Hr,Vr=function(e){var t=e.children;return o.a.createElement("div",{className:"ErrorPopupText"},t)},Qr=function(e){var t=e.title,n=e.onClose,a=e.actionButtons,r=e.text;return o.a.createElement(Oa.default,{appearance:"blue",title:t,onClose:n,actionButtons:a,className:"CallError"},o.a.createElement(Vr,null,r))},Wr=function(e){var t=e.title,n=e.text,a=e.onCloseFatal,r=e.handleType,i=e.callId,s=e.bridge,u=Object(l.useDispatch)(),A=o.a.useContext(j).getLang,d=function(){switch(u({type:c.ERROR,isClosed:!0}),r){case c.ErrorHandleType.FATAL:a();break;case c.ErrorHandleType.DECLINE:Object(xt.declineCall)().catch((function(){}));break;case c.ErrorHandleType.PROCESS:Object(xt.processPush)(i||"").then((function(){Object(xt.declineCall)().catch((function(){}))})).catch((function(e){s.debug&&console.error("Delayed by error push process error",e)}))}};return o.a.createElement(Qr,{title:o.a.createElement(Ne.default,null,t||A("calls_oops")),onClose:d,actionButtons:o.a.createElement(Bn.default,{onClick:d},A("calls_close")),text:o.a.createElement(Ne.default,null,n||A("calls_error"))})},zr=function(e){var t=e.onClose,n=e.actionButtons,a=o.a.useContext(j).getLang;return o.a.createElement(Oa.default,{onClose:t,title:a("calls_exit_menu"),appearance:"blue",actionButtons:n,className:"CallExitModal"},o.a.createElement("div",{className:"CallExitModal__text"},a("calls_sure_leave_call")))},Yr=function(e){var t=e.SDK,n=Object(l.useSelector)((function(e){return e})),a=Object(l.useDispatch)(),i=o.a.useContext(j).getLang,s=function(){return K.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:n.callData.callId,peer_id:n.peer,is_group_call:Q(n.peer),reason:"none",group_call_users_count:Kt(n)})},u=Object(r.useCallback)((function(){a({type:c.TOGGLE_POPUP})}),[]);return o.a.createElement(zr,{onClose:u,actionButtons:[o.a.createElement(Bn.default,{onClick:function(){a({type:c.TOGGLE_POPUP}),s(),Tr(0,n,a,i)},key:"forceCallFinish",appearance:"secondary"},i("calls_force_call_finish")),o.a.createElement(Bn.default,{onClick:function(){return a({type:c.TOGGLE_POPUP}),s(),t.hangup()},key:"leave"},i("calls_leave_call"))]})};!function(e){e.CONTAIN="cn",e.COVER="cv"}(Hr||(Hr={}));function Kr(e,t,n){return e.uiMode===c.UIMode.COLLAPSED?function(e){var t=_e(e),n=zt(e,t);return Yt(e).reduce((function(e,t){var a=t.peerId,r=t.mediaSettings;return a===(null==n?void 0:n.peerId)&&(null==r?void 0:r.isVideoEnabled)?e.set(t.peerId,{fit:Hr.CONTAIN,width:265,height:200,priority:2,uid:Vt(n)}):e.set(t.peerId,{fit:Hr.CONTAIN,width:0,height:0,priority:-1,uid:Vt(t)}),e}),new Map)}(e):e.isOratorMode?function(e,t,n){var a=e.pinnedParticipant||e.orator||e.me;return Yt(e).reduce((function(r,o){var i=o.peerId,l=o.mediaSettings;if(a===i&&(null==l?void 0:l.isVideoEnabled)){var s=e.uiMode===c.UIMode.FULLSCREEN;r.set(o.peerId,{fit:Hr.CONTAIN,width:s?t:900,height:s?n:504,priority:3,uid:Vt(o)})}else(null==l?void 0:l.isVideoEnabled)&&!1!==e.visibleParticipants[o.peerId]?r.set(o.peerId,{fit:(null==l?void 0:l.isScreenSharingEnabled)?Hr.CONTAIN:Hr.COVER,width:140,height:140,priority:1,uid:Vt(o)}):r.set(o.peerId,{fit:Hr.COVER,width:0,height:0,priority:-1,uid:Vt(o)});return r}),new Map)}(e,t,n):function(e,t,n){var a=e.uiMode===c.UIMode.FULLSCREEN,r=a?t:900,o=a?n:504,i=Yt(e),l=function(e,t,n){switch(n){case 1:return t;case 2:return Math.round(e/2);case 3:return Math.round(e/3);case 4:case 5:case 6:return Math.round(t/2);case 7:case 8:return Math.round(e/4);case 9:case 10:return Math.round(e/5);case 11:case 12:case 13:case 14:case 15:return Math.round(t/3);default:return Math.round(e/6)}}(r,o,i.length),s=l<200?1:2;return i.reduce((function(t,n){var a,r=Vt(n);return r?((null===(a=n.mediaSettings)||void 0===a?void 0:a.isVideoEnabled)&&!1!==e.visibleParticipants[n.peerId]?t.set(n.peerId,{fit:Hr.COVER,width:l,height:l,priority:s,uid:r}):t.set(n.peerId,{fit:Hr.COVER,width:0,height:0,priority:-1,uid:r}),t):t}),new Map)}(e,t,n)}var Zr=function(e,t){var n=Object(r.useState)([0,0]),a=n[0],o=a[0],i=a[1],l=n[1],u=Object(r.useCallback)(Object(s.throttle)(Xr,1e3),[]),A=Object(r.useRef)(new Map),d=Object(r.useRef)([]);Object(r.useEffect)((function(){var e=function(){return l([window.innerWidth,window.innerHeight])};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(r.useEffect)((function(){if(t.mode===c.Mode.CALL){var n=Kr(t,o,i),a=function(e,t){var n=[];return t.forEach((function(t,a){var r,o,i=e.get(a);i&&(o=t,(r=i).fit===o.fit&&r.width===o.width&&r.height==r.height&&r.priority===o.priority)||n.push(t)})),n}(A.current,n);a.length>0&&u(e,t,a,A,n,d)}}),[o,i,t.participants,t.mode,t.visibleParticipants,t.uiMode,t.isOratorMode,t.orator,t.pinnedParticipant])};function Xr(e,t,n,a,r,o){if(t.mode!==c.Mode.CALL)return a.current=new Map,void(o.current=[]);o.current=n,a.current=r,e.updateDisplayLayout(n)}var Jr,qr=function(e){var t=e.isIncoming,n=void 0!==t&&t,a=Object(l.useSelector)((function(e){return e})),i=Object(l.useDispatch)(),s=Object(r.useContext)(j).getLang,u=s(n?"calls_reject_title":"calls_hangup_description"),A=s(n?"calls_reject_description":"calls_hangup_description"),d=Object(r.useCallback)((function(){i({type:c.SHOW_CAUTION_BOX,isOpen:!1})}),[]);return o.a.createElement(Qr,{title:u,onClose:d,actionButtons:o.a.createElement(o.a.Fragment,null,o.a.createElement(Bn.default,{onClick:function(){d(),n?Object(xt.declineCall)().catch((function(){})):(Object(xt.hangup)().catch((function(){})),K.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:Q(a.peer),reason:"none",group_call_users_count:fe(a).length}))}},s("calls_yes")),o.a.createElement(Bn.default,{onClick:d},s("calls_no"))),text:A})},$r=n("wQFj"),eo=function(e){var t=e.onClose,n=e.onUnmuteToggle,a=e.allowUnmute,r=e.unmuteToggleDisabled,i=e.actionButtons,l=e.title,c=e.description,s=e.toggleSign;return o.a.createElement(Oa.default,{className:"MuteParticipantModal",appearance:"blue",title:l,actionButtons:i,onClose:t},o.a.createElement("div",{className:"MuteParticipantModal__content"},c,o.a.createElement($r.default,{className:"MuteParticipantModal__checkbox",onChange:n,checked:a,disabled:r},s)))},to=function(e){var t,n,a,i,s,u=e.SDK,A=Object(l.useSelector)((function(e){return e})),d=Object(r.useState)(!0),p=d[0],m=d[1],f=Object(r.useState)(null),_=f[0],E=f[1],h=Object(r.useState)(!0),v=h[0],g=h[1],O=Object(l.useDispatch)(),C=o.a.useContext(j).getLang,b=null===(t=A.participantsManagement)||void 0===t?void 0:t.mode,y=null===(n=A.participantsManagement)||void 0===n?void 0:n.participant,S=b===c.ParticipantsManagementMode.SINGLE&&($t(y)||en(y));Object(r.useEffect)((function(){var e;if(b!==c.ParticipantsManagementMode.SINGLE||Ht((null==y?void 0:y.peerId)||0))m(!1);else{O({type:c.SHOW_LOADER,isLoaderVisible:!0});var t=null===(e=A.participantsManagement)||void 0===e?void 0:e.participant;fr({user_ids:t&&[String(t.peerId)],name_case:"acc"}).then((function(e){var t=e[0];E(t),m(!1)})).then((function(){O({type:c.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}}),[b,null===(a=A.participantsManagement)||void 0===a?void 0:a.participant]);var N=Object(r.useCallback)((function(){O({type:c.TOGGLE_PARTICIPANTS_MANAGEMENT})}),[]),I=Object(r.useCallback)((function(){if(b===c.ParticipantsManagementMode.SINGLE){var e=Vt(y);u.muteParticipant(e,[c.MediaOption.AUDIO,c.MediaOption.VIDEO],!v).catch(console.log).finally(N),K.logEvent({call_event_type:c.CallActionEventType.USER_MICS_AND_VIDEO_DISABLED,session_id:A.callData.callId,peer_id:A.peer,is_group_call:Q(A.peer),mute_permanent:v?c.CallStatMuteType.ONCE:c.CallStatMuteType.PERMANENT})}else b===c.ParticipantsManagementMode.ALL&&(u.muteParticipant(void 0,[c.MediaOption.AUDIO,c.MediaOption.VIDEO],!v).catch(console.log).finally(N),K.logEvent({call_event_type:c.CallActionEventType.ALL_MICS_AND_VIDEO_DISABLED,session_id:A.callData.callId,peer_id:A.peer,is_group_call:Q(A.peer),mute_permanent:v?c.CallStatMuteType.ONCE:c.CallStatMuteType.PERMANENT}))}),[v]);return b===c.ParticipantsManagementMode.SINGLE&&p?null:o.a.createElement(eo,{onClose:N,allowUnmute:v,unmuteToggleDisabled:S,onUnmuteToggle:function(e,t){return g(t)},title:b===c.ParticipantsManagementMode.SINGLE?C("calls_mute_participant_dialog_title").replace("{name}",null!==(i=null==_?void 0:_.first_name)&&void 0!==i?i:null==y?void 0:y.name):C("calls_mute_all_participants_dialog_title"),description:b===c.ParticipantsManagementMode.SINGLE?C("calls_mute_participant_dialog_description").replace("{name}",null!==(s=null==_?void 0:_.first_name)&&void 0!==s?s:null==y?void 0:y.name):C("calls_mute_all_participants_dialog_description"),toggleSign:b===c.ParticipantsManagementMode.SINGLE?C("calls_mute_participant_dialog_permanent_toggle"):C("calls_mute_all_participants_dialog_permanent_toggle"),actionButtons:[o.a.createElement(Bn.default,{onClick:N,appearance:"secondary",key:"cancel"},C("calls_cancel")),o.a.createElement(Bn.default,{onClick:I,key:"disable"},C("calls_mute_participant_dialog_action"))]})},no=function(e){var t=e.onClose,n=e.actionButtons,a=e.title,r=e.description;return o.a.createElement(Oa.default,{className:"UnmuteRequestModal",appearance:"blue",title:a,actionButtons:n,onClose:t},o.a.createElement("div",{className:"UnmuteRequestModal__content"},r))},ao=function(e){var t=e.SDK,n=Object(l.useDispatch)(),a=o.a.useContext(j).getLang,r=Object(l.useSelector)((function(e){return e})),i=r.participants[r.me],s=i.mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},u=function(){n({type:c.TOGGLE_POPUP})},A=function(){var e=i.mediaSettings;(null==e?void 0:e.isAudioEnabled)||(s.isAudioEnabled?Promise.resolve():z(t,!1,!0)).then((function(){var e;(null===(e=r.notification)||void 0===e?void 0:e.type)===c.NotificationType.SPEAKING_ON_MUTE&&n({type:c.CALL_NOTIFICATION,notification:null}),t.toggleLocalAudio(!0).catch(console.log)}))};return o.a.createElement(no,{onClose:u,title:a("calls_dialog_unmute_request_title"),description:a("calls_dialog_unmute_request_description"),actionButtons:[o.a.createElement(Bn.default,{onClick:function(){A(),u()},appearance:"secondary",key:"mic"},a("calls_dialog_unmute_request_mic_only_action")),o.a.createElement(Bn.default,{onClick:function(){var e;A(),(null==(e=i.mediaSettings)?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled)||(!s.isVideoEnabled||s.isScreenSharingEnabled?z(t,!0,!1):Promise.resolve()).then((function(){t.toggleLocalVideo(!0).catch(console.log)})),u()},key:"all"},a("calls_dialog_unmute_request_action"))]})},ro=function(e){var t=e.title,n=e.description,a=e.onClose,r=e.actionButtons;return o.a.createElement(Oa.default,{className:"AssignAdminModal",appearance:"blue",title:t,actionButtons:r,onClose:a},o.a.createElement("div",{className:"AssignAdminModal__content"},n))},oo=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a},io=function(e){var t=e.SDK,n=Object(l.useSelector)((function(e){return e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0})),a=Object(l.useSelector)((function(e){return e})),i=Object(l.useDispatch)(),s=Object(r.useState)(!0),u=s[0],A=s[1],d=Object(r.useState)(null),p=d[0],m=d[1],f=o.a.useContext(j).getLang;Object(r.useEffect)((function(){i({type:c.SHOW_LOADER,isLoaderVisible:!0}),fr({user_ids:n&&[String(n.peerId)],name_case:"dat"}).then((function(e){var t=e[0];m(t),A(!1)})).then((function(){i({type:c.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}),[n]);var _=Object(r.useCallback)((function(){i({type:c.TOGGLE_ADMIN_ASSIGNMENT})}),[]),E=Object(r.useCallback)((function(){var e=Vt(n);e?(t.grantRoles(e,[c.UserRole.ADMIN],!1).then((function(){n&&i({type:c.CHANGE_PARTICIPANT_ROLES,participantId:n.peerId,data:n.roles?oo(n.roles,[c.UserRole.ADMIN]):[c.UserRole.ADMIN]})})).catch(console.log),K.logEvent({call_event_type:c.CallActionEventType.ASSIGN_ADMIN,session_id:a.callData.callId,peer_id:a.peer,is_group_call:Q(a.peer)}),_()):_()}),[]);return u?null:o.a.createElement(ro,{onClose:_,title:f("calls_dialog_assign_admin_role_title"),description:f("calls_dialog_assign_admin_role_description").replace("{name}",(null==p?void 0:p.first_name)+" "+(null==p?void 0:p.last_name)),actionButtons:[o.a.createElement(Bn.default,{onClick:_,appearance:"secondary",key:"cancel"},f("calls_dialog_assign_admin_role_action_later")),o.a.createElement(Bn.default,{onClick:E,key:"primary"},f("calls_dialog_assign_admin_role_action_primary"))]})},lo=n("QDnf"),co="wakeLock"in navigator&&!0,so=null,uo=!1,Ao=function(){null!==so&&"visible"===document.visibilityState&&mo()},po=function(){var e,t,n,a;Jr||((Jr=document.createElement("video")).setAttribute("title","Wake lock"),Jr.setAttribute("playsinline",""),e=Jr,t="mp4",n="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=",(a=document.createElement("source")).src=n,a.type="video/"+t,e.appendChild(a),Jr.addEventListener("loadedmetadata",(function(){Jr&&Jr.addEventListener("timeupdate",(function(){Jr&&Jr.currentTime>.5&&(Jr.currentTime=Math.random())}))}))),Jr.play().catch((function(){}))};function mo(){if(!co)return po();uo||(uo=!0,document.addEventListener("visibilitychange",Ao));try{navigator.wakeLock.request("screen").then((function(e){(so=e).addEventListener("release",(function(){}))}))}catch(e){console.error(e.name+", "+e.message)}}function fo(){co?so&&so.release().then((function(){so=null})):Jr&&Jr.pause()}var _o=n("s1Gz");function Eo(e){var t=e.onClose,n=e.onSubmit,a=e.title,r=e.children,i=e.isWithBackButton,l=e.onBackClick,c=e.contentClassName,s=void 0===c?"TranslationCreateModal__content":c,u=o.a.useContext(j).getLang,A=n&&t;return o.a.createElement(B.default,{disableBodyScroll:!0,onClose:t,className:"TranslationCreateModal",hasScroll:!1},o.a.createElement(Un.ModalHeader,{title:a,onClose:t,appearance:"blue",backText:i?u("calls_back"):void 0,onBack:l}),o.a.createElement("div",{className:s},r),A&&o.a.createElement(Gn.ModalFooter,{actionButtons:o.a.createElement(o.a.Fragment,null,o.a.createElement(Bn.default,{onClick:t,appearance:"tertiary"},u("calls_cancel")),o.a.createElement(Bn.default,{onClick:n},u("calls_translation_start")))}))}var ho=function(){return(ho=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},vo=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},go=function(e){var t=vo(e,[]);return o.a.createElement("svg",ho({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{d:"M4 9.6c0-.56 0-.84.109-1.054a1 1 0 01.437-.437C4.76 8 5.04 8 5.6 8h8.8c.56 0 .84 0 1.054.109a1 1 0 01.437.437C16 8.76 16 9.04 16 9.6v4.8c0 .56 0 .84-.109 1.054a1 1 0 01-.437.437C15.24 16 14.96 16 14.4 16H5.6c-.56 0-.84 0-1.054-.109a1 1 0 01-.437-.437C4 15.24 4 14.96 4 14.4V9.6z",fill:"#fff"}),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.2 6a2.2 2.2 0 00-4.4 0v4a2.2 2.2 0 104.4-.001V6zM10 2a4 4 0 00-4 4v4a4 4 0 108-.001V6A4 4 0 0010 2z",fill:"#fff"}))},Oo=function(){return(Oo=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Co=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},bo=function(e){var t=Co(e,[]);return o.a.createElement("svg",Oo({width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.8 8a6.2 6.2 0 1112.4 0A6.2 6.2 0 011.8 8zM0 8a8 8 0 1116 0A8 8 0 010 8zm8.9-3a.9.9 0 00-1.8 0v4a.9.9 0 00.498.805l2 1a.9.9 0 10.804-1.61L8.9 8.444V5z",fill:"#fff"}))};var yo,So,No=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a};function Io(e){var t=e.onSubmit,n=e.onClose,a=Object(r.useContext)(j),i=a.getLang,c=a.langShortDateTime,s=Object(l.useSelector)((function(e){return e})),u=function(){var e=(new Date).toISOString().split("T")[0];return i("calls_translation_title_default_value").replace("%s",e)},A=function(e,t,n){return{id:e,name:t,photo:n,isGroup:e<0}},d=function(e){var t=[{value:yo.ONLY_ME,label:i("calls_translation_privacy_only_me_and_chat")},{value:yo.FRIENDS,label:i("calls_translation_privacy_friends_and_chat")}];return e&&t.push({value:yo.ALL,label:i("calls_translation_privacy_all_users")}),t},p=function(e){return e.participants[e.me]}(s),m=Object(r.useState)(u()),f=m[0],_=m[1],E=Object(r.useState)(""),h=E[0],v=E[1],g=Object(r.useState)(yo.ONLY_ME),O=g[0],C=g[1],b=Object(r.useState)((function(){return d(!p.isClosed)})),y=b[0],S=b[1],N=Object(r.useState)(A(p.peerId,p.name,p.photo)),I=N[0],F=N[1],T=Object(r.useState)(So.MAIN),P=T[0],w=T[1],D=Object(r.useState)({}),L=D[0],M=D[1],R=Object(r.useState)([{value:p.peerId,label:p.name}]),k=R[0],B=R[1],U=Object(r.useState)([]),G=U[0],x=U[1],H=Object(r.useState)(!1),V=H[0],Q=H[1],W=Object(r.useState)([]),z=W[0],Y=W[1],K=Object(r.useState)([]),Z=K[0],X=K[1],J=function(e){var t,n,a;e.owner_id>0&&(t=e.owner_id,n=[e.owner_id+"_"+e.id],a=!0,Object(lr.getApiWrapper)()(rr.api)("video.get",{owner_id:t,videos:n,need_privacy:a})).then((function(t){if(t.count>0){var n=t.items.filter((function(t){return t.id==e.id}));n.length>0&&(e.privacy_view=n[0].privacy_view,M(e),e.privacy_view&&C(e.privacy_view.category))}})),M(e),w(So.MAIN),_(e.title),v(e.description)},q=Object(r.useCallback)((function(){var e=f.trim(),n=h.trim(),a={};if(Object.keys(L).length>0){e||(e=L.title),n||(n=L.description);var r=n!=L.title||e!=L.description;r||(r=I.id>0&&L.privacy_view.category!=O),r&&function(e,t,n,a,r){return Object(lr.getApiWrapper)()(rr.api)("video.edit",{owner_id:e,video_id:t,name:n,desc:a,privacy_view:r})}(I.id,L.id,e,n,O).catch((function(e){return console.error(e)}))}else a={name:e||u(),description:n,wallpost:!1,stories_post:!1,privacy_view:O,group_id:I.id<0?-I.id:0,postponed:!1,privacy_comment:null,no_comments:!1,latitude:null,longitude:null,category_id:null,publish:!1,call:!0};t(a,L)}),[f,h,O,I,L]);Object(r.useEffect)((function(){Object(lr.getApiWrapper)()(rr.api)("groups.get",{fields:ur,filter:"admin",extended:!0}).then((function(e){var t=No(k);e.count>0&&(e.items.forEach((function(e){e.can_upload_video&&t.push({value:-e.id,label:e.name})})),B(t),x(e.items))})).catch((function(e){return console.error(e)}))}),[]),Object(r.useEffect)((function(){var e;M({}),Q(!1),Y([]),(e=[I.id],Object(lr.getApiWrapper)()(rr.api)("video.getUpcomingLives",{owner_ids:e})).then((function(e){var t=[];e.count>0&&(t=e.items.filter((function(e){return""!==e.ov_id})));var n=t.length>0;if(Q(n),Y(t),n){var a=[];t.forEach((function(e){e.owner_id&&e.owner_id>0&&a.push(e.owner_id.toString())})),a&&fr({user_ids:a}).then((function(e){var t=[];e.forEach((function(e){t.push({id:e.id,name:e.first_name+" "+e.last_name})})),X(t)})).catch((function(e){return console.error(e)}))}})).catch((function(e){return console.error(e)}))}),[I]);var $=function(e){var t=e.date;e.live_start_time&&(t=e.live_start_time);var n=t-Date.now()/1e3;return n>0&&n<604800?i("calls_translation_date_label_soon"):""};return o.a.createElement(o.a.Fragment,null,P===So.MAIN&&o.a.createElement(Eo,{onClose:n,onSubmit:q,title:i("calls_translation_box_title")},o.a.createElement("div",{className:"TranslationCreateForm__link"},o.a.createElement(Ia.default,null,k.length>0&&o.a.createElement(Wn.default,{border:!0,canBeHovered:!1,selectable:!1,icon:o.a.createElement(Fa,{icon:o.a.createElement("img",{className:"TranslationCreateForm__ownerIcon",src:I.photo,alt:I.name}),color:Na.GRAY}),aside:o.a.createElement(ua.default,{className:"TranslationCreateFormOptions__longselect",options:k,value:I.id,onChange:function(e){var t=e.selected.value;t<0?G.forEach((function(e){e.id==-t&&(C(yo.ALL),S(d(!0)),F(A(-e.id,e.name,e.photo_100)))})):(S(d(!p.isClosed)),C(yo.ONLY_ME),F(A(p.peerId,p.name,p.photo)))}})},i("calls_translation_owner_title")),o.a.createElement(Wn.default,{className:V?"":"TranslationCreateForm__selectUpcoming--disabled",canBeHovered:V,selectable:V,onClick:function(){V&&w(So.SELECT_POSTPONE)},chevron:!0,border:!0,icon:o.a.createElement(Fa,{icon:o.a.createElement(bo,null),color:Na.GREEN})},i("calls_translation_postponed_title"),Object.keys(L).length>0&&o.a.createElement("div",{className:"TranslationCreateForm__copyControl"},o.a.createElement(La.default,{className:"TranslationCreateForm__copyButton",onClick:function(e){e.preventDefault(),e.stopPropagation(),M({}),_(u()),v("")}},i("calls_translation_postponed_reset")))),o.a.createElement(Wn.default,{border:!1,canBeHovered:!1,selectable:!1,icon:o.a.createElement(Fa,{icon:o.a.createElement(go,null),color:Na.GRAY}),aside:o.a.createElement(ua.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:I.isGroup,options:y,value:O,onChange:function(e){C(e.selected.value)}})},i("calls_translation_who_can_see_video_privacy"))),o.a.createElement("div",{className:"TranslationCreateForm__privacyHint"},i("calls_translation_who_can_see_video_privacy_hint"))),o.a.createElement("form",{className:"TranslationCreateForm__main",onSubmit:q},o.a.createElement("div",{className:"TranslationCreateForm__section"},o.a.createElement("div",{className:"TranslationCreateForm__block"},o.a.createElement("label",{className:"TranslationCreateForm__label"},i("calls_translation_title"),o.a.createElement(ka.default,{className:"TranslationCreateForm__field",value:f,onChange:function(e){var t=e.target;_(t.value)},placeholder:i("calls_translation_name_placeholder")}))),o.a.createElement("div",{className:"TranslationCreateForm__block"},o.a.createElement("label",{className:"TranslationCreateForm__label"},i("calls_translation_description"),o.a.createElement(_o.default,{className:"TranslationCreateForm__field",placeholder:i("calls_translation_description_placeholder"),value:h,onChange:function(e){var t=e.target;v(t.value)}})))),o.a.createElement("div",{className:"TranslationCreateForm__tabSection"},o.a.createElement("div",{className:"TranslationCreateForm__warning"},i("calls_translation_notification_warning"))))),P===So.SELECT_POSTPONE&&o.a.createElement(Eo,{title:i("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:function(){return w(So.MAIN)},onClose:n,contentClassName:"TranslationCreateForm__modalVideo"},o.a.createElement("div",null,z.length>0&&o.a.createElement(Ia.default,{className:"TranslationCreateForm__VideoList"},z.map((function(e,t){return o.a.createElement(Wn.default,{className:"TranslationCreateForm__videoItem",active:e.id===L,key:t,border:!0,canBeHovered:!0,selectable:!0,onClick:function(){return J(e)},aside:o.a.createElement("span",{className:"TranslationCreateForm__videoLink"},i("calls_translation_select_video_link"))},o.a.createElement("div",{className:"TranslationCreateForm__videoImagePreview"},o.a.createElement("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title}),$(e)&&o.a.createElement("span",{className:"TranslationCreateForm__videoImageLabel"},$(e))),o.a.createElement("div",{className:"TranslationCreateForm__videoDescription"},o.a.createElement("div",{className:"TranslationCreateForm__videoTitle"},e.title),o.a.createElement("div",{className:"TranslationCreateForm__videoOwner"},function(e){if(!(e>0))return I.name;var t=Z.filter((function(t){return t.id==e}));if(t.length>0){var n=t[0];if(n)return n.name}return""}(e.owner_id)),o.a.createElement("div",{className:"TranslationCreateForm__videoDate"},(a=(n=e).date,n.live_start_time&&(a=n.live_start_time),c(1e3*a)))));var n,a}))))))}function Fo(){var e,t,n,a,i,s=Object(l.useSelector)((function(e){return e})),u=Object(l.useDispatch)(),A=o.a.useContext(j).getLang,d=Object(r.useCallback)((function(){u({type:c.TOGGLE_POPUP})}),[]),p=!!(null===(t=null===(e=s.translation)||void 0===e?void 0:e.host)||void 0===t?void 0:t.id)&&+(null===(a=null===(n=s.translation)||void 0===n?void 0:n.host)||void 0===a?void 0:a.id)===s.me,m=Object(r.useCallback)((function(){u({type:c.TOGGLE_POPUP,data:c.POPUP_TRANSLATION_STOP})}),[]),f=Object(r.useCallback)((function(e,t){return t&&Object.keys(t).length>0?Object(xt.startStream)(!1,null,t.ov_id).catch((function(e){return console.error(e)})).finally(d):Fr(0,e).finally(d)}),[]),_=Object(r.useCallback)((function(){u({type:c.TOGGLE_POPUP,data:c.POPUP_TRANSLATION_SHARE})}),[]);return(null===(i=s.translation)||void 0===i?void 0:i.isOn)?o.a.createElement(xn,{title:A("calls_translation_menu_title"),actionButtons:p?[o.a.createElement(Bn.default,{onClick:m,appearance:"negative",key:"stop"},A("calls_translation_menu_stop"))]:[],onCloseModal:d},o.a.createElement(ja,{isLinkBlockShown:!0,linkBlockTitle:A("calls_translation_menu_link"),onLinkBlockClick:_,callUrlLink:s.translation.link})):o.a.createElement(Io,{onSubmit:f,onClose:d})}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(yo||(yo={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}(So||(So={}));var To=function(e){var t=e.onClose,n=e.actionButtons,a=o.a.useContext(j).getLang;return o.a.createElement(Oa.default,{onClose:t,title:a("calls_translation_stop_confirmation"),appearance:"blue",actionButtons:n,className:"TranslationStopModal"},o.a.createElement("div",{className:"TranslationStopModal__text"},a("calls_translation_stop_sure")))},Po=function(){var e=Object(l.useDispatch)(),t=o.a.useContext(j).getLang,n=Object(l.useSelector)((function(e){return e})),a=Object(r.useCallback)((function(){e({type:c.TOGGLE_POPUP})}),[]);return o.a.createElement(To,{onClose:a,actionButtons:[o.a.createElement(Bn.default,{onClick:a,appearance:"secondary",key:"cancel"},t("calls_cancel")),o.a.createElement(Bn.default,{onClick:function(){Object(xt.stopStream)().then((function(){e({type:c.TOGGLE_POPUP})})).catch((function(e){console.error("stopStream",e)})).finally((function(){if(n.forceStopVideoStream){var e=n.translation,t=e.ownerId,a=e.videoId;if(t&&a){var r={video_id:a};t<0?r.group_id=-t:r.owner_id=t,function(e){return Object(lr.getApiWrapper)()(rr.api)("video.stopStreaming",{group_id:e.group_id,owner_id:e.owner_id,video_id:e.video_id,extended:e.extended})}(r).then((function(){})).catch((function(e){console.error("stopStream",e)}))}}}))},key:"stop"},t("calls_translation_stop"))]})},wo=function(e){var t=e.link,n=o.a.useContext(j).getLang,a=Object(r.useState)(!1),i=a[0],l=a[1],c=Object(r.useCallback)((function(){return l(!0)}),[]),s=Object(r.useCallback)((function(){return l(!1)}),[]);return o.a.createElement("div",{className:"TranslationLink"},o.a.createElement("p",{className:"TranslationLink__info"},n("calls_translation_link_info")),o.a.createElement(ka.default,{readOnly:"readonly",className:"TranslationLink__input",value:t}),o.a.createElement(Da,{text:t,onCopyDone:c},o.a.createElement(Bn.default,null,n("calls_translation_link_copy"))),o.a.createElement(Ma.default,{className:"TranslationLink__copied",shown:i,callback:s},n("calls_translation_link_copied")))},Do=function(e){var t=e.onBack,n=e.link,a=Object(l.useDispatch)(),i=o.a.useContext(j).getLang,s=Object(r.useCallback)((function(){a({type:c.TOGGLE_POPUP})}),[]);return o.a.createElement(xn,{title:i("calls_translation_link"),onCloseModal:s,isWithBackButton:!!t,onBackClick:t},o.a.createElement(wo,{link:n}))},Lo=function(e){var t=e.onClose,n=e.actionButtons,a=e.title,r=e.description;return o.a.createElement(Oa.default,{className:"AdminPinUnmuteRequestModal",appearance:"blue",title:a,actionButtons:n,onClose:t},o.a.createElement("div",{className:"AdminPinUnmuteRequestModal__content"},r))},Mo=function(e){var t=e.SDK,n=Object(l.useDispatch)(),a=o.a.useContext(j).getLang,r=Object(l.useSelector)((function(e){return e})),i=r.participants[r.me].mediaSettings||{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},s=function(){n({type:c.TOGGLE_POPUP})};return o.a.createElement(Lo,{onClose:s,title:a("calls_admin_pin_dialog_title"),description:a("calls_admin_pin_dialog_description"),actionButtons:[o.a.createElement(Bn.default,{onClick:s,appearance:"secondary",key:"cancel"},a("calls_admin_pin_dialog_cancel")),o.a.createElement(Bn.default,{onClick:function(){(i.isAudioEnabled?Promise.resolve():z(t,!1,!0)).then((function(){var e;(null===(e=r.notification)||void 0===e?void 0:e.type)===c.NotificationType.SPEAKING_ON_MUTE&&n({type:c.CALL_NOTIFICATION,notification:null}),t.toggleLocalAudio(!0).catch(console.log)})).then((function(){return s()}))},key:"mic"},a("calls_admin_pin_dialog_action"))]})},Ro=function(e){var t=e.participants,n=e.selected,a=e.onSelect,i=e.onClose,c=e.onCallForceFinish,s=e.onRightsTransfer,u=e.onSearch,A=Object(r.useContext)(j).getLang,d=Object(l.useSelector)((function(e){return e.me}));return o.a.createElement(B.default,{className:"TransferAdminRightsModal",disableBodyScroll:!1,onClose:i},o.a.createElement(Un.ModalHeader,{title:A("calls_dialog_creator_exit_title"),onClose:i,appearance:"blue"}),o.a.createElement("div",{className:"TransferAdminRightsModal__content"},o.a.createElement(ka.default,{onChange:function(e){return u(e.target.value)},placeholder:A("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"}),o.a.createElement(Ia.default,{border:!1},o.a.createElement(Qn,{extra:t.length},A("calls_call_participants")),0===t.filter((function(e){return e.peerId!==d})).length&&o.a.createElement(Ie.default,null,A("calls_participants_not_found")),t.filter((function(e){return e.peerId!==d})).map((function(e){return o.a.createElement(Wn.default,{key:e.peerId,className:"TransferAdminRightsModal__item",onClick:function(){return a(e)},aside:o.a.createElement("span",{className:"TransferAdminRightsModal__label","aria-selected":n===e.peerId},n===e.peerId?A("calls_dialog_creator_exit_selected"):A("calls_dialog_creator_exit_select"))},o.a.createElement(zn.default,{size:"34",title:e.name,photo:e.photo}))})))),o.a.createElement(Gn.ModalFooter,{actionButtons:[o.a.createElement(Bn.default,{key:"force",appearance:"secondary",onClick:c},A("calls_force_call_finish")),o.a.createElement(Bn.default,{key:"action",onClick:s,disabled:!n},A("calls_dialog_creator_exit_action"))]}))},jo=function(e){var t=e.SDK,n=Object(l.useDispatch)(),a=Object(l.useSelector)((function(e){return e})),i=o.a.useContext(j).getLang,s=Object(r.useState)(Object.values(a.participants).filter((function(e){return e.peerId===a.me||e.status===c.CallStatus.CONNECTED&&!Ht(e.peerId)}))),u=s[0],A=s[1],d=Object(r.useState)(null),p=d[0],m=d[1],f=Object(r.useCallback)((function(e){return e.name}),[]),_=Object(r.useCallback)((function(e){return e.peerId}),[]),E=G(u,f,_),h=function(){return K.logEvent({call_event_type:c.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:Q(a.peer),reason:"none",group_call_users_count:Kt(a)})},v=Object(r.useCallback)((function(e){A(e?E.search(e):E.list),m(null)}),[a]),g=function(){n({type:c.TOGGLE_POPUP})},O=Object(r.useCallback)((function(e){m(e.peerId)}),[]);return Object(r.useEffect)((function(){p&&!u.find((function(e){return e.peerId===p}))&&m(null)}),[p]),o.a.createElement(Ro,{participants:u,onClose:g,onSelect:O,selected:p,onCallForceFinish:function(){n({type:c.TOGGLE_POPUP}),h(),t.hangup(),Tr(0,a,n,i)},onRightsTransfer:function(){if(p){var e=Vt(a.participants[p]);e&&(t.grantRoles(e,[c.UserRole.ADMIN],!1).then((function(){return n({type:c.TOGGLE_POPUP}),h(),void t.hangup().catch(console.log)})).catch(console.log),g())}},onSearch:v})};function ko(){return(ko=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Bo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Uo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Go(e){var t=e.SDK,n=e.bridge,a=e.onBeforeCallStart,o=e.onAfterCallFinish,i=e.tabIsMaster,s=e.navigateToConvo,u=e.callSounds,A=e.navigateToProfile,d=e.okPublicKey,p=Object(l.useSelector)(e=>e),m=Object(l.useDispatch)(),f=r.useRef(p),_=r.useCallback(()=>{m({type:c.CHANGE_MODE,mode:c.Mode.READY})},[]),E=Bo(r.useState(null),2),h=E[0],v=E[1];return r.useEffect(()=>{f.current=p},[p]),r.useEffect(()=>{if(p.mode===c.Mode.CALL)return mo(),()=>{fo()}},[p.mode]),function(e,t,n,a){void 0===a&&(a=[]);var o=window.document,i=o.documentElement,l=i.requestFullscreen||i.webkitRequestFullscreen;if(l){var c=!i.requestFullscreen,s=c?o.webkitExitFullscreen:o.exitFullscreen,u=c?"webkitfullscreenchange":"fullscreenchange",A=c?"webkitFullscreenElement":"fullscreenElement";Object(r.useEffect)((function(){var e=function(){o.fullscreenElement?t&&t():n&&n()};return o.addEventListener(u,e),function(){return o.removeEventListener(u,e)}}),[]),Object(r.useEffect)((function(){e&&!o[A]?l.call(o.documentElement):!e&&o[A]&&s.call(o)}),a)}}(p.uiMode===c.UIMode.FULLSCREEN&&p.mode===c.Mode.CALL,()=>{window.FastChat&&(v(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0))},()=>{f.current.uiMode===c.UIMode.FULLSCREEN&&m({type:c.CHANGE_UI_MODE,mode:c.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(h),v(null))},[p.uiMode,p.mode]),Zr(t,p),r.createElement(Sa,{SDK:t,mode:p.mode,onReset:()=>m({type:c.CHANGE_MODE,mode:c.Mode.READY})},i()&&r.createElement(kn,{onBeforeCallStart:a,onAfterCallFinish:o,callSounds:u}),p.mode===c.Mode.CALL&&p.uiMode!==c.UIMode.COLLAPSED&&r.createElement(Tn,{SDK:t,navigateToConvo:s,navigateToProfile:A}),p.mode===c.Mode.INCOMING&&p.uiMode!==c.UIMode.COLLAPSED&&r.createElement(J,{SDK:t}),p.mode!==c.Mode.READY&&p.uiMode===c.UIMode.COLLAPSED&&r.createElement(Rn,{SDK:t}),p.mode===c.Mode.JOIN&&r.createElement(Gr,ko({},p.join,{bridge:n,withPopup:!0,onClose:_,onError:e=>{m({type:c.ERROR,text:e})},okPublicKey:d})),p.errorShown&&r.createElement(Wr,{title:p.error.title,text:p.error.text,handleType:p.error.handleType,callId:p.error.callId,bridge:n,onCloseFatal:_}),p.cautionShown&&r.createElement(qr,{isIncoming:p.isIncoming}),p.groupCallSetup&&r.createElement(ca,{SDK:t}),p.isManagementOpen&&r.createElement(Pr,{SDK:t,navigateToProfile:A,navigateToConvo:s}),p.popup===c.POPUP_SETTINGS&&r.createElement(ya,{SDK:t}),p.popup===c.POPUP_TRANSLATION&&r.createElement(Fo,null),p.popup===c.POPUP_TRANSLATION_STOP&&r.createElement(Po,null),p.popup===c.POPUP_TRANSLATION_SHARE&&r.createElement(Do,{link:p.translation.link}),p.popup===c.POPUP_EXIT&&r.createElement(Yr,{SDK:t}),p.popup===c.POPUP_TRANSFER_ADMIN_RIGHTS&&r.createElement(jo,{SDK:t}),p.popup===c.POPUP_UNMUTE_REQUEST&&r.createElement(ao,{SDK:t}),p.popup===c.POPUP_ADMIN_PIN_UNMUTE_REQUEST&&r.createElement(Mo,{SDK:t}),p.participantsManagement&&r.createElement(to,{SDK:t}),p.adminAssignment&&r.createElement(io,{SDK:t}),p.isLoaderVisible&&r.createElement(lo.default,null))}n("OEbY");var xo=function(){return(xo=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ho={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function Vo(e){switch(e){case c.CallStatus.WAITING:return 1;case c.CallStatus.CONNECTING:return 2;case c.CallStatus.CONNECTED:return 3;default:return 0}}var Qo=function(){return Ho},Wo=function(e){var t,n;Ho=xo(xo(xo({},Ho),e),{connectionStep:(t=e.connectionStep,n=Ho.connectionStep,t&&Vo(t)&&Vo(t)>Vo(n)?t:n)})},zo=function(){Ho={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}};function Yo(){return(Yo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ko(e,t,n,a){var r=n.reduce((n,r)=>{switch(r.type){case c.INCOMING_CALL:if(!Zo(e,r,a)){n.push(Promise.resolve());break}var o=me(r),i=(u=r.payload,A=u.caller_info,d=A.first_name+" "+A.last_name,{peerId:+A.user_id,name:d,tab:d,photo:A.photo_400,firstName:A.first_name,lastName:A.last_name,shortName:ue(A.first_name,A.last_name,d)});if(o){var l=function(e){var t=e.chat_info;return{peerId:2e9+t.chat_id,tab:t.title,name:t.title,photo:t.photo_400}}(r.payload);t({type:c.LOAD_PEERS,conversation:l,members:[i],peerId:l.peerId}),l.photo&&n.push(_r(l.photo));var s=function(e,t,n){return Ar(n).then((function(e){var n=de(e),a=n[0],r=n[1],o=n[2];Ir(t,o),Er([a,r]).catch(console.error),t({type:c.LOAD_PEERS,conversation:a,members:r})}))}(0,t,l.peerId);n.push(s)}else t({type:c.LOAD_PEERS,conversation:i,members:[i],peerId:i.peerId});i.photo&&n.push(_r(i.photo))}var u,A,d;return n},[]);return Promise.all(r)}function Zo(e,t,n){return function(e){return!!e.payload.call_id}(t)&&e.mode!==c.Mode.INCOMING&&e.mode!==c.Mode.CALL&&n()}function Xo(e){var t=e.onVolumeLevelReached,n=e.needCheckMicEnabled,a=e.vectorLength,r=e.volumeLevelDetection,o=e.callbackFactorStep,i=e.sensitivityCoefficient,l=e.onVolumeLevelUpdated,c=e.debugCallback,s=function(e){var t=[],n=0;return function(a){if(t.push(a),n+=a,t.length>e){var r=t.shift();n-=r||0}return n/t.length}}(a),u=0,A=!1;return function(){for(var e=[],a=0;a<arguments.length;a++)e[a]=arguments[a];c&&c(e);var d=e[0],p=e[1],m=d>r;A!==m&&l&&l(m),A=m,0!==u&&p&&(u=0);var f=s(d);n&&p||d/f>(1+u)/i&&d>r&&(u+=o,t())}}function Jo(e,t){var n=Object.keys(e),a=Object.keys(t);return n.length===a.length&&n.every((function(e){return t[e]}))}function qo(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}var $o;function ei(e){s.localStorage.setItem("calls_token",e)}function ti(){return s.localStorage.getItem("calls_token")}function ni(e){var t=ti();return t?Promise.resolve(t):dr(e).then(e=>e.token)}function ai(e){$o=e}function ri(e,t,n,a){var r,o,i,l=Qo(),s=l.startType,u=l.entryPoint,A=l.timeStart,d=l.isGroupCall,p=l.hadVideoEnabled,m=l.isOutgoingCall,f=!e||e===c.HANGUP_TYPE_HUNGUP&&!n,_={type:s&&function(e,t,n){var a;a=e===c.CallType.VIDEO?t?c.CallStatReachedType.GROUP_VIDEO:c.CallStatReachedType.VIDEO:n?t?c.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:c.CallStatReachedType.AUDIO_TO_VIDEO:t?c.CallStatReachedType.GROUP_AUDIO:c.CallStatReachedType.AUDIO;return a}(s,d,p),result:f?c.CallStatResult.SUCCESS:c.CallStatResult.FAIL,failReason:f?null:oi(e,n),callSource:u,totalDuration:A?Date.now()-A:0};m&&(a&&console.log(_),r=t,i=[(o=_).type||"",o.result,o.failReason||"",o.callSource||"",o.totalDuration],$o&&$o({name:"call_stats",value:r,keys:i}))}function oi(e,t){var n=Qo().isOutgoingCall,a=Qo().connectionStep;switch(!0){case t:return c.CallStatFailReason.CONNECTION_LOST;case e===c.HANGUP_TYPE_CANCELED:return c.CallStatFailReason.LOCAL_DECLINE;case e===c.HANGUP_TYPE_REJECTED:return c.CallStatFailReason.REMOTE_DECLINE;case e===c.HANGUP_TYPE_BUSY:return c.CallStatFailReason.REMOTE_BUSY;case e===c.HANGUP_TYPE_MISSED:return n?c.CallStatFailReason.REMOTE_TIMEOUT:null;case a===c.CallStatus.CONNECTING:return c.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!a:return c.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}function ii(e,t){return"/video"+e+"_"+t}var li=function(){return(li=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ci=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,l=o.length;i<l;i++,r++)a[r]=o[i];return a};function si(e,t,n,a,r,o){var i,l,u,A,d,p,m,f,_=a.dispatch,E=a.getState(),h=E.me,v=c.BAD_CONNECTION_DISABLED_CAMERA_LEVEL,g=!1,O=ve(pi,ge.bind(null,Ai.bind(null,t,e,a))),C=ve(t.joinCallByLink,ge.bind(null,Ai.bind(null,t,e,a))),b={apiKey:n.key,apiEnv:n.is_dev?"VIDEOTEST":"PROD",anonymToken:n.is_anonym?n.token:"",voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},directAudioOutput:"AudioElementMix",allowMissingMic:!0,domain:o?"vk_corp":void 0,onLocalStream:function(t,n){e.debug&&console.warn("onLocalStream",t,n),yn(_,h,{stream:t,mediaSettings:n}),Wo({hadVideoEnabled:n.isVideoEnabled})},onLocalStreamUpdate:function(t,n){e.debug&&console.warn("onLocalStreamUpdate",t,n);var r=a.getState(),o=r.participants[h],i=o.mediaSettings,l=o.permissions;yn(_,h,{mediaSettings:t,permissions:{audio:(null==i?void 0:i.isAudioEnabled)&&!t.isAudioEnabled?Math.max(l.audio-1,c.MediaPermissionType.DENY):l.audio,video:(null==i?void 0:i.isVideoEnabled)&&!t.isVideoEnabled?Math.max(l.video-1,c.MediaPermissionType.DENY):l.video,screenSharing:(null==i?void 0:i.isScreenSharingEnabled)&&!t.isScreenSharingEnabled?Math.max(l.screenSharing-1,c.MediaPermissionType.DENY):l.screenSharing}}),t.isScreenSharingEnabled!==(null==i?void 0:i.isScreenSharingEnabled)&&hi(r,_,t.isScreenSharingEnabled,h),Wo({hadVideoEnabled:t.isVideoEnabled})},onRemoteStream:function(t,n){e.debug&&console.warn("onRemoteStream",t.id,n),yn(_,t.id,{stream:n})},onConversation:function(t){if(e.debug&&console.warn("onConversation",t),!a.getState().callData.ts){var n=Date.now();_({type:c.TIME_START,data:n})}var r=a.getState().peer;0!==r&&Cr(0,_,r)},onRemoteMediaSettings:function(t,n){var r,o;e.debug&&console.warn("onRemoteMediaSettings",t.id,n);var i=+t.id,l=a.getState(),c=null===(o=null===(r=l.participants[i])||void 0===r?void 0:r.mediaSettings)||void 0===o?void 0:o.isScreenSharingEnabled;n.isScreenSharingEnabled!==c&&hi(l,_,n.isScreenSharingEnabled,i,!0),yn(_,i,{mediaSettings:n}),Wo({hadVideoEnabled:n.isVideoEnabled})},onParticipantStatus:function(t,n,r){var o=+t.id,i=a.getState(),l=n;if(e.debug&&console.warn("onParticipantStatus",o,l,r),!i.participants[o]||!i.participants[o].mediaSettings){_({type:c.LOAD_PEERS,members:[{peerId:o,mediaSettings:{isAudioEnabled:!1,isVideoEnabled:!1,isScreenSharingEnabled:!1},isAnonym:"ANONYM"===t.type}]});var s=[o],u=i.callData.callId||"",A={withConversation:!a.getState().callData.conversation,awaitImages:!0};!function(e,t,n,a,r){var o;(o=yr.acc).push.apply(o,a),yr.timer&&clearTimeout(yr.timer),yr.timer=window.setTimeout((function(){var a=yr.acc;yr.acc=[],Sr(e,t,n,a,r).catch((function(e){console.error(e)}))}),yr.timeout)}(i,_,u,s,A)}yn(_,o,{status:l,statusData:r}),Wo({connectionStep:l}),o===i.peer&&l===c.CallStatus.CONNECTED&&K.logEvent({call_event_type:c.CallActionEventType.CALL_CONNECTED,session_id:i.callData.callId,peer_id:i.peer,is_group_call:!1})},onPermissionsError:function(n){if(e.debug&&console.warn("onPermissionsError",n),a.getState().mode===c.Mode.CALL){switch(n){case c.MediaError.CAMERA_PERMISSION:case c.MediaError.CAMERA_ACCESS:t.toggleLocalVideo(!1);break;case c.MediaError.MIC_ACCESS:case c.MediaError.MIC_NOT_FOUND:t.toggleLocalAudio(!1);break;case c.MediaError.SCREEN_PERMISSION:case c.MediaError.SCREEN_ACCESS:t.captureScreen(!1)}_({type:c.ERROR,text:X(n,r)})}},onPermissionsRequested:function(){e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:function(t){e.debug&&console.warn("onRemoteRemoved",t.id),_({type:c.REMOVE_USER,participantId:+t.id})},onCallState:function(t,n,r){e.debug&&console.warn("onCallState",t,n,r);var o=r.id,i=r.direction;if(!o||!a.getState().callData.callId){if(_({type:c.CALL_STATE,callData:{callId:o}}),!a.getState().peer){var l=Object.keys(a.getState().participants||{}).map((function(e){return Number(e)}));l.length&&Sr(E,_,o,l,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!0})}!Q(a.getState().peer||0)||"JOINING"!==i&&"OUTGOING"!==i||K.logEvent({call_event_type:c.CallActionEventType.CALL_CONNECTED,session_id:o,peer_id:a.getState().peer||0,is_group_call:!0})}},onRateNeeded:function(){e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:function(t){var n=t.id;e.debug&&console.warn("onSpeakerChanged",n),_({type:c.SET_ORATOR,orator:+n})},onJoinStatus:function(t,n){e.debug&&console.warn("onJoinStatus",t,n)},onHangup:function(t,n){var r=t.hangup;e.debug&&console.warn("onHangup",r,n);var o=r&&![c.HANGUP_TYPE_CANCELED,c.HANGUP_TYPE_MISSED,c.HANGUP_TYPE_HUNGUP,c.HANGUP_TYPE_REMOVED].includes(r);a.getState().mode===c.Mode.CALL&&o?(_({type:c.HANGUP,data:r}),q(c.HANGUP_DELAY,null).finally((function(){_({type:c.CHANGE_MODE,mode:c.Mode.READY})}))):_({type:c.CHANGE_MODE,mode:c.Mode.READY}),e.isInActiveCall=!1,ri(r,n=n||"",function(e){return!!Object.values(e.participants).find(e=>e.status===c.CallStatus.RECONNECT)}(a.getState()),e.debug),zo()},onCallAccepted:function(){e.debug&&console.warn("onCallAccepted"),Q(a.getState().peer)&&K.logEvent({call_event_type:c.CallActionEventType.CALL_CONNECTED,session_id:a.getState().callData.callId,peer_id:a.getState().peer,is_group_call:Q(a.getState().peer)})},onTokenExpired:function(){e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(Ai(t,e,a),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:function(){e.debug&&console.warn("onDeviceChange")},onMultipartyChatCreated:function(){e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:function(t){e.debug&&console.warn("onFingerprintChange",t)},onVolumesDetected:(i={onUpdate:function(e){_({type:c.SET_SPEAKERS,data:e})},volumeLevelDetection:c.VOLUME_LEVEL_DETECTION,debugCallback:function(){e.debug}},l=i.onUpdate,u=i.volumeLevelDetection,A=i.debugCallback,d={},p=[],m={},f=[],function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];A&&A(e);var n=e[0];m=Object.keys(m).reduce((function(e,t){return m[t]-1>0&&(e[t]=m[t]-1),e}),{});var a=n.reduce((function(e,t){var n=t.uid.id;return t.volume>u&&(e[n]=!0,m[n]=3),e}),{});f=Object.keys(m);var r=!1,o={speakers:null,speakersInHeader:null};Jo(d,a)||(o.speakers=a,d=a,r=!0),qo(p,f)||(o.speakersInHeader=f,p=f,r=!0),r&&l(o)}),onLocalVolume:Xo({onVolumeLevelReached:function(){var e=a.getState();_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.SPEAKING_ON_MUTE}}),K.logEvent({call_event_type:c.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:Q(e.peer)})},onVolumeLevelUpdated:function(e){var t,n=null===(t=a.getState().participants[h].mediaSettings)||void 0===t?void 0:t.isAudioEnabled,r=a.getState().speakers,o=Object.assign({},r);e&&n?o[h]=!0:e||delete o[h],o[h]!==r[h]&&_({type:c.SET_SPEAKERS,data:{speakers:o}})},needCheckMicEnabled:!0,volumeLevelDetection:c.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:function(){e.debug}}),onChatMessage:function(t,n,a){e.debug&&console.warn("onChatMessage",t,n,a)},onCustomData:function(t,n){e.debug&&console.warn("onCustomData",t,n)},onNetworkStatus:function(n){var r=a.getState();if(e.debug&&console.warn("onNetworkStatus",n),!n){var o=a.getState().participants[h].mediaSettings,i=!!(null==o?void 0:o.isScreenSharingEnabled),l=!!(null==o?void 0:o.isVideoEnabled);g||!l||i||v--,v>0||g||i||!l?_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.BAD_NETWORK_CONNECTION}}):(g=!0,t.toggleLocalVideo(!1).catch(console.error),_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA}}),K.logEvent({call_event_type:c.CallActionEventType.VIDEO_DISABLED,session_id:r.callData.callId,peer_id:r.peer,is_group_call:Q(r.peer),reason:"lowBandwidth"}),K.logEvent({call_event_type:c.CallActionEventType.VIDEO_DISABLED_DUE_TO_BAD_CONNECTION_ALERT,session_id:r.callData.callId,peer_id:r.peer,is_group_call:Q(r.peer)}))}},onDebugMessage:function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];e.debug&&console.warn.apply(console,ci(["onDebugMessage",t],n))},onRemoteParticipantState:function(t,n){var r,o,i;e.debug&&console.warn("onRemoteParticipantState",t,n);var l=function(e){return e.hand?li(li({},e),{hand:e.hand===c.SdkHandType.RAISED}):e}(n),s=t.id,u=!!(null===(o=null===(r=a.getState().participants[s])||void 0===r?void 0:r.statusData)||void 0===o?void 0:o.hand),A=!!(null===(i=a.getState().participants[s])||void 0===i?void 0:i.name);yn(_,s,{statusData:l}),(null==l?void 0:l.hand)&&!u&&A&&_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.RAISED_HAND,data:s}})},onRolesChanged:function(t,n){e.debug&&console.warn("onRolesChanged",t,n);var r=a.getState().participants[t.id];n.includes(c.UserRole.ADMIN)&&r&&_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE,data:t.id}}),yn(_,t.id,{roles:n})},onLocalRolesChanged:function(t){e.debug&&console.warn("onLocalRolesChanged",t),(t.includes(c.UserRole.ADMIN)||t.includes(c.UserRole.CREATOR))&&yn(_,h,{permissions:{audio:c.MediaPermissionType.ALLOW,video:c.MediaPermissionType.ALLOW,screenSharing:c.MediaPermissionType.ALLOW}}),yn(_,h,{permissions:{audio:c.MediaPermissionType.ALLOW,video:c.MediaPermissionType.ALLOW,screenSharing:c.MediaPermissionType.ALLOW}}),t.includes(c.UserRole.ADMIN)&&_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.ADMIN_ROLE_GRANTED}}),_({type:c.CHANGE_PARTICIPANT_ROLES,participantId:h,data:t})},onDeviceSwitched:function(t,n){e.debug&&console.warn("onDeviceSwitched",t,n)},onUnmutePermission:function(t){e.debug&&console.warn("onUnmutePermission",t);var n=a.getState(),r=n.participants[h],o=n.popup;if(t||o!==c.POPUP_UNMUTE_REQUEST||_({type:c.TOGGLE_POPUP}),!$t(r)&&!en(r)){var i=r.permissions,l=i.audio,s=i.video,u=i.screenSharing;l===c.MediaPermissionType.DENY&&s===c.MediaPermissionType.DENY&&u===c.MediaPermissionType.DENY||_({type:c.CALL_NOTIFICATION,notification:{type:t?c.NotificationType.ADMIN_MUTE:c.NotificationType.ADMIN_MUTE_PERMANENT}}),yn(_,h,{permissions:{audio:t?c.MediaPermissionType.ALLOW:c.MediaPermissionType.DENY,video:t?c.MediaPermissionType.ALLOW:c.MediaPermissionType.DENY,screenSharing:t?c.MediaPermissionType.ALLOW:c.MediaPermissionType.DENY}})}},onUnmuteRequest:function(n){var r;if(e.debug&&console.warn("onUnmuteRequest",n),n!==c.MediaOption.VIDEO){var o=a.getState(),i=o.participants[o.me],l=i.permissions,s=l.audio,u=l.video,A=l.screenSharing,d=s===c.MediaPermissionType.DENY&&u===c.MediaPermissionType.DENY&&A===c.MediaPermissionType.DENY,p=!!(null===(r=i.statusData)||void 0===r?void 0:r.hand);p&&t.changeParticipantState({hand:c.SdkHandType.LOWERED}).catch(console.log),yn(_,h,li({permissions:{audio:d?c.MediaPermissionType.ONCE:s,video:d?c.MediaPermissionType.ONCE:u,screenSharing:d?c.MediaPermissionType.ONCE:A}},p&&{statusData:li(li({},i.statusData),{hand:!1})})),_({type:c.TOGGLE_POPUP,data:c.POPUP_UNMUTE_REQUEST})}},onRecordStarted:function(t,n,a,r,o,i){e.debug&&console.warn("onRecordStarted",t,n,a,r),_({type:c.SET_TRANSLATION,data:{isOn:!0,videoId:parseInt(o),ownerId:parseInt(i),host:t,startTime:a,link:""+window.location.host+ii(i,o)}})},onRecordStopped:function(){e.debug&&console.warn("onRecordStopped"),_({type:c.SET_TRANSLATION,data:{isOn:!1,hasPermission:!1}})},onLocalPin:function(t){var n;e.debug&&console.warn("onLocalPin",{unpin:t});var r=a.getState(),o=r.participants[h];t||_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.PINNED_BY_ADMIN}});var i=o.permissions,l=i.audio,s=i.video,u=i.screenSharing;!t&&[l,s,u].some((function(e){return e===c.MediaPermissionType.DENY}))&&yn(_,h,{permissions:{audio:c.MediaPermissionType.ONCE,video:c.MediaPermissionType.ONCE,screenSharing:c.MediaPermissionType.ONCE}}),t||(null===(n=o.mediaSettings)||void 0===n?void 0:n.isAudioEnabled)||_({type:c.TOGGLE_POPUP,data:c.POPUP_ADMIN_PIN_UNMUTE_REQUEST}),t||r.isOratorMode||_({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0}),_({type:c.SET_ADMIN_PINNED_PARTICIPANT,data:t?null:h})},onPinnedParticipant:function(t,n){e.debug&&console.warn("onPinnedParticipant",t,n);var r=a.getState(),o=r.participants[t.id];!n&&o&&((null==o?void 0:o.shortName)||(null==o?void 0:o.name))&&_({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.USER_PINNED_BY_ADMIN,data:t.id}}),r.isOratorMode||_({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0}),_({type:c.SET_ADMIN_PINNED_PARTICIPANT,data:n?null:Number(t.id)})}};e.authorized=!1,e.call=function(e,t,n,a,r){var o=a.dispatch;return function(i,l,s,u){return e.isInActiveCall?Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(ui):(e.isInActiveCall=!0,Promise.resolve().then((function(){return di(e,o)})).then((function(){return z(t,l)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return mi(a,i,s)})).then((function(e){return Promise.all([Er(e),r(t,a.getState(),l,i)])})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL,peerId:i}),Wo({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:u,startType:l?c.CallType.VIDEO:c.CallType.AUDIO}),K.logEvent({call_event_type:l?c.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:c.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:i,is_group_call:!1,source:u,group_call_users_count:2}),fi(a,i,s)})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),Ei(a,t,e,Q(i),l,n,o)})))}}(e,t,r,a,O),e.startGroupCall=function(e,t,n,a,r){var o=a.dispatch;return function(i,l,s,u,A){var d=s?s.filter(H):[];return e.debug&&s&&s.length!==d.length&&console.warn("Some ids cannot get into the call.",s.filter((function(e){return!H(e)}))),e.isInActiveCall?Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(ui):(e.isInActiveCall=!0,Promise.resolve().then((function(){return di(e,o)})).then((function(){return z(t,u)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return mi(a,i,l)})).then((function(e){return Promise.all([gr(a.getState(),o,i,e[0]),vr(a.getState(),o)])})).then((function(){return r(t,a.getState(),u,i)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL,peerId:i}),d&&d.length?o({type:c.GROUP_CALL_SETUP,open:!0,peerId:i,preselectedIds:d}):o({type:c.MANAGEMENT,isOpen:!0}),fi(a,i,l),Wo({timeStart:Date.now(),isOutgoingCall:!0,startType:u?c.CallType.VIDEO:c.CallType.AUDIO,entryPoint:A,isGroupCall:!0}),K.logEvent({call_event_type:u?c.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:c.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:i,is_group_call:!0,source:A,group_call_users_count:1})})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),Ei(a,t,e,Q(i),u,n,o)})))}}(e,t,r,a,O),e.startCall=function(e,t,n,a,r){var o=a.dispatch;return function(i,l){if(e.isInActiveCall)return Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(ui);e.isInActiveCall=!0;var s={peerId:0,canAddMembers:!0,tab:n("calls_new_call_title"),photo:"/images/call_convo_stub.png"};return Promise.resolve().then((function(){return di(e,o)})).then((function(){return z(t,i)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return Promise.all([r(t,a.getState(),i),Er([s])])})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.LOAD_PEERS,conversation:s,members:[],peerId:0}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL}),o({type:c.MANAGEMENT,isOpen:!0}),Wo({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:l,startType:i?c.CallType.VIDEO:c.CallType.AUDIO,isGroupCall:!0}),K.logEvent({call_event_type:i?c.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:c.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:a.getState().callData.callId,peer_id:0,is_group_call:!0,source:l,group_call_users_count:1})})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),Ei(a,t,e,!0,i,n,o)}))}}(e,t,r,a,O),e.joinCallByLink=function(e,t,n,a,r){var o=a.dispatch;return function(i,l,s,u){return void 0===s&&(s=!1),e.isInActiveCall?Promise.reject(c.CallErrorType.ALREADY_IN_CALL).catch(ui):(e.isInActiveCall=!0,Ht(a.getState().me)?Promise.resolve().then((function(){return di(e,o)})).then((function(){return z(t,s)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return r(i,s).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL})}))})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),Ei(a,t,e,Q(0),s,n,o)})):Promise.resolve().then((function(){return di(e,o)})).then((function(){return z(t,s)})).then((function(){o({type:c.SHOW_LOADER,isLoaderVisible:!0})})).then((function(){return r(i,s).then((function(e){var t,n=e.id;return(t=[n],Object(lr.getApiWrapper)()(rr.api)("messages.getConversationsByCall",{call_ids:t,fields:sr})).then((function(e){var t=e.items[0].peer.id;return mi(a,t,l).then((function(e){return Er(e)})).then((function(){return t}))}))}))})).then((function(e){o({type:c.SHOW_LOADER,isLoaderVisible:!1}),o({type:c.CHANGE_MODE,mode:c.Mode.CALL,peerId:e}),fi(a,e,l),K.logEvent({call_event_type:c.CallActionEventType.GROUP_CALL_JOINED,session_id:a.getState().callData.callId,peer_id:e,is_group_call:!0,source:u,group_call_users_count:fe(a.getState()).length})})).catch((function(a){e.isInActiveCall=!1,o({type:c.SHOW_LOADER,isLoaderVisible:!1}),Ei(a,t,e,Q(0),s,n,o)})))}}(e,t,r,a,C),e.showJoinPopup=function(e,t,n){var a=n.dispatch;return function(e,r){var o=n.getState().mode;return o===c.Mode.CALL||o===c.Mode.INCOMING?Promise.reject().catch((function(){a({type:c.ERROR,text:t("calls_already_in_call_error")})})):(a({type:c.SHOW_LOADER,isLoaderVisible:!0}),pr(e).then(be.bind(null,t)).then((function(e){a({type:c.SHOW_LOADER,isLoaderVisible:!1}),a({type:c.JOIN,data:li(li({},e),{entryPoint:r})})})).catch((function(){a({type:c.SHOW_LOADER,isLoaderVisible:!1}),a({type:c.ERROR,text:t("calls_join_error_text"),handleType:c.ErrorHandleType.FATAL})})))}}(0,r,a);var y=n.token?Promise.resolve(n.token):ni(n.is_dev),S=function(n){return Promise.resolve().then((function(){return Ht(a.getState().me)?Promise.resolve():t.authorize(n).then((function(){return ei(n)})).then((function(){return e.authorized=!0}))})).catch((function(){return s.localStorage.removeItem("calls_token"),ni(a.getState().isDev).then(S)}))};return y.then((function(e){return t.init(b).then((function(){return S(e)}))}))}function ui(e){switch(e){case c.CallErrorType.ALREADY_IN_CALL:console.log("Already in call");break;default:console.log(e)}}function Ai(e,t,n){(function(e,t){var n=ti();return n?e.authorize(n).then((function(){return t.authorized=!0})):Promise.reject()})(e,t).catch((function(){return function(e,t,n){return dr(n.getState().isDev).then((function(n){var a=n.token;return e.authorize(a).then((function(){return ei(a)})).then((function(){return t.authorized=!0}))}))}(e,t,n)})).catch((function(e){return console.log("Could not authorize with token request",e)}))}function di(e,t){var n=window.setTimeout((function(){t({type:c.SHOW_LOADER,isLoaderVisible:!0})}),200);return e.initializing.then((function(){return window.clearTimeout(n),e.authorized||Ht(e.id)?Promise.resolve():Promise.reject(c.CLIENT_ERROR_NOT_AUTHORIZED)}))}function pi(e,t,n,a,r){void 0===a&&(a=0),void 0===r&&(r=[]);var o=function(e,t){return JSON.stringify({is_video:t,chat_id:V(e)?e-2e9:void 0,with_join_link:Q(e),join_by_link:Q(e)})}(a,n);if(!a)return e.call(void 0,n,o,!0);if(!Q(a))return e.call(a.toString(),n,o);var i=r.filter((function(e){return H(e=Number(e))&&e!==t.getState().me}));return e.call(i,n,o,!0)}function mi(e,t,n){var a=e.dispatch;return!!n||t?(n?Promise.resolve(Ae(n)):Ar(t).then(de)).then((function(e){var n=e[0],r=e[1],o=e[2];return Ir(a,o),a({type:c.LOAD_PEERS,conversation:n,members:r,peerId:t}),e})):Promise.reject("Cannot load data")}function fi(e,t,n){var a=e.dispatch;return!!n&&t?Ar(t).then((function(e){var t=de(e),n=t[0],r=t[1];return Ir(a,e.items[0]),Er([n,r])})).then((function(e){var t=e[0],n=e[1];a({type:c.LOAD_PEERS,conversation:t,members:n})})):Promise.resolve()}function _i(e,t,n){switch(!0){case function(e){var t=e||{},n=t.hangup,a=t.message;return n&&a&&n===c.HANGUP_TYPE_EXTERNAL_API_ERROR}(e):return function(e,t,n){var a=le(e.split(" : "),2),r=a[0],o=a[1];if("VCHAT_EXTERNAL_API_ERROR"!==r||!o)return n("calls_sorry_error");switch(+o){case c.SERVER_ERROR_PRIVACY:return n("calls_privacy_error");case c.SERVER_ERROR_BUSY:return n(t?"calls_chat_busy_error":"calls_busy_error");case c.SERVER_ERROR_FLOOD_CONTROL:return n("calls_flood_error");case c.SERVER_ERROR_UNKNOWN:case c.SERVER_ERROR_INVALID_REQUEST:case c.SERVER_ERROR_INTERNAL:case c.SERVER_ERROR_OLD_RECEIVER_APP:default:return n("calls_start_error")}}(e.message,t,n);case function(e){return"number"==typeof e}(e):case function(e){return!!e}(e):default:return n("calls_sorry_error")}}function Ei(e,t,n,a,r,o,i){var l=_i(e,a,o);t.hangup(),n.debug&&e&&console.error(e),i({type:c.ERROR,text:l})}function hi(e,t,n,a,r){0===Object.keys(e.screenSharers).filter((function(t){return e.screenSharers[t]})).length&&n&&(t({type:c.TOGGLE_ORATOR_MODE,isOratorMode:!0}),t({type:c.SET_PINNED_PARTICIPANT,pinnedParticipant:a})),t({type:c.SET_SCREEN_SHARER,participantId:a,isScreenSharingEnabled:n}),n&&r&&t({type:c.CALL_NOTIFICATION,notification:{type:c.NotificationType.SCREEN_SHARING_STARTED,data:a}})}function vi(){return Object(l.useSelector)((function(e){return e})).isLoaderVisible?o.a.createElement(lo.default,null):null}var gi=n("ANjH"),Oi=function(){return(Oi=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ci=function(e,t,n,a){var r,o=a.participantLimit,i=void 0===o?128:o,l=a.callsAdminMode,s=void 0!==l&&l,u=a.callsNoiseCancellation,A=void 0!==u&&u,d=a.translationEnabled,p=void 0!==d&&d,m=a.forceStopVideoStream,f=void 0!==m&&m,_=a.isDev,E=void 0!==_&&_,h=a.token,v=window.vk&&window.vk.id||e.peerId;return{anonymSecret:h,me:v,mode:c.Mode.READY,peer:0,participants:(r={},r[v]=Oi(Oi({},e),{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1},statusData:{hand:!1},roles:[],permissions:{audio:c.MediaPermissionType.ALLOW,video:c.MediaPermissionType.ALLOW,screenSharing:c.MediaPermissionType.ALLOW}}),r),visibleParticipants:{},callData:{type:null,ts:null,conversation:n},imHash:t,participantLimit:i,callsAdminMode:s,callsNoiseCancellation:A,isDev:E,popup:null,uiMode:c.UIMode.DEFAULT,orator:null,adminPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!1,chatMembers:[],preselectedIds:null,friends:[],speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translationEnabled:p,forceStopVideoStream:f,translation:{isOn:!1},participantsManagement:null,adminAssignment:null,noiseCancellation:c.NoiseCancellationTypes.NEURAL}};n("T39b");function bi(){return(bi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function yi(e,t){switch(t.type){case c.LOAD_PEERS:var n=t.conversation||e.callData.conversation,a=t.members;return bi({},e,{participants:bi({},e.participants,{},a.reduce((t,n)=>(n&&n.peerId&&(t[n.peerId]=bi({},e.participants[n.peerId]||{},{},n)),t),{})),callData:bi({},e.callData,{conversation:n}),peer:"peerId"in t?t.peerId:e.peer});case c.CHANGE_MODE:var r=t.mode!==c.Mode.READY&&t.data&&t.data.type?t.data.type:null;if(t.mode===c.Mode.READY){var o=e.callData&&e.callData.conversation;return Ci(e.participants[e.me],e.imHash,o,{participantLimit:e.participantLimit,callsAdminMode:e.callsAdminMode,callsNoiseCancellation:e.callsNoiseCancellation,token:e.anonymSecret,translationEnabled:e.translationEnabled,forceStopVideoStream:e.forceStopVideoStream})}return bi({},e,{mode:t.mode,peer:"peerId"in t?t.peerId:e.peer,callData:bi({},e.callData,{type:r,ts:t.ts||e.callData.ts||null}),hangupType:e.hangupType});case c.HANGUP:return bi({},e,{hangupType:t.data});case c.TIME_START:return bi({},e,{callData:bi({},e.callData,{ts:t.data})});case c.REMOVE_USER:var i=Si(e,t.participantId,{status:void 0,statusData:void 0,wasConnected:void 0});if(e.screenSharers[t.participantId]&&delete i.screenSharers[t.participantId],e.orator===t.participantId&&(i.orator=null),e.pinnedParticipant===t.participantId&&(i.pinnedParticipant=null),e.adminPinnedParticipant===t.participantId&&(i.adminPinnedParticipant=null),e.participantsAddedByMe.has(t.participantId)){var l=new Set(e.participantsAddedByMe);l.delete(t.participantId),i.participantsAddedByMe=l}return i;case c.SET_CHAT_INFO:return bi({},e,{chatMembers:t.data,chatData:t.conversation});case c.GROUP_CALL_SETUP:return bi({},e,{groupCallSetup:t.open,peer:t.peerId||e.peer||0,preselectedIds:t.preselectedIds});case c.TOGGLE_POPUP:return bi({},e,{popup:t.data||null});case c.UPDATE_HASH:return bi({},e,{imHash:t.hash});case c.CHANGE_UI_MODE:return bi({},e,{uiMode:t.mode||c.UIMode.DEFAULT});case c.TOGGLE_ORATOR_MODE:return bi({},e,{isOratorMode:t.isOratorMode});case c.TOGGLE_PARTICIPANTS_ASIDE:return bi({},e,{isShownParticipantsAside:t.isShownParticipantsAside});case c.SET_ORATOR:return bi({},e,{orator:t.orator||null});case c.SET_PINNED_PARTICIPANT:return bi({},e,{pinnedParticipant:t.pinnedParticipant});case c.SET_ADMIN_PINNED_PARTICIPANT:return bi({},e,{adminPinnedParticipant:t.data});case c.MANAGEMENT:return bi({},e,{isManagementOpen:t.isOpen});case c.CALL_STATE:return bi({},e,{callData:bi({},e.callData,{},t.callData)});case c.CALL_NOTIFICATION:return bi({},e,{notification:t.notification});case c.JOIN:return bi({},e,{mode:c.Mode.JOIN,join:t.data});case c.ERROR:return bi({},e,{mode:t.handleType===c.ErrorHandleType.FATAL?c.Mode.ERROR:e.mode,errorShown:!t.isClosed,error:{title:t.title,text:t.text,handleType:t.handleType,callId:t.callId}});case c.CHANGE_PARTICIPANT_STATE:var s=e.participants[t.participantId].statusData;return Si(e,t.participantId,{statusData:bi({},s,{},t.data)});case c.CHANGE_PARTICIPANT_ROLES:return Si(e,t.participantId,{roles:t.data});case c.CHANGE_PARTICIPANT_PERMISSIONS:var u=e.participants[t.participantId];return Si(e,t.participantId,{permissions:bi({},u.permissions,{},t.data)});case c.SET_SCREEN_SHARER:return bi({},e,{screenSharers:bi({},e.screenSharers,{[t.participantId]:t.isScreenSharingEnabled})});case c.SET_FRIENDS:return bi({},e,{friends:t.data});case c.SET_SPEAKERS:var A=t.data,d=A.speakers,p=A.speakersInHeader;return bi({},e,{speakers:d||e.speakers,speakersInHeader:p||e.speakersInHeader});case c.UPDATE_PARTICIPANTS_BATCH:return function(e,t){var n,a=Cn(Cn({},e),{participants:Cn({},e.participants)});for(var r in t)if(t.hasOwnProperty(r))if(void 0===(null===(n=e.participants[r])||void 0===n?void 0:n.status)&&t[r].status===c.CallStatus.HANGUP)delete a.participants[r];else{var o=e.participants[r]||{},i=t[r],l=i.statusData?Cn(Cn({},o.statusData),i.statusData):o.statusData,s=o.wasConnected||i.status===c.CallStatus.CONNECTED;a.participants[r]=Cn(Cn(Cn({},e.participants[r]),t[r]),{statusData:l,wasConnected:s})}return a}(e,t.data);case c.SET_UNREAD_COUNT:return bi({},e,{chatUnreadCount:t.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in t?t.chatUpToMsgId:e.chatUpToMsgId});case c.SHOW_CAUTION_BOX:return bi({},e,{cautionShown:t.isOpen,isIncoming:t.isIncoming});case c.SHOW_LOADER:return bi({},e,{isLoaderVisible:t.isLoaderVisible});case c.SET_TOOLTIP:var m=t.tooltips?t.tooltips:Object.keys(e.tooltips).reduce((e,t)=>(e[t]=!1,e),{});return bi({},e,{tooltips:bi({},e.tooltips,{},m)});case c.MANUAL_ADD_PARTICIPANTS:return bi({},e,{participantsAddedByMe:(t.participants||[]).reduce((e,t)=>e.add(t),new Set(e.participantsAddedByMe))});case c.SET_VISIBLE_PARTICIPANTS:return bi({},e,{visibleParticipants:bi({},e.visibleParticipants,{},t.data)});case c.SET_TRANSLATION:return bi({},e,{translation:bi({},e.translation,{},t.data)});case c.UPDATE_ANON_SECRET:return bi({},e,{anonymSecret:t.secret});case c.TOGGLE_PARTICIPANTS_MANAGEMENT:return bi({},e,{participantsManagement:t.data?{mode:t.data.mode,participant:t.data.participant}:null});case c.TOGGLE_ADMIN_ASSIGNMENT:return bi({},e,{adminAssignment:t.data?{participant:t.data.participant}:null});case c.SET_NOISE_CANCELLATION:return bi({},e,{noiseCancellation:t.data})}return e}function Si(e,t,n){return bi({},e,{participants:bi({},e.participants,{[t]:bi({},e.participants[t],{},n)})})}function Ni(){return(Ni=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ii(e){var t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}var Fi,Ti,Pi,wi,Di,Li,Mi,Ri,ji,ki=n("rFFZ"),Bi=n("Bj12"),Ui=n("FbVm"),Gi=n("6krn"),xi=n("4+be"),Hi=n("P13b");if(!window.Calls){var Vi=new Ui.ActionStatCollector(new Ui.ProductionStatCollector),Qi={getLang:Gi.getLang,langSex:function(e,t,n){return Object(xi.langSex)(e,n)},langNumeric:function(e,t,n,a){return Object(xi.langNumeric)(e,n,a)},langShortDateTime:function(e){return Object(xi.langDate)(e,Object(Gi.getLang)("global_short_date_time",!0),0,Object(Gi.getLang)("months_of"),!0)}};window.Calls=(Fi={apiWrapper:ki.apiWrapper,apiWrapperWithAuth:ki.default,actionStatCollector:Vi,saveStatlogEvents:Bi.saveStatlogEvents,langUtils:Qi,navigateToConvo:function(e){window.nav.go(Object(Hi.getConvoLocation)(e))},callSounds:{end:"/mp3/call_end.mp3",incoming:"/mp3/call_incoming.mp3",outgoing:"/mp3/call_outgoing.mp3",connected:"/mp3/call_connected.mp3",connecting:"/mp3/call_connecting.mp3"},navigateToProfile:function(e,t){e.target.href||(window.Calls.collapseCall(),t&&window.nav.go(t))}},Ti=Fi.actionStatCollector,Pi=Fi.saveStatlogEvents,wi=Fi.langUtils,Di=Fi.navigateToConvo,Li=Fi.navigateToProfile,Mi=Fi.apiWrapperWithAuth,Ri=Fi.apiWrapper,ji=Fi.callSounds,Object(lr.setApiWrappers)(Mi,Ri),{initialized:!1,initializing:void 0,init(e){var t=e.callPreview,n=e.callsCredentials,a=e.imHash,o=e.participantLimit,s=e.callsOkStaging,u=e.callsTranslation,A=e.callsForceStopVideoStream,d=e.callsAdminMode,p=e.callsNoiseCancellation,m=(e.callsLogLongpollPush,e.tabIsMaster),f=e.tabIsIdle,_=e.onBeforeCallStart,E=e.onAfterCallFinish,h=e.onError;if(this.initialized=!0,!xt.browser.isBrowserSupported()){var v=()=>{var e=wi.getLang("calls_unsupported_browser_error");return h?h({msg:e}):console.error(e),Promise.resolve()};return this.call=v,this.startGroupCall=v,this.startCall=v,this.joinCallByLink=v,void(this.showJoinPopup=v)}this.id=window.vk&&window.vk.id||n.me.peerId;var g=m||(()=>!0),O=f||(()=>!1),C=Object(gi.createStore)(yi,Ci(n.me,a,t,{participantLimit:o,callsAdminMode:d,callsNoiseCancellation:p,isDev:!!n.is_dev,token:n.secret,translationEnabled:u,forceStopVideoStream:A}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__());return this.collapseCall=()=>{C.dispatch({type:c.MANAGEMENT,isOpen:!1}),C.dispatch({type:c.CHANGE_UI_MODE,mode:c.UIMode.COLLAPSED})},Pi&&ai(Pi),Ti&&K.setActionStatCollector(Ti),i.render(r.createElement(l.Provider,{store:C},r.createElement(j.Provider,{value:wi},r.createElement(vi,null))),Ii("calls")),this.initializing=si(this,xt,n,C,wi.getLang,s).then(()=>{!function(e,t,n,a,r,o,i){var l=i.dispatch,s=function(){for(var r=arguments.length,s=new Array(r),u=0;u<r;u++)s[u]=arguments[u];var A=i.getState();Ko(A,l,s,n).then(()=>{s.forEach(a=>{switch(a.type){case c.INCOMING_CALL:if(Zo(A,a,n))t.processPush(a.payload.call_id).then(()=>{var e=JSON.parse(ae(a.payload.payload)),t=e.is_video?c.CallType.VIDEO:c.CallType.AUDIO;l({type:c.CHANGE_MODE,mode:c.Mode.INCOMING,peerId:pe(a.payload),data:Yo({},a.payload,{type:t,payload:e})}),Wo({timeStart:Date.now(),startType:t}),K.logEvent({call_event_type:c.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:a.payload.call_id,peer_id:pe(a.payload),is_group_call:me(a),reason:e.is_video?c.CallType.VIDEO:c.CallType.AUDIO})}).catch(t=>{if(e.debug)if("object"==typeof t){var n=t.hangup,a=t.message;console.error("Push process error",n,a)}else console.error("Push process error",t)});else if(a.type===c.INCOMING_CALL){var r=t=>{e.debug&&console.warn("Incoming push skipped:",t,a)};switch(!0){case!a.payload.call_id:r("old lib call");break;case!n():r("not master tab");break;case A.mode===c.Mode.CALL||A.mode===c.Mode.INCOMING:r("already in a call"),t.processPush(a.payload.call_id).then(()=>{e.debug&&console.warn("processPush was incorrect accepted",a.payload.call_id)}).catch(t=>{e.debug&&console.warn("processPush rejected:",t,a.payload.call_id)})}}break;case c.ADD_MESSAGE:var o=i.getState(),s=V(o.peer),u=o.callData.callId;if(o.peer!==a.peerId||a.flags&c.FLAG_OUTBOUND||o.me===a.userId||l({type:c.SET_UNREAD_COUNT,chatUnreadCount:o.chatUnreadCount?o.chatUnreadCount+1:1}),s||!W(a))return;var d=a.peerId;if(u===a.kludges.attach1_call_id)return Or(i.getState(),l,d);break;case c.READ_INBOUND:null!==a.chatUnreadCount&&i.getState().peer===a.peerId&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:a.unread,chatUpToMsgId:a.upToId});break;case c.SET_FLAGS:var p=i.getState();p.peer===a.peerId&&null!==p.chatUpToMsgId&&a.messageId>p.chatUpToMsgId&&!(a.flags&c.FLAG_OUTBOUND)&&(a.flags&c.FLAG_DELETED||a.flags&c.FLAG_SPAM)&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:p.chatUnreadCount?p.chatUnreadCount-1:0});break;case c.DELETE_DIALOG:i.getState().peer===a.peerId&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case c.EDIT_MESSAGE:case c.REPLACE_MESSAGE:var m=i.getState();m.peer===a.peerId&&null!==m.chatUpToMsgId&&a.messageId>m.chatUpToMsgId&&a.kludges.is_expired&&l({type:c.SET_UNREAD_COUNT,chatUnreadCount:m.chatUnreadCount?m.chatUnreadCount-1:0});break;case c.CONVERSATION_UPDATED:var f=a.peerId,_=a.updateType;if(i.getState().peer!==f)return;if(_!==c.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==i.getState().callData.canFinishCall&&i.getState().callData.hasUrlLink||Cr(i.getState(),l,f)}})}).catch(t=>{e.debug&&console.error("Resource loading error",t),s.forEach(e=>{switch(e.type){case c.INCOMING_CALL:if(!Zo(A,e,n)||a())return;l({type:c.ERROR,text:o("calls_incoming_process_error"),handleType:c.ErrorHandleType.PROCESS,callId:e.payload.call_id})}})})};if(e.handleEvent=s,void 0!==window.Notifier){var u=window.Notifier.getLpInstance();u&&u.onData(s)}}(this,xt,g,O,0,wi.getLang,C);var e=Ii("calls");i.unmountComponentAtNode(e),i.render(r.createElement(l.Provider,{store:C},r.createElement(j.Provider,{value:wi},r.createElement(Go,{bridge:this,SDK:xt,tabIsMaster:g,onBeforeCallStart:_,onAfterCallFinish:E,callSounds:ji,navigateToConvo:Di,navigateToProfile:Li,okPublicKey:n.key}))),e)}),this.initializing.catch(e=>{console.error("Could not init calls",e.error,e)})},showJoinScreen(e,t,n,a,o){var l=e=>{a?a({msg:e}):console.error(e)};if(!xt.browser.isBrowserSupported())return l(wi.getLang("calls_unsupported_browser_error"));ai(Pi),K.setActionStatCollector(Ti);var c=document.querySelector(t);i.render(r.createElement(j.Provider,{value:wi},r.createElement(Gr,Ni({},e,{withPopup:!1,bridge:this,entryPoint:n,onError:l,okPublicKey:o}))),c)},debug:!1,setDebug(e){this.debug=e,xt.debug(e)}})}try{window.stManager.done(window.jsc("web/calls.js"))}catch(e){}},Db7M:function(e,t,n){"use strict";n.r(t),n.d(t,"api",(function(){return i})),n.d(t,"setApiConfig",(function(){return o})),n.d(t,"upload",(function(){return l}));var a=n("6Rqf"),r={domain:"api.vk.com"};function o(e){e=Object.assign({},r,e),r=e}function i(e,t,n){var l=r;n&&(l=Object.assign({},r,n));var c,s,u=l.domain,A=Object(a.makeParams)((s={v:(c=l).version||"5.123"},c.appId&&(s.client_id=c.appId),s)),d=function(e){return{access_token:e.accessToken}}(l),p="https://"+u+"/method/"+e+"?"+A,m=Object.assign({},t,d);return Object(a.corsRequest)(p,m).then((function(a){if(a.response)return a.response;var r=a.error;if(!r)return Promise.reject({type:"api_error",error:{error_code:0,error_msg:"Unknown"}});if(l.onCaptcha&&14===r.error_code){var c=r,s=c.captcha_sid,u=c.captcha_img;return l.onCaptcha({captcha_sid:s,captcha_img:u}).then((function(a){var r=Object.assign({},t,a);return i(e,r,n)}))}return!l.onTokenExpired||n&&n.accessToken||5!==r.error_code?Promise.reject({type:"api_error",error:a.error}):l.onTokenExpired().then((function(a){return o({accessToken:a}),i(e,t,n)}))}),(function(e){return Promise.reject({type:"network_error",error:e})}))}function l(e,t){return fetch(e,{method:"POST",body:t,mode:"cors"}).then((function(e){return e.json()}))}},Nc7d:function(e,t,n){"use strict";var a;n.r(t),n.d(t,"UsersFields",(function(){return a})),function(e){e.FIRST_NAME_NOM="first_name_nom",e.FIRST_NAME_GEN="first_name_gen",e.FIRST_NAME_DAT="first_name_dat",e.FIRST_NAME_ACC="first_name_acc",e.FIRST_NAME_INS="first_name_ins",e.FIRST_NAME_ABL="first_name_abl",e.LAST_NAME_NOM="last_name_nom",e.LAST_NAME_GEN="last_name_gen",e.LAST_NAME_DAT="last_name_dat",e.LAST_NAME_ACC="last_name_acc",e.LAST_NAME_INS="last_name_ins",e.LAST_NAME_ABL="last_name_abl",e.PHOTO_ID="photo_id",e.VERIFIED="verified",e.SEX="sex",e.BDATE="bdate",e.CITY="city",e.COUNTRY="country",e.HOME_TOWN="home_town",e.HAS_PHOTO="has_photo",e.PHOTO_50="photo_50",e.PHOTO_100="photo_100",e.PHOTO_200_ORIG="photo_200_orig",e.PHOTO_200="photo_200",e.PHOTO_400="photo_400",e.PHOTO_400_ORIG="photo_400_orig",e.PHOTO_MAX="photo_max",e.PHOTO_MAX_ORIG="photo_max_orig",e.PHOTO_MAX_SIZE="photo_max_size",e.ONLINE="online",e.LISTS="lists",e.DOMAIN="domain",e.HAS_MOBILE="has_mobile",e.CONTACTS="contacts",e.SITE="site",e.EDUCATION="education",e.UNIVERSITIES="universities",e.SCHOOLS="schools",e.STATUS="status",e.LAST_SEEN="last_seen",e.FOLLOWERS_COUNT="followers_count",e.COUNTERS="counters",e.COMMON_COUNT="common_count",e.OCCUPATION="occupation",e.NICKNAME="nickname",e.RELATIVES="relatives",e.RELATION="relation",e.PERSONAL="personal",e.CONNECTIONS="connections",e.EXPORTS="exports",e.WALL_COMMENTS="wall_comments",e.ACTIVITIES="activities",e.INTERESTS="interests",e.MUSIC="music",e.MOVIES="movies",e.TV="tv",e.BOOKS="books",e.GAMES="games",e.ABOUT="about",e.QUOTES="quotes",e.CAN_POST="can_post",e.CAN_SEE_ALL_POSTS="can_see_all_posts",e.CAN_SEE_AUDIO="can_see_audio",e.CAN_WRITE_PRIVATE_MESSAGE="can_write_private_message",e.CAN_SEND_FRIEND_REQUEST="can_send_friend_request",e.IS_FAVORITE="is_favorite",e.IS_HIDDEN_FROM_FEED="is_hidden_from_feed",e.TIMEZONE="timezone",e.SCREEN_NAME="screen_name",e.MAIDEN_NAME="maiden_name",e.CROP_PHOTO="crop_photo",e.IS_FRIEND="is_friend",e.FRIEND_STATUS="friend_status",e.CAREER="career",e.MILITARY="military",e.BLACKLISTED="blacklisted",e.BLACKLISTED_BY_ME="blacklisted_by_me",e.CAN_SUBSCRIBE_POSTS="can_subscribe_posts",e.DESCRIPTIONS="descriptions",e.TRENDING="trending",e.MUTUAL="mutual",e.FRIENDSHIP_WEEKS="friendship_weeks",e.CAN_INVITE_TO_CHATS="can_invite_to_chats",e.STORIES_ARCHIVE_COUNT="stories_archive_count",e.VIDEO_LIVE_LEVEL="video_live_level",e.VIDEO_LIVE_COUNT="video_live_count",e.CLIPS_COUNT="clips_count",e.SERVICE_DESCRIPTION="service_description",e.IS_DEAD="is_dead"}(a||(a={}))},evbW:function(e,t,n){"use strict";var a;n.r(t),n.d(t,"BaseUserGroupFields",(function(){return a})),function(e){e.ABOUT="about",e.ACTION_BUTTON="action_button",e.ACTIVITIES="activities",e.ACTIVITY="activity",e.ADDRESSES="addresses",e.ADMIN_LEVEL="admin_level",e.AGE_LIMITS="age_limits",e.AUTHOR_ID="author_id",e.BAN_INFO="ban_info",e.BDATE="bdate",e.BLACKLISTED="blacklisted",e.BLACKLISTED_BY_ME="blacklisted_by_me",e.BOOKS="books",e.CAN_CREATE_TOPIC="can_create_topic",e.CAN_MESSAGE="can_message",e.CAN_POST="can_post",e.CAN_SEE_ALL_POSTS="can_see_all_posts",e.CAN_SEE_AUDIO="can_see_audio",e.CAN_SEND_FRIEND_REQUEST="can_send_friend_request",e.CAN_UPLOAD_VIDEO="can_upload_video",e.CAN_WRITE_PRIVATE_MESSAGE="can_write_private_message",e.CAREER="career",e.CITY="city",e.COMMON_COUNT="common_count",e.CONNECTIONS="connections",e.CONTACTS="contacts",e.COUNTERS="counters",e.COUNTRY="country",e.COVER="cover",e.CROP_PHOTO="crop_photo",e.DEACTIVATED="deactivated",e.DESCRIPTION="description",e.DOMAIN="domain",e.EDUCATION="education",e.EXPORTS="exports",e.FINISH_DATE="finish_date",e.FIXED_POST="fixed_post",e.FOLLOWERS_COUNT="followers_count",e.FRIEND_STATUS="friend_status",e.GAMES="games",e.HAS_MARKET_APP="has_market_app",e.HAS_MOBILE="has_mobile",e.HAS_PHOTO="has_photo",e.HOME_TOWN="home_town",e.ID="id",e.INTERESTS="interests",e.IS_ADMIN="is_admin",e.IS_CLOSED="is_closed",e.IS_FAVORITE="is_favorite",e.IS_FRIEND="is_friend",e.IS_HIDDEN_FROM_FEED="is_hidden_from_feed",e.IS_MEMBER="is_member",e.IS_MESSAGES_BLOCKED="is_messages_blocked",e.CAN_SEND_NOTIFY="can_send_notify",e.IS_SUBSCRIBED="is_subscribed",e.LAST_SEEN="last_seen",e.LINKS="links",e.LISTS="lists",e.MAIDEN_NAME="maiden_name",e.MAIN_ALBUM_ID="main_album_id",e.MAIN_SECTION="main_section",e.MARKET="market",e.MEMBER_STATUS="member_status",e.MEMBERS_COUNT="members_count",e.MILITARY="military",e.MOVIES="movies",e.MUSIC="music",e.NAME="name",e.NICKNAME="nickname",e.OCCUPATION="occupation",e.ONLINE="online",e.ONLINE_STATUS="online_status",e.PERSONAL="personal",e.PHONE="phone",e.PHOTO_100="photo_100",e.PHOTO_200="photo_200",e.PHOTO_200_ORIG="photo_200_orig",e.PHOTO_400_ORIG="photo_400_orig",e.PHOTO_50="photo_50",e.PHOTO_ID="photo_id",e.PHOTO_MAX="photo_max",e.PHOTO_MAX_ORIG="photo_max_orig",e.QUOTES="quotes",e.RELATION="relation",e.RELATIVES="relatives",e.SCHOOLS="schools",e.SCREEN_NAME="screen_name",e.SEX="sex",e.SITE="site",e.START_DATE="start_date",e.STATUS="status",e.TIMEZONE="timezone",e.TRENDING="trending",e.TV="tv",e.TYPE="type",e.UNIVERSITIES="universities",e.VERIFIED="verified",e.WALL_COMMENTS="wall_comments",e.WIKI_PAGE="wiki_page",e.VK_ADMIN_STATUS="vk_admin_status"}(a||(a={}))},jm8g:function(e,t,n){"use strict";n.r(t),n.d(t,"login",(function(){return i})),n.d(t,"setLoginConfig",(function(){return o}));var a=n("6Rqf"),r={domain:"login.vk.com"};function o(e){e=Object.assign({},r,e),r=e}function i(e,t,n){var o=r;n&&(o=Object.assign({},r,n));var l,c=o.domain,s=o.onCaptcha,u="https://"+c+"/?act="+e,A={version:(l=o).version||"1",app_id:l.appId},d=Object.assign({},t,A);return Object(a.corsRequest)(u,d).then((function(a){if("error"===a.type)return Promise.reject({type:"login_error",error:a.error_info});if("captcha"===a.type){if(!s)return Promise.reject({type:"login_error",error:"captcha"});var r=a.captcha_sid,o=a.captcha_img;return s({captcha_sid:r,captcha_img:o}).then((function(a){var r=Object.assign({},t,a);return i(e,r,n)}))}return a.data}),(function(e){return{type:"network_error",error:e}}))}},rFFZ:function(e,t,n){"use strict";n.r(t),n.d(t,"apiWrapper",(function(){return p}));var a=n("Db7M"),r=n("jm8g"),o=function(){return Object(r.login)("web_token").then((function(e){return e.access_token}))},i=!1,l=function(e,t){return i||(Object(a.setApiConfig)({version:"5.133",domain:t,onTokenExpired:o,onCaptcha:e}),i=!0),Promise.resolve()},c=null,s=function(e,t,n){return c||(Object(r.setLoginConfig)({appId:6287487,domain:n,onCaptcha:e}),Object(a.setApiConfig)({appId:6287487,version:"5.133",domain:t,onTokenExpired:o,onCaptcha:e}),c=Object(r.login)("web_token").then((function(e){return Object(a.setApiConfig)({accessToken:e.access_token})})).catch((function(e){console.error("Init api auth failed",e)})))},u=n("EasH"),A=null,d=function(e){return new Promise((function(t){var n={imgSrc:e.captcha_img,onSubmit:function(e,n){t({captcha_sid:e,captcha_key:n}),A&&A.hide()},onHide:function(){return A=null}};A=Object(u.showCaptchaBox)(e.captcha_sid,A,null,n)}))},p=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return l(d,window.vk.apiConfigDomains.apiDomain).then((function(){return e.apply(void 0,t)}))}};t.default=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return s(d,window.vk.apiConfigDomains.apiDomain,window.vk.apiConfigDomains.loginDomain).then((function(){return e.apply(void 0,t)}))}}},yLpj:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}});