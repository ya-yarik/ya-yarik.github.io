(()=>{"use strict";var __webpack_modules__={975803:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 12 16",c="chevron_outline_16",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 16" id="chevron_outline_16"><path clip-rule="evenodd" d="M4.22 3.47a.75.75 0 011.06 0l4 4a.75.75 0 010 1.06l-4 4a.75.75 0 01-1.06-1.06L7.69 8 4.22 4.53a.75.75 0 010-1.06z" fill="currentColor" fill-rule="evenodd" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?12:+e.width,height:isNaN(e.height)?16:+e.height}))};h.mountIcon=u;const p=h},536741:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 20 16",c="dropdown_20",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16" id="dropdown_20"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.22 5.875a1 1 0 011.405-.156L10 9.22l4.375-3.5a1 1 0 011.25 1.562l-5 4a1 1 0 01-1.25 0l-5-4a1 1 0 01-.156-1.406z" fill="currentColor" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?20:+e.width,height:isNaN(e.height)?16:+e.height}))};h.mountIcon=u;const p=h},843257:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 20 20",c="market_outline_20",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="market_outline_20"><path clip-rule="evenodd" d="M7.25 5.75a2.75 2.75 0 015.5 0V6h-5.5zm-1.5.254V5.75a4.25 4.25 0 018.5 0v.254c1.013.014 1.62.073 2.112.323a3 3 0 011.311 1.311C18 8.28 18 9.12 18 10.8v.5c0 2.52 0 3.78-.49 4.743a4.5 4.5 0 01-1.967 1.966c-.963.491-2.223.491-4.743.491H9.2c-2.52 0-3.78 0-4.743-.49a4.5 4.5 0 01-1.967-1.967C2 15.08 2 13.82 2 11.3v-.5c0-1.68 0-2.52.327-3.162a3 3 0 011.311-1.311c.492-.25 1.1-.31 2.112-.323zm-.798 1.532C5.377 7.5 5.935 7.5 6.8 7.5h6.4c.865 0 1.423.001 1.848.036.408.033.559.09.633.127a1.5 1.5 0 01.655.656c.038.074.095.225.128.633.035.425.036.983.036 1.848v.5c0 1.285-.001 2.158-.056 2.833-.054.658-.151.994-.271 1.229a3 3 0 01-1.311 1.311c-.235.12-.57.217-1.229.27C12.958 17 12.085 17 10.8 17H9.2c-1.285 0-2.158-.001-2.833-.056-.658-.054-.994-.151-1.229-.271a3 3 0 01-1.311-1.311c-.12-.235-.217-.57-.27-1.229C3.5 13.458 3.5 12.585 3.5 11.3v-.5c0-.865.001-1.423.036-1.848.033-.408.09-.559.127-.633a1.5 1.5 0 01.656-.656c.074-.037.225-.094.633-.127zm.798 2.339a.875.875 0 111.75 0 .875.875 0 01-1.75 0zM13.375 9a.875.875 0 100 1.75.875.875 0 000-1.75z" fill="currentColor" fill-rule="evenodd" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?20:+e.width,height:isNaN(e.height)?20:+e.height}))};h.mountIcon=u;const p=h},23515:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 16 24",c="chevron_compact_left_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 24" id="chevron_compact_left_24"><path d="M11.293 7.706a1 1 0 000-1.412l-.088-.088a.997.997 0 00-1.414.002l-5.084 5.084a.998.998 0 000 1.416l5.084 5.084c.39.391 1.026.39 1.414.002l.088-.088a.995.995 0 000-1.412L7 12z" fill="#b8c1cc" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?16:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},719282:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 16 24",c="chevron_compact_right_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 24" id="chevron_compact_right_24"><path d="M4.706 7.706a1 1 0 010-1.412l.088-.088a.997.997 0 011.414.002l5.084 5.084a.998.998 0 010 1.416l-5.084 5.084a1.002 1.002 0 01-1.414.002l-.088-.088a.995.995 0 010-1.412L9 12z" fill="currentColor" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?16:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},763478:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 24 24",c="narrative_outline_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="narrative_outline_24"><path d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 11-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.726 1.726 0 00-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119c-.26.243-.43.539-.512.886-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302.244.26.54.43.887.512.401.093.745.076 1.607-.14a1 1 0 11.487 1.94c-1.148.288-1.805.32-2.549.147a3.726 3.726 0 01-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.722 3.722 0 01.93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22zM18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.174 4.174 0 012.036-.653zm0 2c-.63 0-1.17.228-1.67.716l-.349.34a.5.5 0 01-.698 0l-.35-.34c-.5-.488-1.04-.716-1.67-.716-.906 0-1.631.707-1.631 1.567 0 .993.4 1.546 2.524 3.185L16 18.875l1.012-.767c2.45-1.859 2.957-2.442 2.988-3.44l.001-.1c0-.86-.725-1.568-1.632-1.568z" fill="currentColor" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},254589:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 24 24",c="send_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="send_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M5.739 15.754c-.686 1.855-1.117 3.158-1.293 3.91-.553 2.362-.956 2.894 1.107 1.771 2.062-1.122 12.046-6.683 14.274-7.919 2.904-1.611 2.942-1.485-.156-3.196-2.36-1.302-12.227-6.718-14.118-7.782-1.892-1.063-1.66-.59-1.107 1.772.178.761.616 2.076 1.311 3.944a4 4 0 002.988 2.531l5.765 1.117a.1.1 0 010 .196l-5.778 1.116a4 4 0 00-2.993 2.54z" fill="currentColor" /></g></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},463989:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 24 24",c="share_outline_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="share_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M11.996 3.725A2.15 2.15 0 0010 5.87l-.001 2.117-.02.005a9.904 9.904 0 00-7.827 10.721c.083.811 1.116 1.103 1.611.455l.187-.237a9.082 9.082 0 015.836-3.265l.213-.026.001 2.494a2.15 2.15 0 003.476 1.692l7.824-6.132a2.15 2.15 0 000-3.384l-7.824-6.132a2.15 2.15 0 00-1.326-.458zm.154 1.795a.35.35 0 01.216.075l7.824 6.132a.35.35 0 010 .55l-7.824 6.133a.35.35 0 01-.566-.276l-.001-3.447a.9.9 0 00-.915-.9l-.233.004-.342.017a10.88 10.88 0 00-6.119 2.365l-.174.144.024-.135a8.103 8.103 0 016.968-6.537.9.9 0 00.791-.893L11.8 5.87a.35.35 0 01.35-.35z" fill="currentColor" fill-rule="nonzero" /></g></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},147650:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 24 24",c="smile_outline_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 011.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 001.773-.488c.191-.12.382-.26.53-.432a.9.9 0 011.4 1.132 4.045 4.045 0 01-.976.826A5.094 5.094 0 0112 17.15a5.094 5.094 0 01-2.727-.762 3.987 3.987 0 01-.976-.826.9.9 0 01.14-1.265zm1.812-4.047a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM15 11.5A1.25 1.25 0 1015 9a1.25 1.25 0 000 2.5z" fill="currentColor" /><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.1c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9zM3.9 12a8.1 8.1 0 1116.2 0 8.1 8.1 0 01-16.2 0z" fill="currentColor" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},923197:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 24 24",c="story_outline_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="story_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" opacity=".1" /><path d="M9.128 3.1l6.046.002c1.56.019 2.367.191 3.204.639a4.534 4.534 0 011.881 1.88c.476.89.641 1.745.641 3.507v5.744c0 1.762-.165 2.617-.64 3.506a4.534 4.534 0 01-1.882 1.881c-.889.476-1.744.641-3.506.641H9.128c-1.762 0-2.617-.165-3.506-.64a4.534 4.534 0 01-1.881-1.882c-.476-.889-.641-1.744-.641-3.506l.002-6.046c.019-1.56.191-2.367.639-3.204A4.534 4.534 0 015.62 3.74c.89-.476 1.745-.641 3.507-.641zm5.744 1.8H9.128c-1.315 0-1.917.086-2.447.324l-.21.104A2.735 2.735 0 005.328 6.47C5.01 7.063 4.9 7.638 4.9 9.128v5.744c0 1.315.086 1.917.324 2.447l.104.21c.265.495.648.878 1.143 1.143.523.28 1.032.399 2.167.423l.49.005h5.744c1.315 0 1.917-.086 2.447-.324l.21-.104a2.735 2.735 0 001.143-1.143c.28-.523.399-1.032.423-2.167l.005-.49V9.128c0-1.315-.086-1.917-.324-2.447l-.104-.21a2.735 2.735 0 00-1.143-1.143c-.592-.317-1.167-.428-2.657-.428zM12 8.1a3.9 3.9 0 110 7.8 3.9 3.9 0 010-7.8zm0 1.8a2.1 2.1 0 100 4.2 2.1 2.1 0 000-4.2z" fill="currentColor" fill-rule="nonzero" /></g></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},127376:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 24 24",c="view_outline_24",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="view_outline_24"><path d="M12 4.6c5.2 0 10.4 4.237 10.4 7.4 0 3.163-5.2 7.4-10.4 7.4S1.6 15.163 1.6 12c0-3.163 5.2-7.4 10.4-7.4zm0 1.8c-4.278 0-8.6 3.522-8.6 5.6s4.322 5.6 8.6 5.6 8.6-3.522 8.6-5.6-4.322-5.6-8.6-5.6zm0 2.2a3.4 3.4 0 110 6.8 3.4 3.4 0 010-6.8zm0 1.8a1.6 1.6 0 100 3.2 1.6 1.6 0 000-3.2z" fill="currentColor" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};h.mountIcon=u;const p=h},763358:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 28 28",c="like_28",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="like_28"><path d="M9.026 4.88A6.526 6.526 0 002.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 002.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 00-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88z" fill="currentColor" /></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?28:+e.width,height:isNaN(e.height)?28:+e.height}))};h.mountIcon=u;const p=h},314168:(e,t,o)=>{o.d(t,{default:()=>p});var i=o(667294),r=o(887854),s=o.n(r),n=o(408091),a=o(634777),l=o(379333),d="0 0 28 28",c="like_outline_28",_=!1;function u(){_||((0,a.addSpriteSymbol)(new(s())({id:c,viewBox:d,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="like_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path d="M9.026 4.88A6.526 6.526 0 002.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 002.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 00-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88zm0 2c1.52 0 2.889.858 4.152 2.683l.205.298a.75.75 0 001.234 0l.205-.298c1.263-1.825 2.633-2.683 4.152-2.683 2.5 0 4.526 2.027 4.526 4.526 0 2.78-1.137 4.204-6.721 8.547L14 22.114l-2.779-2.161C5.637 15.61 4.5 14.187 4.5 11.406c0-2.5 2.027-4.526 4.526-4.526z" fill="currentColor" fill-rule="nonzero" /></g></symbol>'})),_=!0)}var h=function(e){return(0,a.useIsomorphicLayoutEffect)((function(){u()}),[]),i.createElement(l.SvgIcon,(0,n.assign)({},e,{viewBox:d,id:c,width:isNaN(e.width)?28:+e.width,height:isNaN(e.height)?28:+e.height}))};h.mountIcon=u;const p=h},426967:(e,t,o)=>{function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_add_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_add_outline_24__user_add_outline_24"><path id="user_add_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 10-5.7 0 2.85 2.85 0 005.7 0zm1.8 0a4.65 4.65 0 11-9.3 0 4.65 4.65 0 019.3 0zM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03zm-4-8.33h2.7a.9.9 0 110 1.8H5.9v2.7a.9.9 0 11-1.8 0v-2.7H1.4a.9.9 0 110-1.8h2.7V7.4a.9.9 0 111.8 0v2.7zm2.2 8.33c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47z" id="user_add_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_add_outline_24"}}o.d(t,{getIcon24UserAddOutline:()=>i})},558367:(e,t,o)=>{function i(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_added_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_added_outline_24__user_added_outline_24"><path id="user_added_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 10-5.7 0 2.85 2.85 0 005.7 0zm1.8 0a4.65 4.65 0 11-9.3 0 4.65 4.65 0 019.3 0zM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03zm-1.8 0c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47zm.26-9.57a.9.9 0 111.28 1.28l-5 5a.9.9 0 01-1.28 0l-2.5-2.5a.9.9 0 111.28-1.28L4 13.23l4.36-4.37z" id="user_added_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_added_outline_24"}}o.d(t,{getIcon24UserAddedOutline:()=>i})},778464:(e,t,o)=>{o.d(t,{MODULE:()=>i});var i="group_personal_card"},742692:(e,t,o)=>{o.d(t,{MODULE:()=>i});var i="user_personal_card"},995343:(e,t,o)=>{o.d(t,{PINNED_CONVERSATION_BIT_MASK:()=>i,MASS_MENTION_ALIASES:()=>r,MASS_MENTION_REGEXP:()=>s,VK_OFFICIAL_PEER_ID:()=>n});o(283946);var i=112,r={all:["all","everyone","все"],online:["online","here","здесь","тут"]},s=new RegExp(['(?!,|;|:|\\.|\\s|<br ?/?>|"|\\(|\\)|\\[|\\]|!|\\?)',"(",[].concat(r.all).concat(r.online).map((e=>`@${e}|\\*${e}`)).join("|"),")",'(?=$|,|;|:|\\.(?![a-z0-9_-])|\\s|<br ?/?>|"|\\(|\\)|\\[|\\]|!|\\?)'].join(""),"gi"),n=-22822305},457865:(e,t,o)=>{o.d(t,{StickersAnimation:()=>i});o(66108),o(296253);var i=function(){var e,t,o,r=!1,s=!1,n={},a={},l={},d={};function c(e){var t=h(e),o=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function r(s){o++;var n=!0;i>=o&&(n=!1),n&&(u(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",r),t.stop())}))}}function _(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function u(e,t){d[_(e)]=t}function h(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var o=a[t];return o||!1}function p(e,t){var i=h(e);if(i)"function"==typeof t&&t(i);else{var r=attr(e,"data-uniq-id");if(!d[_(e)]){u(e,!0);var s=attr(e,"data-animation-path"),l=attr(e,"data-sticker-id"),c=!1;if(l&&(c=(n[l]||s)&&v(e)),c){var p=attr(e,"data-animation-class")||"",m={container:e,renderer:"svg",loop:!0,autoplay:!1,name:r,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:`svg_sticker_animation ${p}`}};n[l]?m.animationData=n[l]:m.path=s;var y=geByClass1("svg_sticker_animation",e);if(y&&re(y),i=o.loadAnimation(m),!n[l])return void i.addEventListener("data_ready",(function(){n[l]=i.animationData,a[r]=i,"function"==typeof t&&t(i)}))}"function"==typeof t&&(a[r]=i,"function"==typeof t&&t(i))}}}function m(){return t().then((e=>(o=e,e)))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),o=geByClass1("sticker_animation",t);i.loadAndPlaySticker(o)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(`.msg_id_${e} .sticker_animation`);i.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var o="_msg"+e;t&&(o="msg_id_"+e);var r=geByClass1("sticker_animation",geByClass1(o));i.loadAndPlayStickerWithTimer(r,500)},loadAutoplayAnimationStickers:function(e){if(o){if(e){if(s)return;s=!0}if(!r){r=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){p(t,(function(){c(t)}))})),r=!1}}else m().then((()=>{i.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e){e&&(o?requestAnimationFrame((()=>{p(e,(function(){c(e)}))})):m().then((()=>{i.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!l[e]){t||(t=1e3);var o=ge(e);hasClass(o,"sticker_animation_disabled_timer")||(l[e]=setTimeout((function(){!o&&(o=ge(e),hasClass(o,"sticker_animation_disabled_timer"))||(i.loadAndPlaySticker(o),clearTimeout(l[e]),l[e]=!1)}),t))}},reloadStickers:function(){a={}},touchStartSticker:function(t){t.addEventListener("contextmenu",i.preventContextMenu,!1),e=setTimeout((function(){i.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()}};function v(e){var t=e.getBoundingClientRect().top,o=e.getBoundingClientRect().bottom;return t<window.innerHeight&&o>=0&&isVisible(e)}}()},434256:(e,t,o)=>{o.d(t,{getConnectionType:()=>s,saveNavigationStatEvent:()=>a,serializeNavigationStats:()=>l,saveViewerStartTime:()=>c,serializeLoadingStats:()=>_});o(530522),o(66108),o(296253),o(991181),o(579665),o(95767),o(751876);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function s(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,o=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return o>8?"wi-fi":"LTE"}return""}var n=[];function a(e){var t=e.storyRawId,o=e.source,r=e.action,s=i(t.split("_"),2);"reply"===o&&(o="replies_list");var a={ownerId:s[0],storyId:s[1],source:o,action:r};n.push(a)}function l(){var e=n.map((e=>[e.ownerId,e.storyId,e.source,e.action].join(","))).join(";");return n=[],e}var d=[];function c(e){var t=e.storyRawId,o=e.source,r=e.time,s=i(t.split("_"),2),n={ownerId:s[0],storyId:s[1],source:o,time:r};d.push(n)}function _(){var e=d.map((e=>[e.ownerId,e.storyId,e.source,e.time].join(","))).join(";");return d=[],e}},268554:(e,t,o)=>{o.d(t,{removeUnseenStories:()=>s});o(991181),o(579665),o(95767),o(530522),o(66108),o(296253);function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(e,t)}(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s,n=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return n=e.done,e},e:function(e){a=!0,s=e},f:function(){try{n||null==i.return||i.return()}finally{if(a)throw s}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function s(e){window.cur&&window.cur.hasUnseenStories&&delete window.cur.hasUnseenStories[e];var t,o=i(document.querySelectorAll(".friends_photo_stories_unseen"+e));try{for(o.s();!(t=o.n()).done;){var r,s=t.value;s.classList.remove("friends_photo_stories_unseen","friends_photo_stories_unseen"+e),null===(r=s.closest(".friends_photo"))||void 0===r||r.removeAttribute("onclick")}}catch(e){o.e(e)}finally{o.f()}var n,a=i(document.querySelectorAll(".right_list_photo_stories_unseen"+e));try{for(a.s();!(n=a.n()).done;){var l,d=n.value;d.classList.remove("right_list_photo_stories_unseen","right_list_photo_stories_unseen"+e),null===(l=d.closest(".right_list_photo"))||void 0===l||l.removeAttribute("onclick")}}catch(e){a.e(e)}finally{a.f()}}},587041:(e,t,o)=>{o.d(t,{vkIndexer:()=>i});o(820075),o(976142),o(66108),o(296253),o(751876),o(283946);function i(e,t,o){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=o||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}i.prototype.delimiter=i.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),i.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),i.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},i.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},i.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},i.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var o=this.list[t];try{o._order=t}catch(e){}this.add(o)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},i.prototype.strToPrefixes=function(e){for(var t={},o=winToUtf(e).toLowerCase().split(this.delimiter),i=o.length;i--;){var r=o[i],s="";if(r){for(var n=0;n<6;n++){var a=r.charCodeAt(n);if(a){var l=this.toTranslit[a],d=r.substr(n,1);s+=null!=l?l:d}}t[s]=1}}return t},i.prototype.strToSearchPrefixes=function(e){for(var t=[],o=e.toLowerCase().split(this.delimiter),i=o.length;i--;){var r={},s=o[i],n="",a="",l="",d=s.length>1;if(s){for(var c=0;c<6;c++){var _=s.charCodeAt(c);if(_){var u=this.toTranslit[_],h=s.substr(c,1);if(n+=null!=u?u:h,d){var p=this.toLocalCase[h],m=this.toLocalTranslit[_];a+=null!=p?p:h,l+=null!=m?m:h}}}r[n]=1,d&&(r[a]=2,r[l]=3),t.push(r)}}return t},i.prototype.toIndexTree=function(e,t){for(var o=this.index,i=0;i<6;i++){var r=e.substr(i,1)||-1;o=o[r]?o[r]:o[r]=5==i?[]:{}}o.push(t)},i.prototype.remove=function(e){var t=this.prepareFunc(e),o=this.strToPrefixes(t);for(var i in o)if(o.hasOwnProperty(i)){for(var r=this.index,s=0;s<6;s++){var n=i.substr(s,1)||-1;if(!r[n])break;r=r[n]}if(r.length)for(var a in r)if(this.equals(r[a],e)){r.splice(a,1);break}}},i.prototype.equals=function(e,t){for(var o in e)if(e.hasOwnProperty(o))switch(typeof e[o]){case"object":if(!this.equals(e[o],t[o]))return!1;break;case"function":if(void 0===e[o]||e[o].toString()!=t[o].toString())return!1;break;default:if(e[o]!=t[o])return!1}for(var i in t)if(void 0===t[i])return!1;return!0},i.prototype.intersect=function(e,t){var o=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&o.push(e.shift()),t.shift());return o},i.prototype.add=function(e){var t=this.prepareFunc(e),o=this.strToPrefixes(t);for(var i in o)o.hasOwnProperty(i)&&this.toIndexTree(i,e)},i.prototype.search=function(e){var t=this.index,o=this.strToSearchPrefixes(e),i=[],r=!1;for(var s in o)if(o.hasOwnProperty(s)){if(r&&!i)break;var n=this.localSearch(o[s],0,t);n.sort((function(e,t){return e._order-t._order})),i=r?this.intersect(i,n):n,r=!0}for(var a=i[0],l=i.length+1,d=[],c=1;c<l;c++){var _=i[c];_!=a&&(d.push(a),a=_)}return d},i.prototype.localSearch=function(e,t,o){if(!o)return[];var i={};for(var r in e)if(e.hasOwnProperty(r)){var s=r.substr(t,1)||-1;i[s]||(i[s]={}),i[s][r]=1}if(6==t++||!o)return o;var n=[];for(var a in i)if(-1==a)for(var l in o)o.hasOwnProperty(l)&&n.push.apply(n,this.localSearch(i[a],t,o[l]));else{var d=this.localSearch(i[a],t,o[a]);n.push.apply(n,d)}return n}},65645:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59357),_web_legacy_ui_ui_actions_menu_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(675805),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(917685),_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(414914),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(442699),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(927663),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(519921),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(257367),uiActionsMenu={keyToggle:function(e,t){if(!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__.checkKeyboardEvent)(t))return!1;var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)("_ui_menu_wrap",e);o&&uiActionsMenu.toggle(o,!hasClass(o,"shown"))},keyboardToggle:function(e,t,o){if(!(0,_web_legacy_ui_ui_actions_menu_utils__WEBPACK_IMPORTED_MODULE_1__.isKeyboardActivationEvent)(t))return!1;var i,r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)("_ui_menu_wrap",e);(r&&uiActionsMenu.toggle(r,!hasClass(r,"shown")),null==o?void 0:o.preventKeyboardClickEvent)&&(null==t||null===(i=t.preventDefault)||void 0===i||i.call(t))},toggle:function toggle(el,s,options){var dummyMenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(el,"dummyMenu");dummyMenu&&(el=dummyMenu),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.toggleClass)(el,"shown",s);var onhide=attr(el,"onHide");if(onhide&&!hasClass(el,"shown"))try{eval(onhide)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,onhide)}if(options&&options.onToggle){var script=options.onToggle.replace("{isShow}",""+s);try{eval(script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,script)}}},show:function(e,t,o){var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidetimer");i&&(clearTimeout(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidetimer",0));var r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"origMenu");if(r&&(i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(r,"hidetimer"))&&(clearTimeout(i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidetimer",0)),o&&o.delay){cur.uiActionsMenuShowTimeout&&clearTimeout(cur.uiActionsMenuShowTimeout);var s=o.delay;return delete o.delay,void(cur.uiActionsMenuShowTimeout=setTimeout(uiActionsMenu.show.pbind(e,t,o),s))}if(cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout),o&&o.appendParentCls){var n,a,l=geByClass1("_ui_menu",e);if(l){a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)(o.appendParentCls,l),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)("_ui_menu_wrap",e);var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.se)(`<div class="${n.className} ui_actions_menu_dummy_wrap" onmouseover="uiActionsMenu.show(this);" onmouseout="uiActionsMenu.hide(this);"></div>`);if(d.appendChild(l),a.appendChild(d),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"dummyMenu",d),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(d,"origMenu",e),e=d,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(l,"top",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getStyle)(l,"top"))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(l,"left",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getStyle)(l,"left"))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(l,"right",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getStyle)(l,"right"))),o.processHoverCls){var c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)(o.processHoverCls,n);addEvent(e,"mouseover",addClass.pbind(c,"hover")),addEvent(e,"mouseout",removeClass.pbind(c,"hover"))}}else e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"dummyMenu");var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"origMenu");l=geByClass1("_ui_menu",e),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)("_ui_menu_wrap",_),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.domClosest)(o.appendParentCls,l),setStyle(l,{display:"block"});var u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(a),h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(n),p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(l,"top"),m=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(l,"left"),v=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(l,"right"),y={top:h[1]-u[1]+p};v?y.right=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(a)[0]+u[0]-h[0]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(n)[0]+v:y.left=h[0]-u[0]+m,setStyle(l,y)}var f=geByClass1("_ui_menu",e);if(o&&o.autopos&&f&&!hasClass(e,"shown")){removeClass(e,"ui_actions_menu_left");var g=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(e)[1],w=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(e)[1],S=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)(f)[1],E=o.dy||10,b=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getXY)(f)[0];removeClass(e,"ui_actions_menu_top"),addClass(e,"no_transition"),g+w+E+S>(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__.scrollGetY)()+(window.lastWindowHeight||0)&&addClass(e,"ui_actions_menu_top"),g-E-S<(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_5__.scrollGetY)()+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.getSize)("page_header_wrap")[1]&&removeClass(e,"ui_actions_menu_top"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.toggleClass)(e,"ui_actions_menu_left",b<0),removeClass(e,"no_transition")}o&&o.hasOwnProperty("alwaysTop")&&f&&!hasClass(e,"shown")&&(removeClass(e,"ui_actions_menu_top"),o.alwaysTop&&addClass(e,"ui_actions_menu_top")),o&&o.scroll&&o.maxHeight&&(f.style.maxHeight=((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(o.maxHeight)||200)+"px",f.__uiScroll__||new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_7__.default(f)),uiActionsMenu.toggle(e,!0,o)},hide:function(e,t,o){cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout);var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidedelay");i?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidedelay",!1):i=200,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidetimer")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidetimer",setTimeout((function(){uiActionsMenu.toggle(e,!1,o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidetimer",0)}),i))},hideDelay:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_3__.data)(e,"hidedelay",t)}};const __WEBPACK_DEFAULT_EXPORT__=uiActionsMenu},257367:(e,t,o)=>{o.d(t,{default:()=>c});o(59357),o(751876);var i=o(206566),r=o(442699),s=o(414914),n=o(917685),a=o(190148),l=o(433394);class d{constructor(e,t){if(!(e=(0,l.getScrollElement)(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=extend({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1,noLazyLoadWatch:!1},t),this.options.native&&(this.options.shadows=!1),i.browser.mobile&&(this.options.stopScrollPropagation=!1),isArray(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,(0,r.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),(0,r.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),(0,r.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),(0,r.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),(0,r.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),(0,r.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),(0,r.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),(0,r.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),(0,r.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:ce("div",{className:"ui_scroll_overflow"}),outer:ce("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:ce("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:ce("div",{className:"ui_scroll_shadow_top"}),shadowBottom:ce("div",{className:"ui_scroll_shadow_bottom"}),content:ce("div",{className:"ui_scroll_content clear_fix"}),barContainer:ce("div",{className:"ui_scroll_bar_container"}),barOuter:ce("div",{className:"ui_scroll_bar_outer"}),barInner:ce("div",{className:"ui_scroll_bar_inner"})},(0,s.data)(this.el.container,"ui-scroll",this);var o=(0,s.cf)(),a=["ui_scroll_container"];for(each(isArray(this.options.theme)?this.options.theme:trim(this.options.theme+"").split(/\s+/),(function(e,t){t&&a.push("ui_scroll_"+t+"_theme")})),addClass(this.el.container,a.join(" ")),this.options.hidden&&addClass(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=ce("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),o.appendChild(this.el.overflow),this.options.native?addClass(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),o.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),i.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){var c=(0,l.addResizeSensor)(this.el.inner,this.resize.bind(this,!0)),_=(0,l.addResizeSensor)(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(c[0]),this.removeElements.push(_[0]),this.startResizeListening=function(){c[1](),_[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(o),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init(),this.options.noLazyLoadWatch||(window.LazyLoad&&LazyLoad.watch(this.el.outer),window.LazyLoad&&LazyLoad.scanDelayed());var u="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":i.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,u,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&(0,n.cancelEvent)(e):this.isScrollEventUnused(e)?(0,n.cancelEvent)(e):(0,n.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),each(this.options.scrollElements,function(e,t){this.addEvent(t,u,function(e){this.disabled||this.unnecessary||(this.scrollBy(d.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||(0,n.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;var t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){removeEvent(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,addClass(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||removeClass(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,o,i){return this.removeEvents.push([e,t,o]),addEvent(e,t,o,void 0,void 0,i?{passive:!0}:void 0),o}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),each(this.removeEvents,(function(e,t){removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){for(var e=(0,s.cf)();this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return(0,s.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),each(this.removeElements,(function(e,t){(0,s.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if((0,r.isFunction)(e)){this.animation&&this.animation.stop();var t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if((0,r.isFunction)(e)){this.animation&&this.animation.stop();var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){i.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),setStyle(this.el.container,"width",e?(0,s.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){var t=0,o=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,i.browser.mac&&i.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==o?15:2==o?450:1)}isScrollEventUnused(e){return d.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){var t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),(0,s.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),addEvent(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),addEvent(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,(0,n.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),setStyle(bodyNode,"cursor",""),removeClass(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);var t=(e.pageY-(0,s.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&(0,n.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(!this.disabled&&this.dragging&&!this.options.native){e||(e=window.event);var t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,setStyle(bodyNode,"cursor","pointer"),addClass(this.el.container,"ui_scroll_dragging")),(0,n.cancelEvent)(e),this.emitEvent("drag"),this.api}}scroll(e,t,o){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new a.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:a.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:(0,r.isFunction)(o)?o.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,(0,r.isFunction)(o)&&o(this.api)),this.api}scrollTop(e,t,o,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll((0,r.intval)(t),o,i)}scrollBottom(e,t,o,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-(0,r.intval)(t),o,i)}scrollBy(e,t,o){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+(0,r.intval)(e),t,o)}scrollIntoView(e,t,o,i){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=(0,l.getScrollElement)(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){var n=(0,s.getXY)(t)[1],a=(0,s.getXY)(this.el.overflow)[1],d=(0,s.getSize)(t)[1];if(n<=a&&n+d>=a+this.api.data.viewportHeight||n>=a&&n+d<=a+this.api.data.viewportHeight)(0,r.isFunction)(i)&&(o?setTimeout(i.bind(this.api),0):i(this.api));else if(d>this.api.data.viewportHeight||n<a)this.scrollTop(!1,n-a+this.api.data.scrollTop-(this.options.shadows?(0,s.getSize)(this.el.shadowTop)[1]:0),o,i);else{var c=this.options.shadows?(0,s.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,n-a+this.api.data.scrollTop+d-this.api.data.viewportHeight+c,o,i)}}return this.api}update(e){var t,o;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));var i=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==i)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,i))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(!(o=(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight))<=this.api.data.viewportHeight)){var r=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==r)&&(this.barOuterHeight=r,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),(0,l.nextFrame)((()=>{var e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`}))}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!o)&&(0,s.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!o),this.shadowBottom!=(this.api.data.scrollBottom&&!o)&&(0,s.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!o)),this.unnecessary!==o&&((0,s.toggleClass)(this.el.container,"ui_scroll_unnecessary",o),this.unnecessary=o,this.options.stopScrollPropagation&&this.fixBlocker(),o&&this.barInnerHeight&&this.barOuterHeight&&(0,l.nextFrame)(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";var o=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${o}%)`}.bind(this)))}return this.emitEvent("update"),this.options.noLazyLoadWatch||window.LazyLoad&&LazyLoad.scanDelayed(this.el.outer),(!this.options.reversed||i>=0)&&this.more(),!0}return!1}more(){var e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}}d.addResizeSensor=l.addResizeSensor;const c=d},433394:(e,t,o)=>{o.d(t,{nextFrame:()=>l,getScrollElement:()=>d,addResizeSensor:()=>c});var i,r=o(442699),s=o(206566),n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),a=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function l(e){i&&a(i),i=n(e)}function d(e){return(0,r.isString)(e)&&"_"===e[0]?geByClass1(e):ge(e)}function c(e,t){if((e=d(e))&&(0,r.isFunction)(t)){if(s.browser.msie9||s.browser.opera&&s.browser.version<13){var o=!1,i=!1,n=function e(){if(!a.contentDocument)return setTimeout(e,100);a.contentDocument.defaultView.removeEventListener("resize",t),a.contentDocument.defaultView.addEventListener("resize",t),t()},a=ce("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){i=!0,o&&n()}});return e.appendChild(a),e.__resizeSensor__=[a,function(){o=!0,i&&n()}]}var l=ce("div",{className:"ui_scroll_resize_sensor"}),c=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),_=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),u=ce("div"),h=ce("div"),p=null;return c.appendChild(u),_.appendChild(h),l.appendChild(c),l.appendChild(_),e.appendChild(l),e.__resizeSensor__=[l,c.onscroll=_.onscroll=function(){var o=(e.offsetWidth||1e4)+10,i=(e.offsetHeight||1e4)+10;u.style.width=o+"px",u.style.height=i+"px",c.scrollLeft=o,c.scrollTop=i,_.scrollLeft=o,_.scrollTop=i,p!==(p=o+" "+i)&&t()}]}}},881308:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21466),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(414914),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(313020),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(442699),_web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(45150),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(917685),_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(892862),_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(206566),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(519921),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(927663),uiSearch={destroy:function(e){var t=uiSearch.getFieldEl(e);uiSearch.stopEvents(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeData)(t)},getWrapEl:function(e){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domClosest)("_wrap",e)},getFieldEl:function(e){return e=ge(e),hasClass("_field",e)?e:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domByClass)(uiSearch.getWrapEl(e),"_field")},stopEvents:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[];each(t,(function(e,t){t.stop()}))},startEvents:function(e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[];each(t,(function(e,t){t.stop(),t.start()}))},init:function init(el,options){if(el&&(el=uiSearch.getFieldEl(el),el)){var wrapEl=uiSearch.getWrapEl(el),delayedInitOptions=!options&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(wrapEl,"init-options");if(delayedInitOptions){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(wrapEl,"init-options",null);var evalScript="(function() { return "+delayedInitOptions+" })()";try{uiSearch.init(el,eval(evalScript))}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,evalScript)}}else if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"inited")){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"inited",1);var onKeyDown=uiSearch.onKeyDown.pbind(el),onBuffer=function(e){if("input"===e.type&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.msie){var t=val(el);if(t===((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"prev-value")||""))return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"prev-value",t)}setTimeout(uiSearch.onChanged.pbind(el,!1,e),0)},onBlur=uiSearch.onBlurred.pbind(el),mainHandler;if((0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_2__.placeholderInit)(el),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"opts",options),options.suggester)options.suggester.instance=new Suggester(el,extend(options.suggester,{type:options.suggester.type,historyItems:!!options.suggester.history&&options.suggester.historyItems,onSearch:function(e,t,o){e||(options.allowFiltersForEmpty||uiSearch.removeAllFilters(el),uiSearch.hideProgress(el)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(wrapEl,"ui_search_field_empty",!e),options.onChange&&options.onChange.call(el,e,t,o)}})),mainHandler={start:function(){addEvent(el,"blur",onBlur),options.onBlur&&addEvent(el,"blur",options.onBlur),options.onFocus&&addEvent(el,"focus",options.onFocus)},stop:function(){removeEvent(el,"blur",onBlur),options.onBlur&&removeEvent(el,"blur",options.onBlur),options.onFocus&&removeEvent(el,"focus",options.onFocus)}};else{var searchBtn=geByClass1("_ui_search_button_search",wrapEl),onBtnClick=function(e){uiSearch.onEnter(el,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(el)};mainHandler={start:function(){addEvent(el,"keydown",onKeyDown),addEvent(el,"paste cut input",onBuffer),addEvent(el,"blur",onBlur),options.onBlur&&addEvent(el,"blur",options.onBlur),options.onFocus&&addEvent(el,"focus",options.onFocus),searchBtn&&addEvent(searchBtn,"click",onBtnClick)},stop:function(){removeEvent(el,"keydown",onKeyDown),removeEvent(el,"paste cut input",onBuffer),removeEvent(el,"blur",onBlur),options.onBlur&&removeEvent(el,"blur",options.onBlur),options.onFocus&&removeEvent(el,"focus",options.onFocus),searchBtn&&removeEvent(searchBtn,"click",onBtnClick)}}}if(mainHandler.start(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"eventHandlers",[mainHandler]),options.params){var content=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.se)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(options.params.html));options.paramsTooltip=new _web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_4__.default(geByClass1("_ui_search_params_button",wrapEl),{appendTo:wrapEl,content,autoShow:!1,customShow:!0,offset:[0,-2],shift:options.params.shift?options.params.shift:0}),options.paramsTooltip.build(),setTimeout((function(){(function initScript(){try{eval(options.params.script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,options.params.script)}}).call(el)}))}options.fixed&&uiSearch.setFixed(el),options.noAutoDestroy||cur.destroy.push(uiSearch.stopEvents.pbind(el)),uiSearch.initFilters(el,options),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.isFunction)(options.onInit)&&options.onInit(el,options)}}},getOptions:function(e){var t=uiSearch.getWrapEl(e),o=geByClass1("_field",t);return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"opts")},toggleParameters:function(e){var t=uiSearch.getOptions(e);t.paramsTooltip&&t.paramsTooltip.toggle()},hideParameters:function(e){var t=uiSearch.getOptions(e);t.paramsTooltip&&t.paramsTooltip.hide()},saveHistorySearch:function(e,t,o,i,r,s){t||(t=val(e));var n=uiSearch.getOptions(e);n.suggester&&n.suggester.instance&&n.suggester.instance.saveHistoryItem(t,o,i,r,s)},onEnter:function(e,t){e=uiSearch.getFieldEl(e);var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts"),i=e.getValue?e.getValue():e.value;return o.onEnter&&o.onEnter(e,i,t),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t)},onKeyDown:function(e,t){if(cur.preventInputActions&&-1!=[KEY.RETURN,KEY.ESC,KEY.DOWN,KEY.UP].indexOf(t.keyCode))return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t);if(t.keyCode==KEY.RETURN)return uiSearch.onEnter(e,t);if(t.keyCode==KEY.ESC){var o=!!val(e);return uiSearch.reset(e,!1,t),!o||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t)}setTimeout.pbind(uiSearch.onChanged.pbind(e,!1,t),0)},onBlurred:function(e,t){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts");o.onBlur&&o.onBlur.call(e,t)},onChanged:function(e,t,o){e=uiSearch.getFieldEl(e);var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts"),r=uiSearch.getWrapEl(e),s=e.getValue?e.getValue():e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(r,"ui_search_field_empty",!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(s)),s||i.allowFiltersForEmpty||uiSearch.removeAllFilters(e),t||i.onChange&&i.onChange.call(e,s,o)},focus:function(e){e=uiSearch.getFieldEl(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(e)},reset:function(e,t,o){e=uiSearch.getFieldEl(e);var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts")||{},r=uiSearch.getWrapEl(e);(e.getValue?e.getValue():e.value)?(val(e,""),uiSearch.onChanged(e,t,o),t||i.onEnter&&i.onEnter(e,""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(e)):i.in_tabs&&_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_6__.default.hideSearch(r),window.tooltips&&tooltips.destroyAll()},showProgress:function(e){e=uiSearch.getFieldEl(e);var t=uiSearch.getWrapEl(e);addClass(t,"ui_search_loading");var o=e.getValue?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(e.getValue()):e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(t,"ui_search_field_empty",!o)},hideProgress:function(e){e=uiSearch.getFieldEl(e);var t=uiSearch.getWrapEl(e);removeClass(t,"ui_search_loading");var o=e.getValue?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(e.getValue()):e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(t,"ui_search_field_empty",!o)},scrollResize:function(e){if(!_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.mobile){e=uiSearch.getFieldEl(e);var t,o=uiSearch.getWrapEl(e),i=o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(o),r=o&&hasClass(o,"ui_search_fixed"),s=ge(cur.uiSearchPageBlock)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("page_block",e),n=vk.staticheader?Math.max(0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_header"))[1]-scrollNode.scrollTop):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_header"))[1],a=o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isAncestor)(o,boxLayerWrap);if(o&&i&&(a||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("scroll_fix",o))&&(!e.ignoreFixed||r)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(i))if(a?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(i,!0)[1]<0:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(i,!0)[1]<n){var l=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getStyle)(e,"width"));!r&&l&&(setStyle(i,"height",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(o)[1]),setStyle(o,"width",l),addClass(o,"ui_search_fixed"));var d=Math.min(0,Math.max(-bodyNode.scrollLeft,bodyNode.clientWidth-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_layout"))[0]));if(setStyle(o,{marginLeft:d}),s){var c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(s)[1]+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(s)[1]-(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_9__.scrollGetY)()-e.offsetHeight;(t=Math.min(n,Math.max(-e.offsetHeight,c)))!==cur.lastUISearchPos&&(setStyle(o,"top",t),cur.lastUISearchPos=t)}}else r&&(setStyle(i,"height",""),setStyle(o,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,removeClass(o,"ui_search_fixed"))}},setStatic:function(e){e.ignoreFixed=!0;var t=uiSearch.getWrapEl(e),o=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(t);t&&o&&(setStyle(o,"height",""),setStyle(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,removeClass(t,"ui_search_fixed"))},setFixed:function(e){if(e.ignoreFixed=!1,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"resizeEventHandler")){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isAncestor)(e,boxLayerWrap)?boxLayerWrap:window,o=uiSearch.scrollResize.pbind(e),i={stop:removeEvent.pbind(t,"scroll",o),start:addEvent.pbind(t,"scroll",o)};(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers",((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[]).concat([i])),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"resizeEventHandler",!0),i.start()}uiSearch.scrollResize(e)},initFilters:function(e,t){if(e){var o=uiSearch.getWrapEl(e),i=geByClass1("ui_search_fltr_control",o),r={start:function(){addEvent(i,"click",(function(e){hasClass(i,"shown")&&!hasClass(e.target,"ui_search_fltr_control")||n(i)})),addEvent(i,"mouseover",(function(){if(hasClass(i,"shown")){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"hidetimer");e&&(clearTimeout(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"hidetimer",0)),n(i,!0)}})),addEvent(i,"mouseout",(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"hidetimer")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"hidetimer",setTimeout((function(){n(i,!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"hidetimer",0)}),200))}))},stop:removeEvent.pbind(i,"click mouseover mouseout")};(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers",((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[]).concat([r])),r.start();var s=uiSearch._getFiltersPane(e);addEvent(s,"click",(function(t){if(hasClass(t.target,"token_title")||hasClass(t.target,"token_del")){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("token",t.target),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(o,"id");uiSearch.removeFilter(e,i)}}))}function n(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(e,"shown",t)}},removeAllFilters:function(e){var t=uiSearch._getFiltersPane(e),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(t,"cur_filters");each(extend({},o),(function(t){uiSearch.removeFilter(e,t,!0)}))},toggleFilter:function(e,t,o,i){i?uiSearch.addFilter(e,t,o):uiSearch.removeFilter(e,t)},addFilter:function(e,t,o){if(t&&o){var i=uiSearch._getFiltersPane(e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"cur_filters")||{};r[t]=o,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"cur_filters",r);var s=uiSearch.getOptions(e);s.onFiltersChanged&&s.onFiltersChanged(r),uiSearch._renderFilters(e)}},removeFilter:function(e,t,o){var i=uiSearch._getFiltersPane(e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"cur_filters")||{};if(r[t]){delete r[t],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"cur_filters",r);var s=uiSearch.getOptions(e);s.onFilterRemoved&&s.onFilterRemoved(t,e,o),s.onFiltersChanged&&s.onFiltersChanged(r),uiSearch._renderFilters(e)}},_getFiltersPane:function(e){var t=uiSearch.getWrapEl(e)||e;return geByClass1("ui_search_filters_pane",t)},_renderFilters:function(e){clearTimeout((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"renderFiltersTO")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"renderFiltersTO",setTimeout(uiSearch._doRenderFilters.pbind(e)))},_doRenderFilters:function(e){var t=uiSearch._getFiltersPane(e),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(t,"cur_filters")||{},i=geByClass1("ui_search_filters",t);if(i)if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.isEmpty)(o))removeClass(t,"expanded"),setTimeout((function(){i.innerHTML="",hide(t)}),200);else{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClassDelayed)(t,"expanded");var r=[],s={},n=0;each(o,(function(e,t){var o=!1,i=!1,a=e.match(/(.*?)_([^_]+)$/),l=a&&a[2]||!1;(a=a&&a[1]||!1)&&(void 0!==s[a]&&"from"===l?i=s[a]:void 0!==s[a]&&(o=s[a]+1),s[a]=n);var d=`<div class="token" id="token${e}" data-id="${e}">\n                         <div class="token_title">${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.replaceEntities)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)(t))}</div>\n                         <div class="token_del"></div>\n                       </div>`;!1!==i?r.splice(i,0,d):!1!==o?r.splice(o,0,d):r.push(d),n++})),i.innerHTML=r.join("")}}};const __WEBPACK_DEFAULT_EXPORT__=uiSearch},892862:(e,t,o)=>{o.d(t,{default:()=>l});var i=o(414914),r=o(442699),s=o(206566),n=o(917685),a={initTabs:function(e,t){if(!(s.browser.msie&&(0,r.intval)(s.browser.version)<10||s.browser.opera&&(0,r.intval)(s.browser.version)<15||hasClass(e,"ui_tabs_sliding"))){var o=(0,i.getSize)(t)[0],n=t.offsetLeft,a=(0,i.geByClass1)("_ui_tabs_slider",e);if(!(0,i.domData)(e,"inited"))setStyle(a,{width:o+"px",marginLeft:n})}},tryInit:function(e){if(!(0,i.domData)(e,"inited")){var t=(0,i.geByClass1)("ui_tab_group_sel",e)||(0,i.geByClass1)("ui_tab_sel",e);t&&a.initTabs(e,t),(0,i.domData)(e,"inited",1)}},goTab:function(e,t,o){if((0,n.checkEvent)(t))return!0;var r=(0,i.gpeByClass)("ui_tabs",e);return!(!o&&(0,i.geByClass1)("ui_tab_sel",r)==e)&&(a.switchTab(e),a.showProgress(r),nav.go(e,t,{tab:e}))},switchTab:function(e,t){var o=(0,i.gpeByClass)("ui_tabs",e),s=(0,i.geByClass1)("ui_tab_sel",o),n=null,l=null,d=hasClass(s,"ui_tab_group_item")?l=(0,i.gpeByClass)("ui_tab_group",s):s,c=hasClass(e,"ui_tab_group_item")?n=(0,i.gpeByClass)("ui_tab_group",e):e;if(e!=s){if(e!=c&&(a.toggleGroup(c,!1),a.resetLabel(c,e)),d){a.initTabs(o,d),(t=t||{}).noAnim||c===d||(addClass(o,"ui_tabs_sliding"),clearTimeout(cur.tabSlidingTO),cur.tabSlidingTO=setTimeout(removeClass.pbind(o,"ui_tabs_sliding"),300));var _=(0,i.geByClass1)("_ui_tabs_slider",o),u=(0,r.intval)(_.style.marginLeft),h={width:(0,i.getSize)(c)[0]+"px"};h[cssTransformProp]="translateX("+(c.offsetLeft-u)+"px)",setStyle(_,h),s!=d&&c!=d&&a.resetLabel(d),d!=s&&removeClass(d,"ui_tab_group_sel"),removeClass(s,"ui_tab_sel")}if(c!=e&&addClass(c,"ui_tab_group_sel"),addClass(e,"ui_tab_sel"),l&&removeClass(l,"ui_tab_hide_separator"),n){o=(0,i.geByClass1)("ui_tab_group_items",n,"div").children;var p=null;each(o,(function(e,t){"SPAN"===t.tagName?p=t:hasClass((0,i.domFC)(t),"ui_tab_sel")||hasClass(t,"unshown")||(p=null)})),p&&addClass(n,"ui_tab_hide_separator")}}return!1},resetLabel:function(e,t){var o=(0,i.geByClass1)("ui_tab_group_label",e,"span");o&&(o.innerHTML=(t||o).getAttribute("data-default-label"))},toggleGroup:function(e,t){var o=(0,i.data)(e,"visibletimer");o&&clearTimeout(o),(0,i.data)(e,"visibletimer",setTimeout(i.toggleClass.pbind(e,"visible",t),t?0:100)),(0,i.toggleClass)(e,"shown",t)},showGroup:function(e){var t=(0,i.data)(e,"hidetimer");t&&(clearTimeout(t),(0,i.data)(e,"hidetimer",0)),a.toggleGroup(e,!0)},hideGroup:function(e){(0,i.data)(e,"hidetimer")||(0,i.data)(e,"hidetimer",setTimeout((function(){a.toggleGroup(e,!1),(0,i.data)(e,"hidetimer",0)}),200))},showProgress:function(e){hasClass(e,"ui_tabs")||(e=(0,i.gpeByClass)("ui_tabs",e)),addClass(e,"ui_tabs_loading")},hideProgress:function(e){hasClass(e,"ui_tabs")||(e=(0,i.gpeByClass)("ui_tabs",e)),removeClass(e,"ui_tabs_loading")},showSearch:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if((0,n.checkEvent)(t))return!0;var o=(0,i.gpeByClass)("ui_tabs",e),r=(0,i.domByClass)(o,"_field");return addClass(o,"ui_tabs_search_opened"),uiSearch.focus(r),!1},hideSearch:function(e,t){if((0,n.checkEvent)(t))return!0;var o=(0,i.gpeByClass)("ui_tabs",e);return removeClass(o,"ui_tabs_search_opened"),!1}};const l=a},651525:(e,t,o)=>{o.d(t,{StickersAnimation:()=>i.StickersAnimation});o(940851),o(296253);var i=o(457865),r=o(401346);i.StickersAnimation.init({animatorLoader:()=>Promise.resolve(r.default)})},381862:(e,t,o)=>{o.d(t,{removeUnseenStories:()=>s});o(991181),o(579665),o(95767),o(530522),o(66108),o(296253);function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(e,t)}(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s,n=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return n=e.done,e},e:function(e){a=!0,s=e},f:function(){try{n||null==i.return||i.return()}finally{if(a)throw s}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function s(e){var t;if(n(document,e),null===(t=window.wkcur)||void 0===t?void 0:t.pageReplaced){var o,r=i(window.wkcur.pageReplaced);try{for(r.s();!(o=r.n()).done;){n(o.value[0],e)}}catch(e){r.e(e)}finally{r.f()}}}function n(e,t){var o,r=i(e.querySelectorAll(".reply_image_stories_unseen"+t));try{for(r.s();!(o=r.n()).done;){var s,n=o.value;n.classList.remove("reply_image_stories_unseen","reply_image_stories_unseen"+t),null===(s=n.closest(".reply_image"))||void 0===s||s.removeAttribute("onclick")}}catch(e){r.e(e)}finally{r.f()}var a,l=i(e.querySelectorAll(".post_image_stories_unseen"+t));try{for(l.s();!(a=l.n()).done;){var d,c=a.value;c.classList.remove("post_image_stories_unseen","post_image_stories_unseen"+t),null===(d=c.closest(".post_image"))||void 0===d||d.removeAttribute("onclick")}}catch(e){l.e(e)}finally{l.f()}}},206155:(e,t,o)=>{o.d(t,{removeUnseenStories:()=>s});o(991181),o(579665),o(95767),o(530522),o(66108),o(296253);function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return r(e,t)}(e))){var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s,n=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return n=e.done,e},e:function(e){a=!0,s=e},f:function(){try{n||null==i.return||i.return()}finally{if(a)throw s}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function s(e){var t,o=i(document.querySelectorAll(".search_item_img_stories_unseen"+e));try{for(o.s();!(t=o.n()).done;){var r,s=t.value;s.classList.remove("search_item_img_stories_unseen","search_item_img_stories_unseen"+e),null===(r=s.closest(".search_item_img_link"))||void 0===r||r.removeAttribute("onclick")}}catch(e){o.e(e)}finally{o.f()}}},616515:(e,t,o)=>{o.d(t,{default:()=>l});o(530522),o(66108),o(296253),o(991181),o(579665),o(95767);var i=o(414914),r=o(719016),s=o(506362);function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],i=!0,r=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}const l={SCROLL_EDGE_BELOW_THRESHOLD:20,MAX_COMMENTS_NUM:150,MAX_LIKES_PER_BATCH:7,MAX_STICKERS_PER_BATCH:7,init(e,t){VideoChat.block&&VideoChat.destroy(),e&&(VideoChat.block=e,VideoChat.options=extend({},t),VideoChat.messagesWrap=domByClass(e,"mv_chat_messages_wrap"),VideoChat.stickersWrap=domByClass(e,"mv_chat_stickers_wrap"),VideoChat.scroll=new uiScroll(domFC(VideoChat.messagesWrap),{global:!0,hidden:t.scrollHidden,reversed:!0,preserveEdgeBelow:!0,preserveEdgeBelowThreshold:VideoChat.SCROLL_EDGE_BELOW_THRESHOLD,theme:"videoview",onupdate:VideoChat.onScrollUpdate}),this.scrollBottomBtnWrap=domByClass(e,"mv_chat_new_messages_btn_wrap"),VideoChat.replyForm=domByClass(e,"mv_chat_reply_form"),VideoChat.replyForm&&(VideoChat.replyInput=domByClass(e,"mv_chat_reply_input"),VideoChat.initReplyInput()),VideoChat.firstMsgIntro=domByClass(e,"mv_chat_first_message_intro"))},initReplyInput(){placeholderInit(VideoChat.replyInput,{editable:!0,global:!0}),stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){var e=Emoji.init(VideoChat.replyInput,{forceStickerPack:VideoChat.options.forceStickerPack,controlsCont:VideoChat.replyForm,noLineBreaks:1,noCtrlSend:1,ref:"video_chat",onSend:function(){VideoChat.sendMessage()},checkEditable:function(){VideoChat.checkFormHeight(),VideoChat.checkTextLen()},onStickerSend:function(e){VideoChat.sendSticker(e)}});(0,i.data)(VideoChat.replyForm,"optId",e)}))},checkFormHeight(){var e=VideoChat.replyForm,t=e.offsetHeight;if(e.lastHeight!==t){e.lastHeight=t;var o=!VideoChat.scroll.data.scrollBottom;setStyle(VideoChat.messagesWrap,{bottom:t+"px"}),o&&VideoChat.scroll.scrollBottom()}},checkTextLen(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VideoChat.replyInput,t=trim(Emoji.editableVal(e));if(e.lastLen!==t.length)if((e.lastLen=t.length)>mvcur.maxChatReplyLength){var o=cur.storyLayer?"stories_live_chat_msg_too_long":"video_live_chat_msg_too_long";(0,r.showTooltip)(e,{black:1,text:getLang(o),shift:!!cur.storyLayer&&[-30,10]})}else window.tooltips&&tooltips.destroy(e)},mentionOver:e=>window.mentionOver(e,{shift:[-20,7,7]}),stickerClick:(e,t,o)=>(stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.clickSticker(e,t,o)})),!1),onScrollUpdate(e){e.data.scrollBottom<VideoChat.SCROLL_EDGE_BELOW_THRESHOLD&&VideoChat.toggleScrollBottomBtn(!1)},receiveMessage(e,t,o,i,r,s,n,a,l){if(intval(l))VideoChat.appendSticker(l,o);else{var d=!1;window.replyAsList&&window.replyAsList.length&&each(window.replyAsList,(function(){if(this[0]==o)return d=!0,!1}));var c=Videoview.getMvData(),_=c.adminLevel,u=c.canDeleteComments,h="";(_>constants.Groups.GROUPS_ADMIN_LEVEL_USER||u||e==vk.id||o==vk.id||d)&&(h+=getTemplate("video_chat_message_action_del",{video_owner_id:e,msg_id:t}));var p=psr(getTemplate("video_chat_message",{author_href:s,author_photo:psr(r),author_name:i,message:a,video_owner_id:e,msg_id:t,actions:h,classes:o==e?"mv_chat_admin_message":""}));VideoChat.appendMessage(p,t)}},receiveDelete(e,t){var o="#mv_chat_msg"+mvcur.mvData.oid+"_"+t,i=VideoChat._messagesBatch&&VideoChat._messagesBatch.querySelector(o);i?re(i):(i=VideoChat.messagesWrap.querySelector(o))&&!hasClass(i,"_deleting")&&VideoChat.scroll.updateAbove((function(){re(i)}))},checkStickerFlood(e,t){var o=mvcur.queueBatchId;VideoChat._stickersLimits&&VideoChat._stickersLimits.batch==o||(VideoChat._stickersLimits={batch:o,like:0,sticker:0},VideoChat._stickersDelay=0);var i="like"==e?"like":"sticker",r="like"==i?VideoChat.MAX_LIKES_PER_BATCH:VideoChat.MAX_STICKERS_PER_BATCH;return!(++VideoChat._stickersLimits[i]>r&&t!=vk.id)},appendSticker(e,t){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!VideoChat.isHidden()&&!Videoview.isFS&&"hidden"!=document.visibilityState&&"animation"in bodyNode.style&&"onanimationend"in window){if(t==vk.id){var i=VideoChat.recentlySentSticker;if(i&&i.stickerId==e&&i.fromQueue!=o&&Date.now()-i.time<3e3)return;VideoChat.recentlySentSticker={stickerId:e,fromQueue:o,time:Date.now()}}else if(!VideoChat.checkStickerFlood(e,t))return;if("like"==e){var r=ce("div",{className:"mv_chat_like"});n(r),addEvent(r,"animationend",l),a(r)}else{var s=ce("img",{className:"mv_chat_sticker",src:Stickers.getStickerUrl(e,(isRetina()?128:64)+"b")});n(s),addEvent(s,"error animationend",l),addEvent(s,"load",a)}}function n(e){for(var o="",i=0,r=0,s=0,n=intval((VideoChat.getHeight()-80)/6),a=0;a<=100;a+=20){a>0&&(i+=irand(-4,4),r-=n,s+=irand(-4,4),n=intval(.9*n)),o+=`\n          ${a}% {\n            transform: translate(${i}px, ${r}px) rotate(${s}deg) scale(${a?1:.7});\n            opacity: ${0==a||100==a?0:1};\n          }\n        `}var l="mv_chat_sticker_animation_"+Date.now()+"_"+irand(0,1e9);o=`@keyframes ${l} {${o}}`,e.appendChild(ce("style",{innerHTML:o}));var d=irand(1500,2500)+"ms",c=(t==vk.id?0:VideoChat._stickersDelay+=100)+"ms";setStyle(e,{animation:[l,d,c,"linear"].join(" ")})}function a(e){var t=e.currentTarget||e;(VideoChat._stickersBatch||(VideoChat._stickersBatch=document.createDocumentFragment())).appendChild(t),VideoChat._appendStickerTimeout||(VideoChat._appendStickerTimeout=setTimeout((function(){VideoChat.appendStickersBatch(),VideoChat._appendStickerTimeout=null}),0))}function l(e){var t=e.currentTarget||e;removeEvent(t),re(t)}},appendStickersBatch(){var e=VideoChat._stickersBatch;e&&(VideoChat._stickersBatch=null,VideoChat.isHidden()||VideoChat.stickersWrap.appendChild(e))},removeStickers(){if(VideoChat.stickersWrap)for(var e;e=domFC(VideoChat.stickersWrap);)removeEvent(e),re(e)},appendMessage(e,t){var o=VideoChat._messagesBatch||(VideoChat._messagesBatch=document.createDocumentFragment()),i="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;if(!VideoChat.messagesWrap.querySelector(i)&&!o.querySelector(i)){o.appendChild(se(e));for(var r=o.childNodes;o.childNodes.length>VideoChat.MAX_COMMENTS_NUM;)re(r[0]);VideoChat.isHidden()||VideoChat._appendMessageTimeout||(VideoChat._appendMessageTimeout=setTimeout((function(){VideoChat.appendMessagesBatch(),VideoChat._appendMessageTimeout=null}),0))}},appendMessagesBatch(){if(!VideoChat.isHidden()){var e=VideoChat._messagesBatch;if(e){VideoChat._messagesBatch=null;var t=geByClass("mv_chat_message_author_thumb_img",e,"img");each(t,(function(e,t){attr(t,"src")||attr(t,"src",domData(t,"src"))})),VideoChat.firstMsgIntro&&(re(VideoChat.firstMsgIntro),VideoChat.firstMsgIntro=null);var o=VideoChat.scroll.content;VideoChat.scroll.updateBelow((function(){o.appendChild(e)})),VideoChat.scroll.updateAbove((function(){for(var e=o.childNodes;e.length>VideoChat.MAX_COMMENTS_NUM;)re(e[0])})),VideoChat.scroll.data.scrollBottom>100&&VideoChat.toggleScrollBottomBtn(!0)}}},toggleScrollBottomBtn(e){toggleClass(this.scrollBottomBtnWrap,"hidden",!e)},scrollBottom(){VideoChat.scroll.scrollBottom(0)},replyAsAnimate(e,t,o){var i=e&&geByClass1("mv_chat_reply_author_photo",e),r=i&&geByClass("mv_chat_reply_author_photo_img",i),s=hasClass(e,"mv_chat_author_secondary")?0:1;r&&r[s]&&(r[s].src=o),toggleClass(e,"mv_chat_author_secondary")},replyAsGroup(e,t){window.replyAsList?VideoChat.replyAsGroupTT(e,t):(window.replyAsList=[],window.replyAsData={},domData(e,"can_reply_as_any_group")?ajax.post("/al_groups.php?act=get_editor_clubs",{},{cache:1,onDone:function(o){window.replyAsList=o,each(o,(function(e,t){var o=n(t,4),i=o[0];o[1],o[2],o[3];window.replyAsData[i]=this})),VideoChat.replyAsGroupTT(e,t)}}):VideoChat.replyAsGroupTT(e,t))},replyAsGroupList(e,t,o){var i=[o],r=domByClass(e,"mv_chat_reply_group_data");if(r){var s=[domData(r,"group_id"),domData(r,"group_photo"),domData(r,"group_href"),domData(r,"group_name")];i.push(s),window.replyAsData[s[0]]=s}return each(window.replyAsList,(function(e,o){var r=n(o,4),s=r[0];r[1],r[2],r[3];s!=t&&i.push(this)})),i},replyAsGroupOver(e){var t=gpeByClass("mv_chat_reply_form",e);(0,r.showTooltip)(e,{text:function(){return domData(t,"from-oid")<0?getLang("global_on_behalf_group"):getLang("global_on_behalf_me")},black:1,shift:[9,8,8]})},replyAsGroupTT(e,t){var o=VideoChat.replyAsProfileData(),r=gpeByClass("mv_chat_reply_form",e),s=r&&domData(r,"from-oid"),a=(0,i.data)(e,"tt");if(!o)return!1;if(!a){var l=VideoChat.replyAsGroupList(e,t,o),d="";each(l,(function(e,t){var o=n(t,4),i=o[0],r=o[1],a=o[2],l=o[3];d+=getTemplate("video_chat_message_author_select_row",{author_id:i,author_href:a,author_photo:r,author_name:l,classes:s==i?" active":""})})),a=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+d+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"top",offset:function(){return[0,-5]},onFirstTimeShow:function(t){var o=geByClass("post_from_tt_row",t);each(o,(function(t,o){addEvent(o,"click",VideoChat.setReplyAsGroup.pbind(e,{from:domData(this,"from-oid")}))})),this.rows=o,this.scroll=new uiScroll(geByClass1("_post_scroll_wrap",t)),setTimeout((function(){a.scroll.update(),a.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(a.scroll){var t=geByClass1("active",e),o=t?t.offsetTop-(a.scroll.data.viewportHeight-getSize(t)[1])/2:0;a.scroll.scrollTop(o)}}),0)},onHide:function(e){}}),(0,i.data)(e,"tt",a)}t&&a.isShown()&&VideoChat.setReplyAsGroup(e,{from:s==vk.id?t:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),a.isShown()||a.show()},replyAsProfileData:()=>window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData,setReplyAsGroup(e,t){if(!e)return!1;var o=domClosest("mv_chat_reply_form",e),r=(0,i.data)(e,"tt"),s=t.from||(t.fromGroup?cur.oid:vk.id),n=s==vk.id?VideoChat.replyAsProfileData():window.replyAsData&&window.replyAsData[s];return!(domData(o,"from-oid")==s||!n||n[0]!=s)&&(domData(o,"from-oid",s),VideoChat.replyAsAnimate(o,n[2],n[1]),r&&r.rows&&each(r.rows,(function(){toggleClass(this,"active",domData(this,"from-oid")==s)})),e.setAttribute("aria-label",getLang(s<0?"wall_reply_as_group":"wall_reply_as_user")),!1)},sendMessage(){if(!VideoChat.messageSending){var e={message:trim(Emoji.val(VideoChat.replyInput))};if(e.message){if(vkNow()-VideoChat.lastMsgSent<1e3)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),void(0,r.showTooltip)(VideoChat.replyInput,{text:getLang("video_live_chat_too_fast"),black:1});var t=Videoview.getMvData(),o=geByClass1("mv_chat_reply_form",this.block);o&&domData(o,"from-oid")&&(e.from_oid=domData(o,"from-oid")),ajax.post("al_video.php?act=post_comment",Wall.fixPostParams(extend(e,{video:t.videoRaw,hash:t.hash,videoviewer_chat:1})),{onDone:function(e,t){VideoChat.messageSending=!1,e&&t&&VideoChat.appendMessage(e,t),Emoji.val(VideoChat.replyInput,""),VideoChat.checkFormHeight(),VideoChat.scroll.data.scrollBottom&&VideoChat.scrollBottom(),VideoChat.lastMsgSent=vkNow(),mvcur.player&&mvcur.player.vars.stats_tmr&&(0,s.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onFail:function(e){if(VideoChat.messageSending=!1,VideoChat.replyInput)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),(0,r.showTooltip)(VideoChat.replyInput,{text:e,showdt:200,forcetodown:0,slide:15,black:1}),elfocus(VideoChat.replyInput),!0}}),VideoChat.messageSending=!0}else elfocus(VideoChat.replyInput)}},sendSticker(e){var t=Videoview.getMvData();ajax.post("al_video.php?act=live_send_sticker",{sticker_id:e,owner_id:t.oid,video_id:t.vid,hash:t.hash},{onDone(){VideoChat.appendSticker(e,vk.id,!1)}})},deleteMessage(e,t){var o=ge("mv_chat_msg"+e);addClass(o,"_deleting"),ajax.post("al_video.php?act=delete_comment",{comment:e,hash:t,videoview_chat:1},{onDone(e){val(domByClass(o,"mv_chat_message_content"),e)}})},isHidden(){return!!this.hidden||Videoview.isMinimized()},setHidden(e){this.hidden=e},toggle(){var e=VideoChat.isHidden();this.setHidden(!e),VideoChat.toggleStateClasses(),e&&VideoChat.scroll&&(VideoChat.appendMessagesBatch(),VideoChat.updateScroll()),e||VideoChat.removeStickers()},toggleStateClasses(){var e=!!this.block,t=VideoChat.isHidden(),o=Videoview.isMinimized();toggleClass("mv_box","_has_chat",e&&!o),toggleClass("mv_box","_hide_chat",e&&!o&&t);var i="";e&&(VideoChat.appendMessagesBatch(),i=getLang(t?"video_aria_expand_chat":"video_aria_minimize_chat")),ge("mv_top_pl_toggle")&&attr("mv_top_pl_toggle","aria-label",i)},updateScroll(){VideoChat.scroll.update(),VideoChat.scroll.scrollBottom(),VideoChat.toggleScrollBottomBtn(!1)},onResize(){VideoChat.block&&(VideoChat._chatHeight=VideoChat.block.offsetHeight)},getHeight:()=>VideoChat.block?VideoChat._chatHeight||(VideoChat._chatHeight=VideoChat.block.offsetHeight):0,destroy(){if(VideoChat.block){if(VideoChat.scroll&&(VideoChat.scroll.destroy(),VideoChat.scroll=null),VideoChat.replyForm){var e=(0,i.data)(VideoChat.replyForm,"optId");void 0!==e&&Emoji.destroy(e),(0,i.removeData)(VideoChat.replyForm),(0,i.removeData)(VideoChat.replyInput),VideoChat.replyForm=VideoChat.replyInput=null}VideoChat.removeStickers(),(0,i.removeData)(VideoChat.block),re(VideoChat.block),VideoChat.block=null,VideoChat.messagesWrap=null,VideoChat.stickersWrap=null,VideoChat.options=null,clearTimeout(VideoChat._appendMessageTimeout),clearTimeout(VideoChat._appendStickerTimeout),VideoChat._appendMessageTimeout=null,VideoChat._appendStickerTimeout=null,VideoChat._messagesBatch=null,VideoChat.firstMsgIntro=null,VideoChat.messageSending=!1,VideoChat.toggleStateClasses()}}}},438130:(e,t,o)=>{o.d(t,{default:()=>l});var i=o(667294),r=(o(45697),o(659397)),s=o(542104),n=o(920053),a=e=>{var t=e.children,o=e.isVerified,a=e.verifiedText,l=e.className;return i.createElement("div",{className:(0,r.classNames)("OwnerName",l)},i.createElement(n.default,null,t),!!o&&i.createElement(s.default,{verifiedText:a,className:"OwnerName__verified"}))};a.defaultProps={isVerified:!1,verifiedText:""};const l=a},542104:(e,t,o)=>{o.d(t,{default:()=>a});o(175115),o(95767),o(991181),o(296253);var i=o(667294),r=(o(45697),o(659397));function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}function n(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}const a=e=>{var t=e.verifiedText,o=e.className,a=n(e,["verifiedText","className"]);return i.createElement("div",s({className:(0,r.classNames)("VerifiedMarker",o)},a,{"aria-label":t}),i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",className:"VerifiedMarker__icon","aria-hidden":"true"},i.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.25 6.75L4.5 9l5.25-5.25"})))}},429697:(e,t,o)=>{o.d(t,{default:()=>u});var i=o(654337),r=o(773949),s=o(486186),n=(o(45697),o(292859)),a=o(316787),l=o(667294),d=o(696630),c=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return(0,a.default)(e,t)}))},_=function(e){function t(){for(var t,o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,o){t.removeClasses(e,"exit"),t.addClass(e,o?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,o)},t.onEntering=function(e,o){var i=o?"appear":"enter";t.addClass(e,i,"active"),t.props.onEntering&&t.props.onEntering(e,o)},t.onEntered=function(e,o){var i=o?"appear":"enter";t.removeClasses(e,i),t.addClass(e,i,"done"),t.props.onEntered&&t.props.onEntered(e,o)},t.onExit=function(e){t.removeClasses(e,"appear"),t.removeClasses(e,"enter"),t.addClass(e,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){t.addClass(e,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){t.removeClasses(e,"exit"),t.addClass(e,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.getClassNames=function(e){var o=t.props.classNames,i="string"==typeof o,r=i?""+(i&&o?o+"-":"")+e:o[e];return{baseClassName:r,activeClassName:i?r+"-active":o[e+"Active"],doneClassName:i?r+"-done":o[e+"Done"]}},t}(0,s.default)(t,e);var o=t.prototype;return o.addClass=function(e,t,o){var i=this.getClassNames(t)[o+"ClassName"];"appear"===t&&"done"===o&&(i+=" "+this.getClassNames("enter").doneClassName),"active"===o&&e&&e.scrollTop,this.appliedClasses[t][o]=i,function(e,t){e&&t&&t.split(" ").forEach((function(t){return(0,n.default)(e,t)}))}(e,i)},o.removeClasses=function(e,t){var o=this.appliedClasses[t],i=o.base,r=o.active,s=o.done;this.appliedClasses[t]={},i&&c(e,i),r&&c(e,r),s&&c(e,s)},o.render=function(){var e=this.props,t=(e.classNames,(0,r.default)(e,["classNames"]));return l.createElement(d.default,(0,i.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(l.Component);_.defaultProps={classNames:""},_.propTypes={};const u=_},696630:(e,t,o)=>{o.d(t,{default:()=>v});var i=o(773949),r=o(486186),s=(o(45697),o(667294)),n=o(973935),a=o(806035),l=o(500220),d="unmounted",c="exited",_="entering",u="entered",h="exiting",p=function(e){function t(t,o){var i;i=e.call(this,t,o)||this;var r,s=o&&!o.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?s?(r=c,i.appearStatus=_):r=u:r=t.unmountOnExit||t.mountOnEnter?d:c,i.state={status:r},i.nextCallback=null,i}(0,r.default)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===d?{status:c}:null};var o=t.prototype;return o.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},o.componentDidUpdate=function(e){var t=null;if(e!==this.props){var o=this.state.status;this.props.in?o!==_&&o!==u&&(t=_):o!==_&&o!==u||(t=h)}this.updateStatus(!1,t)},o.componentWillUnmount=function(){this.cancelNextCallback()},o.getTimeouts=function(){var e,t,o,i=this.props.timeout;return e=t=o=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,o=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:o}},o.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t){this.cancelNextCallback();var o=n.findDOMNode(this);t===_?this.performEnter(o,e):this.performExit(o)}else this.props.unmountOnExit&&this.state.status===c&&this.setState({status:d})},o.performEnter=function(e,t){var o=this,i=this.props.enter,r=this.context?this.context.isMounting:t,s=this.getTimeouts(),n=r?s.appear:s.enter;!t&&!i||a.default.disabled?this.safeSetState({status:u},(function(){o.props.onEntered(e)})):(this.props.onEnter(e,r),this.safeSetState({status:_},(function(){o.props.onEntering(e,r),o.onTransitionEnd(e,n,(function(){o.safeSetState({status:u},(function(){o.props.onEntered(e,r)}))}))})))},o.performExit=function(e){var t=this,o=this.props.exit,i=this.getTimeouts();o&&!a.default.disabled?(this.props.onExit(e),this.safeSetState({status:h},(function(){t.props.onExiting(e),t.onTransitionEnd(e,i.exit,(function(){t.safeSetState({status:c},(function(){t.props.onExited(e)}))}))}))):this.safeSetState({status:c},(function(){t.props.onExited(e)}))},o.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},o.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},o.setNextCallback=function(e){var t=this,o=!0;return this.nextCallback=function(i){o&&(o=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},o.onTransitionEnd=function(e,t,o){this.setNextCallback(o);var i=null==t&&!this.props.addEndListener;e&&!i?(this.props.addEndListener&&this.props.addEndListener(e,this.nextCallback),null!=t&&setTimeout(this.nextCallback,t)):setTimeout(this.nextCallback,0)},o.render=function(){var e=this.state.status;if(e===d)return null;var t=this.props,o=t.children,r=(0,i.default)(t,["children"]);if(delete r.in,delete r.mountOnEnter,delete r.unmountOnExit,delete r.appear,delete r.enter,delete r.exit,delete r.timeout,delete r.addEndListener,delete r.onEnter,delete r.onEntering,delete r.onEntered,delete r.onExit,delete r.onExiting,delete r.onExited,"function"==typeof o)return s.createElement(l.default.Provider,{value:null},o(e,r));var n=s.Children.only(o);return s.createElement(l.default.Provider,{value:null},s.cloneElement(n,r))},t}(s.Component);function m(){}p.contextType=l.default,p.propTypes={},p.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:m,onEntering:m,onEntered:m,onExit:m,onExiting:m,onExited:m},p.UNMOUNTED=0,p.EXITED=1,p.ENTERING=2,p.ENTERED=3,p.EXITING=4;const v=p},500220:(e,t,o)=>{o.d(t,{default:()=>i});const i=o(667294).createContext(null)},806035:(e,t,o)=>{o.d(t,{default:()=>i});const i={disabled:!1}},654337:(e,t,o)=>{function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}).apply(this,arguments)}o.d(t,{default:()=>i})},486186:(e,t,o)=>{function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}o.d(t,{default:()=>i})},773949:(e,t,o)=>{function i(e,t){if(null==e)return{};var o,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)o=s[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}o.d(t,{default:()=>i})},292859:(e,t,o)=>{o.d(t,{default:()=>r});var i=o(305261);function r(e,t){e.classList?e.classList.add(t):(0,i.default)(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}},305261:(e,t,o)=>{function i(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}o.d(t,{default:()=>i})},316787:(e,t,o)=>{function i(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function r(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=i(e.className,t):e.setAttribute("class",i(e.className&&e.className.baseVal||"",t))}o.d(t,{default:()=>r})},457495:(e,t,o)=>{o.d(t,{MODULE:()=>n,ReportTypeId:()=>i,setServerConnectionErrorSkip:()=>l,handleBackendError:()=>d,renderFullId:()=>c,renderReportFullId:()=>_,parseBackendReportsResponse:()=>u,parseBackendReportResponse:()=>h,createReportDecisionButtonsLoadings:()=>p,areReportsEqual:()=>m,doesReportHaveTheseIds:()=>v});var i,r=o(272342),s=o(621260),n="sf",a=!1;function l(e){a=e}function d(e,t,o,i){var n="object"==typeof t;t=(t=n?"Ошибка соединения с сервером":t)||"Неизвестная ошибка",n&&a||(0,s.showDoneBox)(t);var l=o+": "+JSON.stringify(t);r.logError(e,l,i)}function c(e,t){return e+"_"+t}function _(e){return c(e.receiverId,e.id)}function u(e,t){return e.map((function(e){return h(e,t)}))}function h(e,t){return e.decision&&(e.decision.typeId=t(e)),e}function p(e,t,o){var i={};return e.forEach((function(e){var r=_(e);if(t[r])i[r]=t[r];else{var s={};o.forEach((function(e){return s[e.decisionTypeId]=!1})),i[r]=s}})),i}function m(e,t){return v(e,t.receiverId,t.id)}function v(e,t,o){return e.receiverId===t&&e.id===o}!function(e){e[e.WallComment=1]="WallComment",e[e.Photo=2]="Photo",e[e.WallPost=3]="WallPost",e[e.VideoComment=4]="VideoComment",e[e.PhotoComment=5]="PhotoComment",e[e.Mail=6]="Mail",e[e.TopicComment=7]="TopicComment",e[e.Video=8]="Video",e[e.FriendRequest=9]="FriendRequest",e[e.GroupInvite=10]="GroupInvite",e[e.AppInvite=11]="AppInvite",e[e.MarketComment=14]="MarketComment",e[e.Story=15]="Story",e[e.Article=16]="Article",e[e.Poll=17]="Poll",e[e.GroupComments=18]="GroupComments"}(i||(i={}))},272342:(e,t,o)=>{o.d(t,{sections:()=>n,logEvent:()=>d,logError:()=>c,disableSections:()=>_,downloadLogsFile:()=>u});var i=o(927273),r=o(621260),s=[],n={initialization:"Initialization",deinitialization:"Deinitialization",longPoll:"Long poll",subscriptions:"Subscriptions",settings:"Settings",privilegeSettings:"Privilege settings",reportsAmountCounter:"Reports amount counter",reports:"Reports",reportDecisions:"Report decisions",rendering:"Rendering",alarm:"Alarm",logger:"Logger",search:"Search",hotkeys:"Hotkeys",feed:"Feed"},a=[],l=(new Date).getTime();function d(e,t){h("message",e,t,function(e){switch(e){case n.initialization:return"#d4fde8";case n.deinitialization:return"#5d5f61";case n.longPoll:return"#735ce6";case n.subscriptions:return"#ffa000";case n.privilegeSettings:return"#ffc107";case n.settings:return"#4bb34b";case n.reportsAmountCounter:return"#b2deff";case n.reports:return"#5181b8";case n.reportDecisions:return"#63b9ba";case n.rendering:return"#faefd2";case n.alarm:return"#db3b3b";case n.logger:return"#aee6c9";case n.search:return"#6f7985";case n.hotkeys:return"#3dcc4b";case n.feed:return"#3dccff";default:return"#FFFFFF"}}(e))}function c(e,t,o){void 0===o&&(o=""),o&&(t=o+": "+t),h("error",e,t,"#f05c44")}function _(e){0!==e.length&&(d(n.logger,"Disabled log sections: "+JSON.stringify(e)),a=e)}function u(){if(0!==s.length){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(s.join("\n"))),e.setAttribute("download","sf_logs.txt"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else(0,r.showDoneBox)("Новых логов нет")}function h(e,t,o,r){if(!a.includes(t)){var n="["+function(){var e=(new Date).getTime()-l;e/=i.SECOND;var t=60,o=60,r=60*o,s=Math.floor(e/r),n=Math.floor(e/o%t),a=Math.floor(e-n*o),d=("0"+s).slice(-2),c=("0"+n).slice(-2),_=("0"+a).slice(-2),u=c+":"+_;s>0&&(u=d+":"+u);return u}()+"] ("+t+" "+e+"): "+o;console.log("%c "+n,"background: #222; color: "+r),function(e){s.push(e),s.length>=300&&(s=s.slice(100))}(n)}}},371372:(e,t,o)=>{o.d(t,{convertKludgesToAttaches:()=>c,isReservedPeer:()=>_,isUserPeer:()=>u,isChatPeer:()=>h,isEmailPeer:()=>p,isContactPeer:()=>m,isCommunityPeer:()=>v,convertAttachesToPhpMedia:()=>y,isPinnedSortId:()=>f,isOnboardingFindFriendsLink:()=>g});var i=o(570655),r=o(917999),s=o(995343);function n(e,t){void 0===t&&(t=[]);var o=(0,i.__read)(e.split("_"),2);return[o[0],o[1],t]}function a(e,t,o,r){if(void 0===o&&(o=0),void 0===r&&(r=0),r>50)return[[],e.length];for(var s=[],l="";o<e.length;){var d=e[o];if("id"===d)l=t[o];else if(","===d&&l)s.push(n(l)),l="";else if("("===d){var c=(0,i.__read)(a(e,t,o+1,r+1),2),_=c[0];o=c[1],s.push(n(l,_)),l=""}else if(")"===d)return""!==l&&s.push(n(l)),[s,o];o++}return l&&s.push(n(l)),[s,o]}var l={};function d(e){if(l[e])return l[e];for(var t=e?e.length:0,o=[],r=[],s="",n=0;n<t;n++){var d=e[n],c=d.charCodeAt(0);c>=48&&c<=57||"_"===d||"-"===d?s+=d:"("!==d&&")"!==d&&":"!==d&&","!==d||(""!==s&&(r.push(s),o.push("id"),s=""),r.push(d),o.push(d))}s.length>0&&(r.push(s),o.push("id"));var _=(0,i.__read)(a(o,r),1)[0];return Object.keys(l).length>300&&(l={}),l[e]=_,_}function c(e,t){var o=[];e.fwd_count?o.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&o.push({type:"mail",id:-t,object:{fwd_count:d(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?o.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:(0,r.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:(0,r.intval)(e["attach"+i+"_call_duration"]),receiverId:(0,r.intval)(e["attach"+i+"_call_receiver_id"])}):o.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&o.push({type:"geo",id:e.geo}),o}function _(e){return 0==e}function u(e){return e>0&&e<2e9}function h(e){return e>2e9}function p(e){return e<-2e9}function m(e){return e>19e8&&e<2e9}function v(e){return e>-2e9&&e<0}function y(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}function f(e){return e>0&&(e|s.PINNED_CONVERSATION_BIT_MASK)===s.PINNED_CONVERSATION_BIT_MASK}function g(e){return/(^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com)?\/onboarding_find_friends/.test(decodeURIComponent(e))}},427830:(e,t,o)=>{o.d(t,{swapObject:()=>i});var i=function(e){var t={};return Object.keys(e).forEach((function(o){t[e[o]]=o})),t}},676319:(e,t,o)=>{var i=o(469190);window.Stories=i.Stories;try{window.stManager.done(window.jsc("web/stories.js"))}catch(e){}},675805:(e,t,o)=>{o.d(t,{isKeyboardActivationEvent:()=>r});var i=o(917685),r=function(e){return!!(window.KeyboardEvent&&e instanceof window.KeyboardEvent)&&(!(e.ctrlKey||e.altKey||e.metaKey)&&!![i.KEY.ENTER,i.KEY.SPACE].includes(e.keyCode))}},435501:(e,t,o)=>{o.d(t,{default:()=>l});var i=o(124956),r=o(116886),s=o(917685),n=o(414914),a=o(442699);const l=function(){function e(e,t,o){this.data=e,this.opts=t,this.paused=!0,this.loaded=!1,this.elems={},this.startTs=0,this.isPausedByMetaScroll=!1;var i=e.is_expired,r=e.is_deleted,s=e.is_private,n=e.isOneTimeSeen;i?this._error("expired"):r?o?this._error("deleted-narrative"):this._error("deleted"):n?this._error("isOneTimeSeen"):s&&(o?this._error("private-narrative"):this._error("private")),(i||r||s||n)&&(this.failed=!0)}return e.prototype.render=function(){var e=this;this.isGroupsMetaStory||this.isAppsMetaStory||(this.longLoadingTimer=setTimeout((function(){e.isLoaded()||e.opts.onLongLoading()}),1e3),this.opts.onLoadingStart())},e.prototype.renderAppsMetaStory=function(){var e=this,t="apps",o=(0,n.ce)("div",{className:"MetaStory"}),i=window.Stories._getList(t);if(i){this.coverItems=i,this.coverCount=this.coverItems?this.coverItems.length:0,this.elems.recBlock=(0,n.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=(0,n.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=(0,n.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var a=(0,n.ce)("div",{className:"MetaStory__infoWrapper"}),l=(0,n.ce)("div",{className:"MetaStory__info"}),d=(0,n.ce)("a",{className:"MetaStory__appWrapper",href:this.data.app.url,target:"_blank"});d.appendChild((0,n.ce)("div",{className:"MetaStory__appIcon"},{backgroundImage:"url("+this.data.app.photoUrl+")"})),d.appendChild((0,n.ce)("div",{className:"MetaStory__appName",innerHTML:this.data.app.name})),d.appendChild((0,n.ce)("span",{className:"MetaStory__appLink",innerHTML:(0,r.getLang)("stories_go_to_app")})),l.appendChild(d),a.appendChild(l),(0,n.setStyle)(a,{paddingBottom:this.elemOffset+"px"}),(0,n.setStyle)(this.elems.recItems,{minHeight:"calc(100% - "+this.elemOffset+"px"}),o.appendChild(a);var c=(0,n.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),_=(0,n.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),u=(0,n.ce)("div",{className:"MetaStory__clickableArea"});u.appendChild(c),u.appendChild(_),(0,s.addEvent)(u,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),(0,s.addEvent)(u,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach((function(o){var i=o.items.filter((function(e){return e.unread})),r=!!i.length,s=o.items[0];r&&(s=i[0]);var a=(0,n.ce)("span",{className:"GridStoryPreview"+("live"===s.type?" GridStoryPreview--live":""),onclick:function(e){var i=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(o)+"/"+t,{fromEl:i})}}),l=(0,n.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+o.author.href+'" data-author-id="'+o.author.id+'" class="GridStoryPreview__author'+(r?" GridStoryPreview__author--unread":"")+'" style="background-image: url(\''+o.author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+o.author.name+"</span>\n          "},{backgroundImage:"url('"+s.preview_url+"')"}),d=new Image;d.src=s.small_preview,d.onload=function(){(0,n.setStyle)(l,{backgroundImage:"url('"+s.small_preview+"')"})},a.appendChild(l),e.elems.recItems.appendChild(a)})),(0,s.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(u),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),o.appendChild(this.elems.recBlock)}return o},e.prototype.renderGroupsMetaStory=function(){var e=this,t="groups",o=(0,n.ce)("div",{className:"MetaStory"}),i=window.Stories._getList(t);if(i){this.coverItems=i,this.coverCount=this.coverItems?this.coverItems.length:0,this.elems.recBlock=(0,n.ce)("div",{className:"MetaStory__rec"}),this.elems.recInner=(0,n.ce)("div",{className:"MetaStory__rec-inner"}),this.elems.recItems=(0,n.ce)("div",{className:"MetaStory__rec-items"}),this.elemOffset=286,this.scrollOffset=0,this.metaStoryGridMarginTop=this.elemOffset;var a=(0,n.ce)("div",{className:"MetaStory__infoWrapper"}),l=(0,n.ce)("div",{className:"MetaStory__info"});l.appendChild((0,n.ce)("div",{className:"MetaStory__infoTitle",innerHTML:(0,r.getLang)("stories_groups_grid_title")})),l.appendChild((0,n.ce)("div",{className:"MetaStory__infoDescription",innerHTML:(0,r.getLang)("stories_groups_grid_text")})),a.appendChild(l),(0,n.setStyle)(a,{paddingBottom:this.elemOffset+"px"}),(0,n.setStyle)(this.elems.recItems,{minHeight:"calc(100% - "+this.elemOffset+"px"}),o.appendChild(a);var d=(0,n.ce)("div",{className:"MetaStory__navigationBtn MetaStory__backBtn"}),c=(0,n.ce)("div",{className:"MetaStory__navigationBtn MetaStory__nextBtn"}),_=(0,n.ce)("div",{className:"MetaStory__clickableArea"});_.appendChild(d),_.appendChild(c),(0,s.addEvent)(_,"mousedown",this.handleGridInfoWrapperMouseDown.bind(this)),(0,s.addEvent)(_,"mouseup",this.handleGridInfoWrapperMouseUp.bind(this)),this.coverItems.forEach((function(o){var i=o.items.filter((function(e){return e.unread})),r=!!i.length,s=o.items[0];r&&(s=i[0]);var a=(0,n.ce)("span",{className:"GridStoryPreview"+("live"===s.type?" GridStoryPreview--live":""),onclick:function(e){var i=e.target;window.Stories.show(window.cur.storyLayer.getBlockKey(o)+"/"+t,{fromEl:i})}}),l=(0,n.ce)("div",{className:"GridStoryPreview__inner",innerHTML:'\n            <a href="'+o.author.href+'" data-author-id="'+o.author.id+'" class="GridStoryPreview__author'+(r?" GridStoryPreview__author--unread":"")+'" style="background-image: url(\''+o.author.photo+'\')"></a>\n            <span class="GridStoryPreview__title">'+o.author.name+"</span>\n          "},{backgroundImage:"url('"+s.preview_url+"')"}),d=new Image;d.src=s.small_preview,d.onload=function(){(0,n.setStyle)(l,{backgroundImage:"url('"+s.small_preview+"')"})},a.appendChild(l),e.elems.recItems.appendChild(a)})),(0,s.addEvent)(this.elems.recInner,"scroll",this.handleRecommendationsScroll.bind(this)),this.elems.recInner.appendChild(_),this.elems.recInner.appendChild(this.elems.recItems),this.elems.recBlock.appendChild(this.elems.recInner),o.appendChild(this.elems.recBlock)}return o},e.prototype.handleRecommendationsScroll=function(){var e=Math.min(this.elems.recInner.scrollTop/(this.scrollOffset/100),70)/100;(0,n.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, "+e+")"}),this.elems.recInner.scrollTop?(this.isPausedByMetaScroll=!0,(0,n.addClass)(this.elems.recBlock,"scroll"),this.pause()):(this.isPausedByMetaScroll=!1,this.play(),(0,n.removeClass)(this.elems.recBlock,"scroll"),(0,n.setStyle)(this.elems.recBlock,{backgroundColor:"rgba(0, 0, 0, 0)"})),this.data.is_groups_meta_story&&(this.elems.blockHeader||(this.elems.blockHeader=window.cur.storyLayer.activeStory.authorButtons.querySelector(".stories_groups_settings_text")),this.elems.recInner.scrollTop&&(0,n.removeClass)(window.cur.storyLayer.activeStory.wrapEl,"paused"),this.elems.recInner.scrollTop>this.metaStoryGridMarginTop?((0,n.removeClass)(window.cur.storyLayer.activeStory.wrapEl,"paused"),(0,n.removeClass)(this.elems.blockHeader,"stories_groups_settings_text_hide")):(0,n.addClass)(this.elems.blockHeader,"stories_groups_settings_text_hide"))},e.prototype.handleGridInfoWrapperMouseDown=function(){this.downTs=(0,a.vkNow)(),this.longTapTimer=setTimeout(e.longTapInfoWrapper.bind(this),i.LONG_PRESS_DELAY_MS)},e.prototype.handleGridInfoWrapperMouseUp=function(e){if(window.cur.storyLayer.activeStory){clearTimeout(this.longTapTimer);var t=!((0,a.vkNow)()-this.downTs<i.LONG_PRESS_DELAY_MS);if((0,n.hasClass)(e.target,"MetaStory__backBtn")&&!t)return window.cur.storyLayer.activeStory.prevStory();t?window.cur.storyLayer.activeStory.isPaused()&&window.cur.storyLayer.activeStory.playStory(!1,!!this.downTs):window.cur.storyLayer.activeStory._onPlayEnd()}},e.longTapInfoWrapper=function(){window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.longTapHandle()},e.prototype.getContainer=function(){},e.prototype.play=function(){this.paused=!1,this.isLoaded()&&this.opts.onPlay()},e.prototype.pause=function(){this.paused=!0,this.opts.onPause()},e.prototype.setCurrentTime=function(e){void 0===e&&(e=0)},e.prototype.destroy=function(){(0,s.removeEvent)(this.elems.recBlock),clearTimeout(this.longLoadingTimer)},e.prototype.isPaused=function(){return this.paused},e.prototype.isLoaded=function(){return this.loaded},e.prototype.getCurrentTime=function(){return 0},e.prototype.getDuration=function(){return 0},e.prototype.getId=function(){return this.data.raw_id},e.prototype.getTrackCode=function(){return this.data.track_code},e.prototype.getDate=function(){return this.data.date},e.prototype.getViews=function(){return this.data.views},e.prototype.getReplies=function(){return this.data.replies},e.prototype.setViews=function(e){this.data.views=e},e.prototype.setReplies=function(e){this.data.repliesCountText=e},e.prototype.isOneTime=function(){return this.data.isOneTime&&this.data.authorId!==window.vk.id},e.prototype._onCanPlay=function(){if(clearTimeout(this.longLoadingTimer),this.loaded=!0,this.opts.onLoadingEnd(),this.startTs=Date.now(),this.data.seenProgress&&this.isOneTime()&&this.setCurrentTime(+(this.data.seenProgress*this.getDuration()/100).toFixed(1)),!this.isPaused()){var e=document.visibilityState;if(e&&"visible"!==e)return;this.play()}},e.prototype._loadingError=function(){this._error("load")},e.prototype._isFailed=function(){return this.failed},e.prototype._error=function(e){clearTimeout(this.longLoadingTimer),this.opts.onError(e)},e}()},684663:(e,t,o)=>{o.d(t,{ActionsButton:()=>u});var i=o(570655),r=o(667294),s=o(41437),n=o(65645),a=o(442699),l=o(505714),d=o(621260),c=o(121265),_=o(281536),u=function(e){var t=e.story;if(!t.getCurStoryData())return null;var o,u=function(e){var t=e.getCurStoryData(),o=e.getCurrentNarrative(),r=[];if(!t)return r;var n=t.raw_id,c=t.can_hide_reply,_=t.report_hash,u=t.can_remove,h=t.isAds,p=t.canMarkNotInterested,m=e.data.can_blacklist,v=(0,i.__read)(n.split("_").map((function(e){return(0,a.intval)(e)})),2),y=v[0],f=v[1];(null==o?void 0:o.canEdit)&&r.push({label:(0,s.getLang)("stories_narrative_edit_button"),onClick:function(){return e.sendNarrativeEditButtonDidPress()}});y===window.vk.id||!m||o||h||r.push({label:(0,s.getLang)("stories_add_blacklist_button"),onClick:function(){return e.addToBlacklist()}});p&&r.push({label:(0,s.getLang)("stories_mark_not_interested"),onClick:function(t){var o,i=new MouseEvent("mouseout",{bubbles:!0});null===(o=t.nativeEvent.target)||void 0===o||o.dispatchEvent(i),e.markNotInterested()}});c&&r.push({label:(0,s.getLang)("stories_hide_reply_button"),onClick:function(){return e.hideReply()}});o&&(r.push({label:o.isBookmarked?(0,s.getLang)("stories_narrative_remove_bookmark_button"):(0,s.getLang)("stories_narrative_add_bookmark_button"),onClick:function(){return e.sendNarrativeBookmarkButtonDidPress()}}),r.push({label:(0,s.getLang)("stories_narrative_copy_link"),onClick:function(){var e=location.protocol+"//"+location.host+"/narrative"+y+"_"+o.id+"_"+f;(0,l.copyToClipboard)(e),(0,d.showDoneBox)((0,s.getLang)("stories_narrative_copy_link_done"))}}));_&&r.push({label:(0,s.getLang)("stories_report"),onClick:function(){return e.report()}});y===window.vk.id||o||r.push({label:(0,s.getLang)("stories_settings"),onClick:function(){return window.Stories.showBlackList()}});u&&o&&r.push({red:!0,label:(0,s.getLang)("stories_remove_from_narrative"),onClick:function(){return e.removeStoryFromNarrative()}});u&&r.push({red:!0,label:o?(0,s.getLang)("global_narrative_delete"):(0,s.getLang)("global_delete"),onClick:function(){return o?e.removeNarrativeBox():e.removeStoryBox()}});return r}(t);if(0===u.length)return null;var h=r.createRef();return r.createElement("div",{className:"StoryButton StoryButton--more ui_actions_menu_wrap _ui_menu_wrap ui_actions_menu_top StoryBottomControl__control",onMouseEnter:function(e){clearTimeout(o),t.pauseStory(),n.default.show(h.current,e)},onMouseLeave:function(){n.default.hide(h.current),clearTimeout(o),o=setTimeout((function(){return t.autoResumeStory()}),300)},ref:h},r.createElement("div",{className:"ui_actions_menu _ui_menu"},u.map((function(e){var t=e.label,o=e.onClick,i=e.red,s=e.disable;return r.createElement("div",{key:t,className:(0,c.classNames)("StoryMenuItem ui_actions_menu_item",{"StoryMenuItem--red":i,"StoryMenuItem--disable":s}),onClick:o},t)}))),r.createElement(_.default,null))}},575414:(e,t,o)=>{o.d(t,{default:()=>n});var i=o(667294),r=o(111939),s=o(121265);const n=function(e){var t=e.title,o=e.additionalTitle,n=e.needSeparator,a=void 0===n||n,l=e.className,d=e.children;return i.createElement("div",{className:(0,s.classNames)("FeedbackBaseBlock",l,{"FeedbackSeparator FeedbackSeparator--top":a})},i.createElement(r.default,{title:t,additionalTitle:o}),d)}},991702:(e,t,o)=>{o.d(t,{default:()=>n});var i=o(667294),r=o(887734),s=o(575414);const n=function(e){var t=e.poll;return i.createElement(s.default,{className:"FeedbackPollBlock",title:t.title},i.createElement("div",{className:"FeedbackPollBlock__poll"},i.createElement(r.default,{poll:t.data})))}},721037:(e,t,o)=>{o.d(t,{default:()=>l});var i=o(570655),r=o(667294),s=o(701058),n=o(575414),a=o(414914);const l=function(e){function t(t){var o=e.call(this,t)||this;return o.componentDidMount=function(){var e=o.scrollElement.current;e&&e.addEventListener("wheel",o.questionsMouseWheel)},o.componentWillUnmount=function(){var e=o.positionElement.current;e&&e.removeEventListener("wheel",o.questionsMouseWheel)},o.questionsMouseWheel=function(e){e.preventDefault(),o.props.questions.items.length<=1||o.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},o.setPosition=function(e){var t=o.positionElement.current;if(t){var r=o.state.scrollBlockPosition,s=(0,i.__read)((0,a.getSize)(t),1)[0],n=Math.max(0,Math.min(r+e,t.scrollWidth-s));o.setState({scrollBlockPosition:n})}},o.removeQuestion=function(e){var t=e.storyOwnerId,i=e.storyId,r=e.id,s=e.removeHash;window.ajax.post("al_stories.php",{act:"remove_question",story_owner_id:t,story_id:i,question_id:r,remove_hash:s},{onDone:function(){o.props.sendNavigationStatEvents("question_delete",!0,{question_id:r}),o.props.questions.items.length?o.setPosition(0):o.props.onQuestionRemove(r)}})},o.getReportReasons=function(){return new Promise((function(e,t){o.reportReasons.length?e(o.reportReasons):window.ajax.post("al_stories.php",{act:"question_report_box"},{onDone:function(t){return o.reportReasons=t,e(o.reportReasons),!0},onFail:function(e){return t(e),!0}})}))},o.state={scrollBlockPosition:0},o.reportReasons=[],o.scrollElement=r.createRef(),o.positionElement=r.createRef(),o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props.questions,o=this.state.scrollBlockPosition,i=t.items;return r.createElement(n.default,{className:"FeedbackQuestionsBlock",title:t.title},r.createElement("div",{className:"FeedbackQuestionsBlock__questions"},r.createElement("div",{className:"FeedbackQuestionsBlock__wrapper",ref:this.scrollElement},r.createElement("div",{className:"FeedbackQuestionsBlock__items",style:{transform:"translateX(-"+o+"px)"},ref:this.positionElement},i.map((function(t,o){return r.createElement(s.default,{question:t,storyUrl:e.props.storyUrl,showMessage:e.props.showMessage,removeQuestion:e.removeQuestion,getReportReasons:e.getReportReasons,key:o})}))))))},t}(r.Component)},832328:(e,t,o)=>{o.d(t,{default:()=>d});var i=o(667294),r=o(575414),s=o(451653),n=o(881150),a=o(116886),l=o(41437);const d=function(e){var t=e.replies,o=e.showMore,d=t.list,c=Boolean(t.moreRepliesCount);return i.createElement(r.default,{className:"FeedbackRepliesBlock",title:t.title,additionalTitle:t.additionalTitle},i.createElement("div",{className:"FeedbackRepliesBlock__replies"},null==d?void 0:d.map((function(e){return i.createElement(s.default,{storyPack:e,listName:t.listName,source:t.source,key:e.author.id})}))),c&&i.createElement(n.default,{className:"FeedbackRepliesBlock__showMore",appearance:"tertiary",onClick:o},(0,a.langNumeric)(t.moreRepliesCount,(0,l.getLang)("stories_replies_more_button",!0))))}},436269:(e,t,o)=>{o.d(t,{default:()=>d});var i=o(667294),r=o(629019),s=o(575414),n=o(41437),a=o(856612),l=o(719282);const d=function(e){var t=e.stats,o=e.extendedStats,d=e.onExtendedStatsPreviewClick,c=e.onSettingsBtnClick,_=e.onPrivacyHintHide;return i.createElement(s.default,{className:"FeedbackStatsBlock",title:t.title},o&&i.createElement("div",{className:"FeedbackStatsBlock__extendedStatsPreview FeedbackSeparator FeedbackSeparator--top",onClick:d,role:"button"},i.createElement(r.default,{appearance:"preview",title:(0,n.getLang)("stories_detailed_stats"),subtitle:o.preview}),i.createElement("div",{className:"FeedbackStatsBlock__chevron"},i.createElement(l.default,null))),t.showPrivacyHint&&i.createElement("div",{className:"FeedbackStatsBlock__privacyHint FeedbackSeparator FeedbackSeparator--top"},(0,n.getLang)("stories_privacy_feedback_hint"),i.createElement("div",{className:"FeedbackStatsBlock__links"},i.createElement(a.default,{href:"/settings?act=privacy",onClick:c},(0,n.getLang)("stories_go_to_settings")),i.createElement("span",{className:"dvd"}),i.createElement(a.default,{onClick:_},(0,n.getLang)("global_hide_notify")))),t.showEmptyStatsPrivacyHint&&i.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyHint"},i.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyIcon"}),i.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyText"},(0,n.getLang)("stories_privacy_empty_views_hint")),i.createElement("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyLink"},i.createElement(a.default,{href:"/settings?act=privacy",onClick:c},(0,n.getLang)("stories_go_to_settings")))))}},111939:(e,t,o)=>{o.d(t,{default:()=>r});var i=o(667294);const r=function(e){var t=e.title,o=e.additionalTitle;return i.createElement("div",{className:"FeedbackTitle"},i.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),o&&i.createElement("span",{className:"FeedbackTitle__additional"},o))}},429157:(e,t,o)=>{o.d(t,{default:()=>w});var i=o(570655),r=o(667294),s=o(148434),n=o(629019),a=o(721037),l=o(575414),d=o(436269),c=o(832328),_=o(991702),u=o(511902),h=o(121265),p=o(503369),m=o(791563),v=o(41437),y=o(897557),f=o(733024),g=o(23515);const w=function(e){function t(t){var o=e.call(this,t)||this;return o.onQuestionRemove=function(e){o.props.onQuestionRemove(e)},o.close=function(){o.props.toggleFeedbackTooltip(!1)},o.onSettingsBtnClick=function(){o.props.sendNavigationStatEvents("go_to_settings")},o.onPrivacyHintHide=function(){o.props.onPrivacyHintHide()},o.onExtendedStatsPreviewClick=function(){var e=o.props.sendNavigationStatEvents;o.unObserveViewerScroll(),o.unObserveTitleChanges(),o.setState({extendedStatsActive:!0}),e("open_advanced_statistic")},o.onBackBtnClick=function(){o.unObserveTitleChanges(),o.setState({extendedStatsActive:!1})},o.state={isViewersLoading:!1,extendedStatsActive:!1},o.mounted=!1,o.scrollContainerRef=r.createRef(),o.viewsSentinelRef=r.createRef(),o.titles=[],o.viewsObserver=null,o.activeHeader=null,o.onScrollHandler=null,o}return(0,i.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.feedback,o=e.showMessage,i=e.sendNavigationStatEvents,p=e.storyImageUrl,m=e.showMoreReplies,w=e.needShowEmptyStats,S=this.state,E=S.isViewersLoading,b=S.extendedStatsActive,k=null==t?void 0:t.stats,C=null==k?void 0:k.extendedStats,T=null==t?void 0:t.replies,L=null==t?void 0:t.poll,B=null==t?void 0:t.questions,M=null==t?void 0:t.viewers;return r.createElement("div",{className:(0,h.classNames)("FeedbackTooltip",{"FeedbackTooltip--empty":w}),onClick:function(e){return e.stopPropagation()}},r.createElement("div",{className:"FeedbackTooltip__wrapper"},r.createElement("div",{className:"FeedbackTooltip__close",onClick:this.close},r.createElement(f.default,null)),!t&&r.createElement("div",{className:"FeedbackTooltip__spinner"},r.createElement(s.default,{size:36,color:"#6590c7",strokeWidth:3})),t&&r.createElement(r.Fragment,null,!b&&r.createElement("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef},r.createElement("div",{className:"FeedbackTooltip__content"},k&&r.createElement(d.default,{stats:k,extendedStats:C,onExtendedStatsPreviewClick:this.onExtendedStatsPreviewClick,onSettingsBtnClick:this.onSettingsBtnClick,onPrivacyHintHide:this.onPrivacyHintHide}),T&&r.createElement(c.default,{replies:T,showMore:m}),L&&r.createElement(_.default,{poll:L}),B&&r.createElement(a.default,{showMessage:o,storyUrl:p,questions:B,sendNavigationStatEvents:i,onQuestionRemove:this.onQuestionRemove}),M&&r.createElement(u.default,{viewers:M,isLoading:E,needSeparator:!t.questions}),Boolean(null==M?void 0:M.nextFrom)&&r.createElement("div",{className:"FeedbackTooltip__sentinel",ref:this.viewsSentinelRef}))),C&&b&&r.createElement(r.Fragment,null,r.createElement("div",{className:"FeedbackTooltip__header FeedbackSeparator FeedbackSeparator--bottom"},r.createElement("div",{className:"FeedbackTooltip__back",onClick:this.onBackBtnClick},r.createElement("div",{className:"FeedbackTooltip__backIcon"},r.createElement(g.default,null)),(0,v.getLang)("global_back")),(0,v.getLang)("stories_detailed_stats")),r.createElement("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef},r.createElement("div",{className:"FeedbackTooltip__content"},C.achievement&&r.createElement("div",{className:"FeedbackTooltip__achievement"},r.createElement(n.default,{appearance:"achievement",title:C.achievement,subtitle:C.achievementSubtitle})),C.categories.map((function(e,t){return r.createElement(l.default,{title:e.title,key:t},r.createElement("div",{className:"FeedbackTooltip__lines"},e.lines.map((function(e,t){return r.createElement("div",{className:"FeedbackTooltip__line",key:t},r.createElement("div",{className:"FeedbackStatName"},(0,y.decodeHTMLEntities)(e.name)),r.createElement("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}}))}))))}))))))))},t.prototype.componentDidMount=function(){var e=this,t=this.props,o=t.feedback,i=t.storyRawId,r=t.onFetchFeedbackData;if(this.mounted=!0,o)return this.observeTitleChanges(),void this.observeViewerScrollIfNeeded();window.ajax.post("al_stories.php",{act:"get_feedback",story_raw:i},{onDone:function(t){e.mounted&&r(t)},onFail:function(){return(0,m.showFastBox)((0,v.getLang)("global_error"),(0,v.getLang)("global_unknown_error")),e.close(),!0}})},t.prototype.componentDidUpdate=function(e,t){!e.feedback&&this.props.feedback&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded()),!t.extendedStatsActive&&this.state.extendedStatsActive?this.observeTitleChanges():t.extendedStatsActive&&!this.state.extendedStatsActive&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded())},t.prototype.componentWillUnmount=function(){this.unObserveTitleChanges(),this.unObserveViewerScroll(),this.mounted=!1},t.prototype.loadViewers=function(){var e,t=this,o=this.props,i=o.storyRawId,r=o.feedback,s=o.onFetchViewers;this.state.isViewersLoading||(null===(e=null==r?void 0:r.viewers)||void 0===e?void 0:e.nextFrom)&&(this.setState({isViewersLoading:!0}),window.ajax.post("al_stories.php",{act:"get_viewers",story_raw:i,offset:r.viewers.nextFrom},{onDone:function(e){s(e),t.setState({isViewersLoading:!1})},onFail:function(){return(0,m.showFastBox)((0,v.getLang)("global_error"),(0,v.getLang)("global_unknown_error")),t.setState({isViewersLoading:!1}),!0}}))},t.prototype.observeViewerScrollIfNeeded=function(){var e,t=this,o=this.props.feedback;if(null===(e=null==o?void 0:o.viewers)||void 0===e?void 0:e.nextFrom){var i=this.scrollContainerRef.current,r=this.viewsSentinelRef.current;if(!r)return;this.viewsObserver=new IntersectionObserver((function(e){e.forEach((function(e){e.intersectionRatio>0&&t.loadViewers()}))}),{threshold:[0,1],root:i,rootMargin:"0px 0px 336px 0px"}),this.viewsObserver.observe(r)}},t.prototype.unObserveViewerScroll=function(){this.viewsObserver&&this.viewsObserver.disconnect()},t.prototype.observeTitleChanges=function(){var e=this,t=this.scrollContainerRef.current;t&&(this.updateTitles(),this.onScrollHandler=(0,p.debounce)((function(){!e.titles.some((function(t,o){if(t.offsetTop)return t===e.activeHeader||e.setActiveHeader(t),!0;if(e.titles[o+1]){var i=e.titles[o+1],r=e.titles[o+1].parentElement,s=r&&r.offsetHeight;return!!s&&(i.offsetTop+i.offsetHeight===s&&(t===e.activeHeader||e.setActiveHeader(t),!0))}return!1}))&&e.activeHeader&&(e.activeHeader.classList.remove("FeedbackTitle--active"),e.activeHeader=null)}),5),t.addEventListener("scroll",this.onScrollHandler))},t.prototype.updateTitles=function(){var e=this.scrollContainerRef.current;e&&(this.titles=Array.from(e.querySelectorAll(".FeedbackTitle")),this.titles.reverse())},t.prototype.unObserveTitleChanges=function(){this.scrollContainerRef.current&&this.onScrollHandler&&this.scrollContainerRef.current.removeEventListener("scroll",this.onScrollHandler),this.onScrollHandler=null,this.titles=[]},t.prototype.setActiveHeader=function(e){this.activeHeader&&this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=e,e.classList.add("FeedbackTitle--active")},t}(r.Component)},511902:(e,t,o)=>{o.d(t,{default:()=>a});var i=o(667294),r=o(366192),s=o(148434),n=o(575414);const a=function(e){var t=e.viewers,o=e.isLoading,a=void 0!==o&&o,l=e.needSeparator,d=void 0===l||l;return i.createElement(n.default,{className:"FeedbackViewersBlock",title:t.title,needSeparator:d},t.hiddenReason&&i.createElement("span",{className:"FeedbackViewersBlock__hiddenReason"},t.hiddenReason),i.createElement("div",{className:"FeedbackViewersBlock__items"},t.items.map((function(e,t){return i.createElement(r.default,{user:e,key:t})}))),a&&i.createElement("div",{className:"FeedbackViewersBlock__spinner"},i.createElement(s.default,{size:18,color:"#6590c7",strokeWidth:2})))}},629019:(e,t,o)=>{o.d(t,{default:()=>r});var i=o(667294);const r=function(e){var t=e.title,o=e.subtitle,r=e.appearance,s=void 0===r?"preview":r;return i.createElement("div",{className:"InfoAside InfoAside--"+s},i.createElement("div",{className:"InfoAside__image"}),i.createElement("div",{className:"InfoAside__description"},i.createElement("span",{className:"InfoAside__title"},t),i.createElement("span",{className:"InfoAside__subtitle"},o)))}},887734:(e,t,o)=>{o.d(t,{default:()=>u});var i=o(667294),r=o(121265),s=o(41437),n=o(791563),a=o(469433),l=o(358785),d=o(358862);function c(e){var t="";if(e.type===l.PollBackgroundType.photo)t="#"+e.backgroundColor;else if(e.type===l.PollBackgroundType.gradient){t="linear-gradient("+(e.angle-90)+"deg, "+e.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return t}function _(e){var t=e.ownerId,o=e.pollId;if(e.needShowResults)(0,a.showWiki)({w:"poll"+t+"_"+o},!1,void 0,{customRef:"story"});else{var i={act:"get_layout",voting_id:o,ref:"story",for_box:!0};(0,n.showBox)("al_voting.php",i,{containerClass:"story_poll",params:{hideButtons:!0,width:510}})}}const u=function(e){var t=e.poll,o=function(e){var t=e.background;return i.createElement("div",{className:"PollSnippet__background",style:{background:c(t)}},t.type===l.PollBackgroundType.photo&&i.createElement("div",{className:"PollSnippet__photo",style:{backgroundImage:"url("+t.photoUrl+")"}}))}(t);return i.createElement("div",{className:(0,r.classNames)("PollSnippet",{"PollSnippet--default":t.background.type===l.PollBackgroundType.default})},o,i.createElement("div",{className:"PollSnippet__question"},(0,d.decodeHTMLEntities)(t.question)),i.createElement("div",{className:"PollSnippet__countVoters"},t.votersCountText),i.createElement("div",{className:"PollSnippet__showResult",onClick:_.bind(null,t)},(0,s.getLang)("stories_voting_show_result")))}},701058:(e,t,o)=>{o.d(t,{default:()=>v});var i=o(570655),r=o(667294),s=o(7692),n=o(881150),a=o(423558),l=o(309739),d=o(121265),c=o(41437),_=o(897557),u=o(442699),h=o(917685),p=o(496495),m=o(536741);const v=function(e){function t(t){var o=e.call(this,t)||this;return o.componentDidMount=function(){var e=o.questionTextEl.current;e&&o.adjustQuestionTextSize(e)},o.componentDidUpdate=function(){o.replyTextareaEl.current&&o.replyTextareaEl.current.focus()},o.render=function(){var e=o.state,t=e.isOpenReplyModal,i=e.replyText,a=o.props,l=a.question,u=a.storyUrl,h=l.author,p=l.canAnswer,m=l.text,v=(0,_.decodeHTMLEntities)(m),y=(0,d.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!p});return r.createElement("div",{className:"StoryQuestion"},r.createElement("div",{className:"StoryQuestion__content"},o.renderAuthor(),r.createElement("span",{className:y,title:v,ref:o.questionTextEl},v)),r.createElement("div",{className:"StoryQuestion__controls"},p&&r.createElement(n.default,{className:"StoryQuestion__reply",appearance:l.isPublished?"secondary":"primary",size:"s",wide:!0,onClick:o.openReplyModal},(0,c.getLang)("stories_question_reply"))),t&&r.createElement(s.default,{title:(0,c.getLang)("stories_question_reply_box_title").replace("{name}",(0,_.decodeHTMLEntities)(h.nameDat)),actionButtons:o.getReplyModalActions(),className:"StoryQuestion__replyModal",onClose:o.closeReplyModal,appearance:"blue"},r.createElement("div",{className:"StoryQuestion__inner"},r.createElement("textarea",{ref:o.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:(0,c.getLang)("stories_question_reply_placeholder"),onChange:o.handleChange,onKeyDown:o.handleKeyDown,value:i}),r.createElement("img",{srcSet:u,className:"StoryQuestion__image"}))))},o.renderAuthor=function(){var e=o.props.question,t=e.id,i=e.isAnonymous,s=e.author,n="StoryQuestion__author",a=(0,_.decodeHTMLEntities)(s.name);return r.createElement("div",{className:"StoryQuestion__header"},i&&r.createElement("span",{className:n},a),!i&&r.createElement("a",{href:s.link,className:n,onClick:function(){return window.cur.storyLayer.sendNavigationStatEvents("question_go_to_author",!0,{questionId:t})}},a),r.createElement(l.default,{position:"b",align:"right",trigger:"hover",data:o.getActions()},r.createElement("span",{className:"StoryQuestion__actions"},r.createElement(m.default,null))))},o.getActions=function(){var e=o.props.question,t=o.state.isAuthorBan,i=[{text:(0,c.getLang)("stories_question_delete"),onClick:function(){return o.props.removeQuestion(e)}}];return e.canBlocked&&(t?i.push({text:(0,c.getLang)("stories_question_author_unban"),onClick:o.unbanAuthor}):i.push({text:(0,c.getLang)("stories_question_author_ban"),onClick:o.banAuthor}),i.push({text:(0,c.getLang)("stories_question_author_report"),onClick:o.showReportForm})),i},o.adjustQuestionTextSize=function(e){if(e.scrollHeight>e.offsetHeight){var t=getComputedStyle(e),i=parseInt(t.fontSize)-.5,r=i+2.5,s=Math.floor(parseInt(t.height)/r);i>10&&(e.setAttribute("style","font-size: "+i+"px; line-height: "+r+"px; -webkit-line-clamp: "+s+";"),setTimeout((function(){o.adjustQuestionTextSize(e)}),0))}},o.getReplyModalActions=function(){var e=o.state,t=e.isReplyButtonLoading,i=e.replyText;return[r.createElement(n.default,{key:"closeReplyModal",appearance:"tertiary",onClick:o.closeReplyModal},(0,c.getLang)("global_cancel")),r.createElement(a.default,{key:"replySend",loading:t,disabled:!(0,u.trim)(i),onClick:o.sendReply},(0,c.getLang)("stories_question_reply_send"))]},o.openReplyModal=function(){o.setState({isOpenReplyModal:!0})},o.closeReplyModal=function(){o.setState({isOpenReplyModal:!1})},o.handleChange=function(e){o.setState({replyText:e.target.value})},o.handleKeyDown=function(e){var t=o.state.replyText;(0,u.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==h.KEY.RETURN&&o.sendReply()},o.resetReplyText=function(){o.setState({replyText:""})},o.sendReply=function(){var e=o.state.replyText,t=o.props,i=t.question,r=t.showMessage,s=i.text,n=i.id,a=i.ownerId,l=i.storyOwnerId,d=i.storyId,_=i.sendHash,h=e+"\n\n🗣 "+(0,u.unclean)(s),p="story:"+l+"_"+d;window.ajax.post("al_im.php",{act:"a_send",msg:h,hash:_,media:p,to:a,entrypoint:"stories_comment"},{onDone:function(){o.closeReplyModal(),o.resetReplyText(),r((0,c.getLang)("stories_answer_sent")),window.cur.storyLayer.sendNavigationStatEvents("question_send_message",!0,{questionId:n})},onFail:function(e){return o.closeReplyModal(),o.resetReplyText(),r(e),!0},showProgress:function(){return o.setState({isReplyButtonLoading:!0})},hideProgress:function(){return o.setState({isReplyButtonLoading:!1})}})},o.banAuthor=function(){var e=o.props,t=e.question,i=e.showMessage,r=t.storyOwnerId,s=t.storyId,n=t.id,a=t.banHash,l=t.isAnonymous;window.ajax.post("al_stories.php",{act:"ban_author_question",story_owner_id:r,story_id:s,question_id:n,ban_hash:a},{onDone:function(){o.setState({isAuthorBan:!0}),i((0,c.getLang)("stories_question_author_blocked"));var e="question_ban_author";l&&(e="question_ban_anonymous_author"),window.cur.storyLayer.sendNavigationStatEvents(e,!0,{questionId:n})},onFail:function(e){return i(e),!0}})},o.unbanAuthor=function(){var e=o.props,t=e.question,i=e.showMessage,r=t.storyOwnerId,s=t.storyId,n=t.id,a=t.banHash;window.ajax.post("al_stories.php",{act:"unban_author_question",story_owner_id:r,story_id:s,question_id:n,ban_hash:a},{onDone:function(){o.setState({isAuthorBan:!1}),i((0,c.getLang)("stories_question_author_unblocked"))},onFail:function(e){return i(e),!0}})},o.showReportForm=function(){(0,p.showReportForm)("story_question",o.props.question.ownerId,o.props.question.id,(function(){return o.props.showMessage((0,c.getLang)("stories_report_sent"))}))},o.state={isAuthorBan:t.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isReportButtonLoading:!1,selectReasons:0},o.replyTextareaEl=r.createRef(),o.questionTextEl=r.createRef(),o}return(0,i.__extends)(t,e),t}(r.Component)},451653:(e,t,o)=>{o.d(t,{default:()=>l});var i=o(667294),r=o(121265),s=o(826239),n=o(358862);function a(e){return e.items.some((function(e){return e.unread}))}const l=function(e){var t=e.storyPack,o=e.listName,l=e.source;return i.createElement("a",{href:t.author.href,className:(0,r.classNames)("StoryReply",{"StoryReply--new":a(t)}),onClick:function(e){e.metaKey||e.ctrlKey||((0,s.showStory)(t.author.id+"/"+o,{fromEl:e.target,source:l}),e.preventDefault())},role:"button"},i.createElement("div",{className:"StoryReply__avatar"},i.createElement("div",{className:"StoryReply__image",style:{backgroundImage:"url("+t.author.photo+")"}})),i.createElement("div",{className:"StoryReply__caption"},(0,n.decodeHTMLEntities)(t.author.firstName)))}},366192:(e,t,o)=>{o.d(t,{default:()=>l});var i=o(667294),r=o(581685),s=o(438130),n=o(121265),a=o(897557);const l=function(e){var t=e.user;return i.createElement("a",{href:t.url,className:"Viewer",role:"button"},i.createElement(r.default,{className:(0,n.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":t.isLiked}),title:t.name,photo:t.photoUrl}),i.createElement(s.default,{className:"Viewer__name",isVerified:t.isVerified},(0,a.decodeHTMLEntities)(t.name)))}},358785:(e,t,o)=>{var i;o.d(t,{PollBackgroundType:()=>i}),function(e){e.photo="photo",e.gradient="gradient",e.default="default"}(i||(i={}))},509867:(e,t,o)=>{o.d(t,{ReactionsPanel:()=>a});var i=o(667294),r=o(651525),s=o(41437),n=o(121265),a=function(e){var t=e.className,o=e.stickers,a=e.onStickerClick,l=function(e){r.StickersAnimation.loadAndPlaySticker(e.currentTarget)};return i.createElement("div",{className:(0,n.classNames)("ReactionsPanel",t)},i.createElement("div",{className:"ReactionsPanel__container"},i.createElement("div",{className:"ReactionsPanel__title"},(0,s.getLang)("stories_reactions_title")),i.createElement("div",{className:"ReactionsPanel__items"},o.map((function(e,t){return function(e,t){var o=e.animationUrl?"sticker_img":"";return i.createElement("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,"data-animation-class":"ReactionsPanel__itemAnimation",onMouseDown:function(){return a(e.id,t)},onMouseEnter:l,key:e.id},i.createElement("div",{className:(0,n.classNames)("ReactionsPanel__itemImage",o),style:{backgroundImage:"url("+e.imageUrl+")"}}))}(e,t)})))))}},275968:(e,t,o)=>{o.d(t,{StickerItem:()=>y});var i=o(570655),r=o(667294),s=o(843257),n=o(124956),a=o(897557),l=o(121265),d=o(41437),c=o(826239),_=o(469433),u=o(80909),h=o(709961),p=o(791563),m=o(427830),v=o(651988),y=function(e){function t(t){var o=e.call(this,t)||this;return o.componentDidMount=function(){var e=o.props,t=e.sticker,i=e.story;t.audioRestriction&&i.data.needMute&&i.video&&(i.video.muted=!0),o.playlist.on(o,h.events.ADDED,(function(){o.props.showMessage((0,d.getLang)("stories_audio_added")),o.props.playStory()})),o.playlist.on(o,h.events.REMOVED,(function(){o.props.showMessage((0,d.getLang)("stories_audio_deleted")),o.props.playStory()}))},o.componentWillUnmount=function(){o.playlist.off(o)},o.render=function(){var e=o.props,t=e.story,i=e.sticker,s=t.data.needMute,a=i.audioRestriction,d=(0,m.swapObject)(n.StickerTypes),c=v.default.get("story_show_clickable_zones"),_=(0,l.classNames)("StorySticker",{"StorySticker--clickableZones":c});return r.createElement(r.Fragment,null,r.createElement("div",{"data-type":d[i.type],className:_,style:o.getStickerStyle(),onMouseDown:function(e){return o.props.onMouseDownHandle(e)},onMouseUp:function(e){return o.props.onMouseUpHandle(e,(function(){return o.handleClick(e)}))}}),a&&s&&o.renderRestriction())},o.renderRestriction=function(){var e=o.props.sticker.audioRestriction;return e?r.createElement("div",{className:"StoryRestriction"},r.createElement("div",{className:"StoryRestriction__inner"},r.createElement("span",{className:"StoryRestriction__title"},e.title),e.buttonUrl&&r.createElement("a",{className:"StoryRestriction__link",href:e.buttonUrl},e.buttonText))):null},o.getStickerStyle=function(){var e=o.props,t=e.sticker,i=e.originalWidth,r=e.originalHeight,s=e.widthViewBox,n=e.heightViewBox,a=s,l=n;return n/s>1.77?a=i*n/r:l=r*s/i,{top:t.top*l-(l-n)/2,left:t.left*a-(a-s)/2,width:t.width*a,height:t.height*l,transform:"rotate("+t.rotate+"deg)"}},o.handleClick=function(e){switch(o.props.sticker.type){case n.StickerTypes.hashtag:o.handleClickHashtag(e);break;case n.StickerTypes.mention:o.handleClickMention(e);break;case n.StickerTypes.question:o.handleClickQuestion();break;case n.StickerTypes.place:o.handleClickPlace(e);break;case n.StickerTypes.music:o.handleClickMusic(e);break;case n.StickerTypes.marketItem:o.handleClickMarketItem(e);break;case n.StickerTypes.storyReply:o.handleClickStoryReply(e);break;case n.StickerTypes.owner:o.handleClickOwner(e);break;case n.StickerTypes.link:o.handleClickLink(e);break;case n.StickerTypes.post:o.handleClickPost(e);break;case n.StickerTypes.poll:o.handleClickPoll();break;case n.StickerTypes.app:o.handleClickApp();break;case n.StickerTypes.sticker:o.handleClickSticker(e);break;case n.StickerTypes.situationalTheme:o.handleClickStickerSituationalTheme()}},o.handleClickHashtag=function(e){var t=o.props.sticker.hashtag.replace("#","%23"),i=(0,d.getLang)("stories_show_hashtag_link"),s="hashtag",n=r.createElement("a",{href:"/feed?q="+t+"&section=search",onClick:function(){return o.onClickToTooltip(s)},target:"_blank",className:"StoriesTooltip__link"},i);o.props.toggleTooltip(e,n),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:s}})},o.handleClickMention=function(e){var t=o.props.sticker,i=t.mentionedOwnerHref,s=t.mentionedText,n=t.mentionedPhotoUrl,l="mention",d=r.createElement("a",{href:i,onClick:function(){return o.onClickToTooltip(l)},target:"_blank",className:"StoriesTooltip__link StoriesTooltip__link--mention"},r.createElement("div",{className:"StoriesTooltipMention"},r.createElement("div",{className:"StoriesTooltipMention__avatar",style:{backgroundImage:"url("+n+")"}}),r.createElement("span",{className:"StoriesTooltipMention__text"},(0,a.decodeHTMLEntities)(s))));o.props.toggleTooltip(e,d),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:l}})},o.handleClickQuestion=function(){o.props.showQuestionModal(),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:"question"}})},o.handleClickPlace=function(e){var t=o.props,i=t.sticker,s=t.list,n=i.placeId,a=(0,d.getLang)("stories_go_to_place"),l="place";if(window.layerQueue.count()||s.includes("archive")){var c="/feed?section=search&w=place"+n,u=r.createElement("a",{href:""+c,onClick:function(){return o.onClickToTooltip(l)},target:"_blank",className:"StoriesTooltip__link"},a);o.props.toggleTooltip(e,u)}else{u=r.createElement("div",{className:"StoriesTooltip__link",onClick:function(){o.onClickToTooltip(l),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),(0,_.showWiki)({w:"place"+n})}},a);o.props.toggleTooltip(e,u)}o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:i.id,type:l}})},o.handleClickMusic=function(e){var t=o.props,i=t.story,s=t.sticker,n=i.data.needMute,a=s.audioId,l=s.audioData;if(s.audioRestriction)n||u.AudioUtils.showAudioRestriction(JSON.parse(l),{onShow:function(){o.props.pauseStory()},onHide:function(){o.props.playStory()}});else{var c="added"===(u.AudioUtils.getAddRestoreInfo()[a]||{}).state?"stories_audio_delete":"stories_audio_add",_=r.createElement("ul",{className:"StoriesTooltipActions _audio_row","data-audio":l},r.createElement("li",{className:"StoriesTooltipActions__item",onClick:o.addAudio},(0,d.getLang)(c)),r.createElement("li",{className:"StoriesTooltipActions__item",onClick:o.setNext},(0,d.getLang)("stories_audio_next_audio")));o.props.toggleTooltip(e,_,"b"),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:s.id,type:"music"}})}},o.handleClickMarketItem=function(e){var t=o.props.sticker,n=t.photoUrl,a=t.link,l=t.isRestricted,c="market_item",_=l?{onClick:function(){(0,p.showFastBox)((0,d.getLang)("stories_market_access_error_title"),(0,d.getLang)("stories_market_access_error_text")),o.onClickToTooltip(c)}}:{onClick:function(){return o.onClickToTooltip(c)},href:a},u=r.createElement("a",(0,i.__assign)({},_,{target:"_blank",className:"StoriesTooltip__link"}),n&&!l?r.createElement("img",{className:"StoriesTooltip__marketItemThumb",src:n,alt:""}):r.createElement("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub"},r.createElement(s.default,null)),r.createElement("span",{className:"StoriesTooltip__marketItemText"},(0,d.getLang)("stories_go_to_market_item")));o.props.toggleTooltip(e,u),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:c}})},o.handleClickStoryReply=function(e){var t=o.props.sticker,i=t.ownerId,s=t.storyId,n=t.isExpired,a="story_reply";if(n)o.handleClickOwner(e);else{var l=r.createElement("a",{className:"StoriesTooltip__link",onClick:function(){var e=i+"_"+s;(0,c.showStory)("story"+e+"/"+e+"/context:owner"),o.onClickToTooltip(a)}},(0,d.getLang)("stories_go_to_story"));o.props.toggleTooltip(e,l),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:a}})}},o.handleClickOwner=function(e){var t=o.props.sticker,i=t.ownerId,s=t.link,n=i>0?(0,d.getLang)("stories_go_to_profile"):(0,d.getLang)("stories_go_to_group"),a=r.createElement("a",{href:s,target:"_blank",className:"StoriesTooltip__link"},n);o.props.toggleTooltip(e,a)},o.handleClickLink=function(e){var t=o.props.sticker,i=t.link,s=t.tooltipText,n="link",a=r.createElement("a",{href:i,onClick:function(){return o.onClickToTooltip(n)},target:"_blank",className:"StoriesTooltip__link"},s);o.props.toggleTooltip(e,a),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:n}})},o.handleClickPost=function(e){var t=o.props.sticker,i=t.postOwnerId,s=t.postId,n=(0,d.getLang)("stories_go_to_post"),a="post",l=r.createElement("a",{href:"/wall"+i+"_"+s,onClick:function(){return o.onClickToTooltip(a)},target:"_blank",className:"StoriesTooltip__link"},n);o.props.toggleTooltip(e,l),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:a}})},o.handleClickPoll=function(){var e=o.props.sticker.pollId;o.props.pauseStory();var t={act:"get_layout",voting_id:e,ref:"story",for_box:!0},i={containerClass:"story_poll",params:{hideButtons:!0,width:510,onDestroy:function(){o.props.playStory()}}};(0,p.showBox)("al_voting.php",t,i),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:"poll"}})},o.handleClickApp=function(){o.props.markAppNotificationsSeen(o.props.sticker),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:"app"}})},o.handleClickStickerSituationalTheme=function(){var e=o.props.sticker,t=e.situationalAppId,i=e.situationalThemeId;window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),o.props.pauseStory(),(0,_.showWiki)({w:"app"+t+"#"+i}),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:"situational_theme"}})},o.addAudio=function(e){u.AudioUtils.addAudio(e.target,void 0,(function(){o.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:o.props.sticker.id,type:"music"}})})),o.props.hideTooltip()},o.handleClickSticker=function(e){var t=o.props.sticker,i=t.stickerPackId,s=t.tooltipText,n=r.createElement("span",{onClick:o.onClickToStickerTooltip.bind(o,i),className:"StoriesTooltip__link"},s);o.props.toggleTooltip(e,n),o.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:o.props.sticker.id,type:"sticker"}})},o.onClickToStickerTooltip=function(e,t){window.Emoji.previewSticker(e,o,!1,t),o.onClickToTooltip("sticker")},o.setNext=function(e){var t=JSON.parse(o.props.sticker.audioData||"{}"),i=u.AudioUtils.asObject(t);o.playlist.setNext(e.currentTarget.parentNode,i,t),o.playlist.pause(),o.props.hideTooltip(),o.props.playStory()},o.onClickToTooltip=function(e){o.props.sendNavigationStatEvents("click_to_tooltip",!0,{clickable_sticker:{id:o.props.sticker.id,type:e}})},o.playlist=(0,_.getAudioPlayer)(),o}return(0,i.__extends)(t,e),t}(r.Component)},466033:(e,t,o)=>{o.d(t,{StickerTooltip:()=>n});var i=o(667294),r=o(973935),s=o(121265),n=function(e){var t=e.clientX,o=void 0===t?0:t,n=e.clientY,a=void 0===n?0:n,l=e.position,d=void 0===l?"t":l,c=e.layerEl,_=e.children,u=(0,s.classNames)("StoriesTooltip","StoriesTooltip--"+d);return i.createElement(i.Fragment,null,r.createPortal(i.createElement("div",{className:u,style:{top:a,left:o}},_),c))}},28462:(e,t,o)=>{o.d(t,{StoryBottom:()=>I});var i,r=o(570655),s=o(667294),n=o(684663),a=o(725437),l=o(509867),d=o(124956),c=o(276653),_=o(616515),u=o(313020),h=o(826239),p=o(414914),m=o(917685),v=o(41437),y=o(719016),f=o(442699),g=o(611386),w=o(659397),S=o(739124),E=o(458819),b=o(975803),k=o(463989),C=o(521114),T=o(763478),L=o(763358),B=o(314168),M=o(147650),A=o(254589),P=o(838482),x=o(429697);!function(e){e[e.STEP_LEFT=0]="STEP_LEFT",e[e.STEP_RIGHT=1]="STEP_RIGHT",e[e.STEP_PAUSE=2]="STEP_PAUSE"}(i||(i={}));var I=function(e){function t(t){var o=e.call(this,t)||this;return o.onSendFormButtonsMouseDown=function(e){o.needShowSendFormSeparately()&&!o.getMessageText()&&e.preventDefault()},o._onReactionClick=function(e,t){o._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:d.EMOJI_REACTIONS_ARR[t].name})},o.emojiInit=function(){var e;if(!o.emojiId&&o.refs.messageInput){var t=o._isReactionAvailable();if(o.emojiId=window.Emoji.init(o.refs.messageInput,{ttDiff:29,ref:"stories",ttWrap:o.refs.smileWrapper,checkEditable:function(){o.props.story.isActiveLive()&&_.default.checkTextLen(o.refs.messageInput)},noStickers:!t,noStickersStore:!t,onSend:function(){return o._sendMessage()},onStickerSend:function(e,t,i){o._sendMessage([["sticker",e,i]],{sticker_referrer:t}),o.needShowSendFormSeparately()&&o.state.isMessageFormExpanded&&o.toggleMessageForm(!1)},forceUp:!0,controlsCont:o.refs.sendForm,onKeyAction:function(){return o._emojiDidKeyAction()},onEmojiAdded:function(){return o._emojiDidKeyAction()},onStoreHide:function(){o._updateReactionStickers(),o.props.story.autoResumeStory()}}),(0,m.addEvent)(o.refs.smileButton,"click",m.cancelEvent),(0,u.placeholderInit)(o.refs.messageInput,{editable:!0}),o._checkLoadedStickers())o.preloadStickerImages();else{var i=(0,f.isRetina)()?"256b":"128b";window.Emoji.emojiLoadMore(o.emojiId,{sizes:(e={},e[i]=!0,e)},(function(){o._updateReactionStickers()}))}}else o.emojiId&&!o.refs.messageInput&&o.destroyEmoji()},o.onSendFormEntered=function(){o.setState({isSendFormAnimating:!1})},o.onSendFormExited=function(){o.setState({isSendFormAnimating:!1}),o.destroyEmoji()},o.destroyEmoji=function(){(0,m.removeEvent)(o.refs.smileButton,"click",m.cancelEvent),o.emojiId&&(window.Emoji.destroy(o.emojiId),delete o.emojiId)},o.toggleMessageForm=function(e){void 0===e&&(e=!0),o.state.isMessageFormExpanded!==e&&o.setState({isMessageFormExpanded:e,isSendFormAnimating:!0})},o.addToNarrativePress=function(){o.props.story.onAddToNarrativeBtnClick()},o.onLikeAnimationEnd=function(){o.setState({needAnimateLikeButton:!1})},o.linkDidPress=function(e,t){if(t){var i=o.props.story,s=t.object_type,n=t.object,a=t.url.match(/\/narrative(-?\d+)_(\d+)/);if(a){e.preventDefault();var l=(0,r.__read)(a,3),d=l[1],c=l[2];d&&c&&(i.pauseStory(),(0,h.showNarrative)(d,c,0,"",{fromEl:i.wrapEl,source:"narrative_story"}))}else i.layer.sendNavigationStatEvents("link_click"),i.sendStatEvent("url_view");switch(s){case"audio":o.state.linkObjectAudioPlaying?(window.getAudioPlayer().pause(),o.setState({story:(0,r.__assign)((0,r.__assign)({},o.state.story),{audioPlaying:!1})}),window.cur.storyLayer.resumeLayer()):(window.getAudioPlayer().playAudio(n),o.setState({story:(0,r.__assign)((0,r.__assign)({},o.state.story),{audioPlaying:!0})}),window.cur.storyLayer.pauseLayer()),o.setState({linkObjectAudioPlaying:!o.state.linkObjectAudioPlaying}),e.preventDefault()}}},o.startLinkArrowAnimation=function(){o.setState({linkArrowAnimationStep:i.STEP_RIGHT})},o.pauseLinkArrowAnimation=function(){o.setState({linkArrowAnimationStep:i.STEP_PAUSE})},o.onLinkArrowTransitionEnd=function(){var e=o.state.linkArrowAnimationStep;e!==i.STEP_RIGHT?e!==i.STEP_LEFT||o.setState({linkArrowAnimationStep:i.STEP_RIGHT}):o.setState({linkArrowAnimationStep:i.STEP_LEFT})},o.onLinkArrowMouseLeave=function(){o.state.isMessageFormExpanded||o.startLinkArrowAnimation()},o.emojiId=!1,o.state={story:t.story,sendFormHasText:!1,sendFormFocused:!1,linkObjectAudioPlaying:!1,isReactionsPanelShow:!1,reactionStickers:o._getReactionsStickers(),isMessageFormExpanded:!o.hasLink(),needAnimateLikeButton:!1,isSendFormAnimating:!1,linkArrowAnimationStep:i.STEP_LEFT},o.addToNarrativeRef=s.createRef(),o}return(0,r.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this;this.checkFeatureTooltip(),this.emojiInit(),requestAnimationFrame((function(){e.startLinkArrowAnimation()}))},t.prototype.checkFeatureTooltip=function(){var e=this.addToNarrativeRef.current;e&&this.props.story.showFeatureTooltipIfNeed(e)},t.prototype.componentWillUnmount=function(){this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId,window.cur.reactionFeatureTooltipTimeoutId&&(clearTimeout(window.cur.reactionFeatureTooltipTimeoutId),window.cur.reactionFeatureTooltipTimeoutId=null))},t.prototype.componentDidUpdate=function(e,t){var o=this.state.isMessageFormExpanded;this.emojiInit(),!t.isMessageFormExpanded&&o?(window.Emoji.focus(this.refs.messageInput),this.pauseLinkArrowAnimation()):t.isMessageFormExpanded&&!o&&this.startLinkArrowAnimation()},t.prototype.render=function(){var e=this.props.story,t=this.props.story.getCurStoryData();if(!e.story||!t)return"";var o={left_side_empty:this._leftSideIsEmpty()},i=t.canLike,r=t.canAddToNarrative,l=e.getSticker(d.StickerTypes.app),c=this.needShowSendFormSeparately();return s.createElement(s.Fragment,null,s.createElement("div",{className:(0,w.classNames)("stories_story_bottom",o)},s.createElement("div",{className:"stories_story_bottom_controls StoryBottomControls"},(i||l||c)&&s.createElement("div",{className:"StoryBottom__line StoryBottom__line--2"},c&&s.createElement(s.Fragment,null,this.renderMessageButton(),this.renderMessageForm()),i&&this.renderLike(),!i&&l&&this.renderAppButton()),l&&i&&s.createElement("div",{className:"StoryBottom__line StoryBottom__line--3"},this.renderAppButton()),s.createElement(a.ViewsButton,{className:"StoryBottomControl__control",story:e}),!c&&this.renderMessageForm(),this._renderLink(),r&&this.renderAddToNarrativeBtn(),this._renderShare(),s.createElement(n.ActionsButton,{story:e}))))},t.prototype.renderMessageButton=function(){var e=this;if(!this.props.story.getCurStoryData())return(0,g.logError)(new Error("Fail: renderMessageButton"),{environment:"stories"}),!1;if(this.needShowSendFormSeparately()){var t=this.state,o=t.isMessageFormExpanded,i=t.isSendFormAnimating;if(!o&&!i)return s.createElement(P.default,{text:(0,v.getLang)("stories_write_message"),position:"t",marginTop:-8},s.createElement("div",{className:"StoryButton StoryButtonMessage StoryButton--round",onClick:function(){return e.toggleMessageForm()}},s.createElement(S.default,{className:"StoryButton__icon"})))}},t.prototype.needShowSendFormSeparately=function(){return this._canMessage()&&this.hasLink()},t.prototype.hasAppSticker=function(){return!!this.props.story.getSticker(d.StickerTypes.app)},t.prototype.renderAppButton=function(){var e=this,t=this.props.story.getSticker(d.StickerTypes.app);if(t){var o=this.state,i=o.isMessageFormExpanded,r=!(o.isReactionsPanelShow||this.needShowSendFormSeparately()&&i);return s.createElement(x.default,{in:r,timeout:200,classNames:{enter:"StoryButtonApp--enter",enterActive:"StoryButtonApp--enterActive",exitActive:"StoryButtonApp--exitActive",exit:"StoryButtonApp--exit"},unmountOnExit:!0},s.createElement(P.default,{text:(0,v.getLang)("stories_app"),position:"t",marginTop:-8},s.createElement("div",{className:"StoryButtonApp StoryButton StoryButton--round",onClick:function(){return e.props.markAppNotificationsSeen(t)}},s.createElement(E.default,null),t.hasNewInteractions&&s.createElement("span",{className:"StoryButtonBadge StoryButtonBadge--orange StoryButton__badge"}))))}},t.prototype._renderLink=function(){var e=this,t=this.props.story.getCurStoryData();if(t){var o=this.state.linkArrowAnimationStep,r=t.link;if((0,f.isObject)(r)){var n="stories_link";return r.object_type&&(n+=" story_link_object_"+r.object_type),this.state.linkObjectAudioPlaying&&(n+=" story_link_object_audio_playing"),s.createElement("div",{className:"StoryLinkButton stories_link_wrap StoryBottomControl__control",onMouseEnter:this.pauseLinkArrowAnimation,onMouseLeave:this.onLinkArrowMouseLeave},s.createElement("a",{target:"_blank",rel:"noopener noreferrer",className:n,href:r.url,title:r.text,onClick:function(t){e.linkDidPress(t,r)},onTransitionEnd:this.onLinkArrowTransitionEnd},s.createElement("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:r.text}}),!this.state.linkObjectAudioPlaying&&s.createElement(b.default,{className:(0,w.classNames)("StoryLinkButton__icon",{"StoryLinkButton__icon--right":o===i.STEP_RIGHT})})))}}else(0,g.logError)(new Error("Fail: _renderLink"),{environment:"stories"})},t.prototype._renderShare=function(){var e=this.props.story.getCurStoryData();return e?e.can_share?s.createElement("div",{className:"StoryButton StoryButton--share StoryBottomControl__control",onMouseEnter:function(e){return(0,y.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:(0,v.getLang)("stories_share")})},onClick:this._shareButtonDidPress.bind(this)},s.createElement(k.default,{className:"StoryButton__icon"})):"":((0,g.logError)(new Error("Fail: _renderShare"),{environment:"stories"}),"")},t.prototype.renderAddToNarrativeBtn=function(){var e=this.props.story.getCurStoryData(),t=this.props.story.getCurrentNarrative();return e?t?null:s.createElement("div",{className:(0,w.classNames)("StoryButton StoryBottomControl__control",{"StoryButton--addedToNarrative":e.isPartOfNarrative,"StoryButton--addToNarrative":!e.isPartOfNarrative}),onMouseEnter:function(e){return(0,y.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:(0,v.getLang)("stories_add_to_narrative")})},onClick:this.addToNarrativePress,ref:this.addToNarrativeRef},e.isPartOfNarrative&&s.createElement(C.default,{className:"StoryButton__icon"}),!e.isPartOfNarrative&&s.createElement(T.default,{className:"StoryButton__icon"})):((0,g.logError)(new Error("Fail: renderAddToNarrativeBtn"),{environment:"stories"}),null)},t.prototype.renderLike=function(){var e=this.props.story.getCurStoryData();if(!e)return(0,g.logError)(new Error("Fail: _renderLike"),{environment:"stories"}),"";var t=e.isLiked,o=this.state,i=o.isMessageFormExpanded,r=o.needAnimateLikeButton,n=o.isReactionsPanelShow,a=this.hasAppSticker(),l=!(n||this.needShowSendFormSeparately()&&i);return s.createElement(x.default,{in:l,timeout:200,classNames:{enter:"StoryButtonLike--enter",enterActive:"StoryButtonLike--enterActive",exitActive:"StoryButtonLike--exitActive",exit:"StoryButtonLike--exit"},unmountOnExit:!0},s.createElement(P.default,{text:(0,v.getLang)("stories_like"),position:a?"l":"t",marginLeft:a?-8:0,marginTop:a?0:-8},s.createElement("div",{className:(0,w.classNames)("StoryButtonLike StoryButton StoryButton--round",{"StoryButtonLike--liked":t,"StoryButtonLike--animation":r}),onClick:this._likeButtonDidPress.bind(this),onAnimationEnd:this.onLikeAnimationEnd},t&&s.createElement(L.default,{className:"StoryButton__icon"}),!t&&s.createElement(B.default,{className:"StoryButton__icon"}))))},t.prototype._canMessage=function(){var e=this.props.story,t=e.getCurStoryData();return t?t.can_comment&&!e.isLiveEnded():((0,g.logError)(new Error("Fail: _canMessage"),{environment:"stories"}),!1)},t.prototype.hasLink=function(){var e=this.props.story.getCurStoryData();return e?(0,f.isObject)(e.link):((0,g.logError)(new Error("Fail: hasLink"),{environment:"stories"}),!1)},t.prototype.renderMessageForm=function(){var e=this,t=this.state,o=t.sendFormFocused,i=t.isMessageFormExpanded,r=t.reactionStickers,n=t.isSendFormAnimating,a=this.needShowSendFormSeparately();if(this._canMessage()){var d=s.createElement("div",{className:(0,w.classNames)("StorySendForm stories_send_form _emoji_field_wrap emoji_rpointer",{"StorySendForm--focus":o,"StorySendForm--separately":a,"StorySendForm--expanded":i,"StorySendForm--isAnimating":n}),ref:"sendForm"},s.createElement("div",{className:"StorySendForm__wrapper"},s.createElement("div",{className:"StorySendForm__background"}),s.createElement("div",{className:"StorySendForm__in"},s.createElement("div",{className:"stories_send_form_text_wrap"},s.createElement("div",{contentEditable:!0,ref:"messageInput",className:"stories_send_form_text",placeholder:(0,v.getLang)("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this)})),s.createElement("div",{className:"stories_send_form_helper",ref:"smileWrapper",onMouseDown:this.onSendFormButtonsMouseDown},s.createElement("div",{className:(0,w.classNames)("stories_send_form_buttons _emoji_wrap",{shown:this.state.sendFormFocused||this.state.sendFormHasText})},s.createElement("div",{ref:"smileButton",className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:function(t){window.Emoji.clearSizeCached(e.refs.smileButton),window.Emoji.show(e.refs.smileButton,t.nativeEvent)},onMouseLeave:function(t){return window.Emoji.hide(e.refs.smileButton,t.nativeEvent)},onMouseDown:function(e){return(0,m.cancelEvent)(e.nativeEvent)}},s.createElement(M.default,null)),s.createElement("div",{className:(0,w.classNames)("stories_send_form_button send",{active:this.state.sendFormHasText}),onClick:this._onSendMessageButtonCLick.bind(this)},s.createElement(A.default,null))))),this.renderDummyMessageIfNeeded()));return a&&(d=s.createElement(x.default,{in:i,classNames:{enter:"StorySendForm--enter",enterActive:"StorySendForm--enterActive",exitActive:"StorySendForm--exitActive",exit:"StorySendForm--exit"},onEntered:this.onSendFormEntered,onExited:this.onSendFormExited,addEndListener:function(e,t){e.addEventListener("transitionend",t,!1)},unmountOnExit:!0},d)),s.createElement("div",{className:"StoryBottom__sendFormWrapper StoryBottomControl__control"},s.createElement(x.default,{in:this.state.isReactionsPanelShow&&r.length>0,timeout:200,classNames:{enter:"StoryBottom__reactions--enter",enterActive:"StoryBottom__reactions--enterActive",exitActive:"StoryBottom__reactions--exitActive",exit:"StoryBottom__reactions--exit"},unmountOnExit:!0},s.createElement(l.ReactionsPanel,{className:"StoryBottom__reactions",stickers:r,onStickerClick:this._onReactionClick})),d)}},t.prototype.renderDummyMessageIfNeeded=function(){var e=this.state.isSendFormAnimating;if(this.needShowSendFormSeparately()&&e)return s.createElement("div",{className:"DummyRoundButton DummyRoundButton--message"},s.createElement(S.default,null))},t.prototype._isReactionAvailable=function(){return!this.props.story.isActiveLive()},t.prototype._onChangeReactionsPanelVisibility=function(e){void 0===e&&(e=!1),this._isReactionAvailable()&&this.setState({isReactionsPanelShow:e})},t.prototype._checkLoadedStickers=function(){return this._getReactionsStickers().length>=d.EMOJI_REACTIONS_ARR.length},t.prototype._leftSideIsEmpty=function(){var e=this.props.story,t=e.getCurStoryData();if(!t)return(0,g.logError)(new Error("Fail: _leftSideIsEmpty"),{environment:"stories"}),!1;var o=t.can_manage,i=t.link,r=t.can_comment,s=e.getReplies(),n=e.getViews();return!(n&&0!==parseInt(n))&&(!s||!o)&&!(0,f.isObject)(i)&&!r||e.isLiveEnded()},t.prototype._sendFormDidFocus=function(){var e=this.props.story;this.setState({sendFormFocused:!0}),this._isReactionAvailable()&&this._checkReactionsPanel(),e.onSendFormFocus(),e.layer.sendNavigationStatEvents("comment_tap")},t.prototype._sendFormDidBlur=function(){this.props.story.onSendFormBlur(),this.setState({sendFormFocused:!1}),this._isReactionAvailable()&&this._hideReactionPanel(),!this.getMessageText()&&this.needShowSendFormSeparately()&&this.toggleMessageForm(!1),this._emojiDidKeyAction()},t.prototype._emojiDidKeyAction=function(){var e,t=this.getMessageText();this.setState({sendFormHasText:t.length>0}),null===(e=this.refs.messageInput)||void 0===e||e.check()},t.prototype.getMessageText=function(){return(0,f.trim)(window.Emoji.editableVal(this.refs.messageInput))},t.prototype._hideReactionPanel=function(){this._onChangeReactionsPanelVisibility(!1)},t.prototype._showReactionPanel=function(){this._onChangeReactionsPanelVisibility(!0)},t.prototype._checkReactionsPanel=function(){this._isReactionAvailable()&&(this.props.story.getSendText().length?this._hideReactionPanel():this._showReactionPanel())},t.prototype._shareButtonDidPress=function(){this.props.story.shareBox()},t.prototype._likeButtonDidPress=function(){this.setState({needAnimateLikeButton:!0}),this.props.story.toggleLikeStory()},t.prototype._updateReactionStickers=function(){this.setState({reactionStickers:this._getReactionsStickers()}),this.preloadStickerImages()},t.prototype.preloadStickerImages=function(){this.state.reactionStickers.forEach((function(e){(new Image).src=e.imageUrl}))},t.prototype._getReactionsStickers=function(){var e=[];if(window.stickersKeywords&&window.Emoji.stickersById){var t=window.Emoji.stickersById,o=(0,f.isRetina)()?"256b":"128b",i={};d.EMOJI_REACTIONS_ARR.forEach((function(r){var s=window.stickersKeywords[(0,c.emojiRemoveSkinToneModifiers)(window.Emoji.codeToChr(r.code))],n=s&&window.Emoji.sortStickersHints(s),a={};n&&n.every((function(e){return!(e>0&&t[e]&&t[e].sticker&&!i[e])||(a=t[e].sticker,!1)})),a[6]&&a[6][o]&&(e.push({id:a[0],packId:0,uniqId:(0,f.irand)(0,1e5),imageUrl:a[6][o],animationUrl:a[3]}),i[a[0]]=!0)}))}return e},t.prototype._hideStickerHints=function(){var e=(0,p.geByClass1)("_sticker_hints",(0,p.domPN)(this.refs.messageInput));e&&"number"==typeof this.emojiId&&window.Emoji.stickersHintsHide(e,window.Emoji.opts[this.emojiId],100)},t.prototype._onSendMessageButtonCLick=function(){this._sendMessage()},t.prototype._sendMessage=function(e,t,o){var i=this;void 0===e&&(e=[]),void 0===t&&(t={}),void 0===o&&(o={});var r=e.length;this._hideStickerHints(),this.props.story.onAnswerSend((function(){i._emojiDidKeyAction(),r&&i._updateReactionStickers(),i.needShowSendFormSeparately()&&i.state.isMessageFormExpanded&&i.toggleMessageForm(!1)}),e,t,o)},t}(s.Component)},230697:(e,t,o)=>{o.d(t,{StoryStickers:()=>f});var i=o(570655),r=o(667294),s=o(275968),n=o(466033),a=o(423558),l=o(7692),d=o(881150),c=o(539503),_=o(124956),u=o(414914),h=o(41437),p=o(442699),m=o(897557),v=o(719016),y=o(917685),f=function(e){function t(t){var o=e.call(this,t)||this;o.componentDidMount=function(){window.addEventListener("resize",o.handleResize)},o.componentWillUnmount=function(){window.removeEventListener("resize",o.handleResize)},o.componentDidUpdate=function(){o.askTextarea.current&&o.askTextarea.current.focus()},o.onDisableAreaMouseDown=function(e){o.props.onMouseDownHandle(e.target)},o.onDisableAreaMouseUp=function(e,t){void 0===t&&(t=function(){}),o.props.onMouseUpHandle(e.target,t)},o.render=function(){var e=o.props,t=e.story,i=e.storyData,a=e.author,d=e.layerEl,c=e.showMessage,_=e.playStory,u=e.pauseStory,p=e.list,v=e.sendNavigationStatEvents,y=e.markAppNotificationsSeen,f=i.clickable_stickers,g=f.stickers,w=f.original_width,S=f.original_height,E=o.state,b=E.widthViewBox,k=E.heightViewBox,C=E.showTooltip,T=E.position,L=E.tooltipContent,B=E.showQuestionModal,M=E.clientX,A=E.clientY;return r.createElement("div",{className:"StoryStickers"},r.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:o.onDisableAreaMouseDown,onMouseUp:o.onDisableAreaMouseUp}),r.createElement("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:o.onDisableAreaMouseDown,onMouseUp:o.onDisableAreaMouseUp}),g.map((function(e,i){return r.createElement(s.StickerItem,{key:i,story:t,sticker:e,originalWidth:w,originalHeight:S,widthViewBox:b,heightViewBox:k,toggleTooltip:o.toggleTooltip,sendNavigationStatEvents:v,hideTooltip:o.hideTooltip,showQuestionModal:o.showQuestionModal,markAppNotificationsSeen:y,showMessage:c,playStory:_,pauseStory:u,list:p,onMouseDownHandle:o.onDisableAreaMouseDown,onMouseUpHandle:o.onDisableAreaMouseUp})})),C&&r.createElement(n.StickerTooltip,{clientX:M,clientY:A,layerEl:d,position:T},L),B&&r.createElement(l.default,{title:(0,h.getLang)("stories_question_ask_box_title").replace("{name}",(0,m.decodeHTMLEntities)(a.name_get)),actionButtons:o.getQuestionModalActions(),className:"StoryQuestionAskForm",onClose:o.closeQuestionModal,appearance:"blue"},r.createElement("div",{className:"StoryQuestionAskForm__inner"},r.createElement("textarea",{ref:o.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:80,placeholder:(0,h.getLang)("stories_question_ask_placeholder"),onChange:o.handleChange,onKeyDown:o.handleKeyDown}))))},o.handleResize=function(){var e=(0,i.__read)((0,u.getSize)(o.props.el),2),t=e[0],r=e[1];o.setState({widthViewBox:t,heightViewBox:r,showTooltip:!1})},o.toggleTooltip=function(e,t,i){void 0===i&&(i="t"),e.preventDefault(),e.stopPropagation();var r=e.clientX,s=e.clientY,n=o.props,a=n.pauseStory,l=n.playStory,d=n.hideFeedbackTooltip,c=n.sendNavigationStatEvents;d(),o.setState({showTooltip:!o.state.showTooltip,tooltipContent:t,clientX:r,clientY:s,position:i}),setTimeout((function(){o.state.showTooltip?(c("click_on_clickable_sticker"),a()):l()}),0)},o.hideTooltip=function(){o.setState({showTooltip:!1})},o.isShownTooltip=function(){return o.state.showTooltip||o.state.showQuestionModal},o.showQuestionModal=function(){var e=o.props,t=e.storyData,i=e.showMessage,r=e.pauseStory,s=e.onModalShownChange;if(!t.can_ask)return i((0,h.getLang)("stories_question_forbidden"));o.setState({showQuestionModal:!0}),o.hideTooltip(),s(!0),r()},o.closeQuestionModal=function(){var e=o.props,t=e.playStory,i=e.onModalShownChange;o.setState({showQuestionModal:!1}),i(!1),t()},o.handleChange=function(e){o.setState({questionText:e.target.value})},o.handleKeyDown=function(e){var t=o.state.questionText;(0,p.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==y.KEY.RETURN&&o.sendQuestion()},o.resetAskText=function(){o.setState({questionText:""})},o.getQuestionModalActions=function(){var e=o.props.storyData.can_ask_anonymous,t=o.state,i=t.isQuestionButtonLoading,s=t.questionText,n=[{value:_.QUESTION_SELECT_MODE.AUTHOR_ONLY,label:(0,h.getLang)("stories_question_select_author_only")},{value:_.QUESTION_SELECT_MODE.PUBLIC,label:(0,h.getLang)("stories_question_select_public")}];return e&&n.splice(1,0,{value:_.QUESTION_SELECT_MODE.ANONYMOUS,label:(0,h.getLang)("stories_question_select_anonymous")}),r.createElement("div",{className:"StoryQuestionAskForm__footer"},r.createElement("div",{className:"StoryQuestionAskForm__cell StoryQuestionAskForm__cell--select"},r.createElement(c.default,{value:o.state.selected,options:n,onChange:o.onSelectChange,onShow:o.onSelectShow,onHide:o.onSelectHide})),r.createElement("div",{className:"StoryQuestionAskForm__cell"},r.createElement(d.default,{key:"b",appearance:"tertiary",onClick:o.closeQuestionModal},(0,h.getLang)("global_cancel")),r.createElement(a.default,{key:"s",loading:i,disabled:!(0,p.trim)(s),onClick:o.sendQuestion},(0,h.getLang)("stories_question_reply_send"))))},o.onSelectChange=function(e){o.setState({selected:Number(e.selected.value)})},o.onSelectShow=function(){var e=o.props,t=e.storyData,i=e.author,r=t.can_ask_anonymous,s=document.querySelector(".StoryQuestionAskForm__cell--select");if(s){var n=r?"stories_question_about_user_tooltip":"stories_question_about_user_tooltip_without_anon",a=r?"stories_question_about_group_tooltip":"stories_question_about_group_tooltip_without_anon",l="";l=i.id>0?(0,h.getLang)(n).replace(/{name}/g,(0,m.decodeHTMLEntities)(i.firstName)):(0,h.getLang)(a),(0,v.showTooltip)(s,{text:l,width:350,slideX:15,className:"",nohide:!0,asrtl:!0,shift:[350,-15],dir:"left",showdt:1e3})}},o.onSelectHide=function(){var e=document.querySelector(".StoryQuestionAskForm__cell--select");e&&e.tt&&e.tt.destroy()},o.sendQuestion=function(){var e=o.state.questionText,t=o.props,r=t.showMessage,s=t.storyData,n=t.author,a=t.sendNavigationStatEvents,l=s.raw_id,d=s.askQuestionHash,c=(0,i.__read)(l.split("_"),2),u=c[0],p=c[1],m=!1,v=!1;o.state.selected===_.QUESTION_SELECT_MODE.PUBLIC?m=!0:o.state.selected===_.QUESTION_SELECT_MODE.ANONYMOUS&&(v=!0),window.ajax.post("al_stories.php",{act:"ask_question",story_owner_id:u,story_id:p,question_text:e,is_anonymous:+v,with_mention:+m,hash:d},{onDone:function(){switch(o.closeQuestionModal(),o.resetAskText(),r((0,h.getLang)("stories_question_sent").replace("{name}",n.first_name_ins)),o.state.selected){case _.QUESTION_SELECT_MODE.PUBLIC:a("question_reply_publish");break;case _.QUESTION_SELECT_MODE.AUTHOR_ONLY:a("question_reply");break;case _.QUESTION_SELECT_MODE.ANONYMOUS:a("question_reply_anonymous")}},onFail:function(e){return o.closeQuestionModal(),o.resetAskText(),r(e),!0},showProgress:function(){return o.setState({isQuestionButtonLoading:!0})},hideProgress:function(){return o.setState({isQuestionButtonLoading:!1})}})};var f=(0,i.__read)((0,u.getSize)(o.props.el),2),g=f[0],w=f[1];return o.askTextarea=r.createRef(),o.state={widthViewBox:g,heightViewBox:w,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:_.QUESTION_SELECT_MODE.AUTHOR_ONLY,questionText:""},o}return(0,i.__extends)(t,e),t}(r.Component)},725437:(e,t,o)=>{o.d(t,{ViewsButton:()=>d});var i=o(667294),r=o(429157),s=o(429697),n=o(923197),a=o(127376),l=o(659397),d=function(e){var t=e.story,o=e.className,d=void 0===o?"":o,c=t.getReplies(),_=t.getViews()||"",u=t.getCurStoryData();if(!u)return null;var h=u.can_manage,p=u.isNewQuestions,m=u.needShowEmptyStats,v=u.small_preview,y=!(!h||!_&&!m),f=t.isActiveLive(),g=t.getRawId(),w=t.isFeedbackTooltipShow,S=t.toggleFeedbackTooltip,E=t.onFetchFeedbackData,b=t.onFetchViewers,k=t.onQuestionRemove,C=t.feedback,T=t.showMoreReplies,L=t.onPrivacyHintHide;if(f||!_&&!c&&!m)return null;var B=t.showMessage.bind(t),M=t.layer.sendNavigationStatEvents.bind(t.layer),A="StoryButton StoryButton--feedback";return w&&(A+=" StoryButton--hover"),i.createElement("div",{className:(0,l.classNames)("StoryButtonWrapper StoryButtonWrapper--feedback",d)},i.createElement("div",{className:A,onClick:function(e){S(),m&&M("open_empty_feedback"),e.stopPropagation()}},c&&i.createElement("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--replies"},i.createElement(n.default,null),i.createElement("span",{className:"StoryButtonFeedbackLabel__text"},c)),y&&i.createElement("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--views"},i.createElement(a.default,null),i.createElement("span",{className:"StoryButtonFeedbackLabel__text"},_)),(m||p)&&i.createElement("span",{className:(0,l.classNames)("StoryButtonBadge StoryButton__badge",{"StoryButtonBadge--orange":p,"StoryButtonBadge--blue":!p&&m})})),i.createElement(s.default,{in:w,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0},i.createElement(r.default,{feedback:C,storyRawId:g,storyImageUrl:v,toggleFeedbackTooltip:S,onFetchFeedbackData:E,onFetchViewers:b,showMessage:B,sendNavigationStatEvents:M,onQuestionRemove:k,showMoreReplies:T,onPrivacyHintHide:L,needShowEmptyStats:m})))}},63577:(e,t,o)=>{o.d(t,{StoryLayer:()=>M});var i=o(570655),r=o(925977),s=o(422098),n=o(452021),a=o(895283),l=o(314561),d=o(486353),c=o(742692),_=o(778464),u=o(457495),h=o(124956),p=o(344624),m=o(434256),v=o(986900),y=o(393263),f=o(469433),g=o(442699),w=o(116886),S=o(917685),E=o(927663),b=o(519921),k=o(414914),C=o(611386),T=o(381862),L=o(268554),B=o(206155),M=function(){function e(e,t,o,i,r){try{window.Videoview&&window.Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,o,i),(0,k.addClass)(this.layerEl,"shown"),this._source=r.source,this._initViewerSource(),this._sendOpeningEvents()}return e.prototype._init=function(t,o,r,s){var n=(0,i.__read)(t.split("&"),2),a=n[0],l=n[1],d=void 0===l?"":l,c=(0,i.__read)(a.split("_"),2),_=c[0],u=c[1];this.storyRaw=a,this.storyOwner=_,this.storyId=+u,this.blockKey=""+_+d,this.list=o,this.storiesList=r,this.extra=e.parseExtra(s),this.extraRaw=s||"",this.initStories().catch((function(e){(0,b.debugLog)(e)}))},e.prototype.initStories=function(){var e=this;return new Promise((function(t){var o;e.storiesBlocks=e.storiesList.map((function(t){return e.getBlockKey(t)}));var i=!1,r=e.storiesBlocks.indexOf(e.blockKey);if(r>-1){var s=e.storiesList[r];i=s.items[s.items.length-1].unread}if(e.extra)switch(e.extra.context){case"new":i=!0;break;case"all":i=!1}if(i&&"replies"===e.list.substr(0,7)&&(i=!1),i){for(var n=[],a=0;a<e.storiesList.length;a++){var l=e.storiesList[a];(Array.isArray(l.items)&&l.items.length&&(null===(o=l.items[l.items.length-1])||void 0===o?void 0:o.unread)||0===a&&e._hasContext("new"))&&n.push(l)}n.length&&(e.storiesList=n,e.storiesBlocks=e.storiesList.map((function(t){return e.getBlockKey(t)})))}e.renderedStories={};var d=e._renderStories().activeStory;e.scrollToStory(d,!0),1===e.storiesList.length&&(0,k.addClass)(e.stories,"one_story"),e._startFirstStory(d,e.extra.story_id),(0,k.addClass)(e.stories,"inited"),t()}))},e.prototype.getBlockKey=function(e){var t;return e.items&&e.items.length&&"live"===e.items[0].type?e.author.id+"live":e.is_narrative?e.author.id+"narrative"+(null===(t=e.narrative)||void 0===t?void 0:t.id):this.list.includes("place")?e.author.id+"place":e.id?e.author.id+"id"+e.id:""+e.author.id},e.prototype._renderStories=function(){for(var e=this,t=[],o=0;o<this.storiesList.length;o++)this.storiesList[o]&&t.push(this.storiesList[o]);var i=this._getScreenStoriesCount(),s=this._getCurStoryPos(t.map((function(t){return e.getBlockKey(t)}))),n=Math.floor(i/2),a=t.slice(Math.max(0,s-n)).slice(0,i),l=a.map((function(t){return e.getBlockKey(t)}));for(var d in this.renderedStories)if(this.renderedStories.hasOwnProperty(d)){var c=this.renderedStories[d];l.includes(d)||(c.story.destroy(),delete this.renderedStories[d])}var _=null;if(a.map((function(t,o){var i=e.getBlockKey(t);if(!e.renderedStories[i]){var s=e.storiesBlocks.indexOf(i),a=t.author.id,l=new r.Story(t,{id:o,layer:e,onSelect:e._onSelectStory.bind(e),onStoriesEnd:e._onStoriesEnd.bind(e,s),onStoryRemoved:function(t,o){return e._onStoryRemoved(a,s,t,o)},playPrevOwner:e._playPrevOwner.bind(e,s),onPlayStory:e._onPlayStory.bind(e,s),onSeen:e._readStories.bind(e),onVideoPlay:e._onVideoPlay.bind(e),restoreAudioPlay:e._restoreAudioPlay.bind(e),onStartStory:e._onStartStory.bind(e),removeList:function(){return window.Stories.removeList(e.list)}});o<=n&&e.stories.children[o]?e.stories.insertBefore(l.render(),e.stories.children[o]):e.stories.appendChild(l.render()),e.renderedStories[i]={story:l,index:s},i===e.blockKey&&(_=l)}})),!_){var u=l[0];_=this.renderedStories[u].story}return{activeStory:_}},e.prototype._sendOpeningEvents=function(){if(this._source){var e;switch(this._source){case"narrative_story":e="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":e="narrative_open";break;case"narrative_recommendations":e="narrative_other"}if(e&&this.sendNavigationStatEvents(e,!1),"narrative_fave"===this._source){var t=this.activeStory.getCurrentNarrative();if(t){var o=t.ownerId,i=t.id;(0,v.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:o,item_id:i,time:window.getServerTime()})}}}},e.prototype._destroyStories=function(){for(var e in this.renderedStories){if(this.renderedStories.hasOwnProperty(e))this.renderedStories[e].story.destroy()}},e.prototype.destroy=function(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),(0,S.removeEvent)(this.volumeControl),(0,S.removeEvent)(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&document.body.removeChild(this.layerEl)}catch(e){}delete window.cur.storyLayer},e.prototype.getList=function(){return"story"+this.activeStory.getRawId()+"/"+this.list+(this.extraRaw?"/"+this.extraRaw:"")},e.prototype.getStoryRaw=function(){return!!this.activeStory&&this.activeStory.getRawId()},e.prototype.initDOM=function(){this.layerEl=(0,k.ce)("div",{className:"stories_layer"});var e=(0,k.ce)("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=(0,k.ce)("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild((0,k.ce)("div",{className:"stories_layer_close"})),(0,S.addEvent)(this.layerEl,"click",this._onLayerClick.bind(this)),document.body.appendChild(this.layerEl)},e.prototype.show=function(){window.onBodyResize()},e.prototype.hide=function(e){var t=this;(0,k.addClass)(this.layerEl,"stories_layer_hiding"),this.hideAllLayers||s.layerHide(),this._source&&this._source.startsWith("narrative")&&this.sendNavigationStatEvents("narrative_close",!1),this.activeStory&&(this.activeStory.pauseStory(),this.activeStory.hideTooltip(),this.activeStory.isActiveLive()&&this.sendNavigationStatEvents("live_player_close",!1),this._readStoriesIfNeeded(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.list)),!0!==e&&this.activeStory?this.animateStory("minimize").then((function(){return t.doHide()})).catch((function(){(0,b.debugLog)("error animate story")})):this.doHide(e),(0,k.removeClass)(this.layerEl,"shown")},e.prototype.doHide=function(e){this.destroy(),e||s.removeLayer(),window.wkcur&&window.wkcur.shown&&window.WkView.restoreLayer({}),"group_stories"===this.list&&window.Stories.groupStoriesBlockUpdate(),this.list.startsWith("archive")&&window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition(),(0,y.clear)()},e.prototype.back=function(){this.hideAllLayers=!1;var e=window.cancelStack[window.cancelStack.length-1];e&&"stories_form_focus"===e.name&&(0,p.cancelStackPop)(),this.hide(!1)},e.prototype._getScreenStoriesCount=function(){return 2*Math.floor(window.innerWidth/(window.innerHeight*n.STORY_HORIZONTAL_RATIO))+1},e.prototype._getCurStoryPos=function(e){return(e||this.storiesBlocks).indexOf(this.blockKey)},e.prototype._startFirstStory=function(e,t){var o=this;this.activeStory=e,(0,k.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.storyRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout((function(){(0,k.addClass)(o.stories,"animated"),o.inited=!0,"open"===o.extra.replies&&o.activeStory.showFeedbackTooltip()}))},e.prototype._markReadRestStories=function(e){e.data.is_groups||e.data.is_apps?this._onBlockWithCollapsedViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.data.items.length),this._updateBadge(e))},e.prototype._onBlockWithCollapsedViewEnd=function(e){var t,o,r,s,n,a,l=e.data.is_apps?"apps":"groups",d=window.Stories._getList(l);if(d){try{for(var c=(0,i.__values)(e.data.items),_=c.next();!_.done;_=c.next()){_.value.unread=!1}}catch(e){t={error:e}}finally{try{_&&!_.done&&(o=c.return)&&o.call(c)}finally{if(t)throw t.error}}var u=[];try{for(var h=(0,i.__values)(d),p=h.next();!p.done;p=h.next()){var m=p.value;try{for(var v=(n=void 0,(0,i.__values)(m.items)),y=v.next();!y.done;y=v.next()){var f=y.value;f.unread=!1,u.push(f.raw_id)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}(0,T.removeUnseenStories)(m.author.id),(0,L.removeUnseenStories)(m.author.id),(0,B.removeUnseenStories)(m.author.id)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(r)throw r.error}}this.markStoriesSkipped(u),this.updateMetaStoryItems();var g=(0,k.ge)("feed_story_"+this.getBlockKey(e.data));(0,k.removeClass)(g,"story_feed_new_item")}},e.prototype.markStoriesSkipped=function(e){window.ajax.post("al_stories.php",{act:"mark_skipped",stories:e.join(","),hash:this.storiesReadHash})},e.prototype._onSelectStory=function(e){var t,o=this;this.activeStory&&(t=this.activeStory.getWrap(),this.activeStory.stop()),e.id-this.activeStory.id>0&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e.data),clearTimeout(this.timer),(0,k.addClass)(this.stories,"animated"),this.timer=setTimeout((function(){(0,k.removeClass)(t,"active"),(0,k.addClass)(e.getWrap(),"active"),o.scrollToStory(),o.timer=setTimeout((function(){o.activeStory&&e.id!==o.activeStory.id||!o.activeStory||(e.indexToUnread(),o._startActiveStory(),o._renderStories(),o.scrollToStory(e,!0))}),200)}),0)},e.prototype._startActiveStory=function(){var e=this.activeStory;e.markAsActive(),e.playStory(!0)},e.prototype._onStartStory=function(){var e=this.activeStory,t=this.list;if(e){var o=this.activeStory.getCurStoryData(),r=this.activeStory.getCurrentNarrative();if(o){var s=window.nav.objLoc;if(s.w="story"+e.getRawId(),t.match(/^-?(\d+)_(\d+)$/)||(s.w+="/"+t),t.match(/^narrative[s]?-?\d+(_\d+)?/)){var n=o.raw_id,a=(0,i.__read)(n.split("_"),2)[1];s.w="narrative"+(null==r?void 0:r.rawId)+"_"+a}window.nav.setLoc(window.nav.toStr(s))}else(0,C.logError)(new Error("Fail: _onStartStory"),{environment:"stories"})}},e.prototype.scrollToStory=function(e,t){var o=this,i=this._getScrollLeft(e);t?((0,k.removeClass)(this.stories,"animated"),this._setScrollLeft(i)):this.inited&&(0,k.addClass)(this.stories,"animated"),setTimeout((function(){o._setScrollLeft(i)}))},e.prototype._setScrollLeft=function(e){(0,k.setStyle)(this.stories,"transform","translateX("+Math.round(e)+"px) translateZ(0)")},e.prototype._getScrollLeft=function(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()},e.prototype._onStoriesEnd=function(e,t){for(var o=-1,i=e+1;i<this.storiesList.length;i++){if(this.storiesList[i]){o=i;break}}var r=this._getStoryInstanceByIndex(o);if(o>-1&&r)t&&this.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this._onSelectStory(r);else{window.cur.storyLayer.activeStory.data.is_groups&&this._onBlockWithCollapsedViewEnd(window.cur.storyLayer.activeStory),window.cur.storyLayer.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.list),window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this._onBlockWithCollapsedViewEnd(window.cur.storyLayer.activeStory);var s=window.cancelStack[window.cancelStack.length-1];s&&"stories_form_focus"===s.name&&(0,p.cancelStackPop)(),(0,p.cancelStackPop)({byTimer:t})}},e.prototype._playPrevOwner=function(e){for(var t=-1,o=e-1;o>=0;o--){if(this.storiesList[o]){t=o;break}}var i=this._getStoryInstanceByIndex(t);t>-1&&i?this._onSelectStory(i):(0,p.cancelStackPop)()},e.prototype._markReadStoriesInRange=function(e,t,o){for(var i=e.data.items,r=t;r<o;r++){var s=i[r];s.unread&&(s.unread=!1)}},e.prototype._markReadPrevStories=function(e){this._markReadStoriesInRange(e,0,e.index)},e.prototype._updateBadge=function(e){if(!e.data.is_groups&&!e.data.is_apps){var t=(0,k.ge)("feed_story_"+this.getBlockKey(e.data)),o=(0,k.geByClass1)("_stories_feed_item_replies",t),i=e.data.items||[];(i[e.index]||{}).unread=!1;var r=!0;i.forEach((function(e){e.unread&&(r=!1)})),(0,k.val)(o,""),r&&((0,k.removeClass)(t,"story_feed_new_item"),(0,k.removeClass)(t,"story_feed_new_item_promo"),(0,T.removeUnseenStories)(e.data.author.id),(0,L.removeUnseenStories)(e.data.author.id),(0,B.removeUnseenStories)(e.data.author.id))}},e.prototype._onPlayStory=function(e){var t=this._getStoryInstanceByIndex(e);t&&(this.storiesReadHash=t.getReadHash(),t.data.is_groups||t.isAppsMetaStoryActive()||t.isActiveStoryOneTime()||(this._readStories(t),this._markReadPrevStories(t)),this._updateBadge(t));var o=this._getStoryInstanceByIndex(e+1);o&&o.preloadNextStory(o.getIndex())},e.prototype._getStoryInstanceByIndex=function(e){var t=this.storiesList[e];if(!t)return!1;var o=this.getBlockKey(t);return this.renderedStories[o].story},e.prototype._onStoryRemoved=function(e,t,o,i){for(var r=0;r<this.storiesList.length;r++)this.storiesList[r]&&this.storiesList[r].author.id===e&&delete this.storiesList[r];!o&&this._onStoriesEnd(t),window.Stories.updateFeedStories(null,{cb:i})},e.prototype.onVisibilityChange=function(){"visible"===document.visibilityState?window.cur.storyLayer&&window.cur.storyLayer.playStory():window.cur.storyLayer&&window.cur.storyLayer.pauseStory()},e.prototype.onResize=function(){this.activeStory&&window.cur.storyLayer.scrollToStory(this.activeStory,!0)},e.prototype.pauseStory=function(e){this.activeStory&&this.activeStory.pauseStory(e)},e.prototype.playStory=function(e){void 0===e&&(e=!1),this.activeStory&&this.activeStory.autoResumeStory(e)},e.prototype._onLayerClick=function(e){var t,o,r=(0,k.hasClass)(e.target,"stories_layer_close");if((0,k.hasClass)(e.target,"stories_layer_cont")||r){if(this.storiesBlocks.length-1===this._getCurStoryPos()&&!r){var s=[];try{for(var n=(0,i.__values)(this.activeStory.data.items),a=n.next();!a.done;a=n.next()){var l=a.value;s.push(l.raw_id),l.unread=!1}}catch(e){t={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}this.markStoriesSkipped(s),this._markReadRestStories(this.activeStory)}(0,p.cancelStackPop)({isCloseBtnClick:r})}},e.prototype._checkKeyEvents=function(e){return!((0,k.attr)(e.target,"contenteditable")||(0,g.inArray)(e.target.tagName,["INPUT","TEXTAREA"])||window.curBox())},e.prototype.onKeyDown=function(e){if(window.cur.storiesKeyDown)window.cur.storyLayer&&window.cur.storyLayer._checkKeyEvents(e)&&(0,S.cancelEvent)(e);else if(window.cur.storiesKeyDown=e.keyCode!==S.KEY.ESC,[S.KEY.PAGEDOWN,S.KEY.PAGEUP].includes(e.keyCode))(0,S.cancelEvent)(e);else if(window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case S.KEY.LEFT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.prevStory();break;case S.KEY.RIGHT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory();break;case S.KEY.SPACE:(0,S.cancelEvent)(e);var t=window.cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(window.cur.storiesKeyDownLong=setTimeout(t.longTapHandle.bind(t),h.LONG_PRESS_DELAY_MS))}window.cur.storiesKeyDownTs=(0,g.vkNow)()}},e.prototype.onKeyUp=function(e){window.cur.storiesKeyDown=!1,clearTimeout(window.cur.storiesKeyDownLong),window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)&&e.keyCode===S.KEY.SPACE&&((0,S.cancelEvent)(e),(0,g.vkNow)()-window.cur.storiesKeyDownTs>h.LONG_PRESS_DELAY_MS?window.cur.storyLayer.playStory(!0):(this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory()))},e.prototype.nextStory=function(){this.activeStory&&this.activeStory.nextStory()},e.prototype.prevStory=function(){this.activeStory&&this.activeStory.prevStory()},e.prototype.changeStory=function(e){this.activeStory&&this.activeStory.changeStory(e)},e.prototype._readStoriesIfNeeded=function(e){e.isActiveStoryOneTime()&&this._readStories(e)},e.prototype._readStories=function(e){if(e){var t=e.getRawId(),o=e.getCurrentNarrative();if(t&&e.isLoaded()){var i=e.getTrackCode(),r=0;e.isActiveStoryOneTime()&&(r=Math.max(Math.round(e.getStoryProgressPercent()),1)),i||(i=""),window.ajax.post("al_stories.php",{act:"read_stories",story_id:t,track_code:i,progress:r,source:this._getSource(),navigation_stats:(0,m.serializeNavigationStats)(),loading_stats:(0,m.serializeLoadingStats)(),connection_type:(0,m.getConnectionType)(),hash:e.getReadHash(),narrative_id:null==o?void 0:o.id})}}},e.prototype._getSource=function(){return[c.MODULE,_.MODULE,h.STORIES_MANAGE_MODULE,u.MODULE].includes(window.cur.module)?window.cur.module:this._source?this._source:"list"},e.prototype.sendNavigationStatEvents=function(e,t,o){var i;void 0===t&&(t=!0),void 0===o&&(o={});var r=this.activeStory,s=this.getStoryRaw()||(null===(i=r.getCurStoryData())||void 0===i?void 0:i.raw_id),n=this._getSource();t&&this._sendProductAnalyticEvents(e,o),this._updateLastStoryOpenAction(e),(0,m.saveNavigationStatEvent)({storyRawId:s,source:n,action:e})},e.prototype._sendProductAnalyticEvents=function(e,t){var o;void 0===t&&(t={});var i=this.activeStory,r=this.getStoryRaw()||(null===(o=i.getCurStoryData())||void 0===o?void 0:o.raw_id);if(r){var s=r.split("_"),n=Number(s[0]),c=Number(s[1]),_=i.getIndex(),u=i.getItemsLength()-_,h=i.story,p=this._getSource(),m=i.getCurrentNarrative(),y=i.isGroupedStory(),f=0;if(e&&i&&h&&n&&c){y&&(c=0,n=0,f=0),"groups"===this.list&&(f=1);var g={event_type:e,story_owner_id:n,story_id:c,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),volume:100*a.getVolume(),view_entry_point:p,stories_author_before:_,stories_author_after:u,nav_screen:window.cur.module,view_event_timeline_position:h.getCurrentTime(),story_type:y?"group_feed":"",is_grouped:f,track_code:h.getTrackCode()};m&&Object.assign(g,{narrative_id:m.id,narrative_owner_id:m.ownerId}),Object.assign(g,t),(0,d.partConfigEnabled)("web_stats_transport_story_view")?(0,l.saveStoryViewStats)(g):(0,v.statlogsValueEvent)("story_product_analytics",g)}}else(0,C.logError)(new Error("_sendProductAnalyticEvents: storyRawId is undefined"),{environment:"stories"})},e.prototype._updateLastStoryOpenAction=function(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}},e.prototype._initViewerSource=function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.section;break;default:this.viewerSource=e}},e.prototype.sendViewerStartTime=function(e,t){var o=this.viewerSource;(0,m.saveViewerStartTime)({storyRawId:e,source:o,time:t})},e.prototype._onVideoPlay=function(){var e=this.activeStory.getCurStoryData();e?e.noSound||(window.Notifier.lcSend("stories_video_start"),window.getAudioPlayer().isPlaying()&&((0,f.getAudioPlayer)().pause(),this.needAudioReset=!0)):(0,C.logError)(new Error("Fail: _onVideoPlay"),{environment:"stories"})},e.prototype._onVideoEnd=function(){this._restoreAudioPlay()},e.prototype._restoreAudioPlay=function(){window.Notifier.lcSend("stories_video_end"),this.needAudioReset&&(window.getAudioPlayer().play(),delete this.needAudioReset)},e.prototype._renderBackButton=function(){return this.backButton=(0,k.se)('<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">'+(0,w.getLang)("global_back")+"</div>\n  </div>\n</div>"),(0,S.addEvent)(this.backButton,"click",(function(){(0,p.cancelStackPop)()})),this.backButton},e.prototype.showBackButton=function(){(0,k.show)(this.backButton),this.hideAllLayers=!0,(0,k.addClass)(this.layerEl,"with_back_button")},e.parseExtra=function(e){var t,o,r={},s=String(e).split(";");try{for(var n=(0,i.__values)(s),a=n.next();!a.done;a=n.next()){var l=a.value,d=(0,i.__read)(l.split(":"),2),c=d[0],_=d[1];c&&_&&(r[c]=_)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}return r},e.prototype.getAnimateFromElem=function(){if(!this.hideAllLayers){var e=this.getBlockKey(this.activeStory.data);if((0,k.hasClass)(this.animateFromEl,"stories_feed_reply_item")){var t=(0,k.domQuery)("#feed_story_"+e,(0,k.domPN)(this.animateFromEl))[0];if(t)return t}else if("feed"===window.cur.module&&!(0,k.isVisible)(this.backButton)){var o=(0,k.ge)("feed_story_"+e);if(o)return window.Stories.feedScrollToOwner(e),o}}return this.animateFromEl},e.prototype.animateStory=function(e,t){var o=this;return new Promise((function(r){if("expand"===e&&!t||"minimize"===e&&!o.animateFromEl)return(0,k.setStyle)("stories_layers_background","opacity",1),r();o.pauseStory(),(0,k.addClass)(o.layerEl,"animation"),(0,k.removeClass)(o.stories,"animated");var a="expand"===e?t:o.getAnimateFromElem();if(o.hideAllLayers&&"minimize"===e){var l=s.getFirstLayer();a=l.getAnimateFromElem(),s.slicePrevLayers(),s.layerHide()}(0,k.removeClass)(a,"stories_feed_item_ava_animate");var d=(0,i.__read)((0,k.getXY)(a),2),c=d[0],_=d[1],u=(0,k.getSize)(a),h=window.innerHeight,p=Math.min(n.STORY_MAX_WIDTH,Math.max(n.STORY_MAX_HEIGHT,h*n.STORY_HORIZONTAL_RATIO)),m=p*n.STORY_VERTICAL_RATIO,v=Math.max(0,(h-m)/2),y=Math.max(0,(window.innerWidth-p)/2);c=y-c+p/2-u[0]/2+Number((0,E.scrollGetX)()),_=v-_+m/2-u[1]/2+Number((0,E.scrollGetY)()),c=-c,_=-_;var f={};"expand"===e&&(f.transform="translate("+c+"px, "+_+"px) scale(0)",o.animateFromEl=t),(0,k.setStyle)(o.activeStory.wrapEl,f),"minimize"===e&&(0,k.setStyle)(a,"transform","scale(0)"),o.animationTimer=setTimeout((function(){(0,k.addClass)(o.stories,"animated"),(0,k.addClass)(a,"stories_feed_item_ava_animate"),o.animationTimer=setTimeout((function(){"expand"===e?((0,k.setStyle)("stories_layers_background","opacity",1),(0,k.setStyle)(o.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):((0,k.setStyle)(o.activeStory.wrapEl,"transform","translate("+c+"px, "+_+"px) scale(0.01)"),(0,k.setStyle)(a,"transform","scale(1)")),o.animationTimer=setTimeout((function(){r(),"expand"===e?((0,k.setStyle)(o.activeStory.wrapEl,"transform",""),(0,k.removeClass)(o.layerEl,"animation"),(0,k.removeClass)(o.stories,"animated"),o.playStory(),s.layerShown()):((0,k.removeClass)(a,"stories_feed_item_ava_animate"),(0,k.setStyle)(a,"transform",""))}),330)}),30)}),30)}))},e.prototype.pauseLayer=function(){this.pauseStory(),(0,k.addClass)(this.layerEl,"paused")},e.prototype.resumeLayer=function(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&(window.cur.storyLayer.activeStory.data.is_groups&&window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&this.updateMetaStoryItems(),this.activeStory.isFeedbackTooltipShow&&this.activeStory.updateBottom(),this.playStory(),(0,k.removeClass)(this.layerEl,"paused"))},e.prototype.updateMetaStoryItems=function(){if(window.cur.storyLayer&&window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.story&&(window.cur.storyLayer.activeStory.data.is_groups||window.cur.storyLayer.activeStory.isAppsMetaStoryActive())){var e="groups";window.cur.storyLayer.activeStory.isAppsMetaStoryActive()&&(e="apps");var t=window.cur.storyLayer.activeStory.story.elems.recItems.querySelectorAll(".GridStoryPreview:not(.GridStoryPreview--live)"),o=window.Stories._getList(e);if(!o)return this.hideAllLayers=!0,void this.hide();var i=0;t.forEach((function(e){var t=e.querySelector(".GridStoryPreview__author"),r=e.querySelector(".GridStoryPreview__inner");if(t&&r){var s=Number(t.getAttribute("data-author-id")),n=o.find((function(e){return e.author.id===s&&"live"!==e.items[0].type}));if(!n)return++i,void e.remove();var a=n.items.findIndex((function(e){return e.unread}));-1===a&&(a=0,(0,k.removeClass)(t,"GridStoryPreview__author--unread"));var l=n.items[a],d=new Image;d.src=l.small_preview,d.onload=function(){(0,k.setStyle)(r,{backgroundImage:"url('"+l.small_preview+"')"})}}})),t.length-i<3&&(this.hideAllLayers=!0,this.hide())}},e.prototype.setLayerVisibility=function(e){(0,k.toggle)(this.layerEl,e)},e.prototype._renderVolumeControl=function(){return this.volumeControl=(0,k.se)('<div class="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),(0,S.addEvent)((0,k.geByClass1)("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),(0,S.addEvent)(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=(0,k.ce)("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer},e.prototype._volumeControlOnMouseDown=function(e){var t=this;(0,k.addClass)(this.volumeControlContainer,"changing");var o=(0,k.geByClass1)("stories_volume_control_slide",this.volumeControl),r=(0,k.geByClass1)("stories_volume_control_slide_indicator",o),s=(0,i.__read)((0,k.getXY)(o),1)[0],n=(0,i.__read)((0,k.getSize)(o),1)[0],l=function(e){var o=Math.max(0,Math.min(e.pageX-s,n))/n*100;(0,k.setStyle)(r,"width",o+"%"),a.setVolume(o/100),t.activeStory.volumeUpdate()},d=function(){(0,S.removeEvent)(window,"mousemove",l),(0,S.removeEvent)(window,"mouseup",d),t._updateVolumeButton(),(0,k.removeClass)(t.volumeControlContainer,"changing")};(0,S.addEvent)(window,"mousemove",l),(0,S.addEvent)(window,"mouseup",d),l(e)},e.prototype._updateVolumeButton=function(){var e=100*a.getVolume();(0,k.toggleClass)(this.volumeControl,"low",e>0&&e<50),(0,k.toggleClass)(this.volumeControl,"high",e>=50);var t=(0,k.geByClass1)("stories_volume_control_slide_indicator",this.volumeControl);(0,k.setStyle)(t,"width",e+"%")},e.prototype._volumeControlOnClick=function(e){if(!(0,k.hasClass)(e.target,"stories_volume_control_slide_wrap")&&!(0,k.hasClass)(this.volumeControlContainer,"changing")){var t=a.getVolume();t=t?0:1,a.setVolume(t),this._updateVolumeButton(),this.activeStory.volumeUpdate()}},e.prototype.onReplyDeleted=function(e){this.activeStory&&this.activeStory.onReplyDeleted(e)},e.prototype._hasContext=function(e){return this.extra&&this.extra.context&&this.extra.context===e},e}()},998423:(e,t,o)=>{o.d(t,{default:()=>c});var i=o(570655),r=o(435501),s=o(895283),n=o(900233),a=o(616515),l=o(116886),d=o(414914);const c=function(e){function t(t,o,i){var r=e.call(this,t,o)||this;return r.wrapEl=i,r.videoRaw=r.data.video.owner_id+"_"+r.data.video.video_id,r}return(0,i.__extends)(t,e),t.prototype.render=function(){var t=this;e.prototype.render.call(this),this.el=(0,d.ce)("div",{className:"stories_live"});var o=(0,d.ce)("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(o),this.chatEl=(0,d.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&window.Videoview.hide(!1,!0),setTimeout((function(){(0,n.showInlineVideo)(t.videoRaw,"",{autoplay:1,module:"story",onLoaded:function(){t._onPlayerInited()}},!1,o)})),this.el},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._resetTimer(),window.mvcur={},this.player&&(this.player.destroy(),a.default.destroy()),window.cur.storyLayer.sendNavigationStatEvents("live_player_close",!1),delete this.el},t.prototype.getContainer=function(){return this.el||this.render()},t.prototype.onLiveEnded=function(){var e=this;this.liveEnded=!0,(0,d.hide)((0,d.geByClass1)("_error_msg",(0,d.geByClass1)("videoplayer_error")));var t=this.mvData.oid<0?(0,l.getLang)("stories_live_ended_desc_club"):(0,l.langSex)(this.mvData.author_sex,(0,l.getLang)("stories_live_ended_desc_user","raw"));t=t.replace("{name}",this.mvData.md_author);var o=this.mvData.oid<0?(0,l.getLang)("stories_live_ended_open_club"):(0,l.getLang)("stories_live_ended_open_user");(0,d.hide)(this.chatEl),(0,d.hide)((0,d.domByClass)(this.player.ui.thumb,"videoplayer_big_play_btn"));var i=window.cur.storyLayer.storiesBlocks.length>1;this.el.appendChild((0,d.se)('\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url('+this.mvData.author_photo+')"></div>\n      <div class="stories_live_end_title">'+(0,l.getLang)("stories_live_ended_title")+'</div>\n      <div class="stories_live_end_desc">'+t+'</div>\n      <a href="'+this.mvData.author_href+'" class="stories_live_end_open_owner">'+o+'</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="'+(i?"":"display: none;")+'">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">'+(0,l.getLang)("stories_live_ended_watch_next")+"</div>\n      </div>\n    </div>\n    ")),i&&setTimeout((function(){e._startTimer()}))},t.prototype.pause=function(){},t.prototype.play=function(){this.player&&!this.liveEnded&&(e.prototype.play.call(this),this.player&&this.player.play())},t.prototype.sendMessage=function(e,t){e.length>window.mvcur.maxChatReplyLength||(window.ajax.post("al_video.php?act=post_comment",{comment:e,video:this.videoRaw,hash:this.mvData.hash,videoviewer_chat:1}),window.cur.storyLayer.activeStory.onAnswerSent(t))},t.prototype.volumeUpdate=function(){this.player.setVolume(s.getVolume())},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this),(0,d.setStyle)(this.el,"opacity",1)},t.prototype._onPlayerInited=function(){this._onCanPlay(),this.player=window.cur.videoInlinePlayer,this.play(),window.cur.storyLayer.sendNavigationStatEvents("live_player_show",!1),window.browser.safari&&this.player.toggleMute(!0,!1),this.mvData=window.Videoview.getMvData(),window.mvcur={chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion},a.default.init(this.chatEl,{scrollHidden:!0}),window.Videoview.queueCheckUpdates(this.mvData.queue_params)},t.prototype._startTimer=function(){var e=this;if(window.CanvasRenderingContext2D){var t=(0,d.domByClass)(this.el,"_timer_canvas"),o=t.getContext("2d");o.lineWidth=6,o.lineCap="round",o.strokeStyle="#fff";var i=Date.now(),r=function(){var t=(Date.now()-i)/5e3;t<1?(o.clearRect(0,0,100,100),o.beginPath(),o.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*t),o.stroke(),e._nextTO=setTimeout(r,16)):window.cur.storyLayer.nextStory()};(0,d.show)(t),this.timerInProgress=!0,r()}},t.prototype._resetTimer=function(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,(0,d.hide)((0,d.domByClass)(this.el,"_timer_canvas")))},t}(r.default)},476978:(e,t,o)=>{o.d(t,{loadMedia:()=>h,default:()=>p});var i,r=o(414914),s=o(442699),n={},a={},l=[],d=!1,c=!1;function _(e,t,o){var i=a[e];if(i)for(var r=0;r<i.length;r++){var s=i[r];t?s.resolve(o):s.reject(),i.splice(r,1),r--}}function u(e){d&&d.postMessage({cmd:"load",url:e})}function h(e){return d||((d=new Worker("/dist/workers/stories_loader_worker.js")).onmessage=function(e){var t=e.data;switch(t.type){case"loaded":n[t.url]=t.data,_(t.url,!0,t.data);break;case"error":_(t.url,!1);break;case"inited":c=!0;for(var o=0;o<l.length;o++)u(l[o])}}),new Promise((function(t,o){if(e||t(""),n[e])return t(n[e]);switch(function(e){return e.match(/\.mp4/)?"video":e.match(/\.(png|jpg|jpeg|gif)/)||e.match(/\.mycdn\.me\/getVideoPreview/)?"image":void 0}(e)){case"video":case"image":a[e]||(a[e]=[]);var i=0===a[e].length;if(a[e].push({resolve:t,reject:o}),!i)return;c?u(e):l.push(e);break;default:window.vk.dev&&console.error("wrong media url")}}))}function p(e){var t;return i||(t=function(e){try{if(e.contentDocument)return e.contentDocument;if(e.contentWindow&&e.contentWindow.document)return e.contentWindow.document}catch(e){}return!1}(window.utilsNode.appendChild(document.createElement("iframe"))),i=t&&t.body?t.body:window.utilsNode.appendChild((0,r.ce)("div",{},{display:"none"}))),e.match(/\.mp4/)?function(e){return new Promise((function(t,o){var s=(0,r.ce)("video",{});s.oncanplay=function(){t(),(0,r.re)(s)},s.onerror=function(){o(),(0,r.re)(s)},i.appendChild(s),s.src=e}))}(e):function(e){return new Promise((function(t,o){var n=(0,s.vkImage)();n.onload=function(){t(),(0,r.re)(n)},n.onerror=function(){o(),(0,r.re)(n)},i.appendChild(n),n.src=e}))}(e)}},776528:(e,t,o)=>{o.d(t,{default:()=>a});var i=o(570655),r=o(476978),s=o(435501),n=o(414914);const a=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r.pauseTime=0,r}return(0,i.__extends)(t,e),t.prototype.render=function(){var t=this;if(e.prototype.render.call(this),this.photo)return this.photo;var o=this.data.photo_url;return this.photo=document.createElement("div"),this.photo.setAttribute("class","stories_photo"),this._isFailed()||(0,r.loadMedia)(o).then((function(e){t.photo&&((0,n.setStyle)(t.photo,"backgroundImage","url('"+e+"')"),t._onCanPlay())})).catch((function(){t.isGroupsMetaStory||t.isAppsMetaStory?t._onCanPlay():t._loadingError()})),this.photo},t.prototype.getContainer=function(){return this.isGroupsMetaStory||this.isAppsMetaStory||this.photo||this.render()},t.prototype.destroy=function(){e.prototype.destroy.call(this),delete this.photo},t.prototype.play=function(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),e.prototype.play.call(this)},t.prototype.pause=function(){this.isPaused()||(e.prototype.pause.call(this),this.pauseTime=this.getCurrentTime())},t.prototype.setCurrentTime=function(e){void 0===e&&(e=0),this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)},t.prototype.getCurrentTime=function(){return Date.now()-this.startTs||0},t.prototype.getDuration=function(){return 5e3},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this);var t=this.isGroupsMetaStory?"group_feed_view":"view_story";window.cur.storyLayer.sendNavigationStatEvents(t,!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0}),(0,n.setStyle)(this.photo,"opacity",1)},t}(s.default)},469190:(e,t,o)=>{o.d(t,{Stories:()=>g});var i=o(570655),r=o(63577),s=o(476978),n=o(422098),a=o(414914),l=o(881308),d=o(257367),c=o(917685),_=o(587041),u=o(116886),h=o(442699),p=o(621260),m=o(791563),v=o(705456),y=o(611386),f={},g={show:function(e,t){if(void 0===t&&(t={}),e.match(/story/)&&(e=this._parseList(e)),window.cur.storyLayer&&window.cur.storyLayer.list===e.split("/")[1])return!1;g.getList(e,t).then((function(e){var o=e.blockKey,i=e.list,s=e.items,a=e.extra;n.checkAndPrepareBoxQueue(t),n.addLayer(new r.StoryLayer(o,i,s,a,t),t)})).catch((function(e){(0,y.logError)(new Error(e)),(0,m.showFastBox)((0,u.getLang)("global_error"),(0,u.getLang)("global_unknown_error"))}))},_getUnreadStory:function(e,t){e=(0,h.intval)(e);for(var o=!1,i=0;i<t.length;i++)if(t[i].author.id===e){for(var r=t[i].items,s=0;s<r.length;s++)if(r[s].unread){o=r[s];break}o||(o=r[0]);break}return o},getList:function(e,t){return new Promise((function(o,r){var s=(0,i.__read)(e.split("/"),3),n=s[0],a=s[1],l=s[2],d={blockKey:n,list:a,extra:l,items:[]},c=g._getList(a);Array.isArray(c)?(d.items=c,o(d)):window.ajax.post("al_stories.php",{act:"get_list",list:a,story_raw:n,extra:l,track_code:null==t?void 0:t.trackCode},{loader:!0,onDone:function(e){window.cur["stories_list_"+a]=e,d.items=e,o(d)},onFail:function(e){return r(e),!0}})}))},_getList:function(e){return window.cur["stories_list_"+e]},_setList:function(e,t){window.cur["stories_list_"+e]=t},removeList:function(e){delete window.cur["stories_list_"+e]},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i),o=(0,i.__read)(t,7),r=o[1],s=o[2],n=o[4],a=o[6],l=r+"_"+s;return e.match(/from_feed\=1/)?n="feed":e.match(/profile\=1/)?n="profile":n||(n=l),l+"/"+n+"/"+a},initFeed:function(e){var t=this;void 0===e&&(e="stories_feed_items_container"),"string"==typeof e&&(e=(0,a.ge)(e));var o=(0,a.geByClass1)("stories_feed_items",e),i=(0,a.attr)(o,"id");g.updateFeedArrows(i);var r=function(){(0,c.addEvent)(e,"wheel",t.feedMouseWheel)},s=function(){(0,c.removeEvent)(e,"wheel",t.feedMouseWheel)};(0,c.addEvent)(e,"mouseenter",r),(0,c.addEvent)(e,"mouseleave",s),window.cur.destroy&&window.cur.destroy.push((function(){(0,c.removeEvent)(e,"wheel",this.feedMouseWheel),(0,c.removeEvent)(e,"mouseenter",r),(0,c.removeEvent)(e,"mouseleave",s)}))},feedNext:function(e){var t=(0,a.ge)("stories_feed_wrap");return e&&(t=(0,a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("next",null,t)},feedPrev:function(e){var t=(0,a.ge)("stories_feed_wrap");return e&&(t=(0,a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("prev",null,t)},feedPaging:function(e,t,o){o||(o=(0,a.ge)("stories_feed_wrap"));var i=(0,a.geByClass1)("stories_feed_items",o),r=(0,a.attr)(i,"id"),s=r+"_position",n=f[s]||0,l=(0,a.getSize)(o)[0];if((0,h.isNumeric)(e))n+=Number(e);else{var d=l-100;"next"===e?n+=d:n-=d}f[s]=Math.max(0,Math.min(n,i.scrollWidth-l)),t?(0,a.removeClass)(i,"animated"):(0,a.addClass)(i,"animated"),(0,a.setStyle)(i,"transform","translateX(-"+f[s]+"px)"),g.updateFeedArrows(r)},feedScrollToOwner:function(e){var t=(0,a.ge)("feed_story_"+e);if(t){var o=(0,a.domClosest)("stories_feed_items",t),i=o.offsetWidth,r=(0,a.attr)(o,"id")+"_position",s=t.offsetWidth,n=t.offsetLeft,l=(0,a.domClosest)("stories_feed_wrap",o);f[r]=n-i+i/2+s/2,g.feedPaging(0,!0,l)}},updateFeedStories:function(e,t,o){var i=this;void 0===o&&(o="stories_feed_items");var r=(0,a.ge)(o),s=(0,a.domClosest)("stories_feed_wrap",r);if(e=e||"news",r)if((0,h.inArray)(e,["news","search"])){var n=function(e,r){t&&t.cb&&t.cb(),Object.keys(r).forEach((function(e){return i._setList(e,r[e])})),window.cur.storyLayer&&window.cur.storyLayer.updateMetaStoryItems();var n=(0,a.ge)(o);n&&(e?((0,a.setStyle)(n,"transform","translateX(0px)"),(0,a.val)(n,e),n.children.length<6?(0,a.addClass)(s,"stories_feed_not_nav_buttons"):(0,a.removeClass)(s,"stories_feed_not_nav_buttons"),f[o+"_position"]=0,g.updateFeedArrows(o),(0,a.show)(s)):(0,a.hide)(s))};if(t&&t.stories){var l=t.section,d=t.q,c=t.stories,_=c.html,u=c.js,p=u.feed?u.feed:[];return"search"!==l||d&&p.length?void n(_,u):void(0,a.hide)(s)}window.ajax.post("al_stories.php",{act:"feed_stories"},{onDone:n})}else(0,a.hide)(s)},feedMouseWheel:function(e){var t=(0,a.domClosest)("stories_feed_wrap",e.target);if(!(0,a.hasClass)(t,"stories_feed_not_nav_buttons")){(0,c.cancelEvent)(e);var o=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;g.feedPaging(o,!0,t)}},updateFeedArrows:function(e){void 0===e&&(e="stories_feed_items");var t=(0,a.ge)(e),o=e+"_position";if(t){f[o]||(f[o]=0);var i=(0,a.geByClass1)("stories_feed_wrap").offsetWidth,r=t.scrollWidth-i,s=(0,a.geByClass1)("stories_feed_arrow_left",(0,a.domPN)(t)),n=(0,a.geByClass1)("stories_feed_arrow_right",(0,a.domPN)(t));0===f[o]?(0,a.addClass)(s,"disabled"):(0,a.removeClass)(s,"disabled"),f[o]===r||r<=0?(0,a.addClass)(n,"disabled"):(0,a.removeClass)(n,"disabled")}},showBlackList:function(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),(0,m.showBox)("al_stories.php",{act:"black_list"},{onDone:function(){window.cur.storiesBlackListScroll=new d.default("stories_black_list_result")},params:{onHide:function(){window.cur.storyLayer&&window.cur.storyLayer.playStory()}}})},blackListItemClick:function(e,t){(0,c.cancelEvent)(t);var o=(0,h.intval)((0,a.attr)(e,"data-id"));window.cur.storiesBlackListShown[o]?(delete window.cur.storiesBlackListShown[o],(0,a.removeClass)(e,"olist_item_wrap_on")):(window.cur.storiesBlackListShown[o]=1,(0,a.addClass)(e,"olist_item_wrap_on"))},saveBlackList:function(e){var t=Object.keys(window.cur.storiesBlackListShown);0!==t.length?window.ajax.post("al_stories.php",{act:"save_blacklist",hash:window.cur.storiesBlackList.hash,list:t.join(",")},{onDone:function(){g.updateFeedStories(),(0,p.curBox)().hide()},showProgress:function(){return(0,v.lockButton)(e)},hideProgress:function(){return(0,v.unlockButton)(e)}}):(0,p.curBox)().hide()},blacklistUpdateUsers:function(e){var t=e;if(e=(0,h.trim)(e).toLowerCase(),window.cur.storiesBlacklistLastQ!==e){window.cur.storiesBlacklistLastQ=e;var o=e?window.cur.storiesIndexer.search(e):window.cur.storiesBlackList.users,i=[];if(e)for(var r=0;r<e.length;r++)i.push(e.substr(r,1));var s=new RegExp(i.join(".*?"),"i"),n="";for(r=0;r<o.length;r++){var l=o[r],d=e?l.name.replace(s,(function(e){return"<em>"+e+"</em>"})):l.name;n+=window.cur.storiesBlackList.tpl.replace(/\{id\}/g,l.id).replace("{photo}",l.photo).replace("{name}",d).replace("{href}",l.href).replace("{class_name}",window.cur.storiesBlackListShown[l.id]?" olist_item_wrap_on":"")}n||(n='<div class="no_rows">'+(0,u.getLang)("global_search_not_found").replace("{search}",(0,h.clean)(t))+"</div>"),(0,a.val)((0,a.geByClass1)("olist","stories_black_list_result"),n)}},blackListInit:function(e){window.cur.storiesBlackListShown={},window.cur.storiesBlackList=e,(0,p.curBox)().setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),window.cur.storiesBlackListScroll&&window.cur.storiesBlackListScroll.destroy()}}).removeButtons(),window.cur.storiesBlackList.users.length?(window.cur.storiesBlacklistLastQ=!1,window.cur.storiesIndexer=new _.vkIndexer(window.cur.storiesBlackList.users,(function(e){return e.name}),(function(){g.blacklistUpdateUsers("")})),l.default.init("stories_blacklist"),l.default.focus("stories_blacklist"),(0,p.curBox)().addButton((0,u.getLang)("global_save"),this.saveBlackList).addButton((0,u.getLang)("global_cancel"),void 0,"no")):(0,p.curBox)().addButton((0,u.getLang)("global_close"))},preloadUrl:function(e){(0,s.loadMedia)(e).catch((function(e){(0,y.logError)(e)}))},groupStoriesBlockUpdate:function(){var e=g._getList("group_stories"),t=e&&e[0]&&e[0].items;if(t){for(var o=0,i=0;i<t.length;i++){t[i].unread&&o++}var r=(0,a.geByClass1)("stories_groups_block_stories_wrap"),s=(0,a.geByClass1)("stories_groups_block_stories_button",r);(0,a.toggleClass)(r,"has_unread",o>0),(0,a.toggleClass)(r,"has_stories",t.length>0),(0,a.toggleClass)(s,"has_stories",t.length>0);var n=(0,h.clone)(window.cur.storiesPreviews),l=n.splice(n.length-o,3);l.length<3&&(l=l.concat(n.slice(0,3-l.length))),l.reverse();var d="";for(i=l.length-1;i>=0;i--)d+=window.cur.storiesPreviewsRowHtml.replace("{url}",l[i]);(0,a.val)((0,a.geByClass1)("stories_groups_block_stories_rows",r),d)}},isLiveShown:function(e){return!!(window.cur.storyLayer&&window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.isActiveLive())&&window.cur.storyLayer.activeStory.story.videoRaw===e},activeLiveEnded:function(e){window.cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount:function(e){var t=e?(0,u.getLang)("stories_live_N_watching",e,!0):"";window.cur.storyLayer.activeStory.updateLiveViewersCount(t)},updatePagePhotosModule:function(){return new Promise((function(e,t){window.ajax.post("al_profile.php",{act:"get_page_photos_module"},{onDone:function(t){var o=window.Stories;(0,a.val)("page_photos_module",t),t||(0,a.hide)("profile_photos_module"),null==o||o.removeList("profile"),e()},onFail:function(){return t(),!0}})}))}}},452021:(e,t,o)=>{o.d(t,{STORY_HORIZONTAL_RATIO:()=>i,STORY_VERTICAL_RATIO:()=>r,STORY_MAX_WIDTH:()=>s,STORY_MAX_HEIGHT:()=>n});var i=.563,r=1.78,s=540,n=320},925977:(e,t,o)=>{o.d(t,{Story:()=>W});var i=o(570655),r=o(667294),s=o(973935),n=o(476978),a=o(895283),l=o(422098),d=o(230697),c=o(28462),_=o(998423),u=o(421296),h=o(776528),p=o(393263),m=o(569887),v=o(124956),y=o(414914),f=o(943457),g=o(45150),w=o(344624),S=o(705456),E=o(917685),b=o(442699),k=o(116886),C=o(791563),T=o(621260),L=o(719016),B=o(371372),M=o(432338),A=o(51229),P=o(469433),x=o(611386),I=o(997975),N=o(486353),D=o(774),O=o(240469),R=o(426967),F=o(558367),H=o(496495),W=function(){function e(e,t){var o=this;this.updateBottom=function(e){var t=(0,y.geByClass1)("stories_bottom_wrap",o.wrapEl);!o.isActive||e||!o.story||o.story.isGroupsMetaStory||o.story.isAppsMetaStory?(s.unmountComponentAtNode(t),(0,y.val)(t,"")):s.render(r.createElement(c.StoryBottom,{story:o,markAppNotificationsSeen:o.markAppNotificationsSeen}),t)},this.markAppNotificationsSeen=function(e){var t=o.getCurStoryData();if(t){var r=t.raw_id,s=void 0===r?"":r;if(e.appId&&e.appRef){var n=(0,i.__read)(s.split("_"),2),a=n[0],l=n[1];e.hasNewInteractions&&window.ajax.post("al_stories.php",{act:"mark_app_notifications_seen",owner_id:a,story_id:l,sticker_id:e.id,hash:e.hash},{onDone:function(){t.clickable_stickers&&t.clickable_stickers.stickers&&t.clickable_stickers.stickers.forEach((function(t){t.id===e.id&&t.type===v.StickerTypes.app&&(t.hasNewInteractions=!1)})),o.updateBottom();var i=document.querySelector("#feed_story_"+a+" .stories_feed_preview_app");i&&i.classList.contains("has_new")&&i.classList.remove("has_new")}}),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),o.pauseStory(),(0,P.showWiki)({w:"app"+e.appId,app_ref:e.appRef,app_hash:e.appHash}),o.layer.sendNavigationStatEvents("click_to_app",!0,{clickable_sticker:{id:e.id,type:"app"}})}}else(0,x.logError)(new Error("Fail: markAppNotificationsSeen"),{environment:"stories"})},this.toggleFeedbackTooltip=function(e){void 0===e&&(e=!o.isFeedbackTooltipShow),e?o.showFeedbackTooltip():o.hideFeedbackTooltip()},this.onFetchFeedbackData=function(e){var t,i,r;o.feedback=e;var s=null===(i=null==e?void 0:e.replies)||void 0===i?void 0:i.repliesTotalCountText,n=null===(r=null==e?void 0:e.viewers)||void 0===r?void 0:r.viewsTotalCountText,a=null==e?void 0:e.replies,l=null==a?void 0:a.listName,d=null==a?void 0:a.list;s&&o.setReplies(s),n&&o.setViews(n),a&&d&&(window.cur=(0,b.extend)(window.cur,((t={})["stories_list_"+l]=d,t)),a.list=d.length>v.INIT_MAX_FEEDBACK_STORIES_COUNT?d.slice(0,v.INIT_MAX_FEEDBACK_STORIES_COUNT):d,a.moreRepliesCount=d.length-a.list.length),o.updateBottom()},this.showMoreReplies=function(){var e,t=null===(e=o.feedback)||void 0===e?void 0:e.replies,i=null==t?void 0:t.listName,r=null==t?void 0:t.list;if(t&&r){var s=window.Stories._getList(i);t.list=s.slice(0,t.list.length+v.MAX_FEEDBACK_STORIES_SLICE_COUNT),t.moreRepliesCount=s.length-t.list.length,o.updateBottom()}},this.onFetchViewers=function(e){var t,i;(null===(i=null===(t=o.feedback)||void 0===t?void 0:t.viewers)||void 0===i?void 0:i.items)&&(o.feedback.viewers.items=o.feedback.viewers.items.concat(e.viewers),o.feedback.viewers.nextFrom=e.nextFrom,o.updateBottom())},this.onQuestionRemove=function(e){var t,i;(null===(i=null===(t=o.feedback)||void 0===t?void 0:t.questions)||void 0===i?void 0:i.items)&&(o.feedback.questions.items=o.feedback.questions.items.filter((function(t){return t.id!==e})),o.feedback.questions.items.length||delete o.feedback.questions,o.updateBottom())},this.onPrivacyHintHide=function(){var e,t;(null===(t=null===(e=o.feedback)||void 0===e?void 0:e.stats)||void 0===t?void 0:t.showPrivacyHint)&&(window.ajax.post("al_stories.php",{act:"hide_privacy_hint",privacy_hint_hash:o.feedback.stats.privacyHintHash}),o.feedback.stats.extendedStats?o.feedback.stats.showPrivacyHint=!1:delete o.feedback.stats,o.updateBottom())},this.onAddToNarrativeBtnClick=function(){var e=o.getCurStoryData();if(e){o.pauseStory(),o.isModalShown=!0;var t=o.getOwnerId(),i=o.buildStoryArchiveByActive();if(i){var r={ownerId:o.getOwnerId(),story:i,onClose:function(e){o.isModalShown=!1,o.updateBottom(),o.playStory(),e&&o.updateNarrativeBlockIfNeeded()},onSave:function(t){e.isPartOfNarrative=t},navScreen:O.NarrativeAnalyticNavScreen.storyViewer};(0,I.showNarrativeChooseBox)(r),(0,O.sendNarrativeAnalytic)(O.NarrativeAnalyticEventType.clickToAddToNarrative,{ownerId:t},O.NarrativeAnalyticNavScreen.storyViewer)}}},this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormActive=!1,this.isModalShown=!1,this.isFeedbackTooltipShow=!1,this.pressedStory=null,this.index=0,this._currentTimeLineAdditionalEl=null,this._currentTimeLineEl=null,this.preloadedStories={},this.layer=t.layer}return e.prototype.destroy=function(){this._destroyStory(),(0,E.removeEvent)((0,y.geByClass1)("stories_item_cont",this.contWrap)),(0,E.removeEvent)(this.shareButton),delete this.shareButton,(0,E.removeEvent)(this.followBtn),delete this.followBtn,(0,E.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);for(var e=(0,y.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)(0,E.removeEvent)(e[t]);(0,E.removeEvent)(this.viewsButton),(0,E.removeEvent)((0,y.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.descEl,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl;var o=!1;for(t=0;t<this.data.items.length;t++)if(this.data.items[t].unread){o=!0;break}var i=l.getPrevLayer();if(!o&&i&&i.activeStory&&!this.data.is_apps){var r=(0,y.domQuery)("#feed_story_"+this.layer.getBlockKey(this.data),i.activeStory.wrapEl)[0];(0,y.removeClass)(r,"story_feed_new_item"),(0,y.removeClass)(r,"story_feed_new_item_promo")}(0,p.clear)()},e.prototype._destroyTimeLine=function(){for(var e=(0,y.geByClass)("stories_time_line",this.timeLineEl),t=0;t<e.length;t++)(0,E.removeEvent)(e[t])},e.prototype.getOwnerId=function(){return this.data.author.id},e.prototype.getIndex=function(){return this.index},e.prototype.getRawId=function(){return this.story?this.story.getId():""},e.prototype.getTrackCode=function(){return!!this.story&&this.story.getTrackCode()},e.prototype.getReadHash=function(){return this.data.read_hash},e.prototype.getItems=function(){return this.data.items},e.prototype.getItemsLength=function(){return this.getItems().length},e.prototype.render=function(){var e=this;this.wrapEl=(0,y.ce)("div",{className:"stories_item"}),this.contWrap=(0,y.ce)("div",{className:"stories_item_cont_wrap"}),this.contStickers=(0,y.ce)("div",{className:"stories_item_cont_sticker"}),this.storiesHeader=(0,y.ce)("div",{className:"stories_header"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);var t=(0,y.ce)("div",{className:"stories_item_cont"});return(0,E.addEvent)(t,"mousedown",(function(t){e._onMouseDownHandle(t.target)})),(0,E.addEvent)(t,"mouseup",(function(t){e._onMouseUpHandle(t.target)})),this.contWrap.appendChild(t),this.contWrap.appendChild(this.storiesHeader),this.storiesHeader.appendChild(this._renderAuthor()),this.storySendFormOverlay=(0,y.ce)("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild((0,y.ce)("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),window.cur.noStoriesBack||(this.backButton=(0,y.ce)("div",{className:"stories_item_back"}),t.appendChild(this.backButton)),this.inlineLoader=t.appendChild((0,y.ce)("div",{className:"stories_inline_loader",innerHTML:(0,A.getProgressHtml)()})),this.contWrap.appendChild((0,y.ce)("div",{className:"stories_play_button video_thumb_play",onclick:function(){e.story&&e.story.play()}})),this.isActiveLive()?(0,y.addClass)(this.wrapEl,"live"):this._initTimeLine(),(0,y.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl},e.prototype._canForceDeleteStories=function(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted},e.prototype._initTimeLine=function(){this.timeLineEl&&(this._destroyTimeLine(),(0,y.re)(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())},e.prototype._isActionsShown=function(){var e=(0,y.domClosest)("_ui_menu_wrap",this.wrapEl);return(0,y.hasClass)(e,"shown")},e.prototype._renderPreview=function(){return(0,y.se)('<div class="stories_preview"></div>')},e.prototype._renderMessage=function(e){return(0,y.se)('<div class="stories_message">\n  <div class="stories_message_text">'+e+"</div>\n</div>")},e.prototype.showMessage=function(e){var t=this;(0,y.re)((0,y.geByClass1)("stories_message",this.contWrap));var o=this._renderMessage(e);return this.contWrap.appendChild(o),clearTimeout(this.showMessageTimer),new Promise((function(e){t.showMessageTimer=setTimeout((function(){t.contWrap.removeChild(o),e()}),3e3)}))},e.prototype._setPreview=function(e,t){var o=this,i=this.index,r=this.data.items[i].preview_url;r!==this.curPreviewUrl&&r&&(e=e||(0,y.geByClass1)("stories_preview",this.contWrap),(0,n.loadMedia)(r).then((function(s){i===o.index&&r!==o.curPreviewUrl&&(o.curPreviewUrl=r,(0,y.setStyle)(e,"backgroundImage","url("+s+")")),(0,y.setStyle)(e,"opacity",1),t&&setTimeout(t,0)})).catch((function(e){(0,x.logError)(e)})))},e.prototype._renderAuthor=function(){var e,t,o=this,i=this.data.author,r=i.href,s=i.name,n=i.verify,a=this.getCurStoryData(),l=this.getCurrentNarrative(),d="_self";(this.layer.list.includes("place")&&(d="_blank"),t=this.data.is_narrative?null==l?void 0:l.coverUrl:this.data.author.photo,this.data.is_groups)?e='\n      <div class="stories_author_cont stories_author_cont_group">\n        <a href="/groups" target="_blank" class="StoryInfo__title StoryInfo__title--group"><span>'+(0,k.getLang)("stories_groups_feed_block")+'</span></a>\n        <div class="StoryInfo__subtitle"></div>\n      </div>':e='\n      <div class="stories_author_cont">\n        '+('<a href="'+r+'" target="'+d+'" class="stories_author_photo_wrap"><img src="'+t+'" class="stories_author_photo" /></a>')+'\n        <div class="StoryInfo">\n          <div class="StoryInfo__top">\n            '+(l&&a?'<div class="StoryInfo__title"><span>'+l.title+"</span></div>":'<a class="StoryInfo__title StoryInfo__title--author" href="'+r+'" target="'+d+'">'+s+(n||"")+"</a>")+'\n          </div>\n          <div class="StoryInfo__subtitle">'+this.getHeaderBottomHtml()+"</div>\n        </div>\n      </div>";var c=(0,y.se)('\n      <div class="stories_author">\n        <div class="stories_author_cont_wrap">\n          <div class="stories_author_inner">'+e+'</div>\n          <div class="stories_author_buttons"></div>\n         </div>\n      </div>\n    ');return(0,E.addEvent)(c,"click",(function(e){(0,y.domClosestByTag)("a",e.target)&&o.layer.sendNavigationStatEvents("go_to_author")})),this.descEl=(0,y.geByClass1)("StoryInfo__subtitle",c),this.authorButtons=(0,y.geByClass1)("stories_author_buttons",c),c},e.prototype.showFeatureTooltipIfNeed=function(e){var t=this;window.cur.showStoriesFeatureTooltip&&!window.cur.storiesFeatureTooltip&&e&&(window.cur.storiesFeatureTooltipTimeoutId=setTimeout((function(){var o=(0,y.se)('\n        <div>\n          <div class="stories_feature_tt_close" onclick="window.cur.storiesFeatureTooltip.hide(); cancelEvent(event);"></div>\n          <div>'+(0,k.getLang)("stories_feature_narrative_users")+"</div>\n        </div>\n     ");(0,E.addEvent)(o,"click",(function(){window.cur.storiesFeatureTooltip.hide()})),window.cur.storiesFeatureTooltip=new g.default(e,{appendToParent:!0,autoShow:!1,forceSide:"top",cls:"eltt_fancy stories_feature_tt",offset:[1,-3],content:o,align:"right",onHide:t._closeFeatureTooltip.bind(t)}),t.pauseStory(),window.cur.storiesFeatureTooltip.show(),clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)}),2e3),window.cur.destroy&&window.cur.destroy.push((function(){return clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)})))},e.prototype.getHeaderBottomHtml=function(){var e=this.data.author.href,t=this.getCurStoryData(),o=this.getCurrentNarrative(),i="",r="_self";this.layer.list.includes("place")&&(r="_blank");var s="";if(t){if(i=t.date,t.maskOwnerDomain){var n=t.maskOwnerDomain,a="<a href='/"+n+"' target='"+r+'\' class="StoryInfo__maskLink">@'+n+"</a>";s='<span class="StoryInfo__maskInfo">'+(0,k.langSex)(t.maskOwnerSex,(0,k.getLang)("stories_mask_from","raw")).replace("{domain}",a)+"</span><span class='dvd'></span>"}t.isPromo?i=t.promoCaption:o?(i="<span class='dvd'></span><span>"+i+"</span>",i=s+"<a href='"+e+"' target='"+r+"' class='StoryInfo__narrativeOwnerName'>"+o.ownerName+"</a>"+i):t.isAds?i=(0,k.getLang)("stories_is_ad"):s&&(i=s+"<span>"+i+"</span>")}return i},e.prototype._closeFeatureTooltip=function(e){void 0===e&&(e=!0),window.cur.storiesFeatureTooltip&&(window.cur.showStoriesFeatureTooltip=!1,window.cur.storiesFeatureTooltip.destroy(),window.cur.storiesFeatureTooltip=null,e&&this.playStory(),window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:window.cur.storiesFeatureTooltipKey,hash:window.cur.storiesFeatureTooltipHash},{onDone:function(){}}))},e.prototype._renderFollowButton=function(){var e=this,t=(0,R.getIcon24UserAddOutline)();return this.followBtn=(0,y.ce)("div",{className:"StoryButton StoryButton--follow"}),this.followBtn.innerHTML=t.icon,(0,E.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),(0,E.addEvent)(this.followBtn,"mouseover",(function(){var t=e.data.author.can_follow?(0,k.getLang)("stories_follow"):(0,k.getLang)("stories_unfollow");(0,L.showTooltip)(e.followBtn,{black:1,center:1,shift:[0,13,13],text:t,appendEl:e.contWrap})})),this.followBtn},e.prototype._renderTimeLine=function(){var e=this;this.timeLineEl=(0,y.ce)("div",{className:"stories_time_line"+(this.data.items.length>50?" stories_time_line_many_items":"")});var t=this.data.author.id;return this.data.items.map((function(o,i){var r=(0,y.ce)("div",{className:"stories_time_line_item"});(0,E.addEvent)(r,"click",(function(){e.layer.sendNavigationStatEvents("go_to_story_click"),e.changeStory(i)}));var s=(0,y.ce)("div",{className:"stories_time_line_item_cont"});s.appendChild((0,y.ce)("div",{className:"stories_time_line_item_cont_active"})),r.appendChild(s),o.isOneTime&&window.vk.id!==t&&(r.appendChild((0,y.ce)("div",{className:"stories_time_line_item_wick"})),(0,y.addClass)(r,"stories_time_line_item_is_one_time")),e.timeLineEl.appendChild(r)})),this.timeLineEl},e.prototype.isPaused=function(){return!this.story||this.story.isPaused()},e.prototype.isLoaded=function(){return!this.story||this.story.isLoaded()},e.prototype._onMouseDownHandle=function(e){this.pressedStory=e,this.isActive&&(this.isLocked()||((0,y.hasClass)(e,"stories_item_cont")||(0,y.hasClass)(e,"stories_item_back")||(0,y.hasClass)(e,"StoryStickers__disableArea")||(0,y.hasClass)(e,"StorySticker"))&&!this.downTs&&(this.downTs=(0,b.vkNow)(),this.longTapTimer=setTimeout(this.longTapHandle.bind(this),v.LONG_PRESS_DELAY_MS)))},e.prototype._onMouseUpHandle=function(e,t){var o,r;void 0===t&&(t=function(){}),clearTimeout(this.longTapTimer);var s=this.downTs;if(delete this.downTs,e===this.pressedStory){this.pressedStory=null;var n=(0,b.vkNow)()-s>=v.LONG_PRESS_DELAY_MS,a=n||this.isSendFormActive||(0,y.hasClass)(this.wrapEl,"autoplay_failed");if(this.isActive&&((0,y.hasClass)(e,"stories_item_back")||(0,y.hasClass)(e,"StoryStickers__disableArea--left"))&&!a&&!this.isTooltipOpened())return this.prevStory();if(n||!(0,y.hasClass)(e,"StorySticker")){if((0,y.hasClass)(e,"stories_item_cont")||(0,y.hasClass)(e,"stories_item_back")||(0,y.hasClass)(e,"StoryStickers__disableArea")||(0,y.hasClass)(e,"StorySticker"))if(this.isFeedbackTooltipShow)this.hideFeedbackTooltip();else if((0,y.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this.hideTooltip();else{if(!this.isActive){if(this.id>=this.layer.activeStory.id){var l=[];try{for(var d=(0,i.__values)(this.layer.activeStory.data.items),c=d.next();!c.done;c=d.next()){var _=c.value;l.push(_.raw_id),_.unread=!1}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=d.return)&&r.call(d)}finally{if(o)throw o.error}}this.layer.markStoriesSkipped(l)}var u=this.layer.storiesBlocks;return u.indexOf(this.layer.getBlockKey(this.data))>u.indexOf(this.layer.blockKey)?this.layer.sendNavigationStatEvents("go_to_next_author"):this.layer.sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}a?this.isPaused()&&this.playStory(!1,!!s):this._onPlayEnd()}}else t()}},e.prototype._markSeenIfNeeded=function(){this.isActiveStoryOneTime()&&this._markSeenCurrentStory()},e.prototype._markSeenCurrentStory=function(){this.opts.onSeen(this.layer.activeStory)},e.prototype.longTapHandle=function(){this.isActiveStoryOneTime()||(this.story&&this.story.pause(),(0,y.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer.sendNavigationStatEvents("pause_long_tap"))},e.prototype.isLocked=function(){return!!(this.getSendText()||!this.isActive||this.isSendFormActive||this.isModalShown||this.isFeedbackTooltipShow||document.hidden||this._isActionsShown()||(0,y.isVisible)(this.inlineLoader)||(0,y.hasClass)(this.wrapEl,"hiding_reply")||(0,T.curBox)()||this.story&&this.story.isPausedByMetaScroll)},e.prototype.isSpaceLongTabAvailable=function(){return!(this.story&&this.story.isPausedByMetaScroll)},e.prototype.isGroupedStory=function(){return this.data.is_groups},e.prototype.autoResumeStory=function(e){void 0===e&&(e=!1),this.audioPlaying||this.isTooltipOpened()||this.playStory(!1,e)},e.prototype.playStory=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLocked()||((0,y.removeClass)(this.wrapEl,"paused"),this.story&&!e||this._initStory(),this.story&&this.story.play(),t&&this.layer.sendNavigationStatEvents("resume_release"),delete this.downTs)},e.prototype.pauseStory=function(e){this.story&&(this.isPaused()||(e&&(0,y.addClass)(this.wrapEl,"paused"),this.story.pause()))},e.prototype.changeStory=function(e){this.index===e||this.isSendFormActive||(this._destroyStory(),this.index=e,this.hideTooltip(),this._setPreview(),this.playStory())},e.prototype.getWrap=function(){return this.wrapEl},e.prototype.stop=function(){this._destroyFeedBackTT(),this.isActive=!1,this._destroyStory(),this._stopLoader(),(0,y.val)((0,y.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),(0,y.removeClass)(this.wrapEl,"autoplay_failed")},e.prototype.getCurStoryData=function(){var e=this.data.items[this.index];return e||(0,x.logError)(new Error("getCurStoryData: data is undefined"),{environment:"stories"}),e},e.prototype.getCurrentNarrative=function(){return this.data.narrative},e.prototype.isActiveLive=function(){var e;return"live"===(null===(e=this.getCurStoryData())||void 0===e?void 0:e.type)},e.prototype.isLiveEnded=function(){return!!this.story&&(this.isActiveLive()&&this.story.liveEnded)},e.prototype._initStory=function(){var e=this.getCurStoryData(),t=this.getCurrentNarrative();if(e){var o=e.type,i=e.noSound;this.story&&this._destroyStory(),(0,m.onPlayerChange)(this),Object.assign(e,{authorId:this.getOwnerId()});var n={onLoadingStart:this._onLoadingStart.bind(this),onLoadingEnd:this._onLoadingEnd.bind(this),onPlay:this._onPlay.bind(this),onPause:this._onPause.bind(this),onError:this._showError.bind(this),onLongLoading:this._showLoader.bind(this),onAutoPlayFail:this._onAutoPlayFail.bind(this)};if("live"===o?this.story=new _.default(e,n,this.wrapEl):("video"===o?(this.story=new u.default(e,n,t),i&&this.opts.restoreAudioPlay(),(0,y.addClass)(this.wrapEl,"video")):(this.story=new h.default(e,n,t),this.opts.restoreAudioPlay(),(0,y.removeClass)(this.wrapEl,"video")),e.is_groups_meta_story||e.is_apps_meta_story||(0,y.val)(this.descEl,this.getHeaderBottomHtml()),this.fillTimeLine()),"live"===o||"video"===o)a.getVolume()>0&&this.opts.onVideoPlay();this.opts.onStartStory(),(0,y.toggleClass)(this.wrapEl,"stories_can_comment",e.can_comment),this.story.isGroupsMetaStory=e.is_groups_meta_story,this.story.isAppsMetaStory=e.is_apps_meta_story,!this.data.author.can_follow||this.data.is_promo||this.isActiveLive()||this.authorButtons.appendChild(this._renderFollowButton()),this._destroyFeedBackTT(),this.story.isGroupsMetaStory||this.story.isAppsMetaStory||(this.updateBottom(),this.contWrap.appendChild(this.story.render())),e.clickable_stickers&&(this.stickerLayers=s.render(r.createElement(d.StoryStickers,{story:this.story,storyData:e,author:this.data.author,showMessage:this.showMessage.bind(this),playStory:this.playStory.bind(this),pauseStory:this.pauseStory.bind(this),hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer.sendNavigationStatEvents.bind(this.layer),markAppNotificationsSeen:this.markAppNotificationsSeen,list:this.layer.list,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)),this.story.isGroupsMetaStory&&((0,y.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),(0,y.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_groups"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild((0,y.ce)("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:(0,k.getLang)("stories_groups_grid_title")})),(0,y.re)((0,y.geByClass1)("stories_photo",this.contWrap)),(0,y.re)((0,y.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderGroupsMetaStory())),this.data.is_apps&&(this.story.isAppsMetaStory?((0,y.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),(0,y.addClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps"),this.contWrap.appendChild(this.story.render()),this.authorButtons.appendChild((0,y.ce)("div",{className:"stories_groups_settings_text stories_groups_settings_text_hide",innerHTML:(0,k.getLang)("stories_groups_grid_title")})),(0,y.setStyle)((0,y.geByClass1)("stories_preview",this.contWrap),{backgroundImage:""}),(0,y.re)((0,y.geByClass1)("stories_photo",this.contWrap)),(0,y.re)((0,y.geByClass1)("stories_video",this.contWrap)),this.contWrap.appendChild(this.story.renderAppsMetaStory())):((0,y.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),(0,y.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story_apps")))}else(0,x.logError)(new Error("Fail: _initStory"),{environment:"stories"})},e.prototype.hasSticker=function(e){var t=this.getCurStoryData();if(!t||!t.clickable_stickers)return!1;var o=t.clickable_stickers.stickers;return!!Array.isArray(o)&&o.some((function(t){return t.type===e}))},e.prototype.getSticker=function(e){var t=this.getCurStoryData();if(t&&t.clickable_stickers){var o=t.clickable_stickers.stickers;if(Array.isArray(o))return o.find((function(t){return t.type===e}))}},e.prototype.isTooltipOpened=function(){return this.stickerLayers&&this.stickerLayers.isShownTooltip()},e.prototype.hideTooltip=function(e){void 0===e&&(e=!1),this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),e||this.playStory())},e.prototype.getReplies=function(){return this.story&&this.story.getReplies()},e.prototype.getViews=function(){return this.story&&this.story.getViews()},e.prototype.setReplies=function(e){return this.story&&this.story.setReplies(e)},e.prototype.setViews=function(e){return this.story&&this.story.setViews(e)},e.prototype.indexToUnread=function(e){void 0===e&&(e=!1);var t=this.data.items,o=0;for(var i in t)if(t[i].unread&&!this.layer._hasContext("all")){o=Number(i);break}if(e)return o;this.index=o,this._setPreview()},e.prototype.indexToStoryById=function(e){var t=this.data.items,o=-1;for(var i in t)if(t[i].raw_id===e){o=Number(i);break}this.layer._hasContext("all")&&(o=0),o>-1?(this.index=o,this._setPreview()):this.indexToUnread()},e.prototype.fillTimeLine=function(){var e=this.timeLineEl;if(e)for(var t=0;t<e.children.length;t++){var o=(0,y.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this._currentTimeLineEl=o,this._currentTimeLineAdditionalEl=(0,y.geByClass1)("stories_time_line_item_wick",e.children[t]));var i=t<this.index?100:0;(0,y.setStyle)(o,"transform","translateX("+i+"%)")}},e.prototype._destroyStory=function(){if(this.story){this.updateBottom(!0),window.tooltips&&window.tooltips.hideAll(),this.hideTooltip(),this._resetErrors(),this._destroyFeedBackTT(),this._closeFeatureTooltip(!1),this.story.pause(),(0,y.removeClass)(this.contWrap,"stories_item_cont_wrap_meta_story"),(0,y.re)((0,y.geByClass1)("MetaStory",this.contWrap)),(0,y.removeClass)("stories_item_cont_wrap_meta_story_groups",this.contWrap);var e=this.getCurStoryData();e&&e.clickable_stickers&&(s.unmountComponentAtNode(this.contStickers),delete this.stickerLayers),cancelAnimationFrame(this.timeLineAnim);try{this.contWrap.removeChild(this.story.getContainer()),this.story.destroy()}catch(e){(0,x.logError)(e)}this._replyHideEnd(),(0,E.removeEvent)(this.followBtn),(0,y.val)(this.authorButtons,""),(0,E.removeEvent)(this.answersEl),this.hideInlineLoader(),delete this.story}},e.prototype._timeLineUpdate=function(){var e=this.story;if(e&&!e.isPaused()&&!this.isActiveLive()){var t=this.getStoryProgressPercent(),o=t/100;if((0,y.setStyle)(this._currentTimeLineEl,"transform","translateX("+t+"%) translateZ(0)"),this._currentTimeLineAdditionalEl&&this._currentTimeLineEl){var i=this._currentTimeLineEl.clientWidth*o;(0,y.setStyle)(this._currentTimeLineAdditionalEl,"transform","translateX("+i+"px) translateZ(0)")}t<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}},e.prototype.getStoryProgressPercent=function(){if(!this.story)return 0;var e=this.story.getCurrentTime(),t=this.story.getDuration();return Math.max(0,Math.min(100,e/t*100))},e.prototype._onLoadingStart=function(){this._loadingStartTime=+new Date},e.prototype._onLoadingEnd=function(){this._loadingStartTime&&(this.loadingTime=+Date.now()-this._loadingStartTime,this.layer.sendViewerStartTime(this.getRawId(),this.loadingTime),this._loadingStartTime=0)},e.prototype._onPlay=function(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),(0,y.removeClass)(this.wrapEl,"animate_story"),(0,y.removeClass)(this.wrapEl,"autoplay_failed"),this.data.is_groups||this.isAppsMetaStoryActive()||(this.data.items[this.getIndex()].unread=!1),this._updateFeedStoryPreview(),(0,m.onPlayerChange)(this)},e.prototype._onPause=function(){cancelAnimationFrame(this.timeLineAnim),(0,m.onPlayerChange)(this)},e.prototype._onPlayEnd=function(e){void 0===e&&(e=!1),this._markSeenIfNeeded(),this.nextStory(e)},e.prototype.nextStory=function(e){if(void 0===e&&(e=!1),!this.isLocked()){var t=this.data.items;e||this.layer.sendNavigationStatEvents("go_to_next_story_tap");var o=this.index+1;o<t.length?(e&&this.layer.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(o)):(this.opts.onStoriesEnd(e),this._destroyStory())}},e.prototype.prevStory=function(){if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),!this.isLocked()){this.layer.sendNavigationStatEvents("go_to_previous_story");var e=this.index-1;e>=0?this.changeStory(e):(this.opts.playPrevOwner(),this._destroyStory())}},e.prototype.getOffsetLeft=function(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2},e.prototype.getWidth=function(){return this.wrapEl.offsetWidth},e.prototype.removeStoryBox=function(){var e=this,t=this.getCurStoryData();if(t){var o=t.isPartOfNarrative?(0,k.getLang)("stories_remove_from_narrative_warning"):(0,k.getLang)("stories_remove_warning");this.pauseStory(),(0,C.showFastBox)({title:(0,k.getLang)("global_warning")},o,(0,k.getLang)("stories_remove_confirm"),this.removeStory.bind(this),(0,k.getLang)("global_cancel"),(function(){e.playStory()}))}else(0,x.logError)(new Error("Fail: removeStoryBox"),{environment:"stories"})},e.prototype.removeStoryFromNarrative=function(){var e=this,t=this.getCurStoryData();if(t){var o=(0,k.getLang)("stories_remove_only_from_narrative_warning");this.pauseStory();(0,C.showFastBox)({title:(0,k.getLang)("global_warning"),onHide:function(){e.playStory()}},o,(0,k.getLang)("stories_remove_confirm"),(function(o){var i=e.getCurrentNarrative();if(i){var r=e.getIndex();i.stories=i.stories.filter((function(e){return e.rawId!==t.raw_id})),(0,S.lockButton)(o),e.editNarrativeRequest(i).then((function(){var t=(0,T.curBox)();t&&t.hide(),i.storiesCount=i.stories.length,e._popStoryAndClearList(r),e.updateNarrativeBlockIfNeeded(),e.layer.sendNavigationStatEvents("delete_from_narrative")})).catch((function(){var e=(0,T.curBox)();e&&e.hide(),(0,x.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"})}))}}),(0,k.getLang)("global_cancel"))}else(0,x.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"})},e.prototype.removeStory=function(e){var t=this;this.pauseStory();var o=this.getIndex(),i={act:"remove_story",story_raw:this.getRawId(),hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash};(0,M.isClaimContent)()&&(i.claim=window.nav.objLoc.claim),window.ajax.post("al_stories.php",i,{onDone:function(){t.layer.sendNavigationStatEvents("delete"),(0,T.curBox)().hide(),t._popStoryAndClearList(o),1!==t.layer.storiesList.length||t.layer.storiesList[0]||t.opts.removeList(),t.updateNarrativeBlockIfNeeded()},showProgress:function(){return(0,S.lockButton)(e)},hideProgress:function(){return(0,S.unlockButton)(e)}})},e.prototype.removeNarrativeBox=function(){var e=this;this.pauseStory(),(0,C.showFastBox)({title:(0,k.getLang)("global_warning"),onHide:function(){e.playStory()}},(0,k.getLang)("stories_narrative_remove_warning"),(0,k.getLang)("stories_remove_confirm"),this.removeNarrative.bind(this),(0,k.getLang)("global_cancel"))},e.prototype.removeNarrative=function(e){var t=this;this.pauseStory();var o=this.getCurrentNarrative();if(o){var i=o.ownerId,r=o.id;window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:i+"_"+r,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:function(){(0,T.curBox)().hide(),t._popCoverAndCleanNarrativeList(),t.updateNarrativeBlockIfNeeded()},showProgress:function(){return(0,S.lockButton)(e)},hideProgress:function(){return(0,S.unlockButton)(e)}})}else(0,x.logError)(new Error("Fail: removeNarrative"),{environment:"stories"})},e.prototype._popCoverAndCleanNarrativeList=function(){this.opts.removeList(),this._remove(!1,function(){var e,t;null===(t=null===(e=window.cur.storyLayer)||void 0===e?void 0:e.activeStory)||void 0===t||t._popStoryAndClearList(window.cur.storyLayer.activeStory.getIndex())}.bind(this))},e.prototype.sendNarrativeBookmarkButtonDidPress=function(){var e=this,t=this.getCurrentNarrative();t?window.ajax.post("al_bookmarks.php",{act:"bookmark",owner_id:t.ownerId,object_id:t.id,type:"narrative",state:t.isBookmarked?1:0,hash:t.bookmarkHash,ref:window.cur.module},{onDone:function(o){(0,T.showDoneBox)(o||(0,k.getLang)("stories_narrative_bookmark_deleted"),{className:"stories_done_msg"}),t.isBookmarked||(0,O.sendNarrativeAnalytic)(O.NarrativeAnalyticEventType.addToBookmarks,t,O.NarrativeAnalyticNavScreen.storyViewer),t.isBookmarked=!t.isBookmarked,e.updateBottom()}}):(0,x.logError)(new Error("Fail: sendNarrativeBookmarkButtonDidPress"),{environment:"stories"})},e.prototype.sendNarrativeEditButtonDidPress=function(){var e=this.getCurrentNarrative();e?((0,O.sendNarrativeAnalytic)(O.NarrativeAnalyticEventType.clickToEditNarrative,e,O.NarrativeAnalyticNavScreen.storyViewer),this.getOwnerId()>0?this.editCurrentNarrative():window.nav.go(this.data.author.href+"?act=narrative_edit&nid="+e.id)):(0,x.logError)(new Error("Fail: sendNarrativeEditButtonDidPress"),{environment:"stories"})},e.prototype.editNarrativeRequest=function(e){var t,o,r=e.id,s=e.ownerId,n=e.editHash,a=e.title,l=e.stories,d=e.coverStoryRawId;return d&&(t=(0,i.__read)(null==d?void 0:d.split("_"),2),o=t[1]),new Promise((function(e,t){window.ajax.post("al_stories.php",{act:"edit_narrative",owner_id:s,title:a,cover_story_id:o,hash:n,story_ids:(0,D.prepareStoriesForPublishing)(l),narrative_id:r},{onDone:function(){e()},onFail:function(e){return(0,T.showDoneBox)(e||(0,k.getLang)("global_error")),t(),!0}})}))},e.prototype._popStoryAndClearList=function(e){this._removeStoryFromMemoryByIndex(e),0===this.data.items.length&&l.onReplyDeleted(this.getOwnerId())},e.prototype._removeStoryFromMemoryByIndex=function(e,t){void 0===t&&(t=!1),this.data.items.splice(e,1);var o=this.data.items.length;o?(this._initTimeLine(),o>e?this.isActive&&this.playStory(!0):this.isActive&&this.nextStory()):this._remove(t)},e.prototype._remove=function(e,t){this.opts.onStoryRemoved(e,t)},e.prototype.shareBox=function(){var e=this;if(this.story)if(this.getCurStoryData()){var t,o=this.getCurrentNarrative();t=o?"narrative"+o.rawId:"story"+this.story.getId(),this.pauseStory(),(0,C.showBox)("like.php",{act:"publish_box",object:t,from:"wkview"},{onDone:function(){e.autoResumeStory()},params:{onHide:function(){e.autoResumeStory()}}})}else(0,x.logError)(new Error("Fail: shareBox"),{environment:"stories"})},e.prototype.toggleLikeStory=function(){var e=this;if(this.story){var t=this.story.data,o=t.isLiked,i=t.likeHash,r=this.getRawId(),s={act:o?"delete_like":"like",hash:i,story_raw_id:r};t.isLiked=!o,this.updateBottom(),window.ajax.post("al_stories.php",s,{onDone:function(){e.layer.sendNavigationStatEvents(o?"click_to_unlike":"click_to_like")},onFail:function(){return t.isLiked=o,e.updateBottom(),!0}})}},e.prototype.onAnswerSend=function(e,t,o,i){var r=this;void 0===t&&(t=[]),void 0===o&&(o={}),void 0===i&&(i={});var s=this.getSendText();if((s||t.length)&&this.story)if(this.isActiveLive())this.story.sendMessage(s,e);else{var n=this.getCurrentNarrative();n?t.push(["narrative",n.ownerId+"_"+n.id]):t.push(["story",this.story.getId()]),window.ajax.post("al_im.php",Object.assign({act:"a_send",msg:s,hash:this.data.send_hash,media:(0,B.convertAttachesToPhpMedia)(t),entrypoint:"stories_comment",to:this.getOwnerId()},o),{onDone:function(){r.onAnswerSent(e,o,i)},onFail:function(e){return r.showMessage(e).catch((function(e){(0,x.logError)(e)})),!0},showProgress:function(){(0,y.val)(r.sendFormButton,r._getLoaderHtml()),(0,y.addClass)(r.sendFormButton,"sending")},hideProgress:function(){(0,y.val)(r.sendFormButton,""),(0,y.removeClass)(r.sendFormButton,"sending")}})}},e.prototype.onAnswerSent=function(e,t,o){var i=this;if(void 0===e&&(e=function(){}),void 0===t&&(t={}),void 0===o&&(o={}),!this.isActiveLive()){this.showMessage((0,k.getLang)("stories_answer_sent")).then((function(){i.playStory()})).catch((function(e){(0,x.logError)(e)}));var r=t.sticker_referrer||"",s={},n="";"story_keyboard"===r?n="sticker_keyboard_send":r.startsWith("story_suggestion_")?n="sticker_suggestion_send":"story_reaction"===r?(n="sticker_reaction_send",s.reaction_name=o.reactionName):n="comment_send",this.layer.sendNavigationStatEvents(n,!0,s)}(0,y.val)((0,y.geByClass1)("stories_send_form_text",this.wrapEl),""),(0,w.cancelStackPop)(),this.pauseStory(),e&&e()},e.prototype.onSendFormFocus=function(){var e=this;this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this.hideTooltip(!0),this.hideFeedbackTooltip(),(0,w.cancelStackPush)("stories_form_focus",(function(){f.Emoji.shown||(e._resetFendForm(),e._blurSendForm())}))},e.prototype._toggleSendFormOverlay=function(e){void 0===e&&(e=!1),(0,y.toggleClass)(this.storySendFormOverlay,"stories_bottom_overlay_available",this.isSendFormActive=e)},e.prototype._blurSendForm=function(){var e=(0,y.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()},e.prototype.getSendText=function(){var e=f.Emoji.editableVal((0,y.geByClass1)("stories_send_form_text",this.wrapEl));return(0,b.trim)(e)},e.prototype.onSendFormBlur=function(){var e=this.getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this._resetFendForm()},e.prototype._unlockSendForm=function(){this.isSendFormActive&&(this.isSendFormActive=!1)},e.prototype._resetFendForm=function(){(0,y.val)((0,y.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),this.playStory()},e.prototype._getLoaderHtml=function(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'},e.prototype.preloadNextStory=function(e){if(void 0===e&&(e=this.index+1),!this.preloadedStories[e]){var t=this.data.items[e];if(t){this.preloadedStories[e]=!0;var o="video"===t.type?t.video_url:t.photo_url;o&&("video"===t.type?(0,n.default)(o).catch((function(e){return(0,x.logError)(e)})):(0,n.loadMedia)(o).catch((function(e){return(0,x.logError)(e)})))}}},e.prototype.addToBlacklist=function(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),(0,C.showFastBox)({title:(0,k.getLang)("stories_add_blacklist_title"),onHide:function(){window.cur.storyLayer&&window.cur.storyLayer.playStory()}},this.getOwnerId()<0?(0,k.getLang)("stories_add_blacklist_message_group"):(0,k.getLang)("stories_add_blacklist_message"),(0,k.getLang)("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),(0,k.getLang)("global_cancel"))},e.prototype._doAddToBlacklist=function(e){var t=this;window.ajax.post("al_stories.php",{act:"blacklist_add",owner_id:this.getOwnerId(),hash:this.data.blacklist_hash,source_story:this.getRawId(),track_code:this.getTrackCode()},{onDone:function(){t.data.can_blacklist=!1,t.layer.sendNavigationStatEvents("hide_from_stories"),(0,T.curBox)().hide(),t.opts.removeList(),t._remove()},showProgress:function(){return(0,S.lockButton)(e)},hideProgress:function(){return(0,S.unlockButton)(e)}})},e.prototype.markNotInterested=function(){var e=this,t=this.getCurStoryData();if(t)if(t.isAds&&(0,N.partConfigEnabled)("ads_new_reports_web_histories")){var o="",i=t.track_code,r=(0,C.showBox)("reports.php",{act:"hide_ad_box",track_code:i,type:"story"},{onDone:function(){var e=(0,y.geByClass)("radiobtn","ad_hide");window.radioBtns.ad_hide={val:0,els:e};var t=(0,y.ge)("ad_csrf");o=t?t.value:o},params:{onClean:function(){delete window.radioBtns.ad_hide,e.playStory()}},stat:["reports.css"]});r.removeButtons(),r.addButton((0,k.getLang)("box_send"),(function(s){(0,S.lockButton)(s),window.ajax.post("reports.php",{act:"hide_ad",track_code:i,reason_id:window.radioBtns.ad_hide.val,hash:o},{onDone:function(){(0,S.unlockButton)(s),r.hide(),e._markNotInterested(t.track_code,t.canMarkNotInterestedHash)}})})),r.addButton((0,k.getLang)("global_cancel"),!1,"no")}else this._markNotInterested(t.track_code,t.canMarkNotInterestedHash);else(0,x.logError)(new Error("Fail: markNotInterested"),{environment:"stories"})},e.prototype._markNotInterested=function(e,t){var o=this;this.showMessage((0,k.getLang)("stories_thanks_feedback")).catch((function(e){(0,x.logError)(e)})),window.ajax.post("al_stories.php",{act:"mark_not_interested",story_raw_id:this.getRawId(),track_code:e,hash:t},{onDone:function(){o.layer.sendNavigationStatEvents("mark_not_interested")}})},e.prototype._resetErrors=function(){var e=(0,y.geByClass1)("stories_error_wrap",this.contWrap);e&&((0,E.removeEvent)((0,y.geByClass1)("stories_error_button",e)),(0,y.re)(e)),(0,y.removeClass)(this.wrapEl,"failed"),(0,y.removeClass)(this.wrapEl,"fatal_error")},e.prototype._showError=function(e){var t=this;if(this.contWrap){var o,i,r=e;switch(e){case"load":o=(0,k.getLang)("stories_error_cant_load"),i=(0,y.ce)("div",{className:"stories_error_button",innerHTML:(0,k.getLang)("stories_try_again")}),(0,E.addEvent)(i,"click",(function(){t._destroyStory(),t.playStory()}));break;case"expired":o=(0,k.getLang)("stories_error_expired");break;case"deleted":o=(0,k.getLang)("stories_error_deleted");break;case"private":o=(0,k.getLang)("stories_error_private");break;case"deleted-narrative":o=(0,k.getLang)("stories_error_deleted_narrative");break;case"private-narrative":o=(0,k.getLang)("stories_error_private_narrative");break;case"isOneTimeSeen":o=(0,k.getLang)("stories_error_one_time_seen");break;default:o=(0,k.getLang)("global_unknown_error")}this._resetErrors(),this._stopLoader();var s=(0,y.ce)("div",{className:"stories_error_wrap"}),n=(0,y.ce)("div",{className:"stories_error"}),a=(0,y.ce)("div",{className:"stories_error_cont"});n.appendChild(a),a.appendChild((0,y.ce)("div",{className:"stories_error_icon "+r})),a.appendChild((0,y.ce)("div",{className:"stories_error_caption",innerHTML:o})),i&&a.appendChild(i),s.appendChild(n),this.contWrap.appendChild(s),(0,y.addClass)(this.wrapEl,"failed"),(0,b.inArray)(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&(0,y.addClass)(this.wrapEl,"fatal_error")}},e.prototype._stopLoader=function(){var e=this;setTimeout((function(){(0,y.re)((0,y.geByClass1)("stories_loader",e.contWrap))}),0)},e.prototype._showLoader=function(){if(this._stopLoader(),this.isActive&&(!this.isLoaded()||this.isPaused())&&this.contWrap){var e=(0,y.ce)("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}},e.prototype._onFollowBtnClick=function(){var e,t,o=this;(this.pauseStory(),this.followBtnLock)||(this.followBtnLock=!0,this.data.author.id>0?(t="al_friends",e=this.data.author.can_follow?"add":"remove"):(t="al_groups",e=this.data.author.can_follow?"a_enter":"a_leave"),window.ajax.post(t+".php",{act:e,mid:this.getOwnerId(),gid:-this.getOwnerId(),hash:this.data.author.hash,from:"stories"},{onDone:function(){if(o.data.author.can_follow&&o.sendStatEvent("follow"),o.data.author.can_follow=!o.data.author.can_follow,o.data.author.can_follow){var e=(0,R.getIcon24UserAddOutline)();o.followBtn.innerHTML=e.icon}else{e=(0,F.getIcon24UserAddedOutline)();o.followBtn.innerHTML=e.icon}o.showMessage((0,k.getLang)(o.data.author.can_follow?"stories_unfollowed":"stories_followed")).then((function(){return o.playStory()})).catch((function(e){(0,x.logError)(e)})),window.tooltips&&window.tooltips.destroy(o.followBtn),(0,E.triggerEvent)(o.followBtn,"mouseover")},showProgress:function(){return o.showInlineLoader()},hideProgress:function(){o.hideInlineLoader(),o.followBtnLock=!1}}))},e.prototype.markAsActive=function(){this.isActive=!0,(0,y.addClass)(this.wrapEl,"animate_story")},e.prototype._destroyFeedBackTT=function(){delete this.feedback,this.hideFeedbackTooltip()},e.prototype.hideFeedbackTooltip=function(e){void 0===e&&(e=!0),this.isFeedbackTooltipShow&&(this.isFeedbackTooltipShow=!1,this.autoResumeStory(),this.updateBottom(),e&&(0,w.cancelStackPop)())},e.prototype.showFeedbackTooltip=function(){var e=this;this.isFeedbackTooltipShow||(this.hideTooltip(),this.pauseStory(),this.isFeedbackTooltipShow=!0,this.updateBottom(),this.layer.sendNavigationStatEvents("open_replies_list"),(0,w.cancelStackPush)("stories_feedback_tt",(function(t){e.hideFeedbackTooltip(!1),(null==t?void 0:t.isCloseBtnClick)&&(0,w.cancelStackPop)(t)})))},e.prototype._onModalsShownChange=function(e){void 0===e&&(e=!1),this.isModalShown=e},e.prototype.showInlineLoader=function(){(0,y.show)(this.inlineLoader)},e.prototype.hideInlineLoader=function(){(0,y.hide)(this.inlineLoader)},e.prototype.volumeUpdate=function(){var e=this.story;e&&e.volumeUpdate&&e.volumeUpdate()},e.prototype._onAutoPlayFail=function(){(0,y.addClass)(this.wrapEl,"autoplay_failed")},e.prototype.hideReply=function(){var e=this;(0,C.showFastBox)({title:(0,k.getLang)("global_warning"),onHide:function(){e.autoResumeStory()}},(0,k.getLang)("stories_hide_reply_warning"),(0,k.getLang)("global_continue"),this._doHideReply.bind(this),(0,k.getLang)("global_cancel"))},e.prototype._doHideReply=function(){var e=this;this.pauseStory(),(0,y.addClass)(this.wrapEl,"hiding_reply"),(0,T.curBox)().hide();var t=this.getIndex(),o=this.data.author.gender,i=(0,y.se)('<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">'+(0,A.getProgressHtml)()+'</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">'+(0,k.getLang)("stories_reply_hidden")+'</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">'+(0,k.getLang)("stories_hide_reply_continue")+'</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">'+(0,k.langSex)(o,(0,k.getLang)("stories_hide_all_replies"))+'</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">'+(0,k.getLang)("stories_reply_add_to_blacklist")+"</div>\n  </div>\n</div>");(0,E.addEvent)((0,y.geByClass1)("_stories_reply_restore",i),"click",this._restoreReply.bind(this)),(0,E.addEvent)((0,y.geByClass1)("_stories_reply_continue",i),"click",(function(){return e._replyHideEnd(t)})),(0,E.addEvent)((0,y.geByClass1)("_stories_hide_replies",i),"click",this._hideAllReplies.bind(this)),(0,E.addEvent)((0,y.geByClass1)("_stories_reply_ban",i),"click",this._ban.bind(this)),this.contWrap.appendChild(i),window.ajax.post("al_stories.php",{act:"hide_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:function(){e.opts.removeList(),window.cur.needUpdateFeedStories=!0,(0,y.removeClass)(i,"loading")},onFail:function(){return e._resetReplyHide(),e.playStory(),!0}})},e.prototype._restoreReply=function(e){var t=this;(0,E.cancelEvent)(e);var o=(0,y.geByClass1)("stories_hide_reply_wrap",this.contWrap);window.ajax.post("al_stories.php",{act:"restore_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:function(){t._resetReplyHide(),t.playStory()},showProgress:function(){return(0,y.addClass)(o,"loading")},hideProgress:function(){return(0,y.removeClass)(o,"loading")}})},e.prototype._resetReplyHide=function(){(0,y.re)((0,y.geByClass1)("stories_hide_reply_wrap",this.contWrap)),(0,y.removeClass)(this.wrapEl,"hiding_reply")},e.prototype._hideAllReplies=function(){var e=this.data.author.first_name_gen;(0,C.showFastBox)({title:(0,k.getLang)("global_warning")},(0,k.getLang)("stories_delete_all_replies_confirm").replace("{name}",e),(0,k.getLang)("global_continue"),this._doHideAllReplies.bind(this),(0,k.getLang)("global_cancel"))},e.prototype._doHideAllReplies=function(e){var t=this;window.ajax.post("al_stories.php",{act:"hide_all_replies",owner_id:this.getOwnerId(),hash:this.data.reply_hide_hash},{onDone:function(){(0,T.curBox)().hide(),t.opts.removeList(),t.data.items=[];var e=(0,y.geByClass1)("_stories_hide_replies",t.contWrap);(0,y.val)(e,(0,k.getLang)("stories_all_replies_hidden")),(0,y.addClass)(e,"disabled")},showProgress:function(){return(0,S.lockButton)(e)},hideProgress:function(){return(0,S.unlockButton)(e)}})},e.prototype._ban=function(){var e=this.data.author.first_name_gen;(0,C.showFastBox)({title:(0,k.getLang)("global_warning")},(0,k.getLang)("stories_ban_confirm").replace("{name}",e),(0,k.getLang)("global_continue"),this._doBan.bind(this),(0,k.getLang)("global_cancel"))},e.prototype._doBan=function(e){var t=this;window.ajax.post("al_stories.php",{act:"ban",owner_id:this.getOwnerId(),hash:this.data.stories_ban_hash},{onDone:function(){(0,T.curBox)().hide(),t.opts.removeList(),t.data.items=[];var e=(0,y.geByClass1)("_stories_reply_ban",t.contWrap);(0,y.val)(e,(0,k.getLang)("stories_banned")),(0,y.addClass)(e,"disabled")},showProgress:function(){return(0,S.lockButton)(e)},hideProgress:function(){return(0,S.unlockButton)(e)}})},e.prototype._replyHideEnd=function(e){(0,y.geByClass1)("stories_hide_reply_wrap",this.contWrap)&&(this.data.items.length<=1&&l.onReplyDeleted(this.getOwnerId()),this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!(0,b.isNumeric)(e)))},e.prototype._feedbackRemoveReplyFromDom=function(e){var t=(0,y.geByClass1)("stories_feedback_content",this.wrapEl);if(t){var o=t.querySelector("#feed_story_"+e);o&&(0,y.addClass)(o,"removed")}},e.prototype.onReplyDeleted=function(e){this._feedbackRemoveReplyFromDom(e)},e.prototype._updateFeedStoryPreview=function(){var e=(0,y.ge)("feed_story_"+this.layer.getBlockKey(this.data));if(e&&!e.classList.contains("stories_feed_reply_item")&&e.classList.contains("stories_feed_preview_item")){var t=this.indexToUnread(!0);if(t){var o=this.data.items[t];o&&o.small_preview&&(0,y.setStyle)(e,"background-image","url("+o.small_preview+")"),e.classList.remove("stories_feed_sticker_icon_show")}}},e.prototype.sendStatEvent=function(e){var t=this.getCurStoryData();t?window.ajax.post("al_stories.php",(0,b.extend)({act:"stat",source_story:this.getRawId(),track_code:this.getTrackCode()},t.stats[e])):(0,x.logError)(new Error("Fail: sendStatEvent"),{environment:"stories"})},e.prototype.report=function(){var e=this,t=this.getCurStoryData(),o=this.getCurrentNarrative();if(t)if(t.isAds&&(0,N.partConfigEnabled)("ads_new_reports_web_histories")){var r=t.track_code,s="",n=(0,C.showBox)("/reports.php",{act:"report_ad_box",track_code:r,type:"story"},{onDone:function(){var e=(0,y.geByClass)("radiobtn","ad_report");window.radioBtns.ad_report={val:0,els:e};var t=(0,y.ge)("ad_csrf");s=t?t.value:s},params:{onClean:function(){delete window.radioBtns.ad_report,e.playStory()}},stat:["reports.css"]});n.removeButtons(),n.addButton((0,k.getLang)("box_send"),(function(t){window.ajax.post("reports.php",{act:"report_ad_common",track_code:r,reason:window.radioBtns.ad_report.val,hash:s},{onDone:function(){var t=e.index,i="groups"===e.layer.list;n.hide(),e.layer.sendNavigationStatEvents("claim"),i||o||e._popStoryAndClearList(t),(0,T.showDoneBox)((0,k.getLang)("stories_report_sent"),{className:"stories_done_msg"}),e.updateNarrativeBlockIfNeeded()},showProgress:function(){return(0,S.lockButton)(t)},hideProgress:function(){return(0,S.unlockButton)(t)}})})),n.addButton((0,k.getLang)("global_cancel"),!1,"no")}else{if(this.isActiveLive())return void this.showReportLiveBox();var a=function(){return e.playStory()};if(o)(0,H.showReportForm)("narrative",o.ownerId,o.id,void 0,a);else{var l=(0,i.__read)(this.getRawId().split("_"),2),d=l[0],c=l[1],_=parseInt(d),u=parseInt(c);(0,H.showReportForm)("story",_,u,void 0,a)}}else(0,x.logError)(new Error("Fail: report"),{environment:"stories"})},e.prototype.showReportLiveBox=function(){var e=this,t=(0,C.showBox)("al_stories.php",{act:"report_box"},{onDone:function(){var e=(0,y.geByClass)("radiobtn","stories_report");window.radioBtns.stories_report={val:0,els:e}},params:{onClean:function(){delete window.radioBtns.stories_report,e.playStory()}}});t.removeButtons(),t.addButton((0,k.getLang)("box_send"),this._sendReportButtonDidPress.bind(this)),t.addButton((0,k.getLang)("global_cancel"),!1,"no")},e.prototype._sendReportButtonDidPress=function(e){var t=this,o=this.getCurStoryData();if(o){var i,r,s=this.index,n=o.report_hash,a=this.getCurrentNarrative(),l="groups"===this.layer.list;a?(i=""+a.rawId,r=a.reportHash):(i=this.getRawId(),r=n),window.ajax.post("al_stories.php",{act:"report",type:a?"narrative":"story",item_raw:i,reason:window.radioBtns.stories_report.val,hash:r},{onDone:function(){(0,T.curBox)().hide(),t.layer.sendNavigationStatEvents("claim"),l||a||t._popStoryAndClearList(s),(0,T.showDoneBox)((0,k.getLang)("stories_report_sent"),{className:"stories_done_msg"})},showProgress:function(){return(0,S.lockButton)(e)},hideProgress:function(){return(0,S.unlockButton)(e)}})}else(0,x.logError)(new Error("Fail: _sendReportButtonDidPress"),{environment:"stories"})},e.prototype.onLiveEnded=function(e){void 0===e&&(e=!1),this.isActiveLive()&&(this.data.items[this.index].can_share=!e,this.story&&this.story.onLiveEnded(),this.updateBottom())},e.prototype.updateLiveViewersCount=function(e){(0,y.val)(this.descEl,e)},e.prototype.isActiveStoryOneTime=function(){return this.story&&this.story.isOneTime()},e.prototype.isAppsMetaStoryActive=function(){return!(!this.story||!this.story.isAppsMetaStory)},e.prototype.buildStoryArchiveByActive=function(){var e=this.getRawId(),t=this.getCurStoryData();if(e&&t){var o=(0,i.__read)(e.split("_"),2)[1];return{id:Number(o),rawId:e,listId:this.layer.list,preview:t.small_preview,originalPreviewUrl:t.small_preview,time:t.time}}},e.prototype.editCurrentNarrative=function(){var e=this,t=this.getCurStoryData(),o=this.getCurrentNarrative();if(t&&(this.pauseStory(),this.isModalShown=!0,o)){var r=[];(null==o?void 0:o.stories.length)&&(r=(0,i.__spreadArray)([],(0,i.__read)(o.stories)));var s={selectedStories:r,narrative:o,onClose:function(t){e.isModalShown=!1,e.updateBottom(),t&&(e.updateNarrativeBlockIfNeeded(),e._popCoverAndCleanNarrativeList())},navScreen:O.NarrativeAnalyticNavScreen.storyViewer};(0,I.showNarrativeEditorBox)(this.getOwnerId(),s)}},e.prototype.updateNarrativeBlockIfNeeded=function(){(0,D.updateNarrativeBlock)()},e.prototype.showDoneBox=function(e){(0,T.showDoneBox)(e,{className:"stories_done_msg"})},e}()},569887:(e,t,o)=>{o.d(t,{onPlayerChange:()=>l});var i,r=o(393263),s=o(986900),n=o(897557),a=o(611386);function l(e){if(r.HAS_MEDIA_SESSION){var t=(i=e).getCurStoryData();if(t)if(["video"].includes(t.type)&&!t.noSound){var o=(0,n.decodeHTMLEntities)(i.data.author.name),s=(0,n.decodeHTMLEntities)(t.date),l=t.small_preview||t.photo_url||t.first_frame||t.preview_url,h=l?[{sizes:"800x1497",src:l}]:[];!function(){if(!r.HAS_MEDIA_SESSION)return;navigator.mediaSession.setActionHandler("play",d),navigator.mediaSession.setActionHandler("pause",c),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",_),navigator.mediaSession.setActionHandler("nexttrack",u)}(),(0,r.updateMediaSessionMetadata)({title:o,artist:s,album:"",artwork:h})}else(0,r.clear)();else(0,a.logError)(new Error("Fail story media session"),{environment:"stories"})}}function d(){i.playStory(),(0,s.statlogsValueEvent)("global_media_controls","story_player","play")}function c(){i.pauseStory(),(0,s.statlogsValueEvent)("global_media_controls","story_player","pause")}function _(){i.prevStory(),(0,s.statlogsValueEvent)("global_media_controls","story_player","previous_track")}function u(){i.nextStory(),(0,s.statlogsValueEvent)("global_media_controls","story_player","next_track")}},421296:(e,t,o)=>{o.d(t,{default:()=>d});var i=o(570655),r=o(435501),s=o(895283),n=o(414914),a=o(469433),l=o(917685);const d=function(e){function t(t,o,i){var r=e.call(this,t,o,i)||this;return r.isFirstChunkLoaded=!1,r}return(0,i.__extends)(t,e),t.prototype.render=function(){var t=this;if(e.prototype.render.call(this),this.video)return this.video;var o=this.data.video_url;return this.video=document.createElement("video"),this.video.setAttribute("class","stories_video"),this.video.setAttribute("autoplay","false"),this.video.setAttribute("volume",(0,a.getAudioPlayer)().getVolume()),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),(0,l.addEvent)(this.video,"error",(function(){t._loadingError()})),this._isFailed()||(this.loaded&&(this.video.currentTime=0),(0,l.addEvent)(this.video,"canplay",this._onCanPlay.bind(this)),this.video.src=o,this.volumeUpdate()),this.video},t.prototype.getContainer=function(){return this.video||this.render()},t.prototype.getImage=function(){var e=(0,n.getSize)(this.video),t=document.createElement("canvas");t.setAttribute("width",e[0].toString()),t.setAttribute("height",e[1].toString());var o=t.getContext("2d");return o&&o.drawImage(this.video,0,0,e[0],e[1]),t.toDataURL()},t.prototype.destroy=function(){e.prototype.destroy.call(this),(0,l.removeEvent)(this.video),delete this.video},t.prototype.play=function(){var t=this;if(e.prototype.play.call(this),this.loaded&&this.video){var o=this.video.play();void 0!==o&&o.catch((function(){t.opts.onAutoPlayFail()}))}},t.prototype.pause=function(){e.prototype.pause.call(this),this.video&&this.video.pause()},t.prototype.setCurrentTime=function(e){void 0===e&&(e=0),e=+(e/1e3).toFixed(1),this.loaded&&this.video.currentTime<e&&(this.video.currentTime=e)},t.prototype.getCurrentTime=function(){return 1e3*this.video.currentTime},t.prototype.getDuration=function(){return 1e3*this.video.duration},t.prototype.volumeUpdate=function(){this.video.volume=s.getVolume()},t.prototype._onCanPlay=function(){e.prototype._onCanPlay.call(this),!this.isFirstChunkLoaded&&window.cur.storyLayer&&(this.isFirstChunkLoaded=!0,window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0})),(0,n.setStyle)(this.video,"opacity",1),(0,l.removeEvent)(this.video,"canplay")},t}(r.default)}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(o.exports,o,o.exports,__webpack_require__),o.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,o,i)=>{if(!t){var r=1/0;for(l=0;l<deferred.length;l++){for(var[t,o,i]=deferred[l],s=!0,n=0;n<t.length;n++)(!1&i||r>=i)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[n])))?t.splice(n--,1):(s=!1,i<r&&(r=i));if(s){deferred.splice(l--,1);var a=o();void 0!==a&&(e=a)}}return e}i=i||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>i;l--)deferred[l]=deferred[l-1];deferred[l]=[t,o,i]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var o=Object.create(null);__webpack_require__.r(o);var i={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&t&&e;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,__webpack_require__.d(o,i),o},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={5583:0};__webpack_require__.O.j=t=>0===e[t];var t=(t,o)=>{var i,r,[s,n,a]=o,l=0;for(i in n)__webpack_require__.o(n,i)&&(__webpack_require__.m[i]=n[i]);if(a)var d=a(__webpack_require__);for(t&&t(o);l<s.length;l++)r=s[l],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[s[l]]=0;return __webpack_require__.O(d)},o=self.webpackChunkvk=self.webpackChunkvk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var __webpack_exports__=__webpack_require__.O(void 0,[8288,885,8592,4509,1437,8102,8003,3639],(()=>__webpack_require__(676319)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();