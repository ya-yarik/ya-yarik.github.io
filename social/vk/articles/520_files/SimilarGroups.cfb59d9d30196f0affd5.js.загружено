(()=>{"use strict";var t,e,i,s={304418:(t,e,i)=>{i.d(e,{uiGetGallery:()=>l,UIGallery:()=>o});var s=i(257451),r=(0,s.makeSharedState)("ui-gallery",(()=>({galleries:{},incIndex:0})));function l(t){var e=domData(ge(t),"gallery-id");return e&&r().galleries[e]}class o{constructor(t,e){if(!t)throw new Error("No element was provided for UIGallery");if(t=ge(t),!hasClass(t,"ui_gallery"))throw new Error("Provided incorrect element for UIGallery");var i=l(t);if(i)return i;this._opts=extend({markOutside:!1,scrollY:!0,scrollX:!0,noArrows:!1},e),this._id=r().incIndex,r().incIndex+=1,this._el=t,this._width=getSize(this._el)[0],this._items=geByClass("ui_gallery_item",this._el),this._itemWidth=getSize(this._items[0])[0],this._itemOffset=intval(getStyle(this._items[0],vk.rtl?"marginLeft":"marginRight")),this._scrollOffset=intval(getStyle(this._items[0],"marginLeft")),this._itemFullWidth=this._itemWidth+this._itemOffset,this._innerCont=geByClass1("ui_gallery__inner_cont",this._el),this._inner=geByClass1("ui_gallery__inner",this._el),this._scroll=function(){var t={rtl:!1,backward:!1,delta:1,negative:!1,rtlSame:!1};if(!vk.rtl)return t;if(!cur._scrollInfo){var e=se('<div style="position: fixed; left: -1000; width: 0; overflow: scroll">x</div>');ge("content").appendChild(e);var i=e.scrollLeft;t.rtl=vk.rtl,t.backward=i>0,e.scrollLeft=1e3,t.delta=e.scrollLeft===i?-1:1,t.negative=!t.backward&&t.delta<0,t.rtlSame=t.rtl&&!t.backward&&!t.negative,re(e),cur._scrollInfo=t}return cur._scrollInfo}(),this._loadingMore=!1,this._finised=!1,this._visible={left:-1,right:-1,items:[]},this._outside={left:-1,right:-1,timer:null},this._initScroll(),this._initArrows(),domData(this._el,"gallery-id",this._id),r().galleries[this._id]=this,this._checkItemsAfterScroll(this._innerCont.scrollLeft,!0)}_initScroll(){(this._opts.scrollX||this._opts.scrollY)&&addEvent(this._innerCont,"DOMMouseScroll wheel",this._onWheelScroll.bind(this))}_initArrows(){this._opts.noArrows?addClass(this._el,"ui_gallery_no_arrows"):(this._leftArrow=geByClass1("ui_gallery__arrow_left",this._el),this._rightArrow=geByClass1("ui_gallery__arrow_right",this._el),this._arrowWidth=getSize(this._leftArrow)[0],addEvent(this._leftArrow,"click",this._onArrowScroll.bind(this,-1)),addEvent(this._leftArrow,"mouseover",this._onArrowMouseOver.bind(this,"left")),addEvent(this._leftArrow,"mouseout",this._onArrowMouseOut.bind(this)),addEvent(this._rightArrow,"click",this._onArrowScroll.bind(this,1)),addEvent(this._rightArrow,"mouseover",this._onArrowMouseOver.bind(this,"right")),addEvent(this._rightArrow,"mouseout",this._onArrowMouseOut.bind(this)))}_onWheelScroll(t){if(this._opts.scrollX||this._opts.scrollY){var e;if("wheel"==t.type)if(Math.abs(t.deltaY)>Math.abs(t.deltaX)){if(!this._opts.scrollY)return;e=-t.deltaY}else{if(!this._opts.scrollX)return;e=-t.deltaX}else if(void 0!==t.wheelDeltaY){if(!this._opts.scrollY)return;e=t.wheelDeltaY}else if(void 0!==t.wheelDelta)e=t.wheelDelta;else{if(!t.detail||1!==t.axis)return;e=-t.detail}e=this._scroll.rtlSame?-e:e,Math.abs(e)>=120&&(e=74*Math.max(-1,Math.min(1,e))),this._innerCont.scrollLeft-=e,this._checkItemsAfterScroll(this._innerCont.scrollLeft),cancelEvent(t)}}_onArrowScroll(t,e){if(!this._opts.noArrows){var i=this._innerCont.scrollLeft+(this._scroll.rtlSame?-t:t)*(this._width-2*this._arrowWidth),s=this._innerCont.scrollWidth-this._width;this._scroll.negative?(i=Math.min(i,0),i=Math.abs(i)):i=Math.max(0,i),i=Math.min(s,i);var r=this._scroll.negative||this._scroll.rtlSame?-t:t;if(r>0&&i<s)i=Math.floor(i/this._itemFullWidth)*this._itemFullWidth;else if(r<0&&i>0){i=Math.floor(i/this._itemFullWidth)*this._itemFullWidth}if(0===i||i===s){var l=this._innerCont.scrollWidth;addClass(this._inner,"ui_gallery__inner_shift_instant"),this._onArrowMouseOut(),i&&(i+=t*(this._innerCont.scrollWidth-l))}this._scroll.negative&&(i=-i),animate(this._innerCont,{scrollLeft:i},{duration:Math.abs(this._innerCont.scrollLeft-i)+50,transition:Fx.Transitions.easeOutCubic}),this._checkItemsAfterScroll(i),setTimeout((()=>removeClass(this._inner,"ui_gallery__inner_shift_instant")),0),cancelEvent(e)}}_checkItemsAfterScroll(t,e){if(this._scroll.negative&&(t=Math.abs(t)),this._opts.markOutside||this._opts.onViewItem){var i,s=this._itemWidth/3,r=(this._scroll.backward?this._inner.scrollWidth-this._width-t:t)-this._scrollOffset,l=t&&Math.floor(r/this._itemFullWidth),o=l*this._itemFullWidth+2*s;i=this._scroll.backward?t+this._width<this._inner.scrollWidth-o:t>o;var h,n=Math.min(this._items.length-1,Math.floor((r+this._width)/this._itemFullWidth)),a=n*this._itemFullWidth+2*s;if(h=this._scroll.backward?t>this._inner.scrollWidth-a:t+this._width<a,this._opts.onViewItem){var _=i?Math.min(this._items.length-1,l+1):l,d=h?Math.max(0,n-1):n;if(e||_!==this._visible.left||d!==this._visible.right){for(var u=_;u<=d;u++)(this._visible.left<0||e&&!inArray(this._items[u],this._visible.items)||u<this._visible.left||u>this._visible.right)&&this._opts.onViewItem(this._items[u],u);this._visible.left=_,this._visible.right=d,this._visible.items=this._items.slice(_,d+1)}}this._opts.markOutside&&(e?(geByClass("ui_gallery_item_outside",this._inner).forEach((t=>{removeClass(t,"ui_gallery_item_outside")})),this._outside.left=-1,this._outside.right=-1):((l!==this._outside.left||!i)&&this._outside.left>=0&&(removeClass(this._items[this._outside.left],"ui_gallery_item_outside"),this._outside.left=-1),(n!==this._outside.right||!h)&&this._outside.right>=0&&(removeClass(this._items[this._outside.right],"ui_gallery_item_outside"),this._outside.right=-1)),i&&l!==this._outside.left&&(addClass(this._items[l],"ui_gallery_item_outside"),this._outside.left=l),h&&n!==this._outside.right&&(addClass(this._items[n],"ui_gallery_item_outside"),this._outside.right=n))}if(!this._opts.noArrows){var c=t>0,g=t+this._width<this._inner.scrollWidth;toggleClass(this._leftArrow,"ui_gallery__arrow_visible",this._scroll.rtl&&!this._scroll.backward?g:c),toggleClass(this._rightArrow,"ui_gallery__arrow_visible",this._scroll.rtl&&!this._scroll.backward?c:g)}(!this._scroll.backward&&this._inner.scrollWidth-t-this._width<1e3||this._scroll.backward&&t<1e3)&&this._onLoadMore()}_onArrowMouseOver(t){this._opts.noArrows||addClass(this._inner,"ui_gallery__inner_shift_"+t)}_onArrowMouseOut(){this._opts.noArrows||(removeClass(this._inner,"ui_gallery__inner_shift_left"),removeClass(this._inner,"ui_gallery__inner_shift_right"))}_onLoadMore(){!this._opts.onLoadMore||this._loadingMore||this._finised||(this._loadingMore=!0,this._opts.onLoadMore(this._items.length))}addMore(t,e){t=t||[],this.addItems(t),this._finised=!!e||!t.length,this._loadingMore=!1}addItems(t,e){if((t=t||[]).length){var i=e>=0&&e<this._items.length?this._items[e]:null;t.forEach((t=>{i?domInsertBefore(t,i):this._inner.appendChild(t)})),this.refresh()}}destroy(){removeEvent(this._innerCont),removeEvent(this._leftArrow),removeEvent(this._rightArrow),domData(this._el,"gallery-id",null),delete r().galleries[this._id],this._opts.onDestroy&&this._opts.onDestroy(),re(this._el)}removeItem(t){return isNumeric(t)&&(t=this._items[t]),!(!t||!inArray(t,this._items))&&(re(t),this.refresh(),this._items.length||this.destroy(),!0)}refresh(){this._width=getSize(this._el)[0],this._items=geByClass("ui_gallery_item",this._el),this._checkItemsAfterScroll(this._innerCont.scrollLeft,!0)}getItems(){return this._items}getVisibleItems(){return this._visible.items.map(((t,e)=>[t,this._visible.left+e]))}}},412079:(t,e,i)=>{var s=i(362270);window.SimilarGroups=new s.SimilarGroups;try{stManager.done(jsc("web/SimilarGroups.js"))}catch(t){}},362270:(t,e,i)=>{i.d(e,{OPEN_BLOCK_MODE_SUBSCRIBE:()=>a,OPEN_BLOCK_MODE_UNSUBSCRIBE:()=>_,SimilarGroups:()=>d});var s=i(705456),r=i(791563),l=i(116886),o=i(304418),h=i(501458),n="enter",a="subscribe",_="unsubscribe";class d{init(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.ownerId=t,this.isEvent=e,this.hash=i,this.block=document.querySelector(".similar_groups_block"),this.block_title=document.querySelector(".similar_groups_block__title"),this.initGalleryBlock(),this.initMenuItem(),this.eventLog=new h.SimilarGroupsEventLog(Math.abs(this.ownerId)),this.issetSimilarGroups()&&isVisible(this.block)&&this.initGallery()}reInit(){this.init(this.ownerId,this.isEvent,this.hash)}initMenuItem(){this.menuItem=document.querySelector(".page_menu_group_similar_recommends"),this.updateMenuItemText()}updateMenuItemText(){null!==this.menuItem&&(isVisible(this.block)?this.menuItem.innerHTML=(0,l.getLang)("groups_similar_recommends_hide_menu_item"):this.isEvent?this.menuItem.innerHTML=(0,l.getLang)("groups_similar_events_show_menu_item"):this.menuItem.innerHTML=(0,l.getLang)("groups_similar_recommends_show_menu_item"))}issetSimilarGroups(){return null!==this.block&&null!==this.menuItem}initGalleryBlock(){this.gallery=document.querySelector(".similar_community_gallery")}initGallery(){null!==this.gallery&&new o.UIGallery(this.gallery)}toggleBlock(){this.issetSimilarGroups()&&(isVisible(this.block)?this.hide():this.show("menu_item"))}toggleSubscribeGroup(t,e,i){var s=t.closest(".wall_card"),o=s.dataset.action,h=s.dataset.in_group;if("0"!==s.dataset.group_closed&&"0"!==h&&o!==n)var a=(0,r.showFastBox)({title:(0,l.getLang)("global_warning"),bodyStyle:"padding: 20px; line-height: 160%;"},(0,l.getLang)("groups_group_leave2"),(0,l.getLang)("group_leave_group"),(()=>{a.hide(),this._toggleSubscribeGroup(t,e,i)}),(0,l.getLang)("global_cancel"));else this._toggleSubscribeGroup(t,e,i);e.preventDefault()}_toggleSubscribeGroup(t,e,i){var o=t.closest(".wall_card"),h=o.dataset.action,a=-o.dataset.group_id,_=h===n?"al_feed.php":"al_fans.php",d={act:h===n?"subscr":"unsub",hash:i,from:"similar_groups"};h===n?d.oid=a:d.id=a,this.eventLog.addLog(h,this.block.dataset.open_mode,o.dataset.index,Math.abs(a),o.dataset.add),ajax.post(_,d,{onDone(e){h===n?(t.classList.add("secondary"),o.dataset.action="leave"):(t.classList.remove("secondary"),o.dataset.action=n),t.innerHTML=e},onFail(t){if(t)return(0,r.showFastBox)({title:(0,l.getLang)("global_error"),onHide:nav.reload,bodyStyle:"padding: 20px; line-height: 160%;"},t),!0},showProgress:()=>(0,s.lockButton)(t),hideProgress:()=>(0,s.unlockButton)(t)})}show(t){this.issetSimilarGroups()&&(this.block.dataset.open_mode=t,this.isEvent?this.block_title.innerHTML=(0,l.getLang)("groups_similar_events_recommendations_title"):this.block_title.innerHTML=(0,l.getLang)("groups_similar_recommendations_title"),null===this.gallery?ajax.post("al_groups.php",{act:"a_recommends_get",owner_id:this.ownerId,hash:this.hash},{onDone:t=>{this.block.insertAdjacentHTML("beforeend",t),this.showBlock()},onFail(t){if(t)return(0,r.showFastBox)({title:(0,l.getLang)("global_error"),bodyStyle:"padding: 20px; line-height: 160%;"},t),!0},showProgress:Page.actionsDropdownLock.pbind(this.menuItem),hideProgress:Page.actionsDropdownUnlock.pbind(this.menuItem)}):this.showBlock())}showBlock(){show(this.block),this.initGalleryBlock(),this.initGallery(),this.updateMenuItemText();var t=[];this.gallery.querySelectorAll(".ui_gallery_item").forEach((e=>t.push(e.dataset.group_id))),this.eventLog.addLog("open_group_block",this.block.dataset.open_mode,-1,-1,"",t)}hide(){this.issetSimilarGroups()&&(hide(this.block),this.updateMenuItemText(),this.eventLog.addLog("hide_group_block",this.block.dataset.open_mode),ajax.post("al_groups.php",{act:"a_recommends_hide",owner_id:this.ownerId,hash:this.hash}))}clickOnGroup(t,e){e.target.closest(".similar_group_subscribe")||this.eventLog.addLog("open_group",this.block.dataset.open_mode,t.dataset.index,t.dataset.group_id,t.dataset.add)}delRefFromUrl(){nav.objLoc&&"similar_groups_block"===nav.objLoc.from&&(delete nav.objLoc.from,nav.setLoc(nav.objLoc))}}}},r={};function l(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return s[t].call(i.exports,i,i.exports,l),i.exports}l.m=s,t=[],l.O=(e,i,s,r)=>{if(!i){var o=1/0;for(_=0;_<t.length;_++){for(var[i,s,r]=t[_],h=!0,n=0;n<i.length;n++)(!1&r||o>=r)&&Object.keys(l.O).every((t=>l.O[t](i[n])))?i.splice(n--,1):(h=!1,r<o&&(o=r));if(h){t.splice(_--,1);var a=s();void 0!==a&&(e=a)}}return e}r=r||0;for(var _=t.length;_>0&&t[_-1][2]>r;_--)t[_]=t[_-1];t[_]=[i,s,r]},l.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return l.d(e,{a:e}),e},i=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,l.t=function(t,s){if(1&s&&(t=this(t)),8&s)return t;if("object"==typeof t&&t){if(4&s&&t.__esModule)return t;if(16&s&&"function"==typeof t.then)return t}var r=Object.create(null);l.r(r);var o={};e=e||[null,i({}),i([]),i(i)];for(var h=2&s&&t;"object"==typeof h&&!~e.indexOf(h);h=i(h))Object.getOwnPropertyNames(h).forEach((e=>o[e]=()=>t[e]));return o.default=()=>t,l.d(r,o),r},l.d=(t,e)=>{for(var i in e)l.o(e,i)&&!l.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},l.e=()=>Promise.resolve(),l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),l.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={8504:0};l.O.j=e=>0===t[e];var e=(e,i)=>{var s,r,[o,h,n]=i,a=0;for(s in h)l.o(h,s)&&(l.m[s]=h[s]);if(n)var _=n(l);for(e&&e(i);a<o.length;a++)r=o[a],l.o(t,r)&&t[r]&&t[r][0](),t[o[a]]=0;return l.O(_)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var o=l.O(void 0,[8592,4509,4595,6019,6183],(()=>l(412079)));o=l.O(o)})();