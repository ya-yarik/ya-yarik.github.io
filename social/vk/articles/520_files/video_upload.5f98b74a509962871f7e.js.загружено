(()=>{"use strict";var __webpack_modules__={684112:(e,o,i)=>{var a=i(995006),d=i(47681),_=i(666003),t=i(128533);window.VideoUpload=a.VideoUpload,window.VideoUploadSubtitles=d.VideoUploadSubtitles,window.VideoInlineUpload=_.default;try{stManager.done("video_upload.js")}catch(e){}(0,t.tq)().setInteractiveHandler("VideoUpload/pick_from_my_videos",(e=>{var o=e.payload.dataAttrs.groupId;a.VideoUpload.toGroupVideoSelect(o)}))},666003:(e,o,i)=>{i.d(o,{default:()=>_,getUploadVideoExtMasks:()=>t,getUploadModule:()=>r,onVideoUploaded:()=>n});i(175115),i(59357);var a=i(791563),d=i(571399);const _={getUploadModule:(e,o,i,a,d)=>r(e,o,i,a,d),initModalVideoUploader(e){var o=cur.videoUploadParams,i=ge("choose_video_upload");if(!i)return!1;this.initDragEvents();var a={};return"article"===e&&(a.onUploadProgress=()=>{},a.onUploadStartDone=()=>{var e,o;null===(e=(o=cur).onMediaUploadStarted)||void 0===e||e.call(o)},a.onUploadError=()=>{var e,o;null===(e=(o=cur).onMediaUploadFail)||void 0===e||e.call(o)}),r(i,boxLayerWrap,o,null,a)},initDragEvents(){var e,o=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var o=ge("video_choose_upload_area_wrap");if(!hasClass(o,"video_choose_upload_area_enter")){addClass(o,"video_choose_upload_area_enter");var i=ge("video_choose_wrap"),a=getXY(i)[1],d=getSize(o)[1];return hide("video_choose_wrap"),setStyle(o,"height",scrollGetY()+window.clientHeight()-a+d),cancelEvent(e)}},i=e=>cancelEvent(e),a=e=>{if(i(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},d=()=>{addEvent(boxLayerWrap,"dragenter dragover",o),addEvent(boxLayerWrap,"dragleave",i),addEvent(boxLayerWrap,"drop",a)};d();var _=null===(e=curBox().getOptions())||void 0===e?void 0:e.onHide;setTimeout(curBox().setOptions.pbind({onHide:()=>{if(removeEvent(boxLayerWrap,"dragenter dragover",o),removeEvent(boxLayerWrap,"dragleave",i),removeEvent(boxLayerWrap,"drop",a),"function"==typeof _)return _()},onShow:()=>{Video.initChooseBox(),d()}}),0)}};function t(e){var o=d.VIDEO_UPLOAD_EXTS.slice(0,d.VIDEO_UPLOAD_EXTS.length);if("types"===e){for(var i=o.length,a=0;a<i;++a)o.push(o[a].toUpperCase());return"*."+o.join(";*.")}return"accept"===e?"."+d.VIDEO_UPLOAD_EXTS.join(",."):""}function l(e){if(!cur.leaving){var o=getLang("video_upload_changed"),i=!1;if(each(window.cur.videoUploaders,((e,o)=>{Upload.isSomethingUploading(o)&&(i=!0)})),1===e){if(!i)return!0;var d=(0,a.showFastBox)({title:getLang("global_warning"),dark:!0},o,getLang("global_continue"),(function(){cur.leaving=!0,d.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){d.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return i?winToUtf(o.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function r(e,o,i,_,r){if(i){_=_||cur,(r=r||{}).onUploadStart||(r.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,o,i){if(!1===l(1))return cur.onContinueCb=nav.go.pbind(i),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=l,r.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),r.onUploadStartDone&&r.onUploadStartDone()}),r.onUploadComplete||(r.onUploadComplete=(e,o)=>{var i=window.parseJSON(o);i.video_id?n(e,i,_):"string"==typeof o&&o.indexOf("TERMINATED")>-1||Upload.onUploadError(e);r.onUploadCompleteDone&&r.onUploadCompleteDone(),setTimeout((()=>{r.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&r.onUploadAllCompleteDone()}))}),r.onUploadProgress||(r.onUploadProgress=(e,o,i)=>{var a=void 0!==e.ind?e.ind:e;show("_im_media_preview"),_.showMediaProgress&&_.showMediaProgress("video",a,function(e,o,i){return{loaded:o,total:i,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,o,i))}),r.onUploadError||(r.onUploadError=(e,o)=>{statlogsValueEvent("upload_video_fails",1,i.options.server,o),function(e){var o=void 0!==e.ind?e.ind:e,i=e.fileName?o+"_"+e.fileName:e;if(re("upload"+i+"_progress_wrap"),!geByClass1("popup_box_container")){var d=getLang("video_upload_error");setTimeout((0,a.showFastBox)({title:getLang("global_error")},d).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+o)||{}).action}),Upload.embed(o)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var s=cur.maxFiles-(cur.savedVideos||[]).length,p=browser.safari?"":"video/*,"+t("accept");i.lang&&(cur.lang=extend(cur.lang||{},i.lang));var u={accept:p,file_input:null,file_name:"video_file",file_size_limit:1024*(i.options.file_size_limit_in_GB||d.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:t("types"),chooseBox:1,chunked:1,chunkSize:d.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:o===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:o,from:i.vars.from,lang:i.lang,max_attempts:3,max_files:s,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!i.options.hasOwnProperty("visible_dropbox")||i.options.visible_dropbox},v=Upload.init(e,"",{},Object.assign(u,r));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(v),v}}function n(e,o,i,d){i=i||cur;var _=void 0!==e.ind?e.ind:e,t=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),l=t?_+"_"+t:e,r=o.owner_id+"_"+o.video_id,n=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo,s=ge("upload"+l+"_progress_wrap");s&&hide(geByClass1("progress_x",s)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:r},{onDone:e=>{n||i.chooseMedia("video",r,extend(e[r],{upload_ind:l,upload_new:!0}));var _=o.owner_id,t=o.video_id,s=o.video_hash,p=0,u=()=>{ajax.post("al_video.php?act=encode_progress",{oid:_,vid:t,hash:s,need_thumb:1},{onDone:o=>{var s,p=!0;if(o){if(o.error)return s=getLang("video_upload_encode_error"),void setTimeout((0,a.showFastBox)({title:getLang("global_error")},s).hide,2e3);o.thumb&&(p=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:_,vid:t},{onDone:o=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(r,o),void re("upload"+l+"_progress_wrap");i.hasChosenMedia("video",r)?i.updateChosenMedia("video",r,extend(o,{upload_ind:l,upload_new:!0})):d&&d(e,r)}}))}p&&(n||i.hasChosenMedia("video",r))&&setTimeout(u,1e3)},onFail:()=>{++p<3&&setTimeout(u,2e3*p)}})};u()}})}},995006:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{VideoUpload:()=>VideoUpload});var core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(991181),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(59357),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(175115),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(751876),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(66108),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(296253),_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(414914),_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(705456),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(791563),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(182408),_video_upload_vars__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(571399),_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(265848),_shared_lib_debounce__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(503369),_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(116886),_icons_desktop_getIcon24BrowserBack__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(217770),VideoUpload={FILE_TYPES:"",UPLOAD_ACCEPT:"",HOUR_IN_MS:36e5,DAY_IN_MS:864e5,MONTH_IN_MS:2592e6,uploadNum:0,showBox:function(e){function o(o){return e.apply(this,arguments)}return o.toString=function(){return e.toString()},o}((function(e){return re("video_upload_box_placeholder"),cur.uploadBanned?((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)({title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_no_upload_title")},(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_claims_no_upload")),!1):ge("video_upload_block")||4!=vk.al?(e=e||{},(e=extend(e,{ocl:cur.ocl?1:0})).oid||(e.oid=cur.oid||vk.id),cur.uploadVideoBox=showBox("al_video.php?act=upload_box",e,{stat:["video_edit.css","privacy.css",jsc("web/privacy.js")],params:{containerClass:"video_upload_box",onHide:window.VideoUpload.onHideUploadPanel,onDestroy:window.VideoUpload.onDestroyUploadBox,onShow:window.VideoUpload.onShowUploadPanel,width:450},onDone:()=>{cur.uploadVideoBox.removeButtons(),hide(domNS(cur.uploadVideoBox.bodyNode)),cur.uploadVideoBox.titleWrap.classList.toggle("OwnerChooseWrapper",cur.is_showcase),cur.chosedOwnerId=cur.oid,inArray(e.from,["article","board","post","comment","message"])&&window.VideoUpload.toExternalAdd(e.from)}}),!1):nav.go("videos"+cur.oid+"?z=upload_video")})),init:function(){window.VideoUpload.buildExtMasks(),window.VideoUpload.startEvents()},buildExtMasks:function(){var e=_video_upload_vars__WEBPACK_IMPORTED_MODULE_10__.VIDEO_UPLOAD_EXTS;window.VideoUpload.UPLOAD_ACCEPT="."+e.join(",.");for(var o=e.length,i=0;i<o;++i)e.push(e[i].toUpperCase());window.VideoUpload.FILE_TYPES="*."+e.join(";*.")},startEvents:function(){addEvent(boxLayerWrap,"scroll",window.VideoUpload.checkResize),addEvent(window,"resize",window.VideoUpload.checkResize)},stopEvents:function(){removeEvent(boxLayerWrap,"scroll",window.VideoUpload.checkResize),removeEvent(window,"resize",window.VideoUpload.checkResize)},onHideUploadPanel:function(){},onDestroyUploadBox:function(){window.VideoUpload.stopEvents(),delete cur.uploadVideoResizeTimeout,delete window.cur.uploadVideoBox},onShowUploadPanel:function(){ge("video_upload_box_placeholder")&&isVisible("video_upload_box_tab"),window.VideoUpload.doResize()},checkResize:function(){window.VideoUpload.doResize(),cur.uploadVideoResizeTimeout&&clearTimeout(cur.uploadVideoResizeTimeout),cur.uploadVideoResizeTimeout=setTimeout(window.VideoUpload.doResize,1)},resizeElements:function(){var e=window.VideoUpload._uploadAlbumChooser;if(e){var o,i=null===(o=document.querySelector(".VideoUploadItem__main"))||void 0===o?void 0:o.clientWidth;if(!i)return;for(var a in e)if(e.hasOwnProperty(a)){e[a].setOptions({width:i});var d=window.VideoUploadSubtitles[a];if(d){var _=d.elems.tracksLangDropdown;for(var t in _)_.hasOwnProperty(t)&&_[t].setOptions({width:i/2});d.elems.defaultLangDropdown.setOptions({width:i/2})}}}},destroyTab:function(){var e=ge("video_upload_block");if(e){var o=geByClass("js-video_upload",e);each(o,(e=>{var i=o[e];cleanElems(i)})),cur.resizeElementsHandler&&(cur.resizeElementsHandler=!1,removeEvent(window,"resize",window.VideoUpload.resizeElements))}},doResize:function(){},onPrivacyChanged:function(e){var o=cur.tag2ElMap[e.substr(5)],i=geByClass1("video_upload_publish",o);Privacy.getValue(e)>0?(removeClass(i,"on"),addClass(i,"disabled")):removeClass(i,"disabled")},onThumbClick(e,o){var i=gpeByClass("js-video_upload",e),a=domData(e,"video");return showInlineVideo(a,"",{autoplay:1,module:"upload",onLoaded:()=>{var e=isChecked(geByClass1("video_edit_repeat",i));Videoview.getPlayerObject().toggleLoop(e)}},o,e),!1},onRepeatChanged(e){VideoUpload.updatePlayer(gpeByClass("js-video_upload",e))},initUpload:function initUpload(uploadOptions,subtitleUploadOptions,itemTemplate){uploadOptions=JSON.parse(uploadOptions),cur.lang=extend(cur.lang||{},uploadOptions.lang,uploadOptions.lang_ui);var hashs={},tag=uploadOptions.vars.tag,ownerId=uploadOptions.vars.oid,options=uploadOptions.options,isUvUpload=uploadOptions.is_uv_upload;hashs[tag]=options.update_db_hash,cur.videoHashs=extend(cur.videoHashs||{},hashs);var boxTab=ge("video_upload_box_tab");if(!ge("video_dropbox")&&boxTab){var p=boxTab.parentNode.parentNode.parentNode,d=se(`<div id="video_dropbox" class="dropbox choose">\n          <div class="dropbox_wrap">\n            <div class="dropbox_area">\n              <div class="dropbox_label">${uploadOptions.lang.drop_files_here}</div>\n            </div>\n          </div>\n        </div>`);p.appendChild(d)}window.VideoUpload.onShowUploadPanel();var placeholder=ge("video_upload_box_placeholder"),uploadItem=se('<div id="video_upload_box'+tag+'" class="noselect"></div>');placeholder.innerHTML="",placeholder.appendChild(uploadItem);var initButton=function initButton(){var uploadErrorInfo=ge("video_upload_fail_info");uploadErrorInfo&&(hide(uploadErrorInfo),Upload.init("video_upload_box"+tag,uploadOptions.url,uploadOptions.vars,{file_name:"video_file",file_size_limit:1024*(uploadOptions.options.file_size_limit_in_GB||_video_upload_vars__WEBPACK_IMPORTED_MODULE_10__.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:window.VideoUpload.FILE_TYPES,lang:uploadOptions.lang,flat_button:1,filesize_hide_last:1,chunked:1,chunkSize:_video_upload_vars__WEBPACK_IMPORTED_MODULE_10__.VIDEO_UPLOAD_CHUNK_SIZE,isUvUpload,extraUploadOptions:JSON.stringify(uploadOptions.extraUploadOptions),onUploadStart:function(e,o){uploadOptions.onUploadStart&&cur[uploadOptions.onUploadStart]();var i=void 0!==e.ind?e.ind:e;cur._uploadStart=vkNow(),VideoUpload.uploadNum++,delete window.VideoUpload.videoUploadCallback;var a=function(){uploadOptions.vars.save_hashes||(nav.objLoc.section="upload",nav.setLoc(nav.objLoc));var o=se(rs(itemTemplate,{id:i}));window.VideoUpload.initBeforeUnload();var a=ge("video_upload_block");a&&cur.newVideoUploadBlock&&(a.innerHTML="",a.insertAdjacentHTML("beforeend",cur.newVideoUploadBlock),cur.newVideoUploadBlock="");var d=domPN(geByClass1("js-video_upload",a));if(d){var _=geByClass1("page_block_h2",d).cloneNode(!0),t=geByClass1("_header_inner",_),l=d.cloneNode(!0);val(l,""),val(t,`${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_adding_video_title")} ${VideoUpload.uploadNum}`),l.appendChild(_),l.appendChild(o),a.appendChild(l),window.scrollTo(0,getXY(l)[1]-getSize(t)[1])}else{VideoUpload.uploadNum=1,geByClass1("page_block",a).appendChild(o)}re("video_upload_no_video"),uploadOptions.vars.save_hashes&&cur.oid>0&&(hide("video_edit_repeat"),hide(geByClass1("video_upload_publish")),hide(geByClass1("video_upload_publish_later")),geByClass1("video_upload__tabs").innerHTML=`<div class="video_ocl_warn">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_ocl_privacy")}</div>`),ownerId>0&&(cur.privacy["video"+tag]||(cur.privacy["video"+tag]=cur.privacy.video,cur.privacy["videocomm"+tag]=cur.privacy.video),Privacy.update("video"+tag),Privacy.update("videocomm"+tag),cur.tag2ElMap=cur.tag2ElMap||{},cur.tag2ElMap[tag]=o,cur.onPrivacyChanged=window.VideoUpload.onPrivacyChanged),VideoUpload.initPrivacyControls(ownerId,cur.privacy,i),VideoUpload.initActionLink(),curBox()&&curBox().hide(),hide("video_main_block"),hide("videocat_other_blocks"),hide("video_main_top_panel"),hide("video_search_input_wrapper"),show(a),cur.videoReupload&&(window.VideoUpload.deleteItem(cur.videoReupload,!1),delete cur.videoReupload),show(o);var r=ge("video_upload_item_"+i);if(e.fileName){var n,s=e.fileName,p=window.VideoUpload.FILE_TYPES.split(";");each(p,(function(e,o){if((n=s.indexOf(o.substr(1)))==s.length-o.length+1)return s=s.substr(0,n),!1}));var u=geByClass1("js-video_upload__title",r);val(u,s),u.select();var v=geByClass1("js-video_upload_file_name",r);v&&val(v,s)}if(window.VideoUpload.videoUploadCallback&&(window.VideoUpload.videoUploadCallback(),delete window.VideoUpload.videoUploadCallback),cur.videoThumbUploadOpts&&isObject(cur.videoThumbUploadOpts)&&window.VideoUpload.initThumbUpload(cur.videoThumbUploadOpts,o),window.VideoUpload._uploadAlbumChooser=window.VideoUpload._uploadAlbumChooser||{},cur.videoPlaylists&&cur.videoPlaylists.length){var c,g=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)(cur.is_showcase?"video_upload_choose_playlist_placeholder":"video_upload_choose_album_placeholder");window.VideoUpload._uploadAlbumChooser[i]=new Dropdown(geByClass1("js-video_upload_album_chooser_input",o),[[0,g]].concat(cur.videoPlaylists),{autocomplete:!0,big:!0,width:cur.is_showcase?null===(c=document.querySelector(".VideoUploadItem__main"))||void 0===c?void 0:c.clientWidth:void 0,selectedItems:[options.aid||0],onChange:e=>{""===e&&window.VideoUpload._uploadAlbumChooser[i].val(0)}}),cur.is_showcase&&!cur.resizeElementsHandler&&(cur.resizeElementsHandler=!0,addEvent(window,"resize",window.VideoUpload.resizeElements))}else re(geByClass1("js-video-upload-album-chooser",o));var m=geByClass1("page_block_header",d),b=geByClass1("flat_button",m);b&&(b.innerHTML=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_another_one"),addClass(b,"secondary")),uploadOptions.vars.save_hashes||(window.VideoUploadSubtitles||(window.VideoUploadSubtitles={}),window.VideoUploadSubtitles[i]={elems:{blockEl:r},options:subtitleUploadOptions,ownerId},window.VideoUploadSubtitles.init(i),geByClass1("video_upload__tabs",r)&&window.VideoUpload.showTab(r)),autosizeSetup(geByClass1("js-video_upload__description",r),{minHeight:80,maxHeight:600})};if(ge("video_upload_block"))a();else{var d=cur.privacy,_=cur.videoHashs,t=cur.videoThumbUploadOpts,l=cur.videoUploadThumbBtnTpl,r=cur.videoPlaylists,n=Object.assign({},window.Upload.options[i]);curBox().hide(),nav.go("videos"+ownerId,!1,{nocur:!0,params:{ocl:cur.ocl?1:0},onDone:function(){window.Upload.options[i]=n,window.Upload.vars[i]=uploadOptions.vars,setTimeout((function(){cur.lang=extend(cur.lang||{},uploadOptions.lang_ui),cur.privacy=extend(cur.privacy||{},d),cur.videoHashs=extend(cur.videoHashs||{},_),cur.videoThumbUploadOpts=t,cur.videoUploadThumbBtnTpl=l,cur.videoPlaylists=r,a()}))}})}},onUploadComplete:function onUploadComplete(i,res){var obj;if(res){try{obj=eval("("+res+")")}catch(e){obj=(0,_shared_lib_convert__WEBPACK_IMPORTED_MODULE_9__.fromQueryString)(res)}if(obj.code||obj.error)Upload.onUploadError(i,obj);else{uploadOptions.onUploadComplete&&cur[uploadOptions.onUploadComplete](obj);var videoId=obj.video_id,viewHash=obj.video_hash,ind=void 0!==i.ind?i.ind:i,item=ge("video_upload_item_"+ind);domData(item,"owner_id",ownerId),domData(item,"view_hash",viewHash);var callback=function(){var e=ge("video_upload_item_"+ind);domData(e,"video_id",videoId),domData(e,"uploaded",1),window.VideoUploadSubtitles[ind]&&window.VideoUploadSubtitles.onVideoUploaded(ind,videoId),window.VideoUpload.setUploadStatus((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_link_text"),e),window.VideoUpload.updateVideoLink(ind);var o=geByClass1("js-video_upload_link",e);if(o){var i,a=domData(o,"href-tpl"),d=rs(a,{video_id:videoId});if(val(o,d),o.removeAttribute("placeholder"),o.classList.contains("VideoUploadItem__videoLinkUrl"))o.href=d,null===(i=geByClass1("VideoUploadItem__videoLink"))||void 0===i||i.classList.add("VideoUploadItem__videoLink--ready");var _=geByClass("js-subtitles-upload-item",e);_.length&&_.forEach((e=>{domData(e,"selected")&&!domData(e,"uploaded")&&window.VideoUploadSubtitles.startUpload(e,cur.oid,videoId)}));var t=geByClass1("js-video_upload__copy_video_link",e);show(t),t.onclick=()=>{_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_11__.default.copy(d),showDoneBox((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_link_copied"),{out:1500}),o.focus()};var l=geByClass1("video_upload_ready_name",e);if(l){var r=ce("a",{innerHTML:l.innerHTML,className:l.className,href:d.href});domPN(l).insertBefore(r,l),re(l)}}domData(e,"saved")&&window.VideoUpload.saveParams(geByClass1("js-video_upload__ready_button",e),!0),window.VideoUpload.setStatusHeader((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_encode_waiting"),e),window.VideoUpload.setProgressValue(100,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_waiting"),e),window.VideoUpload.runVideoProgressUpdate(ind,ownerId,videoId,viewHash,1,-1,0)};item?callback():window.VideoUpload.videoUploadCallback=callback}}},onUploadProgress:function(e,o,i){var a=void 0!==e.ind?e.ind:e,d=intval(o/i*100),_=o/i*100;uploadOptions.onUploadProgress&&cur[uploadOptions.onUploadProgress](d);var t=ge("video_upload_item_"+a);if(t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(t,"progress")>d&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(t,"max_size_error",!0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(t,"progress",d);var l=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_uploaded_percent").replace("{percent}",d);window.VideoUpload.setProgressValue(_,l,t)}},onUploadError:function onUploadError(i,err){var debug;if(uploadOptions.onUploadError&&cur[uploadOptions.onUploadError](err),err&&(err.code||err.error)){try{debug=eval("("+err.debug+")")}catch(e){debug=(0,_shared_lib_convert__WEBPACK_IMPORTED_MODULE_9__.fromQueryString)(debug)}err=err.code?err.code:err.error}else debug=!1;var logErrorData={oid:ownerId,mid:uploadOptions.vars.mid,tag,srv:options.server,extra:err};window.VideoUpload._logUploadStatus("fail",logErrorData),cur.videoLastError=!0;var ind=void 0!==i.ind?i.ind:i,item=ge("video_upload_item_"+ind),callback=function(){var e,o=ge("video_upload_item_"+ind);o&&(-3==err?e=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_error_file"):-4==err?e=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_error_audio").replace("{link}",'<a href="/audio">').replace("{/link}","</a>"):-5==err?(e=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_claimed_not_uploaded"),debug&&debug.claim_id&&(e+=" ["+debug.claim_id+"]")):e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(o,"max_size_error")?(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_big_file_error"):-12==err?(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_flood_control"):(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_error_common"),window.VideoUpload.showError(o,e))};item?callback():window.VideoUpload.videoUploadCallback=callback,debugLog(err)},onConnectionLost:function(e){uploadOptions.onConnectionLost&&cur[uploadOptions.onConnectionLost]();var o=void 0!==e.ind?e.ind:e,i=ge("video_upload_item_"+o);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(i,"upload_index",o),window.VideoUpload.showError(i,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_connection_lost"),!0)},onDragEnter:function(){},onDragOut:function(){},onDrop:function(){},clear:1,type:"video",max_attempts:3,server:options.server,error:options.error,error_hash:options.error_hash,dropbox:"video_dropbox",custom_hash:options.custom_hash,check_hash:options.check_hash,check_rhash:options.check_rhash,check_url:options.check_url,accept:browser.safari?"":"video/*,"+window.VideoUpload.UPLOAD_ACCEPT}))},intervalId,text,lang,current,errorEl;initButton()},_logUploadStatus:function(e,o){try{o.act="upload_stats",o.stage=e,ajax.post("al_video.php",o)}catch(e){}},removeUploadedThumb:function(e,o){cancelEvent(o);var i=domPN(e);setStyle(i,{backgroundImage:""}),hide(i);var a=gpeByClass("js-video_tc_uploader",e),d=geByClass1("js-video_tc_upload_btn",a),_=domData(a,"thumb-id"),t=gpeByClass("js-video_upload",e),l=window.VideoUpload.getPlaceholderEl(e),r=l?domData(l,"thumb-id"):0,n="";if(domData(a,"thumb-id",""),domData(a,"thumb-hash",""),domData(a,"thumb-url",""),show(d),!l||r==_){var s=geByClass("js-video_tc_item",t);if(s.length>1)return window.VideoUpload.selectThumb(s[1+(s.length-2)/2]),!1;r="",n=l&&domData(l,"main-thumb"),l&&(domData(l,"thumb-id",r),setStyle(l,{backgroundImage:n?"url("+n+")":""}))}return!1},initThumbUpload:function(e,o){if(e&&isObject(e)){var i=geByClass1("js-video_tc_uploader",o),a={file_name:"photo",file_size_limit:1024*(e.file_size_limit_in_MB||50)*1024,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF;*.bmp;*.BMP",onUploadStart:function(e,o){var a=geByClass1("js-video_tc_upload_btn",i);hide(a),show(d),setStyle(_,"width","0%")},onUploadComplete:function(e,o){if(hide(d),setStyle(_,"width","0%"),o){o=window.parseJSON(o);var a=geByClass1("js-video_tc_upload_image",i);show(a),setStyle(a,{backgroundImage:"url("+o.thumb.l+")"}),domData(i,"thumb-url",o.thumb.l),domData(i,"thumb-id",o.photo_id+"_"+o.photo_owner_id),domData(i,"thumb-hash",o.photo_hash),window.VideoUpload.selectThumb(i)}else topError("Thumb load error")},onUploadProgress:function(e,o,i){var a=intval(o/i*100);a=Math.min(a,100),setStyle(_,"width",a+"%")},onUploadError:function(e,o){hide(d),setStyle(_,"width","0%"),topError("Thumb load error")},clear:1,type:"photo",max_attempts:3,server:e.server,error:e.default_error,error_hash:e.error_hash,noCheck:!0,chooseBox:!0,label:e.specialLabel||cur.videoUploadThumbBtnTpl,uploadButton:!0,buttonClass:"js-video_tc_upload_btn",accept:".jpg,.jpeg,.png",filesize_hide_last:!0,lang:{filesize_error:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_thumb_size_error")}};Upload.init(i,e.url,e.vars,a);var d=geByClass1("js-video_tc_upload_progress_wrap",o),_=geByClass1("js-video_tc_upload_progress_bar",o)}},initLiveTransTimePicker:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ge("VideoLiveTransTime--startTime")||!ge("VideoLiveTransTime--endTime"))return!1;if(d("startTimePicker","start-time","VideoLiveTransTime__startTimePickerPopup",VideoUpload.updateStarTime),d("endTimePicker","end-time","VideoLiveTransTime__endTimePickerPopup",VideoUpload.updateEndTime),VideoUpload.updateStarTime(),VideoUpload.updateEndTime(),e.start_time&&e.end_time){var o=1e3*e.start_time<Date.now();VideoUpload.showSavedLiveTimeSettings(o)}function i(e,o){var i=o.start_time,a=o.end_time;return"start-time"===e?i||Math.round(Date.now()/1e3):a||Math.round(Date.now()/1e3)+3600}function a(e){return"start-time"===e?VideoUpload.MONTH_IN_MS:VideoUpload.DAY_IN_MS}function d(o,d,_,t){var l="time-input_"+d,r=`datepicker-inline-container_${d}`,n=`\n          <td class="cal_clear" colspan="7">\n              <div class="VideoLiveTransTime__calendarFooter">\n                  <div id="${r}"></div>\n              </div>\n          </td>`,s=new Datepicker("date-input_"+d,{width:155,mode:"ts",onUpdate:t,noPast:!0,noFuture:!1,pastActive:!1,activePeriod:a(d),date:i(d,e),time:l,inlineTime:!0,inlineTimeContainerId:r,inlineTimeContainerIdx:d,addRows:n});return window.VideoUpload[o]=s,new ElementTooltip(ge("VideoLiveTransTime__"+o),{defaultSide:"top",autoShow:!1,cls:"VideoLiveTransTime__tooltip",noOverflow:!1,centerShift:0,noBorder:!0,content:ge(_),noHideOnClick:!0,align:ElementTooltip.ALIGN_LEFT,onHide:()=>{setTimeout((()=>{s&&s.hide(!0)}),ElementTooltip.FADE_SPEED)}}),s}},showStartTimePicker:function(e){VideoUpload.startTimePicker.toogle(e),addClass(ge("VideoLiveTransTimeEnabled"),"on"),addClass(ge("VideoLiveTransTime__startTimePicker"),"VideoLiveTransTime__timePicker--hasTime"),removeClass(geByClass1("ResetVideoLiveTransTime"),"ResetVideoLiveTransTime--hidden"),removeClass(ge("VideoLiveTransTime--endTime"),"VideoLiveTransTime--hidden"),VideoUpload.setPreparationCheckEnabled(!1)},showSavedLiveTimeSettings:function(e){addClass(ge("VideoLiveTransTimeEnabled"),"on");var o=ge("VideoLiveTransTime__startTimePicker");addClass(o,"VideoLiveTransTime__timePicker--hasTime"),toggleClass(o,"VideoLiveTransTime__timePicker--disabled",e),addClass(ge("VideoLiveTransTime__endTimePicker"),"VideoLiveTransTime__timePicker--hasTime"),toggleClass(geByClass1("ResetVideoLiveTransTime"),"ResetVideoLiveTransTime--hidden",e),removeClass(ge("VideoLiveTransTime--endTime"),"VideoLiveTransTime--hidden"),VideoUpload.setPreparationCheckEnabled(!1)},showEndTimePicker:function(e){VideoUpload.endTimePicker.toogle(e)},resetTimePickers:function(){removeClass(ge("VideoLiveTransTime__startTimePicker"),"VideoLiveTransTime__timePicker--hasTime"),addClass(ge("VideoLiveTransTime--endTime"),"VideoLiveTransTime--hidden"),addClass(geByClass1("ResetVideoLiveTransTime"),"ResetVideoLiveTransTime--hidden"),removeClass(ge("VideoLiveTransTimeEnabled"),"on"),VideoUpload.setPreparationCheckEnabled(!0);var e=new Date(Date.now());VideoUpload.setDatePickerDate(VideoUpload.startTimePicker,e,!0),VideoUpload.updateStarTime();var o=new Date(Date.now()+VideoUpload.HOUR_IN_MS);VideoUpload.setDatePickerDate(VideoUpload.endTimePicker,o,!0),VideoUpload.updateEndTime()},updateStarTime:function(){var e=intval(val(ge("date-input_start-time")));e=VideoUpload.validateSelectedTime(VideoUpload.startTimePicker,e),val(ge("VideoLiveTransTime__startTimePickerFormatTime"),VideoUpload.formatDate(e)),VideoUpload.endTimePicker.setActivePeriodStart(e),VideoUpload.updateEndTime()},updateEndTime:function(){var e=intval(val(ge("date-input_end-time")));e=VideoUpload.validateSelectedTime(VideoUpload.endTimePicker,e),val(ge("VideoLiveTransTime__endTimePickerFormatTime"),VideoUpload.formatDate(e))},formatDate:function(e){e=(e=~~(e/1e3))+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("datepicker_dateFormat");"dateFormat"===o&&(o="{day} {month} {year}");var i=new Date(1e3*e),a=i.getDate(),d=i.getMonth()+1,_=i.getFullYear();return o.replace("{day}",a).replace("{month}",winToUtf((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("Month"+d+"_of"))).replace("{year}",_)+` ${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("profile_wall_postpone_at")} `+`${i.getHours()}:${("0"+i.getMinutes()).slice(-2)}`},validateSelectedTime:function(e,o){var i=new Date(1e3*o),a=new Date,d=1e3*intval(val(ge("date-input_start-time"))),_=1e3*intval(val(ge("date-input_end-time")));if(VideoUpload.startTimePicker===e)if(i.getTime()>_){var t=new Date(i.getTime()+VideoUpload.HOUR_IN_MS);VideoUpload.setDatePickerDate(VideoUpload.endTimePicker,t,!0),val(ge("VideoLiveTransTime__endTimePickerFormatTime"),VideoUpload.formatDate(t.getTime()))}else if(i.getTime()+VideoUpload.DAY_IN_MS<_){var l=new Date(i.getTime()+VideoUpload.HOUR_IN_MS);VideoUpload.setDatePickerDate(VideoUpload.endTimePicker,l,!0),val(ge("VideoLiveTransTime__endTimePickerFormatTime"),VideoUpload.formatDate(l.getTime()))}if(VideoUpload.endTimePicker===e){if(i.getTime()<d){var r=new Date(d+VideoUpload.HOUR_IN_MS);return VideoUpload.setDatePickerDate(e,r,!0),r.getTime()}if(i.getTime()>d+VideoUpload.DAY_IN_MS){var n=new Date(d+VideoUpload.DAY_IN_MS);return VideoUpload.setDatePickerDate(VideoUpload.endTimePicker,n,!0),n.getTime()}}return i.getTime()<a.getTime()?(VideoUpload.setDatePickerDate(e,a,!0),a.getTime()):i.getTime()},setDatePickerDate:function(e,o,i){e.setDate(o.getFullYear(),o.getMonth()+1,o.getDate(),!0,o.getHours(),o.getMinutes()),i&&(e.timePicker.hourDD.val(o.getHours()),e.timePicker.minDD.val(o.getMinutes()))},setPreparationCheckEnabled:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=document.getElementById("VideoLiveTransTimeEnabled");if(!o.classList.contains("VideoLiveTransPreparationEnabled")){var i=ge("video_create_live_preparation_check")||ge("video_edit_live_preparation");e||checkbox(i,!1),toggleClass(i,"disabled",!e)}},selectThumb:function(e){var o=domData(e,"thumb-url"),i=domData(e,"thumb-id"),a=domData(e,"thumb-hash");if(i){var d=domPN(e);each(geByClass("js-video_tc_item",d),(function(){toggleClass(this,e.classList.contains("ThumbChooser__item")?"ThumbChooser__item--selected":"video_tc_item_selected",this==e)}));var _=window.VideoUpload.getPlaceholderEl(e);if(_){domData(_,"thumb-id",i),domData(_,"thumb-hash",a||""),domData(_,"thumb-url",o),setStyle(_,{backgroundImage:"url("+o+")"});var t=gpeByClass("js-video_upload",e);val(geByClass1("js-video_upload__player",t))&&VideoUpload.updatePlayerThumb(t)}}},getPlaceholderEl:function(e){var o=hasClass(e,"js-video_upload")?e:gpeByClass("js-video_upload",e);return gpeByClass("video_edit",o)?null:geByClass1("js-video_upload__thumb",o)},initTC:function(e,o,i){var a=geByClass1("js-video_upload__thumb_chooser_info",i);if(o)val(a.innerHTML,o);else{re(a),e=se(e);var d=geByClass1("js-video-upload-thumb-chooser",i);if(cur.is_showcase){var _=geByClass1("ThumbChooser",i);_&&(d=_)}d&&d.appendChild(e);var t=geByClass1("js-video_tc_uploader",i);if(t){var l=geByClass1("video_tc_slider_cont",i);domInsertBefore(t,domFC(l))}var r=window.VideoUpload.getPlaceholderEl(e),n=geByClass("js-video_tc_item",e);if(r&&!domData(r,"thumb-id")&&n.length>1){var s=geByClass1("js-video_tc_uploader",e)?1:0;window.VideoUpload.selectThumb(n[Math.floor(s+(n.length-1-s)/2)])}}},runVideoProgressUpdate:function(e,o,i,a,d,_,t,l){ajax.post("al_video.php?act=encode_progress",{oid:o,vid:i,hash:a,need_thumb:d,need_tc:_,is_showcase:cur.is_showcase},{onDone:function(r){var n=ge("video_upload_item_"+e);if(domPN(n)){var s=!0,p=-1;if(r){if(r.error)return void window.VideoUpload.showError(n,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_encode_error"));if(d&&r.thumb){var u=window.VideoUpload.getPlaceholderEl(n);domData(u,"main-thumb",r.thumb),domData(u,"thumb-id")||setStyle(u,{backgroundImage:"url('"+r.thumb+"')"}),d=""}_&&(r.tc||r.tc_msg)&&(window.VideoUpload.initTC(r.tc,r.tc_msg,n),_=0);var v=r.duration;if(p=r.percents,r.is_claimed)return void Upload.onUploadError(e,{code:"-5"});if(void 0!==v||r.is_uv_upload&&p>=0){if(void 0!==v&&domData(n,"duration",v),p>=100){if(t<100){if(VideoUpload.updatePlayer(n),r.published)window.VideoUpload.setPublished(n);else{var c=geByClass1("js-video_upload__progress",n);addClass(c,c.classList.contains("VideoUploadItem__progress")?"VideoUploadItem__progress--success":"_success");var g=geByClass1("js-video_upload__progress_text",c);val(g,domData(g,"lang-success")),window.VideoUpload.setStatusHeader((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_completed_title"),n)}if(d||_){var m=d?2:0;m+=_?1:0,window.VideoUpload._logUploadStatus("no_thumb",{status:m,vid:o+"_"+i})}}}else{var b=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_encode_percent").replace("{percent}",intval(p));window.VideoUpload.setStatusHeader((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_encoding"),n),window.VideoUpload.setProgressValue(p,b,n,!0)}p>=100&&!d&&!_&&(s=!1)}else p=-1}s&&setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(e,o,i,a,d,_,p,l),1e3)}},onFail:function(){l||(l=1),setTimeout(window.VideoUpload.runVideoProgressUpdate.pbind(e,o,i,a,d,_,t,l+1),2e3*l)}})},updatePlayer:function(e){if(!gpeByClass("video_edit",e)){var o=domData(e,"owner_id"),i=domData(e,"video_id");if(o&&i){var a=domData(e,"duration"),d=geByClass1("js-video_upload__player",e);domData(d,"video",`${o}_${i}`),attr(d,"href",`/video${o}_${i}`),attr(d,"onclick","return VideoUpload.onThumbClick(this, event);"),show(d),a&&val(geByClass1("js-video-duration-label",d),formatTime(a)),VideoUpload.updatePlayerThumb(e)}}},updatePlayerThumb:function(e){var o=window.VideoUpload.getPlaceholderEl(e),i=domData(o,"thumb-url");revertLastInlineVideo();var a=geByClass1("js-video_upload__player",e);setStyle(a,{backgroundImage:"url("+i+")"})},showError:function(e,o,i){var a=geByClass1("js-video_upload__progress",e),d=geByClass1("js-video_upload__progress_text",a);domData(e,"error",1),addClass(a,a.classList.contains("VideoUploadItem__progress")?"VideoUploadItem__progress--error":"_error"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(geByClass1("js-video_upload__ready_button",e),!0),val(d,o)},setPublished:function(e){domData(e,"published",1),window.VideoUpload.setStatusHeader((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_published_title"),e),window.VideoUpload.setUploadStatus((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_ready_link_text"),e);var o=geByClass1("js-video_upload__progress_wrap",e);isVisible(o)&&slideUp(o,{duration:150,transition:Fx.Transitions.swiftOut});var i=geByClass1("video_upload_publish",e);hasClass(i,"disabled")||window.disable(i);var a=geByClass1("video_upload_publish_later",e);a&&window.disable(a)},setProgressValue:function(e,o,i,a){if(i){var d=geByClass1("js-video_upload__progress_bar",i),_=geByClass1("js-video_upload__progress_text",i),t=geByClass1("js-video_upload__progress",i),l=t.classList.contains("VideoUploadItem__progress")?"VideoUploadItem__progress--processing":"video_upload__progress_processing";toggleClass(t,l,!!a),setStyle(d,{width:e+"%"}),val(_,o)}},saveParams:function(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=window.VideoUpload.getUploadItem(e);if(domData(i,"saved"))VideoUpload.deleteParams(e,o);else{var a=window.VideoUpload.getParams(i),d=i.id.substr("video_upload_item_".length),_=Upload.vars[d];if(!a.title||a.title.length>cur.videoTitleLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)(geByClass1("js-video_upload__title",i));if(a.desc.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)(geByClass1("js-video_upload__description",i));(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(e,!0),a.vid=domData(i,"video_id"),a.oid=_.oid,a.tag=_.tag,a.hash=cur.videoHashs[_.tag],nav.objLoc.ocl&&(a.ocl=1),ajax.post("al_video.php?act=save_video_params",a,{onDone:function(a){if((0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(e,!1),addClass(e,"secondary"),val(e,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_back_to_editing")),geByClass1("js-video_upload__title",i).setAttribute("readonly","readonly"),geByClass1("js-video_upload__description",i).setAttribute("readonly","readonly"),domData(i,"saved",1),"published"===a&&window.VideoUpload.setPublished(i),!o){var d=["video_upload__tabs","js-video-upload-thumb-chooser","video_upload__secondary_info"];cur.is_showcase&&(i.classList.add("VideoUploadItem--collapsed"),d.push("VideoUploadItem__asideInfo","js-video-upload-album-chooser","js-video-upload-checkboxes")),d.forEach((e=>{var o=geByClass1(e,i);slideUp(o,{duration:150,transition:Fx.Transitions.swiftOut})}))}}})}},deleteParams:function(e,o){var i=window.VideoUpload.getUploadItem(e),a=function(){domData(i,"saved",null),removeClass(e,"secondary"),geByClass1("js-video_upload__title",i).removeAttribute("readonly"),geByClass1("js-video_upload__description",i).removeAttribute("readonly"),val(e,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_end_editing"));var o=["video_upload__tabs","js-video-upload-thumb-chooser","video_upload__secondary_info"];cur.is_showcase&&(i.classList.remove("VideoUploadItem--collapsed"),o.push("VideoUploadItem__asideInfo","js-video-upload-album-chooser","js-video-upload-checkboxes")),o.forEach((e=>{var o=geByClass1(e,i);slideDown(o,{duration:150,transition:Fx.Transitions.swiftOut})}))};if(domData(i,"published"))a();else{(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(e,!0);var d=i.id.substr("video_upload_item_".length),_=Upload.vars[d],t=window.VideoUpload.getParams(i);t.vid=domData(i,"video_id"),t.oid=_.oid,t.tag=_.tag,ajax.post("al_video.php?act=delete_video_params",t,{onDone:function(i){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(e,!1),o||a()},onError:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(e,!1)}})}},getParams:function(e){var o=e.id.substr("video_upload_item_".length),i=Upload.vars[o],a=i.tag,d=geByClass1("video_upload_publish",e),_=geByClass1("video_upload_publish_later",e),t=geByClass1("video_upload_monetized",e),l=geByClass1("js-video_upload__title",e),r=geByClass1("js-video_upload__description",e),n=geByClass1("video_edit_repeat",e),s=0;window.VideoUpload._uploadAlbumChooser[o]&&(s=window.VideoUpload._uploadAlbumChooser[o].selectedItems()[0]);var p=window.VideoUpload.getPlaceholderEl(e),u=domData(p,"thumb-id"),v=domData(p,"thumb-hash"),c={action_link:geByClass1("js-action-link-input",e)?geByClass1("js-action-link-input",e).value:"",status_export:isChecked(d),publish_later:isChecked(_),no_comments:isChecked(geByClass1("VideoEdit__noComments",e)),monetized:isChecked(t),title:val(l),desc:val(r),repeat:isChecked(n),album_id:s?s[0]:"",thumb_id:u,thumb_hash:v};return i.oid>0?(c.privacy_video=Privacy.getValue("video"+a),c.privacy_videocomm=Privacy.getValue("videocomm"+a)):Object.keys(cur.privacy).length&&(c.privacy_video=val(ge(`${cur.privacy.view.key}_input`)),c.privacy_videocomm=val(ge(`${cur.privacy.comment.key}_input`))),c},setStatusHeader:function(e,o){if(o){var i=geByClass1("video_upload_item_header",o);val(i,e)}},setUploadStatus:function(e,o){var i=geByClass1("video_upload_link_header",o);val(i,e)},showReupload:function(e){var o=window.VideoUpload.getUploadItem(e),i=window.VideoUpload.getParams(o);i.reupload=1,window.VideoUpload.showBox(i),cur.videoReupload=o},resumeUpload:function(e){var o=window.VideoUpload.getUploadItem(e);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.disableButton)(geByClass1("js-video_upload__ready_button",o),!1),domData(o,"error",null);var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.data)(o,"upload_index");Upload.resumeUpload(i)},getUploadItem:function(e){return gpeByClass("js-video_upload",e)},noPublish:function(e){var o=window.VideoUpload.getUploadItem(e),i=geByClass1("video_upload_publish",o);isChecked(e)?(checkbox(i,0),window.disable(i,1)):window.disable(i,0)},stopUpload:function(e){var o=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)({width:430,title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_stop_title"),dark:1,bodyStyle:"padding: 20px;"},(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_stop_text"),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_stop_button"),(function(){o.hide(),Upload.terminateUpload(e);var i=ge("video_upload_item_"+e),a=domData(i,"video_id");if(a){var d=Upload.vars[e];ajax.post("al_video.php?act=delete_video",{vid:a,oid:d.oid,sure:1})}window.VideoUpload.deleteItem(ge("video_upload_item_"+e),!0)}))},deleteItem:function(e,o){var i=gpeByClass("page_block",e),a=geByClass1("page_block_header",i),d=geByClass("ui_crumb",a),_=geByClass("js-video_upload").map((e=>gpeByClass("page_block",e)));if(1===_.length)re(e),i.insertAdjacentHTML("beforeend",`<div id="video_upload_no_video">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_no_video_upload_title")}</div>`),val(d[d.length-1],(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_adding_video_title"));else if(i===_[0]){var t=_[1],l=geByClass1("page_block_header",t),r=val(geByClass1("_header_inner",t));val(d[d.length-1],r),domReplaceEl(l,a),re(i)}else o?slideUp(i,{duration:150,transition:Fx.Transitions.swiftOut,onComplete:function(){re(i)}}):re(i),cleanElems(i)},initBeforeUnload:function(){cur.nav.push((function(e,o,i,a){if(!1===window.VideoUpload.checkChanges(1))return cur.onContinueCb=nav.go.pbind(i),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=window.VideoUpload.checkChanges,cur.destroy.push((function(){window.onbeforeunload=cur.prevBefUnload,window.VideoUpload.destroyTab()}))},checkChanges:function(e){if(!cur.leaving){var o=ge("video_upload_block");if(!o)return!1;for(var i="",a="",d=geByClass("js-video_upload",o),_=d.length,t=0,l=0,r=0;r<d.length;r++){var n=d[r];domData(n,"error")?_--:(domData(n,"uploaded")&&t++,domData(n,"saved")&&l++)}if(t!==_)i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_changed");else if(l!==_){var s=_-l;a=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_leaving_without_saving",s)}if(1===e){if(!i&&!a)return!0;var p=e=>{cur.leaving=!0,e.hide(),cur.onContinueCb&&cur.onContinueCb()};if(i)var u=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)({title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_warning"),dark:!0},i,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_continue"),(()=>{p(u)}),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_cancel"),(()=>{u.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));else if(a){var v=new MessageBox({title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_warning"),containerClass:"video_upload__leave_editing_box"});v.content(a),v.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_save"),(()=>{v.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc);for(var e=geByClass("js-video_upload__ready_button"),o=0;o<e.length;o++){var i=e[o];window.VideoUpload.saveParams(i)}})),v.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_publish_later"),(()=>{p(v)}),"no",!1,"video_upload__publish_later_btn"),v.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_remove_video"),(()=>{d.forEach((e=>{if(!domData(e,"saved")){var o=e.id.substr("video_upload_item_".length),i=Upload.vars[o],a=domData(e,"owner_id"),d=domData(e,"video_id"),_=cur.videoHashs[i.tag];ajax.post("/al_video.php?act=a_delete_video",{oid:a,vid:d,from:cur.oid,pl_id:-2,hash:_},{onDone:()=>{domQuery(`[data-id="${a}_${d}"]`).forEach((e=>{re(e)}))}})}})),p(v)}),"no",!1,"video_upload__remove_video_btn"),v.show()}return!1}var c=i||a;return c?winToUtf(c.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}},toUploadVideo:function(){var e=cur.uploadVideoBox;window.VideoUpload.checkResize(),show("video_upload_box_tab"),hide("video_add_from_youtube_tab"),window.VideoUpload.onShowUploadPanel(),e.removeButtons(),e.setOptions({hideButtons:1,title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_header_new")}),e.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_cancel"),e.hide,"no"),e.setBackTitle()},toExternalAdd:function(e){var o=cur.uploadVideoBox,i="video"===e?this.toUploadVideo:o.hide;o.setBackTitle(i),window.VideoUpload.onHideUploadPanel(),hide("video_upload_box_tab"),show("video_add_from_youtube_tab"),o.removeButtons(),isVisible("video_extra_settings")||isVisible("video_share_not_allowed")||isVisible("video_share_error")?(o.setOptions({hideButtons:0}),o.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_save"),cur.saveExternalVideo)):o.setOptions({hideButtons:1}),o.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_cancel"),o.hide,"no"),ge("video_external_link").focus()},toGroupVideoSelect:function(e){var o=curBox();showBox("al_video.php?act=a_choose_video_box",{from:"video",without_upload:!0},{dark:1,onDone:function(e){var o=`<div class="back" onclick="curBox().hide();"><span class="back__icon">${(0,_icons_desktop_getIcon24BrowserBack__WEBPACK_IMPORTED_MODULE_13__.getIcon24BrowserBack)().icon}</span>${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_back")}</div>`;e.setOptions({title:o,defaultTitle:o})}}),cur.chooseVideoAdd=function(i,a,d){for(var _=new CallHub((function(){"video"!=cur.module?nav.go("/videos-"+e,!1,{onDone:function(){cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(nav.objLoc[0])}}):(nav.reload(),boxQueue.hideAll(),o.destroy())}),i.length),t=0,l=i.length;t<l;t++){var r=i[t],n=ge("video_item_"+r),s=domData(n,"hash");r=r.split("_");var p=window.Video&&Video.isInAlbum()?Video._getSectionAlbumId():-2;ajax.post("al_video.php?act=a_add_to_playlist",{oid:r[0],vid:r[1],hash:s,gid:e,add:1,playlist_id:p},{onDone:function(){d&&d(),_.done()},onFail:function(){_.done()}})}return!1}},lockSaveButton:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.lockButton)(curBox().btns.ok[0])},unlockSaveButton:function(){(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.unlockButton)(curBox().btns.ok[0])},initShare:function(e,o,i){var a,d,_=cur.uploadVideoBox,t=ge("video_external_link");window.placeholderSetup(t,{back:!0});var l,r=function(){var e=trim(t.value);e&&d!=e&&(_.showProgress(),d=e,ge("video_share_form").submit())};function n(e){a&&clearTimeout(a),e.keyCode==KEY.ENTER?r():a=setTimeout(r,1e3)}window.onParseDone=function(e){if(hide("video_share_server_error"),hide("video_share_error"),e.images_proxy){var o=ge("video_share_form").action.replace(/\/[^\/]*$/,"")+"/upload.php?act=proxy_img&";each(e.images_proxy,(function(i,a){e.images_proxy[i]=o+a}))}else e.images_proxy=e.images;if(e.extra>0&&e.extraData&&e.images[0]){if(hide("video_share_descr"),hide("video_share_error"),hide("video_share_not_allowed"),hide("video_share_error"),_.hideProgress(),ge("video_share_photo_url").value=e.url,ge("video_share_photo_image").value=e.images[0],ge("video_share_photo_extra").value=e.extra,cur.changeExternalImage=function(o){cur.externalVideoImage++,e.images[cur.externalVideoImage]?o.src=e.images_proxy[cur.externalVideoImage]:(cur.externalVideoImage=0,o.src=e.images_proxy[0])},e.images[0]){cur.externalVideoImage=0;var a=ge("video_external_image");if(setStyle(a,{backgroundImage:"url('"+e.images_proxy[0]+"')"}),a.setAttribute("onclick","cur.changeExternalImage(this)"),e.images.length>1){var d=vkImage();d.src=e.images_proxy[0],d.onload=function(){d.width<130&&cur.changeExternalImage(ge("video_external_img"))}}(r=vkImage()).onerror=function(){var o=!1;each(e.images_proxy,(function(e,i){if(0!=e){var d=vkImage();d.onload=function(){o||(o=!0,ge("video_share_photo_image").value=i,cur.externalVideoImage=e,setStyle(a,{backgroundImage:"url('"+i+"')"}))},d.src=i}}))},r.src=e.images_proxy[0]}ge("video_external_title").value=replaceEntities(e.title),ge("video_external_description").value=replaceEntities(e.description),show("video_extra_settings"),cur.videoPlaylists.length?cur._addExternalAlbumDD=new Dropdown(geByClass1("video_external_upload_album_chooser_input",curBox().bodyNode),[[0,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_choose_album_placeholder")]].concat(cur.videoPlaylists),{autocomplete:!0,selectedItems:[0],big:!0}):re(geByClass1("js-video-upload-album-chooser"));var t=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_save");"video"!==i&&(t=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_add"),hide("video_external_status_export"),hide(geByClass1("js-video-upload-album-chooser")),hide(domByClass(_.bodyNode,"video_upload_privacy_wrap"))),l=e,_.removeButtons(),_.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_cancel"),_.hide,"no"),cur.saveExternalVideo=function(){e&&e.images&&(window.VideoUpload.lockSaveButton(),cur.shareExternalImageSave=e.images[cur.externalVideoImage],ge("video_share_photo_image").value=cur.shareExternalImageSave,ge("video_share_photo_form").submit())},_.setOptions({hideButtons:0}),_.addButton(t,cur.saveExternalVideo)}else-1==e.extra?(show("video_share_not_allowed"),window.VideoUpload.unlockSaveButton()):(show("video_share_error"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)("video_external_link"),window.VideoUpload.unlockSaveButton());var r},window.onParseFail=function(){hide("video_share_server_error"),window.VideoUpload.unlockSaveButton(),show("video_share_error"),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)("video_external_link")},window.onUploadDone=function(a,d){if(d.photo_id&&d.user_id&&l){var t=l.title;l.title=ge("video_external_title").value;var r=ge("video_external_description").value,n=0;if(cur.vSection){var s=cur.vSection.split("_");"album"===s[0]&&(n=s[1])}var p=extend(l,{oid:e,folder_id:n,from:i,hash:o,share_title:t||ge("video_external_title").value,share_text:r,image_url:cur.shareExternalImageSave,photo_owner_id:d.user_id,photo_id:d.photo_id,extra:l.extra,extra_data:l.extraData,to_video:"video"===i?1:0,album_id:cur._addExternalAlbumDD?cur._addExternalAlbumDD.selectedItems()[0][0]:"",no_comments:isChecked("video_external_no_comments")?1:0,to_status:isChecked("video_external_status_export")?1:0});p.openGraph&&delete p.openGraph,delete l.extraData,p.oid>0&&(p.privacy_video=Privacy.getValue("video_external"),p.privacy_videocomm=Privacy.getValue("videocomm_external")),delete p.images,delete p.images_proxy,setTimeout((function(){ajax.post("/al_video.php?act=save_external",p,{onDone:function(e){if(hide("share_error"),e.owner_id&&e.video_id)if("video"===i)_.hide(),nav.reload();else{boxQueue.hideAll();var o=e.owner_id+"_"+e.video_id;Video.attachVideos([o])}else window.VideoUpload.unlockSaveButton(),show("video_share_server_error")},onFail:function(e){window.VideoUpload.unlockSaveButton(),hide("video_share_error"),ge("video_share_server_error").innerHTML=e,show("video_share_server_error")}})}),0)}else _.showProgress(),show("video_share_error")},window.onUploadFail=function(){_.hideProgress(),hide("video_share_error"),show("video_share_server_error")},addEvent(t,"paste blur",r),addEvent(t,"keydown input",n),cur.destroy.push((function(){removeEvent(t,"paste blur",r),removeEvent(t,"keydown input",n)}))},showLiveKeyTab(e,o){geByClass("video_upload__live_tab_content").forEach((e=>{toggle(e,hasClass(e,`video_upload__live_tab_content--${o}`))})),uiTabs.switchTab(e);var i=curBox();if(i.removeButtons(),"constant"===o){var a=i.bodyNode.querySelector(".video_upload__live_tab_content--constant .VideoLiveCoderSettings__input--key");i.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_copy_live_constant_key_button"),window.VideoUpload.copyLiveKey.bind(null,null,a)),i.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_cancel_but"),i.hide,"no")}else i.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_save_but"),window.VideoUpload.saveLiveStream),i.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_cancel_but"),i.hide,"no")},createLiveStream(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cur.oid;showBox("al_video.php?act=a_add_new_live_trans_form",{owner_id:e},{stat:["video_edit.css","privacy.css",jsc("web/privacy.js"),jsc("web/upload.js")],onDone:function(o){cur.chosedOwnerId=e,o.titleWrap.classList.toggle("OwnerChooseWrapper",cur.is_showcase),o.removeButtons(),cur.saveNewLiveTransBtn=o.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_save_but"),(()=>{window.VideoUpload.saveLiveStream(cur.chosedOwnerId)}),"ok",!0),o.addButton((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_cancel_but"),o.hide,"no"),autosizeSetup("video_new_live_trans_description",{minHeight:60,maxHeight:160})},onFail:function(e){if(e)return curBox().hide(),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_error"),e),!0}})},initNewLiveTransFormBox:(e,o,i,a,d,_)=>{VideoUpload.initThumbUpload(o,curBox().bodyNode),VideoUpload.initLiveStreamCategoryDropdown(i,a),cur.newLiveInfo={videoId:e.video_id,streamUrl:e.stream_url,streamName:e.stream_name},cur.newLiveHash=_.hash,cur.newLiveRandomTag=_.random_tag,cur.videoTitleLength=_.max_text_length.title,cur.videoDescriptionLength=_.max_text_length.description,d&&(cur.privacy=extend(cur.privacy||{},d),VideoUpload.initPrivacyControls(e.owner_id,d)),window.VideoUpload.showTab(curBox().bodyNode),VideoUpload.initActionLink(),VideoUpload.initLiveTransTimePicker()},updateNewLiveTransFormBox:e=>{ajax.post("al_video.php?act=a_add_new_live_trans_form",{owner_id:e,update:1},{showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.lockButton.pbind(cur.saveNewLiveTransBtn),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.unlockButton.pbind(cur.saveNewLiveTransBtn),onDone:function(e){var o=JSON.parse(e),i=o.liveInfo,a=o.hash,d=o.randomTag,_=o.uploadOptions,t=o.privacyData;VideoUpload.initThumbUpload(_,curBox().bodyNode),cur.newLiveInfo={videoId:i.video_id,streamUrl:i.stream_url,streamName:i.stream_name},cur.newLiveHash=a,cur.newLiveRandomTag=d,t&&(cur.privacy=extend(cur.privacy||{},t),VideoUpload.initPrivacyControls(i.owner_id,t))}})},initVideoUploadBox:(e,o,i,a,d,_,t,l,r,n,s)=>{VideoUpload.init(),VideoUpload.initUpload(e,o,a),VideoUpload.initShare(t,l,_),cur.privacy=d,cur.videoTitleLength=s.title,cur.videoDescriptionLength=s.description,cur.videoPlaylists=r,cur.videoThumbUploadOpts=i,cur.videoUploadThumbBtnTpl=n},updateVideoUploadBox:e=>{ajax.post("al_video.php?act=upload_box",{oid:e,update:1},{onDone:function(e,o){cur.newVideoUploadBlock=o;var i=JSON.parse(e);VideoUpload.initUpload(i.upload_options,i.subtitles_upload_options,i.upload_tpl),VideoUpload.initShare(i.owner_id,i.hash_share,i.from),cur.privacy=i.privacy_data,cur.videoPlaylists=i.playlists_data,cur.videoThumbUploadOpts=i.thumb_upload_options,cur.videoUploadThumbBtnTpl=i.thumb_upload_btn_tpl;var a=document.querySelector(".js-pick_from_my_videos");a&&(a.classList.toggle("unshown",i.is_user),a.setAttribute("config-group-id",i.owner_id))}})},initLiveStreamCategoryDropdown:function(e,o){var i=ge("video_upload_live_category"),a=ge("video_upload_live_game_category"),d=domPN(i).offsetWidth;toggle("video_upload_live_game_category_wrap",3==val(i));var _=new Dropdown(i,e,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:d,onChange:function(e){toggle("video_upload_live_game_category_wrap",3==e)}}),t=new Dropdown(a,o,{multiselect:!1,zeroPlaceholder:!0,big:!0,width:d,onChange:function(){}});cur.destroy.push((function(){_.destroy(),t.destroy()}))},getLiveStreamCategoryVal:function(){var e=ge("video_upload_live_category"),o=ge("video_upload_live_game_category");if(!e)return 0;var i=+val(e);if(3==i){var a=+val(o);i=a>0?a:i}return i},updateLiveTransSettings:function(e,o,i,a,d,_){ajax.post("al_video.php?act=generate_live_trans_keys",{rhash:d,hash:a,owner_id:cur.oid,video_id:e,need_new:o?1:0},{onDone:function(e){val("video_live_trans_settings_url"+_,e.url),val("video_live_trans_settings_key"+_,e.key),i&&i()}})},updatedLiveKeyMsg:function(){(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_trans_key_updated"),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_trans_key_updated_msg"))},onLiveCoderSettingsFocus:function(e){"password"===e.type?this.toggleLiveKeyVisibility(null,e):elfocus(e,0,e.value.length)},toggleLiveKeyVisibility(e,o){if(o||(o=ge("video_live_trans_settings_key"+e)),"password"===o.type)var i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_view_key_box_title"),a=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_view_key_box_msg"),d=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_view_key_box_confirm"),_=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_view_key_box_cancel"),t=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)(i,a,d,(()=>{t.hide(),o.type="text"}),_);else o.type="password"},copyLiveKey:function(e,o){o||(o=ge("video_live_trans_settings_key"+e)),_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_11__.default.copy(o.value),showDoneBox((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_key_copied"),{out:1500})},saveLiveStream:function(e){var o=curBox(),i=geByClass1("video_tc_item_selected",o.bodyNode),a=null,d=null;i&&(a=domData(i,"thumb-id"),d=domData(i,"thumb-hash"));var _=trim(val("video_new_live_trans_title")),t=trim(val("video_new_live_trans_description")),l=window.VideoUpload.getLiveStreamCategoryVal(),r=!!isChecked("VideoLiveTransTimeEnabled"),n=r?intval(val(ge("date-input_start-time"))):0,s=r?intval(val(ge("date-input_end-time"))):0;cur.newLiveInfo=cur.newLiveInfo||{};var p={owner_id:e,video_id:cur.newLiveInfo.videoId,stream_url:cur.newLiveInfo.streamUrl,stream_name:cur.newLiveInfo.streamName,thumb_id:a,thumb_hash:d,title:_,description:t,start_time:n,end_time:s,category:l,publish:isChecked("video_create_live_publish_on_wall"),preparation_check:isChecked("video_create_live_preparation_check"),notify_followers:isChecked("video_create_live_notify_followers"),enable_donations:isChecked("video_create_live_enable_donations"),forbid_rewind:isChecked("video_create_live_forbid_rewind"),is_endless:isChecked("video_create_live_endless"),rhash:cur.newLiveHash,random_tag:cur.newLiveRandomTag,action_link:geByClass1("js-action-link-input",o.bodyNode)?geByClass1("js-action-link-input",o.bodyNode).value:""};if(e<0?Object.keys(cur.privacy).length?(p.privacy_view=val(ge(`${cur.privacy.view.key}_input`)),p.privacy_comment=val(ge(`${cur.privacy.comment.key}_input`))):p.no_comments=isChecked(geByClass1("VideoEdit__noComments",o.bodyNode)):(p.privacy_view=Privacy.getValue("video_live_view"),p.privacy_comment=Privacy.getValue("video_live_comment")),cur.call&&(p.call=!0),!p.title||p.title.length>cur.videoTitleLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)("video_new_live_trans_title");if(p.description.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)("video_new_live_trans_description");if(!p.category){var u=domClosest("dropdown_container","video_upload_live_category");if(u)return u.scrollIntoView({block:"center"}),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)(u)}window.VideoUpload.lockSaveButton(),ajax.post("al_video.php?act=a_add_new_live_trans",p,{onFail:function(e){return window.VideoUpload.unlockSaveButton(),(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_create_live_error"),e||(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_create_live_error_try_later")),!0}})},switchLiveEndlessCheckbox(e){if(isChecked(e)||domData(e,"skip-warning"))checkbox(e);else{var o=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_endless_confirm_box_title"),i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_endless_confirm_box_msg"),a=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_live_endless_confirm_box_yes_btn"),d=se(`<div class="checkbox video_upload__live_endless_dont_warn_checkbox" onclick="checkbox(this)">${(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_dont_warn_next_time")}</div>`),_=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_8__.showFastBox)(o,i,a,(()=>{_.hide(),checkbox(e),isChecked(d)&&ajax.post("/al_video.php?act=skip_live_endless_warning",{hash:domData(e,"skip-warning-hash")},{onDone:()=>{domData(e,"skip-warning",1)}})}),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("global_cancel"));_.bodyNode.appendChild(d)}},showTab(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(geByClass1("js-video_upload__tab",i)){o||(o=geByClass1("js-video_upload__tab",i).dataset.type);var i=hasClass(e,"js-video_upload")?e:gpeByClass("js-video_upload",e);geByClass("js-video_upload__tab",i).forEach((e=>{hide(e)})),show(geByClass1(`video_upload__${o}`,i)),uiTabs.switchTab(domByClass(geByClass1(`video_upload__tab_${o}`,i),"ui_tab"))}},initEdit(e,o,i,a,d,_){cur.privacy=e;var t=VideoUpload.options[0],l=t.ownerId,r=t.videoId,n=geByClass1("js-video_upload");if(autosizeSetup(geByClass1("js-video_upload__description",n),{minHeight:80,maxHeight:250}),re(geByClass1("js-video_upload__link-block",n)),hide(geByClass("js-video_upload__tab",n)),window.VideoUpload.showTab(n),geByClass1("video_upload__tab_subtitles",n)&&(window.VideoUploadSubtitles[0].elems.blockEl=n,window.VideoUploadSubtitles.init(0)),o&&(cur.videoUploadThumbBtnTpl=a,VideoUpload.initThumbUpload(i,n),VideoUpload.initTC(o,"",n,!0)),d){if(d.uploaded_id){var s=geByClass1("js-video_tc_upload_image",n);setStyle(s,{backgroundImage:"url("+d.uploaded_url+")"}),show(s);var p=geByClass1("js-video_tc_uploader",n);p&&(domData(p,"thumb-id",d.uploaded_id),domData(p,"thumb-hash",d.uploaded_hash))}var u=geByClass("js-video_tc_item",n);each(u,(function(e){if(domData(this,"thumb-id")==d.selected)return addClass(this,"video_tc_item_selected"),e>3&&Video.tcSlide(null,this,-Math.min(e-1,u.length-4),!0),!1}))}VideoUpload.initPrivacyControls(l,e),VideoUpload.initActionLink(l,r),VideoUpload.initLiveTransTimePicker(_),curBox().setOptions({width:495}),curBox().removeButtons(),curBox().addButton(t.saveButtonTitle,VideoUpload.editSaveVideo)},initActionLink(e,o){var i=geByClass1("js-action-link-input");i&&(i.value&&VideoUpload.updateActionLinkPreview(e,o),i.addEventListener("keyup",(0,_shared_lib_debounce__WEBPACK_IMPORTED_MODULE_14__.debounce)((()=>{VideoUpload.updateActionLinkPreview(e,o)}),250)))},updateActionLinkPreview(e,o){var i=geByClass1("js-action-link-input"),a=geByClass1("js-action-link-desc"),d=geByClass1("js-action-link-error"),_=geByClass1("VideoEdit__actionLinkPreviewWrap");hide(_),hide(a),hide(d),i.value?ajax.post("al_video.php?act=get_action_link_preview",{owner_id:e,video_id:o,link:i.value},{cache:!0,onDone:function(e,o){e?(show(_),_.innerHTML=o):show(d)}}):show(a)},initPrivacyControls(e,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e>0?o.is_live&&(Privacy.update("video_live_view"),Privacy.update("video_live_comment")):each(o,(e=>{var a=o[e];new InlineDropdown(ge(a.key),{items:a.items,selected:a.selected,onSelect:e=>{3==+e&&window.VideoUpload.updateUploadOptions(i)}})}))},editSaveVideo(e){var o,i=gpeByClass("js-video_upload",e),a=VideoUpload.options[0],d=0;each(geByClass("js-video_tc_item",curBox().bodyNode),(function(){if(hasClass(this,"video_tc_item_selected"))return d=domData(this,"thumb-id"),o=domData(this,"thumb-hash"),!1}));var _=parseInt((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_6__.$)(".VideoEdit__fieldIsShortVideo").value),t=Videoview.getPlayerObject(),l=cur.mvMoveToAlbum?cur.mvMoveToAlbum.val():"",r={act:a.isPublish?"save_video_params":"do_edit_box",title:val(geByClass1("js-video_upload__title",i)),desc:val(geByClass1("js-video_upload__description",i)),vid:a.videoId,oid:a.ownerId,hash:a.hash,action_link:geByClass1("js-action-link-input",i)?geByClass1("js-action-link-input",i).value:"",action_link_title_key:geByClass1("VideoEdit__actionLinkTitleKey",i)?geByClass1("VideoEdit__actionLinkTitleKey",i).value:"",album_id:l,thumb_id:d,thumb_hash:o};if(a.isPublish&&(r.status_export=isChecked("video_edit_publish")),-1==l&&(r.album_title=val("mv_create_album"),!r.album_title))return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)("mv_create_album");if(r.oid>0?(r.privacy_video=Privacy.getValue(`video${a.videoId}`),r.privacy_videocomm=Privacy.getValue(`videocomm${a.videoId}`)):Object.keys(cur.privacy).length?(r.privacy_video=val(ge(`${cur.privacy.view.key}_input`)),r.privacy_videocomm=val(ge(`${cur.privacy.comment.key}_input`))):r.no_comments=isChecked(geByClass1("VideoEdit__noComments",i)),ge("video_edit_repeat")&&(r.repeat=isChecked("video_edit_repeat"),t&&t.toggleLoop(r.repeat)),!r.title.trim()&&!_||r.title.length>cur.videoTitleLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)(geByClass1("js-video_upload__title",i));if(r.desc.length>cur.videoDescriptionLength)return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)(geByClass1("js-video_upload__description",i));if(ge("video_upload_live_category")&&(r.live_category=VideoUpload.getLiveStreamCategoryVal(),!r.live_category))return(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.notaBene)(domClosest("dropdown_container","video_upload_live_category"));if(ge("video_edit_live_preparation")&&(r.live_preparation=isChecked("video_edit_live_preparation")?1:0),ge("video_edit_live_endless")&&(r.live_endless=isChecked("video_edit_live_endless")?1:0),ge("video_edit_live_forbid_rewind")&&(r.live_forbid_rewind=isChecked("video_edit_live_forbid_rewind")?1:0),ge("video_edit_live_donations")&&(r.live_donations=isChecked("video_edit_live_donations")?1:0),ge("VideoLiveTransTimeEnabled")){var n=!!isChecked("VideoLiveTransTimeEnabled");r.start_time=n?intval(val(ge("date-input_start-time"))):0,r.end_time=n?intval(val(ge("date-input_end-time"))):0}if(a.withSubtitles&&window.VideoUploadSubtitles[0]&&!window.VideoUploadSubtitles[0].tracksSaved)window.VideoUploadSubtitles.saveEditedTracks(0,VideoUpload.editSaveVideo);else if(ajax.post(`al_video.php?act=${r.act}`,r,{onDone:function(e,o,i,a){if(curBox()){if(curBox().hide(),window.Videoview&&i&&Videoview.updateVideo(r.oid,r.vid,e,o,a),cur.videoEditItem&&i){var d=Video.buildVideoEl(i,cur.is_showcase);domPN(cur.videoEditItem).replaceChild(d,cur.videoEditItem),cur.videoEditItem=!1,Video._reinitSorters()}Video._updateThumbsInView()}},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_7__.unlockButton.pbind(e)}),ge("mv_edit_album")){var s=[];s&&(cur.mvMoveToAlbum=new Dropdown(ge("mv_edit_album"),s,{width:250,selectedItems:[],autocomplete:s.length>7,big:1,onChange:function(e){-1==e?slideDown("mv_edit_create_album",200,(function(){window.placeholderSetup("mv_create_album",{back:!0}),ge("mv_create_album").focus()})):slideUp("mv_edit_create_album",200)}}))}else cur.mvMoveToAlbum=!1},updateUploadOptions(e){var o=ge("video_upload_item_"+e);domData(o,"owner_id")&&domData(o,"video_id")&&(domData(o,"view_hash_by_link")?window.VideoUpload.updateVideoLink(e):ajax.post("al_video.php?act=get_hash_by_link",{owner_id:domData(o,"owner_id"),video_id:domData(o,"video_id")},{onDone:i=>{i&&i.hash_by_link&&(domData(o,"view_hash_by_link",i.hash_by_link),window.VideoUpload.updateVideoLink(e))}}))},updateVideoLink(e){var o=ge("video_upload_item_"+e),i=geByClass1("video_upload_link",o,"input"),a=domData(o,"video_id");if(i&&a){var d=domData(o,"view_hash_by_link"),_=domData(o,"tag"),t=3==+val(ge(`privacy_video_view_${_}_input`)),l=domData(i,"href-tpl");t&&!d&&window.VideoUpload.updateUploadOptions(e);var r=rs(l,{video_id:a});t&&(r+=`?list=${d}`),val(i,r),i.removeAttribute("placeholder");var n=geByClass1("video_upload__copy_video_link",o);n.onclick=()=>{_videoplayer_lib_clipboard__WEBPACK_IMPORTED_MODULE_11__.default.copy(r),showDoneBox((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_12__.getLang)("video_upload_link_copied"),{out:1500}),i.focus()},isVisible(n)||show(n)}}}},47681:(e,o,i)=>{i.d(o,{VideoUploadSubtitles:()=>_});i(991181),i(940851),i(296253),i(59357);var a=i(705456),d=i(791563),_={init(e){var o=_[e];o.elems.tracksLangDropdown={},o.isEditing&&(o.subtitlesListAdd=[]);var i=!!o.options&&o.subtitlesList;if(isObject(i)&&!isEmpty(i)){for(var a in i)if(i.hasOwnProperty(a)){var d=i[a];d.key=a,this.initTrack(e,d)}}else this.initTrack(e);this.initDefaultDropdown(e)},initTrack(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=_[e].elems.blockEl,a=geByClass1("js-add-subtitles-track",i);this.initNewTrackEl(a,o)},initNewTrackEl(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=gpeByClass("js-video_upload",e),a=geByClass1("js-upload-subtitles-wrapper",i),d=geByClass1("js-subtitles-upload-item",a).cloneNode(!0),t=i.id.substr("video_upload_item_".length);domInsertBefore(d,e);var l=0;geByClass("js-subtitles-upload-item",i).forEach((e=>{isVisible(e)&&(l++,geByClass1("js-subtitles-label",e).innerHTML=getLang("video_upload_upload_subtitle_label").replace("{index}",l))})),l>=_[t].options.max_tracks_num&&hide(e),this.initLangDropdown(t,d,o);var r=geByClass1("js-subtitle-track-name",d),n=geByClass1("js-subtitle-upload-btn",d),s=geByClass1("js-subtitle-remove-file",d);if(o){var p=o.hasOwnProperty("params")?o.params.full_name:o.name;this.decorateLangName(r,p),n.removeAttribute("disabled"),hide(n),domData(d,"track-id",o.key)}else hide(s),hide(r)},initDefaultDropdown(e){var o,i=_[e],d=i.elems.blockEl,t=domByClass(d,"js-video_upload__upload_subtitles"),l=i.subtitlesDefault;o=0==l||-1==l?-1==l&&isObject(i.subtitlesList)?-1:-2:null!=l?i.subtitlesList[l].lang_id:-2;var r,n,s=this.getActualDefaultDropdownOptions(e),p=t.elements.subtitle_default;cur.is_showcase&&(r=(null===(n=document.querySelector(".VideoUploadItem__main"))||void 0===n?void 0:n.clientWidth)/2);i.elems.defaultLangDropdown=new Dropdown(p,s,{big:!0,width:r,selectedItems:o,onChange:()=>{this.updateDefaultLang(d)}});var u=i.elems.defaultLangDropdown.container;s.length>1?((0,a.enableEl)(u),removeClass(u,"disabled")):((0,a.disableEl)(u),addClass(u,"disabled"))},decorateLangName(e,o){o&&o.length>30&&(o=o.slice(0,27)+"…"+o.slice(-4)),val(e,o)},getCurrentAvailableLangs(e){var o=_[e],i=o.elems.blockEl,a=[];geByClass("js-subtitles-upload-item",i).forEach((e=>{if(isVisible(e)){var o=val(domQuery1('input[name="subtitle_lang"]',e));o&&a.push(o)}}));var d=[];return each(o.options.langs,((e,o)=>{inArray(e,a)||d.push([e,o])})),d},getActualDefaultDropdownOptions(e){var o=_[e],i=o.elems.blockEl,a=geByClass("js-subtitles-upload-item",i),d=[],t=[];return d.push([-2,getLang("video_upload_subtitles_default_off")]),a.forEach((e=>{if(isVisible(e)){var i=val(domQuery1('input[name="subtitle_lang"]',e)),a=domByClass(e,"js-subtitle-track-name");isVisible(a)&&t.push([i,o.options.langs[i]])}})),t.length&&(d.push([-1,getLang("video_upload_subtitles_default_user_lang")]),d.push(...t)),d},getActualSelectedLangIds(e){return this.getActualDefaultDropdownOptions(e).map((e=>e[0]))},initLangDropdown(e,o,i){var a,d,t=domQuery1('input[name="subtitle_lang"]',o),l=domByClass(o,"video_upload__subtitles_track_loading");(hide(l),cur.is_showcase)&&(a=(null===(d=document.querySelector(".VideoUploadItem__main"))||void 0===d?void 0:d.clientWidth)/2);var r=new Dropdown(t,this.getCurrentAvailableLangs(e),{autocomplete:!0,big:!0,width:a,placeholder:domData(t,"placeholder"),selectedItems:i?i.lang_id:"",onChange:o=>{var i=domData(r.container,"last-saved");if(i&&""===o)r.val(i);else if(""!==o){domData(r.container,"last-saved",o);var a=gpeByClass("js-subtitles-upload-item",r.container);n.removeAttribute("disabled"),this.updateAllLangDropdowns(e),o||attr(n,"disabled","disabled"),this.onUpdateLang(a)}}}),n=geByClass1("js-subtitle-upload-btn",o);this.initUploadButton(e,n),_[e].elems.tracksLangDropdown[r.guid]=r},initUploadButton(e,o){var i=_[e],t=i.elems.blockEl,l=gpeByClass("js-subtitles-upload-item",o),r=domByClass(l,"selector_container"),n=domByClass(l,"video_upload__upload_subtitles_input_container"),s=domByClass(l,"video_upload__subtitles_track_loading"),p=domByClass(l,"js-subtitle-track-name"),u=domByClass(l,"js-subtitle-remove-file"),v=i.options;o.onclick=()=>{domFC(n).click()};var c=null;Upload.init(n,"",{},{accept:".srt",chooseBox:!0,clear:!0,file_name:"file",file_size_limit:v.file_size_limit,file_types:"*.srt",lang:{filesize_error:getLang("video_upload_subtitles_size_error")},max_attempts:3,noCheck:!0,noFlash:!0,requestOptionsForFile:!0,type:"subtitles",withoutAutoUpload:!0,onFilesSelected:(d,t)=>{if(t.length){if(c=t[0],domData(l,"upload-index",d),hide(o),i.isEditing)return show(p),show(u),this.decorateLangName(p,c.name),this.updateDefaultLangDropdown(e),void i.subtitlesListAdd.push(l);show(s),(0,a.disableEl)(r),addClass(r,"disabled"),_.uploadTrack(l)}},onNoFilteredCallback:()=>{(0,a.notaBene)(r),(0,d.showFastBox)(getLang("global_error"),getLang("video_upload_subtitles_format_error"))},onUploadStart:(e,o)=>{hide(p),hide(u),show(s),(0,a.disableEl)(r),addClass(r,"disabled")},onUploadComplete:(i,d)=>{hide(s),show(p),(0,a.enableEl)(r),removeClass(r,"disabled"),this.decorateLangName(p,c.name),this.updateDefaultLangDropdown(e),hide(o),show(u);var _=window.parseJSON(d);each(_,((e,o)=>{geByClass("js-subtitles-upload-item",t).forEach((i=>{isVisible(i)&&(+val(domQuery1('input[name="subtitle_lang"]',i))==+o.lang_id&&domData(i,"track-id",e))}))})),this.updateDefaultLang(t),VideoUpload.updatePlayer(t)},onUploadError:(e,i)=>{hide(s),show(o),(0,a.enableEl)(r),removeClass(r,"disabled")}})},removeTrack(e){var o=gpeByClass("js-video_upload",e),i=gpeByClass("js-subtitles-upload-item",e),a=geByClass1("js-add-subtitles-track",o),d=geByClass1("js-subtitle-remove-file",i),t=o.id.substr("video_upload_item_".length);this.removeTrackFile(d),hide(i);var l=0;geByClass("js-subtitles-upload-item",o).forEach((e=>{isVisible(e)&&(l++,geByClass1("js-subtitles-label",e).innerHTML=getLang("video_upload_upload_subtitle_label").replace("{index}",l))})),l<_[t].options.max_tracks_num&&show(a)},removeTrackFile(e,o){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=gpeByClass("js-video_upload",e),d=gpeByClass("js-subtitles-upload-item",e),t=geByClass1("file",geByClass1("video_upload__upload_subtitles_input_container",d)),l=geByClass1("js-subtitle-upload-btn",d),r=geByClass1("video_upload__subtitles_track_loading",d),n=geByClass1("js-subtitle-track-name",d),s=a.id.substr("video_upload_item_".length),p=_[s];return(o=o||domData(d,"track-id"))===domData(d,"track-id")&&(val(t,""),hide(e),hide(n)),this.updateDefaultLangDropdown(s),p.isEditing&&!i?(show(l),domData(d,"track-id",""),void(o&&(p.subtitlesList[o].remove=e))):o?(o===domData(d,"track-id")&&(show(r),hide(l)),new Promise(((e,i)=>{ajax.post("video?act=edit_subtitles_track",{action:"remove",owner_id:p.ownerId,video_id:p.videoId,track_id:o,hash:p.editHash},{onDone:()=>(o===domData(d,"track-id")&&(hide(r),show(l),domData(d,"track-id","")),VideoUpload.updatePlayer(a),e()),onFail:e=>i(e)})}))):void 0},onUpdateLang(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=domData(e,"track-id"),a=gpeByClass("js-video_upload",e),d=a.id.substr("video_upload_item_".length),t=val(domQuery1('input[name="subtitle_lang"]',e)),l=_[d];if(this.updateDefaultLangDropdown(d),i){if(!l.isEditing||o){var r=geByClass1("video_upload__subtitles_track_loading",e),n=domByClass(e,"js-subtitle-remove-file"),s=geByClass1("js-subtitle-track-name",e);return hide(n),hide(s),show(r),new Promise(((e,o)=>{ajax.post("video?act=edit_subtitles_track",{action:"edit_lang",owner_id:l.ownerId,video_id:l.videoId,lang_id:t,track_id:i,hash:l.editHash},{onDone:()=>(hide(r),show(n),show(s),this.updateDefaultLang(a),VideoUpload.updatePlayer(a),e()),onFail:e=>o(e)})}))}l.subtitlesList[i].update=e}},onVideoUploaded(e,o){var i=_[e];i.videoId=o;var a=i.elems.blockEl;geByClass("js-subtitles-upload-item",a).forEach((e=>{_.uploadTrack(e)}))},saveEditedTracks(e,o){var i=_[e],a=i.elems.blockEl,d=[],t=i.subtitlesList;i.subtitlesListAdd.forEach((e=>{d.push((()=>_.uploadTrack(e)))}));var l=function(e){if(!t.hasOwnProperty(e))return"continue";var o=t[e];o.hasOwnProperty("remove")?d.push((()=>_.removeTrackFile(o.remove,e,!0))):o.hasOwnProperty("update")&&d.push((()=>_.onUpdateLang(o.update,!0)))};for(var r in t)l(r);d.reduce(((e,o)=>e.then(o)),Promise.resolve()).then((()=>{Promise.all(d).then((()=>{var e=_.updateDefaultLang(a,!0);e?e.then((()=>{i.tracksSaved=!0,o()})):(i.tracksSaved=!0,o())}))}))},updateAllLangDropdowns(e){var o=_[e];for(var i in o.elems.tracksLangDropdown){if(o.elems.tracksLangDropdown.hasOwnProperty(i))o.elems.tracksLangDropdown[i].setOptions({defaultItems:this.getCurrentAvailableLangs(e)})}},updateDefaultLang(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.id.substr("video_upload_item_".length),a=_[i];if(a.editHash){var d=null,t=a.elems.defaultLangDropdown.val(),l=a.elems.defaultLangDropdown.container;if(-1!=t&&-2!=t)geByClass("js-subtitles-upload-item",e).forEach((e=>{isVisible(e)&&(val(domQuery1('input[name="subtitle_lang"]',e))===t&&(d=domData(e,"track-id")))}));else d=-2==+t?0:-1;if((!a.isEditing||o)&&null!==d&&d!=domData(l,"last-saved"))return new Promise(((o,i)=>{ajax.post("video?act=edit_subtitles_track",{action:"set_default",owner_id:a.ownerId,video_id:a.videoId,track_id:d,hash:a.editHash},{onDone:()=>(domData(l,"last-saved",d),VideoUpload.updatePlayer(e),o()),onFail:e=>i(e)})}))}},updateDefaultLangDropdown(e){var o=_[e],i=o.elems.blockEl,d=o.elems.defaultLangDropdown,t=d.container,l=d.val(),r=this.getActualDefaultDropdownOptions(e);if(d.setOptions({defaultItems:r}),!inArray(l,this.getActualSelectedLangIds(e))){var n=o.subtitlesDefault,s=domQuery1(`.js-subtitles-upload-item[data-track-id="${n}"]`),p=geByClass1("js-subtitle-remove-file",s);s&&isVisible(p)?d.val(val(domQuery1('input[name="subtitle_lang"]',s))):d.val(-2)}r.length>1?((0,a.enableEl)(t),removeClass(t,"disabled")):((0,a.disableEl)(t),addClass(t,"disabled")),this.updateDefaultLang(i)},uploadTrack(e){var o=gpeByClass("js-video_upload",e).id.substr("video_upload_item_".length),i=_[o],a=i.ownerId,d=i.videoId;if(d){var t=geByClass1("file",geByClass1("video_upload__upload_subtitles_input_container",e));if(t){var l=domData(e,"upload-index"),r=val(domQuery1('input[name="subtitle_lang"]',e)),n=t.files;if(n.length)return new Promise(((e,i)=>{ajax.post("al_video.php?act=get_subtitles_upload_params",{oid:a,vid:d},{onDone:i=>{_[o].editHash=i.edit_hash,i.vars.langId=r,i.vars.name=n[0].name,extend(Upload.options[l],i.options),extend(Upload.vars[l],i.vars),Upload.uploadUrls[l]=i.options.url;var a=Upload.options[l].onUploadComplete;Upload.options[l].onUploadComplete=(o,i)=>(a(o,i),e()),Upload.onFileApiSend(l,n,!0)},onFail:e=>(Upload.terminateUpload(l,n[0].name),i(e))})}))}}}}},571399:(e,o,i)=>{i.d(o,{VIDEO_UPLOAD_EXTS:()=>a,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>d,VIDEO_UPLOAD_CHUNK_SIZE:()=>_});i(751876);var a="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),d=5,_=4194304},265848:(e,o,i)=>{i.d(o,{default:()=>a});const a={get supported(){return!!document.queryCommandSupported&&document.queryCommandSupported("copy")},copy(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.utilsNode,i=!1,a=ce("textarea",{value:e},{position:"absolute",top:-9999,zIndex:2});o.appendChild(a),browser.msie?a.setSelectionRange(0,e.length):a.select();try{i=document.execCommand("copy")}catch(e){i=!1}return re(a),i}}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(e){var o=__webpack_module_cache__[e];if(void 0!==o)return o.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,o,i,a)=>{if(!o){var d=1/0;for(r=0;r<deferred.length;r++){for(var[o,i,a]=deferred[r],_=!0,t=0;t<o.length;t++)(!1&a||d>=a)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](o[t])))?o.splice(t--,1):(_=!1,a<d&&(d=a));if(_){deferred.splice(r--,1);var l=i();void 0!==l&&(e=l)}}return e}a=a||0;for(var r=deferred.length;r>0&&deferred[r-1][2]>a;r--)deferred[r]=deferred[r-1];deferred[r]=[o,i,a]},__webpack_require__.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(o,{a:o}),o},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var a={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var d=2&o&&e;"object"==typeof d&&!~leafPrototypes.indexOf(d);d=getProto(d))Object.getOwnPropertyNames(d).forEach((o=>a[o]=()=>e[o]));return a.default=()=>e,__webpack_require__.d(i,a),i},__webpack_require__.d=(e,o)=>{for(var i in o)__webpack_require__.o(o,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:o[i]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={4942:0};__webpack_require__.O.j=o=>0===e[o];var o=(o,i)=>{var a,d,[_,t,l]=i,r=0;for(a in t)__webpack_require__.o(t,a)&&(__webpack_require__.m[a]=t[a]);if(l)var n=l(__webpack_require__);for(o&&o(i);r<_.length;r++)d=_[r],__webpack_require__.o(e,d)&&e[d]&&e[d][0](),e[_[r]]=0;return __webpack_require__.O(n)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(o.bind(null,0)),i.push=o.bind(null,i.push.bind(i))})();var __webpack_exports__=__webpack_require__.O(void 0,[8592],(()=>__webpack_require__(684112)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();