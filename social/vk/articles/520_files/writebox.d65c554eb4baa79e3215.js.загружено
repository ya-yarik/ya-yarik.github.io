(()=>{"use strict";var e,r,t,o={590111:(e,r,t)=>{t.d(r,{WriteBox:()=>u});t(175115),t(59357);var o=t(573084),a=t(283778),i=t(705456),n=t(791563),c=t(313020);function m(){return(m=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var l="market_item",d="market_item_service",u={mrg:function(e){return vk.rtl?{marginRight:e}:{marginLeft:e}},show:function(e,r){var t=r.toData[0],a=r.toData[7];if(e.setOptions({hideButtons:!0,width:502,bodyStyle:"padding: 0px; border: 0px;",title:r.title,titleControls:('<a class="mail_box_header_link" href="/im?sel='+t+'" onclick="return WriteBox.toFull(event, '+t+')">'+r.mail_go_to_dialog+"</a>").replace("%s",a)}),e.removeButtons(),cur.lang=extend(cur.lang||{},r.lang),extend(cur,{mbTxtInp:{},mbEditable:r.editable,mbSmile:ge("mbe_smile"),toData:r.toData,mbEmoji:r.emoji,mbMedia:null,mbField:ge(r.editable?"mail_box_editable":"mail_box_text"),mbAva:ge("mail_box_ava"),mbMediaTypes:r.mediaTypes,mbTo:r.toData,mbHash:r.hash,mbBannedHim:r.bannedhim,mbExtraSendParams:r.extraSendParams,ldb:(0,o.mount)(vk.id)}),r.emojiRcnt&&!cur.mbRcntEmoji){for(var c=[],m=r.emojiRcnt,s=0,b=m.length;s<b;++s){var f=m[s];f&&c.push('<a id="mbe_rc_em_'+f+'" class="mbe_rc_emojibtn" onmousedown="Emoji.addEmoji(cur.emojiWId, \''+f+"', this); return cancelEvent(event);\">"+Emoji.getEmojiHTML(f,!1,!0)+"</a>")}cur.mbRcntEmoji=c.join("")}cur.nav.push((()=>{cur.ldb.unmount()})),val("mbe_rcemoji",cur.mbRcntEmoji||""),cur.peer=u.getPeer(),cur.sharedImWrite={},cur.emojiWId=Emoji.init(cur.mbField,{ttDiff:1,controlsCont:ge("mbe_emoji_wrap"),shouldFocus:!0,onSend:u.send,rPointer:!0,noEnterSend:1,ref:"writebox",noStickers:!!r.checkedRecipent,forceTxt:!r.editable,sharedTT:cur.sharedImWrite,txt:ge("mail_box_editable"),checkEditable:u.checkEditable,saveDraft:u.saveDraft,rceCont:ge("mbe_rcemoji_cont"),addMediaBtn:ge("mail_box_add_row"),sendWrap:ge("mail_box_controls"),onKeyAction:function(e){clearTimeout(cur.saveWriteBoxDraft);var r="paste"==e.type?0:300;cur.saveWriteBoxDraft=setTimeout(u.saveDraft,r)},onStickerSend:function(e,r){var t=trim(Emoji.editableVal(cur.mbField)),o=cur.mbMedia.getMedias(),a=cur.toData[0];ajax.post("/al_im.php",{act:"a_send_box",to_ids:a,chas:cur.mbHash,msg:"",ts:cur.ts,media:"sticker:"+e,send_sticker:1,from:"box",sticker_referrer:r,entrypoint:"friends"===cur.module?"friends":"writebox"},{onDone:function(e,r){t||o.length?u.send(!1):(r&&ls.set("im_draft"+vk.id+"_"+r,!1),curBox().hide(),showDoneBox(e))},showProgress:i.lockButton.pbind("mail_box_send"),hideProgress:i.unlockButton.pbind("mail_box_send"),onFail:function(e){var r=(0,n.showFastBox)(getLang("global_error"),e).hide;return setTimeout(r,3e3),!0}})},onRecentEmojiUpdate:function(){u.extractEmoji()}}),Emoji.emojiLoadMore(cur.emojiWId),cur.mbTo[0]?cur.mbHidden=!1:cur.mbHidden=!0,cur.imwEmoji=-1;var h=cur.postTo;cur.postTo=!1,e.setOptions({onHide:function(){removeEvent(document,"keydown",u.onKey),cur.mbEmojiShown&&Emoji.ttClick(cur.emojiWId,cur.mbSmile,!0),cur.mbOnMouseClick&&(cur.onMouseClick=cur.mbOnMouseClick,cur.mbOnMouseClick=!1),browser.mozilla},onShow:function(){addEvent(document,"keydown",u.onKey),cur.mbOnMouseClick||(cur.mbOnMouseClick=cur.onMouseClick),browser.mozilla,cur.sorterClbk&&(cur.sorterClbk(),delete cur.sorterClbk)},onClean:function(){clearTimeout(cur.mbSaveDraftTO),delete cur.mbSaveDraftTO,delete cur.mbField,cur.postTo=h,cur.mbEmojiScroll=cur.mbEmojiExpanded=!1,cur.mbForceAttach=!1,window.WideDropdown&&WideDropdown.deinit("mail_box_dd")}}),addEvent(document,"keydown",u.onKey),cur.mbOnMouseClick||(cur.mbOnMouseClick=cur.onMouseClick),stManager.add(["page.js","page.css"],(function(){var r={mail:1,nocl:1,editable:1,sortable:1,teWidth:150,teHeight:100,toggleLnk:!0,from:"message"};if(cur.mbForceAttach){var t=cur.mbForceAttach[0];t!==l&&t!==d||(r.onMediaAdd=function(){for(var e in cur.mbMedia.chosenMedias)if("market"==cur.mbMedia.chosenMedias[e][0]){var r=cur.mbMedia.chosenMedias[e][2];hide(geByClass1("page_media_x_wrap",r))}})}cur.mbMedia=new MediaSelector("mail_box_add_link","mail_box_added_row",cur.mbMediaTypes,r),cur.mbMedia.onChange=function(){e.changed=!0,setTimeout((function(){u.saveDraft()}),100)},ls.checkVersion()&&cur.mbTo[0]&&u.restoreDraft(cur.mbTo[0])}))},getPeer:function(){return intval(cur.toData[0])},restoreDraft:function(e){var r=u.getPeer();if(!(!r||e&&r!=intval(e)||browser.mobile)&&cur.mbMedia){var t=(0,a.loadDraftForPeer)(cur.ldb,r);if(cur.mbForceAttach){var o=cur.mbForceAttach[0],i=o===d;if(o===l||i){var n="mail_market_tmpl";i&&(n="mail_market_services_tmpl"),t.setText(unclean(getLang(n)).replace(/<br>/g,"\n")),t.removeAllAttaches(),t.addAttach("market",cur.mbForceAttach[1])}else if("market_order"==cur.mbForceAttach[0]){var c=cur.mbForceAttach[1];t.setText(unclean(getLang("mail_order_tmpl")).replace(/<br>/g,"\n").replace("{id}",`${c}`)),t.removeAllAttaches()}else cur.mbForceAttach[3]&&t.setText(unclean(getLang(cur.mbForceAttach[3])).replace(/<br>/g,"\n").replace("{username}",cur.toData[9]).replace("{chatname}",unclean(cur.mbForceAttach[4]||"")))}u.editableHasVal(cur.mbField)||(cur.mbEditable?(Emoji.val(cur.mbField,clean(t.dData.txt)),window.Emoji&&Emoji.editableFocus(cur.mbField,!1,!0)):val(cur.mbField,clean(t.dData.txt))),t.prepareObjects().then((()=>{if(cur.mbField&&u.getPeer()==r)for(var e=t.dData.attaches,o=0;o<e.length;o++)cur.mbMedia.chooseMedia(e[o].type,e[o].id,e[o].object||{},null,!0)})),u.checkEditable(cur.emojiWId,cur.mbField),u.checkLen(cur.mbField)}},saveDraft:function(){var e=u.getPeer();if(e&&cur.mbField){var r=(0,a.loadDraftForPeer)(cur.ldb,e);r.setText(unclean(trim(Emoji.val(cur.mbField)))),r.removeAllAttaches(),cur.mbMedia.getMedias().forEach((e=>r.addAttach(e[0],e[1]))),r.destroy()}},toFull:function(e,r){if(!checkEvent(e)){var t={0:"im",sel:r},o=trim(Emoji.editableVal(cur.mbField));if(o&&(t.message=o),cur.mbMedia.chosenMedias){for(var a=cur.mbMedia.getMedias(),i=[],n=0,c=a.length;n<c;++n){var m=a[n],l=[];for(var d in m)"object"!=typeof m[d]&&l.push(m[d]);i.push(l.join(","))}t.media=i.join("*")}return nav.go(t,null,{noback:!0}),!1}},send:function(e){if(!(0,i.isButtonLocked)("mail_box_send")){var r=trim(Emoji.editableVal(cur.mbField)),t=cur.mbMedia.getMedias();cur.mbEditable&&u.extractEmoji();var o=m({act:"a_send_box",chas:cur.mbHash,message:r,title:isVisible("mail_box_title_wrap")&&val("mail_box_title")||"",from:"box",entrypoint:"friends"===cur.module?"friends":"writebox",media:[],to_ids:[]},cur.mbExtraSendParams?cur.mbExtraSendParams:{});cur.mbForceAttach&&(o.attach1_type=cur.mbForceAttach[0],o.attach1=cur.mbForceAttach[1],o.attach1_hash=cur.mbForceAttach[2]);for(var n,c=0,l=t.length;c<l;++c)(n=t[c])&&o.media.push(n[0]+":"+n[1]);if(o.media=o.media.join(","),!r&&!o.media)return cur.mbEditable?Emoji.editableFocus(cur.mbField):elfocus(cur.mbField);o.to_ids=cur.toData[0],cur.mbBannedHim!=o.to_ids||!0===e?ajax.post("al_im.php",o,{onDone:function(e,r){if(r){var t=(0,a.loadDraftForPeer)(cur.ldb,r);t.clear(),t.destroy()}curBox().hide(),showDoneBox(e)},showProgress:i.lockButton.pbind("mail_box_send"),hideProgress:i.unlockButton.pbind("mail_box_send")}):showBox("al_profile.php",{act:"banned_him",action:"mail",mid:cur.mbBannedHim},{dark:1}).onContinue=u.send.pbind(!0)}},checkLen:function(e){cur.mbTxtInp.value=Emoji.editableVal(e),checkTextLength(4096,cur.mbTxtInp,"mail_box_warn"),toggle("mail_box_title_wrap",cur.mbTxtInp.lastLen>200)},codeToChr:function(e){for(var r=e.length/4,t="",o=0;r--;)t+=String.fromCharCode(parseInt(e.substr(o,4),16)),o+=4;return t},editableHasVal:function(e){return!!e&&("TEXTAREA"==e.tagName?!!val(e):!(!geByTag1("IMG",e)&&!stripHTML(val(e)).replace(/[\s\xa0]/g,"").length))},checkEditable:function(e,r){cur.mbEditable&&Emoji.checkEditable(e,r,{height:180})},cssAnimation:function(){var e=intval(browser.version);return!!(browser.chrome&&e>14||browser.mozilla&&e>13||browser.opera&&e>2)},onKey:function(e){var r="INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName||"mail_box_editable"==e.target.id;if(!(0,c.isInputActive)()){if(e.keyCode>40&&!e.ctrlKey&&!e.metaKey&&!r)if(cur.mbEditable)Emoji.editableFocus(cur.mbField,!1,!0);else{var t=cur.mbField;!t.active&&elfocus(t)}return!0}},extractEmoji:function(){var e=ge("mbe_rcemoji");if(e){var r="",t=Emoji.getRecentEmojiSorted().slice(0,7);for(var o in t)if(t.hasOwnProperty(o)){var a=t[o];r+='<a id="mbe_rc_em_'+a+'" class="mbe_rc_emojibtn" onmousedown="Emoji.addEmoji(cur.emojiWId, \''+a+"', this); return cancelEvent(event);\">"+Emoji.getEmojiHTML(a,!1,!0)+"</a>"}val(e,r)}}}},283882:(e,r,t)=>{var o=t(590111);window.WriteBox=o.WriteBox;try{window.stManager.done(window.jsc("web/writebox.js"))}catch(e){}}},a={};function i(e){var r=a[e];if(void 0!==r)return r.exports;var t=a[e]={exports:{}};return o[e].call(t.exports,t,t.exports,i),t.exports}i.m=o,e=[],i.O=(r,t,o,a)=>{if(!t){var n=1/0;for(d=0;d<e.length;d++){for(var[t,o,a]=e[d],c=!0,m=0;m<t.length;m++)(!1&a||n>=a)&&Object.keys(i.O).every((e=>i.O[e](t[m])))?t.splice(m--,1):(c=!1,a<n&&(n=a));if(c){e.splice(d--,1);var l=o();void 0!==l&&(r=l)}}return r}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[t,o,a]},i.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return i.d(r,{a:r}),r},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var a=Object.create(null);i.r(a);var n={};r=r||[null,t({}),t([]),t(t)];for(var c=2&o&&e;"object"==typeof c&&!~r.indexOf(c);c=t(c))Object.getOwnPropertyNames(c).forEach((r=>n[r]=()=>e[r]));return n.default=()=>e,i.d(a,n),a},i.d=(e,r)=>{for(var t in r)i.o(r,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},i.e=()=>Promise.resolve(),i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={1934:0};i.O.j=r=>0===e[r];var r=(r,t)=>{var o,a,[n,c,m]=t,l=0;for(o in c)i.o(c,o)&&(i.m[o]=c[o]);if(m)var d=m(i);for(r&&r(t);l<n.length;l++)a=n[l],i.o(e,a)&&e[a]&&e[a][0](),e[n[l]]=0;return i.O(d)},t=self.webpackChunkvk=self.webpackChunkvk||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var n=i.O(void 0,[8592,4509,9429],(()=>i(283882)));n=i.O(n)})();