!function(e){function t(t){for(var o,a,l=t[0],r=t[1],n=t[2],u=0,c=[];u<l.length;u++)a=l[u],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&c.push(s[a][0]),s[a]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);for(d&&d(t);c.length;)c.shift()();return _.push.apply(_,n||[]),i()}function i(){for(var e,t=0;t<_.length;t++){for(var i=_[t],o=!0,l=1;l<i.length;l++){var r=i[l];0!==s[r]&&(o=!1)}o&&(_.splice(t--,1),e=a(a.s=i[0]))}return e}var o={},s={"web/audio":0},_=[];function a(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=o,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(i,o,function(t){return e[t]}.bind(null,o));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/cmodules/";var l=window.webpackJsonp=window.webpackJsonp||[],r=l.push.bind(l);l.push=t,l=l.slice();for(var n=0;n<l.length;n++)t(l[n]);var d=r;_.push([112,"bundles/audioplayer","bundles/common","bundles/4060411aa2c063eade7896c7daf24353"]),i()}({"/rxS":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"currentAudioPage",(function(){return currentAudioPage})),__webpack_require__.d(__webpack_exports__,"AudioPage",(function(){return AudioPage}));var core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("Oyvg"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("rGqo"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("Btvt"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("Vd3H"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("OG14"),_lib_stats__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("XzvV"),_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("rEJs"),_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("6ng+"),_web_audio_player_stat_onAdditionalEvent__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("5xrp"),_web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("ldAL"),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("W9Tc"),_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("D33C"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("jE6c"),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("59zB"),_web_legacy_ui_slider__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("gUSy"),_web_lib_feature_boxes__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("Ieup"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("zxIV"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("EasH"),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("RdBX"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("aong"),_web_grid_sorted__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("4PuL"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("v+DW"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("4+be"),_web_lib_feature_tooltips__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("MiCK"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("FWc3"),_web_audio_catalog_SectionController__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("oy9g"),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("pp2G"),_shared_audio_enums__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("uk5P"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("t7n3"),SLIDER_TIMEOUT=1e4,sectionsToUpdate=[];function currentAudioPage(e){var t=gpeByClass("_audio_page_layout",e);return!!t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(t,"audioPage")}function AudioPage(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(e,"audioPage",this),extend(cur.lang||{},t.langs),getAudioPlayer().langs=t.langs,this._data=t,this._ownerId=t.ownerId,this.isLayer()||(cur.audioPage=this),this.isLayer()&&uiSearch.init("audio_search_layer"),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.toggleAudioHQBodyClass(),this._els={pageContainer:e,sections:geByClass1("_audio_page_sections",e),playerWrap:geByClass1("_audio_page_player_wrap",e),player:geByClass1("_audio_page_player",e),contentBlock:geByClass1("_audio_page_content_block",e)||geByClass1("_playlist_page_content_block",e),scrollWrap:geByClass1("_audio_page_content_block_wrap",e),searchSectionAudios:geByClass1("_audio_section_search__local_audios_list",e),searchSectionAudiosHeader:geByClass1("audio_section_search__local_audios_header",e),searchSectionPlaylists:geByClass1("_audio_section_search__local_playlists_list",e),searchSectionPlaylistsHeader:geByClass1("_audio_section_search__local_playlists_header",e),searchNoLocalResults:geByClass1("_audio_local_no_results",e),searchGlobalBlocks:geByClass1("_audio_section_global_search__blocks",e),searchGlobalCommunitiesPlace:geByClass1("_audio_section_global_search__communities_place",e),searchGlobalPlaylistsPlace:geByClass1("_audio_section_global_search__playlists_place",e),searchGlobalArtistsPlace:geByClass1("_audio_section_global_search__artists_place",e),searchGlobalAudiosBlock:geByClass1("_audio_section_global_search__audios_block",e),searchGlobalAudiosBlockHeader:geByClass1("_audio_section_global_search__audios_header",e),searchGlobalAudiosList:geByClass1("_audio_section_global_search__audios_list",e),searchInput:geByClass1("ui_search_field",geByClass1("_audio_search",e)),footer:geByClass1("_audio_page__footer",e),footerNowPlayingInfo:geByClass1("_audio_page__footer_now_playing",e),footerClearNowPlayingButton:geByClass1("_audio_page__footer_clear_playlist",e)},this.isLayer()&&(this._scroll=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_15__.default(this._els.scrollWrap,{global:!0,stopScrollPropagation:!0,stopScrollPropagationAlways:!0})),this._readyAudio=this._data.readyAudio;var i=this._data.readyPlaylist;i&&(this._pagePlaylist=getAudioPlayer().getPlaylist(i.type,i.ownerId,i.id),this._pagePlaylist.mergeWith(i)),!this._readyAudio&&this._pagePlaylist&&(this._readyAudio=this._pagePlaylist.getAudioAt(0)),this._data.playlistCoverUploadOptions&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[this._ownerId]=this._data.playlistCoverUploadOptions),this.isLayer()||(cur.module=t.module||"audio",cur.oid=this._ownerId,+this._ownerId==+vk.id?cur.submodule="my":this._ownerId<0?cur.submodule="group_list":cur.submodule="user_list"),vk.id&&(this._initPlayer(),this.showPromoBox()),this._initPlaylists(),this.initNavigation(),this.showSection(t.initSection),this.defaultSection=!location.search&&t.initSection||"all",this._initSearchParams(),this.promoAlbumSlideInit(),this._els.searchInput&&this._els.searchInput.focus(),this.isLayer()||this.isPodcastPage()||!nav.objLoc.q||"search_playlists"===nav.objLoc.section||(this._els.searchInput&&(this._els.searchInput.value=winToUtf(nav.objLoc.q)),this._showSearchSection(nav.objLoc)),this.updateCurrentPlayingInfo(),getAudioPlayer().setStatusExportInfo(this._data.export),this.updateStatusExportControls(),this._initKeyEvents(),window.onAudioPageLoaded&&(window.onAudioPageLoaded.call(this),delete window.onAudioPageLoaded),this.updateShuffleButton()}AudioPage.address="audio",AudioPage.updateSearchHighlight=function(e){var t=geByClass1("_audio_playlist",gpeByClass("_audio_layout",this));toggleClass(t,"audio_search_focused","focus"===e.type)},AudioPage.onSearchFocused=function(e){AudioPage.updateSearchHighlight(e)},AudioPage.prototype.updatePlaylistsCounter=function(e){var t;if(cur.audioPage&&e===cur.audioPage.getOwnerId()&&(t=Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")?cur.audioPage._els.pageContainer.querySelector(".CatalogBlock__own_only_playlists_header .CatalogBlock__title"):geByClass1("_audio_page__playlists_count_header",cur.audioPage._els.pageContainer))){var i=cur.audioPage._data.playlists.length;t.innerHTML=langNumeric(i,cur.lang.audio_playlists_count_title),toggleClass(gpeByClass("_audio_page_section_layout",t),"audio_section_empty",!i)}},AudioPage.deletePlaylist=function(e,t,i){var o=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,e,t),s=AudioPlayer.getLang("audio_sure_delete_playlist_box_text");s='<div style="overflow: hidden; text-overflow: ellipsis;">'+(s=s.replace("{name}",o.getTitle()))+"</div>",Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__.showFastBox)({title:AudioPlayer.getLang("audio_sure_delete_playlist_box_title"),dark:1},s,AudioPlayer.getLang("audio_sure_delete_playlist_box_yes"),function(){if(ajax.post("al_audio.php?act=delete_playlist",{hash:i,playlist_owner_id:e,playlist_id:t,page_owner_id:cur.audioPage?cur.audioPage.getOwnerId():0},{onDone:function(e){if(cur.audioPage){var t=geByClass1("_audio_section__all",cur.audioPage.getPageContainer()),i=geByClass1("_audio_page_block__playlists_items",t);if(t&&i){var o=intval(domData(i,"max-items"));e&&i.children.length<o&&i.appendChild(se(getTemplate("audio_pl_item",e))),i.children.length||(addClass(gpeByClass("_audio_page_section_layout",i),"no_playlists"),re(gpeByClass("_audio_page_titled_block",i)))}}},onFail:()=>!0}),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide(),each(geByClass("_audio_pl_"+e+"_"+t),(function(){re(this)})),cur.audioPage){if(cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((function(i){return!(i.id==t&&i.owner_id==e)})),Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")&&!cur.audioPage._data.playlists.length)return void nav.reload();cur.audioPage.updatePlaylistsCounter&&cur.audioPage.updatePlaylistsCounter(e)}}.bind(this),getLang("global_cancel"))},AudioPage.prototype.getCurrentSection=function(){return this._currentSection},AudioPage.prototype._initPlaylists=function(e){if(this._data.generic)return e&&e([]);AudioPage.loadPlaylists(this.getOwnerId(),this._data.playlistsTotal,!0,!1,function(t){this._data.playlists=this._data.playlists.concat(t),this._data.playlistsIndex=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_20__.vkIndexer(this._data.playlists,(function(e){return e.title})),e&&e()}.bind(this))},AudioPage.prototype.getOwnerPlaylists=function(){return this._data.playlists},AudioPage.loadPlaylists=function(ownerId,totalCount,skipFirstChunk,forAttachBox,onDone){var chunkSize=50,chunks=[];Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_14__.isFunction)(totalCount)&&(onDone=totalCount,totalCount=void 0,skipFirstChunk=!1),cur.playlistsCache=cur.playlistsCache||{};var cacheKey=ownerId+"_"+intval(skipFirstChunk);if(cur.playlistsCache[cacheKey])return onDone(cur.playlistsCache[cacheKey]);function onAllLoaded(){var e=[];each(chunks,(function(t,i){i&&(e=e.concat(i))})),cur.playlistsCache[cacheKey]=e,onDone&&onDone(e)}function _loadChunk(chunkIndex,_cb){var groupId=cur.group_id||(cur.oid<0?-cur.oid:0);ajax.post("al_audio.php?act=owner_playlists",{owner_id:ownerId,group_id:groupId,offset:chunkIndex*chunkSize,is_attach:forAttachBox?1:0},{onDone:function onDone(playlists,totalCount,additionalData){additionalData.templates_script&&eval(additionalData.templates_script),additionalData.langs&&extend(cur.lang,additionalData.langs),additionalData.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[ownerId]=additionalData.audio_playlist_cover_upload_options),chunks[chunkIndex]=playlists,_cb(totalCount)},onFail:function(e){if(hide(boxLoader),e)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__.showFastBox)({title:getLang("global_error")},e),!0}})}function _loadAllChunks(e,t,i){var o=Math.ceil(e/chunkSize);o&&o-t!=0?function(){for(var e=new callHub(i,o-t),s=t;s<o;s++)_loadChunk(s,(function(){e.done()}))}():i()}isUndefined(totalCount)?_loadChunk(0,(function(e){_loadAllChunks(e,1,onAllLoaded)})):_loadAllChunks(totalCount,skipFirstChunk?1:0,onAllLoaded)},AudioPage.prototype.getOwnerId=function(){return+this._ownerId},AudioPage.prototype.getPageContainer=function(){return this._els.pageContainer},AudioPage.prototype.canAddToGroup=function(){return this._data.canAudioAddToGroup},AudioPage.prototype.canEditGroup=function(){return this._data.canEdit},AudioPage.prototype.updateCurrentPlayingInfo=function(){if(this.isLayer()){var e=getAudioPlayer(),t=e.getCurrentPlaylist(),i=t?t.getTitle():"";if(t&&window.langConfig&&window.langConfig.id!==t.getTitleLang()&&ajax.post("al_audio.php?act=get_playlist_info",{owner_id:t.getOwnerId(),playlist_id:t.getAlbumId(),access_hash:t.getAccessHash()},{onDone:i=>{t.updatePlaylist(i)&&(e.saveStateCurrentPlaylist(),this.updateCurrentPlayingInfo())},onFail:()=>{}}),i){var o,s,_,a=t.getOriginalPlaylistRawId();if(a||t.getType()===_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST&&t.getAlbumId()>0)a?(o=(a=a.split("_"))[0],s=a[1],_=a[2]||""):(o=t.getOwnerId(),s=t.getAlbumId(),_=t.getAccessHash()||""),i=`<a href="${nav.toStr(extend({},nav.objLoc,{z:"audio_playlist"+o+"_"+s+(_?"/"+_:"")}))}"\n                  class="audio_page__footer_now_playing_link"\n                  onclick="if (checkEvent(event)) { return true } else { AudioUtils.showAudioPlaylist(${o}, ${s}, '${_}'); return cancelEvent(event) }">\n                  ${i}\n                </a>`;else if(t.getBlockId()){i=`<a href="${"/audio?section=recoms_block&type="+t.getBlockId()}"\n                  class="audio_page__footer_now_playing_link">\n                  ${i}\n                </a>`}this._els.footerNowPlayingInfo.innerHTML=getLang("audio_current_playing_from").replace("{playlist}",i)}else{var l=getAudioPlayer().getCurrentAudio();_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(l)?this._els.footerNowPlayingInfo.innerHTML=getLang("audio_current_playing_from").replace("{playlist}",getLang("audio_podcast_playing").replace("{name}",l[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER])):this._els.footerNowPlayingInfo.innerHTML=""}this._els.footerClearNowPlayingButton.innerHTML=getLang("audio_clear_current_playlist"),toggle(this._els.footer,!!t)}},AudioPage.prototype.onSearchFiltersChanged=function(e){var t=window.radioBtns["audio_search_type_"+intval(this.isLayer())],i=intval(this._searchSortFilter.selectedItems()[0][0]),o={performer:t.val?1:null,lyrics:hasClass(geByClass1("_audio_fltr_with_lyrics",this._els.pageContainer),"on")?1:null,sort:i?1:null};this.syncParametersUI(o);var s=e&&isObject(e)?e:o;this.isLayer()&&(s=extend({},this._prevLoc,s)),nav.change(s,!1,{fromSearch:!0,filtersChanged:!0})},AudioPage.prototype._initSearchParams=function(){window.radioBtns["audio_search_type_"+intval(this.isLayer())]={els:geByClass("_audio_search_type",this._els.pageContainer),keep:this.isLayer()};var e=geByClass1("_audio_fltr_sort",this._els.pageContainer);e&&(this._searchSortFilter=new Dropdown(e,this._data.sortFilters,{big:1,zeroPlaceholder:!0,onChange:this.onSearchFiltersChanged.bind(this)})),this.isLayer()||this.syncParametersUI(nav.objLoc)},AudioPage.prototype.syncParametersUI=function(e){var t="audio_search_type_"+intval(this.isLayer()),i=window.radioBtns[t];i&&radiobtn(i.els[e.performer?1:0],!!e.performer,t);var o=geByClass1("_audio_fltr_with_lyrics",this._els.pageContainer);toggleClass(o,"on",!!e.lyrics);var s={performer:AudioPlayer.getLang("audio_performers_only"),lyrics:AudioPlayer.getLang("audio_search_with_text"),sort:AudioPlayer.getLang("audio_search_by_length")},_=this._els.searchInput;each(["performer","lyrics","sort"],(function(t,i){uiSearch.toggleFilter(_,i,s[i],!!e[i])}))},AudioPage.onFilterRemoved=function(e,t,i){var o=currentAudioPage(t);(function(){switch(e){case"performer":var t="audio_search_type_"+intval(this.isLayer()),o=window.radioBtns[t];radiobtn(o.els[0],0,t);break;case"sort":var s=this._searchSortFilter.options.defaultItems[0][0];this._searchSortFilter.selectItem(s,!1);break;case"lyrics":removeClass(geByClass1("_audio_fltr_with_lyrics",this._els.pageContainer),"on")}i||this.onSearchFiltersChanged()}).apply(o)},AudioPage.prototype._showSearchSection=function(e){this._toggleSearchProgress(!0);var t=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,this.getOwnerId(),_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID);if(geByClass1("audio_page_player2")){var i=e.globalQuery||e.q;this._sectionData={q:i,performer:e.performer},this.showSection("search",function(){if(i){var e=this._data.sectionData.search?this._data.sectionData.search.qid:0;Object(_lib_stats__WEBPACK_IMPORTED_MODULE_7__.saveSearchAttemptStats)(_lib_stats__WEBPACK_IMPORTED_MODULE_7__.serviceAudio,0,!isVisible(this._els.searchNoLocalResults),i,e)}this._toggleSearchProgress(!1)}.bind(this))}else t.loadAll(function(){this._toggleSearchProgress(!1),this._doShowSearchSection(e)}.bind(this))},AudioPage.prototype._toggleSearchProgress=function(e){this._els.searchInput&&!this._muteSearch&&(e?uiSearch.showProgress(this._els.searchInput):uiSearch.hideProgress(this._els.searchInput))},AudioPage.prototype._doShowSearchSection=function(e){var t=getAudioPlayer();if(e&&(this._prevSearchParams=e),e=e||this._prevSearchParams){var i=replaceEntities(e.q)+replaceEntities(e.globalQuery||"");each(["performer","lyrics","sort"],(function(t,o){i+=e[o]||0})),i+=this._ownerId,this._toggleSearchProgress(!0);var o=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,this._ownerId,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID);o.loadAll(function(){clearTimeout(this._onSilendLoadedTO),this._onSilendLoadedTO=setTimeout(function(){s.call(this)}.bind(this))}.bind(this))}function s(){o.search(e,function(o){var s="";this._searchAudiosAutoList&&(this._els.searchSectionAudios.innerHTML="",this._searchAudiosAutoList.destroy());var _=this._data.playlistsIndex?this._data.playlistsIndex.search(e.q):[];if(this.showSection("search"),_.length){var a="";each(_,(function(e,t){a+=getTemplate("audio_pl_item",t)})),show(this._els.searchSectionPlaylistsHeader),show(this._els.searchSectionPlaylists),s=+this._ownerId===vk.id?t.langs.audio_found_your_local_playlists:this._ownerId>0?t.langs.audio_found_user_local_playlists:t.langs.audio_found_group_local_playlists,this._els.searchSectionPlaylistsHeader.innerHTML=langNumeric(_.length,s),this._els.searchSectionPlaylists.innerHTML=a}else hide(this._els.searchSectionPlaylistsHeader),hide(this._els.searchSectionPlaylists);var l=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_SEARCH,vk.id,Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.hashCode)(i));l.mergeWith({list:o,searchParams:{globalQuery:e.globalQuery||e.q,performer:e.performer,lyrics:e.lyrics,sort:e.sort}}),l.setLocalFoundCount(o.length),o.length||_.length?hide(this._els.searchNoLocalResults):(show(this._els.searchNoLocalResults),s=vk.id===+this._ownerId?t.langs.audio_no_local_results:this._ownerId>0?t.langs.audio_no_user_local_results:t.langs.audio_no_group_local_results,this._els.searchNoLocalResults.innerHTML=s.replace("{query}","<strong>"+clean(e.q)+"</strong>")),o.length||(hide(this._els.searchSectionAudiosHeader),hide(this._els.searchSectionAudios)),this._searchAudiosAutoList=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(this._els.searchSectionAudios,{onNeedRows:function(e,i,_,a,r){this._toggleSearchProgress(!0),l.load(i,function(){if(this._toggleSearchProgress(!1),!r.isDone()){if(i||(o.length?(show(this._els.searchSectionAudiosHeader),show(this._els.searchSectionAudios),s=+this._ownerId===vk.id?t.langs.audio_found_your_local:this._ownerId>0?t.langs.audio_found_user_local:t.langs.audio_found_group_local,this._els.searchSectionAudiosHeader.innerHTML=langNumeric(o.length,s),toggleClass(this._els.searchSectionAudios,"audio_owner_list_canedit",!!this._data.canEdit)):(hide(this._els.searchSectionAudiosHeader),hide(this._els.searchSectionAudios)),hide(this._els.searchGlobalCommunitiesPlace),hide(this._els.searchGlobalPlaylistsPlace),hide(this._els.searchGlobalArtistsPlace)),+i===o.length){var _=l.getCommunititesBlock(),a=l.getPlaylistsBlock(),n=l.getArtistsBlock();toggle(this._els.searchGlobalCommunitiesPlace,!!_),toggle(this._els.searchGlobalPlaylistsPlace,!!a),toggle(this._els.searchGlobalArtistsPlace,!!n),this._els.searchGlobalCommunitiesPlace&&(this._els.searchGlobalCommunitiesPlace.innerHTML=_||""),this._els.searchGlobalPlaylistsPlace&&(this._els.searchGlobalPlaylistsPlace.innerHTML=a||""),this._els.searchGlobalArtistsPlace&&(this._els.searchGlobalArtistsPlace.innerHTML=n||""),this._els.searchGlobalAudiosList.innerHTML="",l.getAudiosCount()>o.length?(show(this._els.searchGlobalAudiosBlock),r.setListEl(this._els.searchGlobalAudiosList),this._els.searchGlobalAudiosBlockHeader.innerHTML=langNumeric(l.getTotalCount(),t.langs.audio_global_search_found,!0)):hide(this._els.searchGlobalAudiosBlock)}for(var d=[],u=l.getAudiosList(),c=i,h=i<o.length?Math.min(o.length,i+30):i+30,p=c;p<h&&u[p];p++)d.push(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.drawAudio(u[p]));e(d)}}.bind(this))}.bind(this)}),this._onSectionOut(function(){this._els.searchSectionAudios.innerHTML="",this._searchAudiosAutoList&&(this._searchAudiosAutoList.destroy(),this._searchAudiosAutoList=!1)}.bind(this)),this._pagePlaylist=l,this._toggleSearchProgress(!1)}.bind(this))}},AudioPage.prototype.showFriendMusic=function(e,t){return statlogsValueEvent("audio_friends_block","click_friend"),this.isLayer()?nav.go({0:"/audios"+t},!1,{friendId:t}):nav.go("/audios"+t,e),cancelEvent(e)},AudioPage.prototype._deinitNavigation=function(){cur.nav.pop(),this._navigationInited=!1},AudioPage.PageSections=["recoms_audio","recoms_block","search_block","recoms_personal","my"];var layerSectionsToMainFrame=["search_block","search_playlists"];AudioPage.prototype.initNavigation=function(){this._navigationInited||this.isPodcastPage()||(this._navigationInited=!0,this._prevLoc={},cur.nav.push(function(e,t,i,o){var s=this._ignoreResetedSearch;if(delete this._ignoreResetedSearch,s&&o.fromSearch)return!1;if(o.isLayer&&!this.isLayer())return!1;if(this.isLayer()&&!1!==this._prevLoc)for(var _ in t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_30__.clone)(this._prevLoc),e=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_30__.clone)(i),t)t.hasOwnProperty(_)&&(t[_]&&void 0===i[_]?e[_]=!1:t[_]==i[_]&&delete e[_]);if(e&&Object.keys(e).length){this._deleteDeletedAudios();var a=i.section||this.defaultSection,l=!1;return 0===i[0].indexOf("podcasts")&&(a="podcast"),o.tab||o.fromSearch||!1===e.q&&1===Object.keys(e).length||o.searchPerformer?l=!1:o.friendId&&this.isLayer()?(a="friend",this.resetSection(a),this._sectionData={friend_id:o.friendId},l=!1):(2!==Object.keys(e).length||!1!==e.q||isUndefined(e[0]))&&isUndefined(e[0])?(inArray(e.section,AudioPage.PageSections)||e.hasOwnProperty("block")||inArray(t.section,AudioPage.PageSections)&&!inArray(e.section,AudioPage.PageSections))&&(this.isLayer()&&!layerSectionsToMainFrame.includes(i.section)?(l=!1,this._sectionData={audio_id:e.audio_id},a="recoms",delete this._currentSection):l=!0):l=!0,l?!0:("recoms"===a&&this.isLayer()&&this.resetSection("recoms"),i.q?(this._els.searchInput&&!o.fromSearch&&(this._els.searchInput.value=i.q),this._showSearchSection(extend({},i,o))):(this._ignoreResetedSearch=!1===e.q,this._els.searchInput&&uiSearch.reset(this._els.searchInput,!0),this.showSection(a),this._switchTab(a)),this.isLayer()?this._prevLoc=i:nav.setLoc(i),(o.back||o.hist||o.nav)&&this.syncParametersUI(i),!1)}}.bind(this)))},AudioPage.prototype._deleteDeletedAudios=function(){var e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAddRestoreInfo();each(e,(function(e,t){"deleted"!==t.state&&"recom_hidden"!==t.state||getAudioPlayer().deleteAudioFromAllPlaylists(e)}))},AudioPage.prototype._switchTab=function(e){if(!this.isPodcastPage()){var t=geByClass1("_audio_section_tab__"+e,this._els.pageContainer);t?uiTabs.switchTab(domFC(t)):removeClass(geByClass1("ui_tab_sel",this._els.pageContainer),"ui_tab_sel")}},AudioPage.prototype.onLayerHide=function(){this._deinitNavigation(),this._deinitKeyEvents(),this._onSectionOut(),delete this._currentSection,this._muteSearch=!0,geByClass1("audio_page_player2")&&hide(this._els.searchNoLocalResults),setTimeout(()=>uiSearch.reset(this._els.searchInput),1e3)},AudioPage.prototype.updateLayerHeight=function(){var e=700;e=Math.min(e,window.innerHeight-150),e=Math.max(e,400),isVisible(this._els.footer)&&(e-=getSize(this._els.footer)[1]),setStyle(this._els.scrollWrap,{height:e}),this._els&&this._els.scrollWrap&&"function"==typeof this._els.scrollWrap.updateScroll&&this._els.scrollWrap.updateScroll()},AudioPage.prototype.onLayerShow=function(e){var t=getAudioPlayer().getCurrentPlaylist(),i=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(getAudioPlayer().getCurrentAudio());i?this.showSection("podcast"):t?this.showSection("current"):e?this.showSection(e):this.showSection("all"),toggleClass(geByClass1("_audio_section_tab__current",this._els.pageContainer),"unshown",!t||i),this.initNavigation(),this.updateCurrentPlayingInfo(),this._initKeyEvents(),this.updateLayerHeight(),this.updateShuffleButton();var o=this.getPageCurrentPlaylist(),s=getAudioPlayer().getCurrentAudio();if(this._audioRowsAutoList&&o&&s&&o.indexOfAudio(s)>=0)for(var _=10;_--;){var a=geByClass1(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_CURRENT_CLS,this._audioRowsAutoList.getListEl());if(a){var l=getXY(a)[1];this._scroll.scroller.scrollTop=l-scrollGetY()-300,this._scroll.update();break}this._audioRowsAutoList.drawMore(),getAudioPlayer().updateCurrentPlaying()}delete this._muteSearch},AudioPage.prototype.resetSection=function(e){var t=geByClass1("_audio_section__"+e,this._els.sections);re(t)},AudioPage.prototype.isUpdateRequested=function(e){return Array.isArray(sectionsToUpdate)&&sectionsToUpdate.includes(e+this.getOwnerId())},AudioPage.disableAdsClick=function(e){statlogsValueEvent("audio_web_ad_link","click"),nav.go(e)},AudioPage.prototype.requestUpdate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";sectionsToUpdate=e.map(e=>e+t)},AudioPage.prototype.showSection=function(e,t,i){this.isPodcastPage()&&(e="podcast"),"search"!==this._currentSection||"all"!==e&&"current"!==e||uiSearch.reset(this._els.searchInput,!0),layers.fullhide&&layers.fullhide(),this._switchTab(e);var o=geByClass1("audio_page_player2")&&"search"===e||this.isUpdateRequested(e);if(this._currentSection!==e||"search"===this._currentSection){this._currentSection=e;var s=geByClass1("_audio_section__"+e,this._els.sections),_=this._data.sectionData&&this._data.sectionData[e]||{};if(s&&(!o||!1===i)){if(each(geByClass("_audio_section",this._els.pageContainer),(function(){hide(this)})),hide(this._els.searchGlobalBlocks),hide(this._els.searchGlobalCommunitiesPlace),hide(this._els.searchGlobalPlaylistsPlace),hide(this._els.searchGlobalArtistsPlace),hide(this._els.searchGlobalAudiosBlock),show(s),geByClass1("audio_page_player2")&&(hide(this._els.searchNoLocalResults),"search"===e&&!s.innerHTML)){show(this._els.searchNoLocalResults);var a=getAudioPlayer(),l=vk.id===+this._ownerId?a.langs.audio_no_local_results:this._ownerId>0?a.langs.audio_no_user_local_results:a.langs.audio_no_group_local_results,r=winToUtf(clean(_.searchParams.globalQuery));this._els.searchNoLocalResults.innerHTML=l.replace("{query}","<strong>"+r+"</strong>")}if(this._onSectionOut(),delete cur._back,Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")&&!["podcast","current"].includes(e))return this.sectionController=new _web_audio_catalog_SectionController__WEBPACK_IMPORTED_MODULE_27__.SectionController(s,_),this._onSectionOut(()=>{this.sectionController.destroy(),this.setPagePlaylist(null)}),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_14__.isFunction)(t)&&t(),void getAudioPlayer().updateCurrentPlaying();switch(e){case"current":this._initSection_all(s,_,!0);break;case"friend":this._initSection_all(s,_);break;case"playlists":this._initSection_playlists(s);break;case"updates":this._initSection_updates(s,_);break;case"recoms":this.isLayer()||vk.id!==this.getOwnerId()?this._initSection_all(s,_):(this.sectionController=new _web_audio_catalog_SectionController__WEBPACK_IMPORTED_MODULE_27__.SectionController(s,_),this._onSectionOut(()=>this.sectionController.destroy()));break;case"search":var n=new _web_audio_catalog_SectionController__WEBPACK_IMPORTED_MODULE_27__.SectionController(s,_);this._onSectionOut(()=>n.destroy());break;case"artist":this.sectionController=new _web_audio_catalog_SectionController__WEBPACK_IMPORTED_MODULE_27__.SectionController(s,_),this._onSectionOut(()=>this.sectionController.destroy());break;case"all":case"recoms_audio":this._initSection_all(s,_);break;case"recoms_block":case"artist_block":case"search_block":this.sectionController=new _web_audio_catalog_SectionController__WEBPACK_IMPORTED_MODULE_27__.SectionController(s,_),this._onSectionOut(()=>this.sectionController.destroy());break;case"podcast":this._initSection_podcast(s,_)}return getAudioPlayer().updateCurrentPlaying(),void(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_14__.isFunction)(t)&&t())}var d=this._ownerId;if("podcast"===e&&!this.isPodcastPage())d=(getAudioPlayer().getCurrentAudio()||this._readyAudio)[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID];this.isUpdateRequested(e)&&(sectionsToUpdate=null),ajax.post("al_audio.php",extend({act:"section",section:e,owner_id:d,is_layer:this.isLayer()?1:0,claim:intval(nav.objLoc.claim)},this._sectionData||{}),{onDone:(i,s)=>{if(this._data.sectionData=this._data.sectionData||{},this._data.sectionData[e]=s,o){var _=geByClass1("_audio_section__"+e,this._els.sections);_&&re(_)}var a=se('<div class="audio_section _audio_section _audio_section__'+e+" audio_section__"+e+' clear_fix audio_w_covers">'+i+"</div>");this._els.sections.appendChild(a),delete this._currentSection,this.showSection(e,t,!1)},onFail:()=>!0}),delete this._sectionData}else Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_14__.isFunction)(t)&&t()},AudioPage.prototype._onSectionOut=function(e){e?(this._onSectionOutCbs=this._onSectionOutCbs?this._onSectionOutCbs:[],this._onSectionOutCbs.push(e)):(each(this._onSectionOutCbs||[],(function(e,t){t()})),this._onSectionOutCbs=[])},AudioPage.prototype._initSection_playlistsRecoms=function(e,t,i){var o=geByClass1("audio_page_block__playlists_items",t);if(o){var s=i.playlistsData.next,_=3,a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;_?(_--,setTimeout((function(){l(e,2*t)}),t)):e([])},l=function(t,o){ajax.post("al_audio.php",{act:"load_playlists_block",block_id:i.playlistsData.id,section:e,offset:s,render_html:1},{onDone:function(e,i){s=e.next,e&&i&&i.length?(_=3,s=e.next,t(i)):a(t,o)},onFail:function(){return a(t,o),!0}})},r=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(o,{onNeedRows:function(e){if(!o.clientHeight)return r&&r.destroy();s?l(e):e([])},onNoMore:function(){r&&r.toggleProgress(!1)},showProgress:showProgress.pbind(o,"","audio_more_rows"),hideProgress:hideProgress.pbind(o)});this._onSectionOut((function(){r.destroy()}))}},AudioPage.prototype._initSection_playlists=function(e){var t=geByClass1("_audio_page_block__playlists_items",e);t.innerHTML="";var i,o=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(t,{uiScroll:this.isLayer(),onNeedRows:function(e,t){for(var i=[],o=this._data.playlists,s=t;s<t+20&&o[s];s++)i.push(getTemplate("audio_pl_item",o[s]));e(i)}.bind(this)});this._data.canEdit&&(i=new _web_grid_sorted__WEBPACK_IMPORTED_MODULE_22__.default(t,"audio_pl_item2",{onReorder:this.onPlaylistsReorder.bind(this)}),this._onSectionOut((function(){o.destroy(),i&&i.destroy()})))},AudioPage.prototype.onPlaylistsReorder=function(e,t,i){var o=domData(e,"raw-id"),s=domData(i,"raw-id");ajax.post("al_audio.php",{act:"reorder_playlist",owner_id:this.getOwnerId(),playlist_id:o.split("_")[1],prev_playlist_id:s?s.split("_")[1]:0,hash:this._data.reorderHash},{onFail:()=>!0})},AudioPage.prototype._initSection_updates=function(e,t){if(uiSearch.init(geByClass1("_audio_friends_search",e)),t.feedPlaylist){var i=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_FEED,vk.id,0);i.getFeedOffset()||i.mergeWith(t.feedPlaylist);var o=geByClass1("page_block",e);o.innerHTML="",this._pagePlaylist=i,domData(gpeByClass("_audio_pl",o),"playlist-id",i.getId());var s=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(o,{onNeedRows:function(e,t){i.load(t,(function(){e(i.getItemsList().slice(t))}))}});this._onSectionOut((function(){s.destroy()}))}},AudioPage.prototype._initSection_all=function(e,t,i){var o;if(extend(this._els,{audioRows:geByClass1("_audio_page__audio_rows_list",e),audioRowsMore:geByClass1("_audio_more_rows",e),friendsBlock:geByClass1("_audio_friends_list_wrap",e),friendsBlockContent:geByClass1("_audio_friends_list_content",e)}),i){if(!(o=getAudioPlayer().getCurrentPlaylist())&&!this.retriedCurrent)return this.retriedCurrent=!0,setTimeout(()=>this._initSection_all(e,t,i));this._scroll=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_15__.default(this._els.scrollWrap,{global:!0,stopScrollPropagation:!0,stopScrollPropagationAlways:!0})}else{var s=t.playlistData,_=t.nextFrom;s&&((o=getAudioPlayer().getPlaylist(s.type,s.ownerId,s.id)).mergeWith(s),o.getAudiosCount()||o.load(),_&&(o.nextFrom=_))}o&&(this._pagePlaylist=o,domData(this._els.audioRows,"playlist-id",o.getId()));var a=geByClass1("_audio_friends_search",e);if(a&&uiSearch.init(a),!this._sortDD&&!i){var l=geByClass1("_audio_page__sort_dd",e);if(l&&isVisible(l)){var r=getLang("audio_sort_types").split("<br>");this._sortDD=new InlineDropdown(l,{items:[[0,r[0]],["performer",r[1]],["random",r[2]],["reverse",r[3]]],withArrow:!0,selected:0,onSelect:this._onSortSelected.bind(this)})}}this._initAudioRowsAutoList(i),this._enableAudioRowsSorter(i),setTimeout(()=>this._initFixedFriendsBlock(e))},AudioPage.prototype.drawMore=function(){this._audioRowsAutoList&&this._audioRowsAutoList.drawMore()},AudioPage.prototype.scrollIntoView=function(e,t){this._scroll.scrollIntoView(e,t)},AudioPage.prototype._initSection_podcast=function(e,t){extend(this._els,{audioRows:geByClass1("_audio_page__audio_rows_list",e),audioRowsMore:geByClass1("podcast_episodes_more",e)});var i=getAudioPlayer().getCurrentPlaylist();if(!i){var o=t.playlistData;o&&((i=getAudioPlayer().getPlaylist(o.type,o.ownerId,o.id)).getAudiosCount()||(i.mergeWith(o),i.load()))}i&&(this._pagePlaylist=i,domData(this._els.audioRows,"playlist-id",i.getId())),this._initAudioRowsAutoList(),this._data.reverse||this._enableAudioRowsSorter()},AudioPage.prototype.setPagePlaylist=function(e){this._pagePlaylist=e},AudioPage.prototype.getSortedList=function(){return this._sortedList},AudioPage.prototype.clearSortedList=function(){this._sortedList=null},AudioPage.prototype.shuffleAudioPage=function(){if(!this.isPodcastPage()){var e=this.getPageCurrentPlaylist(),t=domData(this._els.audioRows,"audio-context");e.loadAll(function(){this._sortedList=[].concat(e.getUnshuffledAudiosList()),this._sortedList.fullId=e.getFullId(),Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.shuffle)(this._sortedList);var i=new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_TEMP,e.getOwnerId(),e.getAlbumId());i.mergeWith({list:this._sortedList}),getAudioPlayer().play(i.getAudioAt(0),i,t),this._disableAudioRowsSorter(),this._initAudioRowsAutoList(),this._sortDD&&this._sortDD.select("random",!0)}.bind(this)),statlogsValueEvent("audio_sort_stat","audio_sort","shuffle_page",this.isLayer()?"layer":"page")}},AudioPage.prototype._onSortSelected=function(e){var t=this.getPageCurrentPlaylist();t.loadAll(function(){switch(e){case 0:delete this._sortedList,this._enableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_default");break;case"performer":var i=[].concat(t.getUnshuffledAudiosList());i.sort((function(e,t){var i=trim(e[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].toLowerCase()),o=trim(t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].toLowerCase());return 0==i.indexOf("the ")&&(i=i.slice(4)),0==o.indexOf("the ")&&(o=o.slice(4)),i<o?-1:i>o?1:0})),this._sortedList=i,this._sortedList.fullId=t.getFullId(),this._disableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_performer");break;case"random":this._sortedList=[].concat(t.getUnshuffledAudiosList()),this._sortedList.fullId=t.getFullId(),Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.shuffle)(this._sortedList),this._disableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_shuffle");break;case"reverse":this._sortedList=[].concat(t.getUnshuffledAudiosList()),this._sortedList.fullId=t.getFullId(),this._sortedList.reverse(),this._disableAudioRowsSorter(),statlogsValueEvent("audio_sort_stat","audio_sort","dropdown_reverse")}this._initAudioRowsAutoList()}.bind(this))},AudioPage.prototype._initFixedFriendsBlock=function(){if(this._els.friendsBlock){this._isFixed=!1,this._isDraggable=!1,this._initialPos=getXY(this._els.friendsBlock);var e=this.isLayer(),t=getSize("page_header")[1],i=getSize(this._els.playerWrap)[1],o=e?13:15;this._fixedThreshold=e?t+i+o:this._initialPos[1]-t-i-o;var s=e?this._scroll.scroller:window;if(!(this._fixedThreshold<0)){addEvent(window,"resize",this._resizeHandler=()=>{this._initialPos=getXY(this._els.friendsBlock)}),addEvent(s,"scroll",this._scrollHandler=()=>{this._moveFriendsBlock()});var _=this;AudioPage.onUpdateDraggablePosition=()=>{_._isDraggable=!0,_._moveFriendsBlock(),requestAnimationFrame(()=>_._isDraggable=!1)},AudioPage.forceFix=()=>{var e=_._els.friendsBlockContent.getBoundingClientRect();if(e.width>0&&e.height>0){var t=_.isLayer()?_._scroll.scroller.scrollTop:scrollGetY();_._els.friendsBlockContent.style.transform=`translate(0,${Math.max(0,t-_._fixedThreshold-9)}px)`,_._unfixedFriendsBlock()}},this._onSectionOut(()=>{this._scrollHandler&&removeEvent(s,"scroll",this._scrollHandler),this._resizeHandler&&removeEvent(window,"resize",this._resizeHandler),this._fixedBlockScrollHandler&&removeEvent(this._els.friendsBlockContent,"mousewheel",this._fixedBlockScrollHandler),removeClass(this._els.friendsBlockContent,"audio_friends_fixed")})}}},AudioPage.prototype._moveFriendsBlock=function(){var e=this.isLayer()?this._scroll.scroller.scrollTop:scrollGetY(),t=this._els.friendsBlockContent.getBoundingClientRect(),i=t.width>0&&t.height>0;this._isDraggable&&i?(this._els.friendsBlockContent.style.transform=`translate(0,${Math.max(0,e-this._fixedThreshold-9)}px)`,this._unfixedFriendsBlock()):(this._els.friendsBlockContent.style.transform="",e>this._fixedThreshold?this._fixedFriendsBlock():this._unfixedFriendsBlock())},AudioPage.prototype._fixedFriendsBlock=function(){this._isFixed||(this._initialPos=getXY(this._els.friendsBlock),addClass(this._els.friendsBlock,"audio_friends_fixed"),this._isFixed=!0,this.isLayer()&&(this._fixedBlockScrollHandler=addEvent(this._els.friendsBlockContent,"mousewheel",e=>(this._scroll.scroller.scrollTop=this._scroll.scroller.scrollTop+e.deltaY,cancelEvent(e)))))},AudioPage.prototype._unfixedFriendsBlock=function(){this._isFixed&&(removeClass(this._els.friendsBlock,"audio_friends_fixed"),this._isFixed=!1,this._fixedBlockScrollHandler&&removeEvent(this._els.friendsBlockContent,"mousewheel",this._fixedBlockScrollHandler))},AudioPage.prototype.playPlaylist=function(e,t,i,o){var s=getAudioPlayer(),_=s.getCurrentPlaylist(),a=s.getPlaylist(e,t,i);_&&_.equals(a)&&s.isPlaying()?s.pause():a.load(0,(function(){s.play(a.getAudiosList()[0],a,o)}))},AudioPage.prototype.playShuffledBlockPlaylist=function(e){var t=getAudioPlayer(),i=t.getPlaylistByBlockId(e)||new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist({hasMore:!0,blockId:e});i.clean(),i.loadByBlockId("",(function(e){t.play(e.getAudiosList()[0],e,e.getContext())}))},AudioPage.prototype.playBlockPlaylist=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=getAudioPlayer(),o=i.getCurrentPlaylist(),s=i.getPlaylistByBlockId(e)||new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist({hasMore:!0,blockId:e});if(o&&o.equals(s)&&i.isPlaying())i.pause();else{var _=s.getContext()||t&&t.dataset.context||"";s.loadByBlockId("",e=>i.play(e.getAudiosList()[0],e,_))}},AudioPage.prototype.onAudioRowsReorder=function(e,t,i,o){var s,_=getAudioPlayer(),a=domData(t,"full-id"),l=domData(o,"full-id"),r=e?_.getCurrentPlaylist():this.getPageCurrentPlaylist(),n=r.indexOfAudio(a);l?(s=r.indexOfAudio(l),s++):s=0,r.moveAudio(n,s),e&&_.saveStateCurrentPlaylist(),this.isPodcastPage()?ajax.post("al_podcasts.php",{act:"a_reorder_episodes",hash:this._data.audiosReorderHash,oid:this.getOwnerId(),episode_id:a?a.split("_")[1]:0,next_episode_id:l?l.split("_")[1]:0},{onFail:()=>!0}):e||ajax.post("al_audio.php",{act:"reorder_audios",hash:this._data.audiosReorderHash,owner_id:this.getOwnerId(),audio_id:a?a.split("_")[1]:0,next_audio_id:l?l.split("_")[1]:0},{onFail:()=>!0})},AudioPage.prototype._enableAudioRowsSorter=function(e){(this._data.audiosReorderHash||e)&&(this._audioRowsSorter&&this._audioRowsSorter.destroy(),this._audioRowsSorter=new _web_grid_sorted__WEBPACK_IMPORTED_MODULE_22__.default(this._els.audioRows,"",{wrapNode:this.isLayer()?this._scroll.scroller:void 0,onReorder:(t,i,o)=>this.onAudioRowsReorder(e,t,i,o)}),this._onSectionOut(function(){this._audioRowsSorter&&this._audioRowsSorter.destroy()}.bind(this)))},AudioPage.prototype._disableAudioRowsSorter=function(){this._audioRowsSorter&&this._audioRowsSorter.disable()},AudioPage.prototype._initAudioRowsAutoList=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._els.audioRows){var t=this.isPodcastPage()||"podcast"===this._currentSection,i=this._pagePlaylist;this._els.audioRows.innerHTML="",toggleClass(this._els.audioRows,"audio_owner_list_canedit",!t&&!!this._data.canEdit),this._audioRowsAutoList&&this._audioRowsAutoList.destroy(),this._audioRowsAutoList=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(this._els.audioRows,{scrollNode:!!this._scroll&&this._scroll.scroller,onRendered:function(){getAudioPlayer().updateCurrentPlaying()},onNoMore:function(){hide(this._els.audioRowsMore)}.bind(this),onNeedRows:function(o,s,_,a,l){var r=[];t?(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(this._els.audioRowsMore),this._loadPodcastEpisodes(s,function(e){(e||[]).slice(s).forEach((function(e){r.push(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.drawAudio(e))})),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(this._els.audioRowsMore),o(r)}.bind(this))):i&&i.load(s,()=>{var t;t=e?((t=i.getAudiosList())||[]).map(e=>{if(e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_29__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]){var t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_30__.clone)(e);return t[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_29__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]=!1,t}return e}):this._sortedList&&this._sortedList.fullId===i.getFullId()?this._sortedList:i.getUnshuffledAudiosList();for(var _=s;_<s+30&&t[_];_++)r.push(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.drawAudio(t[_]));o(r),0===s&&this._audioRowsSorter&&this._audioRowsSorter.update(),0===s&&1===r.length&&l.drawMore()})}.bind(this)}),this._onSectionOut(function(){this._audioRowsAutoList.destroy(),this._els.audioRows.innerHTML=""}.bind(this))}},AudioPage.prototype._loadPodcastEpisodes=function(e,t){var i,o=getAudioPlayer().getCurrentAudio()||this._readyAudio;i=this.isPodcastPage()?this._ownerId:o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],cur._podcastsEpisodes=cur._podcastsEpisodes||{},cur._podcastsEpisodes[i]=cur._podcastsEpisodes[i]||[];var s=cur._podcastsEpisodes[i];s.length&&e<s.length?t(s):ajax.post("al_podcasts.php",{act:"a_episodes",oid:i,episode_full_id:o?o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_ID]:"",offset:e,rev:this._data.reverse},{onDone:function(e){cur._podcastsEpisodes[i]=s.concat(e||[]),t(cur._podcastsEpisodes[i])},onFail:function(){return t(cur._podcastsEpisodes[i]),!0}})},AudioPage.showAttachBox=function(e,t){curBox()&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(geByClass1("_ape_item_list",curBox().bodyNode),"offset")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(geByClass1("_ape_item_list",curBox().bodyNode),"offset",0),1===vk.widget?showBox("al_audio.php",{act:"choose_box",owner_id:e,options:JSON.stringify(t)}):AudioPage.editPlaylist(e,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID,"attach",t)},AudioPage.editPlaylist=function(e,t,i,o){if(vk.widget)for(var s in o)o.hasOwnProperty(s)&&(isString(o[s])?o[s]=clean(o[s]):Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_14__.isFunction)(o[s])?delete o[s]:o[s]=intval(o[s]));var _,a;if("edit"===i&&o&&(o.audioAttachSwitchOwnerId=!1),o&&o.audioAttachSwitchOwnerId&&(cur.audioAttachSwitchOwnerId=o.audioAttachSwitchOwnerId),i=i||"edit",t)_=getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,e,t);else if(cur.audioPage){var l=cur.audioPage._data.maxPlaylistsCount;if(isArray(cur.audioPage._data.playlists)&&cur.audioPage._data.playlists.length>=l){var r=langNumeric(l,cur.lang.audio_playlists_limit_error).replace("{limit}",l);return void new MessageBox({title:getLang("global_error")}).content(r).setButtons("Ok",(function(){curBox().hide()})).show()}}show(boxLoader),show(boxLayerWrap),boxRefreshCoords(boxLoader),Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.parallel)(e=>{stManager.add(["audio.css",jsc("web/indexer.js"),jsc("web/auto_list.js"),jsc("web/grid_sorter.js"),"edit"===i&&jsc("web/upload.js")],e)},e=>{_?_.loadAll(e,i):e()},t=>{cur.audioPage&&cur.audioPage.getOwnerId()===+e&&(a=cur.audioPage.getOwnerPlaylists()),a?t():AudioPage.loadPlaylists(e,void 0,!1,"attach"===i,e=>{a=e,t()})},()=>{AudioPage._openEditPlaylist(i,e,t,a,o)})},AudioPage.initBoxEls=function(e){return{boxContent:geByClass1("_audio_pl_edit_box",e.bodyNode),playlistNameInput:geByClass1("ape_pl_input",geByClass1("ape_pl_title",e.bodyNode)),playlistDescriptionInput:geByClass1("ape_pl_input",geByClass1("ape_pl_description",e.bodyNode)),stat:geByClass1("_ape_pl_stat",e.bodyNode),uploadCoverButtonWrapper:geByClass1("_ape_cover",e.bodyNode),uploadCoverInput:geByClass1("_ape_cover_upload",e.bodyNode),errorMsg:geByClass1("_ape_error_msg",e.bodyNode),header:geByClass1("_ape_header",e.bodyNode),search:geByClass1("_ape_search",e.bodyNode),searchInput:geByClass1("_field",e.bodyNode),addAudiosButton:geByClass1("ape_add_audios_btn",e.bodyNode),addAudiosFromPlaylistsButton:geByClass1("ape_add_pl_audios_btn",e.bodyNode),listWrap:geByClass1("_ape_list_wrap",e.bodyNode),list:geByClass1("_ape_item_list",e.bodyNode),globalResults:geByClass1("_ape_item_global_results",e.bodyNode),globalResultsList:geByClass1("_ape_item_global_list",e.bodyNode),emptyPlaceholder:geByClass1("_ape_audios_empty_list",e.bodyNode),emptyPlaylistsPlaceholder:geByClass1("_ape_audios_empty_playlists_list",e.bodyNode),emptyGlobalPlaceholder:geByClass1("_ape_audios_empty_global_list",e.bodyNode)}},AudioPage._openEditPlaylist=function(e,t,i,o,s){var _,a,l,r,n,d,u,c=getAudioPlayer(),h=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_TEMP,t,irand(0,999999));if(curBox()){n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(geByClass1("_ape_item_list",curBox().bodyNode),"offset"),d=val("ape_edit_playlist_search");var p=geByClass1("_ape_item_list",curBox().bodyNode);p&&(u=p.scrollTop)}hide(boxLoader),curBox()||hide(boxLayerWrap),cur.apLayer&&(r=cur.apLayerPlaylistId,layers.fullhide()),s=extend({audioPickerButtonText:getLang("global_add_media"),playlistPickerButtonText:getLang("audio_attach_playlist_button"),canPlaylistAttach:!1,onAudioChoose:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.onAudioChoose,onPlaylistChoose:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.onPlaylistChoose},s),cur.onChooseAudio=s.onAudioChoose,cur.onChoosePlaylist=s.onPlaylistChoose;var g,y=!i||i===_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID,E="attach"===e,P=!1,f=!1,b=!1,A=!1,v=0,m=null,O=!0;o=o.filter(e=>e.id!==_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID&&e.size>0);var C=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_20__.vkIndexer(o,e=>e.title),w=o.length>0,D=!1;!y||E?(D=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,t,i),h.addAudio(D.getUnshuffledAudiosList()),h.mergeWith({title:D.getTitle(),description:D.getDescription(),rawDescription:D.getRawDescription(),coverUrl:D.getCoverUrl(),editHash:D.getEditHash()})):s.addAudio&&h.addAudio(s.addAudio);var M=E?getLang("audio_choose_audio_title"):i?getLang("audio_edit_playlist_title"):getLang("audio_new_playlist_title");function L(e){if(e=trim(e)){var t=" "+(e+"|")+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_24__.parseLatin)(e)||"")+(Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_24__.parseCyr)(e)||"");t=trim(t.replace(/\)/g,"").replace(/&/,"&amp;")),A=new RegExp("(\\s|^)("+t.replace(_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_20__.vkIndexer.delimiter,"|").replace(/(^\||\|$|\?)/g,"")+")","gi")}else A=!1;x(f,"playlists"!==P,e),hide(a.emptyGlobalPlaceholder)}function B(){O||(h.clean(),c.deletePlaylist(h),r&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.showAudioPlaylist(r[0],r[1]))}function I(t){var o,s;return!(!t&&"attach"!==e)||(i?(o=getLang("audio_edit_playlist_cancel_confirm_text"),s=getLang("audio_edit_playlist_cancel_confirm_yes")):(o=getLang("audio_new_playlist_remove_confirm_text"),s=getLang("audio_new_playlist_remove_confirm_continue")),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__.showFastBox)(getLang("global_warning"),o,s,()=>{O=!1,curBox().hide(),_.hide(!0)},getLang("global_cancel")),!1)}function T(){return trim(a.searchInput.value)}function S(t){var i=h.indexOfAudio(t)>=0?"ape_selected":"",o=t;A&&((t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_30__.clone)(o))[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_TITLE].replace(A,"$1<em>$2</em>"),t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].replace(A,"$1<em>$2</em>"));var _="";if("edit"===e)_='<div class="ape_check"><div class="ape_check_icon"></div></div>';else{var a=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(o);if(s&&s.wiki)_='<div role="button" class="ape_attach" onclick="'+`editorChooseAudio(\n        '${clean(a.performer)}',\n        '${clean(a.title)}',\n        ${a.duration},\n        '${a.fullId}',\n        '${a.url}',\n        ${a.duration},\n        this)`+'">'+s.audioPickerButtonText+"</div>";else _=`<div role="button" class="ape_attach" onclick="cur.onChooseAudio(event, this, ${a=clean(JSON.stringify(a))}, ${clean(JSON.stringify(o))})">${s.audioPickerButtonText}</div>`}return'<div class="ape_audio_item_wrap _ape_audio_item '+i+'">'+_+_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.drawAudio(t)+"</div>"}(2===vk.widget||3===vk.widget)&&window.box&&(!boxQueue.count()&&!curBox()||cur.audioChooseBox===curBox())?(_=window.box).setOptions({title:M,bodyStyle:"padding: 0",width:560,onBeforeHide:B,onHideAttempt:I,hideButtons:!0}):(cur.audioChooseBox&&cur.audioChooseBox===curBox()&&curBox().hide(),_=new MessageBox({title:M,bodyStyle:"padding: 0",width:560,onBeforeHide:B,onHideAttempt:I})),cur.audioChooseBox=_,_.content(getTemplate("audio_edit_playlist")),_.show(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(_,"ownerId",t),a=AudioPage.initBoxEls(_),function(){var i=window.innerHeight;setStyle(a.boxContent,"height",Math.min(800,Math.max(i-200,500))),addEvent(a.addAudiosFromPlaylistsButton,"click",N.bind(this,"playlists")),addEvent(a.addAudiosButton,"click",N.bind(this,"default")),addEvent(a.list,"click",Y),E&&domData(a.list,"audio-context","attach");addEvent(_.titleWrap,"click",(function(e){hasClass(e.target,"_back")&&function(){switch(P){case"initial":break;case"default":N("initial");break;case"playlists":N("default");break;case"playlist":N("playlists")}}()})),uiSearch.init("ape_edit_playlist_search",{onChange:L}),"edit"===e&&(N("initial"),G(),function(){if(!cur.audioCoverUploadOptions||!cur.audioCoverUploadOptions[t])return;var e=cur.audioCoverUploadOptions[t],i={file_name:"photo",file_size_limit:5242880,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF;*.bmp;*.BMP",onUploadStart:function(e,t){show(geByClass1("_ape_cover_progress"))},onUploadComplete:function(e,t){(t=JSON.parse(t)).error?(show(a.errorMsg),K()):(hide(a.errorMsg),q((v=t).url),K()),hide(geByClass1("_ape_cover_progress"))},onUploadProgress:function(e,t,i){},onUploadError:function(e,t){hide(geByClass1("_ape_cover_progress"))},clear:1,type:"photo",max_attempts:3,server:e.server,noCheck:!0,chooseBox:!0,uploadButton:!0,accept:".jpg,.jpeg,.png",filesize_hide_last:!0,label:e.button};Upload.init(a.uploadCoverButtonWrapper,e.url,e.vars,i),a.uploadCoverButton=geByClass1("ape_cover_accessibility_upload_btn",_.bodyNode),addEvent(geByClass1("_ape_cover_delete"),"click",V),addEvent(a.uploadCoverButton,"click",()=>{isObject(v)&&!isVisible(geByClass1("_ape_cover_progress"))||geByTag1("input",a.uploadCoverButtonWrapper).click()}),a.coverThumb=geByClass1("_ape_cover_thumb")}(),h.getCoverUrl()&&q(h.getCoverUrl()),autosizeSetup(a.playlistDescriptionInput,{minHeight:30,maxHeight:150,onResize:K}),a.playlistNameInput.value=replaceEntities(h.getTitle()),a.playlistDescriptionInput.value=replaceEntities(h.getRawDescription().replace(/<br>/g,"\n")));E&&N("default");W(),D&&"attach"!==e&&_.setControlsText(`<a onclick="AudioPage.deletePlaylist(${D.getOwnerId()}, ${D.getPlaylistId()}, '${D.getEditHash()}')">\n                              ${getLang("audio_delete_playlist")}\n                            </a>`)}(_.bodyNode),d&&val(a.searchInput,d),k();var R=0;function k(){clearTimeout(R);var e=T();e&&(R=setTimeout((function(){R=!1,(b=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_SEARCH,vk.id,Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_21__.hashCode)(e+"no conflict"))).mergeWith({searchParams:{globalQuery:e},hasMore:!0});var t=0;l&&(t=l.getOffset(),l.destroy()),(l=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(a.list,{scrollNode:a.list,onNeedRows:function(e,i){i-=t,b.load(i,(function(){var t=[],o=b.getAudiosList();if(0==+i&&o.length&&t.push('<div class="ape_list_header">'+getLang("audio_edit_playlist_global_results")+"<div>"),o.length)for(var s=Math.min(o.length,i+20),_=i;_<s;_++)t.push(S(o[_]));b.getAudiosCount()||l&&l._offset?(hide(a.emptyGlobalPlaceholder),show(a.list)):(show(a.emptyGlobalPlaceholder),hide(a.list)),e(t)}))}})).drawMore()}),300),m=null)}function U(){_.setOptions({title:'<div class="back _back">'+getLang("global_back")+"</div>",bodyStyle:"padding: 0"})}function W(){var e="";cur.audioAttachSwitchOwnerId&&cur.audioAttachOriginalOwnerId&&(e='<span class="dvd"></span><a class="tab_link" onclick="cur.audioAttachSwitch()">',e+=getLang(h.getOwnerId()<0?"audio_choose_wall_to_my_audios":"audio_choose_wall_to_group_audios"),h.getOwnerId()===cur.audioAttachOriginalOwnerId?cur.audioAttachSwitch=function(){AudioPage.showAttachBox(cur.audioAttachSwitchOwnerId,s)}:cur.audioAttachSwitch=function(){AudioPage.showAttachBox(cur.audioAttachOriginalOwnerId,s)},e+="</a>"),_.setOptions({title:M+e,bodyStyle:"padding: 0"})}function K(){var e=a.boxContent.getBoundingClientRect();if(e.height&&e.width){var t=a.list.getBoundingClientRect();setStyle(a.list,{height:e.height-(t.y-e.y)})}}function x(e,t,i){f=e,t?i?e.search({q:i},(function(e){j(!0,e)})):j(!0,e.getUnshuffledAudiosList()):j(!1,i?C.search(i):o),F("initial"===P&&!i)}function j(e,t){a.list.innerHTML="",l&&l.destroy(),show(a.list),hide(a.emptyPlaceholder),hide(a.emptyGlobalPlaceholder),hide(a.emptyPlaylistsPlaceholder),K();var i=0;l=new _web_auto_list_auto_list__WEBPACK_IMPORTED_MODULE_11__.default(a.list,{scrollNode:a.list,onNoMore:function(){0===i&&(T()?e||(hide(a.list),show(a.emptyPlaylistsPlaceholder)):(hide(a.list),show(a.emptyPlaceholder))),e&&k()},onNeedRows:function(o,s){for(var _=[],a=n||20,l=Math.min(t.length,s+a),r=s;r<l;r++){var d=t[r],u=void 0;if(e)u=S(d);else{var c='<div class="ape_pl_item_inner"><span class="ape_pl_title">'+(A?d.title.replace(A,"$1<em>$2</em>"):d.title)+'</span> <span class="ape_pl_size">'+langNumeric(d.size,cur.lang.audio_playlist_audios_count,!0).replace("{count}",d.size)+"</span></div>";u=`<div class="ape_pl_item"\n                        data-playlist-access-hash="${d.access_hash}"\n                        data-playlist-owner-id="${d.owner_id}"\n                        data-playlist-id="${d.id}">\n                          ${c}\n                        </div>`}_.push(u)}i+=_.length,o(_)},onRendered:e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(a.list,"offset",e),u&&n&&(a.list.scrollTop=u,n=0,u=0)}})}function F(e){g||(g=new _web_grid_sorted__WEBPACK_IMPORTED_MODULE_22__.default(a.list,"ape_audio_item_wrap",{wrapNode:a.list,onReorder:function(e,t){var i,o=domData(geByClass1("_audio_row",e),"full-id"),s=h.indexOfAudio(o);t?(o=domData(geByClass1("_audio_row",t),"full-id"),i=h.indexOfAudio(o)):i=h.getAudiosCount(),h.moveAudio(s,i)}})),e?g.enable():g.disable()}function N(i,l){if("default"===i&&cur.audioPage&&cur.audioPage._data.addBanned)Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__.showFastBox)({title:getLang("global_error")},cur.audioPage._data.addBannedText);else{switch(P=i,_.removeButtons(),domData(a.list,"view",i),i){case"initial":show(a.header),hide(a.addAudiosFromPlaylistsButton),show(a.addAudiosButton),show(a.search),hide(a.globalResults),x(h,!0),H(),W();break;case"default":var r=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,t,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID);Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.disableEl)(a.addAudiosButton),showProgress(a.addAudiosButton),r.load((function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.enableEl)(a.addAudiosButton),hideProgress(a.addAudiosButton),hide(a.header),show(a.search),toggle(a.addAudiosFromPlaylistsButton,w),hide(a.addAudiosButton),"edit"===e?U():W(),x(r,!0,d),K(),"edit"===e&&H()}));break;case"playlists":hide(a.header),show(a.search),hide(a.addAudiosFromPlaylistsButton),hide(a.addAudiosButton),hide(a.globalResults),U(),x(o);break;case"playlist":hide(a.header),show(a.search),hide(a.addAudiosFromPlaylistsButton),hide(a.addAudiosButton),U(),x(l,!0),E&&function(e){if(!s.canPlaylistAttach)return;_.addButton(s.playlistPickerButtonText,(function(t){cur.onChoosePlaylist(t,e)}),"ok",!0)}(l),"edit"===e&&H()}K(),a.searchInput.value="",elfocus(a.searchInput),A=!1,m=null,clearTimeout(R),c&&c.updateCurrentPlaying&&c.updateCurrentPlaying()}}function H(){_.addButton(getLang("audio_save_playlist_button"),z,"ok",!0)}function Y(e){var t=domClosest("ape_pl_item",e.target);if(t){var i=domData(t,"playlist-id"),o=domData(t,"playlist-owner-id"),s=domData(t,"playlist-access-hash"),_=c.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,o,i,s);showProgress(t),_.load((function(){hideProgress(t),N("playlist",_)}))}if(hasClass(e.target,"ape_check")){function l(e,t){if(cur.audioPage&&cur.audioPage._data.addBanned)Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__.showFastBox)({title:getLang("global_error")},cur.audioPage._data.addBannedText);else{var i=toggleClass(e,"ape_selected",t),o=geByClass1("_audio_row",e),s=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAudioFromEl(o);i?h.addAudio(s,0):h.removeAudio(s)}}var r=domClosest("_ape_audio_item",e.target);if(e.shiftKey&&m){var n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.domChildIndex)(m),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.domChildIndex)(r),u=domPN(r);if(n>d){var p=d;d=n,n=p}for(var g=hasClass(m,"ape_selected"),y=n;y<=d;y++)l(u.children[y],g)}else l(r),m=r;G()}if(E&&hasClass(e.target,"artist_link")){if(e.metaKey&&browser.mac||e.ctrlKey)return;var P=domData(e.target,"performer")||trim(e.target.innerText);P&&(val(a.searchInput,P),uiSearch.onChanged(a.searchInput),L(P))}return cancelEvent(e)}function G(){var e,t=h.getAudiosCount(),i=h.getTotalDuration();if(t){var o;e=(e=langNumeric(t,cur.lang.audio_edit_playlist_audios_info)).replace("{count}",t);var s=i%60,_=Math.floor(i/60)%60,l=Math.floor(i/3600);i<60?o=langNumeric(i,cur.lang.audio_total_dur_seconds):i<3600?(o=langNumeric(_,cur.lang.audio_total_dur_minutes),s&&(o+=" "+langNumeric(s,cur.lang.audio_total_dur_seconds))):(o=langNumeric(l,cur.lang.audio_total_dur_hours),_&&(o+=" "+langNumeric(_,cur.lang.audio_total_dur_minutes))),e+='<span class="dvd">'+o+"</span>"}else e=getLang("audio_edit_playlist_no_audios");a.stat.innerHTML=e}function z(e){var i=trim(val(a.playlistNameInput)),o=trim(val(a.playlistDescriptionInput));if(!i)return N("initial"),void Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.notaBene)(ge("ape_pl_name"));var l=[];each(h.getUnshuffledAudiosList(),(function(e,t){l.push(t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_ID]+"_"+t[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_29__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY])}));var r=s.newPlaylistHash||cur.audioPage&&cur.audioPage._data.newPlaylistHash||"";ajax.post("al_audio.php?act=save_playlist",{hash:y?r:D.getEditHash(),owner_id:t,playlist_id:y?0:D.getPlaylistId(),title:i,description:o,Audios:l.join(","),cover:isObject(v)?JSON.stringify(v):v},{showProgress:()=>Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(e),onDone:function(e,i){if(Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")&&(y&&!document.querySelector(".CatalogSection ._audio_page__playlists")))return void nav.reload();each(geByClass("_audio_pl_"+e.ownerId+"_"+e.id),(function(){var t=geByClass1("audio_pl__cover",this);if(t){setStyle(t,"background-image",e.coverUrl?"url("+e.coverUrl+")":null),setStyle(t,"background-size",e.coverUrl?"cover":null);var i=geByClass1("_audio_pl_grid_covers_wrap",this);i&&(i.innerHTML=e.coverUrl?"":e.gridCovers)}var o=geByClass1("audio_pl__title",this);if(o){var s=geByClass1("audio_item__title",o);s?val(s,e.title):val(o,e.title)}var _=geByClass1("_audio_pl__stats_count",this);_&&(_.innerHTML=e.totalCount)})),y&&cur.audioPage&&t==cur.audioPage.getOwnerId()&&(each(geByClass("_audio_page_block__playlists_items",cur.audioPage._els.pageContainer),(function(){var e=se(getTemplate("audio_pl_item",i));this.insertBefore(e,this.firstChild);var t=intval(domData(this,"max-items"));t&&this.children.length>t&&this.removeChild(this.lastChild),show(gpeByClass("_audio_page__playlists",this))})),cur.audioPage._data.playlists=cur.audioPage._data.playlists||[],cur.audioPage._data.playlists.unshift(i)),y&&cur.audioPage&&cur.audioPage.sectionController&&cur.audioPage.sectionController.updateReorder(),cur.audioPage&&cur.audioPage.updatePlaylistsCounter&&cur.audioPage.updatePlaylistsCounter(t),D&&(D.clean(),D.mergeWith(e)),_.hide(!0)},onFail:()=>(_.hide(!0),!0)})}function q(e){show(a.coverThumb),setStyle(a.coverThumb,"background-image","url("+e+")"),addClass(a.uploadCoverButtonWrapper,"ape_thumb_set"),hide(a.uploadCoverButton)}function V(e){return removeClass(a.uploadCoverButtonWrapper,"ape_thumb_set"),hide(geByClass1("_ape_cover_thumb")),show(a.uploadCoverButton),v=-1,cancelEvent(e)}},AudioPage.prototype._deinitKeyEvents=function(){this._audioHQKeyEventHandler1&&removeEvent(window.document,"keydown",this._audioHQKeyEventHandler1),this._audioHQKeyEventHandler2&&removeEvent(window.document,"keyup",this._audioHQKeyEventHandler2),this._audioHQKeyEventHandler3&&removeEvent(window.document,"visibilitychange",this._audioHQKeyEventHandler3),this._audioHQKeyEventHandler4&&removeEvent(window.document,"mousedown",this._audioHQKeyEventHandler4),this._audioSeekKeyEventHandler&&removeEvent(window.document,"keydown",this._audioSeekKeyEventHandler)},AudioPage.prototype._initKeyEvents=function(){this._deinitKeyEvents();var e=getAudioPlayer(),t=()=>!this.isLayer()&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getLayer().isShown();addEvent(window.document,"mousedown",this._audioHQKeyEventHandler4=function(e){e.ctrlKey&&(cur.ctrlMouseDown=!0,cur.ctrlPressed=!1)},!0),addEvent(window.document,"keydown",this._audioHQKeyEventHandler1=function(e){t()||(cur.ctrlPressed=e.keyCode===KEY.CTRL)}),addEvent(window.document,"keyup",this._audioHQKeyEventHandler2=function(e){t()||(e.keyCode!==KEY.CTRL||cur.ctrlMouseDown)&&(delete cur.ctrlMouseDown,delete cur.ctrlPressed)}),addEvent(window.document,"keydown",this._audioSeekKeyEventHandler=function(i){var o=i.target,s=o&&inArray(o.tagName.toLowerCase(),["input","textarea"])&&""!==val(o),_=o&&o.isContentEditable,a=cur&&cur.pvShown;s||_||a||!t()&&e.isPlaying()&&inArray(i.keyCode,[KEY.RIGHT,KEY.LEFT])&&!i.ctrlKey&&e.seekCurrentAudio(i.keyCode===KEY.RIGHT)}),cur.destroy.push(()=>this._deinitKeyEvents())},AudioPage.prototype.editFeed=function(){var e=this;showTabbedBox("al_settings.php",{act:"a_edit_owners_list",list:"audio",height:lastWindowHeight},{stat:[jsc("web/privacy.js"),"privacy.css","ui_controls.js","ui_controls.css",jsc("web/indexer.js")],dark:1}),cur.onOListSave=function(t,i,o,s){var _=curBox(),a={act:"a_ignore_olist",hash:s.hash};return t.length<i.length?a.White=t.join(","):a.Black=i.join(","),ajax.post("al_audio.php",a,{onDone:function(){_.hide(),e.getCurrentPlaylist().clean(),e.refreshCurrentPage()},onFail:()=>!0,showProgress:_.showProgress,hiderogress:_.hideProgress}),!1}},AudioPage.prototype.updateStatusExportControls=function(e){var t=getAudioPlayer(),i=t.getStatusExportInfo();each(geByClass("_audio_export_status",this._els.pageContainer),(function(){toggleClass(this,"on",i&&!!i[domData(this,"oid")])}));var o=t.hasStatusExport(),s=geByClass1("_audio_page_player_status",this._els.pageContainer);if(toggleClass(s,"audio_page_player_btn_enabled",o),!e)if(this.isLayer())cur.audioPage&&cur.audioPage.updateStatusExportControls(!0);else{var _=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getLayer().getPageInstance();_&&_.updateStatusExportControls(!0)}return!1},AudioPage.prototype.updateStatusExport=function(e,t){e&&checkbox(e),t=intval(t);var i,o,s=getAudioPlayer(),_=s.getStatusExportInfo()||{};if(t)_[t]?(delete _[t],i=!1):(_[t]=1,i=!0);else if(s.hasStatusExport()){for(var a in _)_.hasOwnProperty(a)&&delete _[a];i=!1}else _[t=vk.id]=1,i=!0;s.setStatusExportInfo(_),t!=vk.id&&t||checkbox("currinfo_audio",s.hasStatusExport()),this.updateStatusExportControls();var l=s.getCurrentAudio();l&&(o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(l).fullId);ajax.post("al_audio.php?act=toggle_status",{exp:intval(i),oid:t,hash:vk.statusExportHash,id:o,top:intval(null)},{onFail:()=>!0})},AudioPage.prototype.playStatusAudio=function(e,t,i){var o=gpeByClass("_audio_friend",i);getAudioPlayer().playLive(e,{showProgress:showProgress.pbind(o),hideProgress:hideProgress.pbind(o)}),cancelEvent(t)},AudioPage.showActionTooltip=function(e,t){var i=[3,-8,0],o=currentAudioPage(e),s=o&&o.isLayer();hasClass(e,"_audio_page_player_add")?Object(_web_lib_feature_tooltips__WEBPACK_IMPORTED_MODULE_25__.audioShowActionTooltip)(e,i,s):(hasClass(e,"_audio_page_player_play_rate")&&(i[0]=-17),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_26__.showTooltip)(e,{text:t,black:1,shift:i,appendParentCls:"_audio_page_player",forcetodown:s,needLeft:s}))},AudioPage.prototype.onHide=function(){var e=this;cur.nav=cur.nav.filter((function(t){return e._nav_func!=t})),this._deinitKeyEvents()},AudioPage.prototype.showRecoms=function(e,t){if(!t){var i=this._readyAudio?this._readyAudio:getAudioPlayer().getCurrentAudio();t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(i).fullId}nav.go({0:"audios"+this.getOwnerId(),section:"recoms_audio",audio_id:t},null,{nocur:!0})},AudioPage.prototype.onAudioUploaded=function(e,t){if(t){var i=getAudioPlayer(),o=i.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,this.getOwnerId(),_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID);o.addAudio(t,0);var s=i.getCurrentPlaylist();s&&s.getSelf()==o&&s.addAudio(t),"all"===this._currentSection?Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")?nav.reload():this._initAudioRowsAutoList():Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")&&this.resetSection("all");var _=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(t);Object(_web_audio_player_stat_onAdditionalEvent__WEBPACK_IMPORTED_MODULE_10__.onAdditionalEvent)(null,_,{type:_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.TYPE_ADDED,subtype:_shared_audio_AudioStats__WEBPACK_IMPORTED_MODULE_9__.SUBTYPE_UPLOAD,context:"on_audio_uploaded",playlistId:o.getOwnerId()+"_"+o.getPlaylistId()});var a=5,l=this;!function e(i){--a<0||setTimeout((function(){ajax.post("al_audio.php?act=check_audio_data",{audio_owner_id:_.ownerId,audio_id:_.id},{onDone:function(o){if(o){var s=o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]!=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_TITLE];(s=(s=s||o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]!=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER])||o[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]!=t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_FLAGS])&&(getAudioPlayer().updateAudio(_.fullId,o),"all"===l._currentSection&&"audio"===cur.module&&l._initAudioRowsAutoList(),_=o),e(1.5*i)}},onFail:()=>!0})}),i)}(1e3)}},AudioPage.prototype.uploadAudio=function(e){this._data.uploadBanned?Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_19__.showFastBox)({title:getLang("global_error")},this._data.uploadBannedText):showBox("al_audio.php",extend(e||{},{act:"new_audio",gid:this.getOwnerId()<0?-this.getOwnerId():0}),{params:{width:"450px",bodyStyle:"padding: 0px; position: relative;"},dark:1})},AudioPage.prototype.editAudio=function(e,t,i){return showBox("al_audio.php",{act:"edit_audio_box",aid:t},{params:{width:"456px",bodyStyle:"padding: 20px; background-color: #F7F7F7;",hideButtons:1},dark:1}),i&&cancelEvent(i),!1},AudioPage.prototype.restoreRecommendation=function(e){var t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAudioFromEl(e,!0),i={act:"restore_recommendation",hash:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAudioExtra(t).recom.hash,audio_id:t.fullId};nav.objLoc.audio_id&&(i.recommendation_type="query"),nav.objLoc.album_id&&(i.recommendation_type="album"),ajax.post("al_audio.php",i,{onFail:()=>!0}),removeClass(e,"audio_row__deleted");var o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAddRestoreInfo(),s=o[t.fullId].removedCurrentPos,_=getAudioPlayer().getCurrentPlaylist();s>=0&&_&&_.getType()==_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_RECOM&&_.addAudio(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAudioFromEl(e),s),delete o[t.fullId],_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.onRowOver(e,!1,!0)},AudioPage.isInRecentPlayed=function(e){var t=gpeByClass("_audio_playlist",e);return!(!t||!hasClass(t,"audio_recent_rows"))&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(t,"playlist")},AudioPage.prototype.chooseFromMyAudios=function(e){var t=this;AudioPage.editPlaylist(vk.id,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID,"attach",{audioPickerButtonText:getLang("global_add"),playlistPickerButtonText:getLang("global_add"),onAudioChoose:(i,o,s)=>{var _=i.ctrlKey;if(ajax.post("al_audio.php?act=add",{group_id:e,audio_owner_id:s.ownerId,audio_id:s.id,hash:s.addHash},{onDone:i=>{var o=e?-e:vk.id;i&&(Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")?nav.reload():(getAudioPlayer().getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,o,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID).addAudio(i,0),t._initAudioRowsAutoList()))},onFail:()=>!0}),_)o.innerHTML=getLang("audio_choose_added"),addClass(o,"ape_added");else{var a=window.__bq;if(a)for(;a.count();)a.hideLast()}}})},AudioPage.prototype.updateShuffleButton=function(){var e=getAudioPlayer().getCurrentPlaylist()||this._pagePlaylist;if(e){var t=e.isShuffled()&&!e.isInitedSortedList();toggleClass(geByClass1("_audio_page_player_shuffle",this._els.pageContainer),"audio_page_player_btn_enabled",t),this.isLayer()&&cur.audioPage&&cur.audioPage.updateShuffleButton()}},AudioPage.prototype.togglePodcast=function(e,t){if(toggleClass(this._els.player,"audio_player_podcast",e),this._updatePlaybackRate(),!this.isPodcastPage()){toggle(geByClass1("_audio_section_tab__current",this._els.pageContainer),!e);var i=geByClass1("_audio_section_tab__podcast",this._els.pageContainer);toggle(i,e),i&&e&&(t=t||getAudioPlayer().getCurrentAudio(),attr(geByClass1("ui_tab",i),"href","podcasts"+t[_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]))}},AudioPage.prototype.updateFaveButton=function(){var e=getAudioPlayer().getCurrentFaveStatus(),t=geByClass1("audio_page_player_fave",this._els.player);t&&toggleClass(t,"activated",e)},AudioPage.prototype.toggleRepeat=function(){if(!this.isPodcastPage()){var e=getAudioPlayer();e.isRepeatAll()||e.isRepeatCurrentAudio()?e.toggleRepeatCurrentAudio():e.toggleRepeatAll(),this.updateRepeatButton()}},AudioPage.prototype.updateRepeatButton=function(){var e=geByClass("_audio_page_player_repeat");if(e&&e.length){var t=getAudioPlayer(),i=t.isRepeatAll(),o=t.isRepeatCurrentAudio();each(e,(e,t)=>{t.ariaLabel=t.ariaLabel&&AudioPage.getRepeatButtonText(),t.onmouseover=t.onmouseover&&AudioPage.showActionTooltip.bind(void 0,t,AudioPage.getRepeatButtonText),toggleClass(t,"audio_page_player_btn_enabled",i),toggleClass(t,"audio_page_player_btn_repeat_one",o)})}},AudioPage.getRepeatButtonText=function(){var e=getAudioPlayer(),t=e.isRepeatAll(),i=e.isRepeatCurrentAudio(),o="audio_repeat_tooltip";return t?o="audio_repeat_track_tooltip":i&&(o="audio_dont_repeat_tooltip"),getLang(o)},AudioPage.prototype.toggleShuffle=function(e){if(!this.isPodcastPage()){toggleClass(e,"audio_page_player_btn_enabled")&&statlogsValueEvent("audio_sort_stat","audio_sort","shuffle_player",this.isLayer()?"layer":"page");var t=getAudioPlayer().getCurrentPlaylist()||this._pagePlaylist;t.loadAll(function(){t.isShuffled()&&t.isInitedSortedList()?(t.shuffle(0),t.shuffle(irand(1,999999))):t.isShuffled()?t.shuffle(0):t.shuffle(irand(1,999999)),"current"===this._currentSection&&this._initAudioRowsAutoList(!0);var e=getAudioPlayer().getCurrentAudio()||t.getAudioAt(0);getAudioPlayer().play(e,t),this.updateShuffleButton()}.bind(this))}},AudioPage.prototype.toggleFave=function(e){var t=getAudioPlayer().getCurrentAudio()||this._readyAudio;_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(t)&&AudioPlayer.podcastToggleFave(e,t)},AudioPage.prototype.changePlaybackRate=function(e,t){var i=getAudioPlayer().getCurrentAudio()||this._readyAudio;_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(i)&&(getAudioPlayer().podcastChangePlaybackRate(!!t.shiftKey),this._updatePlaybackRate())},AudioPage.prototype._updatePlaybackRate=function(){var e=geByClass1("audio_page_player_play_rate",this._els.player);e&&val(geByClass1("btn_icon",e),AudioPlayer.podcastGetPlaybackRate()+"x")},AudioPage.prototype._getCurrentSearchParams=function(){var e=window.radioBtns["audio_search_type_"+intval(this.isLayer())],t=intval(this._searchSortFilter.selectedItems()[0][0]);return{performer:e&&e.val?1:null,lyrics:hasClass(geByClass1("_audio_fltr_with_lyrics",this._container),"on")?1:null,sort:t?1:null}},AudioPage.searchAudios=function(e,t,i){currentAudioPage(this).searchAudios(e,t,i)},AudioPage.prototype.searchAudios=function(e,t,i){this.lastQuery!==e&&(this.lastQuery=e,this._muteSearch?delete this._muteSearch:(e=trim(e),nav.change(extend(this._getCurrentSearchParams(),{q:e||null}),!1,{fromSearch:!0,globalQuery:e,fromHistory:i,isLayer:this.isLayer()})))},AudioPage.prototype.onUserAction=function(e,t){var i=t.indexOfAudio(e);if(-1!=+i&&t.getType()===_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_SEARCH&&(!(t.getOwnerId()===vk.id&&i>=0&&i<t.getLocalFoundCount())&&t.getSearchParams())){var o=t.getSearchParams();o.globalQuery&&uiSearch.saveHistorySearch(this.searchInputEl,o.globalQuery,e.ownerId,e.id,t.getTotalCount(),t.getTotalCountHash())}},AudioPage.prototype._updateFriendsList=function(e,t,i){if(e=trim(e),this._friendSearchInProgress=!1,e){var o=geByClass1("_audio_friends_list",this._els.pageContainer),s=se('<div class="audio_friends_list _audio_friends_list" style="">'+e+"</div>");i&&(this._shownFriends=[]),domPN(o).appendChild(s),re(o)}},AudioPage.searchMoreFriends=function(e){this._searchMoreFriends(e)},AudioPage.prototype._searchMoreFriends=function(e){this._friendSearchInProgress||(this._friendSearchInProgress=!0,ajax.post("al_audio.php",{act:"search_friends",str:e},{onDone:this._updateFriendsList.bind(this),onFail:()=>!0}))},AudioPage.prototype.showMoreFriends=function(e,t){this._friendSearchInProgress||(this._friendSearchInProgress=!0,this._shownFriends=this._shownFriends||[],each(geByClass("_audio_friend",this._els.pageContainer),function(e,t){this._shownFriends.push(domData(t,"id"))}.bind(this)),ajax.post("al_audio.php",{act:"more_friends",exclude:!t&&this._shownFriends.join(","),owner:t},{showProgress:!!e&&(()=>Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.lockButton)(e)),hideProgress:!!e&&(()=>Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_23__.unlockButton)(e)),onDone:this._updateFriendsList.bind(this),onFail:()=>!0}),statlogsValueEvent("audio_friends_block","show_more"))},AudioPage.prototype.shareAudio=function(){var e=e||getAudioPlayer().getCurrentAudio()||this._readyAudio;_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.shareAudio(!1,e)},AudioPage.prototype.showStatusTooltip=function(e){this.statusTT||(this.statusTT=!0,ajax.post("al_audio.php?act=status_tt",{},{onDone:(t,i)=>{this.statusTT=new ElementTooltip(e,{content:i,width:250,offset:[1,14],elClassWhenShown:"audio_status_tt_shown",id:"audio_status_tt",onFirstTimeShow:function(e){this.sb=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_15__.default(geByClass1("audio_status_wrap",e),{global:!0})},onShow:function(){setTimeout(function(){this.statusTT.sb.update()}.bind(this),0)}.bind(this)}),cur._onStatusExportBtn&&(this.statusTT.show(),this.statusTT.sb.update())},onFail:()=>!0}))},AudioPage.prototype.isLayer=function(){return this._data.isLayer},AudioPage.prototype.isPodcastPage=function(){return!this.isLayer()&&!!this._data.podcastPage},AudioPage.prototype.destroy=function(){this._trackSlider&&this._trackSlider.destroy(),this._volumeSlider&&this._volumeSlider.destroy(),removeEvent(window,"scroll",this._ev_onScroll)},AudioPage.prototype.getPageCurrentPlaylist=function(){return this._pagePlaylist},AudioPage.prototype.clearCurrentPlaylist=function(){if(this.isLayer()){var e=getAudioPlayer();e.deleteCurrentPlaylist();var t=geByClass1("_audio_section_tab__current",this._els.pageContainer);addClass(t,"unshown"),uiTabs.switchTab(domFC(geByClass1("_audio_section_tab__all",this._els.pageContainer)),{noAnim:!0}),this.updateCurrentPlayingInfo(),this.togglePodcast(!1),this.showSection("all",()=>{var t,i=(t=Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_12__.partConfigEnabled)("audio_my_music_new_catalog")?e.getPlaylistsByType(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_MY).find(e=>e.getAudiosList().length):e.getPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_PLAYLIST,vk.id,_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.DEFAULT_PLAYLIST_ID))&&t.getUnshuffledAudiosList()[0];i&&(this._readyAudio=i,this._initPlayer(!0),this.isLayer()&&cur.audioPage&&(cur.audioPage._readyAudio=i,cur.audioPage._initPlayer(!0)))}),this.updateLayerHeight()}},AudioPage.prototype.setTooltipTitle=function(e){if(!e.titleSet){var t=geByClass1("audio_page_player_title_performer",e),i=geByClass1("audio_page_player_title_song",e);(t.scrollWidth>t.clientWidth||i.scrollWidth>i.clientWidth)&&e.setAttribute("title",e.innerText),e.titleSet=!0}},AudioPage.prototype._initPlayer=function(e){var t=this,i=getAudioPlayer(),o=this._els.pageContainer,s=geByClass1("_audio_page_player",o),_=geByClass1("audio_page_player_title",s),a=geByClass1("audio_page_player_title_performer",s),l=geByClass1("audio_page_player_title_song",s),r=geByClass1("audio_page_player_title_song_title",s),n=geByClass1("audio_page_player_title_song_subtitle",s),d=geByClass1("audio_page_player_duration",s),u=geByClass1("_audio_page_player__cover",s),c=geByClass1("_audio_page_player_play",s),h=geByClass1("_play_blind_label",c),p=geByClass1("_audio_page_player_add",s),g=void 0;function y(e){if(i.ads.isPlaying())a.innerHTML=getLang("global_audio_ad"),setStyle(l,"display","none"),toggleClass(s,"audio_song_is_explicit",!1);else{var o=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAudioPerformers(e);e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(e),setStyle(l,"display","block"),a.innerHTML=geByClass1("audio_page_player2")?o:e.performer,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(e)?r.innerHTML=`<a href="/podcast${e.fullId}" onclick="return showPodcast(this, '${e.fullId}', event, 'player');" class="audio_player_podcast_title">${e.title}</a>`:r.innerHTML=e.title,n.innerHTML=e.subTitle?e.subTitle:"",e.coverUrl_p?(setStyle(u,"background-image","url("+e.coverUrl_p+")"),setStyle(u,"background-size","cover")):(setStyle(u,"background-image",null),setStyle(u,"background-size","")),toggleClass(s,"audio_title_long_performer",e.isLongPerformer),toggleClass(s,"audio_song_is_explicit",e.isExplicit),!t.isLayer()&&i.getCurrentAudio()&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(i.getCurrentAudio()).fullId==e.fullId&&(setDocumentTitle(replaceEntities(stripHTML(e.performer+" - "+e.title))),clearTimeout(window.pageSetTitleTimer)),l&&setStyle(l,"display","none"),a&&setStyle(a,"display","none"),requestAnimationFrame(()=>{var e=i.ads.isPlaying()?"none":"block";l&&setStyle(l,"display",e),a&&setStyle(a,"display","block")})}}function E(e,t){return t=intval(t),AudioPlayer.getDurationType()&&1!=e?"-"+formatTime(Math.round(t-e*t)):formatTime(Math.round(e*t))}function P(){if(t._trackSlider){var e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(i.getCurrentAudio()||t._readyAudio);if(e){var o;o=t.getOwnerId()<0&&t.canAddToGroup()?e.ownerId!=t.getOwnerId():e.ownerId!=vk.id,g!==o&&(toggle(p,o),g=o),cur._audioAddRestoreInfo=cur._audioAddRestoreInfo||{};var s=cur._audioAddRestoreInfo[e.fullId];addClass(p,"no_transition"),toggleClass(p,"audio_player_btn_added",!(!s||"added"!=s.state)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.removeClassDelayed)(p,"no_transition"),t.updateRepeatButton()}}}if(!this._trackSlider){var f=i.ads.isPlaying()?i.ads.getCurrentProgress():i.getCurrentProgress(),b=i.ads.isPlaying()?0:i.getCurrentBuffered(),A=geByClass1("audio_page_player_track_slider",s),v=geByClass1("audio_page_player_volume_slider",s);A&&(this._trackSlider=new _web_legacy_ui_slider__WEBPACK_IMPORTED_MODULE_16__.default(A,{value:f,backValue:b,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>{var t=i.getCurrentAudio()||this._readyAudio;return t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(t),formatTime(Math.round(e*(t?t.duration:0)))},onEndDragging:e=>{var t=i.getCurrentAudio()||this._readyAudio;(t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(t))&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(t)&&i.podcastSetActionRef(t,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.PodcastsLogs.ACTION_SEEK,"",s),i.seek(e)}}),i.ads.isPlaying()&&(this._trackSlider.toggleAdState(!0),this.toggleRemoveAdsLink(!0))),v&&(this._volumeSlider=new _web_legacy_ui_slider__WEBPACK_IMPORTED_MODULE_16__.default(v,{value:i.getVolume(),size:1,hintClass:"audio_player_hint",log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>{i.setVolume(e)}})),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_DEINITED,()=>{}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_READY,()=>{}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_STARTED,()=>{this.toggleRemoveAdsLink(!0),this._trackSlider&&(this._trackSlider.toggleAdState(!0),this._trackSlider.setBackValue(0))}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.AD_COMPLETED,()=>{this.toggleRemoveAdsLink(!1),this._trackSlider&&this._trackSlider.toggleAdState(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.START_LOADING,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!0)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.CAN_PLAY,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.ADDED,(e,t)=>{(e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(e))&&e.fullId==t&&addClass(p,"audio_player_btn_added")}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.REMOVED,(e,t)=>{(e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(e))&&e.fullId==t&&removeClass(p,"audio_player_btn_added")}),i.on(this,[_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PLAY,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PLAY_REQUESTED],(e,t,o)=>{delete this._readyAudio,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(s,"audio",e),P(),y(e),addClass(c,"audio_playing"),t&&!cur.audioStartReadyAudio&&(this._trackSlider&&this._trackSlider.setBackValue(0),i.ads.isPlaying()||(d.innerHTML=E(0,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(e).duration)),_.setAttribute("title",""),_.titleSet=!1),h.innerHTML=getLang("global_audio_pause"),this.updateCurrentPlayingInfo(),this.updateShuffleButton(),this.updateFaveButton()}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PAUSE,()=>{removeClass(c,"audio_playing"),h.innerHTML=getLang("global_audio_play")}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.STOP,()=>{removeClass(c,"audio_playing"),h.innerHTML=getLang("global_audio_play")}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.BUFFERED,(e,t)=>{this._trackSlider&&this._trackSlider.setBackValue(t)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.VOLUME,(e,t)=>{this._volumeSlider&&this._volumeSlider.setValue(t)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.ENDED,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.UPDATE,(e,t)=>{e&&y(e),i.ads.isPlaying()||e&&t&&(d.innerHTML=E(t,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(e).duration))}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.PROGRESS,(e,t,i)=>{this._trackSlider&&(this._trackSlider.toggleLoading(!1),this._trackSlider.setValue(t)),isUndefined(i)||isNaN(i)||(d.innerHTML=E(t,i))}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.FAILED,()=>{this._trackSlider&&this._trackSlider.toggleLoading(!1)}),i.on(this,_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_8__.events.CURRENT_CHANGED,()=>{var e=i.getCurrentAudio()||this._readyAudio;domData(this._els.player,"audio",JSON.stringify(e)),this.togglePodcast(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(e),e),this._trackSlider.setValue(0)})}var m=i.getCurrentAudio()||this._readyAudio;m&&(domData(s,"audio",JSON.stringify(m)),y(m),toggleClass(c,"audio_playing",i.isPlaying()),d.innerHTML=E(1,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(m).duration),e&&this._trackSlider&&(this._trackSlider.setValue(0),this._trackSlider.setBackValue(0),this._trackSlider.toggleLoading(!1))),P();var O=i.getCurrentAudio()||this._readyAudio;this.togglePodcast(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isPodcast(O),O),this.isLayer()||this._initFixedPlayer()},AudioPage.prototype._initFixedPlayer=function(){var e=getSize(this._els.playerWrap);setStyle(this._els.playerWrap,{width:e[0],height:e[1]});var t=getSize(this._els.player);setStyle(this._els.player,{width:t[0],height:t[1]});var i,o,s=getSize("page_header_wrap")[1],_=getXY(this._els.contentBlock)[1],a=getXY(this._els.playerWrap)[1]+getSize(this._els.playerWrap)[1]-s,l=!1,r=()=>{var e=scrollGetY(),t=e>_;if(e<a&&(i||l))return clearTimeout(i),clearTimeout(o),removeClass(this._els.player,"audio_page_player_fixed_shown"),removeClass(this._els.player,"audio_page_player_fixed"),void(l=i=!1);t&&!l&&(clearTimeout(i),i=0,addClass(this._els.player,"audio_page_player_fixed"),o=setTimeout(()=>addClass(this._els.player,"audio_page_player_fixed_shown")),l=!0),!t&&l&&(clearTimeout(i),i=0,removeClass(this._els.player,"audio_page_player_fixed_shown"),i=setTimeout(()=>{removeClass(this._els.player,"audio_page_player_fixed"),i=!1},250),l=!1)};addEvent(window,"scroll",r),cur.destroy.push(()=>{r&&removeEvent(window,"scroll",r)})},AudioPage.prototype.togglePlayerPlay=function(e){var t=getAudioPlayer();if(t.isPlaying()){var i=t.getCurrentAudio();i&&t.podcastSetActionRef(i,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.PodcastsLogs.ACTION_PAUSE,"",e),t.pause()}else{var o,s=this.getPageCurrentPlaylist(),_=t.getCurrentPlaylist(),a=t.getCurrentAudio(),l=this._readyAudio?this._readyAudio:a;if(l=l||s.getAudioAt(0),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.isClaimedAudio(l)){l=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.asObject(l);var r=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.getAudioExtra(l).claim;return void Object(_web_lib_feature_boxes__WEBPACK_IMPORTED_MODULE_17__.showAudioClaimWarning)(l,r)}s&&-1!==s.indexOfAudio(l)?o=s:_&&-1!==_.indexOfAudio(l)?o=_:(o=new _web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist(_web_audio_player_components_AudioPlaylist__WEBPACK_IMPORTED_MODULE_13__.AudioPlaylist.TYPE_TEMP,vk.id)).addAudio(l),delete this._readyAudio,cur.audioStartReadyAudio=!0,t.podcastSetActionRef(l,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_28__.AudioUtils.PodcastsLogs.ACTION_PLAY,"",e),t.play(l,o)}},AudioPage.prototype.promoAlbumSlideInit=function(){var e=geByClass1("audio_promo");if(!this.isLayer()&&e){var t=geByClass1("audio_promo__items",e);if(t&&!(t.children.length<=1)){this.promoAlbumSlideAutoStart(t);var i=()=>this.promoAlbumSlideAutoStop(),o=()=>this.promoAlbumSlideAutoStart(t);addEvent(e,"mouseenter",i),addEvent(e,"mouseleave",o),window.cur&&cur.destroy.push(()=>{this.promoAlbumSlideAutoStop(),removeEvent(e,"mouseenter",i),removeEvent(e,"mouseleave",o)})}}},AudioPage.prototype.promoAlbumSlideAutoStart=function(e){window.cur&&(cur._promoAlbumSlideTO=setTimeout(()=>this.promoAlbumSlide(e,1),SLIDER_TIMEOUT))},AudioPage.prototype.promoAlbumSlideAutoStop=function(){window.cur&&clearTimeout(cur._promoAlbumSlideTO)},AudioPage.prototype.promoAlbumSlide=function(e,t){var i=vk.rtl?t>0?-1:1:t<0?-1:1,o=gpeByClass("audio_promo",e);if(o){var s=geByClass1("audio_promo__items",o);if(s&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(s,"sliding")){this.promoAlbumSlideAutoStop();var _=s.scrollLeft,a=s.offsetWidth,l=s.children,r=l.length,n=e=>vk.rtl?s.scrollWidth-e*a-a:e*a;if(l.length>1){this.promoAlbumSlideAutoStart(e);var d=!1,u=null,c=!1,h=Math.round(_/a);(h+=i)>=r||h<0?(d=l[0].cloneNode(!0),s.appendChild(d),h>=r?(c=!0,u=n(h)):h<0&&(s.scrollLeft=n(r),u=n(h=r-1))):u=n(h),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(s,"sliding",!0),animate(s,{scrollLeft:u},{duration:500,transition:Fx.Transitions.swiftOut,onComplete:()=>{c&&(s.scrollLeft=n(0)),d&&re(d),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_18__.data)(s,"sliding",!1)}})}}}},AudioPage.prototype.promoAlbumClose=function(e,t){var i=gpeByClass("audio_promo__block",e),o=gpeByClass("audio_promo__items",i),s=gpeByClass("audio_promo",i);re(i);var _=o.children.length;if(_<=1){var a=geByClass1("audio_promo__left",s),l=geByClass1("audio_promo__right",s);addClass(a,"hidden"),addClass(l,"hidden")}_||addClass(s,"hidden"),ajax.post("al_audio.php",{act:"hide_promo",promo_name:t},{onFail:()=>!0})},AudioPage.prototype.toggleRemoveAdsLink=function(e){toggleClass(this._els.player,"audio_page_player_show_remove_ads",!!e)},AudioPage.prototype.showPromoBox=function(){this.isPodcastPage()||ajax.post("al_audio.php?act=need_show_promo",{},{onDone:function(e){e&&showWiki({w:"promo_box"})}})}},112:function(e,t,i){e.exports=i("9IjV")},"4PuL":function(e,t,i){"use strict";i.r(t);var o=i("lXE5"),s=i("aong"),_=i("zxIV"),a=i("t7n3"),l=i("Egk5");function r(e,t,i){if(Object(a.isObject)(t)?i=t:this._dragElClass=t,this.options=Object(a.extend)({dragThreshold:r.DRAG_THRESHOLD_DIST},i),this._contEl=Object(_.ge)(e),this._contEl){this._excludedCount=0;for(var o=0;o<this._contEl.children.length;o++)this._contEl.children[o].getAttribute("nodrag")&&this._excludedCount++;Object(l.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),Object(_.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}r.AUTO_SCROLL_DY=10,r.DRAG_THRESHOLD_DIST=0,r.AUTO_SCROLL_DISTANCE_THRESHOLD=300,r.AUTO_SCROLL_GAP=300,r.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},r.prototype._getParentDragItemEl=function(e){for(var t,i=e;i&&(t=Object(_.domPN)(i))!==this._contEl;)i=t;return i===this._curPlaceholderEl&&(i=null),i},r.prototype._onKey=function(e){e.keyCode===l.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},r.prototype._onMouseDown=function(e){if(!(this._disabled||0!=e.button||this._curDragEl||Object(_.attr)(e.target,"nodrag")||this._dragElClass&&!Object(_.domClosest)(this._dragElClass,e.target))){for(var t=e.target;t&&t!==window.document;){if(Object(a.intval)(Object(_.domData)(t,"nodrag")))return;t=Object(_.domPN)(t)}var i=this._getParentDragItemEl(e.target);if(i&&!Object(_.attr)(i,"nodrag")&&(Object(_.re)(Object(_.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:Object(_.getSize)(this._contEl)},this._ensureGridIsActual(),!(this._grid.length<=1))){var o=window.getComputedStyle(i),s=Object(_.getXY)(i);this._initial={candidateEl:i,x:e.clientX,y:e.clientY,itemMargin:{x:parseInt(o.marginLeft),y:parseInt(o.marginTop)},shift:{x:e.pageX-s[0],y:e.pageY-s[1]}},Object(l.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),Object(l.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),Object(l.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,Object(l.cancelEvent)(e)}}},r.prototype._dist=function(e){return Math.abs(e.clientX-this._initial.x)+Math.abs(e.clientY-this._initial.y)},r.prototype._onMouseUp=function(e){var t=this._curDragEl,i=!e;if(this._curDragEl){this._curDragEl=null,Object(_.removeClass)(t,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:Object(_.getXY)(this._curPlaceholderEl),size:Object(_.getSize)(this._curPlaceholderEl)});var o=this._curOverCell.pos,s=this._curOverCell.el,a=this._grid[this._curDragCellIndex],r=a&&a.size;Object(_.gpeByClass)("_ape_item_list",t)&&(o[0]+=20,o[1]+=20),r&&this._isShiftToLeft&&(o[1]-=r[1]-this._curOverCell.size[1]),setTimeout(()=>{if(i){for(var e=0,s=this._grid.length;e<s;e++){var _=this._grid[e];_.dirty&&this._setPos(_.el,{left:0,top:0})}this._setPos(t,this._initialCurDragPos)}else this._setPos(t,{left:o[0],top:o[1]})}),setTimeout(()=>{if(Object(_.re)(this._curPlaceholderEl),Object(_.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&Object(_.removeClass)(t,this.options.dragCls),this._inited){var e;if(i){for(var o=this._grid.length,a=0;a<o;a++){var l=this._grid[a];l.dirty&&this._setPos(l.el,{left:null,top:null})}this._setPos(t,{left:null,top:null,width:null,height:null})}else{var r;e=this._isShiftToLeft?Object(_.domNS)(s):s,this._contEl.insertBefore(t,e);var n=-1,d=this._initial.hasInlineSize;this._setPos(t,{left:null,top:null}),d||Object(_.setStyle)(t,{width:null,height:null});for(var u=this._grid.length,c=0;c<u;c++){var h=this._grid[c];(h.dirty||h.el===t)&&(this._setPos(h.el,{left:null,top:null}),d||Object(_.setStyle)(h.el,{width:null,height:null}),h.pos=this._calcElementPos(h.el),h.dirty=!1),h.el===t?r=c:h.el===s&&(n=c)}if(n>=0){var p=this._grid.splice(r,1);this._grid.splice(n,0,p[0])}}Object(_.removeClass)(t,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,i&&this.update(),s!==t&&!i&&this.options.onReorder&&this.options.onReorder(t,e,Object(_.domPS)(t))}},210),e&&this._dist(e)>5&&(Object(l.cancelEvent)(e),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),t&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,t),i||t&&this._overEl&&this.options.onDragDrop&&(i=this.options.onDragDrop(this._overEl,t)),this._overEl=null},r.prototype._deinitEvents=function(e){e&&(this._onMouseUp(),Object(l.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&Object(l.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&Object(l.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&Object(l.removeEvent)(document,"keydown",this._ev_keydown_handler)},r.prototype._setPos=function(e,t){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(e).getPropertyValue("transform"))?Object(_.setStyle)(e,Object(a.extend)({transform:null},t)):null===t.left||null===t.top?Object(_.setStyle)(e,{transform:null,top:null,left:null}):Object(_.setStyle)(e,{transform:"translate("+t.left+"px, "+t.top+"px)",top:null,pos:null})},r.prototype._recalc=function(){var e=this._curDragEl,t=this._curOverCell.el;if(this._initGrid(),t!==e){for(var i=0,o=!1,s=!1,_=this._grid.length,a=0;a<_;a++){var l=this._grid[a];if(l.el===e){o=!0;break}if(l.el===t){o=!1;break}}this._isShiftToLeft=o;for(var r=o?0:this._grid.length-1,n=o?this._grid.length:-1,d=o?1:-1,u=[0,0];r!==n;r+=d){var c=this._grid[r];if(2!==i)if(c.el!==e){if(c.el===t&&i++,1===i||2===i){var h=0,p=0;o?(h=s.pos[0]+u[0],p=s.pos[1]+u[1],u[0]+=c.size[0]-s.size[0],u[1]+=c.size[1]-s.size[1]):(u[0]+=s.size[0]-c.size[0],u[1]+=s.size[1]-c.size[1],h=s.pos[0]+u[0],p=s.pos[1]+u[1]),this._setPos(c.el,{left:h-c.pos[0],top:p-c.pos[1]}),c.dirty=!0}else c.dirty&&(this._setPos(c.el,{left:null,top:null}),c.dirty=!1);s=c}else i++,s=c;else c.dirty&&(this._setPos(c.el,{left:null,top:null}),c.dirty=!1),s=c}}else for(var g=this._grid.length,y=0;y<g;y++){var E=this._grid[y];E.el!==e&&E.dirty&&(E.dirty=!1,this._setPos(E.el,{left:null,top:null}))}},r.prototype.disable=function(){this._disabled=!0},r.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},r.prototype.update=function(){this._disabled||this._initGrid(!0)},r.prototype._ensureGridIsActual=function(){this._initGrid()},r.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||Object(_.getSize)(this._contEl);var e=0,t=this._contEl.children.length-this._excludedCount-Object(a.intval)(!!this._curPlaceholderEl);if(t!==this._grid.length)e=t>this._grid.length?2:1,this._contInfo.prevSize=Object(_.getSize)(this._contEl);else{var i=Object(_.getSize)(this._contEl),o=this._contInfo.prevSize;(Math.abs(o[0]-i[0])>5||Math.abs(o[1]-i[1])>5)&&(e=1),this._contInfo.prevSize=i}return e},r.prototype._initGrid=function(e){var t=e?1:this._needGridUpdate();if(t){1===t&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));var i=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];var o,s=!!i,a=this._contEl.children;if(a.length)for(var l=this._getItemMargins(),r=this._curDragEl?this._grid.length:0,n=a.length;r<n;r++){var d=a[r];i&&d===i.el?s=!1:s||d===this._curPlaceholderEl||d.getAttribute("nodrag")||((o=Object(_.getSize)(d))[0]+=l[0],o[1]+=l[1],this._grid.push({el:d,size:o,pos:this._calcElementPos(d)}))}}},r.prototype._getRelativeMousePos=function(e){var t=this._getContPos(),i=this._getContShift();return{left:e.clientX-t[0]-i[0],top:e.clientY-t[1]-i[1]}},r.prototype._updateDraggablePosition=function(e){if(this._curDragEl){var t=this._getRelativeMousePos(e),i=this._getItemShift(),o=this._getContShift(),s=this._getContSize(),a=t.top-this._initial.shift.y-i[1]+o[1];this.options.limitBottomMove&&(a=Math.min(a,s[1]+30)),Object(_.hasClass)(this._contEl,"_ape_item_list")&&(a+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:t.left-this._initial.shift.x-i[0]+o[0],top:a}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()}},r.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){var e=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(e.paddingLeft),parseFloat(e.paddingTop)]}return this._contInfo.shift},r.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=Object(_.getSize)(this._contEl),this._contInfo.size},r.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=Object(_.getXY)(this._contEl),this._contInfo.pos[1]-=Object(o.scrollGetY)(),this._contInfo.pos},r.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){var e=window.getComputedStyle(Object(_.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(e.marginLeft),parseFloat(e.marginTop)]}return this._contInfo.itemShift},r.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){var e=window.getComputedStyle(Object(_.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(e.marginLeft)+parseFloat(e.marginRight),parseFloat(e.marginTop)+parseFloat(e.marginBottom)]}return this._contInfo.itemMargins},r.prototype._calcElementPos=function(e){var t=this._getContShift(),i=this._getItemShift();return[e.offsetLeft-t[0]-i[0],e.offsetTop-t[1]-i[1]]},r.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},r.prototype._initUpdaterScrollbar=function(){return Object(s.throttle)(e=>{var t=this.options.wrapNode||e,i=Object(_.data)(t,"sb");i&&i.update(!1,!0)},500)},r.prototype._onMouseMove=function(e){var t=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:Object(o.scrollGetY)(),i=e=>{this.options.wrapNode?this.options.wrapNode.scrollTop=e:Object(o.scrollToY)(e,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!e&&(e={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:e.clientX,y:e.clientY},this._updateDraggablePosition(e);var s=this._getContSize(),a=this._getRelativeMousePos(e),r=!1;if(Object(_.hasClass)(this._contEl,"_ape_item_list")&&(a.top+=this._contEl.scrollTop),a.left>0&&a.left<s[0]&&a.top>0&&a.top<s[1])for(var n=0,d=this._grid.length-1,u=50;u;){var c=n+Math.floor((d-n)/2),h=this._grid[c];if(a.left>h.pos[0]&&a.top>h.pos[1]&&a.left<h.pos[0]+h.size[0]&&a.top<h.pos[1]+h.size[1]){r=h;break}if(n===d)break;a.top<h.pos[1]||a.left<h.pos[0]&&a.top<h.pos[1]+h.size[1]?d=d===c?d-1:c:n=n===c?n+1:c,u--}else{for(var p,g,y,E=this._grid.length,P=999999,f=0;f<E;f++){var b=this._grid[f],A=(g=a.left-(b.pos[0]+b.size[0]/2))*g+(y=a.top-(b.pos[1]+b.size[1]/2))*y;P>A&&(P=A,p=b)}r=p}!r||this._curOverCell&&this._curOverCell.el===r.el||(this._curOverCell=r,this._recalc());var v,m,O,C,w=0;if(this.options.wrapNode)v=C=this.options.wrapNode,m=Object(_.getSize)(v),(O=Object(_.getXY)(v))[1]-=Object(o.scrollGetY)(),w=e.clientY;else{var D=window,M=document.documentElement,L=document.getElementsByTagName("body")[0],B=D.innerWidth||M.clientWidth||L.clientWidth,I=D.innerHeight||M.clientHeight||L.clientHeight;C=D.bodyNode,m=[B,I],O=[0,0],w=e.clientY}var T=Math.max(20,m[1]/10),S=O[1]+T-w,R=T-(O[1]+m[1]-w);if(R>0||S>0){var k=Math.min(1,S/T),U=Math.min(1,R/T);this._autoScrollTO||(this._autoScrollTO=setTimeout(()=>{this._autoScrollTO=!1;var e=t();i(e+16*(k>0?-k:U)),e!==C.scrollTop&&(this._updateScrollbar(C),this._onMouseMove())},20))}if(this.options.onDragOverElClass){var W=e.target;Object(_.hasClass)(W,this.options.onDragOverElClass)||(W=Object(_.gpeByClass)(this.options.onDragOverElClass,W))?this._overEl!==W&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(W,this._curDragEl),this._overEl=W):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(e)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;for(var K=this._grid.length,x=0;x<K;x++)if(this._grid[x].el===this._curDragEl){this._curDragCellIndex=x;break}this.options.dragCls&&Object(_.addClass)(this._curDragEl,this.options.dragCls);var j=Object(_.getSize)(this._curDragEl),F=Object(_.getXY)(this._curDragEl),N=window.getComputedStyle(this._curDragEl),H=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),Object(_.setStyle)(this._curDragEl,{width:j[0],height:j[1]}),this._initialCurDragPos={left:F[0]-H[0],top:F[1]-H[1]-bodyNode.scrollTop},this._curPlaceholderEl=Object(_.ce)("div",{className:"ui_gridsorter_placeholder"}),Object(_.setStyle)(this._curPlaceholderEl,{width:j[0]+parseFloat(N.marginLeft)+parseFloat(N.marginRight),height:j[1]+parseFloat(N.marginTop)+parseFloat(N.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),Object(_.addClass)(this._curDragEl,"ui_gridsorter_moveable"),Object(_.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),Object(_.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(e),this._updateDraggablePosition(e)}Object(l.cancelEvent)(e)},t.default=r},"4mg9":function(e,t,i){"use strict";i.r(t),i.d(t,"BlockController",(function(){return p}));var o,s=i("ldAL"),_=i("vDiJ"),a=i("TmuT"),l=function(){return(l=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},r=function(){function e(e,t){this.element=e;var i=this.getConfig();this.dropdown=new window.InlineDropdown(e,l({onSelect:t},i))}return e.prototype.getConfig=function(){var e=this.element.querySelector("."+_.SORTER_ACTION_DATA);if(!e)return null;var t=e.querySelectorAll("li");if(!t||!t.length)return null;var i={};return i.items=Array.prototype.map.call(t,(function(e){var t=e.dataset.id;return e.dataset.selected&&(i.selected=t),[t,e.innerText]})),i.withArrow=!0,e.remove(),i},e}(),n=i("4PuL"),d=i("D1OX"),u=i("btP0"),c=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),h=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var o=Array(e),s=0;for(t=0;t<i;t++)for(var _=arguments[t],a=0,l=_.length;a<l;a++,s++)o[s]=_[a];return o},p=function(e){function t(t,i){var o=e.call(this)||this;return o.section=t,o.block=i,o.setFromBlockContent(),o.blockItemsContainer=i.querySelector("."+_.BLOCK_ITEMS_CONTAINER),o.blockItemsContainer&&(o.initialItems=h(o.blockItemsContainer.children)),o.initGallery(),o.loader=i.getElementsByClassName(_.AUTO_LIST_LOADER)[0],o.initSearch(),o}return c(t,e),t.prototype.initSearch=function(){var e=this.block.getElementsByClassName("ui_search");e.length&&Array.prototype.forEach.call(e,(function(e){return u.default.init(e)}))},t.prototype.onSectionInit=function(){this.initSortSelector(),this.blockItemsContainer&&this.blockItemsContainer.classList.contains(_.BLOCK_ITEMS_REORDERABLE)&&this.initListReorder(!!this.initialItems.length)},t.prototype.hasBlockName=function(e){return this.blockContent&&this.blockContent.classList.contains(_.BLOCK_ELEMENT+"__"+e)},t.prototype.reloadData=function(){var e=this;this.fetchSection(this.id,"").then((function(i){var o=i.blockItems;e.clearItems(),e.setItems(t.createNodesFromItems(o))})).catch((function(){return!0}))},t.prototype.setFromBlockContent=function(){this.blockContent=this.block.querySelector("."+_.BLOCK_CONTENT),this.blockContent&&(this.id=this.blockContent.dataset.id||"",this.nextFrom=this.blockContent.dataset.next||"",this.dataType=this.blockContent.dataset.type||null)},t.prototype.clearList=function(){this.blockItemsContainer&&(this.blockItemsContainer.innerHTML="")},t.prototype.destroy=function(){this.blockAutoList&&this.blockAutoList.destroy(),this.reorderer&&this.reorderer.destroy()},t.prototype.hideLoader=function(){this.loader&&(this.loader.style.display="none")},t.prototype.showLoader=function(){this.loader&&(this.loader.style.display="")},t.prototype.setNextFrom=function(e){this.nextFrom=e,this.blockContent&&(this.blockContent.dataset.next=this.nextFrom)},t.prototype.setId=function(e){this.id=e,this.blockContent&&(this.blockContent.dataset.id=this.id),this.blockItemsContainer&&this.blockItemsContainer.dataset.playlistId&&(this.blockItemsContainer.dataset.playlistId=this.id)},t.prototype.getId=function(){return this.id},t.prototype.setItems=function(e){var t;this.blockItemsContainer&&(this.blockItemsContainer.innerHTML="",(t=this.blockItemsContainer).append.apply(t,e))},t.prototype.resetItems=function(){var e;this.blockItemsContainer&&(this.clearItems(),(e=this.blockItemsContainer).append.apply(e,this.initialItems))},t.prototype.clearItems=function(){this.blockItemsContainer&&(this.blockItemsContainer.innerHTML="")},t.prototype.initAutoList=function(e){var t=this;void 0===e&&(e=[]);var i=e;this.blockItemsContainer&&(this.blockAutoList&&this.blockAutoList.destroy(),this.blockAutoList=new s.default(this.blockItemsContainer,{scrollNode:!1,onRendered:function(){return window.getAudioPlayer().updateCurrentPlaying()},onNoMore:function(){return t.hideLoader()},onNeedRows:function(e){if(t.showLoader(),i.length){var o=i;return i=[],void e(o)}t.nextFrom?t.fetchNext().then((function(i){var o=i.blockItems,s=i.data;t.setNextFrom(s.nextFrom),e(o)})).catch((function(){})):e(null)}}))},t.prototype.updateListReorder=function(){this.reorderer&&this.reorderer.update()},t.prototype.initListReorder=function(e){var t,i=this;switch(void 0===e&&(e=!0),this.dataType){case"music_audios":t=function(t,o,s){return i.onAudioBlockReorder(t,o,s,e)};break;case"music_playlists":t=this.onPlaylistsBlockReorder.bind(this);break;default:t=function(){}}this.reorderer=new n.default(this.blockItemsContainer,"",{onReorder:t.bind(this)})},t.prototype.onAudioBlockReorder=function(e,t,i,o){window.currentAudioPage(this.block).onAudioRowsReorder(!o,e,t,i)},t.prototype.onPlaylistsBlockReorder=function(e,t,i){window.currentAudioPage(this.block).onPlaylistsReorder(e,t,i)},t.prototype.initSortSelector=function(){var e=this,i=this.block.querySelector("."+_.SORTER_ACTION);if(i){var o=i.dataset.targetId,s=o?this.section.getBlockById(o):this;s&&(this.sortSelector=new r(i,(function(i){s.setId(i),s.setNextFrom(""),e.section.isBlockPagination=!0,s.fetchNext().then((function(e){var i=e.blockItems,o=e.data;s.setItems(t.createNodesFromItems(i)),s.setNextFrom(o.nextFrom),s.initAutoList()})).catch((function(){return!0}))})))}},t.prototype.initGallery=function(){this.blockItemsContainer&&this.blockItemsContainer.classList.contains(_.GALLERY)&&(this.gallery=new d.UIGallery(this.blockItemsContainer,{scrollY:!1}))},t.search=function(e,i,o,s){var _=t.findBlockById(e,s.target);_&&!_.fetchInProgress&&(o?_.fetchSection(i,"",{search_query:o}).then((function(e){var i=e.blockItems;_.setItems(t.createNodesFromItems(i))})).catch((function(){return!0})):_.resetItems())},t.showMore=function(e,i){var o=t.findBlockById(e,i);o&&!o.fetchInProgress&&o.fetchNext().then((function(e){var i=e.blockItems,s=e.data;o.setItems(t.createNodesFromItems(i)),o.nextFrom=s.nextFrom})).catch((function(){return!0}))},t.findBlockById=function(e,t){var i=window.currentAudioPage(t).sectionController;return i?i.getBlockById(e):null},t.createNodesFromItems=function(e){return e.map((function(e){var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}))},t}(a.BaseController)},"9IjV":function(e,t,i){"use strict";function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t.querySelector(e)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return t.querySelectorAll(e)}i.r(t),window.$=o,window.$$=s,function(){HTMLElement.prototype.$=HTMLElement.prototype.querySelector,HTMLElement.prototype.$$=HTMLElement.prototype.querySelectorAll;try{SVGElement.prototype.$=SVGElement.prototype.querySelector,SVGElement.prototype.$$=SVGElement.prototype.querySelectorAll}catch(e){}}();var _=i("rEJs");class a{constructor(e,t){this.playlistElement=o("#playlist-"+e),this.playlist=t,this.playlistList=o(`.${a.playListClass}__list`,this.playlistElement),this.playlistListAll=o(`.${a.actionButtonsClass}--all`,this.playlistList),this.audio={},this.audioElements=s(`.${a.playListClass}__audioRow`,this.playlistList);for(var i=0;i<this.audioElements.length;i++)this.audio[this.audioElements[i].dataset.fullId]=this.audioElements[i];this.body=o(`.${a.playListClass}__body`,this.playlistElement),this.shuffle=o(`.${a.actionButtonsClass}--shuffle`,this.body),this.actions=o(`.${a.playListClass}__actions`,this.playlistElement),this.actions&&(this.add=o(`.${a.actionButtonsClass}--add`,this.actions),this.addText=o(`.${a.actionButtonsClass}--add__text`,this.add),this.share=o(`.${a.actionButtonsClass}--share`,this.actions),this.more=o(`.${a.actionButtonsClass}--more`,this.actions),this.add.addEventListener("click",this.addPlayList.bind(this)),this.share.addEventListener("click",this.sharePlayList.bind(this)),this.more.addEventListener("mouseover",this.onMouseOver.bind(this,this.more,a.actionButtonsClass+"_more")),this.more.addEventListener("mouseleave",this.onMouseLeave.bind(this,this.more,a.actionButtonsClass+"_more"))),this.menu=o(`.${a.menuButtonsClass}__inner`,this.playlistElement),this.menu&&(this.playNext=o(`.${a.menuButtonsClass}__item--playNext`,this.menu),this.editPlaylist=o(`.${a.menuButtonsClass}__item--editPlaylist`,this.menu),this.deletePlaylist=o(`.${a.menuButtonsClass}__item--deletePlaylist`,this.menu),this.addToGroup=o(`.${a.menuButtonsClass}__item--addToGroup`,this.menu),this.removeFromGroup=o(`.${a.menuButtonsClass}__item--removeFromGroup`,this.menu),this.copyLink=o(`.${a.menuButtonsClass}__item--copyLink`,this.menu)),this.play=o(`.${a.playListClass}__play`,this.playlistElement),this.play&&(this.player=getAudioPlayer(),this.player.addPlaylist(new window.AudioPlaylist({ownerId:this.playlist.owner_id,albumId:this.playlist.id,type:this.playlist.type,list:this.playlist.list},this.playlist.owner_id,this.playlist.id)),this.player.on(this.playlist.context,_.events.PLAY,this.onPlay.bind(this)),this.player.on(this.playlist.context,_.events.PAUSE,this.onStop.bind(this)),this.player.on(this.playlist.context,_.events.STOP,this.onStop.bind(this)),this.play.addEventListener("click",this.playSong.bind(this)),this.playlistList.addEventListener("click",this.playFromList.bind(this))),this.playlistListAll&&this.playlistListAll.addEventListener("click",this.showAllAudio.bind(this)),this.shuffle&&this.shuffle.addEventListener("click",this.shufflePlayList.bind(this)),this.playNext&&this.playNext.addEventListener("click",this.playNextSong.bind(this)),this.editPlaylist&&this.editPlaylist.addEventListener("click",this.handleEditPlaylist.bind(this)),this.deletePlaylist&&this.deletePlaylist.addEventListener("click",this.handleDeletePlaylist.bind(this)),this.addToGroup&&this.addToGroup.addEventListener("click",this.handleAddToGroup.bind(this)),this.removeFromGroup&&this.removeFromGroup.addEventListener("click",this.handleRemoveFromGroup.bind(this)),this.copyLink&&this.copyLink.addEventListener("click",this.copyPlayListLink.bind(this))}showAllAudio(){this.playlistList.classList.add(a.playListClass+"__list--all")}shufflePlayList(){this.showAllAudio(),this.player.playPlaylist(this.playlist.owner_id,this.playlist.id,this.playlist.access_hash,this.playlist.context,!0)}addPlayList(){AudioUtils.followPlaylist(this.addText,this.playlist.owner_id,this.playlist.id,this.playlist.follow_hash),this.add.classList.toggle(a.actionButtonsClass+"--add--added"),this.add.classList.contains(a.actionButtonsClass+"--add--added")?this.addText.innerText=this.addText.dataset.textFollowed:this.addText.innerText=this.addText.dataset.textFollow}sharePlayList(e){window.shareAudioPlaylist(e,this.playlist.owner_id,this.playlist.id,this.playlist.access_hash)}playNextSong(){this.player.playNextPlaylist(this.playlist.owner_id,this.playlist.id,this.playlist.access_hash,this.playlist.context)}copyPlayListLink(){AudioUtils.copyPlaylistLink(this.playlist.owner_id,this.playlist.id,this.playlist.access_hash)}playSong(){this.isCurrentPlaylist()?!0===this.isPlaying?this.player.pause():this.player.play():this.player.playPlaylist(this.playlist.owner_id,this.playlist.id,this.playlist.access_hash,this.playlist.context)}playFromList(e){var t,i=e.target;if(-1!==i.className.indexOf("AudioRow")){for(;i&&!i.classList.contains(a.playListClass+"__audioRow");)i=i.parentNode;t=i.dataset.id}if(t){var o=this.player.getPlaylist(this.playlist.type,this.playlist.owner_id,this.playlist.id,this.playlist.access_hash);this.player.play(t,o,this.playlist.context)}}onPlay(){this.isCurrentPlaylist()&&(this.isPlaying=!0,this.play.classList.add(a.playListClass+"__stop"),this.play.classList.remove(a.playListClass+"__play"))}onStop(){this.isCurrentPlaylist()&&(this.isPlaying=!1,this.play.classList.add(a.playListClass+"__play"),this.play.classList.remove(a.playListClass+"__stop"))}onMouseOver(e,t){e.classList.add(t+"--hover")}onMouseLeave(e,t){e.classList.remove(t+"--hover")}isCurrentPlaylist(){var e=this.player.getCurrentAudio();return Boolean(e)&&this.playlist.list.some(t=>t[0]===e[0]&&t[1]===e[1])}handleEditPlaylist(){window.AudioUtils&&window.AudioUtils.editPlaylist(this.playlist.owner_id,this.playlist.id,"edit")}handleDeletePlaylist(){window.AudioPage&&window.AudioPage.deletePlaylist(this.playlist.owner_id,this.playlist.id,this.playlist.edit_hash)}handleAddToGroup(){window.AudioUtils&&window.AudioUtils.addToGroupBox(this.playlist.owner_id,this.playlist.id,this.playlist.access_hash)}handleRemoveFromGroup(){window.AudioUtils&&window.AudioUtils.removeFromGroup(this.playlist.owner_id,this.playlist.id,this.playlist.follow_hash)}}a.playListClass="AudioPlaylistSnippet",a.actionButtonsClass="ActionButton",a.menuButtonsClass="ActionsMenu";var l=i("/rxS"),r=i("4mg9");window.AudioPage||(window.AudioPage=l.AudioPage,window.currentAudioPage=l.currentAudioPage),window.PlayList||(window.PlayList=a),window.BlockController=r.BlockController;try{window.stManager.done(window.jsc("web/audio.js"))}catch(e){}},D1OX:function(e,t,i){"use strict";i.r(t),i.d(t,"uiGetGallery",(function(){return n})),i.d(t,"UIGallery",(function(){return d}));var o,s=i("jE6c");o=window.hasOwnProperty("__SHARED_STATE_KEY")?window.__SHARED_STATE_KEY:Object.create(null),Object.defineProperty(window,"__SHARED_STATE_KEY",{configurable:!0,value:o});var _=()=>window.__SHARED_STATE_KEY,a=e=>_()[e],l={persistIfInitialized:!0},r=((e,t,i)=>{var o=Object(s.defaults)({},i,l),r=e in _(),n=a(e),d=r&&o.persistIfInitialized?n:t(n);((e,t)=>{_()[e]=t})(e,d);return()=>a(e)})("ui-gallery",()=>({galleries:{},incIndex:0}));function n(e){var t=domData(ge(e),"gallery-id");return t&&r().galleries[t]}class d{constructor(e,t){if(!e)throw new Error("No element was provided for UIGallery");if(e=ge(e),!hasClass(e,"ui_gallery"))throw new Error("Provided incorrect element for UIGallery");var i=n(e);if(i)return i;this._opts=extend({markOutside:!1,scrollY:!0,scrollX:!0,noArrows:!1},t),this._id=r().incIndex,r().incIndex+=1,this._el=e,this._width=getSize(this._el)[0],this._items=geByClass("ui_gallery_item",this._el),this._itemWidth=getSize(this._items[0])[0],this._itemOffset=intval(getStyle(this._items[0],vk.rtl?"marginLeft":"marginRight")),this._scrollOffset=intval(getStyle(this._items[0],"marginLeft")),this._itemFullWidth=this._itemWidth+this._itemOffset,this._innerCont=geByClass1("ui_gallery__inner_cont",this._el),this._inner=geByClass1("ui_gallery__inner",this._el),this._scroll=function(){var e={rtl:!1,backward:!1,delta:1,negative:!1,rtlSame:!1};if(!vk.rtl)return e;if(!cur._scrollInfo){var t=se('<div style="position: fixed; left: -1000; width: 0; overflow: scroll">x</div>');ge("content").appendChild(t);var i=t.scrollLeft;e.rtl=vk.rtl,e.backward=i>0,t.scrollLeft=1e3,e.delta=t.scrollLeft===i?-1:1,e.negative=!e.backward&&e.delta<0,e.rtlSame=e.rtl&&!e.backward&&!e.negative,re(t),cur._scrollInfo=e}return cur._scrollInfo}(),this._loadingMore=!1,this._finised=!1,this._visible={left:-1,right:-1,items:[]},this._outside={left:-1,right:-1,timer:null},this._initScroll(),this._initArrows(),domData(this._el,"gallery-id",this._id),r().galleries[this._id]=this,this._checkItemsAfterScroll(this._innerCont.scrollLeft,!0)}_initScroll(){(this._opts.scrollX||this._opts.scrollY)&&addEvent(this._innerCont,"DOMMouseScroll wheel",this._onWheelScroll.bind(this))}_initArrows(){this._opts.noArrows?addClass(this._el,"ui_gallery_no_arrows"):(this._leftArrow=geByClass1("ui_gallery__arrow_left",this._el),this._rightArrow=geByClass1("ui_gallery__arrow_right",this._el),this._arrowWidth=getSize(this._leftArrow)[0],addEvent(this._leftArrow,"click",this._onArrowScroll.bind(this,-1)),addEvent(this._leftArrow,"mouseover",this._onArrowMouseOver.bind(this,"left")),addEvent(this._leftArrow,"mouseout",this._onArrowMouseOut.bind(this)),addEvent(this._rightArrow,"click",this._onArrowScroll.bind(this,1)),addEvent(this._rightArrow,"mouseover",this._onArrowMouseOver.bind(this,"right")),addEvent(this._rightArrow,"mouseout",this._onArrowMouseOut.bind(this)))}_onWheelScroll(e){if(this._opts.scrollX||this._opts.scrollY){var t;if("wheel"==e.type)if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){if(!this._opts.scrollY)return;t=-e.deltaY}else{if(!this._opts.scrollX)return;t=-e.deltaX}else if(void 0!==e.wheelDeltaY){if(!this._opts.scrollY)return;t=e.wheelDeltaY}else if(void 0!==e.wheelDelta)t=e.wheelDelta;else{if(!e.detail||1!==e.axis)return;t=-e.detail}t=this._scroll.rtlSame?-t:t,Math.abs(t)>=120&&(t=74*Math.max(-1,Math.min(1,t))),this._innerCont.scrollLeft-=t,this._checkItemsAfterScroll(this._innerCont.scrollLeft),cancelEvent(e)}}_onArrowScroll(e,t){if(!this._opts.noArrows){var i=this._innerCont.scrollLeft+(this._scroll.rtlSame?-e:e)*(this._width-2*this._arrowWidth),o=this._innerCont.scrollWidth-this._width;this._scroll.negative?(i=Math.min(i,0),i=Math.abs(i)):i=Math.max(0,i),i=Math.min(o,i);var s=this._scroll.negative||this._scroll.rtlSame?-e:e;if(s>0&&i<o)i=Math.floor(i/this._itemFullWidth)*this._itemFullWidth;else if(s<0&&i>0){i=Math.floor(i/this._itemFullWidth)*this._itemFullWidth}if(0===i||i===o){var _=this._innerCont.scrollWidth;addClass(this._inner,"ui_gallery__inner_shift_instant"),this._onArrowMouseOut(),i&&(i+=e*(this._innerCont.scrollWidth-_))}this._scroll.negative&&(i=-i),animate(this._innerCont,{scrollLeft:i},{duration:Math.abs(this._innerCont.scrollLeft-i)+50,transition:Fx.Transitions.easeOutCubic}),this._checkItemsAfterScroll(i),setTimeout(()=>removeClass(this._inner,"ui_gallery__inner_shift_instant"),0),cancelEvent(t)}}_checkItemsAfterScroll(e,t){if(this._scroll.negative&&(e=Math.abs(e)),this._opts.markOutside||this._opts.onViewItem){var i,o=this._itemWidth/3,s=(this._scroll.backward?this._inner.scrollWidth-this._width-e:e)-this._scrollOffset,_=e&&Math.floor(s/this._itemFullWidth),a=_*this._itemFullWidth+2*o;i=this._scroll.backward?e+this._width<this._inner.scrollWidth-a:e>a;var l,r=Math.min(this._items.length-1,Math.floor((s+this._width)/this._itemFullWidth)),n=r*this._itemFullWidth+2*o;if(l=this._scroll.backward?e>this._inner.scrollWidth-n:e+this._width<n,this._opts.onViewItem){var d=i?Math.min(this._items.length-1,_+1):_,u=l?Math.max(0,r-1):r;if(t||d!==this._visible.left||u!==this._visible.right){for(var c=d;c<=u;c++)(this._visible.left<0||t&&!inArray(this._items[c],this._visible.items)||c<this._visible.left||c>this._visible.right)&&this._opts.onViewItem(this._items[c],c);this._visible.left=d,this._visible.right=u,this._visible.items=this._items.slice(d,u+1)}}this._opts.markOutside&&(t?(geByClass("ui_gallery_item_outside",this._inner).forEach(e=>{removeClass(e,"ui_gallery_item_outside")}),this._outside.left=-1,this._outside.right=-1):((_!==this._outside.left||!i)&&this._outside.left>=0&&(removeClass(this._items[this._outside.left],"ui_gallery_item_outside"),this._outside.left=-1),(r!==this._outside.right||!l)&&this._outside.right>=0&&(removeClass(this._items[this._outside.right],"ui_gallery_item_outside"),this._outside.right=-1)),i&&_!==this._outside.left&&(addClass(this._items[_],"ui_gallery_item_outside"),this._outside.left=_),l&&r!==this._outside.right&&(addClass(this._items[r],"ui_gallery_item_outside"),this._outside.right=r))}if(!this._opts.noArrows){var h=e>0,p=e+this._width<this._inner.scrollWidth;toggleClass(this._leftArrow,"ui_gallery__arrow_visible",this._scroll.rtl&&!this._scroll.backward?p:h),toggleClass(this._rightArrow,"ui_gallery__arrow_visible",this._scroll.rtl&&!this._scroll.backward?h:p)}(!this._scroll.backward&&this._inner.scrollWidth-e-this._width<1e3||this._scroll.backward&&e<1e3)&&this._onLoadMore()}_onArrowMouseOver(e){this._opts.noArrows||addClass(this._inner,"ui_gallery__inner_shift_"+e)}_onArrowMouseOut(){this._opts.noArrows||(removeClass(this._inner,"ui_gallery__inner_shift_left"),removeClass(this._inner,"ui_gallery__inner_shift_right"))}_onLoadMore(){!this._opts.onLoadMore||this._loadingMore||this._finised||(this._loadingMore=!0,this._opts.onLoadMore(this._items.length))}addMore(e,t){e=e||[],this.addItems(e),this._finised=!!t||!e.length,this._loadingMore=!1}addItems(e,t){if((e=e||[]).length){var i=t>=0&&t<this._items.length?this._items[t]:null;e.forEach(e=>{i?domInsertBefore(e,i):this._inner.appendChild(e)}),this.refresh()}}destroy(){removeEvent(this._innerCont),removeEvent(this._leftArrow),removeEvent(this._rightArrow),domData(this._el,"gallery-id",null),delete r().galleries[this._id],this._opts.onDestroy&&this._opts.onDestroy(),re(this._el)}removeItem(e){return isNumeric(e)&&(e=this._items[e]),!(!e||!inArray(e,this._items))&&(re(e),this.refresh(),this._items.length||this.destroy(),!0)}refresh(){this._width=getSize(this._el)[0],this._items=geByClass("ui_gallery_item",this._el),this._checkItemsAfterScroll(this._innerCont.scrollLeft,!0)}getItems(){return this._items}getVisibleItems(){return this._visible.items.map((e,t)=>[e,this._visible.left+t])}}},RdBX:function(e,t,i){"use strict";i.r(t),i.d(t,"vkIndexer",(function(){return o}));i("Vd3H"),i("OG14"),i("a1Th"),i("Btvt"),i("KKXr"),i("Oyvg");function o(e,t,i){this.list=e,this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=i||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}o.prototype.delimiter=o.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),o.prototype.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),o.prototype.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},o.prototype.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},o.prototype.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},o.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var i=this.list[t];try{i._order=t}catch(e){}this.add(i)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},o.prototype.strToPrefixes=function(e){for(var t={},i=winToUtf(e).toLowerCase().split(this.delimiter),o=i.length;o--;){var s=i[o],_="";if(s){for(var a=0;a<6;a++){var l=s.charCodeAt(a);if(l){var r=this.toTranslit[l],n=s.substr(a,1);_+=null!=r?r:n}}t[_]=1}}return t},o.prototype.strToSearchPrefixes=function(e){for(var t=[],i=e.toLowerCase().split(this.delimiter),o=i.length;o--;){var s={},_=i[o],a="",l="",r="",n=_.length>1;if(_){for(var d=0;d<6;d++){var u=_.charCodeAt(d);if(u){var c=this.toTranslit[u],h=_.substr(d,1);if(a+=null!=c?c:h,n){var p=this.toLocalCase[h],g=this.toLocalTranslit[u];l+=null!=p?p:h,r+=null!=g?g:h}}}s[a]=1,n&&(s[l]=2,s[r]=3),t.push(s)}}return t},o.prototype.toIndexTree=function(e,t){for(var i=this.index,o=0;o<6;o++){var s=e.substr(o,1)||-1;i=i[s]?i[s]:i[s]=5==o?[]:{}}i.push(t)},o.prototype.remove=function(e){var t=this.prepareFunc(e),i=this.strToPrefixes(t);for(var o in i)if(i.hasOwnProperty(o)){for(var s=this.index,_=0;_<6;_++){var a=o.substr(_,1)||-1;if(!s[a])break;s=s[a]}if(s.length)for(var l in s)if(this.equals(s[l],e)){s.splice(l,1);break}}},o.prototype.equals=function(e,t){for(var i in e)if(e.hasOwnProperty(i))switch(typeof e[i]){case"object":if(!this.equals(e[i],t[i]))return!1;break;case"function":if(void 0===e[i]||e[i].toString()!=t[i].toString())return!1;break;default:if(e[i]!=t[i])return!1}for(var o in t)if(void 0===t[o])return!1;return!0},o.prototype.intersect=function(e,t){var i=[];if(isNumeric(e[0])||isNumeric(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)e[0]._order<t[0]._order?e.shift():(e[0]._order>t[0]._order||this.equals(e[0],t[0])&&i.push(e.shift()),t.shift());return i},o.prototype.add=function(e){var t=this.prepareFunc(e),i=this.strToPrefixes(t);for(var o in i)i.hasOwnProperty(o)&&this.toIndexTree(o,e)},o.prototype.search=function(e){var t=this.index,i=this.strToSearchPrefixes(e),o=[],s=!1;for(var _ in i)if(i.hasOwnProperty(_)){if(s&&!o)break;var a=this.localSearch(i[_],0,t);a.sort((function(e,t){return e._order-t._order})),o=s?this.intersect(o,a):a,s=!0}for(var l=o[0],r=o.length+1,n=[],d=1;d<r;d++){var u=o[d];u!=l&&(n.push(l),l=u)}return n},o.prototype.localSearch=function(e,t,i){if(!i)return[];var o={};for(var s in e)if(e.hasOwnProperty(s)){var _=s.substr(t,1)||-1;o[_]||(o[_]={}),o[_][s]=1}if(6==t++||!i)return i;var a=[];for(var l in o)if(-1==l)for(var r in i)i.hasOwnProperty(r)&&a.push.apply(a,this.localSearch(o[l],t,i[r]));else{var n=this.localSearch(o[l],t,i[l]);a.push.apply(a,n)}return a}},TmuT:function(e,t,i){"use strict";i.r(t),i.d(t,"BaseController",(function(){return s}));var o=function(){return(o=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=function(){function e(){}return e.prototype.fetchNext=function(){return this.fetchSection(this.id,this.nextFrom)},e.prototype.fetchSection=function(e,t,i){var s=this;return void 0===i&&(i={}),this.fetchInProgress=!0,new Promise((function(_,a){var l=o({act:"load_catalog_section",section_id:e,start_from:t},i);window.ajax.post("al_audio.php",l,{onDone:function(e,t,i){s.fetchInProgress=!1,_({blocks:e,data:t,blockItems:i})},onFail:function(){return a(),s.fetchInProgress=!1,!0}})}))},e}()},btP0:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("SRfc"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("zxIV"),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("o7bv"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("t7n3"),_web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("k487"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("Egk5"),_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("hmKL"),_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("gdug"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("98sY"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("lXE5"),uiSearch={destroy:function(e){var t=uiSearch.getFieldEl(e);uiSearch.stopEvents(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeData)(t)},getWrapEl:function(e){return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domClosest)("_wrap",e)},getFieldEl:function(e){return e=ge(e),hasClass("_field",e)?e:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domByClass)(uiSearch.getWrapEl(e),"_field")},stopEvents:function(e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[];each(t,(function(e,t){t.stop()}))},startEvents:function(e){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[];each(t,(function(e,t){t.stop(),t.start()}))},init:function init(el,options){if(el&&(el=uiSearch.getFieldEl(el),el)){var wrapEl=uiSearch.getWrapEl(el),delayedInitOptions=!options&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(wrapEl,"init-options");if(delayedInitOptions){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(wrapEl,"init-options",null);var evalScript="(function() { return "+delayedInitOptions+" })()";try{uiSearch.init(el,eval(evalScript))}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,evalScript)}}else if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"inited")){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"inited",1);var onKeyDown=uiSearch.onKeyDown.pbind(el),onBuffer=function(e){if("input"===e.type&&_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.msie){var t=val(el);if(t===(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"prev-value")||""))return;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"prev-value",t)}setTimeout(uiSearch.onChanged.pbind(el,!1,e),0)},onBlur=uiSearch.onBlurred.pbind(el),mainHandler;if(Object(_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_2__.placeholderInit)(el),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"opts",options),options.suggester)options.suggester.instance=new Suggester(el,extend(options.suggester,{type:options.suggester.type,historyItems:!!options.suggester.history&&options.suggester.historyItems,onSearch:function(e,t,i){e||(options.allowFiltersForEmpty||uiSearch.removeAllFilters(el),uiSearch.hideProgress(el)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(wrapEl,"ui_search_field_empty",!e),options.onChange&&options.onChange.call(el,e,t,i)}})),mainHandler={start:function(){addEvent(el,"blur",onBlur),options.onBlur&&addEvent(el,"blur",options.onBlur),options.onFocus&&addEvent(el,"focus",options.onFocus)},stop:function(){removeEvent(el,"blur",onBlur),options.onBlur&&removeEvent(el,"blur",options.onBlur),options.onFocus&&removeEvent(el,"focus",options.onFocus)}};else{var searchBtn=geByClass1("_ui_search_button_search",wrapEl),onBtnClick=function(e){uiSearch.onEnter(el,e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(el)};mainHandler={start:function(){addEvent(el,"keydown",onKeyDown),addEvent(el,"paste cut input",onBuffer),addEvent(el,"blur",onBlur),options.onBlur&&addEvent(el,"blur",options.onBlur),options.onFocus&&addEvent(el,"focus",options.onFocus),searchBtn&&addEvent(searchBtn,"click",onBtnClick)},stop:function(){removeEvent(el,"keydown",onKeyDown),removeEvent(el,"paste cut input",onBuffer),removeEvent(el,"blur",onBlur),options.onBlur&&removeEvent(el,"blur",options.onBlur),options.onFocus&&removeEvent(el,"focus",options.onFocus),searchBtn&&removeEvent(searchBtn,"click",onBtnClick)}}}if(mainHandler.start(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(el,"eventHandlers",[mainHandler]),options.params){var content=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.se)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(options.params.html));options.paramsTooltip=new _web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_4__.default(geByClass1("_ui_search_params_button",wrapEl),{appendTo:wrapEl,content,autoShow:!1,customShow:!0,offset:[0,-2],shift:options.params.shift?options.params.shift:0}),options.paramsTooltip.build(),setTimeout((function(){(function initScript(){try{eval(options.params.script)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_8__.logEvalError)(e,options.params.script)}}).call(el)}))}options.fixed&&uiSearch.setFixed(el),options.noAutoDestroy||cur.destroy.push(uiSearch.stopEvents.pbind(el)),uiSearch.initFilters(el,options),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.isFunction)(options.onInit)&&options.onInit(el,options)}}},getOptions:function(e){var t=uiSearch.getWrapEl(e),i=geByClass1("_field",t);return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"opts")},toggleParameters:function(e){var t=uiSearch.getWrapEl(e),i=geByClass1("_field",t),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(i,"opts");o.paramsTooltip&&o.paramsTooltip.toggle()},saveHistorySearch:function(e,t,i,o,s,_){t||(t=val(e));var a=uiSearch.getOptions(e);a.suggester&&a.suggester.instance&&a.suggester.instance.saveHistoryItem(t,i,o,s,_)},onEnter:function(e,t){e=uiSearch.getFieldEl(e);var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts"),o=e.getValue();return i.onEnter&&i.onEnter(e,o,t),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t)},onKeyDown:function(e,t){if(cur.preventInputActions&&-1!=[KEY.RETURN,KEY.ESC,KEY.DOWN,KEY.UP].indexOf(t.keyCode))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t);if(t.keyCode==KEY.RETURN)return uiSearch.onEnter(e,t);if(t.keyCode==KEY.ESC){var i=!!val(e);return uiSearch.reset(e,!1,t),!i||Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.cancelEvent)(t)}setTimeout.pbind(uiSearch.onChanged.pbind(e,!1,t),0)},onBlurred:function(e,t){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts");i.onBlur&&i.onBlur.call(e,t)},onChanged:function(e,t,i){e=uiSearch.getFieldEl(e);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts"),s=uiSearch.getWrapEl(e),_=e.getValue?e.getValue():e.value;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(s,"ui_search_field_empty",!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(_)),_||o.allowFiltersForEmpty||uiSearch.removeAllFilters(e),t||o.onChange&&o.onChange.call(e,_,i)},focus:function(e){e=uiSearch.getFieldEl(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(e)},reset:function(e,t,i){e=uiSearch.getFieldEl(e);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"opts")||{},s=uiSearch.getWrapEl(e);(e.getValue?e.getValue():e.value)?(val(e,""),uiSearch.onChanged(e,t,i),t||o.onEnter&&o.onEnter(e,""),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.elfocus)(e)):o.in_tabs&&_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_6__.default.hideSearch(s),window.tooltips&&tooltips.destroyAll()},showProgress:function(e){e=uiSearch.getFieldEl(e);var t=uiSearch.getWrapEl(e);addClass(t,"ui_search_loading");var i=e.getValue?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(e.getValue()):e.value;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(t,"ui_search_field_empty",!i)},hideProgress:function(e){e=uiSearch.getFieldEl(e);var t=uiSearch.getWrapEl(e);removeClass(t,"ui_search_loading");var i=e.getValue?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.trim)(e.getValue()):e.value;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(t,"ui_search_field_empty",!i)},scrollResize:function(e){if(!_web_lib_browser__WEBPACK_IMPORTED_MODULE_7__.browser.mobile){e=uiSearch.getFieldEl(e);var t,i=uiSearch.getWrapEl(e),o=i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(i),s=i&&hasClass(i,"ui_search_fixed"),_=ge(cur.uiSearchPageBlock)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("page_block",e),a=vk.staticheader?Math.max(0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_header"))[1]-scrollNode.scrollTop):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_header"))[1],l=i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isAncestor)(i,boxLayerWrap);if(i&&o&&(l||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("scroll_fix",i))&&(!e.ignoreFixed||s)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(o))if(l?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(o,!0)[1]<0:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(o,!0)[1]<a){var r=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getStyle)(e,"width"));!s&&r&&(setStyle(o,"height",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(i)[1]),setStyle(i,"width",r),addClass(i,"ui_search_fixed"));var n=Math.min(0,Math.max(-bodyNode.scrollLeft,bodyNode.clientWidth-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(ge("page_layout"))[0]));if(setStyle(i,{marginLeft:n}),_){var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(_)[1]+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(_)[1]-Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_9__.scrollGetY)()-e.offsetHeight;(t=Math.min(a,Math.max(-e.offsetHeight,d)))!==cur.lastUISearchPos&&(setStyle(i,"top",t),cur.lastUISearchPos=t)}}else s&&(setStyle(o,"height",""),setStyle(i,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,removeClass(i,"ui_search_fixed"))}},setStatic:function(e){e.ignoreFixed=!0;var t=uiSearch.getWrapEl(e),i=t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(t);t&&i&&(setStyle(i,"height",""),setStyle(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,removeClass(t,"ui_search_fixed"))},setFixed:function(e){if(e.ignoreFixed=!1,!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"resizeEventHandler")){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isAncestor)(e,boxLayerWrap)?boxLayerWrap:window,i=uiSearch.scrollResize.pbind(e),o={stop:removeEvent.pbind(t,"scroll",i),start:addEvent.pbind(t,"scroll",i)};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers",(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[]).concat([o])),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"resizeEventHandler",!0),o.start()}uiSearch.scrollResize(e)},initFilters:function(e,t){if(e){var i=uiSearch.getWrapEl(e),o=geByClass1("ui_search_fltr_control",i),s={start:function(){addEvent(o,"click",(function(e){hasClass(o,"shown")&&!hasClass(e.target,"ui_search_fltr_control")||a(o)})),addEvent(o,"mouseover",(function(){if(hasClass(o,"shown")){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer");e&&(clearTimeout(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer",0)),a(o,!0)}})),addEvent(o,"mouseout",(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer",setTimeout((function(){a(o,!1),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"hidetimer",0)}),200))}))},stop:removeEvent.pbind(o,"click mouseover mouseout")};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers",(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"eventHandlers")||[]).concat([s])),s.start();var _=uiSearch._getFiltersPane(e);addEvent(_,"click",(function(t){if(hasClass(t.target,"token_title")||hasClass(t.target,"token_del")){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("token",t.target),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(i,"id");uiSearch.removeFilter(e,o)}}))}function a(e,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(e,"shown",t)}},removeAllFilters:function(e){var t=uiSearch._getFiltersPane(e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(t,"cur_filters");each(extend({},i),(function(t){uiSearch.removeFilter(e,t,!0)}))},toggleFilter:function(e,t,i,o){o?uiSearch.addFilter(e,t,i):uiSearch.removeFilter(e,t)},addFilter:function(e,t,i){if(t&&i){var o=uiSearch._getFiltersPane(e),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters")||{};s[t]=i,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters",s),uiSearch._renderFilters(e)}},removeFilter:function(e,t,i){var o=uiSearch._getFiltersPane(e),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters")||{};if(s[t]){delete s[t],Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(o,"cur_filters",s);var _=uiSearch.getOptions(e);_.onFilterRemoved&&_.onFilterRemoved(t,e,i),uiSearch._renderFilters(e)}},_getFiltersPane:function(e){var t=uiSearch.getWrapEl(e)||e;return geByClass1("ui_search_filters_pane",t)},_renderFilters:function(e){clearTimeout(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"renderFiltersTO")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(e,"renderFiltersTO",setTimeout(uiSearch._doRenderFilters.pbind(e)))},_doRenderFilters:function(e){var t=uiSearch._getFiltersPane(e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.data)(t,"cur_filters")||{},o=geByClass1("ui_search_filters",t);if(o)if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.isEmpty)(i))removeClass(t,"expanded"),setTimeout((function(){o.innerHTML="",hide(t)}),200);else{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClassDelayed)(t,"expanded");var s=[],_={},a=0;each(i,(function(e,t){var i=!1,o=!1,l=e.match(/(.*?)_([^_]+)$/),r=l&&l[2]||!1;(l=l&&l[1]||!1)&&(void 0!==_[l]&&"from"===r?o=_[l]:void 0!==_[l]&&(i=_[l]+1),_[l]=a);var n=`<div class="token" id="token${e}" data-id="${e}">\n                         <div class="token_title">${Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.replaceEntities)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)(t))}</div>\n                         <div class="token_del"></div>\n                       </div>`;!1!==o?s.splice(o,0,n):!1!==i?s.splice(i,0,n):s.push(n),a++})),o.innerHTML=s.join("")}}};__webpack_exports__.default=uiSearch},gUSy:function(e,t,i){"use strict";i.r(t);var o=i("zxIV"),s=i("Egk5"),_=i("BJj/");function a(e,t){if(this.constructor!=a)throw new Error("Slider was called without 'new' operator");if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},this.options.backValue=this.options.backValue||0;var i=100*this.options.backValue,s=`<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> ${this.options.withBackLine?'<div class="slider_back" style="width:'+i+'%"></div>':""} <div class="slider_amount"></div> <div class="slider_handler"></div> </div>`;this._el=ce("div",{innerHTML:s,className:"slider",id:e.getAttribute("id")||""});for(var l=e.classList||[],r=this,n=0,d=l.length;n<d;n++)addClass(this._el,l[n]);each(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||r._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),Object(o.data)(this._el,"slider",this),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.handlerColor&&setStyle(this._handlerEl,{backgroundColor:this.options.handlerColor}),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=Object(_.debounce)(this._onValueChange,this.options.debounce)),t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}a.prototype.toggleAdState=function(e){this._adState=!!e,Object(o.toggleClass)(this._el,"slider_ad_mode",!!e)},a.prototype.toggleAdMarker=function(e){e=!!e;var t=geByClass1("slider_ad_marker",this._el);if(e){if(!t){var i="onmouseover=\"showTooltip(this, {text: '"+getLang("global_audio_ad")+"', black: 1, shift: [16, 9, 10]})\"";t=Object(o.se)('<div class="slider_ad_marker_wrap" '+i+'><div class="slider_ad_marker"></div></div>'),Object(o.domPN)(this._slideEl).insertBefore(t,this._slideEl),delete this._width,addClass(this._el,"slider_ad_marker_shown")}}else Object(o.re)(t),delete this._width,removeClass(this._el,"slider_ad_marker_shown")},a.prototype.showAdMarker=function(e){var t=Object(o.se)('<div class="slider_ad_marker"></div>');Object(o.domPN)(this._slideEl).insertBefore(t,this._slideEl),delete this._width,addClass(this._el,"slider_ad_marker_shown")},a.prototype.isAdMode=function(){return hasClass(this._el,"slider_ad_mode")},a.prototype.setBlocked=function(e){this.blocked=e,addClass(this._el,"slider_blocked")},a.prototype.getBlocked=function(){return this.blocked},a.prototype.isBlocked=function(){return this.isAdMode()||this.getBlocked()},a.prototype.toggleLoading=function(e){e=!!e,Object(o.toggle)(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},a.prototype.destroy=function(e){this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown)),Object(o.re)(this._el),Object(o.re)(this._currHintEl)},a.prototype._updateHint=function(e,t){this._currHintEl||(this._currHintEl=Object(o.se)('<div class="slider_hint" id="slider_hint"></div>'),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl)),this._width=this._width||getSize(this._slideEl)[0];var i=this._getPos(),s=Math.round(e.pageX-i[0]),_=this._width;if((s=t?Math.min(Math.max(0,s),_):s)>=0&&s<=_){var a=s/_;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,a):a;var l=getSize(this._currHintEl);setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+s-l[0]/2,top:this._slideEl.offsetTop-l[1]-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},a.prototype._toggleHint=function(e){this.isAdMode()&&(e=!1),Object(o.toggleClass)(this._currHintEl,"visible",e)},a.prototype._onMouseOver=function(e){a._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(e)},a.prototype._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},a.prototype._onMouseDown=function(e){0==e.button&&(delete cur._sliderMouseUpNowEl,this._adState||this.getBlocked()||(addEvent(window,"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._width=getSize(this._slideEl)[0],this._onMouseMove(e),a._currenSliderDrag=this,addClass(this._el,"active"),Object(s.cancelEvent)(e)))},a.prototype._onMouseUp=function(e){cur._sliderMouseUpNowEl=this._el,removeEvent(window,"mousemove",this._ev_onMouseMove),removeEvent(window,"mouseup",this._ev_onMouseUp),clearTimeout(this._debounceto),this._onValueChange(),removeClass(this._el,"active"),a._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue)},a.prototype._onMouseMove=function(e){var t=this._getPos(),i=Math.max(e.pageX,t[0]);i=Math.min(i,t[0]+this._width),i-=t[0],this.setValue(i/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),Object(s.cancelEvent)(e)},a.prototype._getPos=function(){return this._slidePos=getXY(this._slideEl)},a.LOGFBASE=35,a.prototype._logf=function(e){if(!this.options.log)return e;var t=a.LOGFBASE;return(Math.pow(t,e)-1)/(t-1)},a.prototype._unlogf=function(e){if(!this.options.log)return e;var t,i,o=a.LOGFBASE;return t=o,i=1+e*(o-1),Math.log(i)/Math.log(t)},a.prototype.setValue=function(e,t,i){if(!hasClass(this._el,"active")||i){var o=i?this._logf(e):e;if(this._currValue!=o){this._currValue=o;var s=i?e:this._unlogf(e);s=100*s+"%",setStyle(this._amountEl,{width:s}),setStyle(this._handlerEl,{left:s}),!t&&this._onValueChange()}}},a.prototype.setBackValue=function(e){Object(o.toggleClass)(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},a.prototype._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},t.default=a},hmKL:function(e,t,i){"use strict";i.r(t);var o=i("zxIV"),s=i("t7n3"),_=i("gdug"),a=i("Egk5"),l={initTabs:function(e,t){if(!(_.browser.msie&&Object(s.intval)(_.browser.version)<10||_.browser.opera&&Object(s.intval)(_.browser.version)<15||hasClass(e,"ui_tabs_sliding"))){var i=Object(o.getSize)(t)[0],a=t.offsetLeft,l=Object(o.geByClass1)("_ui_tabs_slider",e);if(!Object(o.domData)(e,"inited"))setStyle(l,{width:i+"px",marginLeft:a})}},tryInit:function(e){if(!Object(o.domData)(e,"inited")){var t=Object(o.geByClass1)("ui_tab_group_sel",e)||Object(o.geByClass1)("ui_tab_sel",e);t&&l.initTabs(e,t),Object(o.domData)(e,"inited",1)}},goTab:function(e,t,i){if(Object(a.checkEvent)(t))return!0;var s=Object(o.gpeByClass)("ui_tabs",e);return!(!i&&Object(o.geByClass1)("ui_tab_sel",s)==e)&&(l.switchTab(e),l.showProgress(s),nav.go(e,t,{tab:e}))},switchTab:function(e,t){var i=Object(o.gpeByClass)("ui_tabs",e),_=Object(o.geByClass1)("ui_tab_sel",i),a=null,r=null,n=hasClass(_,"ui_tab_group_item")?r=Object(o.gpeByClass)("ui_tab_group",_):_,d=hasClass(e,"ui_tab_group_item")?a=Object(o.gpeByClass)("ui_tab_group",e):e;if(e!=_){if(e!=d&&(l.toggleGroup(d,!1),l.resetLabel(d,e)),n){l.initTabs(i,n),(t=t||{}).noAnim||d===n||(addClass(i,"ui_tabs_sliding"),clearTimeout(cur.tabSlidingTO),cur.tabSlidingTO=setTimeout(removeClass.pbind(i,"ui_tabs_sliding"),300));var u=Object(o.geByClass1)("_ui_tabs_slider",i),c=Object(s.intval)(u.style.marginLeft),h={width:Object(o.getSize)(d)[0]+"px"};h[cssTransformProp]="translateX("+(d.offsetLeft-c)+"px)",setStyle(u,h),_!=n&&d!=n&&l.resetLabel(n),n!=_&&removeClass(n,"ui_tab_group_sel"),removeClass(_,"ui_tab_sel")}if(d!=e&&addClass(d,"ui_tab_group_sel"),addClass(e,"ui_tab_sel"),r&&removeClass(r,"ui_tab_hide_separator"),a){i=Object(o.geByClass1)("ui_tab_group_items",a,"div").children;var p=null;each(i,(function(e,t){"SPAN"===t.tagName?p=t:hasClass(Object(o.domFC)(t),"ui_tab_sel")||hasClass(t,"unshown")||(p=null)})),p&&addClass(a,"ui_tab_hide_separator")}}return!1},resetLabel:function(e,t){var i=Object(o.geByClass1)("ui_tab_group_label",e,"span");i&&(i.innerHTML=(t||i).getAttribute("data-default-label"))},toggleGroup:function(e,t){var i=Object(o.data)(e,"visibletimer");i&&clearTimeout(i),Object(o.data)(e,"visibletimer",setTimeout(o.toggleClass.pbind(e,"visible",t),t?0:100)),Object(o.toggleClass)(e,"shown",t)},showGroup:function(e){var t=Object(o.data)(e,"hidetimer");t&&(clearTimeout(t),Object(o.data)(e,"hidetimer",0)),l.toggleGroup(e,!0)},hideGroup:function(e){Object(o.data)(e,"hidetimer")||Object(o.data)(e,"hidetimer",setTimeout((function(){l.toggleGroup(e,!1),Object(o.data)(e,"hidetimer",0)}),200))},showProgress:function(e){hasClass(e,"ui_tabs")||(e=Object(o.gpeByClass)("ui_tabs",e)),addClass(e,"ui_tabs_loading")},hideProgress:function(e){hasClass(e,"ui_tabs")||(e=Object(o.gpeByClass)("ui_tabs",e)),removeClass(e,"ui_tabs_loading")},showSearch:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(Object(a.checkEvent)(t))return!0;var i=Object(o.gpeByClass)("ui_tabs",e),s=Object(o.domByClass)(i,"_field");return addClass(i,"ui_tabs_search_opened"),uiSearch.focus(s),!1},hideSearch:function(e,t){if(Object(a.checkEvent)(t))return!0;var i=Object(o.gpeByClass)("ui_tabs",e);return removeClass(i,"ui_tabs_search_opened"),!1}};t.default=l},oy9g:function(e,t,i){"use strict";i.r(t),i.d(t,"SectionController",(function(){return u}));var o,s=i("D33C"),_=i("ldAL"),a=i("4mg9"),l=i("vDiJ"),r=i("TmuT"),n=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),d=function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var o=Array(e),s=0;for(t=0;t<i;t++)for(var _=arguments[t],a=0,l=_.length;a<l;a++,s++)o[s]=_[a];return o},u=function(e){function t(t,i){var o=e.call(this)||this;o.sectionData=i;var s=t.querySelector("."+l.SECTION);return s?(o.sectionEl=s,o.initBlocks(),o.nextFrom=i.nextFrom,o.id=i.sectionId,i.playlists&&i.playlists.length&&o.addPlaylists(i.playlists),i.playlist&&o.setPagePlaylist(i.playlist),o.isBlockPagination=o.sectionData.isBlockPagination,o.initSectionAutoList(),o.hideShowMoreLoaders(),o.sectionInited(),o):o}return n(t,e),t.prototype.sectionInited=function(){this.blocks.forEach((function(e){return e.onSectionInit()}))},t.prototype.destroy=function(){this.sectionAutoList&&this.sectionAutoList.destroy(),this.blocks&&this.blocks.forEach((function(e){return e.destroy()}))},t.prototype.getBlockById=function(e){return this.blocks&&this.blocks.find((function(t){return t.getId()===e}))||null},t.prototype.reloadBlock=function(e){var t=this.findBlockByBlockName(e);t&&t.reloadData()},t.prototype.updateReorder=function(){this.blocks&&this.blocks.forEach((function(e){e.updateListReorder()}))},t.prototype.hideShowMoreLoaders=function(){this.blocks.forEach((function(e){return e.hideLoader()}))},t.prototype.addPlaylists=function(e){var t=window.getAudioPlayer();e.forEach((function(e){if(e){var i=new s.AudioPlaylist(e);i.getAudiosList().length||i.mergeWith(e),t.addPlaylist(i)}}))},t.prototype.setPagePlaylist=function(e){var t=window.currentAudioPage(this.sectionEl),i=window.getAudioPlayer().getPlaylist(e.type,e.ownerId,e.id,"",e.blockId);i.getAudiosCount()||(i.mergeWith(e),i.load()),t.setPagePlaylist(i)},t.prototype.initSectionAutoList=function(){var e=this;this.sectionAutoList=new _.default(this.sectionEl,{fetchImmediate:!1,onNeedRows:function(t){var i;if(e.isBlockPagination)return e.initBlockAutoList(),void t(null);e.nextFrom?(null===(i=e.paginatedBlockController)||void 0===i||i.showLoader(),e.fetchNext().then((function(i){var o=i.blocks,s=i.data,_=i.blockItems;(e.nextFrom=s.nextFrom,s.isBlockPagination)?(t(null),e.initBlockAutoList(_,e.nextFrom),s.playlist&&"search"===s.playlist.type&&window.getAudioPlayer().getPlaylist().sendSearchStats("search_view")):(s.playlists&&e.addPlaylists(s.playlists),t(o||null),e.initBlocks())})).catch((function(){}))):t(null)}})},t.prototype.initBlocks=function(){var e=this;this.blocks=d(this.sectionEl.getElementsByClassName(l.BLOCK_ELEMENT)).map((function(t){return new a.BlockController(e,t)}));var t=this.sectionEl.querySelector("."+l.PAGINATED_BLOCKS_CONTAINER);if(t){var i=d(t.getElementsByClassName(l.BLOCK_CONTENT)),o=i[i.length-1].dataset.id;o&&(this.paginatedBlockController=this.getBlockById(o))}else this.paginatedBlockController=this.blocks[this.blocks.length-1]},t.prototype.initBlockAutoList=function(e,t){void 0===e&&(e=[]),this.paginatedBlockController&&(void 0!==t&&this.paginatedBlockController.setNextFrom(t),this.paginatedBlockController.initAutoList(e))},t.prototype.findBlockByBlockName=function(e){return this.blocks.find((function(t){return t.hasBlockName(e)}))},t}(r.BaseController)},vDiJ:function(e,t,i){"use strict";i.r(t),i.d(t,"SECTION",(function(){return o})),i.d(t,"PAGINATED_BLOCKS_CONTAINER",(function(){return s})),i.d(t,"BLOCK_ITEMS_CONTAINER",(function(){return _})),i.d(t,"BLOCK_ITEMS_REORDERABLE",(function(){return a})),i.d(t,"BLOCK_ELEMENT",(function(){return l})),i.d(t,"AUTO_LIST_LOADER",(function(){return r})),i.d(t,"BLOCK_CONTENT",(function(){return n})),i.d(t,"SORTER_ACTION",(function(){return d})),i.d(t,"SORTER_ACTION_DATA",(function(){return u})),i.d(t,"GALLERY",(function(){return c}));var o="CatalogSection",s="CatalogSection__paginatedBlocks",_="CatalogBlock__itemsContainer",a="CatalogBlock__itemsContainer--reorderable",l="CatalogBlock",r="CatalogBlock__autoListLoader",n="CatalogBlock__content",d="CatalogBlock__sorter",u="CatalogBlock__sortingData",c="ui_gallery"}});