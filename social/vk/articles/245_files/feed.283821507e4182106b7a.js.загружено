(()=>{"use strict";var __webpack_modules__={943393:(e,t,o)=>{o.d(t,{memoizeFirstTruthy:()=>r});var r=e=>((e,t)=>{var o,r=!1;return function(){return!0===r||(o=e(...arguments),r=t(o)),o}})(e,(e=>!!e))},418431:(e,t,o)=>{o.d(t,{cutTextToHighlight:()=>s});var r="cutTextToHighlight",i=15;function s(e){var t=null;document.querySelectorAll(`${e}:not(.cutTextToHighlight)`).forEach((e=>{if(e.classList.add(r),null===t){var o=getComputedStyle(e).font;t=function(e){var t=document.createElement("canvas").getContext("2d");function o(e){var o=t.measureText(e).width;return Math.ceil(o)}return t.font=e,o}(o)}e.innerHTML=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"…",r=e.querySelector(".highlight");if(!r)return e.innerHTML;var s=e.innerHTML.indexOf('<em class="highlight">');if(r.offsetLeft+r.offsetWidth<=e.offsetWidth-i)return e.innerHTML;if(r.offsetWidth<e.offsetWidth-i){for(var n=0,a="",c=s;c>0&&n+r.offsetWidth<=e.offsetWidth;){var l=e.innerHTML.lastIndexOf(" ",c-1);if(-1===l&&(l=0),!((n=t(o+(a=e.innerHTML.substring(l,c)+a).trim()))+r.offsetWidth<=e.offsetWidth-i))break;c=l}s=c}if(s>0)return o+e.innerHTML.substring(s).trim();return e.innerHTML}(e,t)}))}},521388:(e,t,o)=>{var r=o(596114);window.feed=r.Feed,window.Feed=r.Feed;try{stManager.done(jsc("web/feed.js"))}catch(e){}},384043:(e,t,o)=>{o.d(t,{Feed:()=>L});o(175115),o(940851),o(296253),o(820075),o(976142),o(59357),o(21466),o(751876);var r=o(304418),i=o(414914),s=o(568948),n=o(313020),a=o(705456),c=o(791563),l=o(719016),d=o(627556),u=o(109847),_=o(442699),h=o(408152),p=o(885682),f=o(569359),g=o(503369),m=o(917999),v=o(288183),w=o(440290),b=o(335967),y=o(719807),E=o(390683),C=o(923668),k=o(901659),T=o(774),P=o(452365);function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e}).apply(this,arguments)}var L={sectionUpdateExceptions:["search","notifications","photos_search","mentions","articles","articles_search","likes","recommended","live","topics"],blockHideReason:function e(t,o){if(e.progress)return!1;e.progress=!0;var r="block_"+t,i=ge(r);delete cur.feedEntriesHTML[r],ajax.post("al_feed.php",{act:"a_block_hide_reason",block_id:t,reason:0|o,hash:attr(i,"data-hash"),ref:L.getModuleRef(),pos:attr(i,"data-pos")},{onDone:function(t){e.progress=!1,t?val(i,t):hide(i)},hideProgress:function(){e.progress=!1}})},blockRestore:function(e){var t="block_"+e,o=ge(t);cur.feedEntriesHTML[t]&&val(t,cur.feedEntriesHTML[t]),ajax.post("al_feed.php",{act:"a_block_restore",block_id:e,hash:attr(o,"data-hash"),ref:L.getModuleRef(),pos:attr(o,"data-pos")})},blockHide:function(e,t){if(!(0,a.actionsMenuItemLocked)(t)){(0,a.lockActionsMenuItem)(t);var o="block_"+e,r=ge(o),i=geByClass1("ui_actions_menu_wrap",r);ajax.post("al_feed.php",{act:"a_block_hide",block_id:e,hash:attr(r,"data-hash"),ref:L.getModuleRef(),pos:attr(r,"data-pos")},{onDone:function(e){uiActionsMenu.toggle(i,!1),cur.feedEntriesHTML[o]=val(r),val(r,e)},hideProgress:a.unlockActionsMenuItem.pbind(t)})}},videoRecomsBlockHideCancel:function(){ajax.post("/al_feed.php",{act:"a_video_recom_hide_cancel"}),L.restorePost("video_recoms")},videoRecomsBlockHideReason:function(e,t){(0,i.re)(geByClass1("feed_rb_video_reason_wrap")),(0,i.show)(geByClass1("feed_rb_video_reason_thankyou")),ajax.post("/al_feed.php",{act:"a_video_recom_hide_reason",reason:t,reason_hash:e})},expandVideosPost:function(e,t){var o=geByClass1("page_post_sized_thumbs",(0,i.domPN)(t)),r=0;each(o.children,(function(){if(!isVisible(this)&&((0,i.show)(this),++r>5))return!1})),toggle(t,!isVisible(o.children[o.children.length-1]))},closeVideoBlock:function(e){ajax.post("al_feed.php",{act:"a_close_video_block",hash:e});var t=ge("feed_recommends");setStyle(t,{height:getSize(t)[1],opacity:1}),setTimeout((function(){addClass(t,"recoms_hidden")}))},update:function(e){if(!cur.feedUpdateLoading&&!(window.Notifier&&cur.add_queues&&cur.add_queues.length&&(cur.add_queues.forEach((function(e){Notifier.addKey(e,L.updated)})),"news"!=cur.section)||"feed"!==cur.module||"top"==cur.subsection||inArray(cur.section,L.sectionUpdateExceptions))){var t=Math.random();if(!("news"!=cur.section&&"comments"!=cur.section&&t>.3||"news"==cur.section&&(e||t>.05))){cur.feedUpdateLoading=!0;var o=L.getSectionParams(cur.section);extend(o,cur.navParams),ajax.post("al_feed.php?au_"+cur.section,extend(o,{timestamp:cur.timestamp,posted:e?1:"",queue:cur.add_feed_queue?1:0}),{onDone:function(t,o,r){if(cur.feedUpdateLoading=!1,1!=e||o&&-1!=o.indexOf(vk.id+"")){if(!("feed"!==cur.module||t.section!=cur.section||t.timestamp<cur.timestamp||r<cur.timestamp)){(0,u.statlogsValueEvent)("feed_check_update",!!o),t.count+=cur.count;var s,n,a,c,l=cur.rowsCont,_=(0,i.ce)("div"),h=0;if("news"==cur.section){if(c=scrollGetY(),o){for(_.innerHTML=o;_.lastChild;)s=_.lastChild,l.insertBefore(s,l.firstChild),L.onPostLoaded(s,!0);each(geByClass("ts"+r,l),(function(){h+=this.offsetHeight,(0,d.nodeUpdated)(this),cur.feedUnreadCount++}))}h&&c>100&&scrollToY(c+h,0,!1,!0)}else if(o)for(_.innerHTML=o;s=_.lastChild;)if("DIV"==s.tagName)if("podcasts_recommended_block"!==s.id)if((a=s.firstChild.id.substr(4))&&cur.wallLayer==a)_.removeChild(s);else if(n=ge("post"+a)){var p=function(){if(!(0,i.hasClass)(n.parentNode,"feed_row"))return{v:void 0};var e=ge("replies"+a),t=e.nextSibling,o=0;if(each([].slice.call(geByClass("reply",s,"div")),(function(){ge(this.id)||(addClass(this,"new_reply"),e.appendChild(this),o++)})),o){var r=n.parentNode.offsetHeight,c=geByClass("new_reply",e,"div").length;t&&"replies_open"==t.className||(t=(0,i.ce)("div",{className:"replies_open",onclick:Wall.openNewComments.pbind(a),role:"button",tabIndex:0}),e.parentNode.insertBefore(t,e.nextSibling)),t.innerHTML=getLang("wall_x_new_replies_more",Math.min(100,c)),t.newCnt=c;var d=scrollGetY(),u=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight,h=getXY(t)[1],p=n.parentNode.offsetHeight;r=p-r,inArray(a,cur.feedUnread)||cur.feedUnread.unshift(a),!cur.idleManager.isIdle&&h>d+100&&h<d+u+100?(l.insertBefore(ge("post_ph"+a)||(0,i.ce)("div",{id:"post_ph"+a}),l.firstChild),inArray(a,cur.feedToSort)||cur.feedToSort.push(a)):((0,i.re)(n.parentNode),l.insertBefore(n.parentNode,l.firstChild),h>d+u+100&&(r=p),r&&scrollToY(scrollGetY()+r,0,!1,!0)),cur.feedUnreadCount+=o}_.removeChild(s)}();if("object"==typeof p)return p.v}else c=scrollGetY(),l.insertBefore(s,l.firstChild),L.onPostLoaded(s,!0),(0,d.nodeUpdated)(s),h=s.offsetHeight,c>100&&scrollToY(c+h,0,!1,!0);else _.removeChild(s);else _.removeChild(s);L.applyOptions(t),L.updateTitle()}}else setTimeout(L.update.pbind(2),2e3)},onFail:function(){return cur.feedUpdateLoading=!1,!1},showProgress:function(){cur.feedUpdateLoading=!0},hideProgress:function(){cur.feedUpdateLoading=!1}})}}},getNewQKey:function(e){var t={act:"a_get_key",only_update:cur.add_feed_queue?1:0,need_ignore:isArray(cur.ignore_owners)?0:1},o={onDone:function(o,i,s){if(cur.section!=r)return;if(cur.add_feed_queue=s,o)cur.add_queues=o,setTimeout(L.update.pbind(0),0);else if(!t.only_update){var n=i;return void(cur.timestamp=(n||vkNow()/1e3)-e)}isArray(i)&&(cur.ignore_owners=i)},local:1},r=cur.section;ajax.post("al_feed.php?queue",extend(L.getSectionParams(cur.section),t),o)},updated:function(e,t){cur.queueTO=cur.queueTO||irand(0,5e3),setTimeout(L.handleQueueEvent.pbind(e,t),cur.queueTO)},handleQueueEvent:function(e,t){if(("search"==cur.section||"news"==cur.section||!cur.section)&&isArray(cur.add_queues)){var o=!1;if(cur.add_queues.forEach((function(t){t.key===e&&(o=t)})),o){if(t.failed){cur.add_queues=!1,cur.add_feed_queue=null;var r=curNotifier.error_timeout||1;return clearTimeout(cur.lp_error_to),void(cur.lp_error_to=setTimeout(L.getNewQKey.bind(L).pbind(r),1e3*r))}if(isArray(t.events)&&t.events.length){o.ts=t.ts,t.key&&(o.key=t.key);var i=scrollGetY(),s=0;each(t.events,(function(){if(isObject(this))return Wall.processQueueEvent(this);s+=L.pushEvent(this.split("<!>"),i+getSize("page_header_cont")[1])}));var n=scrollGetY();s&&Math.abs(i-n)<100&&(cur.leftMenuDelta=s,scrollToY(n+s,0,!1,!0)),L.updateTitle(),cur.gifAutoplayScrollHandler&&cur.gifAutoplayScrollHandler(),cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}}}},needScrollPost:function(e,t){return e+80>getXY(t)[1]||cur.storyLayer||window.mvcur&&mvcur.mvShown||window.pvcur&&cur.pvShown},pushEvent:function(e,t){var o=e[0],r=e[1],s=e[2],n=ge("post"+s),a=cur.section,c="search"!=a?intval(e.pop()):0,l=0,_=function(e){return intval(getStyle(domByClass(e,"page_block"),"marginTop"))||intval(getStyle(domByClass((0,i.domNS)(e),"page_block"),"marginTop"))||15};if(!cur.options||o!=cur.options.qversion)return 0;switch((Wall.isArchiveWall()?"archive_post"===r:"reveal_post"===r)&&(r="res_post"),(Wall.isArchiveWall()?"reveal_post"===r:"archive_post"===r)&&(r="del_post"),r){case"new_post":if(n)break;var h=constants.Groups.GROUPS_ADMIN_LEVEL_USER;if(intval(e[11])&&intval(e[11])!=vk.id)return ajax.post("al_feed.php",{act:"a_need_own_reply",oid:intval(e[11])},{onDone:function(o){o&&(e[11]=0,L.pushEvent(e,t))}}),0;if("search"!=a){var f=s.split("_")[0];e[8]=intval(e[8])>0&&4==(4&c)?"1":"0",f<0&&(h=8&c?constants.Groups.GROUPS_ADMIN_LEVEL_EDITOR:2&c?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER)}"search"==a&&(0,u.statlogsValueEvent)("feed_switch",0,"search_update",cur.options.q&&"#"==cur.options.q.charAt(0)?"hashtag":"");var g=cur.rowsCont,m=g.childNodes,v=Wall.getNewPostHTML(e,h,L.feedPostRepl);if(!v)break;var w,b,y,E,C,k,I=e[12],B="search"!=a&&(window._wf<=0||(0,i.hasClass)(cur.feedEls.wrap,"feed_has_new")||L.needScrollPost(t,g)),R=cur.storyLayer;R&&(B=!0);var A=!1,O=v;if(B&&(v=Wall.updatePostImages(v)),I){if(cur.ignore_owners.length&&inArray(intval(I),cur.ignore_owners))break;if(b=geByClass1("feed_reposts_wrap"+I,g,"div"))y=geByClass1("feed_reposts_first",b,"div").firstChild,E=geByClass1("feed_reposts_group",b,"div"),C=geByClass1("feed_reposts_more_link",b,"a"),L.needScrollPost(t,y)&&(l-=y.offsetHeight+_(y)),y.parentNode.replaceChild(w=se(O),y),E.insertBefore(y,E.firstChild),isVisible(E)||val(C,getLang("news_show_X_reposts",E.childNodes.length)),b=b.parentNode,g.firstChild!=b&&g.insertBefore(b,g.firstChild),L.needScrollPost(t,b)&&(l+=b.offsetHeight+_(b)),b.bits=0;else if((k=geByClass("feed_repost"+I,g,"div"))&&k.length){v=rs(cur.wallTpl.grouped_posts,{place:I,random:irand(1e8,2e8),first:v,other:"",label:getLang("news_show_X_reposts",k.length)});var M=se('<div class="feed_row'+(B?"_unshown":"")+'">'+v+"</div>");g.insertBefore(M,g.firstChild),!B&&L.needScrollPost(t,M)&&(l+=M.offsetHeight+_(M)),A=!0,b=M.firstChild,w=geByClass1("feed_reposts_first",b,"div"),E=geByClass1("feed_reposts_group",b,"div"),each(clone(k),(function(){L.needScrollPost(t,this)&&(l-=this.offsetHeight+_(this)),(0,i.re)(this.parentNode),E.appendChild(this.firstChild)}))}else w=se('<div class="feed_row'+(B?"_unshown":"")+'"><div class="feed_repost'+I+'">'+v+"</div></div>"),g.insertBefore(w,g.firstChild),A=!0,!B&&L.needScrollPost(t,w)&&(l+=w.offsetHeight+_(w))}else w=se('<div class="feed_row'+(B?"_unshown":"")+'">'+v+"</div>"),g.insertBefore(w,g.firstChild),A=!0,!B&&L.needScrollPost(t,w)&&(l+=w.offsetHeight+_(w));if(0==e[8]){var D=geByClass1("post",w);addClass(D,"closed_comments")}if(cur.deepRepliesActive){var x=geByClass1("post",w);addClass(x,"deep_active")}B&&A&&(cur.newPostsCount=cur.newPostsCount?cur.newPostsCount+1:1,cur.feedEls.newPosts.innerHTML=getLang("news_new_posts",cur.newPostsCount),addClass(cur.feedEls.wrap,"feed_has_new"),1==cur.newPostsCount&&L.needScrollPost(t,cur.feedEls.newPosts)&&!R&&(l+=getSize(cur.feedEls.newPosts)[1])),AudioUtils.updateQueueReceivedPost(w),(0,T.updateNarrativeSnippetsFromQueueByPost)(w),(0,P.updateArticleSnippetsFromQueueByPost)(w),cur.feedUnreadCount++,"search"!=a&&(0,d.nodeUpdated)(w),m.length>300?g.removeChild(m[300]):m.length<=1&&removeClass(cur.feedEls.wrap,"feed_is_empty"),Wall.updateMentionsIndex();break;case"new_post_reply":if(n)break;var N=cur.rowsCont,H=N.childNodes,U=Wall.getNewPostHTML(e,!1,L.feedPostRepl);if(!U)break;var q=se('<div class="feed_row">'+U+"</div>");N.insertBefore(q,N.firstChild),L.needScrollPost(t,q)&&(l+=q.offsetHeight+_(q)),(0,T.updateNarrativeSnippetsFromQueueByPost)(q),(0,P.updateArticleSnippetsFromQueueByPost)(q),cur.feedUnreadCount++,H.length>300?N.removeChild(H[300]):H.length<=1&&removeClass(cur.feedEls.wrap,"feed_is_empty");break;case"edit_post":var F,W=ge("wpt"+s);if(!isVisible(n)||!W)break;var j=geByClass1("wall_post_more",W);j&&(j=isVisible((0,i.domNS)(j))),(F=L.needScrollPost(t,W))&&(l-=W.offsetHeight);var V=psr(rs(e[3],{poll_hash:cur.wallTpl.poll_hash})),G=ge("post"+s);G&&!isVisible(G.parentNode)&&(V=Wall.updatePostImages(V)),val(W,V),j&&(j=geByClass1("wall_post_more",W))&&j.onclick(),F&&(l+=W.offsetHeight),(0,T.updateNarrativeSnippetsFromQueueByPost)(W),(0,P.updateArticleSnippetsFromQueueByPost)(W),(0,d.nodeUpdated)(W),window.Wall&&Wall.updatePostAuthorData(s);break;case"edit_reply":var z=e[3],K=ge("wpt"+z);if(!isVisible("post"+z)||!K)break;var Q=geByClass1("wall_reply_more",K);Q&&(Q=isVisible((0,i.domNS)(Q)));var $=psr(e[4]);val(K,$),Q&&(Q=geByClass1("wall_reply_more",K))&&Q.onclick(),(0,T.updateNarrativeSnippetsFromQueueByPost)(K),(0,P.updateArticleSnippetsFromQueueByPost)(K),(0,d.nodeUpdated)(K);break;case"post_parsed_link":if(!n)break;var Y=geByClass1("wall_postlink_preview_btn_disabled",n);if(!Y)break;var Z=e[3];if("1"===Z)removeClass(Y,"wall_postlink_preview_btn_disabled");else if("0"===Z)(0,i.re)(Y);else if(Z){removeClass(Y,"wall_postlink_preview_btn_disabled");var J=geByClass1("flat_button",Y);J&&(J.setAttribute("href",e[3]),J.removeAttribute("onclick"))}break;case"del_post":if(n){var X=domClosest("feed_row",n)||domClosest("feed_row_unshown",n)||n;cur.wallMyDeleted[s]||(L.needScrollPost(t,n)&&(l-=n.offsetHeight+_(n)),revertLastInlineVideo(n),(0,i.re)(X)),cur.options.offset--,(0,i.hasClass)(cur.feedEls.wrap,"feed_has_new")&&!isVisible(X)&&(cur.newPostsCount--,cur.newPostsCount?cur.feedEls.newPosts.innerHTML=getLang("news_new_posts",cur.newPostsCount):removeClass(cur.feedEls.wrap,"feed_has_new"))}break;case"res_post":n&&cur.options.offset++;break;case"new_reply":if(!n||cur.wallMyReplied[s]||ge("post"+e[3]))break;if((0,i.hasClass)(ge("post"+s),"deep_active")){var ee=Wall.addNewReply(e);l+=ee[0];break}var te=ge("replies"+s),oe=ge("replies_wrap"+s),re=n.offsetHeight,ie=s.split("_")[0]<0?8&c?constants.Groups.GROUPS_ADMIN_LEVEL_EDITOR:2&c?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER:constants.Groups.GROUPS_ADMIN_LEVEL_USER,ne=Wall.getNewReplyHTML(e,ie);if(!ne)break;var ae,ce=!1,le=!1;if(isVisible(te)&&isVisible(oe)&&!isVisible("reply_link"+s)){ae=te.nextSibling;var de=geByClass("new_reply",te,"div").length+1;if(cur.wallMyOpened[s]){ae&&"replies_open"==ae.className&&(0,i.re)(ae),le=!0;var ue=geByClass1("wr_header",te,"a"),_e=geByClass("reply",te,"div").length+1,he=_e;ue&&(he=intval(ue.getAttribute("offs").split("/")[1])+1),(he>5||_e<he)&&(ue||te.insertBefore(ue=(0,i.ce)("a",{className:"wr_header"}),te.firstChild),Wall.updateRepliesHeader(s,ue,_e,he))}else ne=Wall.updatePostImages(ne),ce=se(ne),addClass(ce,"new_reply"),ae&&"replies_open"==ae.className||(ae=(0,i.ce)("div",{className:"replies_open",onclick:Wall.openNewComments.pbind(s),role:"button",tabIndex:0}),te.parentNode.insertBefore(ae,te.nextSibling)),ae.innerHTML=getLang("wall_x_new_replies_more",Math.min(100,de)),ae.newCnt=de}else(0,i.re)("reply_link"+s),(0,i.show)(oe,te),le=!0;s.split("_")[0]==vk.id&&cur.feedUnreadCount++,ce||(ce=se(ne)),te.appendChild(ce),L.needScrollPost(t,le?ce:ae)&&(l+=n.offsetHeight-re),ce instanceof HTMLElement&&((0,T.updateNarrativeSnippetsFromQueueByPost)(ce),(0,P.updateArticleSnippetsFromQueueByPost)(ce)),le&&(0,d.nodeUpdated)(ce),Wall.repliesSideSetup(s),Wall.updateMentionsIndex(),Likes.update("wall"+s,{comment_num:e[13]});break;case"del_reply":if(!cur.wallMyDeleted[s]&&n){if((0,i.hasClass)(gpeByClass("post",n),"deep_active")){var pe=Wall.removeDeepReply(e);l+=pe[0];break}L.needScrollPost(t,n)&&(l-=n.offsetHeight);var fe=n.parentNode.id.match(/replies(-?\d+_\d+)/);revertLastInlineVideo(n),(0,i.re)(n),fe&&Wall.repliesSideSetup(fe[1])}break;case"view_post":Likes.update("wall"+s,{views_num:Wall.formatCount(intval(e[3]))});break;case"like_post":case"like_reply":if(!n)break;var me="like_reply"==r?"wall_reply"+s:s,ve=n&&domByClass(n,"_like_wrap"),we=n&&domByClass(n,"_share_wrap"),be=(0,p.likeDataReactionsFields)(e);Wall.likeFullUpdate(ve,me,S({like_my:ve&&(0,i.hasClass)(ve,"my_like"),like_num:e[3],like_title:!1,share_my:we&&(0,i.hasClass)(we,"my_share"),share_num:e[4],share_title:!1},be))}return l},feedPostRepl:function(e,t){e.replies=cur.wallTpl.post_replies;var o={full_id:t[2],item_id:"wall_"+t[2],sec_name:stripHTML(t[3]),date:Wall.getNowRelTime(),del:cur.wallTpl.spam};if("search"==cur.section&&cur.q){var r,i,s,n=e.text||"",a=cur.q.toLowerCase().split(/[\s.,:;!?()]/),c=[],l=(n=n.replace(/<(.|\n)+?>/g,(function(e){return c.push(e),""}))).toLowerCase();for(r=a.length-1;r>=0;r--)if(s=a[r],trim(s))for(i=0;-1!=(i=l.indexOf(s,i));)n.charAt(i-1)!=String.fromCharCode(2)?(n=n.substr(0,i)+""+r+""+n.substr(i+s.length),l=l.substr(0,i)+""+r+""+l.substr(i+s.length)):i+=2;n=(n=n.replace(/\x02(\d+)\x02/g,(function(e,t){return'<span class="highlight">'+a[t]+"</span>"}))).replace(/\x01/g,(function(){return c.shift()||""})),o.text=n,"new_post_reply"==t[1]&&(o.date_postfix=t[7])}return o},reSortItems:function(){cur.feedToSort&&cur.feedToSort.length&&(each(cur.feedToSort,(function(e,t){var o=ge("post_ph"+t),r=ge("post"+t).parentNode;o&&r&&(o.parentNode.insertBefore(r,o),(0,i.re)(o))})),cur.feedToSort=[],scrollToY(0,0))},showNewPosts:function(){removeClass(cur.feedEls.wrap,"feed_has_new"),cur.newPostsCount=0;var e=ge("feed_rows");Wall.loadPostImages(e),each(geByClass("feed_row_unshown",e,"div"),(function(){replaceClass(this,"feed_row_unshown","feed_row")}))},updateTitle:function(){cur.idleManager&&(cur.idleManager.isIdle||(cur.feedUnreadCount=0),setDocumentTitle((cur.feedUnreadCount?"("+cur.feedUnreadCount+") ":"")+cur.feedInitialTitle))},toggleTabsMenuTab:function(e,t){var o=geByClass1("feed_section_"+e,cur.feedEls.rmenu);o&&toggleClass(o,"ui_rmenu_item_hidden",!t)},toggleTabsMenu:function(e,t){var o=ge("feed_add_list_icon");return void 0===t&&(t=!(0,i.hasClass)(o,"shown")),browser.mozilla&&setStyle("page_body",{overflow:t?"visible":""}),uiActionsMenu.toggle(o,t),t&&addEvent(document,"mousedown",(function e(t){L.toggleTabsMenu(!1,0),removeEvent(document,"mousedown",e)})),e&&cancelEvent(e)},checkTabsFilter:function(e,t){switch(t){case"news":return!1;case"newlist":return L.addList();default:if(i=t.match(/list(\d+)/))return L.editList(i[1])}var o,r,i,s=t==cur.section,n=cur.my_feed_types.tabs;o=-1!=(r=indexOf(n,t)),toggleClass(e,"checked",!o),o?(n.splice(r,1),s&&(cur.onSaveTabs=function(e,t){L.toggleTabsMenu(null,!1),L.switchSection("news")}.pbind(t,o))):n.push(t),cur.my_feed_types.tabs=n,L.toggleTabsMenuTab(t,!o||s),uiRightMenu.fixScroller(ge("ui_rmenu_"+cur.section+(cur.list||""))),clearTimeout(cur.saveTabsTO),cur.saveTabsTO=setTimeout(L.saveTabs,500)},hasSearchParams:function(e){var t=!1;return each(e,(function(e,o){if((!e.indexOf("c[")&&"c[section]"!==e||"q"==e)&&o)return t=!0,!1})),t},getSectionParams:function(e){var t={section:e};switch(e){case"news":case"recommended":case"groups":case"friends":case"videos":case"photos":case"podcasts":void 0===(t.subsection=cur.subsections[e])&&delete t.subsection;break;case"owner":(t.owner=cur.owner)||delete t.section;break;case"source":(t.source=cur.source)||delete t.source;break;case"list":void 0===(t.subsection=cur.subsections["list"+cur.list])&&delete t.subsection,(t.list=cur.list)||delete t.list;break;case"notifications":(t.source=cur.source)||delete t.source;break;case"articles":void 0===(t.subsection=cur.subsections[e])&&delete t.subsection;break;case"search":var o=ge("search_filters_form");if(o){var r=(0,_.serializeForm)(o)||{};for(var i in r)r[i]&&"0"!=r[i]||delete r[i];extend(t,r)}t["c[q]"]=trim(val(cur.feedEls.search));break;case"photos_search":(t.q=trim(val(cur.feedEls.search)))||delete t.section,(t.sort=intval(cur.search_sort_value))||delete t.sort;break;case"trends_search":window.nav.objLoc.trend_id&&(t.trend_id=window.nav.objLoc.trend_id),(t.q=trim(val(cur.feedEls.search)))||delete t.section,(t.sort=intval(cur.search_sort_value))||delete t.sort;break;case"articles_search":(t.q=trim(val(cur.feedEls.search)))||(t.section="articles");break;case"comments":cur.reposts&&(t.reposts=cur.reposts);break;case"mentions":var s=new URLSearchParams(location.search);s.delete("ref"),history.replaceState(null,"","?"+s+location.hash),cur.mentionObj&&cur.mentionObj!=vk.id&&(t.obj=cur.mentionObj)}return t},switchNotifyList:function(e,t){uiRightMenu.go(geByClass1("feed_section_"+e),!1,!1),L.go(t)},switchSubSection:function(e,t,o){if(t&&checkEvent(t))return!0;var r=cur.section;"list"===cur.section&&(r="list"+cur.list),cur.subsection=cur.subsections[r]=e;var i=L.getSectionParams(cur.section);i.hash=o,delete cur.feedUpdateLoading,delete cur.isFeedLoading,nav.go(extend(i||{},{0:"feed"})),uiRightMenu.showProgress(cur.feedEls.rmenu)},switchSection:function(e,t,o){if(t&&checkEvent(t))return!0;if(removeClass(cur.feedEls.wrap,"feed_has_new"),cur.newPostsCount=0,"photos_search"==e&&!trim(val(cur.feedEls.search))){if("photos_search"!=cur.section)return!1;e="photos"}"comments"==e&&(cur.reposts=cur.options.reposts=""),(0,u.statlogsValueEvent)("feed_switch",0,e),L.setSection(e,1);var r=L.getSectionParams(e||"news");delete cur.feedUpdateLoading,delete cur.isFeedLoading;var i=!o&&extend(r||{},{0:"feed"});return uiRightMenu.go(geByClass1("feed_section_"+e),!1,i),!1},setSection:function(e,t,o){if(t=t||0,cur.prevSection=cur.section,!(e==cur.section&&t<2)&&e){if(uiRightMenu.hideProgress(cur.feedEls.rmenu),cur.feedEls.search&&uiSearch.hideProgress(cur.feedEls.search),t>1){Page.playVkFestBanner&&Page.playVkFestBanner(),toggleClass(cur.feedEls.wrap,"feed_submit_shown",inArray(e,cur.options.feed_types.tabs.concat(["list","likes"]))),toggleClass(cur.feedEls.wrap,"feed_submit_only_shown",~["recommended","search","updates","comments"].indexOf(e));var r=inArray(e,["articles_search","articles","search","photos_search","photos","trends","trends_search"]);toggleClass(cur.feedEls.wrap,"feed_search_shown",r),r&&elfocus(cur.feedEls.search),"search"===e&&o.stories_block_show?addClass(cur.feedEls.wrap,"feed_submit_shown_stories"):removeClass(cur.feedEls.wrap,"feed_submit_shown_stories"),cur.section&&val(cur.feedEls.search,"")}2==t&&window.Stories&&Stories.updateFeedStories(e,o),cur.my_feed_types&&(~indexOf(cur.my_feed_types.optional_tabs,cur.section)&&!~indexOf(cur.my_feed_types.tabs,cur.section)&&L.toggleTabsMenuTab(cur.section,!1),~indexOf(cur.my_feed_types.optional_tabs,e)&&!~indexOf(cur.my_feed_types.tabs,e)&&L.toggleTabsMenuTab(e,!0)),cur.section=e,4!=t?(cur.editingHide=("notifications"==e||"replies"==e)&&L.notifyCheckHideReply,cur.gifAutoplayScrollHandler&&cur.gifAutoplayScrollHandler(),cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()):L.searchUpdate()}},applyOptions:function(e,t){t=t||0,e.no_left_ads&&(cur.no_left_ads=!0),e.owner&&(cur.owner=e.owner),cur.subsection=e.subsection||"",L.setSection(e.section,t,e),cur.options||(cur.options={reply_names:{}}),extend(cur.options.reply_names,e.reply_names),delete e.reply_names,extend(cur,e);var o=cur.section;if("list"===cur.section&&(o="list"+e.list),cur.subsections[o]=cur.subsection,e.loc&&2==t&&nav.setLoc(e.loc),e.section&&"news"==e.section&&e.subsection&&"top"==e.subsection&&(0,u.statlogsValueEvent)("feed_switch",0,"top_news",t),void 0!==e.filters){var r=ge("search_filters_minimized"),n=r&&(0,i.hasClass)(r,"ui_rmenu_item_expanded"),a=!!r;val("feed_filters",e.filters),window.searcher&&a&&f.searcher.toggleMinimizedFilters(ge("search_filters_minimized"),n,!0)}if(e.script&&(0,s.evalWithLogging)(e.script),e.htitle&&(cur.feedInitialTitle=document.title=replaceEntities(stripHTML(e.htitle))),void 0!==e.add_feed_queue&&null!==e.add_feed_queue?(cur.add_feed_queue=!1,e.add_feed_queue=!1,L.getNewQKey(0),!0!==e.add_queue&&(cur.add_queue=e.add_queue)&&setTimeout(L.update.pbind(0),0)):t&&"search"!=cur.section&&"news"!=cur.section&&cur.section&&(cur.add_feed_queue=!1,e.add_feed_queue=!1),e.add_queues&&(cur.add_queues=e.add_queues,setTimeout(L.update.pbind(0),0)),e.q){val(cur.feedEls.search,replaceEntities(e.q));var c=e.q;c.length>30&&(c=trim(c.substr(0,30))+"...")}e.last_view&&(cur.options.last_view=e.last_view),void 0!==e.feedback_list&&(cur.options.feedback_list=e.feedback_list),L.searchUpdate(),"comments"!=cur.section||cur.reposts||toggle("comments_filters",!cur.reposts),isString(cur.all_shown_text)&&val("all_shown",cur.all_shown_text),isString(cur.show_more_text)&&val("show_more_link",cur.show_more_text),cur.empty_text&&val("feed_empty",cur.empty_text),cur.count>=0&&(0,i.re)("feed_error_wrap");var l=!(geByClass1("feed_row",cur.rowsCont,"div")||!1),d=ge("feed_rows_next");if(l?(toggleClass(cur.feedEls.wrap,"feed_is_empty",!isVisible("feed_error_wrap")),hide("all_shown"),toggle("show_more_link",cur.count>0&&!cur.all_shown)):!cur.all_shown||d&&d.firstChild?(hide("all_shown"),(0,i.show)("show_more_link"),removeClass(cur.feedEls.wrap,"feed_is_empty")):(hide("show_more_link"),(0,i.show)("all_shown"),removeClass(cur.feedEls.wrap,"feed_is_empty"),(0,i.re)(d)),e.playlistsData&&(e.playlistsData=JSON.parse(e.playlistsData),cur.pageVideosList=extend(cur.pageVideosList||{},e.playlistsData)),("notifications"==cur.section||"replies"==cur.section)&&cur.notify){var _=ge("feedback_row"+cur.notify);_&&_.onclick&&(setTimeout((function(){_.onclick(),scrollToY(getXY(_)[1],0)}),browser.msie?100:0),delete cur.notify)}cur.feedSection&&cur.feedSection(e.section,e.subsection),e.hot_feature_tooltip&&setTimeout((function(){L.showHotTooltip(e.hot_feature_tooltip_hash)}),800)},showMore:function(){if(!cur.isFeedLoading){cur.disableAutoMore=!1;var e,t=ge("feed_rows_next");if(t){if(t.firstChild)for(;t.firstChild;)e=t.firstChild,cur.rowsCont!==(0,i.domPN)(t)&&L.sendInsertBeforeError(),cur.rowsCont.insertBefore(e,t),L.onPostLoaded(e,!0);(0,i.re)(t)}"live"==cur.section&&(cur.all_shown=!0);var o=ge("show_more_link");if(cur.all_shown&&(hide(o),(0,i.show)("all_shown")),"live"!=cur.section){var r=!1,s=function(e){e.keyCode==KEY.ESC&&(r=!0)};addEvent(document,"keyup",s);var n=L.getSectionParams(cur.section||"news");extend(n,{offset:cur.offset,from:cur.from,part:1,more:1,last_view:cur.options.last_view}),extend(n,cur.navParams),cur.options.feedback_list&&(n.list=cur.options.feedback_list),nav.objLoc.situational_suggest_id&&(n.situational_suggest_id=nav.objLoc.situational_suggest_id);var c=cur.section;ajax.post("al_feed.php?sm_"+cur.section,n,{onDone:function(e,t){if(removeEvent(document,"keyup",s),c==cur.section)if(r)cur.disableAutoMore=!0;else{if(t){var o,n=(0,i.ce)("div");for(n.innerHTML=t;o=n.firstChild;)o.firstChild&&o.firstChild.id&&!ge(o.firstChild.id)||"feedback_unread_bar"==o.id||(0,i.hasClass)(o,"feed_row_fb_hidden")||(0,i.hasClass)(o,"feed_to_recomm")?(cur.rowsCont.appendChild(o),L.onPostLoaded(o,!0)):n.removeChild(o)}shortCurrency(),L.applyOptions(e),setTimeout(L.scrollCheck,200)}},showProgress:function(){(0,a.lockButton)(o),cur.isFeedLoading=!0},hideProgress:function(){if((0,a.unlockButton)(o),cur.isFeedLoading=!1,o.seen){var e=Math.ceil((Date.now()-o.seen)/1e3),t=cur.section+(cur.subsection?"_"+cur.subsection:"");(0,u.statlogsValueEvent)("feed_load_more_seen_time",e,t),o.seen=!1}},cache:1})}}},showMoreFriends:function(e,t){checkEvent(t)||((0,a.lockButton)(e),cur._back.show.push((function(){(0,a.unlockButton)(e)})),nav.go("/friends?act=find"))},showMorePublics:function(e,t){checkEvent(t)||((0,a.lockButton)(e),cur._back.show.push((function(){(0,a.unlockButton)(e)})),nav.go("/groups?act=catalog&c%5Bcategory%5D=0 "))},getTypesSection:function(){switch(cur.section){case"owner":return cur.owner>0?"person":"group";default:return cur.section}},checkFilter:function(e,t){var o,r=L.getTypesSection(),i=cur.my_feed_types[r],s=cur.feed_types[r];"notifications"!=r?(!0===i&&(i=clone(s)),-1!=(o=indexOf(i,t))?i.splice(o,1):(i.push(t),i.length==s.length&&(i=!0)),checkbox(e),cur.my_feed_types[r]=i,L.updateTypesCookie(),L.setFiltersUpdatePage(),cur.feedEls.rmenu&&uiRightMenu.showProgress(cur.feedEls.rmenu)):L.setNotifyFilter(e,t)},setFilter:function(e,t){var o=L.getTypesSection(),r=ge(o+"_type_filter"),i=!0;"notifications"!=o&&(each(geByClass("_feed_filter_row",r,"div"),(function(){if(isChecked(this)&&this!=e)return i=!1})),i?(cur.my_feed_types[o]=!0,each(geByClass("_feed_filter_row",r,"div"),(function(){checkbox(this,!0)}))):(each(geByClass("_feed_filter_row",r,"div"),(function(){checkbox(this,!1)})),cur.my_feed_types[o]=[t],checkbox(e,!0)),L.updateTypesCookie(),L.setFiltersUpdatePage({force_expand_filters:1}),cur.feedEls.rmenu&&uiRightMenu.showProgress(cur.feedEls.rmenu))},setFiltersUpdatePage:function(e){e=e||{};var t=nav.strLoc;if("updates"===cur.section){t.match(/\&filters\_expanded\=1/)||ge("updates_show_all_filters")&&!e.force_expand_filters||(t+="&filters_expanded=1"),t=t.replace(/\&filters\_shown\=([a-z\,]+)/,"");for(var o=geByClass("_feed_filter_row","feed_filters"),r=[],s=0;s<o.length;s++)(0,i.hasClass)(o[s],"hide")||r.push(o[s].id.replace("filter_updates",""));t+="&filters_shown="+r.join(",")}nav.go(t)},setNotifyFilter:function(e,t){checkbox(e),cur.notifyPrefs||(cur.notifyPrefs={}),cur.notifyPrefs[t]=isChecked(e),clearTimeout(cur.saveNotifyPrefsTO),cur.saveNotifyPrefsTO=setTimeout((function(){var e=[];each(cur.notifyPrefs,(function(t,o){e.push((o?"":"-")+t)})),e=e.join(","),ajax.post("/al_feed.php",{act:"a_set_notify_prefs",prefs:e,feed:1,hash:cur.topNotifyHash},{onDone:function(e){addTemplates({top_notify_prefs:e}),toggleClass("top_notify_pref_"+t,"checked",cur.notifyPrefs[t]),cur.notifyPrefs={},window.TopNotifier&&TopNotifier.invalidate(),nav.go(nav.strLoc),cur.feedEls.rmenu&&uiRightMenu.showProgress(cur.feedEls.rmenu)}})}),500)},updateTypesCookie:function(){var e=[];each(cur.my_feed_types,(function(t,o){"tabs"!=t&&e.push(!0===o?"*":o.join(","))})),setCookie("remixfeed",e.join("."),365)},toggleFeedTop:function(e,t,o){var r=geByClass1("_ui_toggler",e),s="top";switch(toggleClass(r,"on"),cur.section){case"news":case"recommended":case"groups":case"friends":case"videos":case"photos":case"list":s=(0,i.hasClass)(r,"on")?"top":"recent";break;case"articles":s=(0,i.hasClass)(r,"on")?"suggested":"top";break;case"podcasts":s=(0,i.hasClass)(r,"on")?"recent":"top"}L.switchSubSection(s,t,o)},switchList:function(e){cur.prevList=cur.list,cur.list=e,L.setSection("list",1),uiRightMenu.go(geByClass1("feed_section_list"+e),!1,!1),L.go(L.getSectionParams(cur.section))},setSearchSort:function(e){cur.search_sort_value=e,L.submitSearch()},_activateReplyBox:function(e,t,o){(t||{}).cancelBubble=!0;var r=ge("reply_box"+e);if(cur.editing&&cur.editing!=e&&cur.notifyReplyData&&cur.notifyReplyData[cur.editing].disabled&&L.notifyCheckHideReply(cur.editing,(window.event||{}).target),r&&isVisible(r))L.notifyCheckHideReply(e,!1);else if(void 0===cur.notifyReplyData&&(cur.notifyReplyData={}),cur.notifyReplyData[e]=o,o.disabled){r?(0,i.show)(r):ge("feedback_row"+e).appendChild(se(rs(cur.options.feedback_dis,{item:e,text:o.disabled}))),setTimeout((function(){cur.editing=e}),0)}else{(0,i.show)(r),Wall.showEditReply(e,t);var s=ge("reply_field"+e);s.setAttribute("placeholder",o.ph),window.Emoji&&Emoji.val(s,o.greet.replace(/ $/,"&nbsp;")),(0,i.data)(s,"send",L.notifySendReply),removeClass("reply_box"+e,"clear_fix")}},notifyClick:function(e,t,o){var r=ge("feedback_row"+e);Wall.checkPostClick(r,t)&&L._activateReplyBox(e,t,o)},blindNotifyReply:function(e,t,o){L._activateReplyBox(e,t,o)},notifySendReply:function(e,t,o){var r=cur.notifyReplyData[e];if(r&&!r.sending){var s,n=ge("reply_field"+e),c=ge("reply_button"+e),l=ge("feedback_row"+e),d=n&&(0,i.data)(n,"composer");if(o.stickerId)s={message:"",attach1_type:"sticker",attach1:o.stickerId};else{if((s=d?Composer.getSendParams(d,L.notifySendReply.pbind(e)):{message:trim(Emoji.editableVal(n))}).delayed)return;if(!s.attach1_type&&(!s.message||r.greet&&!r.greet.indexOf(s.message)))return void Emoji.editableFocus(n,!1,!0)}extend(s,{act:"post",from:"feedback",item:e},r.params||{});var u=ge("reply_as_group"+e);u&&isVisible((0,i.domPN)(u))&&(s.from_oid=domData(domClosest("_submit_post_box",u),"from-oid")),r.sending=1,ajax.post("al_wall.php",Wall.fixPostParams(s),{onDone:function(t,o){if(delete r.sending,d?Composer.reset(d):window.Emoji&&Emoji.val(n,""),n.autosize&&n.autosize.update(),L.notifyHideReply(e),o){var s=geByClass1("_answer_wrap",l);val(s,o),(0,i.show)(s)}else t&&showDoneBox(t)},onFail:function(){delete r.sending},showProgress:a.lockButton.pbind(c),hideProgress:a.unlockButton.pbind(c)})}},notifyCheckHideReply:function(e,t){var o=cur.notifyReplyData&&cur.notifyReplyData[e];if(o&&!o.sending&&isVisible("reply_box"+e)){if(cur.editing=!1,!o.disabled){var r=ge("reply_field"+e),i=trim(window.Emoji?Emoji.editableVal(r):""),s=Wall.hasComposerMedia(r);if(!r||s||i&&!o.greet||o.greet.indexOf(i))return}L.notifyHideReply(e)}},notifyHideReply:function(e){cur.editing==e&&(cur.editing=!1);var t=ge("feedback_row"+e);removeClass(t,"reply_box_open"),hide("reply_box"+e);var o=cur.replySubmitSettings;o&&o.tt&&o.tt.el&&o.tt.destroy()},notifyPostTooltip:function(e,t,o,r){var i=(o||{}).reply,s="al_wall.php";t.indexOf("topic_comment")?t=t.replace("wall_reply","").replace("wall",""):(s="al_board.php",t=t.replace("topic_comment","")),r=r||{},(0,l.showTooltip)(e,extend({url:s,params:extend({act:"post_tt",post:t,self:1,from:"feedback"},o||{}),slide:15,shift:[!i||i%2?27:329,6],ajaxdt:100,showdt:400,hidedt:800,dir:"auto",className:"rich wall_tt wall_module _feed_notification feed_notification",appendParentCls:"scroll_fix_wrap"},r))},sendInsertBeforeError:function(){ajax.post("al_page.php",{act:"insert_before_error",trace:(new Error).stack,owner_id:cur.oid,module:cur.module})},getModuleRef:function(){var e=cur.module||"feed_other";return"feed"==cur.module&&(e="news"==cur.section?cur.subsection?"feed_news_"+cur.subsection:"feed_news":"podcasts"===cur.section?e+"_"+cur.section+("recent"===cur.subsection?"_my":""):cur.section?e+"_"+cur.section:"feed_other"),e},ignoreItem:function(e,t,o,r,n){var a,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";switch(e){case b.BlockTypeIds.MarketItems:case b.BlockTypeIds.PhotoRecognize:case b.BlockTypeIds.RecommendedNarratives:a=ge(e);break;default:a=ge("post"+e)}if(a){var d=a.getAttribute("data-ad"),u=geByClass1("ui_actions_menu_wrap",a),_=L.getModuleRef();return u&&uiActionsMenu.toggle(u,!1),revertLastInlineVideo(a),t.includes("caption")?cur.feedEntriesHTML[e+"_ignored"]=val(a):cur.feedEntriesHTML[e]=val(a),new Promise(((u,h)=>{ajax.post("/al_feed.php?misc",{act:"a_ignore_item",post_raw:e,feed_raw:t,caption_type:r,uids:n,hash:o,ad_data:d,ref:_,session_id:cur.feed_session_id,module:L.getModuleRef(),position:indexOf((0,i.domPN)((0,i.domPN)(a)).children,(0,i.domPN)(a)),reason_id:c,track_code:l},{onDone:function(e,t){L.destroyPhotoCarouselByPost(a),val(a,e),(0,s.evalWithLogging)(t),u()},onFail:()=>(h(),!0),stat:[jsc("web/privacy.js"),"privacy.css"]})}))}},unignoreItem:function(e,t,o,r){var i=L.getModuleRef();ajax.post("/al_feed.php?misc",{act:"a_unignore_item",post_raw:e,feed_raw:t,hash:o,ref:i},{onDone:function(){t.includes("caption")?val("post"+e,cur.feedEntriesHTML[e+"_ignored"]):L.restorePost(e)},showProgress:r&&a.lockButton.pbind(r),hideProgress:r&&a.unlockButton.pbind(r)})},reportIgnoredItem:function(e,t){ajax.post("al_wall.php",{act:"spam",post:e,hash:t},{onDone:function(t){var o=ge("post"+e),r=o&&geByClass1("feed_post_report",o,"div");val(r,t)}})},ignoreOwner:function(e,t,o,r,i){e&&(cur.feedEntriesHTML[e+"_ignored"]=val("post"+e));var s="list"==cur.section&&cur.list||0,n=L.getModuleRef();ajax.post("/al_feed.php?misc",{act:"a_ignore_owner",post_raw:e,owner_id:t,type:o,hash:r,list:s,ref:n},{onDone:function(o){val("post"+e,o),each(geByClass("post",cur.rowsCont),(function(o,r){var i=this.id.match(/post((-?\d+)_(-?\d+)(_\d+)?)/);i&&i[1]!=e&&(!i[4]&&i[2]==t||i[4]&&i[3]==t)&&(revertLastInlineVideo(this),hide(this.parentNode))}))},showProgress:i&&a.lockButton.pbind(i),hideProgress:i&&a.unlockButton.pbind(i)})},unignoreOwner:function(e,t,o,r){var s="list"==cur.section&&cur.list||0,n=L.getModuleRef();ajax.post("/al_feed.php?misc",{act:"a_unignore_owner",post_raw:e||"",owner_id:t,hash:o,list:s,ref:n},{onDone:function(o){e?val("post"+e,cur.feedEntriesHTML[e+"_ignored"]):val("ignore_row"+t,o),each(geByClass("post",cur.rowsCont),(function(e,o){var r=this.id.match(/post((-?\d+)_(-?\d+)(_\d+)?)/);r&&(!r[4]&&r[2]==t||r[4]&&r[3]==t)&&(0,i.show)(this.parentNode)}))},showProgress:r&&a.lockButton.pbind(r),hideProgress:r&&a.unlockButton.pbind(r)})},ignoreGroupWall:function(e,t,o,r){e&&(cur.feedEntriesHTML[e+"_ignored"]=val("post"+e));var i=L.getModuleRef();ajax.post("/al_feed.php?misc",{act:"a_ignore_owner",post_raw:e,owner_id:t,ignore_type:"group_wall",hash:o,ref:i},{onDone:function(t){val("post"+e,t)},showProgress:r&&a.lockButton.pbind(r),hideProgress:r&&a.unlockButton.pbind(r)})},unignoreGroupWall:function(e,t,o,r){var i=L.getModuleRef();ajax.post("/al_feed.php?misc",{act:"a_unignore_owner",post_raw:e||"",owner_id:t,ignore_type:"group_wall",hash:o,ref:i},{onDone:function(o){e?val("post"+e,cur.feedEntriesHTML[e+"_ignored"]):val("ignore_row"+t,o)},showProgress:r&&a.lockButton.pbind(r),hideProgress:r&&a.unlockButton.pbind(r)})},ignoreLiveOwner:function(e,t,o,r){var i=ge("post"+e),s=geByClass1("ui_actions_menu_wrap",i);s&&uiActionsMenu.toggle(s,!1),revertLastInlineVideo(i),cur.feedEntriesHTML[e+"_ignored"]=val("post"+e),ajax.post("al_feed.php?act=a_ignore_live_owner",{post_raw:e,owner_id:t,hash:o},{onDone:function(t){val("post"+e,t)},showProgress:r&&a.lockButton.pbind(r),hideProgress:r&&a.unlockButton.pbind(r)})},unignoreLiveOwner:function(e,t,o,r){ajax.post("al_feed.php?act=a_unignore_live_owner",{post_raw:e,owner_id:t,hash:o},{onDone:function(t){val("post"+e,cur.feedEntriesHTML[e+"_ignored"])},showProgress:r&&a.lockButton.pbind(r),hideProgress:r&&a.unlockButton.pbind(r)})},unsubscribe:function(e,t,o){triggerEvent(ge("post_delete"+e),"mouseout"),cur.feedEntriesHTML[e]=ge("post"+e).innerHTML;var r=e.match(/(\-?\d+)_(photo|video|shortVideo|topic|note|market|)(\d+)/);r&&ajax.post("al_feed.php",{act:"unsubscribe",type:{"":24,photo:21,video:22,shortVideo:26,topic:20,note:23,market:25}[r[2]],owner_id:r[1],place_id:r[3],hash:t,feed:1},{onDone:function(t){ge("post"+e).innerHTML=t.replace("%post_raw%",e)},showProgress:o&&a.lockButton.pbind(o),hideProgress:o&&a.unlockButton.pbind(o)})},subscribe:function(e,t,o){var r=e.match(/(\-?\d+)_(photo|video|shortVideo|topic|note|market|)(\d+)/);r&&ajax.post("al_feed.php",{act:"subscribe",type:{"":24,photo:21,video:22,shortVideo:26,topic:20,note:23,market:25}[r[2]],owner_id:r[1],place_id:r[3],hash:t,feed:1},{onDone:L.restorePost.pbind(e),showProgress:o&&a.lockButton.pbind(o),hideProgress:o&&a.unlockButton.pbind(o)})},restorePost:function(e){var t;switch(e){case b.BlockTypeIds.MarketItems:case b.BlockTypeIds.PhotoRecognize:t=ge(e);break;default:t=ge("post"+e)}if(t){t.innerHTML=cur.feedEntriesHTML[e],this.initPhotoCarouselInPost(t);var o=geByClass1("input_back",t,"div"),r=geByTag1("textarea",t);r&&(r.placeholder=o.innerHTML,o.parentNode.removeChild(o),(0,n.placeholderSetup)(r))}},toggleReposts:function(e,t,o,r){if(checkEvent(r))return!0;var s=ge("feed_reposts_more"+t+"_"+o),n=ge("feed_reposts"+t+"_"+o),a=0,c=scrollGetY(),l=isVisible(n);if(n)return l?a-=n.offsetHeight+intval(getStyle(e,"marginTop")):((0,i.domPN)((0,i.domPN)(n))||{}).bits=0,toggle(n,!l),val(s,l?getLang("news_show_X_reposts",n.childNodes.length):getLang("news_hide_reposts")),a&&scrollToY(c+a+getSize("page_header")[1],0),!1;s&&(0,i.re)(s.parentNode.parentNode)},editHidden:function(){return showTabbedBox("al_settings.php",{act:"a_edit_owners_list",list:"feed",height:lastWindowHeight},{stat:["ui_controls.js","ui_controls.css",jsc("web/indexer.js")]}),cur.onOListSave=L.onHiddenSave,!1},onHiddenSave:function(e,t,o,r){var i=curBox(),s={act:"a_ignore_olist",no_reposts:ge("feed_list_reposts")&&!isChecked("feed_list_reposts")?1:0,hash:r.hash};return e.length<t.length?s.White=e.join(","):s.Black=t.join(","),ajax.post("al_feed.php",s,{onDone:function(e,t){i.hide(),L.switchSection("photos"==cur.section?"photos":"news")},showProgress:a.lockButton.pbind(i.btns.ok[0]),hideProgress:a.unlockButton.pbind(i.btns.ok[0])}),!1},addList:function(){return L.editList(-1)},editList:function(e){return L.toggleTabsMenu(!1,0),showTabbedBox("al_settings.php",{act:"a_edit_owners_list",list:"feed",list_id:e,height:lastWindowHeight},{stat:["ui_controls.js","ui_controls.css",jsc("web/indexer.js")],onFail:function(e){return setTimeout((0,c.showFastBox)({title:getLang("global_error"),bodyStyle:"padding: 20px; line-height: 160%;"},e,getLang("global_close")).hide,4500),!0}}),cur.onOListSave=L.onListSave.pbind(e),!1},onListSave:function(e,t,o,r,s){var n=val("feed_list_name");if(!trim(n))return(0,a.notaBene)("feed_list_name"),!1;if(!t.length)return!1;var c=curBox();return ajax.post("al_feed.php",{act:"a_save_list",hash:cur.tabs_hash,White:t.join(","),title:n,list_id:e,no_reposts:ge("feed_list_reposts")&&!isChecked("feed_list_reposts")?1:0},{onDone:function(t){var o=geByClass1("feed_section_list"+e,cur.feedEls.rmenu),r=geByClass1("feed_filter_list"+e,cur.feedEls.rmenu);val(o,clean(n)),val(geByClass1("ui_actions_menu_item_label",r),clean(n)),c.hide(),e>0?L.switchList(e):nav.go({0:"feed",section:"list",list:t},null,{nocur:!0})},onFail:function(e){return val("feed_list_error",e),(0,i.show)("feed_list_error_wrap"),!0},showProgress:a.lockButton.pbind(c.btns.ok[0]),hideProgress:a.unlockButton.pbind(c.btns.ok[0])}),!1},deleteList:function(e,t,o,r){if(r&&cancelEvent(r),e<=0)return!1;if(o){var s=curBox();ajax.post("al_feed.php",extend({act:"a_delete_list",list_id:e,hash:cur.tabs_hash}),{onDone:function(){(0,i.re)(geByClass1("feed_section_list"+e,cur.feedEls.rmenu)),(0,i.re)(geByClass1("feed_filter_list"+e,cur.feedEls.rmenu)),boxQueue.hideAll(),"list"==cur.section&&cur.list==e&&L.switchSection("news")},showProgress:a.lockButton.pbind(s.btns.ok[0]),hideProgress:a.unlockButton.pbind(s.btns.ok[0])})}else{L.toggleTabsMenu(!1,0);var n=(0,c.showFastBox)({title:getLang("news_delete_list_sure_title"),bodyStyle:"padding: 20px; line-height: 160%;"},getLang("news_delete_list_sure").replace("{list}",t),getLang("global_delete"),(function(){L.deleteList(e,t,!0)}),getLang("global_cancel"),(function(){n.hide()}))}},saveTabs:function(){ajax.post("al_feed.php",{act:"a_save_tabs",hash:cur.tabs_hash,tabs:cur.my_feed_types.tabs.join(",")},{hideProgress:function(){(0,m.isFunction)(cur.onSaveTabs)&&cur.onSaveTabs(),cur.onSaveTabs=null}})},statsShow:function(e,t){return showWiki({w:"stats"+(cur.source||"")},!1,e)},editLiveBlacklist:function(e){cancelEvent(e),showBox("al_video.php?act=live_blacklist_box",{},{onDone:function(e,t){v.default.init(e,t)},stat:["videoview.js","videoview.css",jsc("web/indexer.js")]})},scrollCheck:(0,g.debounce)((function(e){if("scroll"==(e=e||{}).type||cur.idleManager&&!cur.idleManager.isIdle){var t,o,s,n,c,l,d=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight,_=scrollGetY(),p=0,f=[];if(cur.isFeedLoading||cur.disableAutoMore||(n=ge("show_more_link"),isVisible(n)&&_+d+1e3>n.offsetTop&&L.showMore()),(0,i.domPN)(cur.topRow)==cur.rowsCont&&"feed_rows_next"!=(cur.topRow||{}).id||(cur.topRow=domFC(cur.rowsCont)),vk.id&&cur.topRow&&"feed_rows_next"!=cur.topRow.id&&(!((window.curNotifier||{}).idle_manager||{}).is_idle||"init"==e.type)){var g=[];for(n=domPS(cur.topRow);n;n=domPS(n))cur.topRow.offsetTop>_&&(cur.topRow=n),n.unseen||(n.unseen=!0,g.push((0,w.postsGetRaws)(n)));for(Page.postsUnseen(g),n=cur.topRow;n&&!((t=p||n.offsetTop)>=_+d);n=c)if("feed_rows_next"==((c=(0,i.domNS)(n))||{}).id&&(c=null),(p=c?c.offsetTop:t+n.offsetHeight)<_&&c&&(cur.topRow=c),LongView&&LongView.register(n,"feed"),y.longView.registerElement(n),!((l=n.bits||0)>=3)&&(cur.feedSeenPostHeight>0?(cur.feedPostHeaderHeight=cur.feedPostHeaderHeight||(0,i.getH)(geByClass1("post_header",n)),s=(o=t+cur.feedPostHeaderHeight)+cur.feedSeenPostHeight,n.postBottom||(n.postBottom=o+(0,i.getH)(geByClass1("wall_text",n))),l|=(o>=_&&o<_+d?1:0)|((s=Math.min(s,n.postBottom))>=_&&s<_+d?2:0)):l|=(t>=_&&t<_+d?1:0)|(p>=_&&p<_+d?2:0),l&&(n.bits=l,3==l))){var m=(0,w.postsGetRaws)(n);if((0,w.isAdWithLongImpressionOnly)(n)||(0,w.isAutoplayAd)(n)?Wall.triggerAdStat(domFC(n),"impression"):f.push(m),(0,i.hasClass)(n,"feed_to_recomm"))(0,u.statlogsValueEvent)("promo_button_view_blocks",m.index,m.module);else if(geByClass1("feed_friends_recomm",n))!function(){var e=geByClass1("ui_gallery",n),t=domData(e,"from"),o=domData(e,"code")||"";(0,h.friendsRecommLogSave)(["view_block",t,m.index,vkNow(),m.module,o],!0);var i=(0,r.uiGetGallery)(e);i&&i.getVisibleItems().forEach((function(e){(0,h.onViewFriendRecomm)(e[0],e[1],t)})),e.visible=!0}();else if(geByClass1("feed_groups_recomm",n)){var v,b=geByClass1("ui_gallery",n),E=domData(b,"code")||"";null===(v=window.RecommendedGroups)||void 0===v||v.viewBlock(E);var C=(0,r.uiGetGallery)(b);C&&C.getVisibleItems().forEach((function(e){var t;null===(t=window.RecommendedGroups)||void 0===t||t.onViewGroup(e[0])})),b.visible=!0}}f=f.concat(y.longView.process(_,d)),LongView&&LongView.onScroll(_,d),Page.postsSeen(f);var k=ge("show_more_link"),T=k.offsetTop;if(!k.seen&&T>=_&&T<_+d){k.seen=Date.now();var P=cur.section+(cur.subsection?"_"+cur.subsection:"");(0,u.statlogsValueEvent)("feed_load_more_seen",(0,a.isButtonLocked)(k),P)}}}}),20),searchUpdate:function(){var e;cur.feedEls.search&&getLang("news_search")&&(e=cur.section.indexOf("photos")?cur.section.indexOf("articles")?getLang("news_search"):getLang("news_articles_search"):getLang("news_photo_search"),cur.feedEls.search.setAttribute("placeholder",clean(unclean(e))),placeholderInit(cur.feedEls.search,{reload:!0}))},go:function(e,t,o){if(e=e||{},cur._back_local){var r=cur._back_local;r.back?showBackLink(r.back[0],r.back[1],r.back[2]):showBackLink(!1),cur._back_local=!1}if(cur.feedReq)try{cur.feedReq.abort()}catch(e){debugLog(e)}cur.feedReqObj=null;var n=1,a=function(){cur.isFeedLoading=!1};(browser.msie||o)&&(n=!1,a=cur.onFrameBlocksDone),cur.wasScroll=!!o&&scrollGetY();var c=window.event&&window.event.target;if(c&&"search"===e.section&&!e._post){var l=nav.getPostParams(c);if(l.post_id&&l.post_click_type){function d(t,o){t&&!e[o]&&(e[o]=t)}d(l.post_id,"_post"),d(l.post_click_type,"_post_click_type"),d(l.post_click_url,"_post_click_url"),d(l.post_click_mention_id,"_post_click_mention_id"),d(l.post_click_cc_key,"_post_click_cc_key"),d(l.ad_data,"_post_ad_data"),d(l.ad_block_unique_id,"_post_ad_block_unique_id")}}var _=cur.feedReqObj={},h={},p=0,f=()=>{if(cur.feedReqObj&&cur.feedReqObj===_&&!(++p>500)){var e=!0,t={};each(h,(function(o){var r=ge(o);if(r&&(0,i.hasClass)(r,"feed_row"))return r.firstChild?void L.onPostLoaded(r,!0):(t[o]=!0,void(e=!1))})),e||(h=t,setTimeout(f,100))}},g=+new Date;cur.feedReq=ajax.post("al_feed.php",extend(e,{part:1}),{onDone:function(o,r,a,c,l){if(revertLastInlineVideo(),removeClass(cur.feedEls.wrap,"feed_has_new"),cur.newPostsCount=0,window.tooltips&&tooltips.destroyAll(ge("feed_rows")),boxQueue.hideAll(),layers.fullhide&&!cur.storyLayer&&layers.fullhide(!0),n&&ajax._framenext(),window.wall&&Wall.cancelEdit(),boxQueue.hideAll(),t?t(r||""):val(cur.rowsCont,r||""),L.applyOptions(o,2),!e.norecom&&"notifications"!==e.section){val("feed_recommends",o.recommends||""),toggle("feed_recommends",!!o.recommends);var d="/al_feed.php#"+AjaxConvert.toQueryString({act:"recom"});ajaxCache[d]&&delete ajaxCache[d],cur.recomPreload=!1,toggleClass(cur.feedEls.wrap,"feed_asc_shown",geByClass1("feed_asc_block","feed_recommends"))}var _;if(a&&(0,s.evalWithLogging)(a),checkPageBlocks(),scrollToTop(0),shortCurrency(),cur.feedEls.wall)switch(_="clear_fix",cur.section){case"updates":_+=" page_block feed_updates";break;case"photos_search":_+=" page_block feed_found_photos";break;case"notifications":_+=" page_block feed_notifications";break;case"coronavirus":case"stayhome":_+=" feed_wall--with-header"}if(ge("feed_wall").className=_,toggle("feed_recommends",inArray(cur.section,["news","recommended","videos"])),val("feed_app_widget",c||""),toggle("feed_app_widget",c),c&&l&&(0,s.evalWithLogging)(l),cur.rowsCont&&cur.rowsCont.children&&(each(cur.rowsCont.children,(function(){var e=this;(0,i.hasClass)(e,"feed_row")&&(!e.id||e.firstChild?L.onPostLoaded(e,!0):h[e.id]=!0)})),isEmpty(h)||setTimeout(f,10)),cur.q){var p="photos_search"===cur.section?u.servicePhotos:u.serviceNews,m=+new Date-g;(0,u.saveSearchAttemptStats)(p,0,cur.count,val(cur.feedEls.search),0,0,m),(0,k.updateCounters)(location.href,document.referrer)}setTimeout(L.scrollCheck,200)},onFail:function(){return!1},showProgress:function(){cur.isFeedLoading=!0},frame:n,ads:1,hideProgress:a})},onFeedSearch:function(e,t,o,r){t||(0,u.removeSearchPositionTracker)("photos");var i,s,n=r||cur.section;if(n.indexOf("photos")?n.indexOf("trends")?n.indexOf("articles")?(i="search",s="news"):(i="articles_search",s="articles"):(i="trends_search",s="trends"):(i="photos_search",s="photos"),"search"==i||L.hasSearchParams(L.getSectionParams(i))){i!=cur.section&&L.setSection(i,1);var a=L.getSectionParams(i);cur.disableSort&&(a.disable_sort=1),L.go(a),window.searcher&&f.searcher.highlightHotHashtag(t||val(e))}else L.go(L.getSectionParams(s));uiSearch.onChanged(e),uiSearch.showProgress(e)},onSearchChange:function(){return setTimeout(L.onFeedSearch.pbind(cur.feedEls.search),0),!1},init:function(e){var t,o,r,s;setTimeout((function(){each(geByTag("textarea",cur.rowsCont),(function(){(0,n.placeholderSetup)(this)})),cur.q&&(0,u.saveSearchAttemptStats)("photos_search"===cur.section?u.servicePhotos:u.serviceNews,0,cur.count,val(cur.feedEls.search))}),200),extend(cur,{oid:e.user_id,postTo:e.user_id,phCache:{},phShown:{},subsections:{},feed_session_id:e.feed_session_id||"na",module:"feed",isFeedLoading:!1,customSearchChange:L.onSearchChange,navParams:e.nav_params||{},wallPostCb:function(){"news"==cur.section?setTimeout(L.update.pbind(1),1e3):setTimeout(L.switchSection.pbind("news"),1e3)},idleManager:(s={isIdle:!1,onIdle:null,onUnIdle:null,stop:function(){removeEvent(document,"mousemove keydown",t),removeEvent(window,"focus blur",r)},start:function(){browser.mobile||(t=function(){cur.idleManager&&s.isIdle&&(s.isIdle=!1,s.onUnIdle&&s.onUnIdle())},o=function(){cur.idleManager&&(s.isIdle=!0,s.onIdle&&s.onIdle())},r=function(e){"focus"==e.type?t():o()},addEvent(window,"focus blur",r))}},s),currentModule:function(){return"videos"==cur.section?"feed_videos":cur.module},onFrameBlocksDone:function(){cur.isFeedLoading=!1,(0===cur.wasScroll||cur.wasScroll>0||!1===cur.wasScroll&&"search"==cur.section&&cur.q&&"#"==cur.q.substr(0,1))&&(cur.wasScroll=!1)},feedEntriesHTML:{},feedUnreadCount:0,feedInitialTitle:"",feedUnread:[],feedToSort:[],feedEls:{wrap:ge("main_feed"),wall:ge("feed_wall"),search:ge("search_query"),rmenu:ge("feed_rmenu"),newPosts:ge("feed_new_posts")}}),cur.nav.push((function(e,t,o,r){if(void 0===e[0]){var i=clone(o);if(delete i[0],void 0===e.section||inArray(cur.section,["notifications","replies"])==inArray(e.section,["notifications","replies"])){if("notifications"==cur.section)return L.switchNotifyList(o.list||"all",extend(i,r.params||{})),!1;if(e.list)return L.switchList(e.list),!1;if(void 0!==e.section&&L.switchSection(e.section||"news",!1,!0),e.notify)return!1;if(e.q)return val(cur.feedEls.search,e.q),L.onFeedSearch(cur.feedEls.search),!1;if(delete e.subsection,isEmpty(e)){var s=geByClass1("feed_section_"+(t.section||"news")+(t.list||""));s&&uiRightMenu.go(s,!1,!1)}return cur.likesTabTT&&cur.likesTabTT.destroy(),L.go(extend(i,r.params||{})),!1}}})),cur.idleManager.onUnIdle=L.updateTitle,cur.idleManager.onIdle=L.reSortItems,cur.options=cur.options||{},extend(cur.options,e),L.applyOptions(e,3),cur.rowsCont=e.wallCont=ge("feed_rows"),Wall.init(e),cur.rowsCont&&cur.rowsCont.children&&each(cur.rowsCont.children,(function(){var e=this;(0,i.hasClass)(e,"feed_row")&&e.firstChild&&L.onPostLoaded(e,!0)})),cur._back={text:getLang("news_return_to_news"),show:[L.startEvents],hide:[function(){clearInterval(cur.updateInt),removeEvent(window,"scroll",L.scrollCheck),removeEvent(window,"resize",L.scrollCheck),cur.idleManager.stop(),clearTimeout(cur.lp_error_to)}],loc:!1},L.startEvents(),(0,h.friendsRecommLogSend)(!0),setTimeout((function(){L.scrollCheck({type:"init"})}),200)},startEvents:function(){cur.idleManager.start(),cur.updateInt=setInterval((function(){L.update(0)}),2e4),addEvent(window,"scroll",L.scrollCheck),addEvent(window,"resize",L.scrollCheck)},mentionClick:function(e,t){var o=e,r=((e.getAttribute("mention")||"").match(/^bp(-?\d+_\d+)$/)||{})[1];if(!r)return nav.go(e,t);for(r=r.split("_");e;e=e.parentNode){var i=(e.id||"").match(/^replies(-?\d+_topic\d+)$/);if(i){if(i[1].split("_")[0]==r[0])return Wall.showReply(o,i[1],r[0]+"topic_"+r[1],t);break}}return nav.go(e,t)},toggleCustomFeedTab:function(e,t){return(0,i.hasClass)(e,"feed_tab_link_hidden")?(removeClass(e,"feed_tab_link_hidden"),setCookie("remixcustom_feed_added",t)):(0,a.lockButton)(e),L.checkTabsFilter(geByClass1("_feed_custom_"+t),t)},recomPreload:function(){cur.recomPreload||(cur.recomPreload=!0,ajax.post("/al_feed.php",{act:"recom",section:cur.section},{cache:1}))},recomMore:function(e){if(!1===checkEvent(e)){var t=ge("feed_recom_rows"),o=ge("feed_recom_more");if(t.childNodes.length>2){for(;t.childNodes.length>2;)t.removeChild(t.lastChild);return scrollToY(0,0),hide(o.firstChild.nextSibling),(0,i.show)(o.firstChild),cancelEvent(e)}return ajax.post("/al_feed.php",{act:"recom",section:cur.section},{cache:1,onDone:function(e){hide(o.firstChild),(0,i.show)(o.firstChild.nextSibling);for(var t,r=(0,i.ce)("div",{innerHTML:e}),s=ge("feed_recom_rows");t=r.firstChild;)ge(t.id)?(0,i.re)(t):s.appendChild(t);s.childNodes.length%2&&(0,i.re)(s.lastChild)},showProgress:function(){hide(o.firstChild),(0,i.show)(o.lastChild)},hideProgress:function(){(0,i.show)(o.firstChild),hide(o.lastChild)}}),cancelEvent(e)}},recomSubscribe:function(e,t,o){var r,s,n=o?t:domPS(t),c=o?(0,i.domNS)(t):t;o?(r="/al_feed.php",s={act:"subscr",oid:e,from:nav.objLoc.section,hash:val("feed_recom_hash")}):(r="/al_fans.php",s={act:"unsub",oid:e,hash:val("feed_recom_hash"),no_response:1}),ajax.post(r,s,{onDone:function(){toggle(n,!o),toggle(c,!!o),"recommended"!=nav.objLoc.section&&nav.go(nav.objLoc,!1,{params:{norecom:1}})},showProgress:a.lockButton.pbind(t),hideProgress:a.unlockButton.pbind(t)})},clickBlogReminder:function(e,t,o,r,i,s){if(ajax.post("blog.php",{act:"click_reminder",hash:r,nid:t,accept:1,target:s},{onDone:function(){}}),"_blank"!==attr(e,"target"))return cancelEvent(i),nav.go(o)},hideBlogReminder:function(e,t,o,r){o&&cancelEvent(o),(0,i.re)("feed_blog_reminder"),ajax.post("blog.php",{act:"hide_reminder",hash:e,nid:t,accept:0,target:r},{onDone:function(){}})},preloadVideos:function(e){function t(e){var t=new XMLHttpRequest;t.open("GET",e),t.send()}e&&cur.videoAutoplayScrollHandler&&(cur.videoAutoplayPreloaded=cur.videoAutoplayPreloaded||{},each(e,(function(e,o){t(o.index_url),t(o.index_url.replace(/index-(.+).m3u8/,"seg-1-$1.ts")),cur.videoAutoplayPreloaded[o.video]=o.quality})))},expandJoinedGroups:function(e,t){return cancelEvent(t),(0,i.show)(geByClass1("feed_groups_hidden_list",e.parentNode)),(0,i.re)(e),!1},showAllFilters:function(e){(0,i.re)(e);for(var t=geByClass("hide",e.parentNode),o=0;o<t.length;o++)removeClass(t[o],"hide")},toggleSubscription:function(e,t,o,r,s){var n=domClosest("_ui_menu_wrap",e);n&&uiActionsMenu.toggle(n,!(0,i.hasClass)(n,"shown")),Page.toggleSubscription(e,t,o,r,s,(function(e,t){geByClass("post",cur.rowsCont).forEach((function(o){var i=o.id.split("_"),s=+i[i.length-2].replace("post","");if(r===s){var n=geByClass1("page_action_subscribe",o);val(n,e),domData(n,"act",t)}}))}))},logBlockInteraction:function(e,t,o){var r=indexOf((0,i.domPN)(e).children,e);(0,u.statlogsValueEvent)("block_interaction",r,t,o)},showHotTooltip:function(e){var t=geByClass1("hot");t&&(cur.hotFeatureTT=new ElementTooltip(t,{content:'<div class="feature_tooltip__close" onclick="cur.hotFeatureTT.hide();"></div>'+getLang("wall_hot_feature_text"),forceSide:"left",cls:"feature_intro_tt feature_info_tooltip hot_feature_tooltip",autoShow:!1,noHideOnClick:!0,noAutoHideOnWindowClick:!0,appendToParent:!0,offset:[15,0],onHide:function(){ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"hot_web"})}}),cur.hotFeatureTT.show())},onPostLoaded:function(e,t){var o=geByClass1("friends_recomm_gallery",e);o&&(0,h.friendsRecommInit)(o,{checkViewItem:function(){return o.visible},onDestroy:function(){(0,i.re)(e)}}),Wall.onPostLoaded(e,t),this.initPrettyCardGallery(e),t&&!(0,i.hasClass)(e,"_post")&&this.initPhotoCarouselInPost(geByClass1("_post",e))},openPostSuggest:function(e,t,o){if(t&&null!=t.type)switch(t.type){case 1:var r=t.postData,i=t.notHideByClick,s=ge("post_field");return void((s?trim(s.innerHTML).replace("<br>",""):"")||cur.wallAddMedia&&cur.wallAddMedia.attachCount()?(0,c.showFastBox)({title:getLang("news_suggest_alert_title"),dark:1},getLang("news_suggest_alert_text"),getLang("global_yes"),(function(){curBox().hide(),n(r,i)}),getLang("global_cancel")):n(r,i));case 4:return window.open(t.link),void L.suggestionEvent(e,"open",o,t.notHideByClick)}function n(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];cur.wallAddMedia&&cur.wallAddMedia.unchooseMedia(),cur.options&&(cur.options.situational_suggest_id=e),t[0]=t[0].replace(/<br>/g,"\n");var i=cur.editing;delete cur.editing,Wall.setDraft(t),L.suggestionEvent(e,"open",o,r),cur.editing=i}},suggestionEvent:(e,t,o,r)=>(ajax.post("al_feed.php",{act:"suggestion_event",suggest_id:e,event_type:t,not_hide_by_click:intval(r)}),r||(0,i.re)(geByClass1("_post_suggest")),cancelEvent(o)),closePostSuggest(e,t,o){L.suggestionEvent(e,t,o,!1)},hideRightBlock:function(e,t,o){var r=domCA(e,".page_block");return(0,i.re)(r),ajax.post("al_feed.php",{act:"a_hide_right_block",block_type:t,app_id:e.dataset.app_id||0,hash:o}),!1},initPrettyCardGallery:function(e){if(!geByClass1("pretty-cards",e))return!1;window.PrettyCardGallery&&new PrettyCardGallery(e)},initPhotoCarouselInPost(e){if(e){var t=(0,C.initPhotoBlockInPost)(e,L.sendPhotoCarouselEvent.bind(L));(0,i.data)(e,"photo_carousel",t),window.cur.destroy.push((()=>{(0,i.removeData)(e,"photo_carousel")}))}},destroyPhotoCarouselByPost(e){var t=(0,i.data)(e,"photo_carousel");t&&t.destroy()},sendPhotoCarouselEvent(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t){var r=t.querySelector(".post_img"),i=r&&r.getAttribute("data-post-id");if(i){var s,n,a=i.match(/(-?\d+)_p(\d+)/);if(a&&a[1]&&a[2]){s=a[1],n=a[2];var c=t.getAttribute("data-photo-raw-id"),l=t.getAttribute("data-pseudopost-type"),d=t.getAttribute("data-post-creation-timestamp");if(!c&&"photo_group"===l&&o){var _=o.target;if(_&&_.href){var h=_.href.match(/\/photo(-?\d+_\d+)/);c=h&&h[1]}}var p={event_type:e,content_type:l,post_owner_id:s,post_id:n,photo_raw_id:c,timestamp:d,ref:L.getModuleRef()};(0,u.statlogsValueEvent)("feed_new_carousel_stat",p)}}}},disablePhotoRecognizeBlock(e){var t=document.getElementById(`${b.BlockTypeIds.PhotoRecognize}`);t&&(cur.feedEntriesHTML[`${b.BlockTypeIds.PhotoRecognize}_ignored`]=val(t),ajax.post("al_feed.php",{act:"disable_recognize_block",hash:e},{onDone:e=>{val(t,e)}}))},enablePhotoRecognizeBlock(e){var t=document.getElementById(`${b.BlockTypeIds.PhotoRecognize}`);t&&ajax.post("al_feed.php",{act:"enable_recognize_block",hash:e},{onDone:()=>{val(t,cur.feedEntriesHTML[`${b.BlockTypeIds.PhotoRecognize}_ignored`])}})},showMarketItem(e,t,o,r){E.MarketItemsFeedBlock.showItem({itemRawId:e,element:t,statName:o,clickType:r})},showAllMarketItems(e,t,o){E.MarketItemsFeedBlock.showAll(e,t,o)},logMarketItemsBlockClick(e,t,o,r){E.MarketItemsFeedBlock.logClick({element:e,statName:t,clickType:o,itemRawId:r})}}},440290:(e,t,o)=>{o.d(t,{postsGetRaws:()=>i,isAutoplayAd:()=>s,isAdWithLongImpression:()=>n,isAdWithLongImpressionOnly:()=>a,isElemViewable:()=>l});o(21466),o(751876);var r=o(943393),i=e=>{for(var t=indexOf(domPN(e).children,e),o=domFC(e);o&&"moat"===o.id.slice(0,4);)o=domNS(o);var r,i,s,n=/^post(-?\d+_\d+)$/,a={};if(!o)return a;if("ads_feed_placeholder"===o.id)return a;a.module=cur.module,a.index=t,"feed"==cur.module&&("search"==cur.section?(a.module="feed_search",a.q=cur.q):"news"==cur.section?a.module=cur.subsection?"feed_news_"+cur.subsection:"feed_news":"recommended"==cur.section?a.module=cur.subsection?"feed_recommended_"+cur.subsection:"feed_recommended":"friends"==cur.section?a.module=cur.subsection?"feed_friends_"+cur.subsection:"feed_friends":"groups"==cur.section?a.module=cur.subsection?"feed_groups_"+cur.subsection:"feed_groups":"videos"==cur.section?a.module=cur.subsection?"feed_videos_"+cur.subsection:"feed_videos":"photos"==cur.section?a.module=cur.subsection?"feed_photos_"+cur.subsection:"feed_photos":"podcasts"==cur.section?a.module=cur.subsection?"feed_podcasts_"+cur.subsection:"feed_podcasts":"list"==cur.section?a.module=cur.subsection?"feed_list_"+cur.subsection:"feed_list":a.module="feed_other");var c=o.getAttribute("data-ad-view");c&&(a["ad_"+c]=1);var l=o.getAttribute("post_view_hash");if(l&&(a.hash=l),"block_"===o.id.substr(0,6)){a[o.id]=1,a.block=o.id.substr(6);var d=attr(o,"data-contain");d&&(d=d.split(",")).forEach((function(e){e=e.split(":"),a[e[0]]=intval(e[1])||1}));var u=attr(o,"data-contain-ids");u&&(a.contain_ids=u)}else if(i=o.id.match(n))a[i[1]]=1;else if(i=o.id.match(/^post(adsite.*)$/))a[i[1]]=1;else if(i=(r=o.className).match(/feed_reposts_wrap(-?\d+_\d+)/)){if(s=domFC(o),hasClass(domFC(s),"post_copy")&&(a[i[1]]=-1),(i=domFC(s).id.match(n))&&(a[i[1]]=1),isVisible(s=domNS(s)))for(s=domFC(s);s;s=domNS(s))(i=s.id.match(n))&&(a[i[1]]=1)}else if(i=r.match(/feed_repost(-?\d+_\d+)/))s=domFC(o),hasClass(s,"post_copy")&&(a[i[1]]=-1),(i=s.id.match(n))&&(a[i[1]]=1);else{var _=o.id;if(hasClass(o,"post_photos")){var h,p,f,g=null===(h=s=geByClass1("post_image",o,"a"))||void 0===h||null===(p=h.querySelector)||void 0===p||null===(f=p.call(h,"[data-post-id]"))||void 0===f?void 0:f.getAttribute("data-post-id");g&&(i=g.match(/^(-?\d+_p?\d+)$/))&&(_=i[1])}a[_]=1}return a},s=e=>{var t=e&&domFC(e);return t&&t.hasAttribute("data-ad-video-autoplay")},n=e=>{var t=e&&domFC(e);return t&&(t.hasAttribute("data-ad-stat-impression_long")||t.hasAttribute("data-ad-disabled-stat-impression_long"))},a=e=>{var t=e&&domFC(e);return t&&t.hasAttribute("data-ad-views-long-only")},c=(0,r.memoizeFirstTruthy)((()=>ge("page_header").offsetHeight)),l=(e,t,o,r)=>{var i=c(),s=o+i,n=o+r,a=e.offsetHeight,l=e.offsetTop+i,d=l+a;return(d>s&&l<n?(Math.min(n,d)-Math.max(s,l))/a:0)>=t}},596114:(e,t,o)=>{o.d(t,{Feed:()=>r.Feed});var r=o(384043)},719807:(e,t,o)=>{o.d(t,{longView:()=>s});var r=o(440290),i={tracking:[],viewed:{}},s={process:(e,t)=>{var o=i.tracking,s=i.viewed;if(0===o.length)return[];var n=[];return each(o,(function(o,i){var a=domFC(i),c=a.id;if(a&&c){var l=domData(a,"ad-block-uid"),d=""+c;if(l&&(d+="_"+l),!s[d]&&document.body.contains(i))if((0,r.isElemViewable)(i,.5,e,t)){var u=Date.now();i.longViewStartedAt?u-i.longViewStartedAt>=1e3&&(s[d]=!0,n.push(extend({},(0,r.postsGetRaws)(i),{long:1}))):i.longViewStartedAt=Date.now()}else i.longViewStartedAt=null}})),n},registerElement:e=>!!e&&(!!e.longViewTracking||!e.longViewRegistered&&(e.longViewRegistered=!0,e.longViewTracking=(0,r.isAutoplayAd)(e)||(0,r.isAdWithLongImpression)(e)||(0,r.isAdWithLongImpressionOnly)(e),!!e.longViewTracking&&(i.tracking.push(e),!0)))}},568948:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{evalWithLogging:()=>evalWithLogging});var _web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(519921),evalWithLogging=evalString=>{try{return eval(evalString)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(e,evalString)}}},276018:(e,t,o)=>{o.d(t,{addDelegateEvent:()=>a,removeDelegateEvent:()=>c});o(530522),o(66108),o(579665),o(95767),o(991181),o(296253),o(751876);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],r=!0,i=!1,s=void 0;try{for(var n,a=e[Symbol.iterator]();!(r=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}var s=new window.Map;function n(e){var t=s.get(e.currentTarget);if(t){var o=t[e.type];if(o)for(var i,n=0;n<o.length;n++){var a=r(o[n],2),c=a[0],l=a[1],d=void 0;if(hasClass(e.target,c)?d=l(e,e.target):(i=gpeByClass(c,e.target,e.currentTarget))&&(d=l(e,i)),!1===d)break}}}function a(e,t,o,r){var i=s.get(e);i||(s.set(e,{}),i=s.get(e));for(var a=t.split(" "),c=0;c<a.length;c++){var l=a[c];i[l]||(i[l]=[],addEvent(e,l,n)),i[l].push([o,r])}}function c(e,t,o,r){var i=s.get(e);i&&(t.split(" ").forEach((t=>{i[t]&&(i[t]=i[t].filter((e=>e[0]!==o||e[1]!==r)),0===i[t].length&&removeEvent(e,t,n))})),0===Object.keys(i).map((e=>i[e].length)).reduce(((e,t)=>e+t))&&s.delete(e))}},569359:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{searcher:()=>searcher,iSearch:()=>iSearch});var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21466),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(442699),_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(109847),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(519921),_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(414914),_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(705456),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(791563),_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(116886),_shared_lib_common__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(917999),_shared_search_cutTextToHighlight_cutTextToHighlight__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(418431),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(719016),_shared_counters_updateCounters__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(901659),sectionAuto="auto",sectionAudio="audio",sectionVideo="video",sectionStatuses="statuses",sectionPeople="people",sectionCommunities="communities",sectionMiniApps="mini_apps",sectionQuick="quick",moduleEmpty=void 0,moduleFriends="friends",moduleGroupsCatalog="groups_catalog",moduleGroupsRecommendations="groups_recommendations",paramQuery="c[q]",paramSection="c[section]",paramCategory="c[category]",paramSort="c[sort]",paramPhoto="c[photo]",paramInvite="c[invite]",paramSkipCatalog="c[skip_catalog]",paramHd="c[hd]",paramGroupsRecommendationsModel="c[need_groups_recommendations_model]",paramFrom="c[from]",paramBlockPosition="c[block_position]",searcher={init(e){var t=globalHistory.length;t&&globalHistory[t-1]&&globalHistory[t-1].loc.indexOf("search")?cur.search_return_to=globalHistory[t-1].loc:cur.search_return_to="/",hide("header");var o=ge("search_query");if(!(o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.data)(o,"opts")||{}).isNew){var r=window.iSearch;r.destroy(),vk.id&&r.init(o,e)}elfocus(o),"search"===nav.objLoc[0]&&(extend(cur,{oid:e.user_id,module:"search"}),cur.nav.push(((e,t,o)=>{if(void 0!==e[0]||cur.searchLoc&&void 0!==e.act)return clearTimeout(cur.setLocTO),void(nav.strLoc!==cur.loc&&cur.loc&&hab.setLoc(cur.loc));if(cur.searchLoc){var r=!1;for(var i in o)if("c["===i.substr(0,2)){r=!0;break}if(cur.onLocationChange&&cur.onLocationChange(r),!r)return!0}var s=clone(o);delete s[0];var n=s[paramSection]||s.section||sectionQuick;return ge("search_menu")&&uiRightMenu&&uiRightMenu.switchMenu(geByClass1(`search_menu_${n}`,"search_menu")),searcher.setSection(n),searcher.sendSearchReq(s,!0),!1}))),cur.options||(cur.options={reply_names:{}}),extend(cur.options,e),searcher.applyOptions(e),o.ignoreFixed=cur.section==sectionStatuses,window.scrollTop=bodyNode.scrollTop=pageNode.scrollTop=htmlNode.scrollTop=0,addEvent(window,"scroll",searcher.scrollCheck),addEvent(window,"resize",searcher.onResize),setTimeout(searcher.scrollCheck,50),setTimeout(checkPageBlocks,200);var i=window.audioPlayer;i&&i.showCurrentTrack&&i.showCurrentTrack(),cur._back={text:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__.getLang)("search_back_to"),show:[()=>{hide("header");var t=globalHistory.length;t&&globalHistory[t-1]&&globalHistory[t-1].loc.indexOf("search")&&(cur.search_return_to=globalHistory[t-1].loc),addEvent(window,"scroll",searcher.scrollCheck),addEvent(window,"resize",searcher.onResize);var o=window.iSearch;o.destroy(),vk.id&&o.init(ge("search_query"),e)}],hide:[()=>{removeEvent(window,"scroll",searcher.scrollCheck),removeEvent(window,"resize",searcher.onResize),window.iSearch.destroy()}]},cur.module===moduleGroupsCatalog&&(0,_shared_search_cutTextToHighlight_cutTextToHighlight__WEBPACK_IMPORTED_MODULE_11__.cutTextToHighlight)(".labeled__searchServicesDesc"),this.logSearch(cur.params,e)},sendSearchReq(e,t){if(cur.searchReq)try{cur.searchReq.abort()}catch(e){debugLog(e)}t&&!e.offset&&(vk.no_ads=inArray(e[paramSection],[sectionAudio]),extend(e,{uf:1})),void 0!==cur.useRec&&(e.rec=cur.useRec,delete cur.useRec),e.edit=nav.objLoc.edit,e.sign=nav.objLoc.sign,e.all=nav.objLoc.all,e.change=1,cur.searchLoc&&(e.search_loc=cur.searchLoc),void 0!==cur.topType&&(e.type=cur.topType,delete cur.topType);var o=window.iSearch;o&&o.select&&(o.select.hide(),delete cur.setISearch),cur.loadingMedia||(uiSearch.showProgress("search_query"),ge("search_query").ignoreFixed=e[paramSection]==sectionStatuses),nav.objLoc.from&&(e.from=nav.objLoc.from);var r=this.removeLogClickHandlers,i=this.logSearch;e.act="search_request",e.module=cur.module;var s=+new Date;cur.searchReq=ajax.post("al_search.php",e,{onDone(o,n,a){hide(document.querySelector(".search_seo_info"));var c=e.uf&&ge("results_wrap")?ge("results_wrap"):ge("results"),l=ge("friends_filters_block")?ge("friends_filters_block"):ge("filter_form");if(c.innerHTML=n||"",t&&(l&&(l.innerHTML=a||""),elfocus("search_query")),o.loc){var d=`${locProtocol}//${location.host}/${o.loc}`,u=document.URL===d?"":document.URL;setTimeout(_shared_counters_updateCounters__WEBPACK_IMPORTED_MODULE_10__.updateCounters.pbind(d,u),10)}searcher.applyOptions(o,t),uiSearch.hideProgress("search_query"),show("search_clear_params");var _=window.audioPlayer;_&&_.showCurrentTrack&&_.showCurrentTrack(),cur.onSearchFinish&&cur.onSearchFinish(),shortCurrency(),setTimeout(checkPageBlocks,200),cur.onSearchDone&&cur.onSearchDone(),r();var h=+new Date-s;o.query_duration=o.query_duration||h,i(e,o)},onFail:()=>(uiSearch.hideProgress("search_query"),!0),showProgress(){addClass(ge(`filter_${cur.section}`),"loading"),cur.isSearchLoading=!0},hideProgress(){removeClass(ge(`filter_${cur.section}`),"loading"),cur.isSearchLoading=!1,cur.loadingMedia=!1},ads:!(!t||e.offset)})},showMore(){var e=ge("ui_search_load_more"),t=ge("search_more_results");if(e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e)&&!cur.isSearchLoading)if(t&&searcher.appendElements(t),cur.has_more){cur.disableAutoMore=!1,cur.isSearchLoading=!0,(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.lockButton)(e);var o=searcher.getSectionParams();o.offset=cur.offset,o.real_offset=cur.real_offset,o.query_id=cur.query_id,o.edit=nav.objLoc.edit,o.sign=nav.objLoc.sign,o.all=nav.objLoc.all,o.act="show_more",o.module=cur.module,cur.section===sectionCommunities&&(o.random_seed=cur.random_seed,o.force_group_id=cur.force_group_id),ajax.post("al_search.php",o,{onDone(t,o){cur.isSearchLoading=!1,o&&(ge("no_results")&&re("no_results"),ge("results").insertBefore(ce("div",{innerHTML:o,id:"search_more_results"}),e),cur.module===moduleGroupsCatalog&&(0,_shared_search_cutTextToHighlight_cutTextToHighlight__WEBPACK_IMPORTED_MODULE_11__.cutTextToHighlight)(".labeled__searchServicesDesc")),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.unlockButton)(e),searcher.applyOptions(t),searcher.scrollCheck()},cache:o[paramSection]!==sectionAudio||o[paramQuery]?1:0})}else hide(e);else t&&searcher.appendElements(t)},switchSection(e,t,o){if(o&&checkEvent(o))return!0;this.removeLogClickHandlers(),t=t||{},e!==sectionCommunities&&e!==sectionMiniApps||(val(paramCategory,0),cur.filtersShown=!1);var r=searcher.getSectionParams(e);if(e!==sectionAuto&&e!==sectionQuick&&t.updateStats&&(r.swt=1),t.tab&&(r.tab=1),ge("search_menu")&&uiRightMenu){var i=geByClass1(`search_menu_${e}`,"search_menu");i&&uiRightMenu.switchMenu(i)}return searcher.setSection(e),searcher.sendSearchReq(r,!0),hasClass(gpeByClass("ui_search","search_query"),"ui_search_fixed")&&scrollToTop(),!1},removeLogClickHandlers(){(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchAuto),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchPeople),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchStatuses),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchCommunities),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchAudio),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchVideo),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceFriendsFind),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.removeSearchPositionTracker)(_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceGroupsCatalog)},logSearch(e,t){var o=e[paramQuery];if(o&&0!==(o=o.trim()).length){var r,i=cur.section,s=cur.module,n=cur.query_id,a=t.event_bits,c=t.query_duration,l=t.model_name,d=!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(ge("no_results"));switch(i){case sectionAuto:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchAuto;break;case sectionAudio:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchAudio;break;case sectionVideo:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchVideo;break;case sectionStatuses:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchStatuses;break;case sectionPeople:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchPeople;break;case sectionCommunities:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceSearchCommunities;break;case sectionQuick:default:return}switch(s){case moduleFriends:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceFriendsFind;break;case moduleGroupsCatalog:r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceGroupsCatalog}s===moduleEmpty&&i===sectionPeople&&(r=_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.serviceFriendsFind),(0,_web_lib_stats__WEBPACK_IMPORTED_MODULE_2__.saveSearchAttemptStats)(r,0,d,o,n,a,c,l)}},getSectionParams(e){var t=ge("filter_form"),o={};for(var r in(o=!t||e&&e!==cur.section||cur.section===sectionQuick?{[paramSection]:e||cur.section}:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_1__.serializeForm)(t)||{})[paramQuery]=val("search_query"),o)o.hasOwnProperty(r)&&(o[r]&&"0"!=o[r]||delete o[r],"-1"==o[r]&&o[`${r}_custom`]?(o[r]=o[`${r}_custom`],delete o[`${r}_custom`]):o[`${r}_custom`]&&delete o[`${r}_custom`]);return cur.section!==sectionVideo||o[paramSort]||(o[paramSort]="0"),cur.section===sectionPeople&&ge("photo")&&!o[paramPhoto]&&(o[paramPhoto]="0"),cur.section===sectionPeople&&o[paramInvite]&&delete o.from,cur.section!==sectionCommunities||!cur.filtersShown||o[paramQuery]||o[paramCategory]||(o[paramSkipCatalog]="1",cur.module===moduleGroupsRecommendations&&(o[paramGroupsRecommendationsModel]="1",o[paramFrom]=cur.from,o[paramBlockPosition]=cur.block_position)),o},sameParams(e){if(!cur.params)return!1;for(var t in e)if(e.hasOwnProperty(t)&&e[t]!=cur.params[t])return!1;for(var o in cur.params)if(cur.params.hasOwnProperty(o)&&e[o]!=cur.params[o])return!1;return!0},switchAudioTop(e){return cur.useRec=e,cur.audioTop=e,this.switchSection(sectionAudio)},showMedia:(e,t,o)=>(!o||!checkEvent(o))&&(hide(geByClass1("label",t)),show(geByClass1("progress",t)),cur.loadingMedia=!0,searcher.switchSection(e,{updateStats:!0},o)),updResults(){if(cur.customSearchChange)return cur.customSearchChange(),!1;var e=searcher.getSectionParams();if(searcher.sameParams(e)||e[paramSection]===sectionVideo&&!e[paramQuery]&&!nav.objLoc[paramQuery])return!1;cur.onSearchChange&&cur.onSearchChange(e);var t=(cur.section===sectionAuto||cur.section===sectionAudio&&e[paramQuery]&&!ge("audio_lyrics_filter")||cur.section===sectionAudio&&!e[paramQuery]&&ge("audio_lyrics_filter"))&&!e.offset;searcher.sendSearchReq(e,t),hasClass(gpeByClass("ui_search","search_query"),"ui_search_fixed")&&scrollToTop()},onInputChange(e){clearTimeout(cur.requestTimeout),!e||"keydown"===e.type&&13!==e.keyCode?cur.requestTimeout=setTimeout((()=>{searcher.updResults()}),1e3):searcher.updResults()},onKey(){cur.section===sectionQuick&&(clearTimeout(cur.requestTimeout),cur.requestTimeout=setTimeout((()=>{searcher.updResults()}),300))},onEnter(e,t){var o=window.iSearch;o&&o.select&&o.select.isVisible()&&o.select.active>-1||(clearTimeout(cur.requestTimeout),searcher.updResults(),searcher.highlightHotHashtag(t))},checkbox(e,t,o,r){checkbox(e);var i=isChecked(e)?1:0;o&&(i=1-i),val(t,i),r||searcher.updResults()},setSection(e){e!==cur.section&&e!==sectionAuto&&e&&(cur.section=e)},applyOptions(options,changeSection){var iSearch=window.iSearch;iSearch.initSelect(),searcher.setSection(options.section),options.reply_names&&(extend(cur.options.reply_names,options.reply_names),delete options.reply_names),extend(cur,options),cur.params=searcher.getSectionParams();var header=ge("search_header");if(options.tabs)val("search_tabs_wrap",options.tabs),hide(header),show("search_tabs_wrap");else if(options.title){var headerInner=geByClass1("_header_inner",header);val(headerInner,options.title),options.summary&&headerInner.appendChild(ce("span",{className:"page_block_header_count",innerHTML:langNumeric(options.summary,"%s",!0)})),hide("search_tabs_wrap"),show(header)}if(null!=options.controls&&val(geByClass1("_header_extra",header),options.controls||""),void 0!==options.auto_rows&&ge("search_auto_rows")&&(ge("search_auto_rows").innerHTML=options.auto_rows||""),clearTimeout(cur.setLocTO),options.loc)if(changeSection)try{nav.setLoc(options.loc)}catch(e){debugLog(e)}else cur.setLocTO=setTimeout((()=>{if("search"===nav.objLoc[0]||nav.objLoc[0]===sectionCommunities||"brands"===nav.objLoc[0]||nav.objLoc[0].match(/^people($|\/)/)||cur.searchLoc)try{nav.setLoc(options.loc)}catch(e){debugLog(e)}}),100);if(options.htitle&&setDocumentTitle(replaceEntities(stripHTML(options.htitle))),void 0!==options.q){val("search_query",replaceEntities(stripHTML(options.q))||"");var resetEl=ge("search_clear_params");resetEl&&show(resetEl)}if(cur.uiSort&&void 0!==options.sortHide&&(options.sortHide&&cur.uiSort.selectItem(0,!1),cur.uiSort.disable(options.sortHide)),cur.section===sectionAuto&&show(geByClass1("search_menu_auto","search_menu")),options.script)try{eval(options.script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_3__.logEvalError)(e,options.script)}var res=ge("results"),sc=ge("search_content"),lighted=hasClass(sc,"highlight");res.className=`search_results search_${cur.section}_results${cur.section===sectionStatuses||cur.section===sectionAuto?" wall_module":""}${cur.section===sectionStatuses&&""!==options.summary||gpeByClass("page_block",res)?"":" page_block"} mark_top_verified`,cur.section===sectionAudio&&(res.className+=" audio_w_covers"),lighted&&addClass(sc,"highlight");var moreResults=ge("search_more_results");cur.has_more||moreResults&&moreResults.firstChild?(hide("seach_pages"),show("ui_search_load_more")):hide("ui_search_load_more")},selectHotHashtag(e){var t=val(e),o=ge("search_query"),r=((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.data)(o,"opts")||{}).onEnter;return val(o,t),r&&r(o,t),statlogsValueEvent("top_hashtag_search",0,"click"),!1},highlightHotHashtag(e){e=e?e.toLowerCase():"";var t=!1,o=geByClass("search_hot_hashtags_item","search_hot_hashtags");return each(o,((o,r)=>{val(r).toLowerCase()===e?(t=!0,addClass(r,"search_hot_hashtags_item_active")):removeClass(r,"search_hot_hashtags_item_active")})),t},toggleFilter(e,t,o){hasClass(e,"search_filter_shut")||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(t)?(addClass(e,"search_filter_open"),removeClass(e,"search_filter_shut"),slideDown(t,200,(()=>{checkPageBlocks(),o&&o()}))):slideUp(t,200,(()=>{addClass(e,"search_filter_shut"),removeClass(e,"search_filter_open"),o&&o()}))},appendElements(e){if(e){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);re(e)}},close:()=>nav.go(cur.search_return_to,{},{back:!0}),toggleMinimizedFilters(e,t,o){var r=e&&domNS(e),i=o?0:200;return void 0===t&&(t=!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(r)),!t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(r)?(cur.filtersShown=!1,removeClass(e,"ui_rmenu_item_expanded"),slideUp(r,i)):t&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(r)&&(cur.filtersShown=!0,val(paramCategory,0),addClass(e,"ui_rmenu_item_expanded"),slideDown(r,i)),!1},onCommunitiesToggle(){"search"==cur.module&&(uiRightMenu.switchMenu(geByClass1(`search_menu_${cur.section}`,"search_menu")),searcher.updResults())},subscribe(e,t,o,r,i,s,n){var a,c,l=gpeByClass("search_row",e);if(cur.unsubscribed=cur.unsubscribed||{},!r&&s&&!cur.unsubscribed[t]){var d=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_6__.showFastBox)({title:(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__.getLang)("global_warning"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__.getLang)(s),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__.getLang)("search_group_leave"),(()=>{d.hide(),searcher.subscribe(e,t,o,r,i)}),(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__.getLang)("global_cancel"));return!1}r?(a="al_feed.php",c={act:"subscr",oid:t,hash:o,from:i||"search",ref:cur.module},domData(e,"trackcode")&&(c.trackcode=domData(e,"trackcode"))):(a="al_fans.php",c={act:"unsub",oid:t,hash:o,from:"search",ref:cur.module});ajax.post(a,c,{onDone(){n?toggleClass(l,"touched",!!r):(toggle(`search_sub${t}`,!r),toggle(`search_unsub${t}`,!!r)),r||(cur.unsubscribed[t]=1)},onFail(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_6__.showFastBox)((0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_7__.getLang)("global_error"),e).hide,2e3),!0},showProgress(){n?(e.tt&&e.tt.destroy(),addClass(l,"loading")):(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.lockButton)(e)},hideProgress(){n?removeClass(l,"loading"):(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.unlockButton)(e)}})},onResize(){searcher.scrollCheck()},scrollCheck(){if(!(browser.mobile||cur.isSearchLoading||cur.disableAutoMore)){var e=ge("ui_search_load_more");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e)){var t=document.documentElement,o=window.innerHeight||t.clientHeight||bodyNode.clientHeight;scrollGetY()+o+200>e.offsetTop&&searcher.showMore()}else{var r=ge("search_more_results");r&&searcher.appendElements(r)}}},switchFilter(e,t,o){if(checkEvent(o))return!1;ge(`c[${e}]`)&&(ge(`c[${e}]`).value=t),cur.section===sectionVideo&&"quality"===e&&ge(paramHd)&&(ge(paramHd).value=t<0?0:1),searcher.updResults()},showMiniAppTooltip(e){var t=e.dataset.appId,o=e.tt&&e.tt.container?e.tt.container:null;o&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(o)&&(o.classList.remove("tt_left"),o.classList.remove("tt_right"),o.classList.remove("GlobalAppsCardTooltipWrapper--up"));var r,i="left",s=-100,n="",a=document.documentElement.clientWidth,c=document.documentElement.clientHeight,l=e.getBoundingClientRect();l.left>a-520?(i="right",r=365):r=-l.width-10,l.top>c-400&&(s=-50,n="GlobalAppsCardTooltipWrapper--up",o&&o.classList.add(n)),(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_9__.showTooltip)(e,{url:"al_apps.php",params:{act:"mini_app_card_tooltip",app_id:t},className:`GlobalAppsCardTooltipWrapper ${n}`,shift:[r,s],hasover:!0,ajaxdt:200,showdt:300,hidedt:300,center:!1,dir:i})},openMiniApp(e,t,o){o&&showWiki({w:`app${e}`,app_ref:t})}},iSearch={init(e,t){if(!this.inited){var o=this;this.inited=!0,this.input=e,this.cont=e.parentNode.parentNode;var r=ce("div",{className:"results_container",innerHTML:'<div class="result_list"></div>'});this.cont.appendChild(r),this.resultList=geByClass("result_list",r)[0],hide(this.resultList),browser.chrome&&(this.resultList.style.opacity=1),this.resultList.style.width=r.style.width="552px",this.onShowCallback=!!t&&t.onShow,this.initSelect(t),addEvent(e,"keyup click mouseup",o.inputUpHandler),addEvent(document,"click",o.documentClick),addEvent(e,"keypress keydown",o.inputDownHandler),ge("top_search")&&(ge("top_search").onclick=e=>hab.getLoc().indexOf("search")?nav.go("search",e,{search:!0}):(window.searcher&&searcher.close(),!1))}},inputUpHandler(e){var t=window.iSearch;if(t.select){if((t.select.isVisible()&&t.select.active>-1||cur.preventISRequest)&&(delete cur.preventISRequest,inArray(e.keyCode,[KEY.UP,KEY.DOWN,KEY.PAGEUP,KEY.PAGEDOWN,KEY.RETURN])))return cancelEvent(e);clearTimeout(cur.requestTimeout);var o=val(t.input);t.currentTerm=o;var r=cur.section;o?cur.requestTimeout=setTimeout((()=>{cur.setISearch=!0,ajax.post("/hints.php?act=a_gsearch_hints",{q:o,section:r},{onDone(e){t.currentTerm===o&&cur.setISearch&&t.showSelectList(o,e),delete cur.setISearch},cache:1})}),300):t.select.hide()}},documentClick(){var e=window.iSearch;e.select&&e.select.hide()},inputDownHandler(e){var t=window.iSearch;if(t.select){if(!t.select||t.select.active<0)return e.keyCode===KEY.RETURN&&t.select&&(cur.preventISRequest=!0,t.select.hide()),!0;if(e.keyCode===KEY.SPACE||(e.keyCode===KEY.RETURN||10===e.keyCode)&&t.select&&t.select.isVisible()){var o,r=t.select.list.childNodes[t.select.active],i=r?r.getAttribute("val"):"";if(each(t.lastItems,(function(){this[0]===i&&(o=this)})),!o)return;return val(t.input,o[3]+(e.keyCode===KEY.SPACE?" ":"")),elfocus(t.input,t.input.length),e.keyCode!==KEY.SPACE&&(cur.preventISRequest=!0,t.select.hide(),searcher.updResults()),cancelEvent(e)}return e.keyCode!==KEY.RETURN&&10!==e.keyCode||!t.select||!t.select.isVisible()||(triggerEvent(document,e.type,e),cancelEvent(e))}},initSelect(){var e=window._iu,t=window.Select;if(!this.select&&t&&e&&this.resultList){this.guid=e.reg(this);var o=this;this.select=new t(this.resultList,{selectFirst:!1,onItemSelect:this.onItemSelect.bind(this),onShow:()=>((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_8__.isFunction)(o.onShowCallback)&&o.onShowCallback(),e.sel(o.guid)),onHide:e.sel.pbind(!1),cycle:!0}),this.select.hide()}},showSelectList(e,t){this.select&&((t=isArray(t)&&t.length?t:[]).length?(this.select.clear(),this.lastItems=t,this.select.content(t),this.select.show(),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_8__.isFunction)(this.onShowCallback)&&this.onShowCallback()):this.select.hide())},onItemSelect(e){var t;if(this.select&&(this.select.hide(),each(this.lastItems,(function(){this[0]===e&&(t=this)})),t)){var o=ce("div",{innerHTML:t[3]});val(this.input,o.innerText||o.textContent),this.input.blur(),searcher.updResults()}},onEvent(e){e.type===(browser.opera||browser.mozilla?"keypress":"keydown")&&this.select.handleKeyEvent(e)},destroy(e){cleanElems(this.resultList),clearTimeout(e?e.requestTimeout:cur.requestTimeout),removeEvent(this.input,"keyup click mouseup",this.inputUpHandler),removeEvent(document,"click",this.documentClick),removeEvent(this.input,"keypress keydown",this.inputDownHandler),this.select&&(this.select.destroy(),delete this.select),this.resultList&&re(this.resultList.parentNode),delete this.lastItems,this.inited=!1},updateResultsList(e){e?e+="px":e=hasClass(ge("search_query_wrap"),"wide")?"512px":"451px",this.resultList.style.width=e}}},288183:(e,t,o)=>{o.d(t,{default:()=>i});o(991181),o(296253),o(283946),o(976142),o(59357);var r=o(705456);const i={init(e,t){e.setOptions({bodyStyle:"padding:0;",onDestroy:function(){uiSearch.destroy(n),s&&s.destroy(),e=o=s=a=n=null}});var o,i,s,n=ge("video_live_blacklist_search"),a=ge("video_live_blacklist_wrap"),c=domByClass(a,"olist"),l={};function d(e){var r=e;if((e=trim(e).replace(/\s+/g," ").toLowerCase())!==i){i=e;var s=e?o.search(e):t.list,n="";if(s.length)for(var a,d=new RegExp(e,"i"),u=0;u<s.length;u++)a=s[u],n+=getTemplate("video_live_blacklist_item",{id:a.id,href:a.href,photo:a.photo,name:e?a.name.replace(d,"<em>$&</em>"):a.name,class:l[a.id]?" olist_item_wrap_on":""});else n=getTemplate("video_live_blacklist_empty",{text:langStr(getLang("global_search_not_found"),"search","<b>"+clean(r)+"</b>")});val(c,n)}}t.list.length&&(e.removeButtons().addButton(getLang("global_save"),(function(o){ajax.post("al_video.php?act=save_live_blacklist",{exclude:Object.keys(l).join(","),hash:t.save_hash},{onDone:function(t){e.hide(),t&&showDoneBox(t)},showProgress:r.lockButton.pbind(o),hideProgress:r.unlockButton.pbind(o)})})).addButton(getLang("global_cancel"),null,"no"),s=new uiScroll(a),d(""),a.onclick=function(e){var t=domClosest("olist_item_wrap",e.target);if(!t)return;cancelEvent(e);var o=domData(t,"id");toggleClass(t,"olist_item_wrap_on")?l[o]=1:delete l[o]},n&&(o=new vkIndexer(t.list,(function(e){return e.name+" https://vk.com"+e.href})),uiSearch.init(n,{onChange:d}),uiSearch.focus(n)))}}},692128:(e,t,o)=>{o.d(t,{HIDE_TOOLTIP_TIMEOUT:()=>r,SHOW_TOOLTIP_TIMEOUT:()=>i,REACTION_ID_DEFAULT:()=>s,REACTION_ID_MAX:()=>n,REACTION_ID_MIN:()=>a,REACTION_ID_UNSET:()=>c,REACTION_SET_ITEMS_MIN_COUNT:()=>l});var r=600,i=140,s=0,n=7,a=0,c=void 0,l=2},509723:(e,t,o)=>{o.d(t,{isDebugEnabled:()=>s});var r=o(651988),i=void 0,s=function(){return void 0!==i?i:i=!!r.default.get("reactions.debug_enabled")}},956146:(e,t,o)=>{o.d(t,{reactionLogError:()=>i});var r=o(611386);function i(e){var t=e.error,o=e.reportError;void 0!==o&&o&&(0,r.logError)(t,{environment:"reactions"}),console.error(t)}},754:(e,t,o)=>{o.d(t,{getDefaultReaction:()=>a,getDefaultReactionTitle:()=>c,prepareReactionMenuSet:()=>d,isReactionIdUnset:()=>u,isValidReactionId:()=>_,parseReactionId:()=>h,parseReactionIdOrUnset:()=>p,validateReactionSetPayloaditems:()=>f,parseReactionMenuConfig:()=>g,calcCounters:()=>m,calcCountersSum:()=>v,calcCountersWeightedSum:()=>w,hasReactionsForCounts:()=>b});var r=o(570655),i=o(692128),s=o(457700),n=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},a=function(e){return e.itemsById[i.REACTION_ID_DEFAULT]},c=function(e){var t;return null===(t=a(e))||void 0===t?void 0:t.title},l=function(e,t){return 0===e.length?"":(o=e,r=function(e){return Math.pow(t.width-e.width,2)+Math.pow(t.height-e.height,2)},i=!1,void 0===i&&(i=!0),o.reduce((function(e,t){var o=r(t),s=r(e);return s===o?i?e:t:s<o?e:t}))).url;var o,r,i},d=function(e,t,o){var r=o.imageMenuSize,i=o.imagePreviewSize,s=t.map((function(e){var t=e.asset,o=e.color_sets,s=e.id,n=e.score,a=e.title;return{animationURL:t.animation_url||void 0,backgroundColor:null==o?void 0:o.background,id:s,imageMenuURL:l(t.images,r),imagePreviewURL:l(t.images,i),score:n,title:a,titleColor:null==o?void 0:o.foreground}})),n={};return s.forEach((function(e){n[e.id]=e})),{id:e,items:s,itemsById:n}},u=function(e){return e===i.REACTION_ID_UNSET},_=function(e){return n(e)&&e>=i.REACTION_ID_MIN&&e<=i.REACTION_ID_MAX},h=function(e){var t=parseInt(e,10);return _(t)?{isValid:!0,value:t}:{isValid:!1}},p=function(e){var t=h(e);return t.isValid?t.value:i.REACTION_ID_UNSET},f=function(e,t){if(e.length<i.REACTION_SET_ITEMS_MIN_COUNT)return{error:new Error("Invalid reactions items count in set '"+t+"': "+e.length)}},g=function(e){if(null!==(t=e)&&"object"==typeof t){var t,o={},r=e.animationShowStaticAfterEnd,i=e.reportJsErrors,s=e.menuShowDelay;return"number"!=typeof s&&void 0!==s||(o.menuShowDelay=s),"boolean"==typeof r&&(o.animationShowStaticAfterEnd=r),"boolean"==typeof i&&(o.reportJsErrors=i),o}},m=function(e,t){var o=(0,s.reactionCountsBrandWrap)({});return Object.entries((0,s.reactionCountsBrandUnwrap)(e)).forEach((function(e){var i,s,n,a=(0,r.__read)(e,2),c=a[0],l=a[1],d=c,u=null!==(n=null===(s=null===(i=null==t?void 0:t.itemsById)||void 0===i?void 0:i[d])||void 0===s?void 0:s.score)&&void 0!==n?n:1;o[d]=u*(l||0)})),o},v=function(e){return Object.values((0,s.reactionCountsBrandUnwrap)(e)).reduce((function(e,t){return e+(t||0)}),0)},w=function(e){return v((0,s.reactionCountsBrandWrap)(e))},b=function(e){return v(e)>0}},457700:(e,t,o)=>{o.d(t,{reactionCountsBrandUnwrap:()=>r,reactionCountsBrandWrap:()=>i});var r=function(e){return e},i=function(e){return e}},452365:(e,t,o)=>{o.d(t,{updateArticleSnippetsFromQueueByPost:()=>n});var r=o(611386),i=o(917999),s=o(486353);function n(e){if(window.vk.id&&(0,s.partConfigEnabled)("update_private_snippets_by_queue")){var t=Array.from(e.querySelectorAll(".article_snippet"));if(t.length){var o=[];t.forEach((function(e){if(window.vk.id&&e.dataset.needUpdate){var t=e.dataset.articleRawId;t&&o.push({article_raw_id:t,post_raw_id:e.dataset.postId,is_mini_snippet:(0,i.intval)(e.dataset.isMiniSnippet)})}})),o.length&&window.ajax.post("al_articles.php",{act:"get_snippets",article_snippets:JSON.stringify(o)},{onDone:function(e){t.forEach((function(t){t.dataset.articleRawId&&e[t.dataset.articleRawId]&&(t.outerHTML=e[t.dataset.articleRawId])}))},onFail:function(){return(0,r.logError)(new Error("Fail: updateArticleSnippetsFromQueueByPost")),!0}})}}}},915734:(e,t,o)=>{o.d(t,{PhotoCarousel:()=>a});var r=o(570655),i=o(414914),s=o(421020),n="PhotoCarousel__arrowWrapper--hidden",a=function(){function e(e,t,o){var s=this;this.activeItemIdx=0,this.onLeftArrowClick=function(e){var t;s.isLeftBtnDisabled?e.stopPropagation():((null===(t=s.options)||void 0===t?void 0:t.onPrevClick)&&s.options.onPrevClick(e),s.prev())},this.onRightArrowClick=function(e){var t,o;s.isRightBtnDisabled?e.stopPropagation():((null===(t=s.options)||void 0===t?void 0:t.onNextClick)&&(null===(o=s.options)||void 0===o||o.onNextClick(e)),s.next())},this.post=e,this.options=o,this.items=t;var a=e.querySelector(".PhotoCarousel"),c=e.querySelector(".PhotoCarousel__arrowWrapper--left"),l=e.querySelector(".PhotoCarousel__arrowWrapper--right"),d=e.querySelector(".PhotoCarousel__items");if(!a||!d)throw new Error("PhotoCarousel: incorrect arguments");var u=(0,r.__read)((0,i.getSize)(d),1)[0],_=(0,r.__read)((0,i.getSize)(a),1)[0];this.carousel=a,this.leftArrowBtn=c,this.rightArrowBtn=l,this.isLeftBtnDisabled=!c||c.classList.contains(n),this.isRightBtnDisabled=!l||l.classList.contains(n),this.photoList=d,this.photoListWidth=u,this.carouselWidth=_,this.activeItemIdx=this.getActiveItemIdxFromDOM(),this.initListeners()}return e.prototype.destroy=function(){this.deInitListeners()},e.prototype.initListeners=function(){this.leftArrowBtn&&this.leftArrowBtn.addEventListener("click",this.onLeftArrowClick),this.rightArrowBtn&&this.rightArrowBtn.addEventListener("click",this.onRightArrowClick)},e.prototype.deInitListeners=function(){this.leftArrowBtn&&this.leftArrowBtn.removeEventListener("click",this.onLeftArrowClick),this.rightArrowBtn&&this.rightArrowBtn.removeEventListener("click",this.onRightArrowClick)},e.prototype.next=function(){this.move(this.getActiveIdx()+1)},e.prototype.prev=function(){this.move(this.getActiveIdx()-1)},e.prototype.getActive=function(){return this.items[this.activeItemIdx]},e.prototype.getActiveIdx=function(){return this.activeItemIdx},e.prototype.getActiveItemIdxFromDOM=function(){return Number(this.carousel.dataset.idx)},e.prototype.move=function(e){var t,o=this.getActiveIdx(),n=this.getActive(),a=this.items[e];if(a){var c=a.getEl();if(this.rightArrowBtn&&this.leftArrowBtn){var l=a.getPhotoRawId(),d=(0,r.__read)((0,i.getSize)(c),1)[0],u=c.offsetLeft,_=Math.round(this.photoListWidth-this.carouselWidth),h=u+d/2-this.carouselWidth/2;if(e>o)h=Math.min(h,_);else{if(!(e<o))return;h=Math.max(h,0)}h=Math.round(h),this.photoList.style.transform="translateX(-"+h+"px)";var p=(this.carouselWidth-d-12)/2,f=this.carouselWidth-d-20-6;h?(this.toggleLeftBtnDisabled(!1),this.leftArrowBtn.style.width=h===_?f+"px":p+"px"):this.toggleLeftBtnDisabled(!0),h===_?this.toggleRightBtnDisabled(!0):(this.toggleRightBtnDisabled(!1),this.rightArrowBtn.style.width=h?p+"px":f+"px"),n.setActive(!1),a.setActive(),this.activeItemIdx=e,this.items.slice(e,e+s.NUMBER_INITIALIZED_PHOTO).forEach((function(e){return e.init()})),this.carousel.setAttribute("data-idx",String(e)),this.post.setAttribute("data-photo-raw-id",String(l)),(null===(t=this.options)||void 0===t?void 0:t.onChange)&&this.options.onChange()}}},e.prototype.toggleLeftBtnDisabled=function(e){void 0===e&&(e=!0),this.leftArrowBtn&&(e?(this.leftArrowBtn.classList.add(n),this.isLeftBtnDisabled=!0):(this.leftArrowBtn.classList.remove(n),this.isLeftBtnDisabled=!1))},e.prototype.toggleRightBtnDisabled=function(e){void 0===e&&(e=!0),this.rightArrowBtn&&(e?(this.rightArrowBtn.classList.add(n),this.isRightBtnDisabled=!0):(this.rightArrowBtn.classList.remove(n),this.isRightBtnDisabled=!1))},e}()},921386:(e,t,o)=>{o.d(t,{PhotoCarouselBlock:()=>n});var r=o(915734),i=o(537998),s=o(421020),n=function(){function e(e,t){var o,i=this;this.isDestroyed=!1,this.destroy=function(){i.isDestroyed||(i.deInitListener(),i.carousel.destroy(),i.items.forEach((function(e){return e.destroy()})),i.isDestroyed=!0)},this.onPostClick=function(e){var t,o=e.target;(null===(t=i.blockOptions)||void 0===t?void 0:t.sendAnalytic)&&(o.classList.contains("post_img")||o.classList.contains("author")||o.classList.contains("mem_link")||o.classList.contains(s.PHOTO_CAROUSEL_AVATAR_CLASS)?i.blockOptions.sendAnalytic("open_user",i.post,e):o.classList.contains(s.PHOTO_ELEMENT_CLASS)||o.classList.contains(s.PHOTO_NO_SIZE_ELEMENT_CLASS)||o.classList.contains("page_post_thumb_wrap")?i.blockOptions.sendAnalytic("open_photo",i.post,e):o.classList.contains(s.PHOTO_CAROUSEL_HIDE_BTN_CLASS)&&i.blockOptions.sendAnalytic("hide",i.post,e))},this.post=e,this.blockOptions=t;var n=this.getCarouselOptions();this.items=this.createItems(e),this.carousel=new r.PhotoCarousel(e,this.items,n),this.initListeners(),null===(o=window.cur.destroy)||void 0===o||o.push(this.destroy)}return e.prototype.initListeners=function(){this.post.addEventListener("click",this.onPostClick)},e.prototype.deInitListener=function(){this.post.removeEventListener("click",this.onPostClick)},e.prototype.createItems=function(e){var t,o=this,r=Array.from(e.querySelectorAll("."+s.PHOTO_CAROUSEL_ITEM_CLASS)),n={};return(null===(t=this.blockOptions)||void 0===t?void 0:t.sendAnalytic)&&(n.sendAnalytic=function(e,t){var r,i;(null===(r=o.blockOptions)||void 0===r?void 0:r.sendAnalytic)&&(null===(i=o.blockOptions)||void 0===i||i.sendAnalytic(e,o.post,t))}),r.map((function(e){return new i.PhotoCarouselBlockItem(e,n)}))},e.prototype.getCarouselOptions=function(){var e,t=this,o=null===(e=this.blockOptions)||void 0===e?void 0:e.sendAnalytic;return{onPrevClick:function(e){o&&o("click_previous",t.post,e)},onNextClick:function(e){o&&o("click_next",t.post,e)}}},e}()},537998:(e,t,o)=>{o.d(t,{PhotoCarouselBlockItem:()=>l});var r=o(570655),i=o(432034),s=o(907851),n=o(12232),a=o(917685),c=o(469433),l=function(e){function t(t,o){var r=e.call(this,t)||this;r.onPhotoClick=function(e){var t;e.ctrlKey||e.metaKey||(r.showPhoto(e),(null===(t=r.options)||void 0===t?void 0:t.sendAnalytic)&&r.options.sendAnalytic("open_photo"))},r.onShareClick=function(e){var t;if(r.objectRawId){var o=null===(t=r.options)||void 0===t?void 0:t.sendAnalytic;o&&(o("click_to_sharing",e),window.cur.sbOnShare=function(){o("repost",e)}),n.Likes.share(r.objectRawId,r.shareOptions),(0,a.cancelEvent)(e)}},r.onCommentsClick=function(e){var t,o=r.photoViewOptions||{};o.commentFocusInit=!0,r.showPhoto(e,o);var i=null===(t=r.options)||void 0===t?void 0:t.sendAnalytic;i&&i("click_to_comment",e)},r.onLikeClick=function(e){var t;if(r.likeBtn&&r.objectRawId&&r.likeHash){var o=r.isLiked()?"unlike":"like",i=null===(t=r.options)||void 0===t?void 0:t.sendAnalytic;i&&i(o,e),n.Likes.toggle(r.likeBtn,e,r.objectRawId,r.likeHash)}},r.isLiked=function(){return r.likeBtn&&r.likeBtn.classList.contains("active")},r.options=o,r.shareBtn=t.querySelector("._share"),r.commentsBtn=t.querySelector("._comment"),r.likeBtn=t.querySelector("._like"),r.objectRawId=t.dataset.objectRawId,r.likeHash=t.dataset.likeHash;var i=t.dataset.shareOptions||"";return r.shareOptions=i&&(0,s.parseJSON)(i),r.initListeners(),r}return(0,r.__extends)(t,e),t.prototype.destroy=function(){this.deInitListeners()},t.prototype.initListeners=function(){this.shareBtn&&this.shareBtn.addEventListener("click",this.onShareClick),this.commentsBtn&&this.commentsBtn.addEventListener("click",this.onCommentsClick),this.likeBtn&&this.likeBtn.addEventListener("click",this.onLikeClick),this.photo.addEventListener("click",this.onPhotoClick)},t.prototype.deInitListeners=function(){this.shareBtn&&this.shareBtn.removeEventListener("click",this.onShareClick),this.commentsBtn&&this.commentsBtn.removeEventListener("click",this.onCommentsClick),this.likeBtn&&this.likeBtn.removeEventListener("click",this.onLikeClick),this.photo.removeEventListener("click",this.onPhotoClick)},t.prototype.showPhoto=function(e,t){void 0===t&&(t=this.photoViewOptions),(0,c.showPhoto)(this.photoRawId,this.photoContext,t,e),(0,a.cancelEvent)(e)},t}(i.PhotoCarouselItem)},432034:(e,t,o)=>{o.d(t,{PhotoCarouselItem:()=>n});var r=o(570655),i=o(421020),s=o(920453),n=function(){function e(e){this.item=e;var t=e.querySelector("."+i.PHOTO_ELEMENT_CLASS),o=e.dataset.photoViewOptions||"",n=e.dataset.photoContext,a=e.dataset.photoRawId,c=o&&(0,s.parseJSON)(o);if(!(c&&a&&n&&t))throw new Error("PhotoCarouselBlockItem: incorrect arguments");var l=(0,r.__read)(a.split("_"),2),d=l[0],u=l[1];this.ownerId=Number(d),this.photoId=Number(u),this.photoRawId=a,this.photoContext=n,this.photoViewOptions=c,this.photo=t,this.isActive=e.classList.contains("PhotoCarouselItem--active")}return e.prototype.setActive=function(e){void 0===e&&(e=!0),this.isActive=e,this.item.classList.toggle("PhotoCarouselItem--active",e)},e.prototype.init=function(){var e=this.item.getAttribute("data-photo-url");if(e){if(this.item.classList.contains(i.PHOTO_CAROUSEL_ITEM_NO_SIZE_CLASS)){var t=this.item.querySelector("."+i.PHOTO_NO_SIZE_ELEMENT_CLASS);t&&(t.src=e)}else{var o=this.item.querySelector("."+i.PHOTO_ELEMENT_CLASS);if(!o)return;o.style.backgroundImage="url('"+e+"')"}this.item.removeAttribute("data-photo-url")}},e.prototype.getPhotoRawId=function(){return this.photoRawId},e.prototype.getOwnerId=function(){return this.ownerId},e.prototype.getEl=function(){return this.item},e}()},913997:(e,t,o)=>{o.d(t,{PhotoRecognizeBlock:()=>h});var r=o(421020),i=o(623643),s=o(915734),n=o(621260),a=o(414914),c=o(907851),l=o(775478),d=o(116886),u=o(917685),_=o(63988),h=function(){function e(e){var t,o=this;this.isDestroyed=!1,this.countConfirmedTags=0,this.destroy=function(){o.isDestroyed||(o.nextPhotoTimerId&&(clearTimeout(o.nextPhotoTimerId),o.nextPhotoTimerId=null),o.deInitListeners(),o.carousel.destroy(),o.items.forEach((function(e){return e.destroy()})),o.isDestroyed=!0)},this.handleOutsideConfirmationTags=function(e){var t=e.detail.photoRawId,r=e.detail.tagIds;o.items.filter((function(e){return e.getPhotoRawId()===t})).forEach((function(e){return e.setConfirmedTagsByIds(r)}))},this.handleOutsideDeclinationTags=function(e){var t=e.detail.photoRawId,r=e.detail.tagIds;o.items.filter((function(e){return e.getPhotoRawId()===t})).forEach((function(e){return e.setDeclinedTagsByIds(r)}))},this.handleOutsideDeletingTags=function(e){var t=e.detail.photoRawId,r=e.detail.tagIds;o.items.filter((function(e){return e.getPhotoRawId()===t})).forEach((function(e){return e.setDeletedTagsByIds(r)}))},this.next=function(){o.nextPhotoTimerId&&(clearTimeout(o.nextPhotoTimerId),o.nextPhotoTimerId=null),o.carousel.getActiveIdx()!==o.items.length-1?o.carousel.next():o.countConfirmedTags?o.showEndCard():(o.removeBlock(),o.showThanksNotification())},this.removeBlock=function(){o.destroy(),o.post.remove()},this.onPhotoChangeClick=function(){o.nextPhotoTimerId&&(clearTimeout(o.nextPhotoTimerId),o.nextPhotoTimerId=null),o.skipActiveItemTags()},this.updateBlockTitle=function(){if(o.titleEl){var e=o.carousel.getActive().getTitle();e&&(o.titleEl.innerHTML=e)}},this.hideHelpHintClick=function(e){o.hintHelpId&&o.hintHelpHash&&((0,u.cancelEvent)(e),window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:o.hintHelpId,hash:o.hintHelpHash},{onDone:function(){var e;null===(e=o.hintHelpPanel)||void 0===e||e.remove()},onFail:function(){return console.error("something wrong with help hint"),!0}}))},this.post=e,this.titleEl=e.querySelector(".PhotoRecognizeBlock__title");var r=e.querySelector(".PhotoRecognizeBlock__inner");if(!r)throw new Error("PhotoRecognizeBlock: there is not inner");this.trackCode=e.dataset.trackCode,this.hintHelpId=e.dataset.hintHelpId,this.hintHelpHash=e.dataset.hintHelpHash,this.innerWrapperEl=r,this.items=this.createItems(e),this.carousel=new s.PhotoCarousel(e,this.items,{onPrevClick:this.onPhotoChangeClick,onNextClick:this.onPhotoChangeClick,onChange:this.updateBlockTitle}),this.hintHelpPanel=e.querySelector(".PhotoRecognizeBlockHint"),this.helpHintPanelHideBtn=e.querySelector(".PhotoRecognizeBlockHint__hide"),this.initListeners(),this.initFirstItems(),null===(t=window.cur.destroy)||void 0===t||t.push(this.destroy),window.cur.pvOneSuggestHintId=e.dataset.hintAlertId,window.cur.pvOneSuggestHintHash=e.dataset.hintAlertHash,null==window.cur.pvNeedShowAlertForOneSuggest&&(window.cur.pvNeedShowAlertForOneSuggest=Boolean(Number(e.dataset.needShowAlert)))}return e.prototype.initListeners=function(){var e;document.addEventListener(l.TagEventTypes.CONFIRM_SUGGESTED_TAGS,this.handleOutsideConfirmationTags),document.addEventListener(l.TagEventTypes.DECLINE_SUGGESTED_TAGS,this.handleOutsideDeclinationTags),document.addEventListener(l.TagEventTypes.DELETE_TAG,this.handleOutsideDeletingTags),null===(e=this.helpHintPanelHideBtn)||void 0===e||e.addEventListener("click",this.hideHelpHintClick)},e.prototype.deInitListeners=function(){var e,t;null===(e=this.closeEl)||void 0===e||e.removeEventListener("click",this.removeBlock),null===(t=this.helpHintPanelHideBtn)||void 0===t||t.removeEventListener("click",this.hideHelpHintClick),document.removeEventListener(l.TagEventTypes.CONFIRM_SUGGESTED_TAGS,this.handleOutsideConfirmationTags),document.removeEventListener(l.TagEventTypes.DECLINE_SUGGESTED_TAGS,this.handleOutsideDeclinationTags),document.removeEventListener(l.TagEventTypes.DELETE_TAG,this.handleOutsideDeletingTags)},e.prototype.initFirstItems=function(){this.items.slice(0,r.NUMBER_INITIALIZED_PHOTO).forEach((function(e){return e.init()}))},e.prototype.createItems=function(e){var t=this;return Array.from(e.querySelectorAll("."+r.PHOTO_CAROUSEL_ITEM_CLASS)).map((function(e){return new i.PhotoRecognizeBlockItem(e,t)}))},e.prototype.nextWithDelay=function(){var e=this;this.nextPhotoTimerId||(this.nextPhotoTimerId=setTimeout((function(){e.nextPhotoTimerId=null,e.next()}),800))},e.prototype.incrementConfirmedCount=function(e){void 0===e&&(e=1),this.countConfirmedTags+=e},e.prototype.skipActiveItemTags=function(){this.carousel.getActive().skipTags()},e.prototype.showThanksNotification=function(){(0,n.showDoneBox)((0,d.getLang)("photo_recognition_thanks_notification"))},e.prototype.showEndCard=function(){var e,t=this.innerWrapperEl.parentElement;if(t){var o=this.getEndCardData(),r=(0,d.getLang)("photo_recognition_viewed_photos",this.items.length),i=o.subtitle||"",s=o.button,n=(0,a.se)('\n      <div class="PhotoRecognizeBlockEndCard">\n        <div class="PhotoRecognizeBlockEndCard__close"></div>\n        <div class="PhotoRecognizeBlockEndCard__title">'+r+'</div>\n        <div class="PhotoRecognizeBlockEndCard__subtitle">'+i+"</div>\n      </div>\n    ");if(s){var c=s.title,l=s.action.url,u=(0,a.se)('<a href="'+l+'" class="PhotoRecognizeBlockEndCard__action flat_button secondary">'+c+"</a>");n.appendChild(u)}this.closeEl=n.querySelector(".PhotoRecognizeBlockEndCard__close"),null===(e=this.closeEl)||void 0===e||e.addEventListener("click",this.removeBlock),t.appendChild(n),(0,a.hide)(this.innerWrapperEl),this.sendAnalytic("show_end_card")}},e.prototype.getEndCardData=function(){var e=this.post.getAttribute("data-end-card");return e?(0,c.parseJSON)(e):{}},e.prototype.sendAnalytic=function(e,t){void 0===t&&(t={}),(0,_.sendAnalytic)(e,this.trackCode,t)},e}()},623643:(e,t,o)=>{o.d(t,{PhotoRecognizeBlockItem:()=>m});var r,i=o(570655),s=o(432034),n=o(850912),a=o(469433),c=o(414914),l=o(917685),d=o(611386),u=o(204182),_=o(421020),h=o(830242),p=o(116886),f=o(486353),g=o(63988);!function(e){e[e.CONFIRMED=0]="CONFIRMED",e[e.DECLINED=1]="DECLINED",e[e.DELETED=2]="DELETED"}(r||(r={}));var m=function(e){function t(t,o){var i=e.call(this,t)||this;i.isLoading=!1,i.isSkipped=!1,i.onShowAllClick=function(e){i.showPhoto(e),i.sendAnalytic("show_tags")},i.onPhotoClick=function(e){e.ctrlKey||e.metaKey||(i.showPhoto(e),(0,l.cancelEvent)(e))},i.onConfirmClick=function(){if(!i.isLoading){var e=i.getTags();i.isLoading=!0,i.tagArea.confirmSuggestedTags(e,i,i.confirmBtn).then((function(){i.updatePhotoviewCache(!0),i.incrementConfirmedCount(e.length),i.showResultPanel(r.CONFIRMED),i.block.nextWithDelay()}),(function(e){e&&(0,d.logError)(e)})).finally((function(){i.isLoading=!1}))}},i.onDeclineClick=function(){i.isLoading||(i.isLoading=!0,i.tagArea.declineSuggestedTags(i.getTags(),i,i.declineBtn).then((function(){i.updatePhotoviewCache(!0),i.showResultPanel(r.DECLINED),i.block.nextWithDelay()})).finally((function(){i.isLoading=!1})))},i.onCancelClick=function(){i.cancelBtn&&(i.reset(),i.showSuggestPanel())},i.onNextClick=function(){i.skipTags(),i.block.next()};var s=t.dataset.tagHash||"";return i.block=o,i.type=Number(t.dataset.recognizeType),i.title=t.dataset.title,i.trackCode=t.dataset.trackCode||"",i.skipHash=t.dataset.skipHash||"",i.confirmBtn=t.querySelector(".PhotoRecognizeBlockItem__btn--confirm"),i.declineBtn=t.querySelector(".PhotoRecognizeBlockItem__btn--decline"),i.showAllBtn=t.querySelector(".PhotoRecognizeBlockItem__btn--showTags"),i.nextBtn=t.querySelector(".PhotoRecognizeBlockItem__btn--next"),i.description=t.querySelector(".PhotoRecognizeBlockItem__description"),i.tagArea=new u.PhotoTagArea(i,s,i.trackCode),i.initListeners(),i}return(0,i.__extends)(t,e),t.prototype.destroy=function(){this.deInitListeners()},t.prototype.skipTags=function(){this.isSkipped||(this.isSkipped=!0,window.ajax.post("al_photos.php",{act:"skip_suggested_tags",tag_raw_ids:this.tagArea.getFullRawTagIdsStr(),photo_raw_id:this.getPhotoRawId(),track_code:this.trackCode,hash:this.skipHash},{onDone:function(){},onFail:function(e){return!!(0,f.partConfigEnabled)("recognize_mock_turn_off")&&e&&(0,d.logError)(e),!0}}))},t.prototype.initListeners=function(){var e,t,o,r,i;null===(e=this.confirmBtn)||void 0===e||e.addEventListener("click",this.onConfirmClick),null===(t=this.declineBtn)||void 0===t||t.addEventListener("click",this.onDeclineClick),null===(o=this.cancelBtn)||void 0===o||o.addEventListener("click",this.onDeclineClick),null===(r=this.showAllBtn)||void 0===r||r.addEventListener("click",this.onShowAllClick),null===(i=this.nextBtn)||void 0===i||i.addEventListener("click",this.onNextClick),this.photo.addEventListener("click",this.onPhotoClick)},t.prototype.deInitListeners=function(){var e,t,o,r,i;null===(e=this.confirmBtn)||void 0===e||e.removeEventListener("click",this.onConfirmClick),null===(t=this.declineBtn)||void 0===t||t.removeEventListener("click",this.onDeclineClick),null===(o=this.showAllBtn)||void 0===o||o.removeEventListener("click",this.onShowAllClick),null===(r=this.nextBtn)||void 0===r||r.removeEventListener("click",this.onNextClick),null===(i=this.cancelBtn)||void 0===i||i.removeEventListener("click",this.onCancelClick),this.photo.removeEventListener("click",this.onPhotoClick)},t.prototype.showPhoto=function(e){(0,a.showPhoto)(this.photoRawId,this.photoContext,this.photoViewOptions,e),this.updatePhotoviewCache()},t.prototype.updatePhotoviewCache=function(e){void 0===e&&(e=!1),this.photoViewOptions.noCache=e,e&&(0,h.dropPhotoCacheData)()},t.prototype.showResultPanel=function(e){var t;if(this.description){var o=this.getResultText(e);this.resultPanel||this.createResultPanel();var i=null===(t=this.resultPanel)||void 0===t?void 0:t.querySelector(".PhotoRecognizeBlockItem__resultMessage");if(!i||!this.resultPanel)throw new Error("PhotoRecognizeBlockItem: can not get text element");this.resultPanel.classList.toggle("PhotoRecognizeBlockItem__resultPanel--confirmed",e===r.CONFIRMED),i.innerHTML=o,(0,c.hide)(this.description),(0,c.show)(this.resultPanel)}},t.prototype.showSuggestPanel=function(){(0,c.hide)(this.resultPanel),(0,c.show)(this.description)},t.prototype.getResultText=function(e){var t=this.getOwnerId(),o=this.getConfirmedTags(),i=this.getTags()[0],s=i.getUserId(),a=i.getOwnerNameGenitive(),c=i.getUserNameAccusative(),l="";switch(e){case r.CONFIRMED:this.type===n.RecognizeItemType.ME?l=t===s?(0,p.getLang)("photo_recognition_confirm_me_on_my_photo"):(l=t>0?(0,p.getLang)("photo_recognition_confirm_myself_on_photo"):(0,p.getLang)("photo_recognition_confirm_myself_on_photo_group")).replace("{name}",a):this.type===n.RecognizeItemType.FRIEND?l=t===s?(0,p.getLang)("photo_recognition_confirm_on_photo").replace("{name}",a):(l=(l=t>0?(0,p.getLang)("photo_recognition_confirm_friend_on_photo"):(0,p.getLang)("photo_recognition_confirm_friend_on_photo_group")).replace("{name1}",c)).replace("{name2}",a):this.type===n.RecognizeItemType.ALL&&(l=(0,p.getLang)("photo_recognition_confirm_n_friends_on_photo",o.length));break;case r.DECLINED:l=this.type===n.RecognizeItemType.ALL?o.length?(0,p.getLang)("photo_recognition_confirm_n_friends_on_photo",o.length):(0,p.getLang)("photo_recognition_decline_n_friends_on_photo",o.length):(l=t>0?(0,p.getLang)("photo_recognition_decline_on_photo"):(0,p.getLang)("photo_recognition_decline_on_photo_group")).replace("{name}",a);break;default:l=(0,p.getLang)("photo_recognition_deleted_tag")}return l},t.prototype.createResultPanel=function(){this.resultPanel=document.createElement("div"),this.resultPanel.classList.add("PhotoRecognizeBlockItem__resultPanel");var e=document.createElement("span");e.classList.add("PhotoRecognizeBlockItem__resultMessage"),this.resultPanel.appendChild(e);var t=this.item.querySelector(".PhotoRecognizeBlockItem__footerWrapper");t&&t.appendChild(this.resultPanel)},t.prototype.setConfirmedTagsByIds=function(e){this.tagArea.setConfirmedTagsByIds(e)&&(this.showResultPanel(r.CONFIRMED),this.incrementConfirmedCount(e.length))},t.prototype.setDeclinedTagsByIds=function(e){this.tagArea.setDeclinedTagsByIds(e)&&this.showResultPanel(r.DECLINED)},t.prototype.setDeletedTagsByIds=function(e){this.tagArea.setDeclinedTagsByIds(e)&&this.showResultPanel(r.DELETED)},t.prototype.reset=function(){this.tagArea.reset()},t.prototype.getTitle=function(){return this.title},t.prototype.getTags=function(){return this.tagArea.getTags()},t.prototype.getConfirmedTags=function(){return this.tagArea.getConfirmedTags()},t.prototype.incrementConfirmedCount=function(e){void 0===e&&(e=1),this.block.incrementConfirmedCount(e)},t.prototype.init=function(){var t=this.item.getAttribute("data-photo-url");t&&(e.prototype.init.call(this),this.checkItemHasNoSizes()&&this.correctTagView(t))},t.prototype.checkItemHasNoSizes=function(){return this.item.classList.contains(_.PHOTO_CAROUSEL_ITEM_NO_SIZE_CLASS)},t.prototype.correctTagView=function(e){var t=this,o=new Image;o.onload=function(){var r=o.width,s=o.height;if(r&&s){var n=t.item.querySelector(".PhotoRecognizeBlockItem__photoFrame");if(!n)return;var a=(0,i.__read)(u.PhotoTagArea.calculateTagAreaSizes(n,r,s),2),c=a[0],l=a[1],d=t.item.querySelector("."+_.PHOTO_ELEMENT_CLASS);if(!d)return;var h=t.item.querySelector("."+_.PHOTO_NO_SIZE_ELEMENT_CLASS);h&&h.remove(),d.style.backgroundSize=c+"px "+l+"px",d.style.backgroundImage="url('"+e+"')";var p=c+1,f=l+1;t.tagArea.setSizes(p,f),t.tagArea.show(),t.item.classList.remove(_.PHOTO_CAROUSEL_ITEM_NO_SIZE_CLASS)}},o.src=e},t.prototype.sendAnalytic=function(e,t){void 0===t&&(t={}),(0,g.sendAnalytic)(e,this.trackCode,t)},t}(s.PhotoCarouselItem)},923668:(e,t,o)=>{o.d(t,{initPhotoBlockInPost:()=>a});var r=o(921386),i=o(421020),s=o(913997),n=o(611386);function a(e,t){var o=e.querySelector("."+i.PHOTO_CAROUSEL_CLASS);if(o)try{if(o.classList.contains("PhotoCarousel--recognize"))return new s.PhotoRecognizeBlock(e);var a={sendAnalytic:t};return new r.PhotoCarouselBlock(e,a)}catch(e){console.error(e),(0,n.logError)(e)}}},421020:(e,t,o)=>{o.d(t,{PHOTO_CAROUSEL_CLASS:()=>r,PHOTO_CAROUSEL_ITEM_CLASS:()=>i,PHOTO_CAROUSEL_ITEM_NO_SIZE_CLASS:()=>s,PHOTO_ELEMENT_CLASS:()=>n,PHOTO_NO_SIZE_ELEMENT_CLASS:()=>a,PHOTO_CAROUSEL_AVATAR_CLASS:()=>c,PHOTO_CAROUSEL_HIDE_BTN_CLASS:()=>l,NUMBER_INITIALIZED_PHOTO:()=>d});var r="PhotoCarousel",i="PhotoCarouselItem",s="PhotoCarouselItem--noSize",n="PhotoCarouselImage",a="PhotoCarouselItem__stub",c="PhotoCarouselBlockItem__avatar",l="PhotoCarousel__hidePost",d=4},63988:(e,t,o)=>{o.d(t,{sendAnalytic:()=>s});var r=o(570655),i=o(986900);function s(e,t,o){void 0===t&&(t=""),void 0===o&&(o={});var s=(0,r.__assign)({event_type:e,track_code:t},o);(0,i.statlogsValueEvent)("photo_recognition_stat",s)}},850912:(e,t,o)=>{var r;o.d(t,{RecognizeItemType:()=>r}),function(e){e[e.ME=1]="ME",e[e.FRIEND=2]="FRIEND",e[e.ALL=3]="ALL"}(r||(r={}))},335967:(e,t,o)=>{var r;o.d(t,{BlockTypeIds:()=>r}),function(e){e.MarketItems="block_market-items",e.PhotoRecognize="tags_suggestions",e.RecommendedNarratives="recommended_narratives"}(r||(r={}))},533246:(e,t,o)=>{o.d(t,{createMutations:()=>n,createModule:()=>l,destroyModule:()=>d});var r=o(570655),i=o(276018),s=o(917685);function n(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,(0,r.__spreadArray)([],(0,r.__read)(t)))}}}function a(e,t,o,r){(0,s.addEvent)(t,o,r),e._registeredHandlers.push({handlerType:"bind",elem:t,types:o,handler:r})}function c(e,t,o,r,s){(0,i.addDelegateEvent)(t,o,r,s),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:o,selector:r,handler:s})}function l(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return a.apply(void 0,(0,r.__spreadArray)([t],(0,r.__read)(e)))}),(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return c.apply(void 0,(0,r.__spreadArray)([t],(0,r.__read)(e)))})),t}function d(e){e._registeredHandlers.forEach((function(e){var t=e.handlerType,o=e.elem,r=e.types,n=e.handler;"delegate"===t?(0,i.removeDelegateEvent)(o,r,e.selector,n):(0,s.removeEvent)(o,r,n)})),e._registeredHandlers=[]}},390683:(e,t,o)=>{o.d(t,{MarketItemsFeedBlock:()=>d});var r=o(791563),i=o(124961),s=o(469433),n={market:"al_market.php"},a={getNewMarketItemsBox:"get_new_items_box"},c="#feed_rows",l=".feed_row",d={showItem:function(e){var t=e.itemRawId,o=e.element,r=e.statName,i=e.clickType;t&&((0,s.showWiki)({w:"product"+t,from:"feed"}),d.logClick({element:o,statName:r,clickType:i,itemRawId:t}))},showAll:function(e,t,o){(0,r.showBox)(n.market,{act:a.getNewMarketItemsBox},{params:{hideButtons:!0,width:550,grey:!0,containerClass:"MarketItemsFeedBlockBox",bodyStyle:"padding: 20px 0 0;",onHide:function(){var e,t;return null===(t=null===(e=window.Marketplace)||void 0===e?void 0:e.scroll)||void 0===t?void 0:t.deinit()}}}),d.logClick({element:e,statName:t,clickType:o})},logClick:function(e){var t,o=e.element,r=e.statName,s=e.clickType,n=e.itemRawId;if(o&&r&&s){var a=(null===(t=window.Feed)||void 0===t?void 0:t.getModuleRef())||"",d=o.closest(c),u=d?Array.from(d.children):[],_=o.closest(l),h=_?u.indexOf(_):0,p=window.cur.feed_session_id||0;(0,i.saveStatlogEvents)({name:r,value:s,keys:[a,h,p,n||""]})}}}},408152:(e,t,o)=>{o.d(t,{friendsRecommInit:()=>g,onViewFriendRecomm:()=>m,friendsRecommLogSave:()=>w,friendsRecommLogGet:()=>b,friendsRecommLogClear:()=>y,friendsRecommLogCheckVisited:()=>E,friendsRecommLogSend:()=>C,friendsRecommLogOnFail:()=>T,FriendsRecommendGlobals:()=>P});var r=o(414914),i=o(917685),s=o(791563),n=o(705456),a=o(651988),c=o(442699),l=o(304418),d=o(64385),u=o(116886),_=o(621260),h=o(488066),p=o(561393),f=function(){var e;return"feed"===window.cur.module&&window.Feed?null===(e=window.Feed)||void 0===e?void 0:e.getModuleRef():window.cur.module};function g(e,t){if(void 0===t&&(t={}),e){var o=(0,r.domData)(e,"from")||"user_rec",i=(0,r.domData)(e,"code"),s={scrollY:!1,onViewItem:function(e,r){var i;(null===(i=null==t?void 0:t.checkViewItem)||void 0===i?void 0:i.call(t,e))||m(e,r,o)}};(0,r.domData)(e,"next")&&(s.onLoadMore=function(){d.ajax.post("al_friends.php",{act:"a_recomm_friends_gallery",next:(0,r.domData)(e,"next"),track_code:i,friend_id:t.friendId||0,ref:f()},{onDone:function(t,o){var i,s=[];t&&(s=(0,r.domChildren)((0,r.ce)("div",{innerHTML:t}))),null===(i=(0,l.uiGetGallery)(e))||void 0===i||i.addMore(s,!o),(0,r.domData)(e,"next",o||null)}})}),new l.UIGallery(e,s)}}function m(e,t,o){if(!e.viewed&&(0,r.hasClass)(e,"ui_gallery_item")){var i=+(0,r.domData)(e,"uid"),s=f(),n=v(e);w(["show_user_rec",i,Date.now(),t,s,o,n]),e.viewed=!0}}function v(e){var t,o=(0,r.domData)(e,"code");return o||(t=(0,r.gpeByClass)("ui_gallery",e),o=(0,r.domData)(t,"code")),o||""}function w(e,t){void 0===t&&(t=!1);var o=b();o.push(e),a.default.set("friends_recomm",o),C(t)}function b(e,t,o){void 0===e&&(e=!1),void 0===o&&(o=!1);var r=a.default.get("friends_recomm"),i=Array.isArray(r)?r:[];return t&&(i=i.filter((function(e){return(o?e[1]!==t:e[1]===t)&&(0,c.inArray)(e[0],["show_user_rec","open_user"])}))),e&&(i=i.map((function(e){return e.join("|")}))),i}function y(e){if(e){var t=b(!1,e,!0);t.length?a.default.set("friends_recomm",t):a.default.remove("friends_recomm")}else a.default.remove("friends_recomm");!function(e){if(e){var t=a.default.get("friends_recomm_visited")||{};delete t[e],a.default.set("friends_recomm_visited",t)}else a.default.remove("friends_recomm_visited")}(e)}function E(e){return(a.default.get("friends_recomm_visited")||{})[e]}function C(e){var t,o;void 0===e&&(e=!1),!(null===(t=window.cur)||void 0===t?void 0:t.friendsRecommLogIdle)&&(null===(o=null===window||void 0===window?void 0:window.curNotifier)||void 0===o?void 0:o.idle_manager)&&(Array.isArray(window.cur.onIdle)||(window.cur.onIdle=[]),Array.isArray(window.cur.onUnidle)||(window.cur.onUnidle=[]),window.cur.friendsRecommLogIdle=function(){clearTimeout(window.cur.friendsRecommLog)},window.cur.onIdle.push(window.cur.friendsRecommLogIdle),window.cur.onUnidle.push(C)),clearTimeout(window.cur.friendsRecommLog),e?k():window.cur.friendsRecommLog=window.setTimeout(k,1e4)}function k(){if(!window.cur.friendsRecommProcess){var e=b(!0);e.length&&(window.cur.friendsRecommProcess=!0,y(),d.ajax.post("al_friends.php",{act:"a_recomm_logs",logs:e},{onDone:function(){delete window.cur.friendsRecommProcess},onFail:function(){return T(e),delete window.cur.friendsRecommProcess,!0}}))}}function T(e){var t=b();t=e.map((function(e){return e.split("|")})).concat(t),a.default.set("friends_recomm",t)}var P={toggleRecommFriend:function(e,t,o){var a=(0,r.gpeByClass)("friend_recomm_card",e),c=a&&+(0,r.domData)(a,"uid");if(c){var l={act:"add",mid:c,hash:o,from:"user_rec",ref:f(),track_code:v(a),ts:Date.now()},g=b(!0,c);return g.length&&(y(c),l.logs=g),d.ajax.post("al_friends.php",l,{onDone:function(t,o){if((0,r.val)(e,t),(0,r.addClass)(e,"secondary"),(0,n.disableButton)(e,!0),(0,r.addClass)(a,"friend_recomm_card_accepted"),(0,r.re)((0,r.geByClass1)("wall_card_text_special",a)),(0,h.isFriendAddResultRequestSent)(o)&&o.friend_request_add_sent_message_nudge){var s=t;(0,_.showDoneBoxFull)("",{},{tooltipHandler:(c=o.friend_request_entrypoint,function(e,t){var o=t.hide;(0,i.addEvent)(e.querySelector('[data-section-ref="friend_request_notification_send_message"]'),"click",(function(e){var t;if(e.currentTarget instanceof HTMLElement){var r=parseInt(null!==(t=e.currentTarget.getAttribute("data-message-user-id"))&&void 0!==t?t:"");if(!r||(0,i.checkEvent)(e))return!0;o(),(0,p.showWriteMessageBox)(e,r,{params:{box_custom_entrypoint:c}})}}))}),text:o.friend_request_add_sent_message_nudge,title:s})}var c},onFail:function(e){if(g&&T(g),e)return(0,s.showFastBox)((0,u.getLang)("global_error"),e),!0},showProgress:function(){return(0,n.lockButton)(e)},hideProgress:function(){return(0,n.unlockButton)(e)}}),(0,i.cancelEvent)(t),!1}},hideRecommFriend:function(e,t,o){var a=(0,r.gpeByClass)("friend_recomm_card",e),c=a&&+(0,r.domData)(a,"uid");if(c){var _=(0,r.gpeByClass)("ui_gallery",e),h=f(),p=(0,r.domData)(a,"code")||(0,r.domData)(_,"code")||"";return d.ajax.post("al_friends.php",{act:"hide_possible",mid:c,ref:h,track_code:p,hash:o},{onDone:function(){var t=(0,l.uiGetGallery)((0,r.gpeByClass)("ui_gallery",e));if(t){var o=(0,r.gpeByClass)("ui_gallery_item",e);t.removeItem(o)}},onFail:function(e){if(e)return(0,s.showFastBox)((0,u.getLang)("global_error"),e),!0},showProgress:function(){return(0,n.lockButton)(e)},hideProgress:function(){return(0,n.unlockButton)(e)}}),(0,i.cancelEvent)(t),!1}},onClickRecommFriend:function(e){if((0,r.hasClass)(e,"ui_gallery_item")||(e=(0,r.gpeByClass)("ui_gallery_item",e)),e){var t=+(0,r.domData)(e,"uid"),o=f(),i=v(e);!function(e,t,o){var r=a.default.get("friends_recomm_visited")||{};r[e]={ref:t,trackCode:o},a.default.set("friends_recomm_visited",r)}(t,o,i),w(["open_user",t,Date.now(),o,i])}}}},488066:(e,t,o)=>{o.d(t,{isFriendAddResultRequestSent:()=>s});var r,i=o(917999);!function(e){e[e.DELETED_USER=-5]="DELETED_USER",e[e.BLACKLISTED=-4]="BLACKLISTED",e[e.FRIENDS_COUNT_EXCEEDED=-3]="FRIENDS_COUNT_EXCEEDED",e[e.FLOOD_CONTROL=-2]="FLOOD_CONTROL",e[e.SERVER_ERROR=-1]="SERVER_ERROR",e[e.NOT_FRIENDS=0]="NOT_FRIENDS",e[e.REQUEST_FROM_USER=1]="REQUEST_FROM_USER",e[e.REQUEST_TO_USER=2]="REQUEST_TO_USER",e[e.ARE_FRIENDS=3]="ARE_FRIENDS"}(r||(r={}));var s=function(e){if((0,i.isObject)(e)){var t=e;return(null==t?void 0:t.result_code)===r.REQUEST_FROM_USER}return!1}},632994:(e,t,o)=>{var r;o.d(t,{PhotoTag:()=>i}),function(e){e[e.Initial=0]="Initial",e[e.Confirmed=1]="Confirmed",e[e.Declined=2]="Declined"}(r||(r={}));var i=function(){function e(e,t){this.tagEl=e,this.tagArea=t;var o=e.getAttribute("data-item");if(!o)throw new Error("Tag: incorrect json data");var i=JSON.parse(o);this.id=Number(i.id),this.userId=i.userId,this.name=i.name,this.nameGenitive=i.nameGenitive,this.ownerNameGenitive=i.ownerNameGenitive,this.placerNameGenitive=i.placerNameGenitive,this.nameAccusative=i.nameAccusative,this.isSuggested=Boolean(i.isSuggested),this.sex=Number(i.sex),this.styles={top:i.top,left:i.left,width:i.width,height:i.height};var s=r.Initial;e.classList.contains("PhotoTag--confirm")?s=r.Confirmed:e.classList.contains("PhotoTag--decline")&&(s=r.Declined),this.state=s;var n="tag_cutout"+t.getPhotoRawId()+"_"+i.userId,a=document.getElementById(n);if(!a)throw new Error("Tag: incorrect data");this.cutoutEl=a}return e.prototype.decline=function(){this.tagEl.classList.remove("PhotoTag--confirm"),this.tagEl.classList.add("PhotoTag--decline"),this.cutoutEl.classList.remove("PhotoTagCutout--transparency"),this.state=r.Declined},e.prototype.confirm=function(){this.tagEl.classList.remove("PhotoTag--decline"),this.tagEl.classList.add("PhotoTag--confirm"),this.cutoutEl.classList.add("PhotoTagCutout--transparency"),this.state=r.Confirmed},e.prototype.reset=function(){this.tagEl.classList.remove("PhotoTag--decline"),this.tagEl.classList.remove("PhotoTag--confirm"),this.cutoutEl.classList.remove("PhotoTagCutout--transparency"),this.state=r.Initial},e.prototype.getFullRawId=function(){return this.tagArea.getPhotoRawId()+"_"+this.getId()},e.prototype.getId=function(){return this.id},e.prototype.getUserId=function(){return this.userId},e.prototype.getUserName=function(){return this.name},e.prototype.getUserNameGenitive=function(){return this.nameGenitive},e.prototype.getUserNameAccusative=function(){return this.nameAccusative},e.prototype.getOwnerNameGenitive=function(){return this.ownerNameGenitive},e.prototype.getPlacerNameGenitive=function(){return this.placerNameGenitive},e.prototype.isConfirmed=function(){return this.state===r.Confirmed},e.prototype.getSex=function(){return this.sex},e}()},204182:(e,t,o)=>{o.d(t,{PhotoTagArea:()=>d});var r=o(632994),i=o(705456),s=o(486353),n=o(621260),a=o(116886),c=o(791563),l=o(713208),d=function(){function e(e,t,o){var c=this;this.confirmTag=function(e,t,o){o&&(0,i.lockButton)(o);var r=!(0,s.partConfigEnabled)("recognize_mock_turn_off");return new Promise((function(s,l){window.ajax.post("al_photos.php",{act:"confirm_tag",photo:t.getPhotoRawId(),tag:e.getId(),hash:c.tagHash},{onDone:function(){c.setConfirmedTags([e]),c.decrementLeftMenuCounterIfNeeded([e]),s()},onFail:function(){return r?(c.setConfirmedTags([e]),s(),!0):((0,n.showDoneBox)((0,a.getLang)("global_unknown_error")),l(),!0)},hideProgress:function(){o&&(0,i.unlockButton)(o)}})}))},this.declineTag=function(e,t,o){return new Promise((function(r,l){o&&(0,i.lockButton)(o);var d=!(0,s.partConfigEnabled)("recognize_mock_turn_off");window.ajax.post("al_photos.php",{act:"delete_tag",photo:t.getPhotoRawId(),tag:e.getId(),hash:c.tagHash},{onDone:function(){c.setDeclinedTags([e]),c.decrementLeftMenuCounterIfNeeded([e]),r()},onFail:function(){return d?(c.setDeclinedTags([e]),r(),!0):((0,n.showDoneBox)((0,a.getLang)("global_unknown_error")),l(),!0)},hideProgress:function(){o&&(0,i.unlockButton)(o)}})}))},this.confirmSuggestedTags=function(e,t,o){return c.showConfirmAlertBoxIfNeeded(e).then((function(){o&&(0,i.lockButton)(o);var t=!(0,s.partConfigEnabled)("recognize_mock_turn_off");return new Promise((function(r,s){window.ajax.post("al_photos.php",{act:"confirm_suggested_tags",tag_raw_ids:c.getFullRawTagIdsStr(e),track_code:c.trackCode,hash:c.tagHash},{onDone:function(){c.setConfirmedTags(e),c.decrementLeftMenuCounterIfNeeded(e),r()},onFail:function(){return t?(c.setConfirmedTags(e),r(),!0):((0,n.showDoneBox)((0,a.getLang)("global_unknown_error")),s(),!0)},hideProgress:function(){o&&(0,i.unlockButton)(o)}})}))}))},this.declineSuggestedTags=function(e,t,o){return new Promise((function(t,r){o&&(0,i.lockButton)(o);var l=!(0,s.partConfigEnabled)("recognize_mock_turn_off");window.ajax.post("al_photos.php",{act:"decline_suggested_tags",tag_raw_ids:c.getFullRawTagIdsStr(e),track_code:c.trackCode,hash:c.tagHash},{onDone:function(){c.setDeclinedTags(e),c.decrementLeftMenuCounterIfNeeded(e),t()},onFail:function(){return l?(c.setDeclinedTags(e),t(),!0):((0,n.showDoneBox)((0,a.getLang)("global_unknown_error")),r(),!0)},hideProgress:function(){o&&(0,i.unlockButton)(o)}})}))};var l=e.getEl().querySelector(".PhotoTagArea");if(!l)throw new Error("error: there is not tag area el");if(!t)throw new Error("error: there is not tag hash");var d=Array.from(e.getEl().querySelectorAll(".PhotoTag"));this.trackCode=o,this.tagArea=l,this.tagHash=t,this.photoEntity=e,this.tags=d.map((function(e){return new r.PhotoTag(e,c)})),this.tagsMap=this.tags.reduce((function(e,t){return e[t.getId()]=t,e}),{})}return e.prototype.showConfirmAlertBoxIfNeeded=function(e){var t=this,o=e[0];return new Promise((function(e,r){if(window.cur.pvNeedShowAlertForOneSuggest&&o.getUserId()!==window.vk.id)var i=(0,a.getLang)("photo_recognition_one_tag_alert"),s=(0,a.langSex)(o.getSex(),(0,a.getLang)("photo_recognition_one_tag_alert_text","raw")).replace("{name}",o.getUserName()),n=(0,c.showFastBox)(i,s,(0,a.getLang)("photo_recognition_one_friend_submit_btn"),(function(){t.hideHint(),n.hide(),e()}),(0,a.getLang)("global_cancel"),(function(){n.hide(),r()}));else e()}))},e.prototype.hideHint=function(){window.cur.pvNeedShowAlertForOneSuggest=!1;var e=window.cur.pvOneSuggestHintId,t=window.cur.pvOneSuggestHintHash;e&&t&&window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:e,hash:t},{onDone:function(){},onFail:function(){return console.error("something wrong with help hint"),!0}})},e.prototype.decrementLeftMenuCounterIfNeeded=function(e){e.forEach((function(e){e.getUserId()===window.vk.id&&(0,l.decrementLeftMenuPhotoCounter)()}))},e.prototype.getFullRawTagIdsStr=function(e){return void 0===e&&(e=this.tags),e.reduce((function(e,t,o){return e+(0===o?"":",")+t.getFullRawId()}),"")},e.prototype.setConfirmedTagsByIds=function(e){var t=this,o=e.reduce((function(e,o){return t.tagsMap[o]&&e.push(t.tagsMap[o]),e}),[]);return!!o.length&&(this.setConfirmedTags(o),!0)},e.prototype.setConfirmedTags=function(e){var t=this;(e=e.filter((function(e){return t.tagsMap[e.getId()]}))).length&&(e.forEach((function(e){return e.confirm()})),this.tagArea.classList.add("PhotoTagArea--fade"))},e.prototype.setDeclinedTags=function(e){e.forEach((function(e){return e.decline()}))},e.prototype.setDeclinedTagsByIds=function(e){var t=this,o=e.reduce((function(e,o){return t.tagsMap[o]&&e.push(t.tagsMap[o]),e}),[]);return!!o.length&&(this.setDeclinedTags(o),!0)},e.prototype.reset=function(){this.tagArea.classList.remove("PhotoTagArea--fade"),this.tags.forEach((function(e){return e.reset()}))},e.prototype.getPhotoRawId=function(){return this.photoEntity.getPhotoRawId()},e.prototype.getTags=function(){return this.tags},e.prototype.getConfirmedTags=function(){return this.tags.filter((function(e){return e.isConfirmed()}))},e.prototype.setSizes=function(e,t){this.tagArea.style.width=e+"px",this.tagArea.style.height=t+"px"},e.prototype.show=function(){this.tagArea.classList.remove("PhotoTagArea--hide")},e.calculateTagAreaSizes=function(e,t,o){var r,i,s=e.offsetWidth,n=e.offsetHeight,a=t/o,c=!0;return s/n>a&&(c=!1),c?(r=Math.round(Math.min(t,s)),i=Math.round(r/a)):(i=Math.round(Math.min(o,n)),r=Math.round(i*a)),[r,i]},e}()},713208:(e,t,o)=>{o.d(t,{decrementLeftMenuPhotoCounter:()=>a});var r=o(442699),i=o(611386),s=o(484426),n="ph";function a(e){void 0===e&&(e=1);try{var t=function(){var e=document.getElementById("l_ph");if(!e)throw new Error("There is not photo left menu item");var t=e.querySelector(".left_count");return t?(0,r.intval)(t.textContent):0}();(0,s.handlePageCount)(n,Math.max(t-e,0))}catch(e){console.error(e),(0,i.logError)(e)}}},775478:(e,t,o)=>{var r;o.d(t,{TagEventTypes:()=>r}),function(e){e.CONFIRM_SUGGESTED_TAGS="CONFIRM_SUGGESTED_TAGS",e.DECLINE_SUGGESTED_TAGS="DECLINE_SUGGESTED_TAGS",e.DECLINE_USER_TAG="DECLINE_USER_TAG",e.CONFIRM_USER_TAG="CONFIRM_USER_TAG",e.DELETE_TAG="DELETE_TAG"}(r||(r={}))},138201:(e,t,o)=>{o.d(t,{isDebugEnabled:()=>r.isDebugEnabled,ENABLED_IN_POST_REPLY:()=>i});var r=o(509723),i=!1},509698:(e,t,o)=>{o.d(t,{reactionLogError:()=>s});var r=o(956146),i=o(353417),s=function(e){var t,o=e.error,s=(0,i.getReactionConfig)(),n=null!==(t=null==s?void 0:s.reportJsErrors)&&void 0!==t&&t;(0,r.reactionLogError)({error:o,reportError:n})}},353417:(e,t,o)=>{o.d(t,{storageAddSets:()=>_,getReactionSet:()=>h,storageSetConfig:()=>p,getReactionConfig:()=>f});var r=o(570655),i=o(358862),s=o(754),n=o(257451),a=o(509698),c=o(431700),l=o(138201),d=(0,n.makeSharedState)("reactions-storage",(function(){return new Map})),u=(0,n.makeSharedState)("reactions-config",(function(){return{config:void 0}})),_=function(e){(0,l.isDebugEnabled)()&&console.log(e),Object.entries(e).forEach((function(e){var t=(0,r.__read)(e,2),o=t[0],n=t[1],l=(0,s.validateReactionSetPayloaditems)(n,o);if(l)(0,a.reactionLogError)({error:l.error});else{var u=n.map((function(e){return(0,r.__assign)((0,r.__assign)({},e),{title:(0,i.decodeHTMLEntities)(e.title)})}));d().set(o,(0,s.prepareReactionMenuSet)(o,u,{imageMenuSize:c.SIZE_MENU,imagePreviewSize:c.SIZE_PREVIEW}))}}))},h=function(e){var t=d().get(e);if(t)return t;var o=new Error("Reaction set not found: "+e);(0,a.reactionLogError)({error:o})},p=function(e){(0,l.isDebugEnabled)()&&console.log(e);var t=(0,s.parseReactionMenuConfig)(e);t?u().config=t:console.warn("Reactions: invalid menu config passed",e)},f=function(){var e;return null===(e=u())||void 0===e?void 0:e.config}},885682:(e,t,o)=>{o.d(t,{getReactionsButtonPostTemplate:()=>u,getReactionsButtonReplyTemplate:()=>_,likeDataReactionsFields:()=>f});var r=o(486353),i=o(414914),s=o(431700),n=o(353417),a=o(754),c=o(457700),l=function(e,t){var o,s=null===(o=function(e){try{var t=JSON.parse(e);if(null!==t&&"object"!=typeof t)return;return t}catch(e){return}}(e))||void 0===o?void 0:o.set_id,c="string"==typeof s?s:void 0;if((0,r.partConfigEnabled)("reactions_enabled")&&t&&c){var l=(0,n.getReactionSet)(c);if(l)return{likeClassName:"like_btn--hidden PostBottomAction--hidden",template:(0,i.rs)(t,{reactions_button_title:(0,a.getDefaultReactionTitle)(l)||"",reactions_set_id:c})}}},d=function(e,t){return t.length>e},u=function(e,t){var o,r=null===(o=null==t?void 0:t.wallTpl)||void 0===o?void 0:o.post_likes_reactions,i=d(14,e)?e[14]:void 0;if("string"==typeof i)return l(i,r)},_=function(e,t){var o,i=null===(o=null==t?void 0:t.wallTpl)||void 0===o?void 0:o.reply_likes_reactions;if((0,r.partConfigEnabled)("reactions_enabled_post_replies")){var s=d(14,e)?e[14]:void 0;if("string"==typeof s)return l(s,i)}},h=function(e){var t=JSON.parse(e);if(null===t||"object"==typeof t||Array.isArray(t)){var o;if(Array.isArray(t))t=(0,c.reactionCountsBrandWrap)((o=t,Object.assign(Object.create(null),o)));return t}},p=function(e){if((0,r.partConfigEnabled)("reactions_enabled")){var t=d(5,e)?e[5]:void 0;if("string"==typeof t){var o=function(e){var t=e.indexOf(";"),o=e.substr(0,t),r=e.substr(t+1);if("1"===o)return h(r)}(t);if(o)return{counts:o}}}},f=function(e){var t,o=p(e);return(t={})[s.REACTIONS_COUNTS_RESPONSE_FIELD]=null==o?void 0:o.counts,t}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(o.exports,o,o.exports,__webpack_require__),o.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,o,r)=>{if(!t){var i=1/0;for(c=0;c<deferred.length;c++){for(var[t,o,r]=deferred[c],s=!0,n=0;n<t.length;n++)(!1&r||i>=r)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[n])))?t.splice(n--,1):(s=!1,r<i&&(i=r));if(s){deferred.splice(c--,1);var a=o();void 0!==a&&(e=a)}}return e}r=r||0;for(var c=deferred.length;c>0&&deferred[c-1][2]>r;c--)deferred[c]=deferred[c-1];deferred[c]=[t,o,r]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var o=Object.create(null);__webpack_require__.r(o);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,__webpack_require__.d(o,r),o},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={2495:0};__webpack_require__.O.j=t=>0===e[t];var t=(t,o)=>{var r,i,[s,n,a]=o,c=0;for(r in n)__webpack_require__.o(n,r)&&(__webpack_require__.m[r]=n[r]);if(a)var l=a(__webpack_require__);for(t&&t(o);c<s.length;c++)i=s[c],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[s[c]]=0;return __webpack_require__.O(l)},o=self.webpackChunkvk=self.webpackChunkvk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var __webpack_exports__=__webpack_require__.O(void 0,[8592,4509,8003],(()=>__webpack_require__(521388)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();