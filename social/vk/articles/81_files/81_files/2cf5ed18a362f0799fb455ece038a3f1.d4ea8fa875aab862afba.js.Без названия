(window.webpackJsonp=window.webpackJsonp||[]).push([["2cf5ed18a362f0799fb455ece038a3f1"],{"7lz1":function(t,e,n){"use strict";n.r(e),n.d(e,"decrementLeftMenuPhotoCounter",(function(){return a})),n.d(e,"resetLeftMenuPhotoCounter",(function(){return s}));var o=n("t7n3"),r=n("HLtZ"),i=n("kHqu");function a(t){void 0===t&&(t=1);try{var e=function(){var t=document.getElementById("l_ph");if(!t)throw new Error("There is not photo left menu item");var e=t.querySelector(".left_count");return e?Object(o.intval)(e.textContent):0}();Object(i.handlePageCount)("ph",Math.max(e-t,0))}catch(t){console.error(t),Object(r.logError)(t)}}function s(){try{Object(i.handlePageCount)("ph",0)}catch(t){console.error(t),Object(r.logError)(t)}}},YoAk:function(t,e,n){"use strict";var o;n.r(e),n.d(e,"PhotoTagArea",(function(){return g})),function(t){t[t.Initial=0]="Initial",t[t.Confirmed=1]="Confirmed",t[t.Declined=2]="Declined"}(o||(o={}));var r=function(){function t(t,e){this.tagEl=t,this.tagArea=e;var n=t.getAttribute("data-item");if(!n)throw new Error("Tag: incorrect json data");var r=JSON.parse(n);this.id=Number(r.id),this.userId=r.userId,this.name=r.name,this.nameGenitive=r.nameGenitive,this.ownerNameGenitive=r.ownerNameGenitive,this.placerNameGenitive=r.placerNameGenitive,this.nameAccusative=r.nameAccusative,this.isSuggested=Boolean(r.isSuggested),this.sex=Number(r.sex),this.styles={top:r.top,left:r.left,width:r.width,height:r.height};var i=o.Initial;t.classList.contains("PhotoTag--confirm")?i=o.Confirmed:t.classList.contains("PhotoTag--decline")&&(i=o.Declined),this.state=i;var a="tag_cutout"+e.getPhotoRawId()+"_"+r.userId,s=document.getElementById(a);if(!s)throw new Error("Tag: incorrect data");this.cutoutEl=s}return t.prototype.decline=function(){this.tagEl.classList.remove("PhotoTag--confirm"),this.tagEl.classList.add("PhotoTag--decline"),this.cutoutEl.classList.remove("PhotoTagCutout--transparency"),this.state=o.Declined},t.prototype.confirm=function(){this.tagEl.classList.remove("PhotoTag--decline"),this.tagEl.classList.add("PhotoTag--confirm"),this.cutoutEl.classList.add("PhotoTagCutout--transparency"),this.state=o.Confirmed},t.prototype.reset=function(){this.tagEl.classList.remove("PhotoTag--decline"),this.tagEl.classList.remove("PhotoTag--confirm"),this.cutoutEl.classList.remove("PhotoTagCutout--transparency"),this.state=o.Initial},t.prototype.getFullRawId=function(){return this.tagArea.getPhotoRawId()+"_"+this.getId()},t.prototype.getId=function(){return this.id},t.prototype.getUserId=function(){return this.userId},t.prototype.getUserName=function(){return this.name},t.prototype.getUserNameGenitive=function(){return this.nameGenitive},t.prototype.getUserNameAccusative=function(){return this.nameAccusative},t.prototype.getOwnerNameGenitive=function(){return this.ownerNameGenitive},t.prototype.getPlacerNameGenitive=function(){return this.placerNameGenitive},t.prototype.isConfirmed=function(){return this.state===o.Confirmed},t.prototype.getSex=function(){return this.sex},t}(),i=n("v+DW"),a=n("W9Tc"),s=n("kcIO"),c=n("4+be"),u=n("EasH"),h=n("7lz1"),g=function(){function t(t,e,n){var o=this;this.confirmTag=function(t,e,n){n&&Object(i.lockButton)(n);var r=!Object(a.partConfigEnabled)("recognize_mock_turn_off");return new Promise((function(a,u){window.ajax.post("al_photos.php",{act:"confirm_tag",photo:e.getPhotoRawId(),tag:t.getId(),hash:o.tagHash},{onDone:function(){o.setConfirmedTags([t]),o.decrementLeftMenuCounterIfNeeded([t]),a()},onFail:function(){return r?(o.setConfirmedTags([t]),a(),!0):(Object(s.showDoneBox)(Object(c.getLang)("global_unknown_error")),u(),!0)},hideProgress:function(){n&&Object(i.unlockButton)(n)}})}))},this.declineTag=function(t,e,n){return new Promise((function(r,u){n&&Object(i.lockButton)(n);var h=!Object(a.partConfigEnabled)("recognize_mock_turn_off");window.ajax.post("al_photos.php",{act:"delete_tag",photo:e.getPhotoRawId(),tag:t.getId(),hash:o.tagHash},{onDone:function(){o.setDeclinedTags([t]),o.decrementLeftMenuCounterIfNeeded([t]),r()},onFail:function(){return h?(o.setDeclinedTags([t]),r(),!0):(Object(s.showDoneBox)(Object(c.getLang)("global_unknown_error")),u(),!0)},hideProgress:function(){n&&Object(i.unlockButton)(n)}})}))},this.confirmSuggestedTags=function(t,e,n){return o.showConfirmAlertBoxIfNeeded(t).then((function(){n&&Object(i.lockButton)(n);var e=!Object(a.partConfigEnabled)("recognize_mock_turn_off");return new Promise((function(r,a){window.ajax.post("al_photos.php",{act:"confirm_suggested_tags",tag_raw_ids:o.getFullRawTagIdsStr(t),track_code:o.trackCode,hash:o.tagHash},{onDone:function(){o.setConfirmedTags(t),o.decrementLeftMenuCounterIfNeeded(t),r()},onFail:function(){return e?(o.setConfirmedTags(t),r(),!0):(Object(s.showDoneBox)(Object(c.getLang)("global_unknown_error")),a(),!0)},hideProgress:function(){n&&Object(i.unlockButton)(n)}})}))}))},this.declineSuggestedTags=function(t,e,n){return new Promise((function(e,r){n&&Object(i.lockButton)(n);var u=!Object(a.partConfigEnabled)("recognize_mock_turn_off");window.ajax.post("al_photos.php",{act:"decline_suggested_tags",tag_raw_ids:o.getFullRawTagIdsStr(t),track_code:o.trackCode,hash:o.tagHash},{onDone:function(){o.setDeclinedTags(t),o.decrementLeftMenuCounterIfNeeded(t),e()},onFail:function(){return u?(o.setDeclinedTags(t),e(),!0):(Object(s.showDoneBox)(Object(c.getLang)("global_unknown_error")),r(),!0)},hideProgress:function(){n&&Object(i.unlockButton)(n)}})}))};var u=t.getEl().querySelector(".PhotoTagArea");if(!u)throw new Error("error: there is not tag area el");if(!e)throw new Error("error: there is not tag hash");var h=Array.from(t.getEl().querySelectorAll(".PhotoTag"));this.trackCode=n,this.tagArea=u,this.tagHash=e,this.photoEntity=t,this.tags=h.map((function(t){return new r(t,o)})),this.tagsMap=this.tags.reduce((function(t,e){return t[e.getId()]=e,t}),{})}return t.prototype.showConfirmAlertBoxIfNeeded=function(t){var e=this,n=t[0];return new Promise((function(t,o){if(window.cur.pvNeedShowAlertForOneSuggest&&n.getUserId()!==window.vk.id)var r=Object(c.getLang)("photo_recognition_one_tag_alert"),i=Object(c.langSex)(n.getSex(),Object(c.getLang)("photo_recognition_one_tag_alert_text","raw")).replace("{name}",n.getUserName()),a=Object(u.showFastBox)(r,i,Object(c.getLang)("photo_recognition_one_friend_submit_btn"),(function(){e.hideHint(),a.hide(),t()}),Object(c.getLang)("global_cancel"),(function(){a.hide(),o()}));else t()}))},t.prototype.hideHint=function(){window.cur.pvNeedShowAlertForOneSuggest=!1;var t=window.cur.pvOneSuggestHintId,e=window.cur.pvOneSuggestHintHash;t&&e&&window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:t,hash:e},{onDone:function(){},onFail:function(){return console.error("something wrong with help hint"),!0}})},t.prototype.decrementLeftMenuCounterIfNeeded=function(t){t.forEach((function(t){t.getUserId()===window.vk.id&&Object(h.decrementLeftMenuPhotoCounter)()}))},t.prototype.getFullRawTagIdsStr=function(t){return void 0===t&&(t=this.tags),t.reduce((function(t,e,n){return t+(0===n?"":",")+e.getFullRawId()}),"")},t.prototype.setConfirmedTagsByIds=function(t){var e=this,n=t.reduce((function(t,n){return e.tagsMap[n]&&t.push(e.tagsMap[n]),t}),[]);return!!n.length&&(this.setConfirmedTags(n),!0)},t.prototype.setConfirmedTags=function(t){var e=this;(t=t.filter((function(t){return e.tagsMap[t.getId()]}))).length&&(t.forEach((function(t){return t.confirm()})),this.tagArea.classList.add("PhotoTagArea--fade"))},t.prototype.setDeclinedTags=function(t){t.forEach((function(t){return t.decline()}))},t.prototype.setDeclinedTagsByIds=function(t){var e=this,n=t.reduce((function(t,n){return e.tagsMap[n]&&t.push(e.tagsMap[n]),t}),[]);return!!n.length&&(this.setDeclinedTags(n),!0)},t.prototype.reset=function(){this.tagArea.classList.remove("PhotoTagArea--fade"),this.tags.forEach((function(t){return t.reset()}))},t.prototype.getPhotoRawId=function(){return this.photoEntity.getPhotoRawId()},t.prototype.getTags=function(){return this.tags},t.prototype.getConfirmedTags=function(){return this.tags.filter((function(t){return t.isConfirmed()}))},t.prototype.setSizes=function(t,e){this.tagArea.style.width=t+"px",this.tagArea.style.height=e+"px"},t.prototype.show=function(){this.tagArea.classList.remove("PhotoTagArea--hide")},t.calculateTagAreaSizes=function(t,e,n){var o,r,i=t.offsetWidth,a=t.offsetHeight,s=e/n,c=!0;return i/a>s&&(c=!1),c?(o=Math.round(Math.min(e,i)),r=Math.round(o/s)):(r=Math.round(Math.min(n,a)),o=Math.round(r*s)),[o,r]},t}()}}]);try{stManager.done("cmodules/bundles/2cf5ed18a362f0799fb455ece038a3f1.d4ea8fa875aab862afba.js")}catch(t){}