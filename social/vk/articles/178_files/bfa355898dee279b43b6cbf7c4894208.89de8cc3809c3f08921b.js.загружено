(self.webpackChunkvk=self.webpackChunkvk||[]).push([[1771],{616515:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});r(530522),r(66108),r(296253),r(991181),r(579665),r(95767);var o=r(414914),a=r(719016),n=r(506362);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],o=!0,a=!1,n=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){a=!0,n=e}finally{try{o||null==s.return||s.return()}finally{if(a)throw n}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}const l={SCROLL_EDGE_BELOW_THRESHOLD:20,MAX_COMMENTS_NUM:150,MAX_LIKES_PER_BATCH:7,MAX_STICKERS_PER_BATCH:7,init(e,t){VideoChat.block&&VideoChat.destroy(),e&&(VideoChat.block=e,VideoChat.options=extend({},t),VideoChat.messagesWrap=domByClass(e,"mv_chat_messages_wrap"),VideoChat.stickersWrap=domByClass(e,"mv_chat_stickers_wrap"),VideoChat.scroll=new uiScroll(domFC(VideoChat.messagesWrap),{global:!0,hidden:t.scrollHidden,reversed:!0,preserveEdgeBelow:!0,preserveEdgeBelowThreshold:VideoChat.SCROLL_EDGE_BELOW_THRESHOLD,theme:"videoview",onupdate:VideoChat.onScrollUpdate}),this.scrollBottomBtnWrap=domByClass(e,"mv_chat_new_messages_btn_wrap"),VideoChat.replyForm=domByClass(e,"mv_chat_reply_form"),VideoChat.replyForm&&(VideoChat.replyInput=domByClass(e,"mv_chat_reply_input"),VideoChat.initReplyInput()),VideoChat.firstMsgIntro=domByClass(e,"mv_chat_first_message_intro"))},initReplyInput(){placeholderInit(VideoChat.replyInput,{editable:!0,global:!0}),stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){var e=Emoji.init(VideoChat.replyInput,{forceStickerPack:VideoChat.options.forceStickerPack,controlsCont:VideoChat.replyForm,noLineBreaks:1,noCtrlSend:1,ref:"video_chat",onSend:function(){VideoChat.sendMessage()},checkEditable:function(){VideoChat.checkFormHeight(),VideoChat.checkTextLen()},onStickerSend:function(e){VideoChat.sendSticker(e)}});(0,o.data)(VideoChat.replyForm,"optId",e)}))},checkFormHeight(){var e=VideoChat.replyForm,t=e.offsetHeight;if(e.lastHeight!==t){e.lastHeight=t;var r=!VideoChat.scroll.data.scrollBottom;setStyle(VideoChat.messagesWrap,{bottom:t+"px"}),r&&VideoChat.scroll.scrollBottom()}},checkTextLen(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VideoChat.replyInput,t=trim(Emoji.editableVal(e));if(e.lastLen!==t.length)if((e.lastLen=t.length)>mvcur.maxChatReplyLength){var r=cur.storyLayer?"stories_live_chat_msg_too_long":"video_live_chat_msg_too_long";(0,a.showTooltip)(e,{black:1,text:getLang(r),shift:!!cur.storyLayer&&[-30,10]})}else window.tooltips&&tooltips.destroy(e)},mentionOver:e=>window.mentionOver(e,{shift:[-20,7,7]}),stickerClick:(e,t,r)=>(stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.clickSticker(e,t,r)})),!1),onScrollUpdate(e){e.data.scrollBottom<VideoChat.SCROLL_EDGE_BELOW_THRESHOLD&&VideoChat.toggleScrollBottomBtn(!1)},receiveMessage(e,t,r,o,a,n,i,s,l){if(intval(l))VideoChat.appendSticker(l,r);else{var c=!1;window.replyAsList&&window.replyAsList.length&&each(window.replyAsList,(function(){if(this[0]==r)return c=!0,!1}));var d=Videoview.getMvData(),m=d.adminLevel,p=d.canDeleteComments,u="";(m>constants.Groups.GROUPS_ADMIN_LEVEL_USER||p||e==vk.id||r==vk.id||c)&&(u+=getTemplate("video_chat_message_action_del",{video_owner_id:e,msg_id:t}));var h=psr(getTemplate("video_chat_message",{author_href:n,author_photo:psr(a),author_name:o,message:s,video_owner_id:e,msg_id:t,actions:u,classes:r==e?"mv_chat_admin_message":""}));VideoChat.appendMessage(h,t)}},receiveDelete(e,t){var r="#mv_chat_msg"+mvcur.mvData.oid+"_"+t,o=VideoChat._messagesBatch&&VideoChat._messagesBatch.querySelector(r);o?re(o):(o=VideoChat.messagesWrap.querySelector(r))&&!hasClass(o,"_deleting")&&VideoChat.scroll.updateAbove((function(){re(o)}))},checkStickerFlood(e,t){var r=mvcur.queueBatchId;VideoChat._stickersLimits&&VideoChat._stickersLimits.batch==r||(VideoChat._stickersLimits={batch:r,like:0,sticker:0},VideoChat._stickersDelay=0);var o="like"==e?"like":"sticker",a="like"==o?VideoChat.MAX_LIKES_PER_BATCH:VideoChat.MAX_STICKERS_PER_BATCH;return!(++VideoChat._stickersLimits[o]>a&&t!=vk.id)},appendSticker(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!VideoChat.isHidden()&&!Videoview.isFS&&"hidden"!=document.visibilityState&&"animation"in bodyNode.style&&"onanimationend"in window){if(t==vk.id){var o=VideoChat.recentlySentSticker;if(o&&o.stickerId==e&&o.fromQueue!=r&&Date.now()-o.time<3e3)return;VideoChat.recentlySentSticker={stickerId:e,fromQueue:r,time:Date.now()}}else if(!VideoChat.checkStickerFlood(e,t))return;if("like"==e){var a=ce("div",{className:"mv_chat_like"});i(a),addEvent(a,"animationend",l),s(a)}else{var n=ce("img",{className:"mv_chat_sticker",src:Stickers.getStickerUrl(e,(isRetina()?128:64)+"b")});i(n),addEvent(n,"error animationend",l),addEvent(n,"load",s)}}function i(e){for(var r="",o=0,a=0,n=0,i=intval((VideoChat.getHeight()-80)/6),s=0;s<=100;s+=20){s>0&&(o+=irand(-4,4),a-=i,n+=irand(-4,4),i=intval(.9*i)),r+=`\n          ${s}% {\n            transform: translate(${o}px, ${a}px) rotate(${n}deg) scale(${s?1:.7});\n            opacity: ${0==s||100==s?0:1};\n          }\n        `}var l="mv_chat_sticker_animation_"+Date.now()+"_"+irand(0,1e9);r=`@keyframes ${l} {${r}}`,e.appendChild(ce("style",{innerHTML:r}));var c=irand(1500,2500)+"ms",d=(t==vk.id?0:VideoChat._stickersDelay+=100)+"ms";setStyle(e,{animation:[l,c,d,"linear"].join(" ")})}function s(e){var t=e.currentTarget||e;(VideoChat._stickersBatch||(VideoChat._stickersBatch=document.createDocumentFragment())).appendChild(t),VideoChat._appendStickerTimeout||(VideoChat._appendStickerTimeout=setTimeout((function(){VideoChat.appendStickersBatch(),VideoChat._appendStickerTimeout=null}),0))}function l(e){var t=e.currentTarget||e;removeEvent(t),re(t)}},appendStickersBatch(){var e=VideoChat._stickersBatch;e&&(VideoChat._stickersBatch=null,VideoChat.isHidden()||VideoChat.stickersWrap.appendChild(e))},removeStickers(){if(VideoChat.stickersWrap)for(var e;e=domFC(VideoChat.stickersWrap);)removeEvent(e),re(e)},appendMessage(e,t){var r=VideoChat._messagesBatch||(VideoChat._messagesBatch=document.createDocumentFragment()),o="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;if(!VideoChat.messagesWrap.querySelector(o)&&!r.querySelector(o)){r.appendChild(se(e));for(var a=r.childNodes;r.childNodes.length>VideoChat.MAX_COMMENTS_NUM;)re(a[0]);VideoChat.isHidden()||VideoChat._appendMessageTimeout||(VideoChat._appendMessageTimeout=setTimeout((function(){VideoChat.appendMessagesBatch(),VideoChat._appendMessageTimeout=null}),0))}},appendMessagesBatch(){if(!VideoChat.isHidden()){var e=VideoChat._messagesBatch;if(e){VideoChat._messagesBatch=null;var t=geByClass("mv_chat_message_author_thumb_img",e,"img");each(t,(function(e,t){attr(t,"src")||attr(t,"src",domData(t,"src"))})),VideoChat.firstMsgIntro&&(re(VideoChat.firstMsgIntro),VideoChat.firstMsgIntro=null);var r=VideoChat.scroll.content;VideoChat.scroll.updateBelow((function(){r.appendChild(e)})),VideoChat.scroll.updateAbove((function(){for(var e=r.childNodes;e.length>VideoChat.MAX_COMMENTS_NUM;)re(e[0])})),VideoChat.scroll.data.scrollBottom>100&&VideoChat.toggleScrollBottomBtn(!0)}}},toggleScrollBottomBtn(e){toggleClass(this.scrollBottomBtnWrap,"hidden",!e)},scrollBottom(){VideoChat.scroll.scrollBottom(0)},replyAsAnimate(e,t,r){var o=e&&geByClass1("mv_chat_reply_author_photo",e),a=o&&geByClass("mv_chat_reply_author_photo_img",o),n=hasClass(e,"mv_chat_author_secondary")?0:1;a&&a[n]&&(a[n].src=r),toggleClass(e,"mv_chat_author_secondary")},replyAsGroup(e,t){window.replyAsList?VideoChat.replyAsGroupTT(e,t):(window.replyAsList=[],window.replyAsData={},domData(e,"can_reply_as_any_group")?ajax.post("/al_groups.php?act=get_editor_clubs",{},{cache:1,onDone:function(r){window.replyAsList=r,each(r,(function(e,t){var r=i(t,4),o=r[0];r[1],r[2],r[3];window.replyAsData[o]=this})),VideoChat.replyAsGroupTT(e,t)}}):VideoChat.replyAsGroupTT(e,t))},replyAsGroupList(e,t,r){var o=[r],a=domByClass(e,"mv_chat_reply_group_data");if(a){var n=[domData(a,"group_id"),domData(a,"group_photo"),domData(a,"group_href"),domData(a,"group_name")];o.push(n),window.replyAsData[n[0]]=n}return each(window.replyAsList,(function(e,r){var a=i(r,4),n=a[0];a[1],a[2],a[3];n!=t&&o.push(this)})),o},replyAsGroupOver(e){var t=gpeByClass("mv_chat_reply_form",e);(0,a.showTooltip)(e,{text:function(){return domData(t,"from-oid")<0?getLang("global_on_behalf_group"):getLang("global_on_behalf_me")},black:1,shift:[9,8,8]})},replyAsGroupTT(e,t){var r=VideoChat.replyAsProfileData(),a=gpeByClass("mv_chat_reply_form",e),n=a&&domData(a,"from-oid"),s=(0,o.data)(e,"tt");if(!r)return!1;if(!s){var l=VideoChat.replyAsGroupList(e,t,r),c="";each(l,(function(e,t){var r=i(t,4),o=r[0],a=r[1],s=r[2],l=r[3];c+=getTemplate("video_chat_message_author_select_row",{author_id:o,author_href:s,author_photo:a,author_name:l,classes:n==o?" active":""})})),s=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+c+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"top",offset:function(){return[0,-5]},onFirstTimeShow:function(t){var r=geByClass("post_from_tt_row",t);each(r,(function(t,r){addEvent(r,"click",VideoChat.setReplyAsGroup.pbind(e,{from:domData(this,"from-oid")}))})),this.rows=r,this.scroll=new uiScroll(geByClass1("_post_scroll_wrap",t)),setTimeout((function(){s.scroll.update(),s.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(s.scroll){var t=geByClass1("active",e),r=t?t.offsetTop-(s.scroll.data.viewportHeight-getSize(t)[1])/2:0;s.scroll.scrollTop(r)}}),0)},onHide:function(e){}}),(0,o.data)(e,"tt",s)}t&&s.isShown()&&VideoChat.setReplyAsGroup(e,{from:n==vk.id?t:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),s.isShown()||s.show()},replyAsProfileData:()=>window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData,setReplyAsGroup(e,t){if(!e)return!1;var r=domClosest("mv_chat_reply_form",e),a=(0,o.data)(e,"tt"),n=t.from||(t.fromGroup?cur.oid:vk.id),i=n==vk.id?VideoChat.replyAsProfileData():window.replyAsData&&window.replyAsData[n];return!(domData(r,"from-oid")==n||!i||i[0]!=n)&&(domData(r,"from-oid",n),VideoChat.replyAsAnimate(r,i[2],i[1]),a&&a.rows&&each(a.rows,(function(){toggleClass(this,"active",domData(this,"from-oid")==n)})),e.setAttribute("aria-label",getLang(n<0?"wall_reply_as_group":"wall_reply_as_user")),!1)},sendMessage(){if(!VideoChat.messageSending){var e={message:trim(Emoji.val(VideoChat.replyInput))};if(e.message){if(vkNow()-VideoChat.lastMsgSent<1e3)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),void(0,a.showTooltip)(VideoChat.replyInput,{text:getLang("video_live_chat_too_fast"),black:1});var t=Videoview.getMvData(),r=geByClass1("mv_chat_reply_form",this.block);r&&domData(r,"from-oid")&&(e.from_oid=domData(r,"from-oid")),ajax.post("al_video.php?act=post_comment",Wall.fixPostParams(extend(e,{video:t.videoRaw,hash:t.hash,videoviewer_chat:1})),{onDone:function(e,t){VideoChat.messageSending=!1,e&&t&&VideoChat.appendMessage(e,t),Emoji.val(VideoChat.replyInput,""),VideoChat.checkFormHeight(),VideoChat.scroll.data.scrollBottom&&VideoChat.scrollBottom(),VideoChat.lastMsgSent=vkNow(),mvcur.player&&mvcur.player.vars.stats_tmr&&(0,n.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onFail:function(e){if(VideoChat.messageSending=!1,VideoChat.replyInput)return window.tooltips&&tooltips.destroy(VideoChat.replyInput),(0,a.showTooltip)(VideoChat.replyInput,{text:e,showdt:200,forcetodown:0,slide:15,black:1}),elfocus(VideoChat.replyInput),!0}}),VideoChat.messageSending=!0}else elfocus(VideoChat.replyInput)}},sendSticker(e){var t=Videoview.getMvData();ajax.post("al_video.php?act=live_send_sticker",{sticker_id:e,owner_id:t.oid,video_id:t.vid,hash:t.hash},{onDone(){VideoChat.appendSticker(e,vk.id,!1)}})},deleteMessage(e,t){var r=ge("mv_chat_msg"+e);addClass(r,"_deleting"),ajax.post("al_video.php?act=delete_comment",{comment:e,hash:t,videoview_chat:1},{onDone(e){val(domByClass(r,"mv_chat_message_content"),e)}})},isHidden(){return!!this.hidden||Videoview.isMinimized()},setHidden(e){this.hidden=e},toggle(){var e=VideoChat.isHidden();this.setHidden(!e),VideoChat.toggleStateClasses(),e&&VideoChat.scroll&&(VideoChat.appendMessagesBatch(),VideoChat.updateScroll()),e||VideoChat.removeStickers()},toggleStateClasses(){var e=!!this.block,t=VideoChat.isHidden(),r=Videoview.isMinimized();toggleClass("mv_box","_has_chat",e&&!r),toggleClass("mv_box","_hide_chat",e&&!r&&t);var o="";e&&(VideoChat.appendMessagesBatch(),o=getLang(t?"video_aria_expand_chat":"video_aria_minimize_chat")),ge("mv_top_pl_toggle")&&attr("mv_top_pl_toggle","aria-label",o)},updateScroll(){VideoChat.scroll.update(),VideoChat.scroll.scrollBottom(),VideoChat.toggleScrollBottomBtn(!1)},onResize(){VideoChat.block&&(VideoChat._chatHeight=VideoChat.block.offsetHeight)},getHeight:()=>VideoChat.block?VideoChat._chatHeight||(VideoChat._chatHeight=VideoChat.block.offsetHeight):0,destroy(){if(VideoChat.block){if(VideoChat.scroll&&(VideoChat.scroll.destroy(),VideoChat.scroll=null),VideoChat.replyForm){var e=(0,o.data)(VideoChat.replyForm,"optId");void 0!==e&&Emoji.destroy(e),(0,o.removeData)(VideoChat.replyForm),(0,o.removeData)(VideoChat.replyInput),VideoChat.replyForm=VideoChat.replyInput=null}VideoChat.removeStickers(),(0,o.removeData)(VideoChat.block),re(VideoChat.block),VideoChat.block=null,VideoChat.messagesWrap=null,VideoChat.stickersWrap=null,VideoChat.options=null,clearTimeout(VideoChat._appendMessageTimeout),clearTimeout(VideoChat._appendStickerTimeout),VideoChat._appendMessageTimeout=null,VideoChat._appendStickerTimeout=null,VideoChat._messagesBatch=null,VideoChat.firstMsgIntro=null,VideoChat.messageSending=!1,VideoChat.toggleStateClasses()}}}},532453:(e,t,r)=>{"use strict";r.d(t,{parseReactWikiLinks:()=>n});var o=r(570655),a=r(667294);function n(e){var t=e.match(/\[(.*?)\]/g),r=t?t.map((function(e){return e.replace(/\[|(.*?)\]/g,"$1")})):[];if(!t||!r.length)return a.createElement(a.Fragment,null,e);var n=r.map((function(e,t){var r=(0,o.__read)(e.split("|"),2),n=r[0],i=r[1];return a.createElement("a",{href:n,key:t},i)})),i=[];return t.forEach((function(t,r){var o=e.indexOf(t);i.push(e.substr(0,o)),i.push(n[r]),e=e.slice(o+t.length)})),i.push(e),a.createElement(a.Fragment,null,i)}},129601:(e,t,r)=>{"use strict";r.d(t,{ReportReasonCategorySelector:()=>i});var o=r(570655),a=r(667294),n=r(540249),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.__extends)(t,e),t.prototype.renderCategory=function(e,t){var r=this;return a.createElement("div",{className:"ReportReasonCategorySelector__category",key:e.label,onClick:function(){return r.props.onCategorySelect(t)}},a.createElement("div",{className:"ReportReasonCategorySelector__categoryLabel"},e.label),a.createElement(n.default,{className:"ReportReasonCategorySelector__categoryArrow"}))},t.prototype.render=function(){var e=this;return a.createElement("div",{className:"ReportReasonCategorySelector"},this.props.categories.map((function(t,r){return e.renderCategory(t,r)})))},t}(a.Component)},623475:(e,t,r)=>{"use strict";r.d(t,{ReportReasonSelector:()=>s});var o=r(570655),a=r(667294),n=r(62738),i=r(659397),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.__extends)(t,e),t.prototype.renderReason=function(e){var t=this;return a.createElement(n.default,{className:"ReportReasonSelector__reason",key:e.id,checked:this.props.selectedReasonId===e.id,onChange:function(){return t.props.onReasonSelect(e)}},a.createElement("div",{className:"ReportReasonSelector__reasonInformation"},a.createElement("div",{className:"ReportReasonSelector__reasonLabel"},e.label),e.description&&a.createElement("div",{className:"ReportReasonSelector__reasonDescription"},e.description)))},t.prototype.render=function(){var e=this;return a.createElement("div",{className:(0,i.classNames)("ReportReasonSelector",this.props.className)},this.props.reasons.map((function(t){return e.renderReason(t)})))},t}(a.Component)},228314:(e,t,r)=>{"use strict";r.d(t,{ReportForm:()=>R});var o,a=r(570655),n=r(667294),i=r(40897),s=r(41437),l=r(148434),c=r(519921),d=r(492867),m=r(733024),p=r(225154),u=r(262643),h=r(532453),_=r(496495),g=r(423558),f=r(881150),v=r(595775),C=r(244809),y=r(996030),S=r(659397),b=r(129601),k=r(623475);!function(e){e.InitialLoading="initialLoading",e.ReportCategorySelection="reportCategorySelection",e.ReportComposition="reportComposition",e.AfterSubmit="afterSubmit",e.Error="error"}(o||(o={}));var R=function(e){function t(t){var r=e.call(this,t)||this,a={header:"",more:"",reason_categories:[],snippet:void 0,after_submit_actions:void 0,profiles:void 0,groups:void 0};return r.state={stage:o.InitialLoading,data:a,submitButtonLoading:!1,loadingAfterSubmitActions:{blacklist:!1},commentError:"",submitError:"",reasonCategoryId:void 0,reasonId:void 0,comment:""},r}return(0,a.__extends)(t,e),t.destroy=function(){(0,i.destroyComponentInBox)()},t.prototype.componentDidMount=function(){this.loadInitialData()},t.prototype.loadInitialData=function(){var e=this;(0,u.api)("reports.getReportFormData",{source:this.props.reportSource,source_owner_id:this.props.reportSourceOwnerId,source_id:this.props.reportSourceId,fields:"blacklisted_by_me,is_hidden_from_feed"}).then((function(t){return e.setState({stage:o.ReportCategorySelection,data:t})})).catch((function(){return e.switchToErrorStage("Load initial data promise rejected")}))},t.prototype.submit=function(){var e=this;this.isSubmitEnabled()?(this.setState({submitButtonLoading:!0,submitError:""}),(0,u.api)("reports.add",{type:this.props.reportSource,owner_id:this.props.reportSourceOwnerId,item_id:this.props.reportSourceId,reason:this.state.reasonId,comment:this.state.comment||void 0}).then((function(){e.setState({stage:o.AfterSubmit}),e.props.onSubmit&&e.props.onSubmit()})).catch((function(t){var r=t&&t.error&&t.error.error_text?t.error.error_text:(0,s.getLang)("global_unknown_error");e.setState({submitError:r}),(0,c.debugLog)("submit error happened",t)})).finally((function(){e.setState({submitButtonLoading:!1})}))):(0,c.debugLog)("Unable to submit form because submit is not enabled yet")},t.prototype.isSubmitEnabled=function(){var e;if(this.state.submitButtonLoading)return!1;if(void 0===this.state.reasonCategoryId)return!1;if(void 0===this.state.reasonId)return!1;var t=this.state.data.reason_categories[this.state.reasonCategoryId];if(null===(e=null==t?void 0:t.comment_field)||void 0===e?void 0:e.is_required){if(""===this.state.comment)return!1;if(""!==this.state.commentError)return!1}return!0},t.prototype.switchToErrorStage=function(e){(0,c.debugLog)("report form error: "+e),this.setState({stage:o.Error})},t.prototype.moveToPreviousStage=function(){this.state.submitButtonLoading?(0,c.debugLog)("Unable to move to previous stage if form submits something right now"):this.state.stage===o.ReportComposition?this.setState({stage:o.ReportCategorySelection,reasonCategoryId:void 0,reasonId:void 0,comment:"",commentError:"",submitError:""}):this.switchToErrorStage('Unable to move to previous stage from the current stage (not "report composition")')},t.isVkDomainLink=function(e){return null!==new RegExp("^(?:(?:http|https)://)?.*vk.com/.*$","g").exec(e)},t.parsePostLink=function(e){var t=new RegExp("^(?:(?:http|https)://)?.*vk.com/.*wall(-?\\d+)_(\\d+).*$","g").exec(e);return null===t?null:{ownerId:Number(t[1]),id:Number(t[2])}},t.shortenActionName=function(e){switch(e){case"blacklist":return"bl"}},t.prototype.getAfterSubmitAction=function(e){var r,o,a=this;if(null===(o=null===(r=this.state.data)||void 0===r?void 0:r.snippet)||void 0===o?void 0:o.author_id){var n=this.state.data.snippet.author_id,i=t.shortenActionName(e),l=(0,s.getLang)("reports_report_form_after_submit_action_"+i+"_perform"),d=(0,s.getLang)("reports_report_form_after_submit_action_"+i+"_performed");switch(e){case"blacklist":return{performLabel:l,performedLabel:d,isPerformed:function(){var e;return 1===(null===(e=a.state.data)||void 0===e?void 0:e.profiles)[0].blacklisted_by_me},perform:function(){return(0,u.api)("account.ban",{user_id:n})},cancel:function(){return(0,u.api)("account.unban",{user_id:n})},toggleStateAfterUpdate:function(){var e=a.state.data;e.profiles&&(e.profiles[0].blacklisted_by_me=e.profiles[0].blacklisted_by_me?0:1,a.setState({data:e}))}};default:return void(0,c.debugLog)("undefined after submit action name")}}},t.prototype.isAfterSubmitActionLoading=function(e){return this.state.loadingAfterSubmitActions[e]},t.prototype.updateAfterSubmitActionLoading=function(e,t){var r=this.state.loadingAfterSubmitActions;r[e]=t,this.setState({loadingAfterSubmitActions:r})},t.prototype.updateLinkComment=function(e){var r="";""!==e&&(t.isVkDomainLink(e)?null===t.parsePostLink(e)&&(r=(0,s.getLang)("reports_report_form_not_post_link")):r=(0,s.getLang)("reports_report_form_not_internal_link")),this.setState({comment:e,commentError:r})},t.prototype.selectReasonCategory=function(e){var t=this.state.data.reason_categories[e].reasons;this.setState({stage:o.ReportComposition,reasonCategoryId:e,reasonId:1===t.length?t[0].id:void 0})},t.prototype.selectReason=function(e){e.redirect_url?window.nav.go(e.redirect_url):this.setState({reasonId:e.id})},t.prototype.renderBottomButtons=function(){var e=this;return n.createElement("div",{className:"ReportForm__bottomButtons box_controls"},n.createElement(f.default,{appearance:"tertiary",className:"ReportForm__cancelButton",onClick:function(){return t.destroy()}},(0,s.getLang)("global_cancel")),n.createElement(g.default,{appearance:"primary",className:"ReportForm__submitButton",loading:this.state.submitButtonLoading,disabled:!this.isSubmitEnabled(),onClick:function(){return e.submit()}},(0,s.getLang)("reports_form_send_report")))},t.prototype.renderMoveBackHeader=function(){var e=this,r=n.createElement("div",{className:"ReportForm__headerMoveBackButton",onClick:function(){return e.moveToPreviousStage()}},n.createElement(d.default,{className:"ReportForm__headerMoveBackIcon"}),n.createElement("div",{className:"ReportForm__headerMoveBackLabel"},(0,s.getLang)("reports_report_form_get_back")));return t.renderHeader(r)},t.prototype.renderSingleReasonReasonsCategory=function(){if(void 0===this.state.reasonCategoryId)return t.renderErrorBlock();var e=this.state.data.reason_categories[this.state.reasonCategoryId];return e.comment_field?e.reasons[0].id===_.ReportReasonIds.NotOriginalContent?this.renderNotOriginalContentSubReasonBody():n.createElement("div",{className:"ReportForm__singleReasonTextWithComment"},n.createElement("div",{className:"ReportForm__singleReasonText"},e.reasons[0].description),this.renderComment()):n.createElement("div",{className:"ReportForm__singleReasonText"},e.reasons[0].description)},t.prototype.renderNotOriginalContentSubReasonBody=function(){var e=this;if(void 0===this.state.reasonCategoryId)return t.renderErrorBlock();var r=this.state.data.reason_categories[this.state.reasonCategoryId],o=this.state.commentError?this.state.commentError:r.reasons[0].description;return n.createElement("div",{className:(0,S.classNames)("ReportForm__singleReasonTextWithComment",{"ReportForm__singleReasonTextWithComment--error":!!this.state.commentError})},n.createElement(v.default,{className:"ReportForm__linkInput",onChange:function(t){return e.updateLinkComment(t.target.value)},value:this.state.comment,placeholder:(0,s.getLang)("reports_report_form_input_a_link")}),n.createElement("div",{className:"ReportForm__commentNotice"},o))},t.prototype.renderMultipleReasonsReasonCategory=function(){var e=this;if(void 0===this.state.reasonCategoryId)return t.renderErrorBlock();var r=this.state.data.reason_categories[this.state.reasonCategoryId];return n.createElement("div",null,n.createElement(k.ReportReasonSelector,{reasons:r.reasons,selectedReasonId:this.state.reasonId,onReasonSelect:function(t){return e.selectReason(t)}}),r.comment_field&&this.renderComment())},t.prototype.renderComment=function(){var e,r,o=this;if(void 0===this.state.reasonCategoryId)return t.renderErrorBlock();var a=this.state.data.reason_categories[this.state.reasonCategoryId];return n.createElement("div",{className:"ReportForm__singleReasonTextWithComment"},n.createElement("div",{className:"ReportForm__commentLabel"},n.createElement("div",{className:"ReportForm__commentMainText"},(0,s.getLang)("reports_report_form_comment")),!(null===(e=a.comment_field)||void 0===e?void 0:e.is_required)&&n.createElement("div",{className:"ReportForm__commentNotRequired"},"(",(0,s.getLang)("reports_report_form_comment_is_not_necessary"),")")),n.createElement(C.default,{className:"ReportForm__commentInput",onChange:function(e){return o.setState({comment:e.target.value})},placeholder:null===(r=a.comment_field)||void 0===r?void 0:r.placeholder,value:this.state.comment}))},t.prototype.renderAfterSubmitActions=function(){var e=this;if(!this.state.data.after_submit_actions)return"";var t=this.state.data.after_submit_actions.map((function(t){return e.renderAfterSubmitAction(t)})).filter((function(e){return""!==e}));return t&&0!==t.length?n.createElement("div",{className:"ReportForm__afterSubmitActionsBlock"},n.createElement("div",{className:"ReportForm__afterSubmitActionsLabel"},(0,s.getLang)("reports_report_form_additional_actions")),n.createElement("div",{className:"ReportForm__afterSubmitActions"},t)):""},t.prototype.renderAfterSubmitAction=function(e){var t=this,r=this.getAfterSubmitAction(e);if(!r)return"";var o=r.isPerformed()?r.performedLabel:r.performLabel;return n.createElement("div",{className:(0,S.classNames)("ReportForm__afterSubmitAction",{"ReportForm__afterSubmitAction--performed":r.isPerformed()}),key:e,onClick:function(){r.isPerformed()||t.isAfterSubmitActionLoading(e)||(t.updateAfterSubmitActionLoading(e,!0),r.perform().then((function(){return r.toggleStateAfterUpdate()})).catch((function(){return(0,c.debugLog)("Error happened in onPerformAction")})).finally((function(){return t.updateAfterSubmitActionLoading(e,!1)})))}},n.createElement("div",{className:"ReportForm__afterSubmitActionLabel"},o),r.isPerformed()&&n.createElement(n.Fragment,null,n.createElement("div",{className:"ReportForm__afterSubmitActionBeforeCancelSeparator"},"·"),n.createElement("div",{className:"ReportForm__cancelAfterSubmitActionButton",onClick:function(){r.isPerformed()&&(t.isAfterSubmitActionLoading(e)||(t.updateAfterSubmitActionLoading(e,!0),r.cancel().then((function(){return r.toggleStateAfterUpdate()})).catch((function(){return(0,c.debugLog)("Error happened in onCancelAction")})).finally((function(){return t.updateAfterSubmitActionLoading(e,!1)}))))}},"Отмена")))},t.renderHeader=function(e){return void 0===e&&(e=(0,s.getLang)("reports_report_form_header")),n.createElement("div",{className:"ReportForm__header box_title_wrap box_grey"},n.createElement("div",{className:"box_x_button",role:"button",onClick:function(){return t.destroy()}}),n.createElement("div",{className:"box_title"},e))},t.renderContent=function(e){return n.createElement("div",{className:"ReportForm__content box_body clear_fix"},e)},t.renderErrorBlock=function(){return n.createElement(n.Fragment,null,"error")},t.prototype.renderAfterSubmitStage=function(){var e=n.createElement(n.Fragment,null,n.createElement(m.default,{className:"ReportForm__afterSubmitCloseButton",onClick:function(){return t.destroy()}}),n.createElement(p.default,{className:"ReportForm__successfulSubmitIcon"}),n.createElement("div",{className:"ReportForm__thankYou"},(0,s.getLang)("reports_report_form_thank_you")),n.createElement("div",{className:"ReportForm__submitResultDescription"},(0,s.getLang)("reports_report_form_submit_result")),this.renderAfterSubmitActions());return n.createElement(n.Fragment,null,t.renderContent(e))},t.prototype.renderReportCompositionStage=function(){if(void 0===this.state.reasonCategoryId)return t.renderErrorBlock();var e=this.state.data.reason_categories[this.state.reasonCategoryId],r=n.createElement(n.Fragment,null,this.state.submitError&&n.createElement("div",{className:"ReportForm__submitError"},this.state.submitError),this.state.data.snippet&&n.createElement(y.ReportFormSnippet,{snippet:this.state.data.snippet}),n.createElement("div",{className:"ReportForm__categoryHeader"},e.explanation),1===e.reasons.length?this.renderSingleReasonReasonsCategory():this.renderMultipleReasonsReasonCategory(),e.more&&n.createElement("div",{className:"ReportForm__more"},(0,h.parseReactWikiLinks)(e.more)));return n.createElement(n.Fragment,null,this.renderMoveBackHeader(),t.renderContent(r),this.renderBottomButtons())},t.prototype.renderReportCategorySelectionStage=function(){var e=this,r=n.createElement(n.Fragment,null,this.state.data.snippet&&n.createElement(y.ReportFormSnippet,{snippet:this.state.data.snippet}),n.createElement("div",{className:"ReportForm__categorySelectionHeader"},this.state.data.header),n.createElement(b.ReportReasonCategorySelector,{categories:this.state.data.reason_categories,onCategorySelect:function(t){return e.selectReasonCategory(t)}}),n.createElement("div",{className:"ReportForm__more"},(0,h.parseReactWikiLinks)(this.state.data.more)));return n.createElement(n.Fragment,null,t.renderHeader(),t.renderContent(r))},t.renderErrorStage=function(){return n.createElement(n.Fragment,null,t.renderHeader(),t.renderContent((0,s.getLang)("reports_report_form_error")))},t.renderInitialLoadingStage=function(){return n.createElement(n.Fragment,null,t.renderHeader(),t.renderContent(n.createElement(l.default,null)))},t.prototype.render=function(){var e;switch(this.state.stage){case o.InitialLoading:e=t.renderInitialLoadingStage();break;case o.ReportCategorySelection:e=this.renderReportCategorySelectionStage();break;case o.ReportComposition:e=this.renderReportCompositionStage();break;case o.AfterSubmit:e=this.renderAfterSubmitStage();break;case o.Error:default:e=t.renderErrorStage()}return n.createElement("div",{className:(0,S.classNames)("ReportForm",{initialLoading:"ReportForm--initialLoadingStage",reportCategorySelection:"ReportForm--reportCategorySelectionStage",reportComposition:"ReportForm--reportCompositionStage",afterSubmit:"ReportForm--afterSubmitStage",error:"ReportForm--errorStage"}[this.state.stage])},e)},t}(n.Component)},996030:(e,t,r)=>{"use strict";r.d(t,{ReportFormSnippet:()=>w});var o=r(570655),a=r(667294),n=r(599149),i=r(458819),s=r(824245),l=r(182285),c=r(445098),d=r(784977),m=r(342577),p=r(586430),u=r(741774),h=r(663185),_=r(430811),g=r(739124),f=r(671539),v=r(665599),C=r(337227),y=r(317152),S=r(411415),b=r(532453),k=r(442699),R=r(116886),V=r(41437),E=r(659397),w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.__extends)(t,e),t.prototype.renderAttachmentPreview=function(){var e=this.props.snippet.attachment_preview;return e?0==e.sizes.length?this.renderDefaultReportFormAttachmentPreview():a.createElement("div",{className:"ReportFormSnippet__attachmentPreviewWrap"},a.createElement("img",{className:"ReportFormSnippet__attachmentPreview",src:e.sizes[0].url,alt:""}),e.can_play&&a.createElement(n.default,{className:"ReportFormSnippet__attachmentPreviewPlayButton"})):""},t.prototype.renderDefaultReportFormAttachmentPreview=function(){var e,t=this.props.snippet.attachment_preview;if(!t)return"";switch(t.type){case"app":e=i.default;break;case"article":e=s.default;break;case"audio":e=l.default;break;case"market":e=c.default;break;case"photo":e=d.default;break;case"album":e=m.default;break;case"video":e=p.default;break;case"poll":case"board_poll":e=u.default;break;case"story":e=h.default;break;case"narrative":e=_.default;break;case"live_comment":case"market_comment":case"photo_comment":case"topic_comment":case"comment":case"video_comment":case"wall_comment":e=g.default;break;case"post":case"situational_post":case"wall":e=f.default;break;case"textlive":case"textpost":e=v.default;break;case"link":e=C.default;break;case"sticker":e=y.default;break;default:e=S.default}return a.createElement("div",{className:"ReportFormSnippet__attachmentPreview ReportFormSnippet__attachmentPreview--default"},a.createElement(e,{className:"ReportFormSnippet__defaultAttachmentPreviewIcon"}))},t.prototype.renderNotContentSnippet=function(e,t){return a.createElement(a.Fragment,null,a.createElement("div",{className:"ReportFormSnippet__left"},a.createElement("div",{className:"ReportFormSnippet__name"},this.props.snippet.name),t),a.createElement("img",{className:"ReportFormSnippet__image",src:e,alt:"snippet_image"}))},t.prototype.renderContentSnippet=function(e,t){var r=(0,R.langDate)(1e3*this.props.snippet.date,(0,V.getLang)("global_short_date_time","raw"),0,(0,V.getLang)("months_sm_of","raw"));return a.createElement(a.Fragment,null,a.createElement("div",{className:"ReportFormSnippet__metaInfo"},a.createElement("img",{className:"ReportFormSnippet__authorAvatar",src:e,alt:"snippet_image"}),a.createElement("div",{className:"ReportFormSnippet__authorName"},this.props.snippet.name),a.createElement("div",{className:"ReportFormSnippet__date"},r)),a.createElement("div",{className:"ReportFormSnippet__content"},t,this.renderAttachmentPreview()))},t.prototype.render=function(){var e,t=a.createElement("div",{className:"ReportFormSnippet__text"},(0,b.parseReactWikiLinks)(this.props.snippet.text)),r=(0,k.isRetina)()?this.props.snippet.photo.big:this.props.snippet.photo.medium;e="content"===this.props.snippet.type?this.renderContentSnippet(r,t):this.renderNotContentSnippet(r,t);return a.createElement("div",{className:(0,E.classNames)("ReportFormSnippet",{user:"ReportFormSnippet--user",community:"ReportFormSnippet--community",app:"ReportFormSnippet--app",game:"ReportFormSnippet--game",content:"ReportFormSnippet--content"}[this.props.snippet.type])},e)},t}(a.Component)},496495:(e,t,r)=>{"use strict";r.d(t,{ReportReasonIds:()=>m,showReportForm:()=>u,afterCommentReportSubmit:()=>h});var o=r(228314),a=r(40897),n=r(667294),i=r(519921),s=r(116886),l=r(848366),c=r(262643),d=r(873050);(0,l.makeAuthAndApiGlobal)();var m,p=window.vk;function u(e,t,r,i,s){var l=n.createElement(o.ReportForm,{reportSource:e,reportSourceOwnerId:t,reportSourceId:r,onSubmit:i}),c={onDestroy:s};(0,a.showComponentInBox)(l,c)}function h(e,t,r){var o=function(e,t,r){switch(e){case"photo":return"#post"+t+"photo_"+r;case"video":return"#post"+t+"video_"+r+"mv";case"market":return"#post"+t+"market_"+r}}(e,t,r);if("photo"===e){var a=document.querySelector(o+" .dld");null!==a&&(a.outerHTML="")}var n=document.querySelector(o+" .reply_wrap");null!==n?(n.style.display="none",n.outerHTML+='<div class="dld">'+(0,s.getLang)("global_report_sent")+"</div>"):(0,i.debugLog)("Unable to hide report button for "+e+" comment")}(0,c.setLoginConfig)({onCaptcha:d.handleCaptcha,domain:p.apiConfigDomains.loginDomain}),(0,c.setApiConfig)({onCaptcha:d.handleCaptcha,domain:p.apiConfigDomains.apiDomain}),function(e){e[e.NotOriginalContent=28]="NotOriginalContent"}(m||(m={}))}}]);try{stManager.done("dist/bfa355898dee279b43b6cbf7c4894208.89de8cc3809c3f08921b.js")}catch(e){}