(()=>{var e,t,a,n={520797:e=>{e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%"%attrs%>\n  <span>%label%</span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<span class="ui_rmenu_count im-right-menu--count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button><span class="im-right-menu--text _im_r_tx">%name%</span>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',sImDialogImRowPhoto:'<div class="im_grid">%photo%</div>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',sImContactAvatar:' <div class="ContactAvatar ContactAvatar--%size% %classes%">%name%</div>',sImUserAvatar:'<div class="ImUserAvatar _online %online_class% %classes%"> <img src="%src%" class="ImUserAvatar__img" alt=""> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> <span class="im-page--title-main-donut _im_chat_donut"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> %more_children%</div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',sImSimpleNameBusinessNotifyLabel:'<span class="im-page--title-main-business-notify _im_chat_business_notify">%text%</span>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> %msg%</li>',im_dialogs_all_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-message-requests-button _im_toggle_all_tab" data-list-id="all"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 010 1.06L7.8 10l4.72 4.72a.75.75 0 11-1.06 1.06l-5.25-5.25a.75.75 0 010-1.06l5.25-5.25a.75.75 0 011.05 0z" fill="currentColor"/></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--counter"></span> </li>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="message_request_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2C4.44 2 1.5 4.52 1.5 7.75c0 1.09.34 2.12.95 3.02-.09.4-.36 1.04-.82 1.87-.3.55-.07 1.21.46 1.49.17.08.36.12.54.12A5.5 5.5 0 006 13.23a7.4 7.4 0 002 .28c3.56 0 6.5-2.52 6.5-5.76C14.5 4.52 11.56 2 8 2zm0 1.5c-2.92 0-5 2.02-5 4.25 0 .8.25 1.55.73 2.22l.13.19a.75.75 0 01.13.57l-.04.23a7.08 7.08 0 01-.65 1.74c.87-.1 1.44-.36 1.8-.66l.23-.21a.75.75 0 01.7-.15l.31.1c.52.15 1.08.23 1.66.23 2.92 0 5-2.02 5-4.26 0-2.23-2.08-4.25-5-4.25z" fill="currentColor"/><path d="M16.16 8.57a.75.75 0 111.18-.91A5.46 5.46 0 0118.5 11a5.42 5.42 0 01-.91 3.01c.08.41.34 1.05.78 1.9a1.09 1.09 0 01-.99 1.59 5.18 5.18 0 01-3.23-1.01 6.8 6.8 0 01-1.9.27 6.73 6.73 0 01-2.57-.5.75.75 0 01.57-1.39 5.22 5.22 0 003.57.15l.3-.09a.75.75 0 01.71.16l.23.2c.33.3.85.54 1.66.65a7.34 7.34 0 01-.63-1.74l-.04-.23a.75.75 0 01.12-.55l.13-.19A3.92 3.92 0 0017 11c0-.9-.3-1.73-.84-2.43z" fill="currentColor"/></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> </li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice"> %msg% </div> </li>',im_dialogs_business_notify_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-business-notify-button _im_toggle_business_notify_tab %class_name%" data-list-id="business_notify_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 01-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 01-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8zM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 00-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 00-.33-.33c-.2-.1-.39-.15-.98-.16zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 00-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 00-.1-.63l-.06-.1a.77.77 0 00-.33-.33l-.1-.05a2.6 2.6 0 00-.94-.1z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 111.06 1.06L11.06 10l4.22 4.22a.75.75 0 11-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 01-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 010-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',sImBusinessNotifyDisableBoxContent:'<div class="im_bussiness_notify_disable_box"> <div class="im_bussiness_notify_disable_box_text"> %text% </div> </div>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody%</span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd %modifier%"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%text%</span> <span class="im-fwd--date">%date%</span></span> <span class="im-fwd--close _im_fwd_close"></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> <a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a> </div> </div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 00-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 101.07 1.07L6 7.06l2.47 2.48a.75.75 0 001.07-1.07L7.06 6l2.48-2.47a.75.75 0 10-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 010 1.06l-6 6a.75.75 0 01-1.06 0l-2.5-2.5a.75.75 0 011.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 011.06 0zm4.25 0a.75.75 0 010 1.06l-6 6a.75.75 0 11-1.06-1.06l6-6a.75.75 0 011.06 0z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59L2.96 8.04a1 1 0 00-1.42 1.42L3.8 11.7a1 1 0 001.42 0l5.25-5.25a1 1 0 00-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><linearGradient id="star_circle_fill_yellow_12__a" gradientUnits="userSpaceOnUse" x1="-6" x2="6" y1="6" y2="18"><stop offset="0" stop-color="#ffb73d"/><stop offset="1" stop-color="#ffa000"/></linearGradient><g clip-rule="evenodd" fill-rule="evenodd"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm.11 2.6a.25.25 0 00-.33.1l-.96 1.93-2.12.31a.25.25 0 00-.14.43l1.54 1.5-.37 2.12a.25.25 0 00.37.26l1.9-1 1.9 1a.25.25 0 00.37-.26L7.9 6.87l1.54-1.5a.25.25 0 00-.14-.43l-2.12-.3-.96-1.94a.25.25 0 00-.1-.1z" fill="url(#star_circle_fill_yellow_12__a)"/><path d="M6.11 2.6a.25.25 0 00-.33.1l-.96 1.93-2.12.31a.25.25 0 00-.14.43l1.54 1.5-.37 2.12a.25.25 0 00.37.26l1.9-1 1.9 1a.25.25 0 00.37-.26L7.9 6.87l1.54-1.5a.25.25 0 00-.14-.43l-2.12-.3-.96-1.94a.25.25 0 00-.1-.1z" fill="#fff"/></g></svg></span> <span class="nim-dialog--mute"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g id="muted_16__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="muted_16__muted_16"><path id="muted_16__Mask" d="M0 0h16v16H0z"/><path d="M7.66 4.84L10.5 2.5c.27 0 .49.21.49.48v5.2l2.6 2.6a.75.75 0 11-1.06 1.06L4.4 3.71a.75.75 0 111.06-1.06l2.2 2.2zm-2.97.66L11 11.8v1.7c0 .28-.22.5-.49.5l-3.63-3.5H4a1 1 0 01-1-1v-3a1 1 0 011-1h.69z" id="muted_16__Mask" fill="currentColor"/></g></g></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.84 1.49a.6.6 0 10-1.18.22l.15.8a.6.6 0 001.18-.22l-.15-.8zm2.38.29a.6.6 0 010 .84l-.6.6a.6.6 0 01-.84-.84l.6-.6a.6.6 0 01.84 0z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7.82 4.17a.6.6 0 010 .85l-.46.47a3.5 3.5 0 11-.84-.85l.45-.46a.6.6 0 01.85 0zM6.8 7.5a2.3 2.3 0 11-4.6 0 2.3 2.3 0 014.6 0z" fill="currentColor"/><path d="M10.99 4.86a.6.6 0 01-.7.48l-.8-.15a.6.6 0 01.22-1.18l.8.15a.6.6 0 01.48.7z" fill="currentColor"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 00-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 101.07 1.07L6 7.06l2.47 2.48a.75.75 0 001.07-1.07L7.06 6l2.48-2.47a.75.75 0 10-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><linearGradient id="star_circle_fill_yellow_12__a" gradientUnits="userSpaceOnUse" x1="-6" x2="6" y1="6" y2="18"><stop offset="0" stop-color="#ffb73d"/><stop offset="1" stop-color="#ffa000"/></linearGradient><g clip-rule="evenodd" fill-rule="evenodd"><path d="M6 0a6 6 0 110 12A6 6 0 016 0zm.11 2.6a.25.25 0 00-.33.1l-.96 1.93-2.12.31a.25.25 0 00-.14.43l1.54 1.5-.37 2.12a.25.25 0 00.37.26l1.9-1 1.9 1a.25.25 0 00.37-.26L7.9 6.87l1.54-1.5a.25.25 0 00-.14-.43l-2.12-.3-.96-1.94a.25.25 0 00-.1-.1z" fill="url(#star_circle_fill_yellow_12__a)"/><path d="M6.11 2.6a.25.25 0 00-.33.1l-.96 1.93-2.12.31a.25.25 0 00-.14.43l1.54 1.5-.37 2.12a.25.25 0 00.37.26l1.9-1 1.9 1a.25.25 0 00.37-.26L7.9 6.87l1.54-1.5a.25.25 0 00-.14-.43l-2.12-.3-.96-1.94a.25.25 0 00-.1-.1z" fill="#fff"/></g></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.84 1.49a.6.6 0 10-1.18.22l.15.8a.6.6 0 001.18-.22l-.15-.8zm2.38.29a.6.6 0 010 .84l-.6.6a.6.6 0 01-.84-.84l.6-.6a.6.6 0 01.84 0z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7.82 4.17a.6.6 0 010 .85l-.46.47a3.5 3.5 0 11-.84-.85l.45-.46a.6.6 0 01.85 0zM6.8 7.5a2.3 2.3 0 11-4.6 0 2.3 2.3 0 014.6 0z" fill="currentColor"/><path d="M10.99 4.86a.6.6 0 01-.7.48l-.8-.15a.6.6 0 01.22-1.18l.8.15a.6.6 0 01.48.7z" fill="currentColor"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M7.97 13.13a.85.85 0 01-1.4.64L1.35 9.24a1 1 0 010-1.5L6.57 3.2a.85.85 0 011.4.64v2.39a7 7 0 017 7v.01a10.95 10.95 0 00-7-2.51z" fill="currentColor" fill-rule="evenodd"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M7.97 13.13a.85.85 0 01-1.4.64L1.35 9.24a1 1 0 010-1.5L6.57 3.2a.85.85 0 011.4.64v2.39a7 7 0 017 7v.01a10.95 10.95 0 00-7-2.51z" fill="currentColor" fill-rule="evenodd"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.2 5.68l2.92.28c1.01.1 1.32 1.1.54 1.75l-2.28 1.91.84 3.11c.28 1.02-.58 1.64-1.45 1.03L8 11.78l-2.77 1.98c-.86.6-1.73 0-1.45-1.03l.85-3.11-2.29-1.9c-.78-.67-.47-1.66.55-1.76l2.91-.28L7.08 2.7c.4-.93 1.44-.93 1.84 0l1.28 2.98z" fill="currentColor"/></svg></span> </div> <div class="im-mess--check fl_l"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 15A7 7 0 118 1a7 7 0 010 14zM6 7.94a.75.75 0 10-1 1.12l1.46 1.3c.44.38 1.1.33 1.49-.1l.04-.05 2.9-3.75a.75.75 0 10-1.19-.92L7.1 8.91 6 7.94z"/></svg></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g id="cancel_16__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="cancel_16__cancel_16"><path id="cancel_16__Rectangle" d="M0 0h16v16H0z"/><path d="M8 6.73l3.46-3.47a.9.9 0 111.28 1.28L9.27 8l3.47 3.46a.9.9 0 11-1.28 1.28L8 9.27l-3.46 3.47a.9.9 0 11-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 011.28-1.28L8 6.73z" id="cancel_16__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<button class="_im_peer_mute_unmute im-chat-input-block-control im-chat-input-block-control--with-icon im-chat-input-block-control--%type%">%text%</button>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<button class="_im_peer_return_to_chat im-chat-input-block-control">%text%</button>',sImCallSnippet:'<article class="CallSnippet %classes%" %attributes%> <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:' <span class="MessageKeyboard__cell"> <%tagName% class="MessageKeyboard__button MessageKeyboard__button--%modifier% Button Button--size-s Button--%appearance% _im_mess_btn" %attributes% > <span class="MessageKeyboard__label">%label%</span> </%tagName%> </span>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message " data-last-msgid="%id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sUiActionsMenuSeparator:'<div class="ui_actions_menu_sep"></div>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem _im_dialog_peer_tag" data-id="%tag_id%" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>'},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImPeerTagsFilterItem:'<div class="PeerTagsFilterItem"> <input class="PeerTagsFilterItem__checkbox _im_peer_tags_filter_checkbox" type="checkbox" id="peer_tag_%tag_id%" %checked%> <label class="PeerTagsFilterItem__label" for="peer_tag_%tag_id%"> <span class="PeerTagsFilterItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterItem__name">%name%</span> <span class="PeerTagsFilterItem__count">%count%</span> </label> </div>',sImPeerTagsFilterPaneItem:'<div class="PeerTagsFilterPaneItem _im_peer_tags_filter_pane_item" data-id="%tag_id%"> <span class="PeerTagsFilterPaneItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterPaneItem__name">%name%</span> <span class="PeerTagsFilterPaneItem__remove"></span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:function(){return'<button class="FlatButton FlatButton--secondary FlatButton--size-s CallBanner__button _im_call_banner_join_btn _im_top_banner_button" type="button" data-link="%call_link%">\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">\n      '+getLang("mail_join_chat")+"\n    </span>\n    \n  </span>\n</button>"},sImCarousel:'<div class="Carousel _im_carousel" data-scroll-count="%scroll_count%"> <button class="Carousel__control Carousel__control--prev Carousel__control--hidden _im_carousel_control _im_carousel_control_left %controls_class%" data-direction="-1"><svg fill="none" height="16" viewBox="0 0 12 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M4.77 8l3.37 3.36a.9.9 0 11-1.28 1.28l-4-4a.9.9 0 010-1.28l4-4a.9.9 0 111.28 1.28z" fill="currentColor"/></svg></button> <button class="Carousel__control Carousel__control--next _im_carousel_control _im_carousel_control_right %controls_class%" data-direction="1"><svg width="12" height="16" viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg"><g id="chevron_16__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="chevron_16__chevron_16"><path id="chevron_16__Bounds" d="M0 0h12v16H0z"/><path d="M7.23 8L3.86 4.64a.9.9 0 111.28-1.28l4 4a.9.9 0 010 1.28l-4 4a.9.9 0 11-1.28-1.28L7.23 8z" id="chevron_16__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg></button> <div class="Carousel__viewport _im_carousel_viewport"> <div class="Carousel__layer _im_carousel_layer"> %content% </div> </div> </div>',sImBotCarousel:'<div class="BotCarousel _im_bot_carousel _im_bot_carousel_%msg_id%"> %content%</div>',sImBotCarouselSlide:'<div class="BotCarousel__slide" data-index="%index%">%content%</div>',sImBotCarouselSlideTitle:'<div class="BotCarousel__slideTitle">%content%</div>',sImBotCarouselSlideDescription:'<div class="BotCarousel__slideDescription">%content%</div>',sImBotCarouselSlideContent:'<div class="BotCarousel__slideContent">%content%</div>',sImBotCarouselSlideLinkWrapper:'<a href="%url%" class="BotCarousel__slideLinkWrapper" target="_blank" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhotoLinkWrapper:'<a href="#" class="BotCarousel__slideLinkWrapper" onclick="return showPhoto(\'%photo_id%\', \'mail%msg_id%\', {}, event)" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhoto:"<img class=\"BotCarousel__slideImage\" src='%url%' alt='%alt%' />",sImBotCarouselSlideButtons:'<div class="BotCarousel__slideButtons">%content%</div>',sImBotCarouselSlideButton:' <%tag_name% class="BotCarousel__slideButton BotCarousel__slideButton--%modifier% Button Button--size-m Button--wide Button--overflow Button--%appearance% _im_mess_btn" %attributes% > <span class="BotCarousel__slideButtonLabel"> %label% </span> </%tag_name%>',sImConvoRecommendListUser:function(){return'<li class="ConvoRecommendList__item"> <a href="%link%" class="ConvoRecommendList__button _im_dialog _convoRecommendUser" data-peer="%id%" data-position="%position%"> <div class="ConvoRecommendList__avatar"> %photo% <button class="ConvoRecommendList__removeItem _convoRecommendUserRemove" aria-label="'+getLang("mail_recommend_block_remove_item")+'"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 00-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 101.07 1.07L6 7.06l2.47 2.48a.75.75 0 001.07-1.07L7.06 6l2.48-2.47a.75.75 0 10-1.07-1.07L6 4.94z" fill="currentColor"/></svg> </button> </div> <span class="ConvoRecommendList__name">%name%</span> </a> </li>'},sImConvoRecommendListButton:'<li class="ConvoRecommendList__item"> <%tag_name% %attributes% class="ConvoRecommendList__button %classes%"> <span class="ConvoRecommendList__avatar ConvoRecommendList__icon" aria-hidden="true"> %icon% </span> <span class="ConvoRecommendList__name">%title%</span> </%tag_name%> </li>',sImConvoRecommendList:'<ul class="ConvoRecommendList" data-list-id="recommend_list"> %list_content%</ul>',sImEmptyDialogStub:' <div class="EmptyDialogStub %classes%"> <div class="EmptyDialogStub__main"> <div class="EmptyDialogStub__avatar">%avatar%</div> <div class="EmptyDialogStub__name">%name%</div> <div class="EmptyDialogStub__savedAs">%saved_as%</div> <div class="EmptyDialogStub__description">%stub_text%</div> </div> %secondary_block% </div> <div class="_im_stickers_panel_placeholder"></div>',sImEmptyDialogStubUserInfo:function(){return' <div class="EmptyDialogStub__secondary"> <div class="EmptyDialogStub__additional"> <div class="EmptyDialogStub__additionalIcon">%additional_icon%</div> %additional_info% </div> %mutual_friends% <div class="EmptyDialogStub__actions"> %subscribe_button% <a class="FlatButton FlatButton--secondary FlatButton--size-m" draggable="false" href="%profile_href%"> <span class="FlatButton__in"> <span class="FlatButton__content"> '+getLang("mail_view_profile")+" </span> </span> </a> </div> </div>"},sImEmptyDialogStubSubscribeButton:'<button class="FlatButton FlatButton--primary FlatButton--size-m _im_add_to_friends" type="button">\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">\n      %button_text%\n    </span>\n    \n  </span>\n</button>',sImEmptyDialogStubMutualFriends:' <div class="EmptyDialogStub__mutualFriends"> <div class="EmptyDialogStub__mutualFriendsPhotos">%friends%</div> <div class="EmptyDialogStub__mutualFriendsCount">%text%</div> </div>',sImEmptyDialogStubMutualFriend:' <img src="%src%" class="EmptyDialogStub__mutualFriendPhoto" alt="%name%" />',sImEmptyDialogStickers:'<div class="EmptyDialogStickers"> %content%</div>',sImEmptyDialogSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogAnimatedSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animation_url%"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>'}},9236:(e,t,a)=>{"use strict";function n(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M10.1 1.78c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17C9.15 3.33 9 3.6 9 4a1 1 0 002 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/><path clip-rule="evenodd" d="M17.29 11.7c-.22.3-.49.53-.79.7v.68c0 .53 0 .98-.03 1.34-.03.38-.1.74-.27 1.08-.26.52-.68.94-1.2 1.2-.34.17-.7.24-1.08.27-.36.03-.8.03-1.34.03H7.42c-.53 0-.98 0-1.34-.03-.38-.03-.74-.1-1.08-.27a2.75 2.75 0 01-1.2-1.2 2.8 2.8 0 01-.27-1.08c-.03-.36-.03-.8-.03-1.34v-.69a2.5 2.5 0 01-.79-.69A4.45 4.45 0 012 9h.75H2v-.02a1.42 1.42 0 010-.12 2.44 2.44 0 01.4-1.14C2.83 7.05 3.64 6.5 5 6.5h10c1.36 0 2.17.55 2.6 1.22a2.58 2.58 0 01.4 1.26v.01c0 1.08-.2 2.02-.71 2.71zM3.5 9.01c0 .92.18 1.48.41 1.79.2.27.52.45 1.09.45.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.57 0 .88-.18 1.09-.45.23-.31.4-.87.41-1.79v-.02c0-.02 0-.06-.02-.1-.02-.1-.06-.24-.14-.36C16.2 8.33 15.89 8 15 8H5c-.9 0-1.2.33-1.34.53a1.08 1.08 0 00-.16.48zM17.25 9H18zm-4.4 2.78c.43.44 1.11.97 2.15.97v.3c0 .57 0 .96-.02 1.25-.03.29-.07.43-.12.52-.12.23-.3.42-.54.54-.1.05-.23.1-.52.12-.3.02-.68.02-1.25.02h-5.1c-.57 0-.96 0-1.25-.02a1.36 1.36 0 01-.52-.12 1.25 1.25 0 01-.54-.54c-.05-.1-.1-.23-.12-.52C5 14 5 13.62 5 13.05v-.3c1.04 0 1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3c.44.44 1.12.97 2.16.97s1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3z" fill-rule="evenodd"/><path d="M6.4 1.78c.03-.09.17-.09.2 0 .2.54.4.9.55 1.17.2.38.35.64.35 1.05a1 1 0 01-2 0c0-.41.14-.67.35-1.05.16-.28.35-.63.55-1.17zM13.6 1.78c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17-.2.38-.35.64-.35 1.05a1 1 0 102 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/></g></svg>',name:"cake_outline_20"}}a.d(t,{getIcon20CakeOutline:()=>n})},413336:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="education_outline_20__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="education_outline_20__education_outline_20"><path id="education_outline_20__Bounds" d="M0 0h20v20H0z"/><path d="M17.5 9.06L16 9.9V13c0 2.8-2.72 5-6 5s-6-2.2-6-5V9.89l-2.35-1.3a1.25 1.25 0 010-2.19L9.4 2.15c.37-.2.83-.2 1.2 0l7.75 4.25c.42.24.66.68.65 1.13v5.22a.75.75 0 11-1.5 0V9.06zm-3 1.65l-3.9 2.14c-.37.2-.83.2-1.2 0L5.5 10.7V13c0 1.9 1.98 3.5 4.5 3.5s4.5-1.6 4.5-3.5v-2.3zM10 3.54L2.77 7.5 10 11.46l7.23-3.96L10 3.54z" id="education_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"education_outline_20"}}a.d(t,{getIcon20EducationOutline:()=>n})},214390:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="home_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="home_outline_20__Icons-20/home_outline_20"><g id="home_outline_20__home_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M3 11h-.04l-.18-.01A2.04 2.04 0 011.67 7.4L8.2 1.8a2.75 2.75 0 013.58 0l6.54 5.6A2.04 2.04 0 0117 11v4.25c0 1.24-1 2.25-2.25 2.25h-2.8a.95.95 0 01-.95-.95V13.5a1 1 0 00-2 0v3.05c0 .52-.43.95-.95.95h-2.8c-1.24 0-2.25-1-2.25-2.25V11zm11.75 5c.41 0 .75-.34.75-.75v-4.9c0-.47.38-.85.85-.85H17a.54.54 0 00.35-.96l-6.54-5.6c-.46-.4-1.16-.4-1.62 0l-6.54 5.6a.54.54 0 00-.06.77c.09.1.21.17.31.18l.1.01h.65c.47 0 .85.38.85.85v4.9c0 .41.34.75.75.75H7.5v-2.5a2.5 2.5 0 115 0V16h2.25z" id="home_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"home_outline_20"}}a.d(t,{getIcon20HomeOutline:()=>n})},453911:(e,t,a)=>{"use strict";function n(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 01-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 01-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8zM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 00-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 00-.33-.33c-.2-.1-.39-.15-.98-.16zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 00-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 00-.1-.63l-.06-.1a.77.77 0 00-.33-.33l-.1-.05a2.6 2.6 0 00-.94-.1z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"work_outline_20"}}a.d(t,{getIcon20WorkOutline:()=>n})},472864:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var n=a(970793),i=a(736557),r=a(889854),s=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function l(e,t,a){(0,i.isMvk)()?window.addEvent(e,t,a,{passive:!0}):window.addEvent(e,t,a)}function c(e,t,a){(0,i.isMvk)()?window.removeEvent(e,t,a,{passive:!0}):window.removeEvent(e,t,a)}function d(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,n.default.prototype),extend(o.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),(0,i.isMvk)()&&this._isTopLevel()&&u()&&c(document,u(),this.onVisiblityChange),(0,i.isMvk)()&&s||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!(0,i.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),(0,i.isMvk)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),(0,i.isMvk)()&&s||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(r.screenWakeLocker.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===d()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=d();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},629442:(e,t,a)=>{"use strict";a.d(t,{random:()=>n});a(781303);function n(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return intval(rand(0,2147483647).toFixed(0))}},940543:(e,t,a)=>{"use strict";a.d(t,{screenfull:()=>n});var n=function(){var e=function(){for(var e,t,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,i=a.length,r={};n<i;n++)if((e=a[n])&&e[1]in document){for(n=0,t=e.length;n<t;n++)r[a[0][n]]=e[n];return r}return!1}(),t={request:function(t){var a=e.requestFullscreen;(t=t||document.documentElement)[a]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}()},865192:(e,t,a)=>{"use strict";a.d(t,{initFailBack:()=>n});a(940851),a(296253);function n(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia;e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(t){return new Promise((function(a,n){e?e.call(navigator,t,a,n):n(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var a={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}},880074:(e,t,a)=>{"use strict";a.d(t,{default:()=>_});a(175115),a(95767),a(991181),a(296253),a(751876);var n=a(667294),i=a(881150),r=a(802955),s=a(791563),o=a(917685),l=(a(45697),a(987105)),c=a(351117),d=a(992665);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}class m extends n.Component{constructor(e){super(e),this.onLinkClick=e=>{var t=this.props.action.link;if(/^https:\/\/(.+\.)?vk\.com\/gifts580392144\?act=send&ref=[^&]+$/.test(t))return(0,s.showBox)("al_gifts.php",{act:"get_gift_box",mid:580392144,fr:0,ref:t.split("&ref=")[1]},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),(0,o.cancelEvent)(e)},this.onButtonClick=()=>{var e=this.props,t=e.action,a=e.sendMessage,n=e.appHash,i=e.keyboardAuthorId,r=e.store,s=(0,c.getCurrentTab)(r);if(s)return(0,l.handleButtonClick)(t,a,r,{keyboardAuthorId:i,appHash:n,peerId:s.peerId,onBeforeSend:this.onBeforeCallbackActionSend,onSendSuccess:e=>{this.onCallbackActionSendSuccess(r,s.peerId,e)},onSendFail:this.onCallbackActionSendFail})},this.onBeforeCallbackActionSend=()=>{this.setState({isLoading:!0})},this.onCallbackActionSendSuccess=(e,t,a)=>{var n=()=>{this.setState({callbackTimeout:void 0,isLoading:!1})},i=setTimeout(n,l.CALLBACK_TIMEOUT_MS),r={timeout:i,onCallback:n};e.set((e=>(0,d.setPressedCallbackButton)({peerId:t,eventId:a},r,e))),this.setState({isLoading:!0,callbackTimeout:i})},this.onCallbackActionSendFail=()=>{this.setState({isLoading:!1})},this.state={isLoading:!1,callbackTimeout:void 0}}componentWillUnmount(){this.state.callbackTimeout&&clearTimeout(this.state.callbackTimeout)}render(){var e=this.props,t=e.action,a=(e.sendMessage,e.appHash,e.keyboardAuthorId,g(e,["action","sendMessage","appHash","keyboardAuthorId"])),r=(0,l.getButtonAppearance)(this.props),s=(0,l.getButtonLabel)(this.props),o=t.type,c=n.createElement(i.default,u({wide:!0,overflow:!0},a,{type:t.type,appearance:r,className:`BotButton BotButton--${o} ${this.state.isLoading?"BotButton--isLoading":""}`,onClick:this.onButtonClick}),n.createElement("span",{className:"BotButtonLabel Button--overflow",dangerouslySetInnerHTML:{__html:s}}));switch(t.type){case l.BUTTON_TYPE_OPEN_LINK:return this.wrapLinkButton(c);default:return c}}wrapLinkButton(e){var t=this.props.action,a=(0,r.wrapAwayIfExternal)(t.link,!0);return n.createElement("a",{href:a,className:"Keyboard__buttonWrapper",target:"_blank",rel:"nofollow noopener",onClick:this.onLinkClick},e)}}m.defaultProps={color:l.BUTTON_COLOR_DEFAULT};const _=m},125462:(e,t,a)=>{"use strict";a.d(t,{default:()=>d});var n=a(667294),i=a(172237),r=a(800234),s=a(121265),o=a(929566),l=a(880074);class c extends n.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props.store,t=this.props.send,a=e.get(),r=(0,o.getCurrentKeyboard)(e),d=a.keyboard_app_hash;return r&&r.buttons?n.createElement("div",{className:(0,s.classNames)("Keyboard",{"Keyboard--hidden":r.hide})},n.createElement(i.Scroll,{className:"Keyboard__scroll-wrapper"},n.createElement("div",{className:"Keyboard__container"},r.buttons.map(((a,i)=>n.createElement("div",{key:`row-${i}`,className:"Keyboard__row"},a.map(((i,s)=>n.createElement("div",{className:"Keyboard__button",key:`cell-${s}`,style:{width:c.getButtonWidth(a.length)}},n.createElement(l.default,{sendMessage:t,appHash:d,keyboardAuthorId:r.author_id,action:i.action,type:i.action.type,color:i.color,store:e})))))))))):null}}const d=(0,r.connect)(c)},566700:(e,t,a)=>{"use strict";a.d(t,{default:()=>u});var n=a(667294),i=(a(45697),a(172237)),r=a(41437),s=a(800234),o=a(856612),l=a(121265),c=r.default.getLang;class d extends n.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,a=e.showSettingsPopup,r=e.showCreatingTemplatePopup,s=e.isNeededRendering,d=this.state.isShowDropDown;if(!s())return null;var u=t();return n.createElement("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1)},n.createElement("div",{className:(0,l.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":d}),"aria-hidden":d},n.createElement("div",{className:"TemplatesDropDown__container"},n.createElement(i.Scroll,{className:"TemplatesDropDown__scroll-wrapper"},n.createElement("div",null," ",n.createElement("header",{className:"TemplatesDropDown__header"},n.createElement("h2",{className:"TemplatesDropDown__title"},c("mail_community_templates")),n.createElement("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:a},c("mail_settings_configure"))),u.length?n.createElement("ul",{className:"TemplatesDropDown__list"},u.map((e=>n.createElement("li",{key:e.id,className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id)},n.createElement("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),n.createElement("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}}))))):n.createElement("div",{className:"TemplatesDropDown__not-found-container"},n.createElement("span",null,c("mail_community_templates_not_found")),n.createElement(o.default,{onClick:r},c("mail_add_community_template"))))))),n.createElement("button",{className:"TemplatesDropDown__icon"}))}}const u=(0,s.connect)(d)},587462:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MAIN:()=>p,EDIT:()=>h,default:()=>f});a(59357),a(175115),a(940851),a(296253);var n=a(667294),i=(a(45697),a(41437)),r=a(319368),s=a(800234),o=a(881150),l=a(172237),c=a(856612),d=a(164936),u=a(757187),g=a(389430),m=a(897557),_=a(791563),p="main",h="edit";class v extends n.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,a=e.name,n=e.text;return new Promise((e=>this.setState({editableMessage:{id:t,name:a,text:n}},e)))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:(0,m.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then((()=>this.state.section!==p?this.go(p):Promise.resolve())).then((()=>this.props.store.set(g.deleteTemplate.bind(null,e)))).catch((()=>{(0,_.showFastBox)((0,i.getLang)("mail_error"),(0,i.getLang)("mail_community_templates_delete_error"))})),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,a=t.name,n=t.text;a.length>200||a.length<2||a.length>2e3||n.length<5?(0,_.showFastBox)((0,i.getLang)("mail_error"),(0,i.getLang)("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch((()=>{(0,_.showFastBox)((0,i.getLang)("mail_error"),(0,i.getLang)("mail_community_templates_save_error"))})).then((()=>this.go(p)))},this.addHint=(e,t)=>{t.preventDefault();var a=this.state.editableMessage,n=a.id,i=void 0===n?null:n,r=a.name,s=a.text;return(0,d.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:i,name:r,text:`${s}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.id,n=void 0===a?null:a,i=t.name,r=void 0===i?"":i,s=t.text,o=void 0===s?"":s;return new Promise((t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:n,name:r,text:o}},(()=>{this.props.popup.updateBoxCoords(),t()})):t()}))}render(){var e=this.props,t=e.getTemplates,a=e.closePopup,s=this.state,g=s.section,m=s.editableMessage,_=t();return n.createElement("section",{className:"TemplatesSettings"},n.createElement(r.default,{title:n.createElement("span",{className:"TemplatesSettings__title"},g===p&&(0,i.getLang)("mail_community_templates"),g===h&&(0,i.getLang)("mail_add_community_template")),onCloseClick:a}),n.createElement("main",{className:"TemplatesSettings__content"},g===p&&(_.length?n.createElement(l.Scroll,{className:"TemplatesSettings__scroll-wrapper"},n.createElement("div",{className:"TemplatesSettings__list"},_.map((e=>n.createElement("section",{key:e.id,className:"TemplatesSettings__item"},n.createElement("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),n.createElement("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),n.createElement("div",{className:"TemplatesSettings__buttons-row"},n.createElement(c.default,{onClick:()=>this.go(h,e),className:"TemplatesSettings__item-button"},(0,i.getLang)("mail_settings_edit")),n.createElement("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true"}," ","·"," "),n.createElement(c.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button"},(0,i.getLang)("mail_delete")))))))):n.createElement("div",{className:"TemplatesSettings__not-found-container"},n.createElement("span",null,(0,i.getLang)("mail_community_templates_not_found")),n.createElement(c.default,{onClick:()=>this.go(h)},(0,i.getLang)("mail_add_community_template")))),g===h&&n.createElement("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate},n.createElement("div",{className:"TemplatesSettings__form-row"},n.createElement("label",{className:"TemplatesSettings__label",htmlFor:"name"},(0,i.getLang)("mail_name"),":"),n.createElement("div",{className:"TemplatesSettings__input-container"},n.createElement(d.default,{id:"name",type:"text",initialValue:m.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),n.createElement("span",{className:"TemplatesSettings__notice"},(0,i.getLang)("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")))),n.createElement("div",{className:"TemplatesSettings__form-row"},n.createElement("label",{className:"TemplatesSettings__label",htmlFor:"text"},(0,i.getLang)("mail_text"),":"),n.createElement("div",{className:"TemplatesSettings__input-container"},n.createElement(d.WithEmoji,{title:(0,i.getLang)("global_emoji_hint")},n.createElement(d.default,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:m.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")})),n.createElement("span",{className:"TemplatesSettings__notice"},(0,i.getLang)("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")))),n.createElement("div",{className:"TemplatesSettings__form-row"},n.createElement("label",{className:"TemplatesSettings__label"},(0,i.getLang)("mail_hints"),":"),n.createElement("div",{className:"TemplatesSettings__input-container"},(0,u.default)().map((e=>n.createElement(o.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",key:e.id},e.label))))))),n.createElement("footer",{className:"TemplatesSettings__footer"},g===p&&n.createElement(n.Fragment,null,n.createElement(c.default,{onClick:()=>this.go(h)},(0,i.getLang)("mail_add_community_template")),n.createElement(o.default,{onClick:a},(0,i.getLang)("mail_close"))),g===h&&n.createElement(n.Fragment,null,n.createElement("div",null,m.id&&n.createElement(c.default,{onClick:this.deleteTemplate.bind(null,m.id)},(0,i.getLang)("mail_delete_community_template"))),n.createElement("div",null,n.createElement(o.default,{appearance:"tertiary",onClick:()=>this.go(p)},(0,i.getLang)("mail_cancel")),n.createElement(o.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit"},(0,i.getLang)("mail_save"))))))}}v.defaultProps={section:p};const f=(0,s.connect)(v)},757187:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});a(59357);var n=a(135685),i=a(41437),r=a(236205),s=i.default.getLang;const o=()=>[{id:"user name",label:s("mail_community_templates_hint_name"),process:e=>(0,n.oCacheGet)(e,(0,r.getPeer)(e)).first_name},{id:"user surname",label:s("mail_community_templates_hint_last_name"),process(e){var t=(0,n.oCacheGet)(e,(0,r.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:s("mail_community_templates_hint_your_name"),process:e=>(0,n.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:s("mail_community_templates_hint_your_last_name"),process(e){var t=(0,n.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:s("mail_community_templates_hint_community"),process:e=>(0,n.oCacheGet)(e,e.get().id).name},{id:"greeting",label:s("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return s(t>=3&&t<12?"mail_greeting_good_morning":t>=12&&t<17?"mail_greeting_good_afternoon":t>=17&&t<=23?"mail_greeting_good_evening":"mail_greeting_good_night")}}]},291445:(e,t,a)=>{"use strict";a.d(t,{handleEventChatUpdated:()=>u});a(991181),a(176774),a(940851),a(296253);var n=a(663527),i=a(929566),r=a(389430),s=a(573084),o=a(172989),l=a(841645);function c(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function d(e,t){var a=e?e.indexOf(t):-1;return-1!==a&&(e.splice(a,1),!0)}function u(e,t,a,u,_,p){var h=(0,i.getTab)(e,t);switch(a){case o.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case o.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return a===o.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?c(h.adminIds,u):d(h.adminIds,u),e.set((e=>(0,r.setCallAvailability)(t,e))).then((()=>{g(e,t,_),m(e,t,_,p)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return h.data.flags=u,e.set((e=>(0,r.setCallAvailability)(t,e))).then((()=>{g(e,t,_),m(e,t,_,p)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_PINNED:delete h.pinHideId,cur.imDb.update(s.PIN_HIDDEN_ID_OP,[h.peerId,void 0]);var v=h&&h.pinned&&(0,n.parserMessage)(h.pinned).messageId;return _.removeUnpinnedMessageEditable(e,v),!1;case o.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:var f=u===vk.id;return function(e,t,a){if((0,n.isTabLoaded)(a.get(),e)){var s=(0,i.getTab)(a,e);c(s.memberIds,t)&&s.membersCount++,-1===s.data.active.indexOf(t)&&s.data.active.push(t),t===vk.id&&(s.data.kicked=0,s.data.closed=0)}return a.set((a=>(0,r.loadChatMember)({[e]:[t]},a)))}(t,u,e).then((()=>{if(f&&e.get().peer===t)return e.set((e=>(0,r.getPinnedMessage)(t,e)))})).then((()=>m(e,t,_,p))).then((()=>{if(f&&e.get().peer===t)return Promise.all([e.set((e=>(0,r.getPeerActiveCallData)(t,e))),e.set((e=>(0,r.loadKeyboard)(t,e)))])})).then((()=>(e.get().peer===t&&h.callInProgress&&(_.updateBanner(e),_.updateHeader(e)),_.fixKeyboard()))),!0;case o.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case o.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,a,s,o){if((0,n.isTabLoaded)(s.get(),e)){var l=(0,i.getTab)(s,e);d(l.memberIds,t)&&l.membersCount--,l.data.active=l.data.active.filter((e=>e!==t)),t===vk.id&&(a?l.data.kicked=1:l.data.closed=1,s.set((t=>(0,r.removePeerActiveCallData)(e,t))))}return t===vk.id&&s.get().peer===e?(o.cancelEditing(),s.set((t=>(0,r.unpinMessageOptimistic)(e,t)))):Promise.resolve()}(t,u,a===o.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,_).then((()=>m(e,t,_,p))),e.get().id!==u&&((0,i.getKeyboard)(e,t)||{}).author_id!==u||e.set((e=>(0,r.deleteKeyboard)(t,e))).then((()=>_.fixKeyboard())),!0;case o.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set((e=>(0,r.loadBanner)(t,e))).then((()=>_.updateBanner(e))),!0;case o.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case o.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;case o.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:var b=u?e=>(0,r.getPeerActiveCallData)(t,e):e=>(0,r.removePeerActiveCallData)(t,e);return e.set(b).then((()=>{e.get().peer===t&&(_.updateBanner(e),_.updateHeader(e)),p.updateDialog(t,e)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED:return e.set((e=>(0,l.setConvoIsNew)(t,u,e))),!0;default:return!1}}function g(e,t,a){e.get().peer===t&&((0,r.setActions)(e.get()),a.updateActions(e))}function m(e,t,a,n){e.get().peer===t&&((0,r.setActions)(e.get()),a.updateChat(e,t),n.updateDialog(t,e))}},187294:(e,t,a)=>{"use strict";a.d(t,{mount:()=>g});a(940851),a(296253);var n=a(533246),i=a(973935),r=a(667294),s=a(257326),o=a(81020),l=a(888563);function c(e,t){var a=d();i.render(r.createElement(s.ContactsList,{onClose:t.closeContactList,getContactsList:()=>function(e){return(0,l.checkContactListLoaded)(e).then((e=>{var t=e.get().contactsList;return Promise.resolve(t)}))}(e),selectPeer:t=>function(e,t){e.get().longpoll.push([(0,o.changePeer)(t,!1,!0,!0,"contacts_list")])}(e,t)}),a)}function d(){var e="_im_contacts_list",t=document.getElementById(e);if(t)return t;var a=document.createElement("section");return a.setAttribute("id",e),document.body.appendChild(a),a}function u(e,t){return{unmount:()=>function(e,t){var a=d();a&&i.unmountComponentAtNode(a),(0,n.destroyModule)(e)}(e),closeContactList(){var e=d();i.unmountComponentAtNode(e)}}}function g(e){var t=(0,(0,n.createMutations)(u).bindMutations)((0,n.createModule)({handlers:(e,t)=>{}}),e);return c(e,t),t}},458996:(e,t,a)=>{"use strict";a.d(t,{mount:()=>b});a(175115),a(530522),a(66108),a(579665),a(95767),a(940851),a(991181),a(296253),a(820075);var n=a(91257),i=a(503369),r=a(663527),s=a(389430),o=a(599044),l=a(992828);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function g(e,t,a,n){var i=e instanceof Array?e:geByClass("_im_bar_date",e),r=t.contHeight();o.default.onNewMessagesChunk();var s=i.reduce(((e,t)=>(e[domData(t,"date")]=[t.offsetTop+10,r,t],e)),{}),l=!a&&n.barMap?n.barMap:{};return n.barMap=extend(l,s),n.barMapKeys=Object.keys(n.barMap).sort(),Promise.resolve(n)}function m(e,t){return t.barMapKeys.forEach((a=>{t.barMap[a][0]-=e})),Promise.resolve(t)}function _(e,t,a,n,i){var s=e.get().barMap[t],o=(0,r.isClassicInterface)(i)?68:20;return a-(s[0]+a-s[1])+n-o}function p(e,t,a,n){return n.barTransition=n.barMap[t][2],a>0?(addClass(n.barMap[t][2],"im-page--date-bar-transition-inverse"),addClass(e,"im-page--date-bar-transition-inverse")):a<0&&(removeClass(n.barMap[t][2],"im-page--date-bar-transition-inverse"),removeClass(e,"im-page--date-bar-transition-inverse")),addClass(n.barMap[t][2],"im-page--date-bar-transition"),addClass(e,"im-page--date-bar-transition"),Promise.resolve(n)}function h(e,t){return t.barTransition&&(removeClass(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),removeClass(e,"im-page--date-bar-transition"),Promise.resolve(t)}function v(e,t,a,n,i){var r,s,o=e.get(),l=a-t;o.barMapKeys.forEach((t=>{var o=_(e,t,a,n,i);if(o>=l){var c=r?_(e,r,a,n,i):a;r=c>o?t:r}else if(o<l){var d=s?_(e,s,a,n,i):0;s=o>d?t:s}}));var c={};return[[s,"prev"],[r,"cur"]].forEach((t=>{var r=d(t,2),s=r[0],o=r[1];s&&(c[o+"Bar"]=function(e,t){var a=e.get().barMap[t][2];return{text:a.textContent,date:domData(a,"date")}}(e,s),c[o+"Left"]=_(e,s,a,n,i)-l)})),c}function f(e,t,a,n,i){var o=e.get(),c=(0,s.isEverythingLoaded)(o),d=t.get(),u=i.scrollTop(),g=d.lastTop?d.lastTop-u:0;d.lastTop=u;var m=(0,l.isPinnedMessageVisibleInTab)(o,o.peer)?(0,r.getPinnedMessageHeight)(e):0,_=(0,s.isSearchingInplace)(o.peer,o)&&o.tabs[o.peer]&&o.tabs[o.peer].top_banner?50:0,f=((0,r.isClassicInterface)(e)?68+m+_:0)-16,b=v(t,u,i.contHeight(),f,e),y=b.prevBar,C=b.curBar,w=b.prevLeft,S="translateY(0px)",E=!1,T=!1,I=!1;C||c||(C=function(e){var t=geByClass1("_im_mess",e),a=domData(t,"ts");return t&&a?{text:getShortDate(intval(a),!1,!0,getLang("months_of","raw")),date:a}:null}(n)),C?E=C:T=!0,y&&C&&w>-32&&w<0&&(I=!0,T=!1,E=C,S=`translateY(${-32-w}px)`),E&&function(e,t){domData(e,"ts")!==t.date&&(e.innerHTML=t.text,domData(e,"ts",t.date),e.style.visibility="visible")}(a,E),I?t.set(p.bind(null,a,y.date,g)):t.set(h.bind(null,a)),S&&(a.style.transform=S),toggleClass(a,"im-page--top-date-bar_no-b",T)}function b(e,t){var a=geByClass1("_im_top_date_bar",t),r={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},s=(0,n.default)(r),o=null,l=null,d=null,u=(0,i.debounce)((e=>{var a=s.get();Object.keys(a).length&&!a.isDisabled&&s.set(g.bind(null,t,e,!1))}),500);return{reset(n){s.get().isDisabled||s.set(g.bind(null,t,n,!0)).then(f(e,s,a,t,n))},disable(){s.setState(c({},r,{isDisabled:!0}))},enable(){s.setState({isDisabled:!1})},heightIncreased(e,t){s.get().isDisabled||(u(t),s.set(m.bind(null,e)))},parseMore(n,i){s.get().isDisabled||s.set(g.bind(null,n,i,!1)).then((()=>{f(e,s,a,t,i)}))},toggle(e){s.get().isDisabled&&e||a.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){s.get().isDisabled||(l=Date.now(),d||(addClass(t,"im-page--top-date-bar_visible"),d=setInterval((function(){Date.now()-l>2e3&&(removeClass(t,"im-page--top-date-bar_visible"),clearInterval(d),d=null)}),100)))},update(n){s.get().isDisabled||(o&&(clearTimeout(o),o=null),o=setTimeout((function(){f(e,s,a,t,n)}),300),f(e,s,a,t,n))},unmount(){o&&(clearTimeout(o),o=null),d&&(clearInterval(d),d=null),s.unmount()}}}},656829:(e,t,a)=>{"use strict";a.d(t,{mount:()=>ee});a(991181),a(940851),a(296253);var n=a(389430),i=a(929566),r=a(667294),s=a(973935),o=a(732779),l=a(138671),c=a(319368),d=a(744544),u=a(663527),g=a(214701),m=a(533246),_=a(91257),p=a(81020),h=a(907851),v=a(705456),f=a(791563),b=a(719016),y=a(116886),C=a(227192),w=a(122902),S="_im_dialogs_creation_name",E="_im_create_select",T="_im_create_avatar",I="_im_confirm_creation",L="_im_avatar_img",k=["im-creation--item_hovered"],M="olist_item_wrap_on",A=0;function P(e){!function(e){var t=e.querySelector("._im_creation_settings_modal_wrap"),a=B.bind(null,t);s.render(r.createElement(l.default,{onClose:a,className:"im-creation--modal-settings"},r.createElement(c.default,{title:(0,y.getLang)("mail_chat_creation_settings"),onCloseClick:a}),r.createElement(o.ChatSettingsOptions,{flags:A,back:a,isChatCreation:!0,onSave:D,afterSave:x.bind(null,t),onCancel:a})),t)}(e)}function B(e){e&&s.unmountComponentAtNode(e)}function D(e){return A=e,Promise.resolve()}function x(e){B(e)}function N(e){return(0,b.showTooltip)(e,{text:(0,y.getLang)("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function R(e,t,a,i,r,s){(0,n.toggleConversation)(!1),removeClass(t,"im-create_shown"),removeClass(t,"im-create_photo-attached"),setTimeout(O.bind(null,t,!1),100),G(s).map((e=>geByClass1("_im_dialog"+e))).forEach((e=>{removeClass(e,M)})),a().createCanceled(e),r.resetSelection(),"add_member"===e.get().creationType&&e.set(n.setCreationType.bind(null,"chat",[])),e.set(n.presetAvatar.bind(null,!1));var o=geByClass1(L,t);U(e,s,t),uiSearch.reset(geByClass1(S,t)),uiSearch.reset(geByClass1(E,t)),o&&o.parentNode.removeChild(o),U(e,s,t),cancelStackFilter("im_search");var l=0===e.get().peer?"search":"default";e.get().longpoll.push([(0,p.transitionEvent)(l)]),attr(t,"aria-hidden","true")}function F(e,t,a){return t&&(a.current_create_peer_ids={},a.current_create_peers=[]),a.current_create_peer_ids||(a.current_create_peer_ids={}),a.current_create_peers||(a.current_create_peers=[]),e.forEach((e=>{e.then((e=>{e=e.filter((e=>!a.current_create_peer_ids[e.peerId])),a.current_create_peer_ids=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),a.current_create_peer_ids),a.current_create_peers=a.current_create_peers.concat(e)}))})),Promise.resolve(a)}function O(e,t){toggleClass(e,"im-create_material",t)}function U(e,t,a){var n=geByClass1(I,a),i=t.get().selection.length,r="add_member"===e.get().creationType,s=uiSearch.getFieldEl(geByClass1(S,a)),o=i>0,l=(s?s.value.trim():"").length>0,c=!o&&(r||!l),d=r?1===i?(0,y.getLang)("mail_append_chat"):(0,y.getLang)("mail_im_create_chat_with"):l||i>1?(0,y.getLang)("mail_im_create_chat"):(0,y.getLang)("mail_im_go_to_dialog");val(n,d),toggleClass(n,"button_disabled",c)}function H(e,t,a,n,i,r,s){if(s){var o,l=intval(domData(s,"list-id")),c=G(r),d=trim(s.textContent),u=geByClass1(E,t),g=getSize(u)[1];inArray(l,c)?(o=n.removeSelection(l,d),removeClass(s,M)):(o=n.addSelection(l,d),addClass(s,M)),o.then((()=>{var e=g-getSize(u)[1],t=i.scrollTop();i.scrollTop(t-e)})),U(e,r,t);var m=geByClass1(E,t);uiSearch.reset(m)}}function j(e,t){var a=G(e),n=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],i=[];return t.online&&i.push("online"),mobPlatforms[t.online]&&i.push("mobile"),inArray(t.peerId,a)&&n.push(M),getTemplate("im_owner_item",{owner_id:t.peerId,cls:" "+n.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:i.join(" ")})}function q(e){return(0,i.getSearchText)(e)||!1}function G(e){return e.get().selection.map((e=>e.id))}function z(e,t,a){return e.then((e=>e.filter((e=>e.is_friend&&!inArray(e.peerId,a.get().creationFilter)))))}function V(e,t,a,i,r){var s,o,l=geByClass1(E,e),c=(0,n.searchLocalHints)(i,t.get()),d=a.hoverFirstElement.bind(a,k,X(t));t.get().creation_shown_all=!1,a.reset(),a.pipe(z(c,0,t),i),a.toTop(),i?(o=(0,n.searchTopConv)(i,t.get()),s=(0,n.searchHintsIndex)(i,[],"friends",t.get()),a.pipe(z(s,0,t),i).then(d),a.pipe(z(o,0,t),i).then(d)):(s=Promise.resolve([]),o=Promise.resolve([])),t.set(F.bind(null,[c,o,s],!0)),uiSearch.showProgress(l),Promise.all([c,s,o]).then((()=>uiSearch.hideProgress(l)))}function K(e,t,a,i){var r=2e9+Math.round(rand(1e6,2e6));cur.recieveCropResult=a=>{cur.recieveCropResult=!1,curBox()&&curBox().hide(),e.set(n.presetAvatar.bind(null,a)),(0,n.getOwnerPhoto)(a,r).then((e=>{geByClass1(T,t).appendChild(ce("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))})),addClass(t,"im-create_photo-attached")},Page.ownerPhoto(r)}function W(e,t){geByClass1(T,t).innerHTML="",e.set(n.presetAvatar.bind(null,!1)),removeClass(t,"im-create_photo-attached")}function Y(e,t,a,n,i,r){G(t).map((e=>geByClass1("_im_dialog"+e))).forEach((e=>removeClass(e,M))),t.reset(),V(a,e,n,!1,G(t)),i.resetSelection(),R(e,a,r,0,i,t)}function $(e,t,a,r,s,o,l){var c=G(t),d=e.get(),u=geByClass1(I,a),g=uiSearch.getFieldEl(geByClass1(S,a)).value,m="add_member"===e.get().creationType,_=!m&&(g.length||c.length>1),h=geByClass1("_im_creation_show_history_input",a).checked;if(m)return e.set(n.addNewMember.bind(null,d.peer,c,h)).catch((e=>(0,f.showFastBox)((0,y.getLang)("global_error"),e))),R(e,a,o,0,s,t);if((0,v.lockButton)(u),!_)return b(c[0]);function b(n){A=0,Y(e,t,a,r,s,o),function(e,t,a,n,i,r){R(e,t,a,0,i,r),e.get().longpoll.push([(0,p.changePeer)(n,!1,!1,!1,"create_conversation")])}(e,a,o,n,s,t),(0,v.unlockButton)(u),(0,i.isSearching)(e)?o().cancelSearch(e):o().restoreDialogs(e)}e.set((e=>(0,w.createChatAction)(e,d.next_chat_avatar,c,g,A))).then((()=>b(d.next_peer))).catch((e=>{(0,v.unlockButton)(u),topMsg((0,y.getLang)("global_unknown_error"),2,"#FFB4A3")}))}function Q(e,t){return(0,b.showTooltip)(e,{text:(0,y.getLang)("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function X(e,t){var a=t&&t.get().selection.length;return{top:-1,bottom:(0,u.isClassicInterface)(e)?a>0?69:0:-1}}function J(e,t,a){U(e,t,a)}function Z(e,t,a,n,i,r,s,o){return{show(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.setState({shown:!0}),O(e,!0),cancelStackPush("im_create",s),addClass(e,"im-create_shown");var o=n.get().selection.reduce(((e,t)=>(e[t.id]=!0,e)),{});r&&r.forEach((t=>{if(!o[t[0]]){var a=e.querySelector(`._im_dialog${t[0]}`);i.addSelection(t[0],t[1]),a&&!a.classList.contains(M)&&a.classList.add(M)}})),function(e,t,a,n){toggleClass(e,"im-create_chat","chat"===n.get().creationType),toggleClass(e,"im-create_invite","add_member"===n.get().creationType);var i="chat"===n.get().creationType?(0,y.getLang)("mail_im_group_dialog"):(0,y.getLang)("mail_im_friends_tab"),r=geByClass1("_im_create_title",e);val(r,i),val(geByClass1(I,e),"add_member"===n.get().creationType?(0,y.getLang)("mail_im_create_chat_with"):(0,y.getLang)("mail_im_create_chat")),V(e,n,t,!1,a.get().selection.map((e=>e.id)))}(e,a,n,t),setTimeout((()=>{t.get().longpoll.push([(0,p.transitionEvent)("create")]),attr(e,"aria-hidden","false"),i.focus()}),1)},focusSearch(e){i.focus()},confirmCreate(e){o()},hide(a){a.get().shown=!1,R(a,e,t,0,i,n)},scroll(e){a.scrollPage(e,!0)},updateScroll(){a.updateScroll()},selectElement(t){H(t,e,0,i,a,n,a.getHoveredElement())},hoverPrevElement(e){a.hoverPrevElement(k,null,X(e,n))},hoverNextElement(e){a.hoverNextElement(k,null,X(e,n))},unmount(){(0,m.destroyModule)(r),a.unmount(),i.unmount(),cancelStackFilter("im_create"),cur.recieveCropResult=void 0}}}function ee(e,t,a){var i=(0,_.default)({selection:[]}),r=geByClass1("_im_create_list",e),s=geByClass1(E,e),o=(0,C.debouncedPromise)((function(a){return function(e,t,a,n){var i=n.get(),r=q(i);i.selection.map((e=>e.id)),a.unhoverElements(k),e.get().creationQuery=r,V(t,e,a,r)}(t,e,c,a)}),300),l=(0,g.mount)(s,i,(()=>({selectionDeleted(a,n){U(t,a,e),removeClass(geByClass1("_im_dialog"+n),M)},onChange:e=>o(e).catch((e=>{if("debounce"!==e)throw e}))}))),c=(0,d.mount)(r,(0,_.default)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),(()=>({idFn:e=>intval(e.peerId),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:j.bind(null,i),more(e,a){var r;return t.get().shown?(t.get().creation_shown_all||!1!==q(i)?r=Promise.resolve([]):(t.get().creation_shown_all=!0,r=(0,n.searchTopConv)(q(i),t.get())),t.set(F.bind(null,[r],!1)),z(r,q(i),t)):Promise.resolve(!1)},onClick(a,n){checkEvent(a)||(H(t,e,0,l,c,i,n),cancelEvent(a))}})));t.get().creationQuery=!1,t.get().creationType="chat";var u=R.bind(null,t,e,a,"cross",l,i),p=K.bind(null,t,e),v=W.bind(null,t,e),f=Y.bind(null,t,i,e,c,l,a),b=$.bind(null,t,i,e,c,l,a),y=J.bind(null,t,i,e),w=P.bind(null,e),L=geByClass1("_im_create_cancel",e),A=geByClass1(S,e),B=geByClass1("_im_creation_settings",e),D=A.querySelector(".ui_search_reset"),x=(0,m.createModule)({handlers:(t,a)=>{t(L,"click",u),t(L,"mouseover",Q.bind(null,L)),t(geByClass1(T,e),"click",p),t(geByClass1("_im_create_remove_avatar",e),"click",v),t(geByClass1("_im_cancel_creation",e),"click",f),t(A,"change",y),t(A,"input",y),t(A,"paste",y),t(D,"click",y),t(geByClass1(I,e),"click",b),t(B,"click",w),t(B,"mouseenter",N.bind(null,B)),t(e,"mouseover",(0,h.throttle)(c.unhoverElements.bind(c,k),100))}});return Z(e,a,c,i,l,x,u,b)}},242127:(e,t,a)=>{"use strict";a.d(t,{mount:()=>Be});a(530522),a(579665),a(95767),a(991181),a(798184),a(820075),a(59357),a(176774),a(976142),a(66108),a(940851),a(296253);var n=a(389430),i=a(663527),r=a(929566),s=a(193483),o=a(478153),l=a(966829),c=a(229852),d=a(91257),u=a(907851),g=a(744544),m=a(172989),_=a(533246),p=a(636600),h=a(135685),v=a(351117),f=a(719016),b=a(985515),y=a(81020),C=a(371372),w=a(432975),S=a(206566),E=a(72739),T=a(236205),I=a(428128),L=a(841645),k=a(324466),M=a(592388),A=a(69785),P=a(910848);function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var x="_im_peer_target",N="_im_dialog_star",R=["_im_dialog_selected","nim-dialog_selected"],F=["_im_dialog_hovered","nim-dialog_hovered"],O="_im_dialog_peer_tags",U="_convoRecommendUser",H="_convoRecommendUserRemove",j="_convoRecommendAction",q="_im_dialog_folder_button_hide",G="im-page--dialogs-folder-button_hidden";function z(e,t,a){removeClass(t.parentNode,"im-page--dialogs_with-mess");var n=a.getCurrentElements().filter((e=>e.message));a.toTop(),a.reset(),(0,p.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),n.length>0?(n=[{type:"sep_messages"}].concat(n),e.setState({searchOnlyMessages:!0})):n=[he()],a.pipeReplace(Promise.resolve(n))}function V(e){return hasClass(e,"_im_search")}function K(e){if((0,r.isSearching)(e)&&e.get().searchAllLoaded||(0,r.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||(0,i.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if((0,r.isSearching)(e))return(0,n.searchMessages)((0,r.getSearchText)(e),e.get()).then((e=>{var t=B(e,2),a=t[0];return pe(t[1],a)}));var t=e.get().active_tab,a=e.get().dialog_tabs_all;return![c.FOLDER_MESSAGE_REQUEST,c.FOLDER_PEER_TAGS,k.FOLDER_BUSINESS_NOTIFY].includes(t)&&a[c.FOLDER_ALL]&&!(0,i.isReversedDialogs)(e)||a[t]?0===Ae(e).length?(0,r.isMessageRequestFolder)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):Promise.resolve([{type:"empty_dialogs"}]):Promise.resolve([]):e.set(n.loadDialogs).then((t=>{var a=Ae(e);if((0,i.isViewWithRecommendations)(e)){if(a.length<2&&!e.get().hasContacts)return a.push({type:"find_friends_stub"}),a;if(1===a.length)return[{type:"empty_dialogs"}]}return 0===a.length?(0,r.isMessageRequestFolder)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):[{type:"empty_dialogs"}]:a}))}function W(e,t,a,s,o,l){var c=parseInt(domData(l,"peer"),10),d=(0,r.getTab)(a,c),u=hasClass(l,"_im_sugg_"+c),g=l.classList.contains("ConvoRecommendList__button");if(d||u||g){var m=gpeByClass(x,o.target)&&checkEvent(o),_=(0,i.isCommunityInterface)(a)&&gpeByClass(O,o.target),p=gpeByClass(H,o.target);if(!(m||_||p)){var h=a.get(),v=V(l),f=parseInt(domData(l,"msgid"),10);if(d&&(0,r.tabIsMessageRequestToChat)(d))return e().showChatInvitationBox(a,c),cancelEvent(o);var b=`list_${h.active_tab}`;if((0,r.isSearching)(a)&&(b="conversations_search"),(0,r.isRecentSearchesActive)(a)&&(b="recent_searches"),u&&(b="popular_suggestions"),g&&(b="list_all_suggestions"),v&&(b="message_search"),d&&checkEvent(o))return window.open(function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=(0,i.getBaseLink)(e),s=()=>`${r}?sel=${(0,i.convertPeerToUrl)(t.peerId)}${n&&a?"&msgid="+a:""}`;if(n)return s();if((0,i.isUserPeer)(t.peerId)||(0,i.isCommunityPeer)(t.peerId))return(0,i.isClassicInterface)(e)?s():t.href;return s()}(a,d,f,v));if(s.saveScroll("list"),v&&h.msgid!==f)h.longpoll.push([(0,y.changePeer)(c,f,!1,!1,b)]);else if(c!==h.peer){h.longpoll.push([(0,y.changePeer)(c,!1,!0,!0,b)]);var C=(0,r.isSearching)(a);C&&!hasClass(l,"_dont_add_recent")&&(0,n.saveRecentSearchPeer)(c,cur.imDb),C&&d&&!(0,i.isClassicInterface)(a)&&setTimeout((()=>{var e=d.message?d.message.messageId:d.peerId;s.scrollToElement(e.toString(),!0,0,"center")}),100)}else c===h.peer&&e().goToHistoryEnd();cancelEvent(o)}}}function Y(e,t,a,n){var s,o="string"==typeof a.photo&&""!==a.photo,l=(0,i.isContactPeer)(t),c=a.tab||a.name,d=l?(0,i.prepareContactName)(c):c;if((0,i.isChatPeer)(t)&&!o)s=(0,i.renderPhotosFromTab)(e,a,n);else{if(l&&!o){var u=(0,i.getUserInitials)(c),g=(0,r.isSearching)(e)&&!a.message?34:n?50:46;s=getTemplate("sImContactAvatar",{name:u,size:g,classes:"nim-peer--contact-avatar"})}else s=(0,w.isDialogWithYourself)(e.get().id,t)?`<img src="${k.FAVORITES_ICON_URL}" alt="">`:`<img src="${a.photo}" alt="">`;n&&(s=getTemplate("im_dialogs_link_img",{href:a.href||a.link,photo:s}))}return{photo:s,userLink:`<span class="_im_dialog_link">${d}</span>`}}function $(e){return!(0,i.isPendingForward)(e)}function Q(e,t,a,n){return a?"":n?getTemplate("im_img_prebody",{photo:t}):e+":"}function X(e,t,a,n,s,o,l,c,d,u){var g="",_=(0,r.isChannelPeer)((0,r.getTab)(e,a));return t&m.FLAG_OUTBOUND?g=Q(getLang("mail_by_you"),u,_,d):!(0,v.isBusinessNotifyTab)((0,r.getTab)(e,a))&&(0,i.isChatPeer)(a)&&0!==n&&(g=Q((0,h.oCacheGet)(e,n).first_name,(0,h.oCacheGet)(e,n).photo,_,d)),l=(0,i.renderShortText)(a,c,l,s,o),g?getTemplate("im_drow_prebody",{prebody:g,body:l}):l}function J(e,t,a,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=[];return(0,i.isClassicInterface)(n)&&o.push("nim-dialog_classic"),(0,r.isRecentSearchesActive)(n)&&o.push("nim-dialog_recent"),o.push("nim-dialog_empty"),s.search&&o.push("_im_search"),getTemplate("im_drow",{peer:e.peerId,msg_id:"",photo:t,user_link:a,date:"",body:"",unread:"",more:o.join(" "),is_star:"",unread_message_string:"",is_online:onlinePlatformClass(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==n.get().peer?"nim-dialog_selected _im_dialog_selected":""})}function Z(e,t,a){return!!(a&m.FLAG_OUTBOUND)&&(!(0,i.isSelfMessage)(t.peerId,e.get().gid)&&(!((0,i.isChatPeer)(t.peerId)&&t.data&&t.data.closed)&&(!t.unread&&!(!t.lastmsg||t.lastmsg<=t.out_up_to))))}function ee(e){var t=ce(e);return!!(e.unread>0&&t)||!!(0,r.isTabMarkedUnread)(e)}function te(e){return!(!e.mentions||!e.mentions.length)}function ae(e){return function(e){return!(!e.expiring_messages||!e.expiring_messages.length)}(e)&&!te(e)}function ne(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=a||ce(t),l=Y(e,t.peerId,t,(0,i.isClassicInterface)(e)),c=l.photo,d=l.userLink;if(!o)return J(t,c,d,e,n);var u=o.flags,g=(0,i.isFvkcomgroup)(e,t.peerId),_=(0,r.tabIsMessageRequestToChat)(t),p=(0,r.isCasperChat)(e,t.peerId),h=le(t,e,a),v=(0,r.isCommunityChat)(e,t.peerId),f=t.major_sort_id,b=[];n.search&&b.push("_im_search","nim-dialog_search"),inArray(t.peerId,e.get().mutedPeers)&&b.push("nim-dialog_muted"),t.verified&&b.push("nim-dialog_verified"),t.isDonutChat&&b.push("nim-dialog_donut"),p&&b.push("nim-dialog_casper"),(0,r.isRecentSearchesActive)(e)&&b.push("nim-dialog_recent"),(0,s.isMessageEmpty)(o)&&!p&&b.push("nim-dialog_empty"),(0,i.isClassicInterface)(e)&&b.push("nim-dialog_classic"),t.folders&m.FOLDER_IMPORTANT&&b.push("nim-dialog_starred"),!n.search&&(0,i.isUnrespond)(e,t.peerId,t)&&b.push("nim-dialog_unrespond"),(g||v)&&e.get().gid&&b.push("nim-dialog_deny-remove"),te(t)&&b.push("nim-dialog_unread-mentions"),ae(t)&&b.push("nim-dialog_unread-expiring"),t.callInProgress&&b.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&b.push("nim-dialog_active-call-empty"),(0,C.isPinnedSortId)(f)&&b.push("nim-dialog_pinned");var y=(0,r.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:o.date,w=e.get().timeshift,S=y?getShortDateOrTime(y,w,!0,getLang("months_sm_of","raw")):"",E=!Z(e,t,u)||_||(0,r.isSearching)(e)?"":"nim-dialog_unread-out",T=t.unread>0?getLang("mail_im_new_messages",t.unread):"",I=(0,i.isContactPeer)(t.peerId)?(0,i.prepareContactName)(t.tab):t.tab;return getTemplate("im_drow",{peer:t.peerId,msg_id:o.messageId||"",photo:c,user_link:d,date:S,body:h,unread_message_string:T,tab_name:stripHTML(I),unread:(0,i.simplifyCounter)(t.unread),more:b.join(" "),is_online:onlinePlatformClass(t.online),is_unread:ee(t)?"nim-dialog_unread":"",is_unread_out:E,is_selected:n.noselect||_||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected"})}function ie(e,t,a,n,o){if(!t.deletedDialog)if(hasClass(e,"nim-conversation-search-row"))oe(e,t,a);else{var l=a.get(),c=ce(t),d=c.flags,g=le(t,a),_=Y(a,t.peerId,t,(0,i.isClassicInterface)(a)),p=_.photo,h=_.userLink,v=a.get().timeshift,f=c.date?getShortDateOrTime(c.date,v,!0,getLang("months_sm_of","raw")):"";be(e,t),val(geByClass1("_dialog_body",e),g),val(geByClass1("_im_dialog_date",e),f),val(geByClass1("_im_dialog_unread_ct",e),(0,i.simplifyCounter)(t.unread));var b=geByClass1("_im_dialog_link",e);b&&val(b.parentNode,h);var y=geByClass1("_im_dialog_photo",e);y.innerHTML!==p&&val(y,p),l.is_peer_profile_enabled&&(l.peer||Te(e,a));var w=(0,r.isCasperChat)(a,t.peerId);toggleClass(e,"nim-dialog_verified",!!t.verified),toggleClass(e,"nim-dialog_casper",w),toggleClass(e,"nim-dialog_muted",inArray(t.peerId,a.get().mutedPeers)),toggleClass(e,"nim-dialog_unrespond",(0,i.isUnrespond)(a,t.peerId,t)),toggleClass(e,"nim-dialog_classic",(0,i.isClassicInterface)(a)),toggleClass(e,"nim-dialog_unread",ee(t)),toggleClass(e,"nim-dialog_unread-mentions",te(t)),toggleClass(e,"nim-dialog_unread-expiring",ae(t)),toggleClass(e,"nim-dialog_active-call",!!t.callInProgress),toggleClass(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),toggleClass(e,"nim-dialog_pinned",(0,C.isPinnedSortId)(t.major_sort_id)),toggleClass(e,"nim-dialog_deny-remove",a.get().gid>0&&((0,i.isFvkcomgroup)(a,t.peerId)||(0,r.isCommunityChat)(a,t.peerId))),removeClass(e,"nim-dialog_failed"),removeClass(e,"nim-dialog_deleted"),addClass(e,"_im_dialog"),(0,u.toggleOnline)(geByClass1("_im_peer_online",e),t.online),toggleClass(e,"nim-dialog_recent",(0,r.isRecentSearchesActive)(a)),toggleClass(e,"nim-dialog_empty",(0,s.isMessageEmpty)(c)&&!w),toggleClass(e,"nim-dialog_unread-out",Z(a,t,d)&&!(0,r.isSearching)(a)),toggleClass(e,"nim-dialog_starred",t.folders&m.FOLDER_IMPORTANT),o&&setTimeout((function(){addClass(geByClass1("_im_dialog_"+t.peerId,n),"nim-dialog_injected")}),100)}}function oe(e,t,a){be(e,t),toggleClass(e,"nim-dialog_recent",(0,r.isRecentSearchesActive)(a)),val(geByClass1("_im_dialog_unread_ct",e),(0,i.simplifyCounter)(t.unread)),toggleClass(e,"nim-dialog_unread",ee(t)),toggleClass(e,"nim-dialog_unread-expiring",ae(t)),toggleClass(e,"nim-dialog_unread-mentions",te(t));var n=Y(a,t.peerId,t,(0,i.isClassicInterface)(a)).photo,s=geByClass1("_im_dialog_photo",e);s.innerHTML!==n&&val(s,n),(0,u.toggleOnline)(geByClass1("_im_peer_online",e),t.online)}function le(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=a||ce(e),o=(0,r.tabIsMessageRequestToChat)(e),l=(0,r.isCasperChat)(t,e.peerId);if(o){var c=(0,i.isClassicInterface)(t),d=e.mr&&e.mr.inviter_id,u=(0,h.oCacheGet)(t,d),g=c?u.name:u.short_name,m=c?getTemplate("im_img_prebody",{photo:u.photo}):"",_=getLang("mail_mr_service_message").replace(/{user}/,g);return m+_}if((0,i.isPeerBlocked)(e.peerId,t)){var p=t.get().block_states[e.peerId].name,v=getLang("mail_community_answering").replace("{username}",p);return getTemplate("im_drow_prebody",{prebody:v,body:""})}return(0,s.isServiceMsg)(n)&&!o?(0,i.renderServiceMsg)(t,n,e.peerId,!1):l&&(0,s.isMessageEmpty)(n)?getLang("mail_empty_casper_message"):(0,s.isExpiredCasperMessage)(n)?getLang("mail_expired_message"):X(t,n.flags,e.peerId,n.userId,!0,n.attaches,n.text,n.subject,(0,i.isClassicInterface)(t),(0,h.oCacheGet)(t,t.get().id).photo)}function ce(e){var t=e.lastmsg_meta;return Array.isArray(t)&&(t=(0,b.getMessageFromTuple)(t)),t||(0,b.getMessageFromTuple)([-1,0,e.peerId,0,"",{},{},-1,-1,0])}function de(e,t,a){var s=(0,r.getTab)(e,t),o=(0,r.tabIsMessageRequestToChat)(s),l=(0,i.showLeaveDialog)(e,t,(r=>{a().updateMenu(e);var s=Promise.resolve();(0,i.isChatPeer)(t)&&(s=o?e.set((e=>(0,n.rejectMessageRequest)(t,!1,e))):e.set((e=>(0,n.leaveChat)(t,e)))),r&&s.then((()=>(0,i.cleanHistory)(e,l,a,n.flushHistory,t))),l.hide()}))}function ue(e,t,a,r,s,o){var l=gpeByClass("_im_dialog",o,a);if(cancelEvent(s),!l)return!1;var c=intval(domData(l,"peer")),d=t.get(),u=(0,i.isCommunityPeer)(c)||(0,i.isUserPeer)(c);if(d.recentSearch){var g=(0,n.removeFromRecentSearch)(c,cur.imDb);re(l),0===g.length&&Ee(t,r,e)}else(0,i.isClassicInterface)(t)&&u?(0,n.deleteDialog)(c,d).then((a=>{var n=B(a,2),i=n[0],r=n[1];i?(!function(e,t,a,n,i){var r=geByClass1("_dialog_body",t);addClass(t,"nim-dialog_deleted"),removeClass(t,"_im_dialog"),val(r,getTemplate("im_delete_actions",{text:langNumeric(a,getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:n}))}(c,l,i,r),e().updateMenu(t)):de(t,c,e)})):de(t,c,e);return!1}function ge(e,t,a){(0,i.toggleDialogsFolder)(e,(e=>{t().restoreDialogs(e,!0),(0,d.unpackStore)(e).active_tab===c.FOLDER_ALL&&t().updateRecommendationList(e),t().updateSearchMenu(e),t().updateDialogFilters(e)}),n.changeDialogsTab,a)}function me(e,t){switch(t.type){case"sep_btn_search_msg":return(0,i.renderBtnSearchOnlyMessages)(e);case"sep_messages":return(0,i.renderMessagesSep)();case"sep_conversations":return(0,i.renderConversationsSep)();case"sep_popular":return(0,i.renderPopularSuggSep)();case"popular_sugg":return(0,i.renderPopularSuggestions)(e);case"recommend_list":return(0,i.renderConvoRecommendList)(e);case"find_friends_stub":return(0,i.renderFindFriendsStub)(e);case"clear_recent":return(0,i.renderClearRecent)();case"empty_dialogs":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_list_empty")});case"empty_message_requests":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_mr_empty")});case"empty":return getTemplate("im_dialogs_none",{msg:getLang("mail_im_search_empty")});case"message_request_notice":return getTemplate("im_dialogs_message_requests_notice",{msg:getLang("mail_message_request_tab_notice")});case"message_request_button_go":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_tab_mr"),class_name:"_im_toggle_mr",counter:(0,P.getFolderUnreadCount)(e,k.ConvoListFolder.MR)});case"business_notify_button_go":return getTemplate("im_dialogs_business_notify_button",{msg:getLang("mail_tab_business_notify"),class_name:t.hidden?G:"",counter:(0,P.getFolderUnreadCount)(e,k.ConvoListFolder.BUSINESS_NOTIFY)});case"all":return getTemplate("im_dialogs_all_button",{msg:getLang("mail_go_to_all_tab"),class_name:"_im_toggle_all_tab"});default:return t.message?ne(e,t,t.message,{noselect:!0,search:!0}):t.local_index||(0,r.isSearching)(e)?function(e,t){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=Y(e,t.peerId,t,(0,i.isClassicInterface)(e)),o=s.photo,l=s.userLink,c=(0,i.isContactPeer)(t.peerId)?(0,i.prepareContactName)(t.tab):t.tab,d=$(e),u=""===n?[]:[n],g=e.get();return(0,r.isRecentSearchesActive)(e)&&u.push("nim-dialog_recent"),(0,i.isClassicInterface)(e)&&u.push("nim-csr_classic"),inArray(t.peerId,e.get().mutedPeers)&&u.push("nim-dialog_muted"),(0,r.isCasperChatTab)(t)&&u.push("nim-dialog_casper"),te(t)&&u.push("nim-dialog_unread-mentions"),ae(t)&&u.push("nim-dialog_unread_expiring"),(null===(a=(0,r.getTab)(e,t.peerId))||void 0===a?void 0:a.isDonutChat)&&u.push("nim-dialog_donut"),getTemplate("im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:o,user_link:l,unread:(0,i.simplifyCounter)(t.unread),tab_name:stripHTML(c),is_unread:ee(t)?"nim-dialog_unread":"",is_online:onlinePlatformClass(t.online),is_selected:t.peerId==g.peer&&d?"nim-dialog_selected _im_dialog_selected":"",more:u.join(" ")})}(e,t):ne(e,t)}}function _e(e,t,a,r,s,o){var l=intval(domData(o,"peer")),c=domData(o,"action"),d=domData(o,"sid"),u=geByClass1("_im_dialog_"+l,t),g=intval(domData(o,"spam"));switch(c){case"restore":u&&e.set(n.restoreDialog.bind(null,l,d,g)).then((()=>{addClass(u,"_im_dialog"),removeClass(u,"nim-dialog_deleted"),ie(u,e.get().tabs[l],e,t,!1),r().updateMenu(e)}));break;case"spam":var m=`${getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${d}" data-peer="${l}">\n            ${getLang("mail_restore")}\n        </button>`;if(u){var _=geByClass1("_dialog_body",u);val(_,m),(0,n.spamDialog)(l,d,e.get())}break;case"block":((0,i.isCommunityInterface)(e)?(0,i.showBlacklistBox)(l,e):(0,i.showBlacklistBoxUser)(l,e)).once("success",(function(){e.set(n.flushHistory.bind(null,l)).then((()=>{a().restoreDialogs(e)}))}))}cancelEvent(s)}function pe(e,t){return e.map((e=>(0,b.getMessageFromTuple)(e))).map((e=>extend({},t[e.peerId],{message:e})))}function he(e){return{type:"empty",lang:e}}function ve(e,t,a,i){var r=gpeByClass("_im_dialog",i,t),s=intval(domData(r,"peer"));return e.set(n.toggleDialogImportant.bind(null,s)),setTimeout((function(){fe(e,t,a,i)}),100),cancelEvent(a),!1}function fe(e,t,a,n){(0,f.showTooltip)(n,{text:function(){var a=gpeByClass("_im_dialog",n,t),i=domData(a,"peer");return e.get().tabs[i].folders&m.FOLDER_IMPORTANT?getLang("mail_im_toggle_important_off"):getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:Pe(e,n.getBoundingClientRect().top)})}function be(e,t){var a=t.unread>0?getLang("mail_im_new_messages",t.unread):"",n=geByClass1("_im_unread_blind_label",e);val(n,a)}function ye(e,t,a,i,s){var o=gpeByClass("_im_dialog",s,t),l=intval(domData(o,"peer")),c=e.get().tabs[l].lastmsg;return e.set(n.markDialogAnswered.bind(null,l,c)).then((()=>{ie(o,e.get().tabs[l],e,t),(0,r.isRecentSearchesActive)(e)||a().restoreDialogs(e)})),showDoneBox(getLang("mail_marked_as_answered"),{out:1e3}),cancelEvent(i),!1}function Ce(e){var t=(0,r.isSearching)(e),a=e.get().searchOnlyMessages;return(0,i.isClassicInterface)(e)?{top:t&&!a?96:60,bottom:(0,i.isCommunityInterface)(e)?42:87}:{top:t&&!a?36:0,bottom:0}}function we(e,t){e.hoverFirstElement(F,Ce(t))}function Se(e){e.unhoverElements(F)}function Ee(e,t,a){if((0,r.doPopularSuggExist)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else a().cancelSearch(e),cancelStackFilter("im_search")}function Te(e,t){var a=t.get(),n=parseInt(domData(e,"peer")),s=(0,r.getTab)(a,n);if(a.is_peer_profile_enabled&&(0,i.isCommunityInterface)(a)&&s&&!(0,r.isChannelPeer)(s)&&!(0,r.isCommunityChat)(a,n)&&!(0,r.isSearching)(t)){var l=geByClass1(O,e);if(s.ad_id||a.peer_profile_tags&&s.peer_tags&&s.peer_tags.ids){var c=s.peerTagsMaxWidth||0;if(!c){var d=geByClass1("_im_dialog_name_w",e).offsetWidth;c=340-(d+6+(s.verified?16:0)),t.set((e=>(e.tabs[n].peerTagsMaxWidth=c,Promise.resolve(e))))}(0,o.renderPeerTags)(l,c,t,n)}else l.innerHTML&&(l.innerHTML="")}}function Ie(e,t){if((0,i.isCommunityInterface)(e)){["empty_dialogs","empty"].includes(domData(t,"list-id"))?(0,o.updateEmptyDialogsMargin)():hasClass(t,"_im_dialog")&&Te(t,e)}}function Le(e){checkEvent(e)||cancelEvent(e)}function ke(){return window.FriendsSearch?Promise.resolve():window.stManager.add([jsc("web/friends_search.js")])}function Me(e,t,a,n,s,o){return{selectPeer(t,a){for(var n=geByClass("_im_dialog",e),i=a.get().peer,r=0;r<n.length;r++){var s=n[r],o=intval(domData(s,"peer")),l=intval(domData(s,"msgid"));o===i&&(!V(s)||t===l&&V(s))?(addClass(s,"nim-dialog_selected"),addClass(s,"_im_dialog_selected")):hasClass(s,"_im_dialog_selected")&&(removeClass(s,"nim-dialog_selected"),removeClass(s,"_im_dialog_selected"))}},appendFastDialogs(t,n,s){removeClass(e.parentNode,"im-page--dialogs_with-mess"),a.saveScroll("list"),s?(a.reset(),(0,i.isPendingForward)(t)||(0,r.isRecentSearchesActive)(t)||!(0,l.doesSearchResultContainConversations)(n)?(0,r.isRecentSearchesActive)(t)&&((0,l.doesSearchResultContainConversations)(n)&&(n=[{type:"clear_recent"}].concat(n)),(0,r.doPopularSuggExist)(t)&&(n=[{type:"sep_popular"},{type:"popular_sugg"}].concat(n))):n=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(n),t.setState({searchOnlyMessages:!1}),a.pipeReplace(Promise.resolve(n)).then((()=>we(a,t)))):a.pipe(Promise.resolve(n)),(0,i.isClassicInterface)(t)&&!(0,i.isReservedPeer)(t.get().peer)||a.toTop()},deactivate(){a.deactivate()},activate(){a.activate()},hoverFirstDialog(e){we(a,e)},hoverNextDialog(e){a.hoverNextElement(F,R,Ce(e))},hoverPrevDialog(e){a.hoverPrevElement(F,R,Ce(e))},unhoverDialogs:Se.bind(a),selectHoveredDialog(t){var i=geByClass1("_im_dialog_hovered",e);i||(i=geByClass1("_im_dialog",e)),i&&W(n,0,t,a,{},i)},appendSearch(t,n,i){var r=pe(i,n);i.length>0?(addClass(e.parentNode,"im-page--dialogs_with-mess"),a.pipe(Promise.resolve([{type:"sep_messages"}].concat(r))).then((()=>we(a,t)))):(0===a.getCurrentElements().length&&a.pipeReplace(Promise.resolve([he()])),removeClass(e.parentNode,"im-page--dialogs_with-mess"))},update(e){a.pipeReplace(Promise.resolve(Ae(e))).then(o.track)},updateDialog(t,a){var n=geByClass1("_im_dialog_"+t,e);n&&!V(n)&&ie(n,(0,r.getTab)(a,t),a,e)},focusOnSelected(t){var n=t.get().peer;if(n){var i=geByClass1(`_im_dialog_${n}`,e);i?a.scrollTop(i.offsetTop-i.offsetHeight):a.toTop()}},restoreScroll(e){a.restoreScroll("list")||a.toTop()},forceScrollReinit(){var e=a.getScroller();e&&(e.style.overflowY="hidden",setTimeout((()=>e.style.overflowY=""),0))},restoreDialogs:(t,r,s)=>(removeClass(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),0!==Ae(t).length||a.isLoading()||(r=!0),r&&a.reset(),s&&a.wipe(),a.pipeReplace(Promise.resolve(Ae(t))).then((()=>{if(r&&(!(0,i.isClassicInterface)(t)||!t.get().peer)){var e=function(e,t,a){return(0,i.isClassicInterface)(a)||t().toggleSettingsLoader(a,!0),e.checkMore(!(0,i.isClassicInterface)(a)).then((()=>{(0,i.isClassicInterface)(a)||t().toggleSettingsLoader(a,!1)}))}(a,n,t);return a.toTop(),e}})).then((()=>Se(a))).then(o.track)),appendDialogs(t,n){removeClass(e.parentNode,"im-page--dialogs_with-mess"),n.forEach((a=>{var n=geByClass1("_im_dialog_"+a.peerId,e);n&&oe(n,a,t)})),(0,i.isPendingForward)(t)||(0,r.isRecentSearchesActive)(t)||!(0,l.doesSearchResultContainConversations)(n)||(n=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(n)),t.setState({searchOnlyMessages:!1}),a.isEmpty()&&0===n.length&&(0,i.isPendingForward)(t)&&(n=[he(getLang("mail_im_search_empty_chats"))]),a.replacePreserveOrder(n)},updateCounter(t,a){var n=geByClass1("_im_dialog_"+a,e),s=(0,r.getTab)(t,a);if(n&&!V(n)&&(be(n,s),val(geByClass1("_im_dialog_unread_ct",n),(0,i.simplifyCounter)(s.unread)),toggleClass(n,"nim-dialog_unread",ee(s)),toggleClass(n,"nim-dialog_unread-out",Z(t,s,ce(s).flags)),toggleClass(n,"nim-dialog_unread-mentions",te(s)),toggleClass(n,"nim-dialog_unread-expiring",ae(s))),(0,r.isRecentSearchesActive)(t)){var o=geByClass1("_im_sugg_"+a,e);o&&(val(geByClass1("_sugg_unread_ct",o),(0,i.simplifyCounter)(s.unread)),toggleClass(o,"sugg-is_unread",s.unread>0))}},removeDialog(e,t){a.remove(t)},updateOnline(t,a){var n=geByClass1("_im_dialog_"+t,e);if(n){var i=a.get().tabs[t],r=geByClass1("_im_peer_online",n);(0,u.toggleOnline)(r,i.online)}},updateRecommendedOnline(t,a){var n=(0,v.getRecommendedConvoList)(a),i=e.querySelector(`.ConvoRecommendList__button[data-peer="${t}"]`);if(i&&n){var r=n.item_data[t].online_info,s=i.querySelector("._online");s.classList.toggle("online",r.is_online||r.is_mobile),s.classList.toggle("mobile",r.is_mobile)}},updateRecommendationList(t){var a=e.querySelector(`.ConvoRecommendList .${E.CAROUSEL_VIEWPORT_CLASS}`),n=a&&a.querySelector(`.${E.CAROUSEL_LAYER_CLASS}:not(.ConvoRecommendList__fadeOut)`);if(n){var r=se((0,i.renderConvoRecommendList)(t)).querySelector(`.${E.CAROUSEL_LAYER_CLASS}`);r.classList.add("ConvoRecommendList__fadeIn"),n.classList.add("ConvoRecommendList__fadeOut"),n.addEventListener("animationend",(()=>{r.classList.remove("ConvoRecommendList__fadeIn"),n&&n.parentNode&&(n.remove(),o.track())})),a.appendChild(r)}},setRecommendationListVisibility(t){var a=e.querySelector(".ConvoRecommendList");return!!a&&(a.classList.toggle("ConvoRecommendList--hidden",!t),!0)},setDialogFailed(t,a,n){var i=geByClass1("_im_dialog_"+t,e);i&&(n.get().tabs[t].lastmsg===a&&(addClass(i,"nim-dialog_failed"),val(geByClass1("_im_dialog_unread_ct",i),"!")))},scrollUp(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.toTop(e,t),a.saveScroll("list",!0)},saveScroll(e){a.saveScroll("list",!0)},promoteDialog(n,i){var s=geByClass1("_im_dialog_"+i,e);s&&!V(s)||!(0,r.isSearching)(n)?(a.pipeReplace(Promise.resolve(Ae(n)),void 0,!0).then((t=>{!inArray(i,t)&&s&&ie(s,(0,r.getTab)(n,i),n,e)})),t().updateTyping(i,n)):a.unsetScroll("list")},removeSelection(t){var n=t.get().peer.toString(),r=`._im_dialog_${n}.${R.join(".")}`,s=domQuery(r,e)[0];R.forEach((e=>removeClass(s,e))),(0,i.isClassicInterface)(t)||a.hoverElement(n,F,Ce(t))},updateScroll(){a.updateScroll()},updateTyping(t,a){var n=geByClass1(`_im_dialog_${t}`,e);if(n&&!V(n)&&!a.get().tabs[t].deletedDialog){var s=geByClass1("_im_dialog_typing",n),o=!(0,i.isClassicInterface)(a),l=(0,i.formatTyper)((0,r.getTab)(a,t).activity,t,!(0,i.isChatPeer)(t),a.get(),1,o);val(s,l),toggleClass(n,"nim-dialog_typing",l)}},renderPeerTags(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a?Te(geByClass1("_im_dialog_"+a,e),t):function(e,t){var a=t.get();a.is_peer_profile_enabled&&(0,i.isCommunityInterface)(a)&&geByClass("_im_dialog",e).forEach((e=>{Te(e,t)}))}(e,t)},updateFolderCounters(t){var a=(0,d.unpackStore)(t),n=e.querySelector(`.${i.TOGGLE_BUSINESS_NOTIFY_TAB}`);n&&n.classList.toggle(G,(0,T.isBusinessNotifyFolderHidden)(a)),[k.ConvoListFolder.MR,k.ConvoListFolder.BUSINESS_NOTIFY].forEach((t=>{var n=(0,P.getFolderUnreadCount)(a,t),i=e.querySelector(`[data-list-id=${t}_button_go] .im-page--dialogs-folder-button--counter`);i&&(i.innerHTML=n)}))},toggleFolder:ge,unmount(){a.unmount(),o.destroy(),(0,_.destroyModule)(s)}}}function Ae(e){var t=(0,d.unpackStore)(e),a=t.active_tab,n=t.dialog_tabs[a],r=t.tabs,s=n.map((e=>r[e.toString()])).sort(w.sortFn.bind(null,e));if((0,i.isViewWithRecommendations)(e)&&(e.get().hasContacts||n.length>1)&&s.unshift({type:"recommend_list"}),a===c.FOLDER_MESSAGE_REQUEST&&s.unshift({type:"message_request_notice"}),!(0,i.isClassicInterface)(e))switch(a){case c.FOLDER_ALL:(0,T.isBusinessNotifyEnabled)(e)&&s.unshift({type:"business_notify_button_go",hidden:(0,T.isBusinessNotifyFolderHidden)(e)}),(0,T.getConvoListFolderCounterDisplayed)(t,k.ConvoListFolder.MR)>0&&s.unshift({type:"message_request_button_go"});break;case c.FOLDER_MESSAGE_REQUEST:case k.FOLDER_BUSINESS_NOTIFY:s.unshift({type:"all"})}return s}function Pe(e,t){var a=e.get().gid?220:150;return!((0,o.isPeerTagsFolder)(e)&&t<=a+46)&&(t>a||(0,r.isSearching)(e))}function Be(e,t,a,s){var l=(0,_.createMutations)(Me),c=l.callMutations,m=l.bindMutations,p=function(e,a){(0,f.showTooltip)(a,{text:()=>{if((0,r.isRecentSearchesActive)(t))return getLang("mail_hide_from_recent");var e=Number(a.getAttribute("data-peer")),n=(0,r.getTab)(t,e),s=(0,r.tabIsMessageRequestToChat)(n);return(0,i.isChatPeer)(e)&&!s?(0,v.doesChatTabHaveFlag)((0,r.getTab)(t,e),1024)?getLang("mail_unfollow_channel"):(0,r.isChatActive)(n)?getLang("mail_leave_chat"):getLang("mail_delete"):getLang("mail_delete")},black:1,[(0,i.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:(0,i.isClassicInterface)(t)?[-4,10]:[0,10],toup:Pe(t,a.getBoundingClientRect().top),zIndex:1})},h=function(e,a){(0,f.showTooltip)(a,{text:getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:Pe(t,a.getBoundingClientRect().top)})},b=fe.bind(null,t,e),y=ve.bind(null,t,e),C=ye.bind(null,t,e,c),w={idFn:e=>function(e,t){return t.message?t.message.messageId:(0,r.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}(t,e),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:me.bind(null,t),more:K.bind(null,t,c),onScroll:!!(0,i.isClassicInterface)(t)&&(()=>{(bodyNode.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&S.browser.safari?addClass(s,"im-page--header_static"):removeClass(s,"im-page--header_static")}),onRenderFn:Ie.bind(null,t)},E=(0,g.mount)(e,(0,d.default)({limit:40,offset:0,nativeScroll:!!(0,i.isClassicInterface)(t),height:64,elements:Ae(t)}),(()=>w)),P=function(e){var t,a=new Set,n=t=>{t.forEach((t=>{var n=t.target,i=t.isIntersecting,r=n.dataset,s=r.position,o=r.peer,l=(0,T.getRecommendationListTrackCode)(e,o);!a.has(o)&&i?(a.add(o),(0,I.collectConversationSuggestionItemStats)(l,Number(s),"show")):a.has(o)&&!i&&(a.delete(o),(0,I.collectConversationSuggestionItemStats)(l,Number(s),"hide"))}))};return{track:()=>{t&&t.disconnect();var e=document.querySelector(".ConvoRecommendList");if(e){var a=e.querySelector("._im_carousel_viewport");t=new IntersectionObserver(n,{root:a}),e.querySelectorAll("._convoRecommendUser").forEach((e=>t.observe(e)))}},destroy:()=>{t&&t.disconnect()}}}(t);P.track(),S.browser.mozilla&&ke();var D=W.bind(null,a,c,t,E),R=z.bind(null,t,e,E),O=_e.bind(null,t,e,c,a),G=ue.bind(null,a,t,e,E),V=B([k.ConvoListFolder.MR,k.ConvoListFolder.BUSINESS_NOTIFY,k.ConvoListFolder.ALL].map((e=>n=>{if(n.target.closest(`.${q}`)){var i="number"!=typeof(0,d.unpackStore)(t).settings.business_notify_folder_hidden,r=s.querySelector(`.${M.CONVO_MORE_CLASS}`);return i&&r&&(0,f.showTooltip)(r,{text:getLang("mail_dialog_business_notify_more_hint"),shift:[12,0],dir:"top",nohide:1,className:"im-page--dialogs--business_notify_hint",appendEl:bodyNode,needRight:!0,onCreate:()=>{var e=r.tt.hide;r.tt.container.addEventListener("click",e),r.parentNode.addEventListener("mouseover",e)}}),void a().hideFolderButton(t,e)}ge(t,a,e)})),3),Y=V[0],$=V[1],Q=V[2],X=(0,_.createModule)({handlers:(r,s)=>{s(e,"click","_im_dialog_close",G),s(e,"click","_im_dialog_markre",C),s(e,"click",N,y),s(e,"click","_im_dialog",D),s(e,"click",i.MESSAGE_SEARCH_CLASS,R),s(e,"mouseover","_im_dialog_close",p),s(e,"mouseover","_im_dialog_markre",h),s(e,"click",i.CLEAR_RECENT_CLASS,(()=>{(0,n.resetRecentSearch)(cur.imDb),Ee(t,E,a)})),s(e,"click",i.TOGGLE_MR_TAB,Y),s(e,"click",i.TOGGLE_BUSINESS_NOTIFY_TAB,$),s(e,"click",i.TOGGLE_ALL_TAB,Q),s(e,"mouseover",N,b),s(e,"click","_im_dialog_daction",O),s(e,"click",x,Le),s(e,"click",U,(e=>function(e,t){var a=e.target.closest("._convoRecommendUser").dataset,n=a.position,i=a.peer,r=(0,T.getRecommendationListTrackCode)(t,i);(0,I.collectConversationSuggestionItemStats)(r,Number(n),"click")}(e,t))),s(e,"click",H,(e=>function(e,t){cancelEvent(e);var a=e.target.closest("._convoRecommendUser"),n=a.parentNode,i=Number(a.dataset.position),r=Number(a.dataset.peer),s=(0,T.getRecommendationListTrackCode)(t,r)||"";n.remove(),t.set((e=>(0,L.removeStoredRecommendedListItem)(e,r))),(0,A.hideSuggestedContact)({position:i,track_code:s}).catch((()=>{throw new Error("Could not hide recommendation item")}))}(e,t))),s(e,"click",j,(e=>function(e,t){var a=e.target.closest("._convoRecommendAction").dataset.action,n=(0,d.unpackStore)(t).externalAuthParams;switch(a){case"invite_by_phone_number":ke().then((()=>{window.FriendsSearch.inviteBox()}));break;case"import_ok":if(!n)return;ke().then((()=>{window.FriendsSearch.checkOAuth(n.lngCode,n.state,4)}));break;case"import_gmail":if(!n)return;ke().then((()=>{window.FriendsSearch.checkOAuth(n.lngCode,n.state,1)}))}}(e,t))),(0,i.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&(s(e,"mouseover","_im_peer_tags_extra",(e=>(0,o.onPeerTagsExtraHover)(e,t))),s(e,"click","_im_dialog_peer_tag",(e=>(0,o.onDialogPeerTagClick)(e,t)))),r(e,"mouseover",(0,u.throttle)(E.unhoverElements.bind(E,F),100)),s(e,"mouseover",q,((e,t)=>{(0,f.showTooltip)(t,{text:getLang("mail_dialog_folder_button_hide"),black:1,center:!0,shift:[-6,6],appendEl:bodyNode})}))}});return m(e,c,E,a,X,P)}},956642:(e,t,a)=>{"use strict";a.d(t,{mount:()=>_});a(530522),a(66108),a(296253),a(991181),a(579665),a(95767),a(176774);var n=a(389430),i=a(966829),r=a(316417),s=a(663527),o=a(91257),l=a(533246),c=a(172989);function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function g(e,t,a,i){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var r=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,(0,s.wrapLoading)(r)((0,n.loadImportant)(e.offset).then((t=>{var a=d(t,4),o=(a[0],a[1]),l=(a[2],a[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(r,"im-important_all"):e.loading=!1,i.set((e=>(0,n.mergeTabs)(e,(0,s.tabFromIds)(l.msgs,l.hash),!0)));var c=ce("div");c.innerHTML=o,r.appendChild(c),(0,s.ensureDomHasActions)(r)})),"bottom")}}function m(e,t,a){for(var i=arguments.length,r=new Array(i>3?i-3:0),s=3;s<i;s++)r[s-3]=arguments[s];r.filter((e=>inArray(e.type,[c.SET_FLAGS,c.RESET_FLAGS,c.CHANGE_PEER]))).forEach((i=>{if(i.type!==c.CHANGE_PEER){if(i.flags===c.FLAG_IMPORTANT){var r=i.type===c.SET_FLAGS;e.set(n.updateFavMessage.bind(null,[i.messageId],0,r)).then((a=>{t.markImportant(i.messageId,r,e)}))}}else a.hide()}))}function _(e,t,a,n){var c=ge("box_layer_wrap"),d=t.get().longpoll,u=(0,o.default)({peer:0,longpoll:d,oCache:{},tabs:(0,s.tabFromIds)(n.msgs,n.hash)}),_=(0,r.mount)(e.bodyNode,u,(()=>({}))),p=(0,i.mount)(e.bodyNode,t,"fav_box");(0,s.ensureDomHasActions)(e.bodyNode);var h=m.bind(null,t,_,e);d.onData(h);var v=g.bind(null,{all:!1,loading:n.all,offset:n.offset},e,c,u),f=(0,l.createModule)({handlers:(e,t)=>{e(c,"scroll",v)}});return{unmount(){(0,l.destroyModule)(f),p.unmount(),_.unmount(),d.offData(h)}}}},435047:(e,t,a)=>{"use strict";a.d(t,{mount:()=>s});a(991181),a(296253);var n=a(663527),i=a(389430);function r(e){var t=e.get().tabs,a=e.get().peer,r=Object.keys(t).filter((t=>(0,n.isFullyLoadedTab)(e,t)&&intval(t)!==a)).map((e=>t[e]));r.filter((e=>Date.now()-e.last_visited>54e6)).forEach((t=>e.set(i.cleanTab.bind(null,t.peerId)))),r.filter((t=>(0,n.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5)).forEach((t=>e.set(i.stringifyTab.bind(null,t.peerId))))}function s(e){var t=setInterval(r.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}},155939:(e,t,a)=>{"use strict";a.d(t,{mount:()=>At});a(530522),a(66108),a(579665),a(95767),a(976142),a(751876),a(820075),a(21466),a(991181),a(59357),a(940851),a(296253);var n=a(389430),i=a(393202),r=a(995343),s=a(236205),o=a(351117),l=a(663527),c=a(987105),d=a(929566),u=a(907851),g=a(193483),m=a(940543),_=a(694405),p=a(533246),h=a(888563),v=a(186863),f=a(188765),b=a(966829),y=a(316417),C=a(678013),w=a(790829),S=a(843670),E=a(992828),T=a(797399),I=a(458996),L=a(172989),k=a(81020),M=a(405982),A=a(599044),P=a(536896),B=a(573084),D=a(454665),x=a(283778),N=a(371372),R=a(583014),F=a(182408),O=a(121265),U=a(719016),H=a(442699),j=a(503369),q=a(653439),G=a(486353),z=a(428128),V=a(621941),K=a(791563),W=a(485178),Y=a(705456),$=a(863675),Q=a(992665),X=a(873078),J=a(116886),Z=a(216191),ee=a(906542);function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ae(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ae(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ne=1e3,ie=-30,re="._im_to_end",se="._im_to_mention",oe="_im_error",le="im-page--error--visible",de="im-audio-message_recorded",ue="im-audio-message_recording",ge="_im_mess_srv",me="im_srv_mess_link",_e="_im_mess",pe="_im_replied_message",he="top",ve="center",fe="_im-call-snippet",be="_im_mess_callsnippet",ye="_im_call_snippet_join_btn",Ce="_im_mess_pinned",we="im-mess_editable",Se="_im_add_to_friends",Ee="im-mess-stack--lnk",Te=!1,Ie={};function Le(e){return e.get().isMassMentionsMessageAllowed}function ke(e){var t=(0,d.getTab)(e,e.get().peer);return!!(0,d.getPinnedMessage)(e)||!(!t||!t.top_banner)}function Me(e,t){var a=(0,u.unpackStore)(e),n=(0,d.getTab)(a,t);return(0,l.isChatPeer)(t)&&(0,E.isPinnedMessageVisibleInTab)(a,t)||!!n.top_banner&&!(0,d.isSearchShown)(t,a)}function Ae(e){return(0,l.getPinnedMessageHeight)(e)}function Pe(e,t,a){var n=a||window.clientHeight();return Math.min(n-15,Math.max(0,e,742+t.offsetTop))}function Be(e,t){var a=intval(domData(t.target,"msgid")),n=gpeByClass(`_im_mess_${a}`,t.target),i=geByClass1("_im_log_body",n),r=geByClass1("_im_mess_susp_cont",n);i.innerHTML=r.innerHTML}function De(e,t){return geByClass1("_im_mess_"+t,e)}function xe(e){e().hideError()}function Ne(e,t,a,i,r){if(checkEvent(i))return!0;var s=(0,F.fromQueryString)(r.getAttribute("href")),o=intval(s.msgid);o&&e.set(n.changePeer.bind(null,e.get().peer,o,!1)).then((()=>Ye(a,t,o,e))),cancelEvent(i)}function Re(e,t,a){var i=(0,d.getTab)(t,a),r=(0,n.strHistory)(i.history);toggleClass(e,"im-page--history_empty-hist",!r)}function Fe(e,t,a,n){if(hasClass(a.target,"_im_mess_marker")){var i=a.target,r=(0,u.toArray)(geByClass(l.FAILED_CLASS,t));window.tooltips&&r.map((e=>geByClass1("_im_mess_marker",e))).filter((e=>e!==i)).forEach((e=>tooltips.hide(e,{fasthide:!0})));var s=domData(n,"msgid");(0,U.showTooltip)(i,{content:getTemplate("im_failed_menu",{count:r.length,modifiers:(0,O.classNames)("im-settings_failed",{"im-settings_no_delete":s>0,"im-settings_single":1===r.length}),id:s}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function Oe(e){return geByClass1("_im_peer_history",e)}function Ue(e,t){var a=t.contHeight(),n=e.scrollTop+(a-e.contHeight);t.scrollTop(n)}function He(e,t,a,i,r,s,o,c,u){var g=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],m=arguments.length>10&&void 0!==arguments[10]&&arguments[10],_=(t.get().tabs||{})[a];r().hideError(),s.renderPeer(t),c.renderPeer(t),u.render(t);var p=(0,d.isCasperChat)(t,a);if(toggleClass(e,"im-page--history_casper",p),!t.get().tabHistoryNotChanged){s.reRenderTitle(t),Re(e,t,a);var h=(0,n.strHistory)(_.history);if(h){var v=geByClass1("_im_peer_history",e);val(v,h)}else r().showEmptyScreen();getAudioPlayer().isPlaying()&&getAudioPlayer().updateCurrentPlaying(),ct(t,i,e)}if((0,n.isSearchingInplace)(a,t.get())?r().showSearch(t):r().cancelSearch(t,!1),o.changePeer(a,t),t.get().msgid)Ye(i,e,t.get().msgid,t);else if(_.scrollBottom&&g){Ue(_,i);var f=(0,l.isMessagesVisible)(t,e,i),b=te(f,1),y=b[0];_.skipped||setTimeout((()=>{_.unread&&!y&&(Je(t,e,!0),Ze(t,e,!0)),Ge(t,i,e),ze(t,i,e)}),100)}else We(i,e,r,t,m)||i.scrollBottom(ie);window.LazyLoad&&window.LazyLoad.scan(!!i.scroll&&i.scroll.scroller)}function je(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a||t.scrollTop(),r=t.scrollBottom(),s=t.contHeight(),o=e.get().peer;e.set(n.saveHistoryScroll.bind(null,o,i,r,s))}function qe(){return m.screenfull.isFullscreen}function Ge(e,t,a){var n=(0,d.isGoToMentionVisible)(e),i=(0,d.isGoToEndVisible)(e),r=t.getScrollHeight()/4,s=t.scrollTop()>0;t.scrollBottom()>r&&(!i||n)&&s&&Je(e,a,!0,40)}function ze(e,t,a){if(Le(e)){var n=t.getScrollHeight()/4,i=t.scrollTop()>0,r=(0,d.isGoToMentionVisible)(e);t.scrollBottom()>n&&!r&&i&&Ze(e,a,!0,40)}}function Ve(e,t,a,i,r,s,o,c){var u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if((e.get().history_init||(e.get().history_init=!0,!(c.scrollTop()>0)))&&!qe()){r.update(c),r.show();var g=e.get().peer;if(0!==g&&(0,l.isFullyLoadedTab)(e.get(),g)&&(A.default.onHistoryScroll(c.scrollTop()),!layers.visible)){var m=(0,d.getTab)(e,g);m&&!m.skipped&&c.scrollBottom()>40?(Ge(e,c,s),ze(e,c,s)):m.skipped||m.unread||(mt(e,s),_t(e,s));var p=(0,l.wrapLoading)(a);if(!(0,n.isSearchingInplace)(g,e.get())&&u&&i(c),!Te&&(o<0||0===c.scrollBottom())&&c.scrollBottom()<ne){if((0,n.isSearchingInplace)(g,e.get()))return;if(m.skipped>0&&!e.get().no_moving_down){var h=gpeByClass("_im_page_history",s),v=e.get();Te=!0;var f=e.set(n.loadLessHistory).then(t().loadHistory.bind(null,v.peer,{reversed:!0})).then((()=>{t().updateObserver(),Te=!1,Je(e,h),Ze(e,h),m.skipped||e.set(n.changePeer.bind(null,e.get().peer,!1,!1))}));return st(h,!0),void f.then(st.bind(null,h,!1))}}if(!Te&&c.scrollTop()<ne){if((0,n.isSearchingInplace)(g,e.get())){Te=!0;var b=t().getSearchResulstModule();return b.isAll(e)?void(Te=!1):void p(b.loadMore(e).then((a=>{Te=!1,a&&(t().loadHistory(e.get().peer,{},e,a),i(c))})),"up")}var y=e.get();m.allShown||(Te=!0,p(e.set(n.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,y.peer,{})).then((()=>{Te=!1,i(c)})),"up"))}o<0&&Ct(e,g,c.scrollBottom(),s,t),(0,_.videoAutoPlayHandler)()}}}function Ke(e,t){return window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?Promise.resolve():e.set(n.readTillSpecificMessage.bind(null,t,e.get().peer))}function We(e,t,a,i,r){var s=geByClass1("_im_unread_bar_row",t);if(s){var o=i.get(),c=o.peer,d=s.getBoundingClientRect(),u=geByClass1("_im_chat_body_abs",t).getBoundingClientRect().top+20;(0,l.isClassicInterface)(i)&&(u+=47+(Me(o,c)?Ae(i):0));var g=e.scrollTop()-u+d.top;return e.scrollTop(g),je(i,e,g),setTimeout((()=>{c===i.get().peer&&Ve(i,a,Oe(t),(function(){}),r,t,0,e)}),80),(0,G.partConfigEnabled)("mail_history_unread_counter_observer")?a().updateObserver():function(e){var t=e.get().peer;if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)&&t)e.set(n.readLastMessages.bind(null,t))}(i),!0}return!1}function Ye(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:he,r=De(t,a);if(r){var s=(0,l.isClassicInterface)(n),o=n.get().peer,c=s?window.clientHeight():geByClass1("_im_chat_body_abs",t).offsetHeight,d=r.offsetTop+domPN(r).offsetTop+domPN(domPN(r)).offsetTop+domPN(domPN(domPN(r))).offsetTop;s&&Me(n,o)&&(d-=Ae(n)),i===he?e.scrollTop(d-e.getScrollHeight()/2+c/2):e.scrollTop(d-e.getScrollHeight()+c/4),addClass(r,"im-mess_light"),setTimeout((()=>{removeClass(r,"im-mess_light")}),2e3)}}function $e(e,t,a){a.updateLastSeen(e)}function Qe(e,t,a,r,s,o){var l=domData(o,"action"),c=domData(o,"msgid"),d=geByClass1("_im_mess_marker",De(a,c)),u=Number(c)>0?"edit":"send",g=e.get().peer,m=Oe(a);switch(l){case"resend":(0,i.statlogsSendingRetry)("retry",u),t(s,o);break;case"resend_all":(0,i.statlogsSendingRetry)("retry",u),r().resendPeer();break;case"delete":(0,i.statlogsSendingRetry)("delete",u),e.set((t=>(0,n.removeFailed)(e,m,g,c,t)));break;case"delete_all":(0,i.statlogsSendingRetry)("delete",u),e.set((t=>(0,n.removeFailed)(e,m,g,void 0,t)))}tooltips.hide(d,{fasthide:!0})}function Xe(){var e=showBox("al_im.php",{act:"a_business_notify_info_content"},{title:!1,onDone:()=>{var t=()=>e.hide();document.querySelectorAll("._im_business_notify_info_box_hide").forEach((e=>e.addEventListener("click",t))),e.setOptions({hideButtons:!0})}})}function Je(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.get(),s=r.peer;if(!(0,l.isReservedPeer)(s)){var o=e.get().tabs[s],c=(t||document).querySelector(re),d=!1;(a||o.skipped>0||o.unread>0)&&!(0,n.isSearchingInplace)(s,e.get())?(d=!0,et(t,e),addClass(c,"im-navigation_shown")):gt(c,!0),e.set(n.updateGoToEndVisibility.bind(null,[d,+i]))}}function Ze(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Le(e))return!1;var r=e.get(),s=r.peer;if(!(0,l.isReservedPeer)(s)){var o=e.get().tabs[s],c=o.mentions,d=void 0===c?[]:c,u=(t||document).querySelector(se),g=d.length,m=!1;o.unread>0&&g>0&&!(0,n.isSearchingInplace)(s,e.get())?(m=!0,tt(t,e,g),addClass(u,"im-navigation_shown")):gt(u,!0),e.set(n.updateGoToMentionVisibility.bind(null,[m,+i]))}}function et(e,t){var a=t.get().peer,n=(0,d.getTab)(t,a);(e||document).querySelector(re).querySelector("._im_to_end_label").innerHTML=Number(n.unread)>0?(0,H.formatCount)(n.unread):""}function tt(e,t,a){(e||document).querySelector(se).querySelector("._im_to_mention_label").innerHTML=a>0?(0,H.formatCount)(a):""}function at(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e.scrollTop()&&0===e.scrollBottom())return!1;var a=e.scrollBottom();return a<(t?30+t:30)}function nt(e,t,a,n,i){var r=domData(i,"msgid"),s=e.get().peer,o=(0,d.getMessage)(e,s,r);o.type===L.EDIT_MESSAGE?(a().sendEditMessage(e,o),a().resendMessage(s,r)):e.get().imQueueResend(s,r).then((t=>{e.get().longpoll.push([(0,k.resendEvent)(s,t.mess)])}))}function it(e,t,a,i,r,s){var o=intval(domData(s,"peer")),c=intval(domData(gpeByClass("_im_mess",s),"msgid")),u=(0,d.getTab)(e,o);return e.set(n.restoreMessage.bind(null,c,o)).then(l.restoreMessage.bind(null,c,o,Oe(t))).then((()=>ct(e,a,t))),(0,n.restoreMessageSend)(c,o,u.hash,e.get().gid).then((()=>{c>u.lastmsg&&(0,n.loadActualLastMessage)(e,o).then((()=>i().updateState(o,e)))})),!1}function rt(e,t){if(e){var a=e.querySelector(re);toggleClass(a,"im-navigation_loading",t)}}function st(e,t){if(e){var a=e.querySelector(re);toggleClass(a,"im-navigation_loading",t)}}function ot(e,t,a,i){var r=t.get().peer,s=(0,d.getTab)(t,r);if((0,l.isFullyLoadedTab)(t,r)){var o=Object.keys(s.msgs).find((e=>{var t=s.msgs[e];return!Array.isArray(t)&&(0,g.isUnread)(s,t)}));if(!s.skipped)return o?Ye(i,a,o,t):i.scrollBottom(ie),Je(t,a),Ze(t,a),Ct(t,r,0,a,e),void(0,n.readTillSpecificMessage)(s.lastmsg,r,t.get());rt(a,!0),t.set((e=>(0,n.loadPeer)(r,!0,-1,!1,e,"goToEnd"))).then((()=>{rt(a,!1),e().changePeer(t,!1,!1)}))}}function lt(e,t,a,i){var r=t.get().peer,s=(0,d.getTab)(t,r),o=s.mentions,l=(void 0===o?[]:o)[0];if(!s.skipped)return l&&Ye(i,a,l,t,ve),Je(t,a,!0),Ze(t,a),Ke(t,l),void Ct(t,r,0,a,e);rt(a,!0),t.set((e=>(0,n.loadPeer)(r,!0,l,!1,e,"goToMention"))).then((()=>{rt(a,!1),e().changePeer(t,!1,!1),r===t.get().peer&&(Ye(i,a,l,t,ve),Ke(t,l))}))}function ct(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,l.isClassicInterface)(e)){var i=t.contHeight(),r=geByClass1("_im_chat_input_w",a),s=geByClass1("_im_chat_resize",a);if(!1!==(n=!1!==n?n:(0,l.getClassicChatHeight)())&&n>0){var o=window.clientHeight(),c=geByClass1("_im_chat_audio_input_parent",a),d=Pe(n,a,o),u=hasClass(c,ue)||hasClass(c,de),g=u?c:geByClass1("_im_chat_input_parent",a),m=d-g.offsetHeight;s.style.height=o-d-15+"px",setStyle(r,{top:m+"px",bottom:"auto"})}else s.style.height="0px",setStyle(r,{top:"auto",bottom:"0px"});var _=geByClass1("_im_peer_history_w",a);return setStyle(_,{borderBottomWidth:r.offsetHeight-15-1}),t.contHeight()-i}var p=t.getScrollHeight();t.update(!1,!0);var h=t.getScrollHeight();return p-h}function dt(e,t,a,n){var i=t.offsetHeight;n(),e.heightIncreased(t.offsetHeight-i,a)}function ut(e,t){var a=t.getBoundingClientRect().top;(0,U.showTooltip)(t,{className:"im-page--admin-tt",text:(0,J.getLang)("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:a>200})}function gt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];hasClass(e,"im-navigation_shown")&&(t&&addClass(e,"im-navigation_fast"),removeClass(e,"im-navigation_shown"),t&&(e.offsetHeight,removeClass(e,"im-navigation_fast")))}function mt(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.querySelector(re);e.set(n.updateGoToEndVisibility.bind(null,[!1,0])),gt(i,a)}function _t(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.querySelector(se);e.set(n.updateGoToMentionVisibility.bind(null,[!1,0])),gt(i,a)}function pt(e,t,a){m.screenfull.isFullscreen||0===t.get().peer||(0,l.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function ht(e,t){var a=e.get(),i=a.peer,r=domClosest(ge,t.target),s=intval(domData(r,"msgid")),o=(0,d.getMessage)(e,i,s),c=o&&(0,g.isServiceMsg)(o)&&o.kludges.source_act;if(c===l.CHAT_PIN_MESSAGE||c===l.CHAT_UNPIN_MESSAGE){var u=r.querySelector(".im_srv_mess_link");if(u&&"A"!==u.tagName){var m=o.kludges.source_chat_local_id;if(!m||Ie[m])return;Ie[m]=(0,n.getMessageLocalId)(i,m,a).then((e=>{var t=te(e,1)[0];if(t){var a=`/im?sel=${(0,l.convertPeerToUrl)(i)}&msgid=${t}`,n=u.innerHTML;domReplaceEl(u,(0,l.serviceLink)(a,n,!0,me)),delete Ie[m]}}))}}}function vt(e,t,a){var n=e.get(),i=n.peer,r=a.target.href&&a.target.href.match(/msgid=([\d]+)/),s=r&&r[1];"A"!==a.target.tagName||!s||(0,l.isAlreadyDeleted)(e,i,s)||checkEvent(a)||((0,d.getMessage)(e,i,s)?(e.setState({msgid:s}),(0,P.updateLocation)({msgid:s}),t().focusOnMessage()):n.longpoll.push([(0,k.changePeer)(i,s,!1,!1,n.currentEntryPoint||"")]));cancelEvent(a)}function ft(e){var t=(0,o.getCurrentTab)(e);(0,l.isChatPeer)(t.peerId)&&(t.pinHideId=cur.imDb.select(B.PIN_HIDDEN_ID_OP,t.peerId))}function bt(e,t,a,n,i){e.setState({isEditing:!1}),removeClass(n,"im-mess_is_editing"),removeClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackFilter("cancel_edit"),a.setDraft(e,(0,s.getPeer)(e)?(0,d.getTabDraft)((0,o.getCurrentTab)(e)):null),a.toggleStickers(e,!0),a.restoreKeyboard(),yt(t)}function yt(e){(0,u.toArray)(geByClass("_im_history_tooltip",e)).forEach(hide)}function Ct(e,t,a,i,r){var s=(0,d.getTab)(e,t);if(!(Date.now()-(s.lastReset||0)<1e3)&&(s&&s.msgs&&s.history&&!Te&&s.offset>300&&0==s.skipped&&a<50&&a>=0&&0===(e.get().selectedMessages||[]).length)){var o=Object.keys(s.msgs).filter((e=>e>0)).sort(((e,t)=>e-t)).slice(0,-50),l=o.slice(-1)[0];e.mutate(n.resetTabAll.bind(null,t)),e.set(n.removeMessages.bind(null,o,t)).then((()=>r().removeStartingFromMessage(l,t,e)))}}function wt(e,t,a,n){var i=n.target,r=domClosest(pe,i),s=Number(r.getAttribute("data-msgid")),o=domClosest("im-mess",i),c=Number(o.getAttribute("data-msgid")),d=e.get().peer;s&&!(0,l.isAlreadyDeleted)(e,d,s)?(e.setState({msgid:s}),(0,P.updateLocation)({msgid:s}),(0,l.focusOnMessage)(e,t().focusOnMessage,d,s)):c&&(0,l.showRepliedBox)(e,c,n)}function St(e){checkEvent(e)||cancelEvent(e)}function Et(e,t){var a=domClosest(_e,t);if(a){var i=Number(a.getAttribute("data-msgid")),r=e.get().peer,s=(0,d.getMessage)(e,r,i);i&&s&&!(0,g.isOut)(s)&&!(0,$.isVoiceMessageListened)(s)&&(0,n.markAudioMessageAsListened)(r,i,e.get())}}function Tt(e,t,a){var n=a.target.closest("."+l.MESSAGE_KEYBOARD_BUTTON_CLASS),i=a.target.closest("."+l.MESSAGE_STACK_CLASS);if(n){var r=e.sendMessageFromKeyboard.bind(null,(()=>e)),s=(0,c.getActionObjectFromElement)(n),u=i?i.dataset.peer:void 0,g=a.target.closest("._im_mess"),m=(0,o.getCurrentTab)(t);if(!g||!n||!m)return;var _=Number(g.dataset.msgid),p=(0,d.parserMessage)(_?m.msgs[_]:m.pinned);if(!p)return;return(0,c.handleButtonClick)(s,r,t,{keyboardAuthorId:u,peerId:p.peerId,message:p,onBeforeSend:()=>{(0,l.setCallbackButtonLoadingState)(n,!0)},onSendSuccess:e=>{var a={timeout:setTimeout((()=>{t.set((t=>(0,Q.unsetPressedCallbackButton)({peerId:p.peerId,eventId:e},t))).then((()=>(0,l.setCallbackButtonLoadingState)(n,!1)))}),c.CALLBACK_TIMEOUT_MS),onCallback:()=>{var e,t=Number(n.dataset.index);document.contains(n)?e=n:isNaN(t)||(e=(0,l.getCallbackButton)(document,Number(p.messageId),t)),e&&(0,l.setCallbackButtonLoadingState)(e,!1)}};t.set((t=>(0,Q.setPressedCallbackButton)({peerId:p.peerId,eventId:e},a,t)))},onSendFail:e=>{e.error_msg&&(0,c.handleShowSnackbar)({peerId:p.peerId,store:t,text:e.error_msg}),(0,l.setCallbackButtonLoadingState)(n,!1)}})}}function It(e,t){var a=t.target.closest("._im-call-snippet"),n=a.closest("."+be),i=a.dataset.type,r=a.dataset.participants,s=r&&r.split(",").reduce(((t,a)=>(+a!==e.get().id&&(0,l.isUserPeer)(+a)&&t.push(+a),t)),[]),o=+n.dataset.peer;(0,l.isCallToPeerAvailable)(e,o)&&(0,l.startCallFromIm)(e,o,"video"===i,s,l.CALL_ENTRY_POINT_SNIPPET)}function Lt(e,t,a){kt(e,t,a.target.closest("._im_mess_pinned"))}function kt(e,t,a){var n=+a.dataset.msgid,i=(0,d.getMessage)(e,e.get().peer,n),r=(0,D.canMessageBeEdited)(e,i);r!==a.classList.contains(we)&&(a.classList.toggle(we,r),(0,l.updateMessageInCache)(e,t,a))}function Mt(e,t,a,i,c,m,_,h,v,f,y,C,w,S,E,T,I,L){var A,P=(0,u.throttle)((function(){a.smoothScroll(...arguments)}),300);return{fixKeyboard(){c.fixKeyboard()},removeUnpinnedMessageEditable(e,a){var n=t.querySelector(`._im_mess_pinned:not(._im_mess_${a}`);n&&(n.classList.remove(Ce),kt(e,t,n))},changePeer(e){var u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],_=e.get().peer;if(revertLastInlineVideo(t),0===_)return E.disable(),c.setDraft(e,null),function(e){addClass(e,"im-page--history_empty"),Oe(e).innerHTML=""}(t);if((0,l.isFullyLoadedTab)(e.get(),e.get().peer)){removeClass(t,"im-page--history_search"),e.set(n.dropSelection),i.changeActions(e),i.showActions(e);var p=e.get().prevPeer;removeClass(t,"im-page--history_loading"),toggleClass(t,"im-page--history_vkcomgroup",(0,l.isFvkcomgroup)(e,_)),u?c.setDraft(e,(0,d.getTabDraft)((0,o.getCurrentTab)(e))):c.updateState(e),Je(e,t),Ze(e,t),m().updateTyping(_,e),$e(e,0,i),(0,l.isReservedPeer)(p)&&!(0,l.isReservedPeer)(_)?function(e,t,a,n,i,r,s,o,l,c,d){removeClass(e,"im-page--history_empty"),He(e,t,a,n,i,r,s,o,l,c,d)}(t,e,_,a,m,i,h,T,L,g,E):(0,l.isReservedPeer)(p)||(0,l.isReservedPeer)(_)||He(t,e,_,a,m,i,h,T,L,g,E),(0,d.isCasperChat)(e,_)||(E.enable(),E.toggle(!0),E.reset(a)),(0,l.isReservedPeer)(_)||setTimeout((()=>{Ve(e,m,Oe(t),w,E,t,0,a)})),(0,l.ensureDomHasActions)(t),(0,s.getPeer)(e)===r.VK_OFFICIAL_PEER_ID&&(0,z.collectOnboardingFindFriendsShowStats)(e.get().viewer_id)}},preparePeer(e){var a=(0,s.getPeer)(e);ft(e),c.setDraft(e,(0,d.getTabDraft)((0,d.getTab)(e,a)),!1),m().updateTyping(a,e),m().hideError(),i.renderPeer(e),T.renderPeer(e),i.hideActions(e),h.changePeer(a,e),$e(e,0,i),E.toggle(!1),mt(e,t,!0),_t(e,t,!0)},saveScroll:e=>je(e,a),loadingPeer(e){(0,n.isAnythingLoading)(e.get())||(removeClass(t,"im-page--history_empty"),addClass(t,"im-page--history_loading"))},stopLoading(e){removeClass(t,"im-page--history_loading")},deselectDialog(e){_().removeSelection(e)},replaceMessageAttrs(e,a){(0,l.replaceMessageAttrs)(a.get(),Oe(t),e)},cleanSelection(e){f.cleanSelection(e)},updateDialogFilters(e){_().updateDialogFilters(e)},getSearchResulstModule:()=>A,showSearchResults(e){e?(removeClass(t,"im-page--history_search-empty"),Oe(t).innerHTML=e):(addClass(t,"im-page--history_search-empty"),Oe(t).innerHTML=(0,l.renderEmptySearch)())},insertSearch(e,n){A||(i.deselectAll(n),A=(0,b.mount)(t,n,"message_search")),addClass(t,"im-page--history_search"),m().showSearchResults(e),ct(n,a,t),a.scrollBottom(0),Je(n,t),Ze(n,t),E.reset(a)},updateChatTopic(e,t){_().updateDialog(e,t),e===t.get().peer&&(i.renderPeer(t),i.renderActions(t),T.renderPeer(t))},updateActions(e){i.changeActions(e)},updateChatPhoto(e,n,r){if((0,l.isPeerActive)(e.peerId,r.get())){i.renderPeer(r),T.renderPeer(r);var s=at(a);(0,l.addChatPhotoToUpdate)(e,n,r.get(),Oe(t)),s&&a.scrollBottom(ie)}},markImportant(e,a,n){De(t,e)&&(i.changedMessageSelection(n),v.markImportant(e,a,n))},isNewMessagesVisible:e=>function(e,t){return(0,d.getUnreadScrollBottom)(e)>=intval(t.scrollBottom())}(e,a),loadHistory(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=i.get();if((0,l.isPeerActive)(e,s)){var o=r||s.tabs[e].historyToAppend;if(!o)return;var c=geByClass1("_im_peer_history",t),d=domFC(c),u=a.scrollBottom(),g=n.reversed?e=>c.appendChild(e):e=>c.insertBefore(e,d),m=0;n.reversed&&(m=c.offsetHeight);var _=sech(o),p=document.createDocumentFragment();_.forEach((e=>p.appendChild(e))),g(p),n.reversed&&E.heightIncreased(c.offsetHeight-m,a),n.reversed||a.scrollBottomFixSave(u),a.update(!1,!0);var h=_.filter((e=>hasClass(e,"_im_bar_date")));E.parseMore(h,a),(0,l.ensureDomHasActions)(t)}},sendMessage(e){0!==e.get().peer&&c.sendMessage()},editMessage(e,n){if((0,l.isFullyLoadedTab)(e,n.peerId)&&(0,l.isPeerActive)(n.peerId,e.get())){if(!De(t,n.messageId))return;je(e,a),(0,l.editAndReplaceMessage)(e.get(),n,t),Ue((0,d.getTab)(e,n.peerId),a),i.reRenderPinned(e),E.reset(a)}},addMessage(e,i){if(!(0,n.isSearchingInplace)(i.peerId,e.get())&&(0,l.isFullyLoadedTab)(e,i.peerId)&&(0,l.isPeerActive)(i.peerId,e.get())){if(De(t,i.messageId))return;var r=Oe(t);dt(E,r,a,(()=>{var n=at(a),s=geByClass1("_im_unread_bar_row",t),o=te((0,l.isMessagesVisible)(e,t,a),2),c=o[0],u=o[1];(0,l.appendToHistory)(e.get(),i,r,!0,!0,!c&&!s),removeClass(t,"im-page--history_empty-hist");var _=(0,d.getTab)(e,e.get().peer),p=(0,g.isServiceMsg)(i)&&i.userId===vk.id,h=i.kludges&&i.kludges.source_act,v=p&&h!==l.CHAT_PIN_MESSAGE&&h!==l.CHAT_UNPIN_MESSAGE;_.skipped||c||!(0,g.isUnread)(_,i)||(0,g.isOut)(i)||(Je(e,t,!0,u),Ze(e,t,!0,u)),(i.local||n||v)&&a.scrollBottom(0),m().updateTyping(i.peerId,e),et(t,e),yt(t)}));var s=domPS(domLC(r));if(hasClass(s,"_im_bar_date")){var o=ce("div");o.innerHTML=s.outerHTML,E.parseMore(o,a)}m().hideError(),E.update(a),(0,n.updateMentions)(e.get()),Ct(e,i.peerId,a.scrollBottom(),0,m),this.updateObserver()}},setMessageErrored(e,a,n,i){n&&"string"==typeof n&&m().showError(n),(0,l.setMessageError)(e,a,t)},markMessagesAsRead(e,a){e.get().peer===a.peerId&&(0,l.markMessagesAsRead)(e.get(),a.peerId,t)},compensateHistoryHeightChange(e){a.scrollTop(a.scrollTop()+e*Ae(C))},updateTyping(e,a){if(!(0,n.isSearchingInplace)(e,a.get())){var i=a.get();if(i.peer===e&&(0,l.isFullyLoadedTab)(i,e)){var r=(0,l.formatTyper)((0,d.getTab)(a,e).activity,e,!1,i),s=geByClass1(l.TYPING_CLASS,t);if(s||r){if(!s){var o=geByClass1("_im_typer_c",t);val(o,getTemplate("im_typing",{cls:(0,l.isClassicInterface)(a)?"im-activity_classic":""})),s=geByClass1(l.TYPING_CLASS,t)}val(geByClass1("_im_typing_name",s),r);var c=(0,l.loadSummaryActivityType)((0,d.getTab)(a,e).activity||{})===n.ACTIVITY_TYPE_RECORDING_AUDIO;s.setAttribute("data-activity-type",c?"recording":"typing"),r?(addClass(s,"im-page--typing_vis"),m().hideError()):removeClass(s,"im-page--typing_vis")}}}},scrollFix(e,t,n){E.heightIncreased(n,a),E.update(a),(0,l.isPeerActive)(t,e.get())&&at(a,n)&&a.scrollBottom(ie)},goToEnd(){ot((()=>this),C,t,a)},updateGoToEnd(e,n){var i=(0,d.getTab)(e,e.get().peer);i&&(i.skipped||i.unread)?Je(e,t):mt(e,t,n),y(0,a,!1);var r=e.get().peer;setTimeout((()=>{e.get().peer===r&&je(e,a)}))},updateGoToMention(e,n){var i=(0,d.getTab)(e,e.get().peer),r=(i||{}).mentions,s=(void 0===r?[]:r)[0];i&&s?Ze(e,t):_t(e,t,n),y(0,a,!1);var o=e.get().peer;setTimeout((()=>{e.get().peer===o&&je(e,a)}))},newMessage(e){_().newMessage(e),mt(e,t,!0),_t(e,t,!0)},scroll(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==e.get().peer){var r=n?a.getScrollHeight():40;!0===i&&(r=a.contHeight()),r="up"===t?-r:r,n||i?P(r,(()=>{y(r,a)})):(a.scrollTop(a.scrollTop()+r),y(r,a))}},showCreation(e,t){_().showCreation(e,t)},updateScroll:()=>ct(C,a,t),toggleBarDate(e){E.toggle(e)},changedMessageSelection(e){i.changedMessageSelection(e)},updateOnline(e,t){(0,l.isTabLoaded)(t.get(),e)&&e===t.get().peer&&i.renderPeer(t)},isEmpty:e=>c.isEmpty(e),replaceAttachmentPlaceholders(e,n){if((0,l.isPeerActive)(n.peerId,e.get()))dt(E,Oe(t),a,(()=>{var r=at(a);(0,l.replaceAttaches)(t,n,e.get());var s=(0,d.getTab)(e,n.peerId);if(s.mediacontent[n.messageId].length>=3&&s.mediacontent[n.messageId][2].pinned){var o=(0,d.parserMessage)(s.pinned);o&&o.messageId==n.messageId&&(s.pinned=s.mediacontent[n.messageId][2].pinned,i.reRenderPinned(e))}r&&a.scrollBottom(0)})),E.update(a);else if((0,g.isMoneyRequest)(n)){var r=(0,d.getTab)(e,n.peerId);if(r.mediacontent[n.messageId].length>=3&&r.mediacontent[n.messageId][2].pinned){var s=(0,d.parserMessage)(r.pinned);s&&s.messageId==n.messageId&&(r.pinned=r.mediacontent[n.messageId][2].pinned)}}},replaceBotCarouselPlaceholder(e,n){var i=e.get();(0,l.isPeerActive)(n.peerId,i)&&(dt(E,Oe(t),a,(()=>{var e=at(a);(0,l.replaceCarousel)(t,n,i),e&&a.scrollBottom(0)})),E.update(a))},removeMessages(e,n,r){r.get().peer===n&&((0,l.removeMessages)(e,Oe(t)),(0,l.removeExpiredMessagesStub)(e,Oe(t)),ct(r,a,t),i.changedMessageSelection(r),this.updateObserver())},removeStartingFromMessage(e,n,r){if(r.get().peer===n){var s=Oe(t),o=geByClass1("_im_mess_"+e,s);(0,l.removeStartingFromMessage)(o,s),ct(r,a,t),i.changedMessageSelection(r)}},hideGoToEnd(e){mt(C,t,e)},hideGoToMention(e){_t(C,t,e)},removeMessagesRestore(e,a,n,i){i.get().peer===a&&(0,l.removeMessagesWithRestore)(e,a,n,Oe(t))},removeExpiredFailedMessages(e){C.get().peer===e&&C.set(n.removeExpiredFailed.bind(null,Oe(t),e))},handleMessageExpiration(e){(0,l.isFullyLoadedTab)(C.get(),e.peerId)&&((0,l.replaceExpiredMessageWithPlaceholder)(C,t,e),(0,l.replaceExpiredRepliedMessageWithPlaceholder)(t,e),c.detachMessages(e))},updateState(e,t){_().updateState(e,t)},updateBanner(e){T.renderPeer(e)},updateHeader(e){i.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(i.changeActions(e),i.renderPeer(e),i.renderActions(e),T.renderPeer(e),c.updateState(e),(0,n.updateMentions)(e.get()))},updateConvoInList(e,t){_().updateConvoInList(e,t)},focustTxt(e){c.focusOn(e)},startSearch(e){e.get().peer&&(m().showSearch(e),h.changePeer(e.get().peer,e),h.search())},showSearch(e){addClass(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),ke(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout((()=>h.focus(e)),10)},cancelSearch(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.get().searchShown&&(removeClass(t,"im-page--hisory_search-open"),removeClass(t,"im-page--history_search"),removeClass(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),ke(e)&&this.updateChatTopic(e.get().peer,e),i.changedMessageSelection(e)),r&&!(0,l.isReservedPeer)(e.get().peer)&&A){var s=e.get().tabs[e.get().peer],o=(0,n.strHistory)(s.history);o?Oe(t).innerHTML=o:m().showEmptyScreen(),ct(e,a,t),a.scrollBottom(0),e.get().msgid&&(Ye(a,t,e.get().msgid,e),Je(e,t),Ze(e,t)),w(a),E.reset(a)}A&&(A.unmount(),A=!1,(0,l.ensureDomHasActions)(t))},showEmptyScreen(){var e=geByClass1("_im_peer_history",t);addClass(t,"im-page--history_empty-hist");var a=(0,ee.renderHistoryStub)(C);val(e,a)},updateHistory(e){0!==C.get().peer&&e(t)},focusOnMessage(){Ye(a,t,C.get().msgid,C)},sendEditMessage(e,t){e.set(n.deliverEditedMessage.bind(null,(0,d.getTab)(e,t.peerId),t)).catch((a=>e.get().longpoll.push([(0,k.failedMessage)(t.peerId,t,a)])))},renderStickersPanel(e){var a=(0,s.getPeer)(e),i=(0,d.getTab)(e,a);if(i){var r=(0,G.partConfigEnabled)("empty_tab_history_check")?(0,n.strHistory)(i.history||""):(0,n.strHistory)(i.history),o=t.querySelector("._im_stickers_panel_placeholder");o&&!r&&domReplaceEl(o,(0,ee.prepareEmptyDialogStickersTemplate)(e))}},unmount(){(0,p.destroyModule)(e),a.destroy(),clearInterval(S),c.unmount(),i.unmount(),v.unmount(),f.unmount(),h.unmount(),E.unmount(),cancelStackFilter("forward"),function(e,t){(0,M.removeDraggable)(geByClass1(e,t))}("_im_chat_resize_track",t),L.destroy()},removePeer(e,t){_().removePeer(e,t)},restoreScroll(e,t){var n=e.get().tabs[t];n.scrollBottom?Ue(n,a):a.scrollBottom(ie)},resendMessage(e,a){e===C.get().peer&&(0,l.startResendMessage)(e,a,t)},resendPeer(){c.resendPeer()},resendAll(){c.resendAll()},respond(e,t){c.attachMessages(e,t),c.focusOn(e);var n=(0,d.getTab)(e,t);n&&!n.skipped&&(a.scrollBottom(ie),w(a))},cancelRecording(){c.cancelRecording()},flushDraft(e){c.saveText(e)},hideError(){geByClass1(oe,t).classList.remove(le)},showError(e){var n=geByClass1(oe,t);n.innerHTML=e,n.classList.add(le),a.scrollBottom(ie)},startEditing(e){if((0,n.isAnythingLoading)(C.get()))(0,l.showWaitUntilUploadedBox)();else{e=(0,d.parserMessage)(e);var a=(0,l.getNowEditingMessage)(C);if(!(c.isBlocked()||a&&a.messageId==e.messageId)){a&&this.cancelEditing(),yt(t),C.get().searchShown&&this.cancelSearch(C);var r=De(t,e.messageId);r&&(this.cancelRecording(),function(e,t,a,n,i){e.setState({isEditing:!0}),a.saveText(e),addClass(n,"im-mess_is_editing"),addClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackPush("cancel_edit",(()=>bt(e,t,a,n)));var r=new x.ImDraft;r.dData.txt=(0,D.convertEmojiHtmlToRegularText)(i.text),r.dData.attaches=(0,N.convertKludgesToAttaches)(i.kludges,i.messageId),a.toggleStickers(e,!1),a.setDraft(e,r),setTimeout((()=>a.focusOn(e)),0)}(C,t,c,r,e),c.hideKeyboard(),i.deselectAll(C))}}},cancelEditing(){var e=(0,l.getNowEditingMessage)(C);e&&bt(C,t,c,De(t,e.messageId))},messageKeyboardButtonClick:e=>Tt(c,C,e),getEditingMessage:()=>(0,l.getNowEditingMessage)(C),focusEditingMessage(){var e=(0,l.getNowEditingMessage)(C);e&&Ye(a,t,e.messageId,C),c.focusOn(C)},setNetworkWaitingStatus(e,t){i.setNetworkWaitingStatus(e,t)},setNetworkReconnectingStatus(e){i.setNetworkReconnectingStatus(e)},clearNetworkStatus(){i.clearNetworkStatus()},updateCasperMessageStatus(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,l.isFullyLoadedTab)(C.get(),e.peerId)&&C.set(n.updateCasperMessageExpiringStatus.bind(null,e,a)).then((()=>{C.get().peer===e.peerId&&(0,l.setCasperMessageExpiringStatusDOM)(t,a,e.messageId)}))},updateObserver(){I.update()},renderPeerProfile(e){L.render(e)},destroyPeerProfile(){L.destroy()},showNewConvoStickersHints(e){_().showNewConvoStickersHints(e)}}}function At(e,t,a,c,_){var b=geByClass1("_im_peer_history_w",e);(0,q.hasAccessibilityMode)()&&addClass(b,"history_a11y");var L,A,P,B=(0,p.createMutations)(Mt),D=B.callMutations,x=B.bindMutations,N=(L=je.bind(null,t),A=(0,j.debounce)(L,100),P=(0,u.throttle)(L,100),e=>{A(e),P(e)}),F=(0,I.mount)(t,e),O=Ve.bind(null,t,D,b,N,F,e),H=(0,T.createScroll)(geByClass1("_im_chat_body_abs",e),{onScroll:O,nativeScroll:(0,l.isClassicInterface)(t),shadows:!1}),$=(0,l.isClassicInterface)(t)?void 0:H.scroll.container,Q=(0,w.mount)(t,$,(e=>function(e,t,a){var i=(0,o.getCurrentTab)(e);if(i){var r=a.reduce(((t,a)=>{if(a.isIntersecting){var n=+a.target.getAttribute("data-msgid")||+a.target.getAttribute("data-last-msgid"),r=(0,d.getMessage)(e,i.peerId,n);n&&r&&!(0,g.isOut)(r)&&t.push(n)}return t}),[]);if(r.length){var s=Math.max(...r);Ke(e,s).then((()=>{s===i.lastmsg&&e.set((e=>(0,n.setActions)(e))).then((()=>t().updateActions(e)))}))}}}(t,D,e))),ee=(0,h.mount)(geByClass1("_im_dialog_actions",e),t,D);setTimeout((function(){var a=t.get().peer;if(a){if(ft(t),((0,o.getCurrentTab)(t).pinned||(0,o.getCurrentTab)(t).top_banner)&&(D().updateChatTopic(a,t),t.set(n.setActions),ee.changeActions(t)),(0,o.getCurrentTab)(t).callInProgress&&D().updateBanner(t),t.get().msgid)Ye(H,e,t.get().msgid,t);else if(!We(H,e,D,t,F)){H.scrollBottom(ie);var i=(0,o.getCurrentTab)(t);(0,l.isTabMarkedUnread)(i)&&t.set((e=>(0,n.markDialogRead)(i.peerId,e)))}t.get().history_init=!1,(0,d.isCasperChat)(t,a)?F.disable():F.reset(H),Je(t,e),Ze(t,e),Ve(t,D,b,N,F,e,0,H),(0,l.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(n.setInplaceSearch.bind(null,nav.objLoc.st,a)),D().startSearch(t)),window.nav.objLoc.open_settings&&(ee.showSettings(t),delete window.nav.objLoc.open_settings,window.nav.setLoc(window.nav.objLoc))}else F.disable()}),15);var te=(0,v.mount)(geByClass1("_im_text_input",e),t,(0,l.isClassicInterface)(t)?c.updateMenu:void 0,((e,t)=>{a.removeDialog(e,t),a.restoreDialogs(e,!0)}),D),ae=(0,f.mount)(geByClass1("_im_dialog_actions",e),t,D),ne=(0,y.mount)(e,t,D),le=(0,C.mount)(e,t,(()=>({changedMessageSelection:ee.changedMessageSelection}))),ce=(0,S.mount)(b);(0,E.mount)(e,t,D);var de=(0,R.mount)(e,t,(()=>({hidePinned(){(0,E.pinnedMessageHide)(t,t.get().peer,D,!1)},compensateHistoryHeightChange(e){D().compensateHistoryHeightChange(e)},showPinned(){(0,E.pinnedMessageUnHide)(t,t.get().peer,D,!1)},showMessageRequestRejectDialog(t){!function(e,t,a,i,r){var s=(0,J.getLang)("mail_mr_reject_confirmation"),o=(0,V.oCacheGet)(e,r),c=`<div class="checkbox _im_is_spam_checkbox" onclick="checkbox(this);" role="checkbox" aria-checked="false">${(0,J.getLang)("mail_report_as_spam")}</div>`,d=o?o.first_name_gen:"",g=(0,K.showFastBox)((0,J.getLang)("mail_message_request_reject_request"),s.replace("{name}",d),(0,J.getLang)("mail_message_request_reject"),(()=>{var s=(0,Y.isChecked)(geByClass1("_im_is_spam_checkbox"),t),o=s?(0,J.getLang)("mail_message_request_rejected_and_spam"):(0,J.getLang)("mail_message_request_rejected");e.set((e=>(0,n.rejectMessageRequest)(r,s,e))).then((e=>{(0,l.isClassicInterface)(e)&&i.updateMenu(e),a.removeDialog(e,r),a.restoreDialogs(e,!0),r===e.get().peer&&e.get().longpoll.push([(0,k.resetPeer)()]),(0,l.hideAllBoxes)(),(0,W.showNotification)({text:o})})).catch((e=>{(0,l.hideAllBoxes)(),(0,u.showErrorBox)(e)}))}));g.setControlsText(c)}(t,e,a,c,t.get().peer)},showBusinessNotifyDialog:Xe})));(0,l.isReservedPeer)(t.get().peer)||t.set(n.restoreHistoryQueue.bind(null,t.get().peer)).then((()=>{(0,l.restoreQueue)(t.get().peer,t.get(),Oe(e)),Re(e,t,t.get().peer)})),AudioMessagePlayer.events.on("listened",Et.bind(null,t)),function(e,t,a){var n,i,r=geByClass1(e,t);(0,M.initDraggable)(r,{onStartDrag:(e,t)=>{addClass(bodyNode,"cursor_ns_resize"),n=t,i=t},onDrop:()=>{removeClass(bodyNode,"cursor_ns_resize")},onDrag:(e,r)=>{var s=Pe(i-n+r,t);(0,l.setClassicChatHeight)(s),a().fixHeight()}})}("_im_chat_resize_track",e,_);var ue=nt.bind(null,t,e,D),he=it.bind(null,t,e,H,D),ve=e=>{cancelEvent(e),function(e,t){e().showCreation(t)}(_,t)},we=ot.bind(null,D,t,e,H),Te=lt.bind(null,D,t,e,H),Ie=Fe.bind(null,t,e),Le=l.showEditTimeTooltip.bind(null,t),ke=l.showMessageInfoTooltip.bind(null,t),Me=Qe.bind(null,t,ue,e,D),Ae=Ne.bind(null,t,e,H),De=pt.bind(null,D,t,H),Ue=ht.bind(null,t),He=vt.bind(null,t,D),qe=wt.bind(null,t,D,e),Ge=Tt.bind(null,te,t),ze=xe.bind(null,D),et=l.showCasperExpiringTooltip.bind(null,t,e),tt=()=>showWiki({w:"expired_messages"}),at=It.bind(null,t),rt=e=>function(e,t){var a=t.target.closest("."+ye),n=a.closest("."+be),i=a.dataset.link,r=+n.dataset.peer;(0,l.isCallToPeerAvailable)(e,r)&&(0,l.joinCallFromIm)(e,r,i,!1,l.CALL_ENTRY_POINT_JOIN_SNIPPET)}(t,e),st=Lt.bind(null,t,e),ct=e=>function(e,t){var a=t.target.closest("._im_add_to_friends"),n=(0,s.getPeer)(e);if(!X.FlatButton.isLocked(a)&&n){var i=e.get().tabs[n].is_subscribed;X.FlatButton.lock(a),e.set((e=>(0,Z.setPeerSubscribedStatus)(n,i,e))).then((e=>{var t=(0,u.unpackStore)(e).tabs[n].is_subscribed,i=t?(0,J.getLang)("mail_friend_request_sent"):(0,J.getLang)("mail_add_to_friends"),r=t?X.FlatButtonAppearance.SECONDARY:X.FlatButtonAppearance.PRIMARY;X.FlatButton.unlock(a),X.FlatButton.setAppearance(a,r),X.FlatButton.setLabel(a,i)})).catch((()=>{X.FlatButton.unlock(a)}))}}(t,e),dt=e=>{var t=domClosest(Ee,e.target);if(t){var a=domClosest(l.MESSAGE_STACK_CLASS,t),n=parseInt(domData(a,"peer"),10)||null;window.reforgedME&&window.reforgedME.profileInfo&&n&&window.reforgedME.profileInfo.mountProfileInfo({peerId:n,targetElement:t})}},gt=(0,p.createModule)({handlers:(a,s)=>{s(e,"click",l.RESTORE_CLASS,he),s(e,"mouseover click",l.FAILED_CLASS,Ie),s(e,"mouseover","_im_edit_time",Le),s(e,"mouseover","_im_page_info",ke),s(e,"click","_im_mess_susp",Be.bind(null,e)),s(e,"click","_im_failed_action",Me),s(e,"click","_im_mess_link",Ae),s(e,"mouseover","_im_admin_name",ut),s(e,"mouseover",ge,Ue),s(e,"mouseover","im-mess-stack--bomb",et),s(e,"mouseover","mem_pseudolink",(e=>function(e,t){var a=e.target.dataset.mention,n=null;switch(!0){case r.MASS_MENTION_ALIASES.all.includes(a):n=(0,J.getLang)("mail_im_mention_all");break;case r.MASS_MENTION_ALIASES.online.includes(a):n=(0,J.getLang)("mail_im_mention_online")}n&&(window.tooltips&&window.tooltips.destroy(e.target),(0,U.showTooltip)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>(0,l.getHistoryTopIndent)(t)+37,text:n,noZIndex:!0}))}(e,t))),s(e,"mouseover",Ce,st),s(e,"click",me,He),s(e,"click",oe,ze),s(e,"click",pe,qe),s(e,"click","_im_replied_author_link",St),s(e,"click","_chat_invitation",((e,a)=>{if(checkEvent(e))return!0;if(!gpeByClass("wall_postlink_preview_btn",e.target)&&!hasClass(e.target,"wall_postlink_preview_btn"))return!0;var i=geByClass1("flat_button",a),r={invite_chat_id:domData(i,"inv-id"),invite_hash:domData(i,"hash")};(0,l.showInvitationBox)(t,r,n.leaveInvitation),cancelEvent(e)})),s(e,"click","_im_join_call_by_link",l.handleCallLinkClick),s(e,"click","_im_join_cancel",(()=>t.get().longpoll.push([(0,k.resetPeer)()]))),s(e,"click","_im_retry_media",(e=>function(e,t,a){var r=e.get(),s=domClosest(_e,a.target),o=domData(s,"msgid"),c=(0,d.getMessage)(r,r.peer,o),u=e=>t().replaceAttachmentPlaceholders(e,c);c&&((0,i.statlogsSendingRetry)("retry_attach"),e.set(n.addAttachmentsToStoreData.bind(null,c,[(0,l.renderMessageMedia)(e,c)])).then(u),e.set(n.loadMedia.bind(null,c)).then(u))}(t,D,e))),s(e,"click",l.MESSAGE_KEYBOARD_BUTTON_CLASS,Ge),s(e,"click",fe,at),s(e,"click",ye,rt),a(geByClass1("_im_peer_history_w",e),"mousemove",F.show),a(geByClass1("_im_start_new",e),"click",ve),a(e.querySelector(re),"click",we),a(e.querySelector(se),"click",Te),s(e,"click",Se,ct),a(geByClass1("_im_cancel_edit",e),"click",(()=>(D().cancelEditing(),!1))),a(geByClass1("_im_edit_focus_cur",e),"click",(()=>(D().focusEditingMessage(),!1))),m.screenfull.raw&&a(document,m.screenfull.raw.fullscreenchange,De),a(window,"im_goToMessage",(e=>{var a=intval(e.msgid);if(a)return window.statlogsValueEvent("im_links_to_attachments",1,"to_message"),t.set(n.changePeer.bind(null,e.sel,a,!1)).then((()=>(0,l.focusOnMessage)(t,D().focusOnMessage,t.get().peer,a)))})),s(e,"click","im-expired-message--in",tt),(0,G.partConfigEnabled)("mail_history_mention_popover")&&s(e,"mouseover",Ee,dt)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?(0,E.pinnedMessageHide)(t,e.peer,D,!1):(0,E.pinnedMessageUnHide)(t,e.peer,D,!1)}],window.showForwardBox=e=>function(e,t){(0,l.boxHandleMessagesLabelsTooltips)(showBox("al_im.php",t,{dark:1},{}),e)}(t,e);var mt=setInterval($e.bind(null,t,e,ee),1e4);(0,s.getPeer)(t)===r.VK_OFFICIAL_PEER_ID&&(0,z.collectOnboardingFindFriendsShowStats)(t.get().viewer_id);var _t=(0,s.getPeer)(t),bt=(0,d.getTab)(t,_t);return bt&&(0,o.tabIsMessageRequest)(bt)&&(0,z.collectOpenMessageRequestStats)(_t),x(gt,e,H,ee,te,D,_,ae,ne,le,O,t,N,mt,F,de,Q,ce)}},790829:(e,t,a)=>{"use strict";a.d(t,{mount:()=>c});a(991181),a(296253);var n=a(533246),i=a(929566),r=a(193483),s=a(91257),o=a(236205);function l(e,t,a){var n=a.get(),s=n.observer,l=n.targets;l.length&&l.forEach(s.unobserve.bind(s));var c=function(e,t){var a=(0,o.getPeer)(e);if(!(0,i.isFullyLoadedTab)(e,a))return[];var n=(0,i.getTab)(e,a);return Object.keys(n.msgs).reduce(((e,a)=>{var s=n.msgs[a],o=t||document;if((0,r.isUnread)(n,(0,i.parserMessage)(s))){var l=o.querySelector(`._im_mess_${a}`)||o.querySelector(`._im_expired_message_${a}`);l&&e.push(l)}return e}),[])}(e,t);a.setState({targets:c}),c.length&&c.forEach(s.observe.bind(s))}function c(e,t,a){var i=(0,s.default)({observer:new IntersectionObserver(a,{root:t}),targets:[]});l(e,t,i);var r=(0,n.createModule)({handlers:(e,t)=>{}});return{update(){l(e,t,i)},unmount(){var e=i.get(),t=e.observer;e.targets.forEach(t.unobserve.bind(t)),(0,n.destroyModule)(r)}}}},188765:(e,t,a)=>{"use strict";a.d(t,{mount:()=>p});a(940851),a(296253);var n=a(533246),i=a(503369),r=a(389430),s=a(901659),o="im_hist_search";function l(e,t,a,i,r,s){return{focus(e){uiSearch.focus(t),function(e,t,a,n){cancelStackPush(o,m.bind(null,e,t,a,n))}(e,t,a,i)},changePeer(e,a){uiSearch.getFieldEl(t).value=a.get().tabs[e].searchText||""},search(){s({})},unmount(){(0,n.destroyModule)(r),cancelStackFilter(o),i.then((e=>e.destroy()))}}}function c(e,t,a,n){e.set(r.setCurrentSearchDate.bind(null,e.get().peer,`${n.d}.${n.m}.${n.y}`)).then(u.bind(null,e,t,a))}function d(e,t){e.then((e=>{triggerEvent(geByClass1("datepicker_control",t),"mousedown",!1,!0)}))}function u(e,t,a){var n=e.get().peer;uiSearch.showProgress(a),(0,r.searchMessagesInplace)(n,e.get()).then((n=>{uiSearch.hideProgress(a),t().insertSearch(n,e),(0,s.updateCounters)(location.href,document.referrer)})).catch((()=>{uiSearch.focus(a),uiSearch.hideProgress(a)}))}function g(e,t,a,n,i,s){if("keyup"!==s.type||13==s.which){var o=clean(uiSearch.getFieldEl(t).value);e.set(r.setCurrentSearch.bind(null,o,e.get().peer)).then(i.bind(null,e,n,t))}}function m(e,t,a,n){cancelStackFilter(o),n.then((e=>{e.hide()})),e.set(r.cancelSearch.bind(null,e.get().peer)).then((()=>{uiSearch.getFieldEl(t).value="",a().cancelSearch(e)}))}function _(e,t,a,n){a.then((e=>{e.hide()})),e.set(r.clearDate.bind(null,e.get().peer)).then(u.bind(null,e,t,n))}function p(e,t,a){var r=geByClass1("_im_search_date_input",e),s=geByClass1("_im_search_history_input",e),o=function(e,t,a,n){var i='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+getLang("wall_clear_date_filter")+"</button></td>";return new Promise((e=>{stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(a,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+i+"</tr>",addRowsM:'<tr id="im_month_clear">'+i+"</tr>",onUpdate:n,pastActive:!0,noFuture:!0});e(t)}))}))}(0,0,r,c.bind(null,t,a,s)),p=d.bind(null,o,e),h=g.bind(null,t,s,r,a,(0,i.debounce)(u,300)),v=m.bind(null,t,s,a,o),f=_.bind(null,t,a,o,s),b=(0,n.createModule)({handlers:(t,a)=>{t(geByClass1("_im_search_date",e),"click",p),t(uiSearch.getFieldEl(s),"keyup",h),t(geByClass1("_im_start_inplace_search",e),"click",h),t(geByClass1("_im_cancel_inplace_search",e),"click",v),a(e,"click","_im_clear_date",f)}});return l(0,s,a,o,b,h)}},316417:(e,t,a)=>{"use strict";a.d(t,{mount:()=>T});var n=a(389430),i=a(663527),r=a(193483),s=a(929566),o=a(533246),l=a(393202),c=a(719016),d=a(172989),u=a(632910),g="_im_mess_fav",m="_im_mess_reply",_="_im_mess_forward",p="_im_mess_edit";function h(e,t,a,n,r){var s=(0,i.getHistoryTopIndent)(e);(0,c.showTooltip)(t,{shift:[a,10],black:1,className:"_im_history_tooltip "+n,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>s+37,text:r})}function v(e,t,a){var i=gpeByClass("_im_mess",a),o=intval(domData(i,"msgid")),l=e.get().peer,c=(0,s.getMessage)(e,l,o),u=!(0,r.isImportant)(c);return e.get().longpoll.push([{peerId:l,messageId:o,type:u?d.SET_FLAGS:d.RESET_FLAGS,flags:d.FLAG_IMPORTANT}]),e.set(n.favMessage.bind(null,[o],u,l)),f(e,-10,t,a,!0),!1}function f(e,t,a,n,i){var o=domData(gpeByClass("_im_mess",n),"msgid"),l=(0,s.getMessage)(e,e.get().peer,o),c=getLang("mail_im_unmark_important"),d=getLang("mail_im_toggle_important"),u=(0,r.isImportant)(l)?c:d,g=u.length>16;i&&window.tooltips&&tooltips.destroy(n),h(e,n,g?84:34,g?"im-star-tt_long":"im-star-tt",l?u:"")}function b(e,t,a,r){var s=e.get().peer,o=+domData(domClosest("im-mess",r.target),"msgid");if((0,i.canForwardMessages)(e,[o]))return(0,l.statlogsForwardFromChannel)(),(0,n.processFwd)([o],s,e).then((t=>e.set(n.prepareForward.bind(null,t)))).then((()=>{(0,u.mount)(a,e)})),!1}function y(e,t,a){var i=e.get().peer,r=+domData(domClosest("im-mess",a.target),"msgid");return(0,n.processFwd)([r],i,e).then((t=>e.set(n.forwardMessages.bind(null,t,e.get().tfdraft,!0)))).then((()=>t().respond(e,i))),!1}function C(e,t,a,n){h(e,n,18,"im-reply-tt",getLang("mail_im_mark_forward"))}function w(e,t,a,n){h(e,n,18,"im-reply-tt",getLang("mail_im_reply"))}function S(e,t,a,n){var i=intval(domData(gpeByClass("_im_mess",n),"msgid")),r=(0,s.getMessage)(e,e.get().peer,i);return r&&t().startEditing(r),!1}function E(e,t,a){h(e,a,18,"im-edit-tt",getLang("mail_im_edit"))}function T(e,t,a){var n=f.bind(null,t,0),r=v.bind(null,t),s=C.bind(null,t,0),l=b.bind(null,t,e.querySelector("_im_dialog_actions"),a),c=w.bind(null,t,0),d=y.bind(null,t,a),u=E.bind(null,t),h=S.bind(null,t,a),T=(0,o.createModule)({handlers:(t,a)=>{a(e,"click",g,r),a(e,"mouseover",g,n),a(e,"click",_,l),a(e,"mouseover",_,s),a(e,"click",m,d),a(e,"mouseover",m,c),a(e,"click",p,h),a(e,"mouseover",p,u)}});return function(e,t){return{markImportant(t,a,n){(0,i.updateStar)(t,a,e)},unmount(){(0,o.destroyModule)(t)}}}(e,T)}},766578:(e,t,a)=>{"use strict";a.d(t,{mount:()=>m});var n=a(229852),i=a(389430),r=a(663527),s=a(81020),o=a(91257),l=a(533246);function c(e){return e.which||e.keyCode}function d(e,t,a){!a||inArray(c(a),n.UNPRINTABLE_KEYS)||(0,i.isSearchingInplace)(e.get().peer,e.get())||(0,r.isEditableFocused)()||a.ctrlKey||browser.mac&&a.metaKey||a.key&&1!==a.key.length||t.signal("printable",a)}function u(e,t,a){c(a)===n.ENTER&&e.signal(c(a),a)}function g(e,t,a,i){var o=c(i);if(!layers.visible){if(o>=49&&o<=57&&(i.ctrlKey||i.metaKey&&browser.mac)&&(0,r.isClassicInterface)(t))return function(e,t){var a=e.get().tabbedPeers[t];a&&e.get().longpoll.push([(0,s.changePeer)(a.peer,!1,!0,!0,"right_menu")])}(t,o-49),cancelEvent(i);inArray(o,n.UP_DOWN_CONTROLS)&&e.signal(o,i)}}function m(e,t){var a=browser.mozilla?"keydown":"keypress",n=(0,o.default)({signalTimer:!1}),i=d.bind(null,e,t),r=g.bind(null,t,e,n),s=u.bind(null,t,n),c=(0,l.createModule)({handlers:e=>{e(document,"keydown",r),e(document,"keyup",s),e(document,a,i)}});return{unmount(){(0,l.destroyModule)(c)}}}},790899:(e,t,a)=>{"use strict";a.d(t,{mount:()=>u});a(940851),a(296253);var n=a(667294),i=a(973935),r=a(125462),s=a(800234),o=a(533246),l=a(389430);function c(){return document.getElementById("_im_keyboard_container")}function d(e,t,a){return{init(){return new Promise((e=>{this.isMounted=!0,function(e,t,a){var o=c();if(o){var l=n.createElement(s.default,{value:e},n.createElement(r.default,{send:t}));i.render(l,o,a)}}(t,a,e)}))},toggle:(e,a,n)=>t.set(l.toggleKeyboard.bind(null,e,a,n)),unmount(){var t=c();t&&this.isMounted&&i.unmountComponentAtNode(t),this.isMounted=!1,(0,o.destroyModule)(e)}}}function u(e,t,a,n,i){return(0,(0,o.createMutations)(d).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}}),t,n)}},449165:(e,t,a)=>{"use strict";a.d(t,{mount:()=>ke});a(579665),a(95767),a(530522),a(66108),a(175115),a(940851),a(820075),a(59357),a(21466),a(798184),a(176774),a(991181),a(296253),a(388416);var n=a(242127),i=a(155939),r=a(592388),s=a(654424),o=a(656829),l=a(420364),c=a(72739),d=a(536896),u=a(797399),g=a(799196),m=a(814116),_=a(371372),p=a(533246),h=a(591140),v=a(370935),f=a(172989),b=a(888469),y=a(569319),C=a(108010),w=a(435047),S=a(573084),E=a(907851),T=a(929566),I=a(193483),L=a(389430),k=a(393202),M=a(663527),A=a(229852),P=a(956642),B=a(766578),D=a(135685),x=a(713075),N=a(291445),R=a(472864),F=a(625859),O=a(503369),U=a(486353),H=a(985515),j=a(81020),q=a(841645),G=a(478153),z=a(351117),V=a(236205),K=a(992665),W=a(694405),Y=a(225350),$=a(987105),Q=a(216191),X=a(449046),J=a(966010),Z=a(324466),ee=a(537510);function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||ae(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e,t){if(e){if("string"==typeof e)return ne(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?ne(e,t):void 0}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function ie(e,t,a,n,i){var r,s=new Map,o=new Map,l=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=ae(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,r=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,i=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw i}}}}(i);try{for(l.s();!(r=l.n()).done;){var c=r.value;s.has(c.peerId)||s.set(c.peerId,new Set),s.get(c.peerId).add(c.messageId),o.set(c.messageId,c)}}catch(e){l.e(e)}finally{l.f()}s.forEach(((i,r)=>{var s=[...i],l=(0,T.getTab)(e,r),c=l&&!l.offset,d=l&&l.inplaceSearch&&!!l.searchOffset;e.set(L.removeMessages.bind(null,s,r)).then((()=>e.set(L.removeMessagesMarkDeleted.bind(null,s,r)))).then((()=>{if(e.get().peer===+r&&(0,M.isFullyLoadedTab)(e.get(),r)){var a=(0,T.getTab)(e,r);t.removeMessages(s,+r,e);var n=a.inplaceSearch;if(!a.offset&&!c&&((0,L.setActions)(e.get()),t.updateActions(e),n||t.showEmptyScreen()),n&&d&&!a.searchOffset&&(t.showSearchResults(),browser.safari)){var i=geByClass1("_im_peer_history_w");i.style.display="none",setTimeout((()=>i.style.display=""),0)}}})).then((()=>{var i=(0,T.getTab)(e,r);if(i){var l=s.some((e=>e>=i.lastmsg)),c=s.filter((e=>e>i.in_up_to&&!(o.get(e).flags&f.FLAG_OUTBOUND)));l?(0,L.loadActualLastMessage)(e,+r).then((()=>{a.promoteDialog(e,r),n&&n.updateCounter(e,r),r===(0,V.getPeer)(e)&&(t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0))})):c&&(0,q.removeDeletedUnreadMsgsFromTab)(r,c,e.get()).then((()=>a.updateDialog(r,e)))}}))}))}function re(e,t){"spam"===t?(0,M.showSpamLayer)(e,y.mount,{}):"fav"===t&&(0,M.showFavvedBox)(e,{},P.mount,{})}function se(e,t,a,n,i){e.forEach((e=>{switch(e.kludges.source_act){case M.CHAT_PHOTO_REMOVE:case M.CHAT_PHOTO_UPDATE:!function(e,t,a,n){t.set(L.updateChatPhoto.bind(null,e)).then((()=>{var i=e.kludges.source_act;a.updateDialog(e.peerId,t),n.updateChatPhoto(e,i,t)}))}(e,t,a,n)}}))}function oe(e,t){var a=e.get().longpoll.push.bind(null,[(0,j.resetPeer)()]),n=()=>{var i=e.get().selectedMessages;i&&i.length?(e.setState({selectedMessages:[]}).then((()=>{t.changedMessageSelection(e),t.cleanSelection(i)})),setTimeout((()=>cancelStackPush("im_peer",n)),0)):a()};cancelStackPush("im_peer",n)}function le(e){var t=e.attaches.filter((e=>"sticker"!==e.type&&"call"!==e.type));return(0,I.isServiceMsg)(e)||0===t.length}function ce(e,t,a){addClass(a,"im-page_history-show"),t.loadingPeer(e)}function de(e,t){var a=(0,M.getRightMenuMaxItems)(e,t.offsetHeight);if(e.get().tabbedPeers.length>a){var n=e.get().tabbedPeers.filter((t=>{var a=t.peer;return intval(a)!==e.get().peer})).map((t=>{var a=t.peer;return e.get().tabs[a]})).sort(((e,t)=>t.last_touched-e.last_touched)),i=[];0!==e.get().peer&&i.push(e.get().tabs[e.get().peer]);var r=i.concat(n).slice(a).map((e=>e.peerId)),s=e.get().tabbedPeers.filter((e=>!inArray(e.peer,r)));return e.set(L.updateTabbedPeers.bind(null,s,!0))}return Promise.resolve(e)}function ue(){for(var e=curBox();e;)e.hide(),e=curBox()}function me(e,t,a,n,i,r,s,o,l){e.get().audio_msg.isRecording&&e.set(L.cancelRecording).then((()=>{n.cancelRecording()})),AudioMessagePlayer.detachPlayer(),(0,T.isAnyMessageBeingEdited)(e)&&n.cancelEditing(),(0,T.isSearching)(e)&&t.cancelSearch&&(i.clearSearch(e),a.restoreDialogs(e),l().toggleSettingsButton(e,!1)),_e(e,o,l),ce(e,n,r);var c=e.get().peer;(0,L.updateMentions)(e.get()),(0,M.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!(0,T.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!(0,T.getMessage)(e,t.peerId,(0,T.getTab)(e,t.peerId).lastmsg)||(0,T.getTab)(e,t.peerId).skipped)&&e.mutate((e=>(0,T.makeTabNotFullyLoaded)(e,t.peerId)));var d=e.set(L.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then((e=>{var a=e.get();return a.tabs[t.peerId]?Promise.resolve(a):e.set((()=>(0,L.loadPeer)(t.peerId,!0,t.msgid,!1,a,"applyPeer")))})).then((()=>{if(a.selectPeer(t.msgid,e),function(e,t){(0,M.isPendingForward)(e)&&(cancelStackFilter("forward"),e.set(L.forwardMessages.bind(null,e.get().pendingForward,(0,T.getTabDraft)((0,T.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),ue(),n.preparePeer(e),oe(e,n),(0,M.isClassicInterface)(e)?(a.deactivate(),de(e,r).then((()=>s.updateMenu(e))),(0,J.updateFolderCounters)(e)):a.updateFolderCounters(e),!(0,M.isClassicInterface)(e)&&(0,z.isRecommendedConvo)(e,t.peerId)&&(0,_.isUserPeer)(t.peerId)&&!(0,_.isContactPeer)(t.peerId)){var i=((0,T.getTab)(e,t.peerId)||{}).online||0,o=(0,M.convertLegacyOnlineToAPIFlags)(i),l=o.is_online,c=o.is_mobile;e.set((e=>(0,q.updateRecommendedListItemOnline)(e,t.peerId,l,c))).then((e=>{a.updateRecommendedOnline(t.peerId,e)}))}}));return(d=t.msgid?d.then((()=>e.set(L.selectPeerOnMessage.bind(null,t.peerId===c,c)))):d.then((()=>e.set(L.selectPeer.bind(null,!0))))).then((()=>e.set(L.prepareCasperMessagesFromMessages.bind(null,t.peerId)))).then((()=>{if(e.get().peer===t.peerId){if(t.forward){var a=e.get().tabs[e.get().peer];if(!a.scrollBottom&&a.unread)((0,U.partConfigEnabled)("mail_history_unread_counter_observer")?Promise.resolve():e.set(L.readLastMessages.bind(null,e.get().peer))).then((()=>e.set(L.setActions))).then((()=>n.updateActions(e)));else!a.unread&&(0,T.isTabMarkedUnread)(a)&&e.set((e=>(0,L.markDialogRead)(t.peerId,e)))}(0,M.isClassicInterface)(e)&&s.updateMenu(e),n.changePeer(e,!1),n.updateTyping(t.peerId,e),n.removeExpiredFailedMessages(t.peerId),(0,U.partConfigEnabled)("mail_history_unread_counter_observer")&&n.updateObserver(),(0,L.updateMentions)(e.get()),l().showNewConvoStickersHints(e)}})).catch((e=>(0,x.imWeirdCatch)("applyNewPeer",e)))}function _e(e,t,a){t&&e.get().shown&&(t.hide(e),a().createCanceled(e))}function pe(e,t,a){(0,T.isSearching)(e)&&(t.clearSearch(e),a.restoreDialogs(e))}function he(e,t,a,n,i,r,s){e.setState({isCreating:!0}),(0,U.partConfigEnabled)("messages_chat_creation_new_interface")?(0,l.mount)(e).show():((0,M.isClassicInterface)(e)&&(i.saveScroll(e),r.saveScroll(e)),n.showCancelControl(),addClass(s,"im-page_creating"),a&&a.show(e,t),(0,M.isClassicInterface)(e)&&(setStyle(s,{height:Ee(s,e).page}),setTimeout((function(){addClass(s,"im-page_cropped")}),200))),(0,L.toggleConversation)(!0)}function ve(e,t,a,n){(0,M.isTabLoaded)(e.get(),n)&&(t.updateTyping(n,e),a.updateTyping(n,e))}function fe(e,t,a,n,i){n.activityType||(n.activityType=i);var r=e=>ve(e,t,a,n.peerId);(0,M.isSelfMessage)(n.peerId,e.get().gid)||(e.set(L.setActivity.bind(null,n,i)).then(r),e.set(L.waitActivity.bind(null,n,i)).then(r))}function be(e,t,a){var n=(0,T.getTab)(a,(0,z.getCurrentTab)(a));if(n&&!(0,z.isBusinessNotifyTab)(n)){var i="im-page_reconnecting";t?e.classList.add(i):e.classList.remove(i)}}function ye(e,t,a,n,i){(0,T.isMessageRequestChangedEvent)(t)?function(e,t,a,n){var i=(0,z.getCurrentTab)(e);switch(t.updateType){case f.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED:i&&i.peerId===t.updateArg&&e.get().longpoll.push([(0,j.changePeer)(t.peerId,!1,!1,!1,e.get().currentEntryPoint)]),e.set((e=>(0,L.deletedDialog)(t.updateArg,Promise.resolve([]),e))).then((()=>{a().removePeer(e,t.updateArg),a().updateDialogFilters(e)}));break;case f.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:var r=(0,T.getTab)(e,t.peerId);(!(0,U.partConfigEnabled)("simplified_start_conversation")||r&&(0,z.tabIsNotImportantMessageRequest)(r)?e.set((e=>(0,L.updateMessageRequestsCounter)(t,e))):e.set((e=>Promise.resolve(e)))).then((()=>{r&&t.updateArg===f.MESSAGE_REQUEST_STATUS_REJECTED&&(0,q.updateListedConvos)(e.get(),r,!0,(e=>e.filter((e=>e!==Number(t.peerId)))))})).then((()=>{(0,M.isClassicInterface)(e)?(0,J.updateFolderCounters)(e):n.updateFolderCounters(e),(0,M.checkMessageRequestsTab)(e,n.update),f.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&(0,M.isClassicInterface)(e)&&a().updateMenu(e),f.MESSAGE_REQUEST_STATUS_REJECTED===t.updateArg&&0===e.get().dialog_tabs[A.FOLDER_MESSAGE_REQUEST].length&&(0,T.isMessageRequestFolder)(e)&&e.get().longpoll.push([(0,j.changeTab)(A.FOLDER_ALL)])}))}}(e,t,a,i):(0,T.isBusinessNotifyChangedEvent)(t)?function(e,t,a,n){var i=e.set((e=>(0,q.resetFolderList)(e,Z.ConvoListFolder.BUSINESS_NOTIFY)));e.get().active_tab===Z.ConvoListFolder.BUSINESS_NOTIFY&&i.then((()=>e.set(L.loadDialogs))).then((()=>a().restoreDialogs(e,!0,!0)))}(e,0,a):(0,M.isTabLoaded)(e.get(),t.peerId)&&((0,N.handleEventChatUpdated)(e,t.peerId,t.updateType,t.updateArg,n,i)||!(0,M.isChatPeer)(t.peerId)||e.set((e=>(0,L.loadChatInfo)(t.peerId,e).then((e=>e.peer===t.peerId?(0,L.setActions)(e):Promise.resolve(e))))).then((()=>{a().updateChatInfo(t.peerId)})))}function Ce(e,t,a){var n=null;if(a.kludges.keyboard&&!a.kludges.keyboard.inline){var i=Object.assign(a.kludges.keyboard,{author_id:a.userId});n=e.set(L.setKeyboard.bind(null,a.peerId,i))}else{var r=(0,T.getKeyboard)(e,a.peerId);r&&r.one_time&&r.author_id!==(0,I.getAuthorId)(e,a)&&(n=e.set(L.deleteKeyboard.bind(null,a.peerId)))}a.peerId===(0,V.getPeer)(e)&&n&&n.then(t.fixKeyboard)}function we(e,t,a,n,i,r,s,o,c,d,u,_,h,v,b,y,C,w,S,P,B,x,N){var R=!1;return{changePeer(e,a){t.selectPeer(e,a)},cancelSearch(e){pe(e,n,t)},loadingPeer(e){ce(e,a,i)},restoreDialogs(e,a,n){t.restoreDialogs(e,a,n)},showChatInvitationBox(e,a){(0,M.showChatInvitationBox)(e,a,c,t)},toggleSettingsButton(e,t){null==u||u.toggleButton(e,t)},focusSearch(e){n.focusInput()},appendSearch(e,a,n,i){t.appendSearch(e,a,n,i)},appendDialogs(e,a){t.appendDialogs(e,a)},showCreation(e,r){he(e,r,d,n,t,a,i)},showCreationNew(){(0,l.mount)(_).show()},updateState(e,n){t.updateDialog(e,n),n.get().peer===e&&a.updateChat(n,e)},updateConvoInList(e,a){t.promoteDialog(a,e)},appendFastDialogs(e,a){t.appendFastDialogs(e,a,!0)},createCanceled(e){n.hideCancelControl(),(0,M.isClassicInterface)(e)?(setStyle(i,{height:"auto"}),removeClass(i,"im-page_cropped"),setTimeout((()=>n.focusInput()),0),0===e.get().peer?t.restoreScroll(e):a.restoreScroll(e,e.get().peer)):setTimeout((()=>{0===e.get().peer?n.focusInput():a.focustTxt(e)}),0),removeClass(i,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){y&&y.updateMenu(e)},goToHistoryEnd(){a.goToEnd()},updateDialog(e,a){t.updateDialog(e,a)},updateRecommendationList(e){e.set(Q.updateConvoRecommendationList).then((e=>{(0,V.isRecommendationListNeedUpdate)(e)&&t.updateRecommendationList(e)}))},setRecommendationListVisibility:e=>t.setRecommendationListVisibility(e),focusTxt(e){a.focustTxt(e)},resync(e){(0,T.isSearching)(e)&&n.clearSearch(e),t.restoreDialogs(e,!0,!0).then((()=>{(0,M.isClassicInterface)(e)||t.focusOnSelected(e)})),d&&d.hide(e),(0,M.isCommunityInterface)(e)&&e.get().tabbedPeers.forEach((t=>{var a=t.peer;y.updateCounter(e,a)})),(0,M.isClassicInterface)(e)?(e.get().tabbedPeers.forEach((t=>{var a=t.peer;y.updateCounter(e,a),y.updateName(a,e)})),(0,J.updateFolderCounters)(e)):t.updateFolderCounters(e),a.cleanSelection(e.get().selectedMessages||[]),a.cancelSearch(e,!0),(0,M.isReservedPeer)(e.get().peer)||a.changePeer(e,!1),(0,Y.updateUnreadCounter)(e)},toggleSettingsLoader(e,t){u.toggleLoader(e,t)},onUserActions(e,t){if(!(0,L.isSearchingInplace)(e.get().peer,e.get())){var n,i=e.get(),s=i.peer;if((0,M.isFullyLoadedTab)(i,s))if(!r.is_idle)if((0,T.countUnread)(e.get().peer,e.get())>0)if(!i.tabs[s].skipped&&a.isNewMessagesVisible(e))a.hideGoToEnd(!0),a.hideGoToMention(!0),(0,U.partConfigEnabled)("mail_history_unread_counter_observer")?(a.updateObserver(),n=Promise.resolve()):n=e.set(L.readLastMessages.bind(null,s)),n.then((()=>e.set(L.setActions))).then((()=>a.updateActions(e)))}},removeSelection(e){t.removeSelection(e),n.focusInput()},route(e,r,s,o){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var l=!1;return!!(e.mr||e.invite_chat_id&&s.invite_hash)||(o&&o.params&&"left_nav"===o.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach((e=>{switch(e){case"sel":s.q||(l=!0);var u=s.sel?(0,M.unUrlPeer)(s.sel):0,g=o.back;if(0===u)_.get().longpoll.push([(0,j.resetPeer)(!1,g)]);else if(u!==_.get().peer){var m="";o&&o.params&&o.params.entrypoint&&(m=o.params.entrypoint),_.get().longpoll.push([(0,j.changePeer)(u,s.msgid||!1,!1,!1,m)])}break;case"invite_chat_id":case"invite_hash":!function(e){e.set(L.leaveInvitation).then((()=>{e.get().longpoll.push([(0,j.resetPeer)(!1,!1)])}))}(_);break;case"tab":_e(_,d,c),l=!0;var p=s.tab||A.FOLDER_ALL;_.get().longpoll.push([(0,j.changeTab)(p)]);break;case"act":s.act&&"create"===s.act?he(_,[],d,n,t,a,i):function(e,t,a,n){a&&a.hide(e,t)}(_,[],d);break;case"st":s.st&&s.sel?(curBox()&&curBox().hide(),_.mutate(L.setInplaceSearch.bind(null,unescape(s.st),s.sel)),a.startSearch(_)):(_.mutate(L.cancelSearch.bind(null,r.sel)),a.cancelSearch(_,!0));break;case"q":s.q?(curBox()&&curBox().hide(),n.setSearch(_,s.q,!0)):n.clearSearch(_);break;case"box":re(_,s.box)}})),s.msgid&&(_.get().msgid=s.msgid,a.focusOnMessage()),(0,M.isClassicInterface)(_)&&void 0===e.sel&&y.updateMenu(_),l&&pe(_,n,t),!1)},updateDialogFilters(e){(0,T.isSearching)(e)||t.restoreDialogs(e),null==u||u.updateFilter(e)},removePeer(e,a){t.removeDialog(e,a),t.saveScroll(e),e.get().peer===a&&e.get().longpoll.push([(0,j.resetPeer)()]),(0,M.isClassicInterface)(e)&&y.updateMenu(e)},newMessage(e){(0,M.isClassicInterface)(e)||t.scrollUp(!0)},onQueueEvent(e,n){switch(n.entity_type){case m.EntityType.Online:e.set((e=>(0,L.updateOnline)(n.data.user_id,!!n.data.online&&n.data.platform,n.data.last_seen,e))).then((e=>{(0,M.isTabLoaded)(e.get(),n.data.user_id)&&(t.updateOnline(n.data.user_id,e),a.updateOnline(n.data.user_id,e)),(0,z.isRecommendedConvo)(e,n.data.user_id)&&t.updateRecommendedOnline(n.data.user_id,e)}))}},onEvents(e,l){var m=(0,j.compactCounterEvents)(l),_=l.filter(I.isServiceMsg),p=l.filter((e=>e.type===f.ADD_MESSAGE));(0,U.partConfigEnabled)("mail_process_service_late")||se(_,e,t,a);var v=(0,L.checkNewPeople)(_,p,e),b=Promise.resolve();v.shouldLoad&&(b=e.set(L.loadNewPeople.bind(null,v,s))),b.then((()=>{(0,U.partConfigEnabled)("mail_process_service_late")&&se(_,e,t,a),m.forEach((s=>{switch(s.type){case f.ADD_MESSAGE:var l=s.peerId,m=(0,T.getTab)(e,l),_=!m||!m.msgs||0===m.msgs.length,p=(0,M.getMessageStoreStatus)(s,e.get()),v=(0,T.isCommunityBlocked)(e,s.peerId),b=m&&!m.lastmsg;switch(Ce(e,a,s),(0,I.isCasperMessage)(s)&&F.casperMessagesStore.add(s),p){case M.MSG_NEW:e.set(L.addMessage.bind(null,s)),de(e,i),function(e,t){var a=e.get().tabs[t.peerId],n=e.get().active_tab;return n===A.FOLDER_ALL||(n===A.FOLDER_PEER_TAGS?(0,G.applyPeerTagsFilterToTab)(e.get(),a):(0,L.filterFromTab)(n)(a))}(e,s)&&((0,T.tabIsMessageRequest)(m)||(s.flags&f.FLAG_OUTBOUND||e.set(L.updateFavAndTitle.bind(null,s.peerId,!0)),function(e,t){var a=t.flags&f.FLAG_OUTBOUND,n=inArray(t.peerId,e.get().mutedPeers),i=t.flags&f.FLAG_DELETED,r=e.get().gid;if(!a&&!n&&!i){var s,o,l=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",c=(l?l+" ":"")+t.text||"",d=t.userId,u=t.peerId,m=e.get().tabs[u];if(t.kludges&&t.kludges.source_act&&(c=stripHTML((0,M.renderServiceMsg)(e,t,m.peerId,!1))),(!e.get().notify_msg&&!(0,M.isChatPeer)(u)||r&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:u}),!(0,M.isChatPeer)(u))return;c=trim(replaceEntities(stripHTML(c.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),c=(0,g.replaceMentions)(c,((e,t,a,n,i)=>i)),(0,M.isChatPeer)(u)?(s=(0,D.oCacheGet)(e,d).name,m.tab&&(s+=" » "+m.tab),o=(0,D.oCacheGet)(e,d).photo):(s=m.tab,o=m.photo);var _=t.attaches[0];if(_&&"mail"===_.type)c+="\n["+getLang("mail_added_msgs")+"]";else if(_){var p="doc"===_.type&&"graffiti"===_.kind?"graffiti":_.type;c+="\n["+getLang("mail_added_"+p)+"]"}s=trim(replaceEntities(stripHTML((s||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:c,author_id:u,title:s,author_photo:o})}}(e,s)),t.updateTyping(s.peerId,e),(0,T.isSearching)(e)?t.updateDialog(s.peerId,e):t.promoteDialog(e,s.peerId));var C=(0,T.isCommunityBlocked)(e,s.peerId),w=m&&!m.offset;(v&&!C||b&&!w)&&a.updateActions(e),(0,M.isClassicInterface)(e)?(y.updateCounter(e,s.peerId),y.updateMenu(e)):null==u||u.updateFilter(e),e.set(L.updateActivity.bind(null,s)).then(ve.bind(null,e,a,t,s.peerId)),a.addMessage(e,s),le(s)||!(0,M.isFullyLoadedTab)(e,s.peerId)||s.local||e.set(L.loadMedia.bind(null,s)).then((e=>{a.replaceAttachmentPlaceholders(e,s),(0,W.videoAutoPlayHandler)()})),s.kludges.has_template&&e.set((e=>(0,L.addCarouselTemplateToStore)(s,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,s)})),(0,k.statlogsSendingTimeStart)(e,s,"send","opt_to_lp");break;case M.MSG_LOCAL_DUPLICATE:le(s)||e.set(L.loadMedia.bind(null,s)).then((e=>{a.replaceAttachmentPlaceholders(e,s)})),e.set(L.replaceMessage.bind(null,s)),a.replaceMessageAttrs(s,e),t.updateDialog(s.peerId,e),e.get().active_tab===A.FOLDER_ALL&&(0,z.isRecommendedConvo)(e,s.peerId)&&this.updateRecommendationList(e),s.randomId&&(0,k.statlogsSendingTimeEnd)(e,s,"send","opt_to_lp");break;case M.MSG_DUPLICATE:(0,T.isSearching)(e)||t.promoteDialog(e,s.peerId)}(0,T.tabIsMessageRequest)(m)&&(0,M.checkMessageRequestsTab)(e,t.update);var S=p===M.MSG_LOCAL_DUPLICATE&&1===m.offset||p===M.MSG_NEW&&b&&!s.local;(0,U.partConfigEnabled)("messenger_empty_pinned_support")&&S&&e.set((t=>(0,L.loadPeer)(l,!1,0,!1,t,"emptyPinnedCrutch").then((t=>((0,q.updateListedConvos)(t,(0,T.getTab)(t,l),!1,(e=>(0,L.addDialog)(l,e,t)),((e,a,n)=>(0,L.shouldIncludeDialog)(t,e,a,n))),l===e.get().peer?(0,L.setActions)(t):t))))).then((e=>t.promoteDialog(e,l))),m&&_&&m.peerId===(0,V.getPeer)(e)&&P();break;case f.EDIT_MESSAGE:case f.REPLACE_MESSAGE:e.set(L.editMessage.bind(null,s)).then((e=>{if(Ce(e,a,s),s.kludges.is_expired)return(0,M.removeExpiredMessageIfNeed)(s,a.handleMessageExpiration),void t.updateDialog(s.peerId,e);t.updateDialog(s.peerId,e),a.updateTyping(s.peerId,e),a.editMessage(e,s),le(s)||!(0,M.isFullyLoadedTab)(e,s.peerId)||s.local||e.set(L.loadMedia.bind(null,s)).then((e=>a.replaceAttachmentPlaceholders(e,s))),s.kludges.has_template&&e.set((e=>(0,L.addCarouselTemplateToStore)(s,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,s)}))}));break;case f.INVALIDATE_MESSAGE:(0,L.reloadMessage)(s.messageId,e.get()).then((t=>{var a=(0,H.getMessageFromTuple)(t);return e.set((e=>(0,L.editMessage)(a,e))).then((()=>a))})).then((n=>{a.editMessage(e,n),t.updateDialog(n.peerId,e),!le(n)&&(0,M.isFullyLoadedTab)(e,n.peerId)&&e.set((e=>(0,L.loadMedia)(n,e))).then((e=>a.replaceAttachmentPlaceholders(e,n)))}));break;case f.READ_INBOUND:e.set(L.markInboundMessagesAsRead.bind(null,s)).then((e=>{t.updateCounter(e,s.peerId),s.peerId===(0,V.getPeer)(e)&&(a.updateGoToEnd(e,!0),a.updateGoToMention(e,!0),a.updateObserver()),(0,M.isClassicInterface)(e)&&y.updateCounter(e,s.peerId),(0,T.isSearching)(e)||t.restoreDialogs(e),null==u||u.updateFilter(e)}));break;case f.READ_OUTBOUND:e.set(L.markOutboundMessagesAsRead.bind(null,s)).then((e=>{t.updateCounter(e,s.peerId),a.markMessagesAsRead(e,s)}));break;case f.UNREAD_COUNT:var B;if(!(0,M.isCommunityInterface)(e))null===(B=window.TopMessenger)||void 0===B||B.setIsCounterOn(!(0,V.isTopCounterMuted)(e));e.set((e=>(0,K.setUnreadCounters)(s,e))).then((()=>{null==u||u.updateFilter(e);var a=s.showOnlyNotMuted;a!==(0,V.getLocalSettingsValue)(e,"show_only_not_muted_messages")&&e.set((e=>(0,K.setLocalSettingsValue)("show_only_not_muted_messages",a,e))),(0,U.partConfigEnabled)("mail_longpoll_unread_counter")||(0,Y.updateUnreadCounter)(e);var n=Promise.resolve();s.businessNotifyUnread>0&&1===e.get().settings.business_notify_folder_hidden&&(n=e.set((e=>(0,K.setLocalSettingsValue)("business_notify_folder_hidden",0,e))),(0,ee.toggleHideFolderHandler)((0,E.unpackStore)(e),Z.ConvoListFolder.BUSINESS_NOTIFY,!1)),n.then((a=>{(0,M.isClassicInterface)(e)?((0,J.updateFolderCounters)(e),e.get().tabbedPeers.forEach((t=>{var a=t.peer;y.updateCounter(e,a)}))):t.updateFolderCounters(e)}))}));break;case f.SET_FLAGS:case f.REPLACE_FLAGS:case f.RESET_FLAGS:switch(!0){case Boolean(s.flags&f.FLAG_DELETED):case Boolean(s.flags&f.FLAG_SPAM):s.type!==f.SET_FLAGS||(0,M.isAlreadyDeleted)(e,s.peerId,s.messageId)||e.get().blockedFlagUpdates[s.peerId]||o(s);break;case s.flags===f.FLAG_IMPORTANT:var x=s.type===f.SET_FLAGS;e.set((e=>(0,L.updateImportant)(x?1:-1,s.messageId,e))),e.set((e=>(0,L.updateFavMessage)([s.messageId],s.peerId,x,e))).then((()=>{a.markImportant(s.messageId,x,e)}));break;case Boolean(s.flags&f.FLAG_AUDIO_MESSAGE_LISTENED):e.set((e=>(0,X.setMessageFlag)(e,s.peerId,s.messageId,f.FLAG_AUDIO_MESSAGE_LISTENED,!0)))}break;case f.RECORDING_AUDIO:fe(e,a,t,s,L.ACTIVITY_TYPE_RECORDING_AUDIO);break;case f.TYPING:fe(e,a,t,s,L.ACTIVITY_TYPE_TYPING);break;case f.NOTIFY_SETTINGS_CHANGED:!function(e,t,a,n){e.set(L.setMutedPeer.bind(null,a,n)).then(t().updateState.bind(null,a))}(e,c,s.peerId,!s.sound);break;case f.CONVO_MAJOR_ID_CHANGED:e.set((e=>{var t=s.peerId,a=s.majorId,n=(0,T.getTab)(e,t);return(a&&n?Promise.resolve(e):(0,L.loadPeer)(t,!1,0,!1,e,"sortingChange")).then((e=>{var n=(0,T.getTab)(e,t);return n.major_sort_id=a,(0,q.updateListedConvos)(e,n,!1,(a=>(0,L.addDialog)(t,a,e)),((t,a,n)=>(0,L.shouldIncludeDialog)(e,t,a,n))),(0,L.setActions)(e),Promise.resolve(e)}))})).then((e=>{var n=s.peerId;(0,T.getTab)(e,n)&&!(0,T.isSearching)(e)&&t.promoteDialog(e,n),n===e.get().peer&&a.updateActions(e)}));break;case f.CONVO_MINOR_ID_CHANGED:e.set((e=>{var t=s.peerId,a=s.minorId,n=(0,T.getTab)(e,t);return n?(n.minor_sort_id=a,Promise.resolve(e)):Promise.resolve(e)})).then((e=>{var a=s.peerId;(0,T.getTab)(e,a)&&!(0,T.isSearching)(e)&&t.promoteDialog(e,a)}));break;case f.RESYNC:e.get().longpoll.pause(),e.set(L.resync).then(c().resync).then((()=>e.get().longpoll.resume()));break;case f.TRANSITION:h.transition(s.state);break;case f.RESET_PEER:if(s.removeActivePeer){var N=e.get().tabbedPeers.filter((t=>{var a=t.peer,n=t.type;return a!==e.get().peer&&"perm"===n}));e.setState({tabbedPeers:N})}!function(e,t,a,n){e.set(L.cancelRecording).then((()=>{a.cancelRecording()})),AudioMessagePlayer.detachPlayer(),t.removeSelection(e),removeClass(n,"im-page_history-show"),a.flushDraft(e),a.stopLoading(),a.destroyPeerProfile(),(0,T.isAnyMessageBeingEdited)(e)&&a.cancelEditing();var i=e.get().peer;e.set(L.changePeer.bind(null,0,!1,"")).then((()=>{window.tooltips&&window.tooltips.hideAll(),ue(),(0,M.isClassicInterface)(e)&&t.activate(),a.changePeer(e),(0,M.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout((()=>{e.get().longpoll.push([(0,j.transitionEvent)("search")])}),13),(0,M.isLocksAvailable)(e)&&(0,M.isPeerBlockedByMe)(i,e)&&e.set(L.releaseBlock.bind(null,i))}))}(e,t,a,i),s.cancelSearch&&pe(e,n,t),(0,M.isClassicInterface)(e)&&y.updateMenu(e),(0,M.isClassicInterface)(e)&&e.get().active_tab===A.FOLDER_ALL&&this.updateRecommendationList(e),n.focusInput(),(0,M.isCommunityInterface)(e)&&(n.initPeerTagsFilter(e),t.renderPeerTags(e));break;case f.CHANGE_TAB:(0,T.isSearching)(e)&&n.clearSearch(e);var O=e.get().active_tab;(0,M.changeTab)(s.tab,e,c,L.changeDialogsTab).then((e=>{null==u||u.updateFilter(e),s.tab===A.FOLDER_PEER_TAGS&&O!==s.tab&&n.initPeerTagsFilter(e),s.tab===A.FOLDER_ALL&&this.updateRecommendationList(e)}));break;case f.RESET_DIRECTORIES:case f.SET_DIRECTORIES:case f.REPLACE_DIRECTORIES:var Q=s.type,te=s.peerId,ae=s.mask;if(ae===f.FOLDER_HAS_BANNER)break;var ne=ae===f.FOLDER_AD_TAG;e.set(L.updateFolderState.bind(null,te,ae,Q,s.local,ne)).then((e=>{(0,T.isSearching)(e)||Q===f.RESET_DIRECTORIES&&ae===A.FOLDER_MASKS[A.FOLDER_IMPORTANT]||Q===f.RESET_DIRECTORIES&&ae===A.FOLDER_MASKS[A.FOLDER_MESSAGE_REQUEST]||Q===f.SET_DIRECTORIES&&ae===A.FOLDER_MASKS[A.FOLDER_MESSAGE_REQUEST_REJECTED]||Q===f.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(te,e),(0,M.isClassicInterface)(e)&&y.updateCounter(e,te),e.get().peer===te&&a.changedMessageSelection(e)}));break;case f.DELETE_DIALOG:e.set(L.deletedDialog.bind(null,s.peerId,Promise.resolve([]))).then((()=>{c().removePeer(e,s.peerId),c().updateDialogFilters(e)}));break;case f.CHANGE_PEER:me(e,s,t,a,n,i,y,d,c);break;case f.MUTEX:var ie={[s.peerId]:s},re=(0,M.isPeerBlocked)(s.peerId,e);e.set(L.updateBlockStates.bind(null,ie)).then((()=>{t.updateDialog(s.peerId,e);var n=(0,M.isPeerBlocked)(s.peerId,e);(0,M.isFullyLoadedTab)(e.get(),s.peerId)&&re!==n&&a.updateChat(e,s.peerId)}));break;case f.FAILED_MESSAGE:e.set(L.setMessageErrored.bind(null,s.peerId,s.message)).then((()=>{a.setMessageErrored(s.peerId,s.message,s.error,e),t.setDialogFailed(s.peerId,s.message.messageId,e)}));break;case f.RESEND:var se=s.message.messageId;e.set(L.resendMessage.bind(null,s.peerId,se,s.message)).then((()=>{a.resendMessage(s.peerId,se),t.promoteDialog(e,s.peerId)}));break;case f.PEER_TAGS_CHANGED_EVENT:(0,G.onPeerTagsChangeEvent)(e,t,s);break;case f.PEER_PROFILE_TAGS_CHANGED_EVENT:(0,G.onPeerProfileTagsChangedEvent)(e,t);break;case f.CONVERSATION_UPDATED:ye(e,s,c,a,t);break;case f.WAITING_FOR_RECONNECT:setTimeout((()=>{be(i,!0,e),a.setNetworkWaitingStatus(s.timeout-1,e)}),1e3);break;case f.RECONNECTING:be(i,!0,e),a.setNetworkReconnectingStatus(e);break;case f.RECONNECTED:be(i,!1,e),setTimeout(a.clearNetworkStatus,0),browser.chrome&&!(0,M.isClassicInterface)(e)&&e.get().peer&&(r.is_idle?R||(r.once("unidle",(()=>{R=!1,t.forceScrollReinit()})),R=!0):t.forceScrollReinit());break;case f.KEYBOARD_CALLBACK_RECEIVED:var oe=(0,V.getPressedButtonState)(s.event_id,e);oe&&e.set((e=>(0,K.unsetPressedCallbackButton)({peerId:s.peer_id,eventId:s.event_id},e))),oe.onCallback(),(0,$.handleCallbackAction)(s,e)}}))}))},updateHistory:e=>a.updateHistory(e),updateChatInfo(e){a.updateChatTopic(e,_),(0,M.isClassicInterface)(_)&&y.updateName(e,_),_.get().peer===e&&a.updateActions(_)},cancelRecording:()=>_.set(L.cancelRecording).then((()=>a.cancelRecording())),fixHeight(){P()},showNewConvoStickersHints(e){var t=(0,z.getCurrentTab)(e);t&&t.is_new&&Emoji.showNewConvoStickersHints((0,V.getEmojiOptId)(e))},toggleFolder(e,a){t.toggleFolder(e,(()=>this),a)},hideFolderButton(e,a){var n=a===Z.ConvoListFolder.BUSINESS_NOTIFY;e.set((e=>n?(0,K.setLocalSettingsValue)("business_notify_folder_hidden",1,e):Promise.resolve(e))).then((e=>((0,M.isClassicInterface)(e)||t.updateFolderCounters(e),(0,ee.toggleHideFolderHandler)((0,E.unpackStore)(e),a,!0))))},updateSearchMenu(e){n.updateMenu(e)},unmount(){var i;(0,p.destroyModule)(e),clearInterval(_.get().update_title_to),r.stop(),B(),x(),F.casperMessagesStore.destroy(),t.unmount();var s=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_logo"+s+".ico"),a.unmount(),n.unmount(),cancelStackFilter("im_peer"),null==u||u.unmount(),d&&d.unmount(),y&&y.unmount(),C&&C(),v&&v(),(0,M.isLocksAvailable)(_)&&_.get().peer&&_.set(L.releaseBlock.bind(null,_.get().peer)),w.unmount(),N.unmount(),y&&y.unmount(),S.unmount(),clearInterval(b),cur.imDb.unmount(),cur.imDb=!1,null===(i=window.TopMessenger)||void 0===i||i.setIsCounterOn(!0)}}}function Se(e,t,a,n){var i=t.get();(0,M.isReservedPeer)(i.peer)||e().onUserActions(t,n),i.update_old_title&&t.set(L.updateFavAndTitle.bind(null,!1,!1))}function Ee(e,t){var a=ge("page_header"),n=geByClass1("_im_page_history",e),i=window.clientHeight()-a.offsetHeight-30-2,r=(0,M.isClassicInterface)(t)?250:400,s={page:Math.max(i,r)};if((0,M.isClassicInterface)(t)){var o=(0,M.getClassicChatHeight)();o=o>0?Math.min(o-a.offsetHeight-30-2,i):i;var l=hasClass(n,"im-page--history_empty-hist")?o:i;s.history=Math.max(o,r),s.chat=Math.max(l,r)}return s}function Te(e,t,a,n,i){var r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!(0,E.isFullScreen)()){var o=Ee(e,t);if(setStyle(e,{minHeight:o.page}),(0,M.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(L.initializeChatResize),setStyle(e,{height:t.get().isCreating?o.page:"auto"}),setStyle(geByClass1("_im_page_dialogs",e),{minHeight:o.page}),setStyle(geByClass1("_im_page_history",e),{minHeight:o.history,position:"relative",top:0}),setStyle(geByClass1("_im_chat_body_abs",e),{minHeight:o.chat,height:o.chat,position:"relative",top:0})),browser.safari&&s&&"function"==typeof s&&s(),n&&n.updateScroll(),i&&i.updateScroll&&i.updateScroll(),a){var l=a.updateScroll();a.scrollFix(t,t.get().peer,l)}r&&setTimeout((()=>Te(e,t,a,n,i,!1)),100)}}function Ie(e,t){e.get().resendAllOnOnline&&t()}function Le(){var e=document.querySelector(".im_page");!function(e){var t="safari-repaint";e.forEach((function(e){hasClass(e,t)&&removeClass(e,t),addClass(e,t)})),setTimeout((function(){e.forEach((function(e){removeClass(e,t)}))}),100)}([geByClass1("_im_dialog_actions",e),geByClass1("_im_chat_input_w",e),ge("side_bar"),geByClass1("_im_right_menu",e),geByClass1("_im_dialogs_footer",e),geByClass1("_im_dialogs_search",e)])}function ke(e,t){var a,g=t.get(),m=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_im"+m+".ico"),Te(e,t,!1,!1,!1,!0);var _=(0,p.createMutations)(we),y=_.callMutations,I=_.bindMutations,k=g.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),A=k?Notifier.getLpInstance():t.get().gid?(0,v.startLongPollForGroup)(g.lpConfig):(0,v.startLongPoll)(g);A.onData(N);var P=Notifier.getEventQueueInstance&&Notifier.getEventQueueInstance(),D=P?P.subscribe((e=>y().onQueueEvent(t,e))):()=>{};function N(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];y().onEvents(t,a)}k&&(0,x.imWeirdLog)("im_use_fc_longpoll",{},!1),window.TopMessenger&&!(0,M.isCommunityInterface)(t)&&(0,V.isTopCounterMuted)(t)&&(window.TopMessenger.resetCounter(),window.TopMessenger.setIsCounterOn(!1));var H=geByClass1("_im_dialogs_search",e),j=geByClass1("_im_dialogs_footer",e),q=(0,n.mount)(geByClass1("_im_page_dcontent",e),t,y,H);q.renderPeerTags(t);var G,z,K=(0,r.mount)(H,t,y),W=j?(0,s.mount)(j,t,y):null,Y=(0,w.mount)(t),$=(0,c.mount)(t,document.body);if(cur.imDb=(0,S.mount)(t.get().gid?-t.get().gid:vk.id),t.set(L.preloadSearchIndex.bind(null,cur.imDb)),(0,M.isClassicInterface)(t)){var Q=geByClass1("_im_ui_peers_list",e.parentNode);G=(0,C.mount)(Q,t,y),z=function(e,t,a,n){if(browser.mobile)return!1;var i=[t,a,geByClass1("_im_chat_input_w",n),geByClass1("_im_dialog_actions",n)],r=null,s=hasClass(e,"im-page--header_static"),o=ge("im-group-online-disabled-notice");function l(){var t=(0,u.getNativeOption)("scrollLeft"),a=hasClass(e,"im-page--header_static"),n=[];r!==t?n=i.slice().concat([e]):a!==s&&(n=[e]),r=t,s=a,n.length>0&&n.forEach((n=>{var i=e===n&&a?0:-t;setStyle(n,{[cssTransformProp]:0===i?"unset":"translateX("+i+"px)"})}))}return o&&i.push(o),i=i.concat(geByClass("_im_aside_notice"),geByClass("_im_aside_promo_block")),addEvent(window,"scroll",l),l(),()=>{removeEvent(window,"scroll",l)}}(H,j,geByClass1("_im_right_menu",e.parentNode),e)}(0,M.isClassicInterface)(t)&&g.peer&&q.deactivate(),g.gid||(a=(0,U.partConfigEnabled)("messages_chat_creation_new_interface")?(0,l.mount)(t):(0,o.mount)(geByClass1("_im_dialogs_creation",e),t,y));var X=(0,i.mount)(geByClass1("_im_page_history",e),t,q,G,y),J=g.isCreating,Z=J?"create":0===g.peer?"search":"default";J&&a.show(t,[]);var ee=(0,h.create)(t,Z,q,X,K,a),ae=(0,B.mount)(t,ee);X.renderPeerProfile(t),X.updateScroll();var ne=Se.bind(null,y,t,ee);g.peer&&t.set(L.prepareCasperMessagesFromMessages.bind(null,g.peer)),(0,M.isReservedPeer)(g.peer)||setTimeout((()=>oe(t,X)),10);var se=new R.default({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"}),le=(0,O.debounce)(Le,300),ce=Te.bind(null,e,t,X,q,a,!1,le),de=Ie.bind(null,t,X.resendAll);t.setState({longpoll:A}),t.set(L.setExecStack.bind(null,[])),se.on("unidle",(function(){A.abortWaiting(),ne()})),se.start(),nav.objLoc.box&&(re(t,nav.objLoc.box),(0,d.updateLocation)({box:null})),nav.objLoc.mr&&(0,M.isChatPeer)(Number(nav.objLoc.mr))&&(0,M.showChatInvitationBox)(t,nav.objLoc.mr,y,q);var ue,me=function(e){var t=e.get();return(0,M.isLocksAvailable)(e)?(0,b.createWorker)(t.mutex_key,(function(e){t.longpoll.push([f.mutexEvent(e)])}),(function(e,a){return(0,L.getMutexQueue)(t.gid).then((e=>te(e,1)[0]))})).stop:null}(t);if((0,M.isLocksAvailable)(t)&&(ue=setInterval(M.blockLatencyCompensation.bind(null,t,g.longpoll),2e3)),t.get().invitation&&(0,M.showInvitationBox)(t,t.get().invitation,L.leaveInvitation),(0,M.isClassicInterface)(t)&&(0,T.existsIncomingMessageRequest)(t)){var _e=document.getElementById("ui_rmenu_mr");_e&&_e.classList.remove("unshown")}var pe=(0,E.throttleAccumulate)(ie.bind(null,t,X,q,G),200),he=M.hideTopNotice.bind(null,t),ve=M.hideAsideNotice.bind(null,t);return F.casperMessagesStore.subscribe((e=>function(e,t,a,n,i){var r=i.type,s=i.message;switch(r){case F.EXPIRING:return t.updateCasperMessageStatus(s);case F.EXPIRING_SOON:return t.updateCasperMessageStatus(s,!0);case F.EXPIRED:(0,T.isCasperChat)(e,s.peerId)?n(s):(t.handleMessageExpiration(s),a.updateDialog(s.peerId,e))}}(t,X,q,pe,e))),F.casperMessagesStore.setTimeshift(g.timeshift),I((0,p.createModule)({handlers:(t,a)=>{t(document,"mousemove mousedown keypress",ne),t(window,"resize",ce),t(window,"online",de),a(e,"click",M.HIDE_TOP_NOTICE_CLASS,he),a(gpeByClass("_im-page-wrap",e),"click",M.HIDE_ASIDE_NOTICE_CLASS,ve),a(gpeByClass("_im-page-wrap",e),"click",M.HIDE_ASIDE_PROMO_BLOCK_CLASS,M.hideAsidePromoBlock),a(gpeByClass("_im-page-wrap",e),"click",M.INSTALL_VKADMIN_LINK,M.installVKAdminApp),browser.safari&&t(document,"visibilitychange",Le)}}),q,X,K,e,se,A,pe,y,a,W,t,ee,me,ue,G,z,Y,ae,ce,(function(){k?A.offData(N):A.stop()}),D,$)}},411986:(e,t,a)=>{"use strict";a.d(t,{mount:()=>z});a(940851),a(296253);var n,i,r,s,o,l,c,d,u,g,m,_,p,h,v,f=a(533246),b=a(389430),y=a(865192),C=a(663527),w=a(791563),S=browser.msie&&intval(browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function E(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var T=!1,I=!1,L=100;function k(e){var t=e.get().peer;(0,C.isFullyLoadedTab)(e,t)&&!(0,C.isAnyMessageBeingEdited)(e)&&Date.now()-((0,C.getTab)(e,t).lastTyping||0)>1e3*b.ACTIVITY_PERIOD&&e.set(b.sendRecordingAudio.bind(null,t))}function M(e){if(!I){I=!0,(0,C.lockButton)(l);var t={peer:u.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise(((t,a)=>{var n=e.getFormData(),i=new S;i.onload=i.onerror=function(e){var n=e.currentTarget.response;200==this.status&&n.length>0&&"{"==n[0]?(n=JSON.parse(n),t(n)):a()},i.open("POST",v.upload_url,!0),i.send(n)}))})(e).then((e=>e.file?new Promise(((a,n)=>{ajax.post("/docs.php",extend({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,n)=>{x(),_([["doc",e+"_"+n,"audiomsg"]],{},t.peer),H(),a()},onFail:function(e){n(e)},progress:null})})):Promise.reject())).then((()=>{(0,C.unlockButton)(l),I=!1})).catch((()=>{I=!1,(0,C.unlockButton)(l),(0,w.showFastBox)(getLang("global_error"),getLang("mail_audio_message_upload_error"))}))}}function A(){h(),i.innerHTML=E(T.duration),T.duration>=600&&U()}function P(e){e.set(b.cancelRecording).then(F)}function B(){h(),stManager.add(["voice_message_player.js","speech.js"],(function(){T||(T=Speech.newRecorder(),addEvent(T,"progress",A)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),T.record().then((()=>{var e;e=u,v.isRecording=!0,cancelStackPush("audio_message_cancel",P.bind(null,e)),hideProgress(geByClass1("im-audio-message-send-wrapper",n)),i.innerHTML="0:00",addClass(n,"im-audio-message_recording"),removeClass(n,"im-audio-message_recorded"),function(){n&&n.classList&&n.classList.remove("im-audio-message-input--hidden");geByClass1("_im_chat_input_parent",d).classList.add("im-chat-input--hidden")}(),(m=Speech.createVisualization("wave",T.source,r,{color:getComputedStyle(document.body).getPropertyValue("--button_primary_foreground")})).start();var t=r.getBoundingClientRect();L=(t.right-t.left)/3})).catch((e=>{AudioMessagePlayer.resumeGlobalMedia();var t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t="mail_audio_message_device_error";break;case"PermissionDeniedError":case"PermissionDismissedError":t="mail_audio_message_permission_error";break;case"Unsupported":t="mail_audio_message_unsupported_error"}(0,w.showFastBox)(getLang("global_error"),getLang(t)),console.error(e)}))}))}function D(){T&&T.stop(),m&&(m.destroy(),m=null)}function x(){v.isRecording=!1,cancelStackFilter("audio_message_cancel")}function N(){R(),M(T)}function R(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),removeEvent(T,"finish",R),removeEvent(T,"finish",N),e=URL.createObjectURL(T.buffer),domData(g,"duration",T.duration),domData(g,"ogg",e),domData(g,"mp3",e),geByClass1("audio-msg-track--duration",g).innerHTML=E(T.duration),geByClass1("audio-msg-track--wave-wrapper",g).innerHTML=AudioMessagePlayer.getWave(T.wave,L),removeClass(n,"im-audio-message_recording"),addClass(n,"im-audio-message_recorded")}function F(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];x(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),removeEvent(T,"finish",R),removeEvent(T,"finish",N),D(),H(),e&&p()}function O(){T.isRecording?(addEvent(T,"finish",N),removeEvent(T,"finish",R),D()):M(T)}function U(){addEvent(T,"finish",R),removeEvent(T,"finish",N),D()}function H(){removeClass(n,"im-audio-message_recorded"),removeClass(n,"im-audio-message_recording"),n&&n.classList&&n.classList.add("im-audio-message-input--hidden"),geByClass1("_im_chat_input_parent",d).classList.remove("im-chat-input--hidden")}function j(){ge("audiomsg_record"),g=ge("audiomsg_player"),d=geByClass1("_im_chat_input_w"),n=geByClass1("im-audio-message-input",d),i=geByClass1("audio-msg-track--duration",n),r=geByClass1("audio-msg-track--wave",n),o=geByClass1("im-audio-message--cancel-btn",n),l=geByClass1("_im_audio_send",n),c=geByClass1("audio-msg-track--btn",n),geByClass1("im-chat-input--text",d);var e=geByClass1("im-chat-input--textarea",d);addClass(e,"_voice_field_wrap"),addEvent(s,"click",B),addEvent(o,"click",F),addEvent(l,"click",O),addEvent(c,"click",U)}function q(){!function(){T&&removeEvent(T,"progress",A);removeEvent(s,"click",B),removeEvent(o,"click",F),removeEvent(l,"click",O),removeEvent(c,"click",U)}(),g=n=i=r=s=o=l=c=null}function G(e,t,a){return{cancelRecording:F,start:function(){B()},unmount(){F(!1),q()}}}function z(e,t,a,n,i){return u=t,v=t.get().audio_msg,h=k.bind(null,t),_=a,p=i,(0,y.initFailBack)(),(0,C.getAvailableMicrophones)().then((e=>{var a=e.length>0;a?(j(),n()):setCookie("remixvoice","0",7),t.set(b.setVoiceMessageAvail.bind(null,a))})).catch((e=>{throw setCookie("remixvoice","0",7),e})),(0,(0,f.createMutations)(G).bindMutations)(e,t,a)}},599044:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n={onNewMessagesChunk:function(e){var t=geByClass("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach((e=>LongView.register(e,"im")))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}}},108010:(e,t,a)=>{"use strict";a.d(t,{mount:()=>E});a(751876),a(940851),a(991181),a(296253),a(796409);var n=a(744544),i=a(91257),r=a(663527),s=a(389430),o=a(81020),l=a(533246),c=a(324466),d=a(182408),u=a(907851),g=a(187294),m=a(719016),_=a(116886),p=Object.values(c.ConvoListFolder);function h(e){var t=e.get().tabbedPeers.map((t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer])).filter((e=>e)).filter((e=>!e.deletedDialog)).map((e=>({type:"peer",peer:e.peerId})));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function v(e,t){if("sep"===t.type)return getTemplate("im_right_menu_sep",{});var a=`${(0,r.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,n=(0,r.getBareTab)(t.peer,e),i=(0,r.isContactPeer)(t.peer)?(0,r.prepareContactName)(n.tab):n.tab,s="";switch(!0){case n.unread>0:s=n.unread;break;case(0,r.isTabMarkedUnread)(n):s=1}return i=getTemplate("im_right_menu_ct",{name:i,count:s}),getTemplate("im_right_menu_tpl",{href:a,label:i,peer:t.peer,attrs:`title="${stripHTML(n.tab)}"`,cls:n.unread>0?"im-right-menu--unread":""})}function f(e,t,a,n){var i=gpeByClass("_im_peer_tab",n),r=intval(domData(i,"list-id")),l=e.get().tabbedPeers.filter((e=>e.peer!==r));return e.set(s.updateTabbedPeers.bind(null,l,!0)).then((()=>{if(b(t,e),r===e.get().peer)e.get().longpoll.push([(0,o.resetPeer)()]);else if(0!==e.get().peer){var a=gpeByClass("_im_right_menu",n);uiRightMenu.hideSliding(a)}})),cancelEvent(a),!1}function b(e,t){return e.pipeReplace(Promise.resolve(h(t)))}function y(e,t,a,n){return{updateMenu(t){!function(e,t){geByClass("_im_peer_tab",e).forEach((e=>{var a=(0,d.fromQueryString)(attr(e,"href").split("?")[1]);a.tab!==t.get().active_tab&&attr(e,"href",`${(0,r.getBaseLink)(t)}?sel=${a.sel}&tab=${t.get().active_tab}`)}))}(e,t);var n=gpeByClass("_im_right_menu",e);b(a,t).then((()=>{var e;(e=t.get().peer?ge("ui_rmenu_peer_"+t.get().peer):ge("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(n)}))},updateName(e,t){var a=ge("ui_rmenu_peer_"+e);if(a){var n=geByClass1("_im_r_tx",a),i=t.get().tabs[e].tab;val(n,i)}},updateCounter(e,t){var a=ge("ui_rmenu_peer_"+t);if(a){var n=geByClass1("_im_r_ct",a),i=(0,r.getTab)(e,t),s="";switch(!0){case i.unread>0:s=i.unread;break;case(0,r.isTabMarkedUnread)(i):s=1}val(n,s),a.classList.toggle("im-right-menu--unread",i.unread>0||(0,r.isTabMarkedUnread)(i))}},unmount(){(0,l.destroyModule)(n),a.unmount()}}}function C(e,t,a){1===a.which&&(e.get().peer&&e.get().longpoll.push([(0,o.resetPeer)()]),e.get().longpoll.push([(0,o.changeTab)(t)]),cancelEvent(a))}function w(e){(0,m.showTooltip)(e.currentTarget,{text:(0,_.getLang)("mail_admin_av_time"),dir:"bottom",needLeft:!0,typeClass:"tt_default_right RightMenuBlockInfo__averageTimeTooltip",width:210,shift:[-14,8],slide:15})}function S(e,t,a){e.set((e=>(0,s.toggleCommunityMute)(!t,e))).then((()=>a.classList.toggle("RightMenuBlockInfo__mute--muted",e.get().mute)))}function E(e,t,a){var s=(0,n.mount)(e,(0,i.default)({limit:50,offset:0,noScroll:!0,elements:h(t)}),(()=>({idFn:e=>e.peer||"000",renderFn:v.bind(null,t)}))),c=f.bind(null,t,s),d=geByClass1("RightMenuBlockInfo"),m=geByClass1("RightMenuBlockInfo__averageTimeHint",d),_=geByClass1("RightMenuBlockInfo__mute",d),b=(0,l.createModule)({handlers:(a,n)=>{n(e,"click","_im_r_cl",c),n(e,"click","_im_peer_tab",((e,a)=>{if(!checkEvent(e)){var n=intval(domData(a,"list-id"));(0,u.unpackStore)(t).longpoll.push([(0,o.changePeer)(n,!1,!0,!0,"right_menu")]),cancelEvent(e)}})),p.forEach((n=>{a(geByClass1(`_ui_item_${n}`,e.parentNode),"mousedown",C.bind(null,t,n))})),a(geByClass1("_im_contact_list_menu_item",e.parentNode),"click",(()=>(0,g.mount)(t))),m&&a(m,"mouseover",w),(0,r.isCommunityInterface)(t)&&_&&a(_,"click",(e=>S(t,!1,e.currentTarget)))}});return(0,r.isCommunityInterface)(t)&&_&&(S(t,!0,_),_.classList.remove("RightMenuBlockInfo__mute--hidden")),y(e,0,s,b)}},592388:(e,t,a)=>{"use strict";a.d(t,{CONVO_MORE_CLASS:()=>k,mount:()=>j});a(175115),a(530522),a(66108),a(579665),a(95767),a(991181),a(940851),a(296253);var n=a(389430),i=a(929566),r=a(663527),s=a(724681),o=a(533246),l=a(187294),c=a(569319),d=a(212015),u=a(636600),g=a(109847),m=a(503369),_=a(227192),p=a(81020),h=a(573084),v=a(719016),f=a(116886),b=a(478153),y=a(324466),C=a(414914),w=a(236205),S=a(91257);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var L=(0,m.debounce)(u.statlogsProbValueEvent,1e3),k="_im_search_more",M="im-dialog-select_rotated",A="im-dialog-select_hidden",P="im-page--dialogs-header-controls_hidden",B="_im_create_convo",D="_im_create_call";function x(e,t,a,r,s,o,l){var c=trim(o);if((0,i.isSearchingValue)(e,c)){var d=()=>l.clearSearch(e,t);c?(e.setState({recentSearch:!1}),s.stop()):s.replaceOrAdd(d),cancelStackPush("im_search",d),c&&e.set((e=>(0,n.setCurrentSearch)(c,!1,e))).then(t),r.classList.add("im-page--dialogs-search_fill","_im_d_search"),(0,w.isCommunityInterface)(e)||l.showCancelControl()}else c||(s.stop(),e.set((e=>(0,n.setCurrentSearch)("",!1,e))).then(t),r.classList.remove("im-page--dialogs-search_fill","_im_d_search"),(0,w.isCommunityInterface)(e)||l.hideCancelControl())}function N(e,t,a){return function(){var n=(0,i.getSearchText)(t);n===e&&a(...arguments)}}function R(e,t,a){var r=(0,i.getSearchText)(a);return L(.01,"im_search_stat",1,"search_start"),(0,n.updateSearchQuery)(r),a.setState({recentSearch:!1}),e().toggleSettingsButton(a,!!r),r?(a.get().dialog_search_going=!0,function(e,t,a){var i=N(e,a,(e=>t().appendFastDialogs(a,e)));return(0,n.searchTopConv)(e,a.get()).then((e=>(i(e),e)))}(r,e,a).then((n=>{var i=n.map((e=>e.peerId));return t(r,e,i,a)})).then((()=>{a.get().dialog_search_going=!1})).catch((()=>{}))):(e().restoreDialogs(a,!1,!0),(0,g.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function F(e,t,a,i){var s=i.get(),o=N(e,i,(e=>t().appendDialogs(i,e))),l=N(e,i,t().appendSearch);return(0,r.isPendingForward)(i)?(0,n.searchHints)(e,a,"all",{},s).then(o):Promise.all([(0,n.searchHints)(e,a,"all",{},s).then(o),(0,n.searchMessages)(e,s)]).then((e=>{var t=T(e,2),a=T(t[1],2),n=a[0],r=a[1];l(i,n,r,!0)}))}function O(e,t,a){var i=a.target;e.set((e=>(0,n.toggleCommunityMute)(t,e))).then((()=>{i.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&U(e,{target:i})}))}function U(e,t){var a=t.target;return(0,v.showTooltip)(a,{text:()=>e.get().mute?(0,f.getLang)("mail_im_sound_off"):(0,f.getLang)("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function H(e,t,a,n,i,r,s,l,c,d){return{focusInput(){uiSearch.focus(n.parentNode)},hideCancelControl(){a.classList.remove(P),t.classList.add(A),t.classList.remove(M)},showCancelControl(){a.classList.add(P),t.classList.add(M),t.classList.remove(A)},setSearch(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?c:()=>{};n.value=t,x(e,a,0,n,r,t,l())},clearSearch(e,t){cancelStackFilter("im_search"),(0,w.isCommunityInterface)(e)||l().hideCancelControl(),uiSearch.reset(n),e.setState({recentSearch:!1}),x(e,t||(()=>{}),0,n,r,n.value,l())},initPeerTagsFilter(e){(0,b.initPeerTagsFilter)(e)},updateMenu(e){if((0,w.isBusinessNotifyEnabled)(e)){var t=a.querySelector('[data-action="business_notify"]');if(t){var n=(0,S.unpackStore)(e),i=n.active_tab===y.ConvoListFolder.BUSINESS_NOTIFY||0===(0,w.getConvoListFolderCounterTotal)(n,y.ConvoListFolder.BUSINESS_NOTIFY);t.classList.toggle("im-action--hidden",i)}}},unmount(){r.stop(),d.hide(),(0,o.destroyModule)(s),uiSearch.destroy(i),cancelStackFilter("im_search")}}}function j(e,t,a){var u=(0,o.createMutations)(H),g=u.callMutations,m=u.bindMutations,S=new d.Settings(t,a),T=geByClass1("_im_dialogs_header_controls",e),I=geByClass1(B,e),L=geByClass1(D,e),M=geByClass1("_im_search_cancel",e),A=ge("im_dialogs_search",e),P=geByClass1("_im_gim_mute",e),N=geByClass1("_im_av_time",e),j=geByClass1("_im_peer_tags_filter_control",e),q=(0,s.default)("im_search",[k,B,D,"_im_page_dcontent","_im_d_search","_im_dialog"]),G=(0,_.debouncedPromise)(F,300),z=e=>R(a,G,e),V=e=>x(t,z,0,A,q,e,g()),K=()=>g().clearSearch(t,z),W=geByClass1("_im_dialogs_search_input",e);uiSearch.init(W,{onChange:V}),A.value&&setTimeout((()=>V(A.value)),0);var Y=e=>{(0,v.showTooltip)(e.target,{text:(0,f.getLang)("mail_admin_av_time"),dir:geByClass1("_im_top_notice")||geByClass1("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},$=()=>{var e;e=0===t.get().peer||(0,r.isPendingForward)(t)?"search":"default",(0,i.isSearching)(t)||a().toggleSettingsButton(t,!1),t.get().longpoll.push([(0,p.transitionEvent)(e)])},Q=()=>{(0,i.isSearching)(t)&&a().toggleSettingsButton(t,!0),function(e,t,a,s,o,l){if(!(0,i.isSearching)(e)){var c=cur.imDb.select(h.RECENT_SEARCH_OP);if(0!==c.length||(0,i.doPopularSuggExist)(e)){e.setState({recentSearch:!0}),x(e,(()=>{(0,i.isSearching)(e)||(s.stop(),o().toggleSettingsButton(e,!1),o().restoreDialogs(e,!1,!0))}),0,a,s,"",l);var d=c.filter((t=>!(0,r.isTabLoadedWithMessage)(e.get(),t))),u=c.filter((t=>(0,r.isTabLoadedWithMessage)(e.get(),t))).reduce(((t,a)=>(t[a]=(0,i.getTab)(e,a),t)),{});e.get().topConvTree.then((t=>{var a=t.list.filter((e=>d.includes(e[0]))).reduce(((e,t)=>(e[t[0]]=(0,n.localIndexToDialog)(t),e)),{}),i=E({},a,{},u);return o().appendFastDialogs(e,c.map((e=>i[e]))),a})).then((t=>(0,n.searchHints)(!1,Object.keys(t),!1,{},e.get()))).then((t=>{o().appendDialogs(e,t)}))}}}(t,0,A,q,a,g())},X=(e,n)=>{var i=n.dataset.action;switch(i){case"contacts":(0,l.mount)(t);break;case"favorites":nav.go("/im?box=fav");break;case"business_notify":t.get().active_tab!==y.ConvoListFolder.BUSINESS_NOTIFY&&a().toggleFolder(t,y.ConvoListFolder.BUSINESS_NOTIFY);break;case"spam":(0,r.showSpamLayer)(t,c.mount,e);break;case"settings":S.show();break;case"change_ui_new":case"change_ui_classic":break;case y.ConvoAction.CALL_AUDIO:case y.ConvoAction.CALL_VIDEO:case y.ConvoAction.CALL_APP:(0,r.startCallFromIm)(t,null,i===y.ConvoAction.CALL_VIDEO,[],r.CALL_ENTRY_POINT_LIST,i===y.ConvoAction.CALL_APP);break;case y.ConvoAction.CALL_BY_NAME:(0,r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST,!1,!0)}},J=(0,o.createModule)({handlers:(n,i)=>{n(M,"click",K),n(M,"mouseover",(()=>function(e,t){return(0,v.showTooltip)(t,{appendEl:bodyNode,text:(0,f.getLang)("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,M))),n(I,"click",(()=>a().showCreation(t))),(0,C.domData)(L,"disable-click")||n(L,"click",(()=>{(0,r.startCallFromIm)(t,null,!1,null,r.CALL_ENTRY_POINT_LIST)})),i(e,"click","_im_search_more_action",X),N&&n(N,"mouseover",Y),(0,w.isCommunityInterface)(t)&&P&&(n(P,"click",(e=>O(t,!0,e))),n(P,"mouseover",(e=>U(t,e)))),n(A,"click",Q),n(A,"blur",$),n(A,"focus",(()=>{t.get().longpoll.push([(0,p.transitionEvent)("search")])})),(0,w.isCommunityInterface)(t)&&j&&(i(e,"change","_im_peer_tags_filter_checkbox",(e=>(0,b.onPeerTagsFilterCheckboxChange)(e,t))),i(e,"click","_im_peer_tags_filter_pane_item",(e=>(0,b.onPeerTagsFilterPaneItemClick)(e,t))))}});return(0,w.isCommunityInterface)(t)&&(j?(0,b.initPeerTagsFilter)(t):P&&O(t,!1,{target:P})),m(e,M,T,A,W,q,J,g,z,S)}},966829:(e,t,a)=>{"use strict";a.d(t,{doesSearchResultContainConversations:()=>d,mount:()=>u});a(940851),a(296253);var n=a(907851),i=a(533246),r=a(389430),s=a(663527),o=a(81020);function l(e,t,a,i){var l=intval(domData(i,"msgid"));if(!(0,n.getSelectionText)()&&!(0,s.checkSelectClick)(a)){var c=intval(domData(i,"peer"));return e.set(r.cancelSearch.bind(null,c)),e.get().longpoll.push([(0,o.changePeer)(c,l,!1,!1,t)]),!1}}function c(e,t){return{isAll:e=>(0,r.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return(0,r.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):(0,r.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){(0,i.destroyModule)(t)}}}function d(e){return e.findIndex((e=>"number"==typeof e.peerId&&e.href))>-1}function u(e,t,a){var n=l.bind(null,t,a);return c(0,(0,i.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",n)}}))}},678013:(e,t,a)=>{"use strict";a.d(t,{mount:()=>l});var n=a(533246),i=a(663527),r=a(389430),s=a(929566);function o(e,t,a,n,o){if(!(0,r.isSearchingInplace)(e.get().peer,e.get())&&!(hasClass(o,i.FAILED_CLASS)||hasClass(o,i.SENDING_CLASS)||hasClass(o,"_im_mess_srv")||(0,i.checkSelectClick)(n,o)||(0,s.isAnyMessageBeingEdited)(e)||"A"===n.target.tagName||domClosest("_im_replied_message",n.target)||n.target.classList.contains("_im_retry_media")||n.target.closest("."+i.MESSAGE_KEYBOARD_BUTTON_CLASS)||n.target.closest("."+i.BOT_CAROUSEL_CLASS))){var l,c,d=intval(domData(o,"msgid")),u=e.get().peer;if(!(0,i.isAlreadyDeleted)(e,u,d))l=n.shiftKey?(0,s.getMessageRangeFromSelection)(e,u,d):[d],e.set(r.addSelection.bind(null,l)).then((()=>{var n=(0,s.getSelectedMessages)(e),i=!1;l.forEach((e=>{var t=geByClass1("_im_mess_"+e,a);if(t){var r=inArray(e,n);i|=r,toggleClass(t,"im-mess_selected",r);var s=r?getLang("mail_deselect_message"):getLang("mail_select_message"),o=geByClass1("_im_mess_blind_label_select",t);attr(o,"aria-label",s)}})),i&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)})).then((()=>{1!==e.get().selectedMessages.length||c?c&&c.hide():c=function(e){var t=e.get();if(t.pinnedMessagesPromo&&(0,i.isChatPeer)(t.peer)){var a=geByClass1("_mess-action-promo"),n=new ElementTooltip(a,{autoShow:!1,appendTo:a,content:getTemplate("im_pinned_messages_promo",{content:getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),(0,r.hidePromoTooltip)()}});return n.show(),n}}(e)}))}}function l(e,t,a){var i=o.bind(null,t,a,e),r=(0,n.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",i)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map((t=>geByClass1("_im_mess_"+t,e))).filter((e=>e)).forEach((e=>removeClass(e,"im-mess_selected")))},unmount(){(0,n.destroyModule)(t)}}}(e,r)}},478207:(e,t,a)=>{"use strict";a.d(t,{mount:()=>u});a(59357);var n,i,r=a(533246),s=a(663527);function o(e){var t=ge("page_header"),a=window.clientHeight()-t.offsetHeight-30-2;setStyle(e,{height:Math.max(a,400)})}function l(e){var t=(0,s.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function c(){nav.reload({force:!0})}function d(e){return{unmount(){clearInterval(i),clearTimeout(n),(0,r.destroyModule)(e)}}}function u(e,t,a){o(e);var s,u,g=(0,(0,r.createMutations)(d).bindMutations)((0,r.createModule)({handlers:(t,a)=>{t(e.querySelector("._im_sick_reload"),"click",c),t(window,"resize",o.bind(null,e))}})),m=(s=localStorage.getItem("im_sick_timer"),u=s?Math.min(2*parseInt(s),6e5):5e3,localStorage.setItem("im_sick_timer",u),u),_=e.querySelector("._im_sick_timer"),p=+new Date;return _.innerHTML=l(m),i=setInterval((()=>{_.innerHTML=l(p+m-new Date)}),500),n=setTimeout(c,m),g}},569319:(e,t,a)=>{"use strict";a.d(t,{mount:()=>E});a(530522),a(66108),a(296253),a(991181),a(579665),a(95767),a(59357);var n=a(917685),i=a(791563),r=a(389430),s=a(663527),o=a(533246),l=a(678013),c=a(91257),d=a(81020);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var m="_im_spam_not_spam",_="_im_spam_spam";function p(e,t,a,n){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var i=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,(0,s.wrapLoading)(i)((0,r.loadSpam)(e.offset,n.get().gid).then((t=>{var a=u(t,4),o=(a[0],a[1]),l=(a[2],a[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(i,"im-important_all"):e.loading=!1,n.set((e=>(0,r.mergeTabs)(e,(0,s.tabFromIds)(l.msgs,l.hash))));var c=ce("div");c.innerHTML=o,i.appendChild(c),(0,s.ensureDomHasActions)(i)})),"bottom")}}function h(e,t){var a=t.get().selectedMessages,n=geByClass1("_im_spam_box",e.bodyNode),i=geByClass1("ui_tab_sel",e.bodyNode);if(a.length>0){var r=getLang("mail_selected",a.length);r=r.replace("{count}",a.length),val(i,r+`<button aria-label="${getLang("mail_deselect_all")}" type="button" class="im-deselect ${s.DESELECT_ALL_CLASS}"></button>`)}else val(i,getLang("mail_spam"));0===a.length?removeClass(n,"im-important-box_with-sel"):(addClass(n,"im-important-box_with-sel"),val(geByClass1(m),getLang("mail_im_mark_notspam",a.length)),val(geByClass1(_),getLang("mail_im_mark_delspam",a.length)))}function v(e,t,a){var n=e.get().selectedMessages;e.set(r.cleanSelected).then(a.cleanSelection.bind(null,n)).then((a=>h(t,e)))}function f(e,t,a,n){var i=gpeByClass("_im_mess",n,t);if(i){var o=intval(domData(i,"msgid"));i&&((0,r.removeMessageSend)([o],0,e.get().tabs[0].hash,"undel",e.get()),(0,s.restoreMessage)(o,0,t))}}function b(e,t,a){var n=e.get().selectedMessages;(0,r.removeMessageSend)(n,0,e.get().tabs[0].hash,"delete",e.get()),(0,s.removeMessagesWithRestore)(n,0,"delete",t),v(e,t,a)}function y(e,t,a){var n=e.get().selectedMessages;(0,r.removeMessageSend)(n,0,e.get().tabs[0].hash,"nospam",e.get()),n.map((e=>geByClass1("_im_mess_"+e))).filter((e=>e)).forEach((e=>{var t=intval(domData(e,"peer")),a=intval(domData(e,"msgid"));val(e,(0,s.renderGoTo)(t,a)),addClass(e,"im-mess_light")})),v(e,t,a)}function C(e,t,a,i,r){var s=gpeByClass("_im_mess",r,t.bodyNode),o=intval(domData(s,"peer")),l=intval(domData(s,"msgid"));return t.hide(),a().unmount(),e.get().longpoll.push([(0,d.changePeer)(o,l,!1,!1,"spam_box")]),(0,n.stopEvent)(i),cancelEvent(i),!1}function w(e,t,a,n){var s=(0,i.showFastBox)({title:getLang("mail_deleteall1"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},getLang("mail_delete_all_spam"),getLang("mail_delete"),(()=>{(0,r.flushSpam)(e,n).then((e=>{var t=u(e,2),a=(t[0],t[1]);showDoneBox(a)})),s.hide(),t.hide(),a().unmount()}),getLang("mail_close"),(()=>s.hide()))}function S(e,t){return{unmount(){t.unmount(),(0,o.destroyModule)(e)}}}function E(e,t,a){var n=ge("box_layer_wrap"),i=(0,o.createMutations)(S),r=i.callMutations,d=i.bindMutations,u=(0,c.default)({peer:0,oCache:{},tabs:(0,s.tabFromIds)(a.msgs,a.hash),gid:t.get().gid}),g=p.bind(null,{all:a.all,loading:!1,offset:a.offset},e,n,u),E=f.bind(null,u,e.bodyNode),T=C.bind(null,t,e,r),I=w.bind(null,a.hash,e,r,t.get().gid),L=(0,l.mount)(e.bodyNode,u,(t=>({changedMessageSelection:h.bind(null,e)}))),k=b.bind(null,u,e.bodyNode,L),M=y.bind(null,u,e.bodyNode,L),A=v.bind(null,u,e,L);return(0,s.ensureDomHasActions)(e.bodyNode),d((0,o.createModule)({handlers:(t,a)=>{t(n,"scroll",g),t(geByClass1(_,e.bodyNode),"click",k),t(geByClass1(m,e.bodyNode),"click",M),t(geByClass1("_im_spam_flush",e.bodyNode),"click",I),a(e.bodyNode,"click","_im_mess_restore",E),a(e.bodyNode,"click","_im_go_to",T),a(e.bodyNode,"click",s.DESELECT_ALL_CLASS,A)}}),L)}},186863:(e,t,a)=>{"use strict";a.d(t,{mount:()=>He});a(530522),a(66108),a(579665),a(95767),a(21466),a(751876),a(83276),a(991181),a(59357),a(940851),a(296253);var n=a(172989),i=a(411986),r=a(790899),s=a(969680),o=a(389430),l=a(663527),c=a(636600),d=a(929566),u=a(193483),g=a(361447),m=a(629442),_=a(907851),p=a(533246),h=a(897557),v=a(791563),f=a(719016),b=a(116886),y=a(653439),C=a(503369),w=a(771273),S=a(454665),E=a(283778),T=a(371372),I=a(135685),L=a(164936),k=a(227192),M=a(995343),A=a(81020),P=a(351117),B=a(236205),D=a(469433),x=a(486353),N=a(69785),R=a(992665);function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var U=2e3,H="_mr_button_accept",j="_mr_button_reject",q="_im_submit_btn",G="_im_media_preview",z="MassMentionWarning",V="MassMentionWarning--hidden";function K(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function W(e){return e.map((e=>({id:e[1],type:e[0],kind:e[2]||null})))}function Y(e,t,a,i,r,s){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(ke(t,i))return Promise.resolve(!1);var c=ae(i),u=(0,d.getTab)(i,t);c.getBoundAttach(a.message)&&(a.message=""),a.share_url=c.getShareUrl(),a.cancelled_shares=c.getCancelledShares();var g=(0,m.random)(),_={peerId:t,messageId:"rid"+g,flags:n.FLAG_OUTBOUND,date:intval(Date.now()/1e3)-i.get().timeshift,subject:"",text:(0,l.replaceSpecialSymbols)(clean(a.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:i.get().gid?vk.id:null},type:n.ADD_MESSAGE,attaches:W(a.attaches),minorSortId:u.minor_sort_id};return a.rid=g,a.mess=_,e(t,a),i.get().longpoll.push([_]),o&&s().clearText(t,i),r().newMessage(i),Promise.resolve(!0)}function $(e,t,a,n,i,r,s){var o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];o||(o=e.get().peer);var l=ae(e),c=Q(l,s),d=c?l.dData.attaches.map((e=>[e.type,e.id])):[],u={message:"",attaches:[].concat(d,r)};s&&extend(u,s),X(e,t,!1).then((()=>Y(a,o,u,e,t,n,!1).then((a=>(c&&_e(e,i,t),Promise.resolve(a)))))).catch((t=>{debugLog(t),te(e,i)}))}function Q(e,t){var a=e.dData,n=t&&t.sticker_referrer,i=n&&0===n.indexOf("suggestion"),r=t&&t.is_hintach_item;return(!a.txt.trim()||i||r)&&0===a.attaches.filter((e=>"reply"!==e.type)).length}function X(e,t,a){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(o.changePeer.bind(null,e.get().peer,!1,!1)).then((()=>e.set((t=>(0,o.loadPeer)(e.get().peer,!0,-1,!1,t,"toEnd"))))).then((()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),a)))):Promise.resolve(a)}function J(e,t,a){var n=!!intval(domData(a,"val"));n!==cur.ctrl_submit&&(cur.ctrl_submit=n,(0,N.setInfo)("messages_multiline_input",String(Number(n))).then((()=>{})),e.set((e=>(0,R.setLocalSettingsValue)("ctrl_submit",Number(n),e))))}function Z(e,t,a,n){return!e.get().delayed_ts&&setTimeout((()=>{e.set(o.setDelayedMessage.bind(null,!1,!1)).then((()=>{a(...n)}))}),t)}function ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,b.getLang)("mail_send_error"),t=(0,b.getLang)("global_error");(0,v.showFastBox)({title:t},e,(0,b.getLang)("mail_ok"),(()=>{nav.reload({force:!0})}))}function te(e,t){document.activeElement&&document.activeElement.blur(),ee();var a=geByClass1("_im_send",t);return e.set(o.toggleSendingAbility.bind(null,!0)).then((()=>{(0,l.lockButton)(a)}))}function ae(e){return e.get().tfdraft||new E.ImDraft}function ne(e,t,a,n,i,r){var s=(0,B.getPeer)(e),u=(0,d.getCurrentKeyboard)(e)||{},g=u.one_time,m=void 0!==g&&g,p=geByClass1("_im_send",n);return Promise.resolve().then((()=>{if((0,d.isSendingAvailable)(e)){if((0,o.isAnythingLoading)(e.get())||!(0,l.isFullyLoadedTab)(e,e.get().peer)){var n=Z(e,U,ne,(0,_.toArray)(arguments));return e.set(o.setDelayedMessage.bind(null,!0,n)).then((()=>{(0,l.lockButton)(p)}))}return clearTimeout(e.get().delayed_ts),e.set(o.setDelayedMessage.bind(null,!1,!1)).then((()=>(0,l.unlockButton)(p))).then(X.bind(null,e,t)).then((()=>{var n=r.keyboardAuthorId,o=r.action||{},d=o.attaches||[],u=(0,h.decodeHTMLEntities)(o.payload||""),g=(0,h.decodeHTMLEntities)(o.label||"");(0,l.isChatPeer)(s)&&(g=`@${(0,I.oCacheGet)(e,n).link.slice(1)} ${g}`);return(0,c.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,s,n),Y(a,s,{message:g,attaches:d,payload:u},e,t,i,!1)})).then((()=>m?e.set(o.deleteKeyboard.bind(null,s)):Promise.resolve())).then((()=>i().fixKeyboard()))}})).catch((t=>{debugLog(t),te(e,n)}))}function ie(e,t,a,n,i,r){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return Promise.resolve().then((()=>{var c=geByClass1("_im_send",n);if(!(0,d.isSendingAvailable)(e))return!1;if((0,o.isAnythingLoading)(e.get())||!(0,l.isFullyLoadedTab)(e,e.get().peer)){var u=Z(e,U,ie,(0,_.toArray)(arguments));return e.set(o.setDelayedMessage.bind(null,!0,u)).then((()=>{(0,l.lockButton)(c)}))}clearTimeout(e.get().delayed_ts),i().saveText(e);var g=!1,m=ae(e),p=m.dData.attaches.map((e=>{if("poll"==e.type){var t=r.pollData();return t||(g=!0),[e.type,e.id,t]}return[e.type,e.id]})).concat(s);if(g)return!1;var h=e.set(o.setDelayedMessage.bind(null,!1,!1)).then((()=>{(0,l.unlockButton)(c)})),f=(0,B.getPeer)(e);return h.then((()=>{var r=m.dData.txt,s=t().getEditingMessage();if(s||r||p.length){if(s)return r||p.length&&!m.hasOnlyReplies(s)?(0,l.isMessageTooLong)(r)?void(0,v.showFastBox)((0,b.getLang)("global_error"),(0,b.getLang)("mail_err_edit_too_long")):(t().cancelEditing(),void((0,S.wasMessageReallyModified)(e,s,m)&&((0,S.replaceMsgAfterEdit)(e,s,r,p,m.getShareUrl(),m.getCancelledShares()),t().sendEditMessage(e,s),e.get().longpoll.push([(0,A.editMessageLocallyEvent)(s)])))):void re(e,t,n,s.messageId);var o=(0,l.splitMessageToParts)(r,p).map((n=>Y(a,f,{message:n.msgText||"",attaches:n.attaches||[]},e,t,i)));return Promise.all(o)}})).then(X.bind(null,e,t))})).catch((t=>{debugLog(t),te(e,n)}))}function re(e,t,a,n){var i=e.get(),r=i.peer,s=(0,v.showFastBox)({title:(0,b.getLang)("mail_dialog_msg_delete_title"),dark:1},(0,b.getLang)("mail_dialog_msg_delete_for_all"),(0,b.getLang)("mail_delete"),(function(e){(0,o.removeMessageSend)([n],r,null,"deleteforall",i),s.hide(),t().cancelEditing()}),(0,b.getLang)("global_cancel"),(function(){s.hide(),de(geByClass1("_im_text",a))}))}function se(e,t,a){return e.set(o.deliverMessage.bind(null,t,a,{}))}function oe(e,t,a,n){e.get().longpoll.push([(0,A.failedMessage)(t,a.mess,n)])}function le(e,t,a,n,i,r,s,c,u){var g,m=(0,C.debounce)(Me.bind(null,e,a),500);var _=Emoji.init(geByClass1("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>Re(e,t).then((e=>e&&n([]))),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(a,n){var i=e.get().peer,r=Emoji.val(n);(0,l.isReservedPeer)(i)||ke(i,e)||ae(e).dData.txt==r||!r||function(e){var t=e.get().peer;(0,l.isFullyLoadedTab)(e,t)&&!(0,d.isAnyMessageBeingEdited)(e)&&Date.now()-((0,d.getTab)(e,t).lastTyping||0)>1e3*o.ACTIVITY_PERIOD&&e.set(o.sendTyping.bind(null,t))}(e),Fe(e,t,r),Ue(e,t,r),m(n);var s=t.offsetHeight;if(g&&g!==s){var u=c().updateScroll();c().scrollFix(e,e.get().peer,u)}g=s},onStickerSend:(e,t,a)=>i([["sticker",e,a]],{sticker_referrer:t}),onHintachSend:(e,t)=>r([[e,t]],{is_hintach_item:!0}),uploadActions:s,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){u().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(_,{},(()=>c().showNewConvoStickersHints(e))),e.setState({emojiOptId:_}),_}function ce(e,t,a){var n=Emoji.val(geByClass1("_im_text",t));(0,d.isAnyMessageBeingEdited)(e)&&""!==n||Re(e,t).then((t=>{var i=intval(domData(a.target,"tttype"));(2===i&&!0!==t||1===i&&!0===t||3!==i&&""===n)&&window.tooltips&&tooltips.destroy(a.target,{fasthide:!0});var r=ae(e).dData.attaches.length>0;if((0,d.isAnyMessageBeingEdited)(e)&&""===n&&!r)return domData(a.target,"tttype",3),(0,f.showTooltip)(a.target,{text:(0,b.getLang)("mail_delete_for_all"),black:!0,force:3!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return domData(a.target,"tttype",1),(0,f.showTooltip)(a.target,{text:(0,l.isCommunityInterface)(e)?(0,b.getLang)("mail_send2"):(0,b.getLang)("mail_added_audiomsg"),black:!0,force:1!==i,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});domData(a.target,"tttype",2);return(0,f.showTooltip)(a.target,{text:(()=>{var t=e.get().settings.ctrl_submit?1:0;return getTemplate("ctrl_submit_hint",{enter_on:t?"":"on",ctrl_on:t?"on":""})})(),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==i,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:(0,_.toArray)(geByClass(q)),val:e.get().settings.ctrl_submit?1:0}},onHide(){window.tooltips&&tooltips.destroy(a.target,{fasthide:!0})}})}))}function de(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function ue(e,t,a,n){var i=e.getFwdRaw(),r=t.querySelector("._im_media_fwd"),s=t.parentNode.querySelector("._im_replied_content");if(!((0,d.getCurrentKeyboard)(n)||{}).hide&&i&&a.toggleKeyboard(!0),r.innerHTML="",s.innerHTML="",i){var o=function(e,t){if(e.get().isEditing){var a=(0,l.getNowEditingMessage)(e);return a&&(0,u.hasReply)(a)}return"reply"===t.type}(n,i),c=o?s:r,g=i.object;c.innerHTML=o?me(g):function(e,t,a,n){if(a.object&&a.object.authorName){var i=(0,l.renderShortText)(0,"",n.text,!0,(0,T.convertKludgesToAttaches)(n.kludges,0));return getTemplate("im_attach_mess",{messages:i,text:n.authorName,date:getSmDate(n.date,e.get().timeshift),modifier:"im-fwd_msg"})}return getTemplate("im_attach_mess",{messages:(0,b.getLang)("mail_title_X_msgs",t.getFwdCount()),text:(0,b.getLang)("mail_im_fwd_msgs_title"),date:"",modifier:""})}(n,e,i,g)}}function me(e){var t=(0,l.renderShortText)(0,"",e.text,!0,(0,T.convertKludgesToAttaches)(e.kludges,0));return getTemplate("im_replied_message",{authorName:e.authorName,text:t})}function _e(e,t,a){return e.set(o.forwardMessages.bind(null,null,ae(e),!1)).then((()=>{var n=t.querySelector("._im_media_fwd"),i=t.parentNode.querySelector("._im_replied_content"),r=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");i&&i.children.length&&(i.innerHTML="",ve(e,a)),r&&r.children.length&&(r.innerHTML="",ve(e,a)),n&&n.children.length&&(n.innerHTML="",ve(e,a)),Fe(e,t)}))}function pe(e,t,a){var n=(0,B.getPeer)(e);e.set(o.acceptMessageRequest.bind(null,n)).then((()=>{Ne(e,n,t),a()})).catch((()=>ee()))}function he(e,t,a){var n=(0,B.getPeer)(e);e.set((e=>(0,o.rejectMessageRequest)(n,!1,e))).then((()=>{(0,l.isClassicInterface)(e)&&t(e),a(e,n),n===e.get().peer&&e.get().longpoll.push([(0,A.resetPeer)()])})).catch((()=>ee()))}function ve(e,t){var a=t().updateScroll();t().scrollFix(e,e.get().peer,a)}function fe(e,t,a,n){var i=e.get().peer,r=inArray(i,e.get().mutedPeers);e.set(o.toggleMutePeer.bind(null,i,!r,-1)).then(a().updateState.bind(null,i)),cancelEvent(n)}function be(e,t,a,n){var i=e.get().peer;e.set(o.returnToChat.bind(null,i)).then((e=>e.set(o.getPinnedMessage.bind(null,i)))).then(a().updateChatTopic.bind(null,i)),cancelEvent(n)}var ye="close",Ce="open",we="hide";function Se(e,t,a,n,i,r,s,o){if(s!==ye&&s!==Ce&&s!==we)throw new Error(`Action "${s}" not found`);var c=e.get(),u=(0,d.getCurrentKeyboard)(e);((0,l.isCommunityInterface)(e)||!u||c.isEditing)&&(s=we);var g=s===ye||s===we,m=Promise.resolve();g||a.isMounted||(m=a.init());var _=!u&&s!==Ce;return m.then((()=>(toggleClass(t,"im-chat-input_open-keyboard",!g),toggleClass(t,"im-chat-input_close-keyboard",g&&s!==we),toggleClass(n,"im_chat-input--keyboard-button_hidden",s===we),a.toggle(c.peer,g,r)))).then((()=>{if(!_||o){var t=i().updateScroll();return i().scrollFix(e,c.peer,t)}}))}function Ee(e,t){if((0,d.isAnyMessageBeingEdited)(e))return!1;var a=e.get();if((0,l.isCommunityInterface)(e))return!1;if(!(0,P.getCurrentTab)(e).moneyTransferAvail)return!1;if((0,l.isCommunityPeer)(t))return a.moneyTransferCommAvail;if((0,l.isUserPeer)(t)){var n=inArray(t,a.moneyTransferExcept);return t!=vk.id&&!n&&!(0,l.isContactPeer)(t)}return!1}function Te(e,t){return!(0,d.isAnyMessageBeingEdited)(e)&&(!!e.get().moneyRequestAvail&&(!!(0,P.getCurrentTab)(e).moneyRequestAvail&&(!(!(0,l.isCommunityPeer)(t)&&!(0,l.isChatPeer)(t))||!!(0,l.isUserPeer)(t)&&(t!=vk.id&&!(0,l.isContactPeer)(t)))))}function Ie(e,t,a,n,i,r,s,o,c,u,g,m,_,h,v,f){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[(0,B.getPeer)(e)])},toggleKeyboard(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!(0,d.getCurrentKeyboard)(e).hide;return Se(e,n,m,g,r,!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t?ye:Ce)},initKeyboard(){if(!e.get().peer||!(0,d.getCurrentKeyboard)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[(0,B.getPeer)(e)];return Se(e,n,m,g,r,!0,t?ye:Ce)},fixKeyboard(){var t,a=(0,d.getCurrentKeyboard)(e);return t=a?a.hide?ye:Ce:we,Se(e,n,m,g,r,!0,t,!0)},hideKeyboard:()=>Se(e,n,m,g,r,!1,we),restoreDraft(e,i,s){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1}));var o=e.get().peer,c={gift:(0,l.isGiftOptionAvailableForPeer)(e,o)&&!(0,d.isAnyMessageBeingEdited)(e),money:(0,l.isMoneyOptionAvailableForPeer)(e,o)&&!(0,d.isAnyMessageBeingEdited)(e),poll:(0,l.isChatPeer)(o)},u=geByClass1("ms_items_more",n);Object.entries(c).forEach((e=>{var t=F(e,2),a=t[0],n=t[1],i=geByClass1("ms_item_"+a,u);toggleClass(i,"ms_item--hidden",!n)}));var g={im:!0,fromId:-(0,d.getGroupId)(e)||vk.id,peer:o,moneyTransfer:{request:Te(e,o),send:Ee(e,o)}},m=(0,B.getEmojiOptId)(e);if(void 0===m?e.setState({suggestionsConfig:g}):Emoji.setSuggestionsConfig(m,g),(0,l.isReservedPeer)(o))return Promise.resolve();var _=ae(e);return Emoji.val(a)!==_.dData.txt?(!function(e,t){Emoji.val(e,clean(t)),de(e)}(a,_.dData.txt),Ue(e,n,_.dData.txt)):de(a),_.prepareObjects(e.get().gid,i&&i.messageId).then((()=>{if(!Ne(e,o,a)&&o==e.get().peer){for(var i=_.dData.attaches,l=0;l<i.length;l++)t.chooseMedia(i[l].type,i[l].id,i[l].object||{});if(ue(_,n,this,e),s){var c=r().updateScroll();r().scrollFix(e,o,c)}Fe(e,n,_.dData.txt)}}))},sendMessage(){i([])},sendMessageFromKeyboard(){for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return ne.call(null,e,r,h,n,...a)},choose(e,a,n){t.chooseMedia(e,a,n)},updateChosenMedia(e,a,n){t.updateChosenMedia(e,a,n)},canAddMedia:()=>!t.hasRestrictingAttach()&&!ke(e.get().peer,e),isEmpty:e=>!trim(Emoji.val(a))&&!ae(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,a,n){t.showMediaProgress(e,a,n)},updateState(e){this.restoreKeyboard(),Ne(e,e.get().peer,a)},focusOn(e){Emoji.editableFocus(a,!1,!0)},setDraft(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=(0,d.getTab)(e,e.get().peer);(0,P.doesChatTabHaveFlag)(n,1024)&&!e.get().gid||(_&&_.update(),e.setState({tfdraft:t}),t&&this.restoreDraft(e,r().getEditingMessage(),a))},clearText(e,i){ae(i).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(a,""),_e(i,n,r);var s=r().updateScroll();r().scrollFix(i,i.get().peer,s)},attachMessages(e,t){if(e.get().peer===t){ue(ae(e),n,this,e);var a=r().updateScroll();r().scrollFix(e,t,a),Fe(e,n)}},detachMessages(t){var a=ae(e).getFwdRaw();if(a&&!!a.id.split(";").find((e=>Math.abs(e)===t.messageId)))return _e(e,n,r).then((()=>{var t=r().updateScroll();r().scrollFix(e,e.get().peer,t)}));return Promise.resolve()},cancelRecording(){null==u||u.cancelRecording()},reHeight(e){var t=r().updateScroll();r().scrollFix(e,e.get().peer,t)},isBlocked:()=>ke(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers((0,B.getEmojiOptId)(e),!t)},saveText(e){ae(e).setText(Emoji.val(geByClass1("_im_text",n)))},resendAll(){v()},resendPeer(){f(e.get().peer)},unmount(){(0,p.destroyModule)(c),t.destroy(),o.unmount(),m.unmount(),_&&_.unmount(),Emoji.destroy((0,B.getEmojiOptId)(e)),null==u||u.unmount()}}}function Le(e,t){return!!(0,l.isChatPeer)(e)&&t.get().tabs[e].data.kicked}function ke(e,t){return Le(e,t)||(0,d.getTab)(t,e)&&(0,d.getTab)(t,e).block_error>0||(0,l.isLocksAvailable)(t)&&(0,l.isPeerBlocked)(e,t)}function Me(e,t,a){var n=e.get().peer,i=Emoji.val(a);(0,l.isReservedPeer)(n)||ae(e).dData.txt==i||ke(n,e)||(t.checkMessageURLs(i,!0,U),ae(e).setText(i))}function Ae(e){var t=ae(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function Pe(e,t){e.disabled=!0,e.contentEditable="false",addClass(e,"im-chat-input--text_disabled"),addClass(t,"im-chat-input_error"),addClass(geByClass1("_im_page_history"),"is_tf_blocked")}function Be(e,t){e.disabled=!1,e.contentEditable="true",removeClass(e,"im-chat-input--text_disabled"),removeClass(t,"im-chat-input_error"),removeClass(geByClass1("_im_page_history"),"is_tf_blocked")}var De="renewSubscriptionButton",xe="im-chat-input--donut";function Ne(e,t,a){var n,i=gpeByClass("_im_chat_input_parent",a),r=geByClass1("_im_chat_input_error",i),s=geByClass1("im-chat-input--error",i),o=(0,d.getTab)(e,t),c=ke(t,e);if(c){Pe(a,i);var u=function(e,t,a){switch(a.block_error){case 7:case 5:return(0,b.getLang)("mail_peer_deleted");case 14:return(0,b.getLang)("mail_community_deleted");case 11:return(0,b.getLang)("mail_group_banned_messages");case 28:return(0,b.getLang)("mail_cant_send_messages_by_time");case 29:return(0,b.getLang)("mail_cant_send_messages_by_web_bot");case 4:case 6:case 9:case 19:case 20:case 13:return(0,l.isCommunityPeer)(t)?(0,b.getLang)("mail_send_privacy_community_error"):(0,b.getLang)("mail_send_privacy_error");case 23:var n=(0,I.oCacheGet)(e,t);return langSex(n.sex,(0,b.getLang)("mail_blacklist_user","raw")).replace("{user}",n.kick_name);case 12:return(0,b.getLang)("mail_cant_send_messages_to_community");case 16:return(0,b.getLang)("mail_chat_youre_kicked");case 26:return(0,b.getLang)("mail_chats_is_disabled");case 0:if(Le(t,e))return(0,b.getLang)("mail_chat_youre_kicked");var i=e.get().block_states[t].name;return(0,b.getLang)("mail_community_answering").replace("{username}",i);case 62:return(0,b.getLang)("mail_chats_user_not_don_error");default:return(0,b.getLang)("mail_send_privacy_error")}}(e,t,o),g=function(e,t){var a;return 62===(null===(a=(0,d.getTab)(t,e))||void 0===a?void 0:a.block_error)}(t,e),m=s.querySelector('[data-type="renewSubscriptionButton"]');if(g&&(null==s||s.classList.add(xe),!m)){var _=document.createElement("button");_.textContent=(0,b.getLang)("mail_renew_subscription"),_.classList.add("flat_button"),_.dataset.type=De,_.onclick=()=>(0,D.showDonutSubscribePopup)(null,null,o.ownerId,"im",{type:"subscribe",params:{act:"subscribe_popup"}}),s.append(_)}if(m&&!g&&(null==s||s.classList.remove(xe),m.remove()),(0,d.isChannelPeer)(o)&&addClass(geByClass1("_im_page_history"),"is_channel"),(0,P.isBusinessNotifyTab)(o)&&(null==s||s.classList.add("im-chat-input--business-notify")),(0,l.isFvkcomgroup)(e,t)&&!e.get().gid){addClass(i,"is-f-vkcomgroup");var p=inArray(t,e.get().mutedPeers);u=(0,d.isChatActive)(o)?getTemplate("sImPeerMuteUnmute",{text:p?(0,b.getLang)("mail_im_unmute"):(0,b.getLang)("mail_im_mute"),type:p?"unmute":"mute"}):getTemplate("sImPeerReturnToChat",{text:(0,b.getLang)("mail_return_to_vkcomgroup")})}else removeClass(i,"is-f-vkcomgroup");return val(r,u),!0}!c&&(null==s?void 0:s.classList.contains(xe))&&(null==s||s.classList.remove(xe),null==s||null===(n=s.querySelector('[data-type="renewSubscriptionButton"]'))||void 0===n||n.remove());return o&&(0,l.tabIsMessageRequest)(o)&&!(0,l.tabIsRejectedMessageRequest)(o)&&!(0,x.partConfigEnabled)("simplified_start_conversation")?(Pe(a,i),addClass(i,"is-message_request"),val(r,getTemplate("sImPeerAcceptOrRejectMessageRequest",{cls_accept:H,cls_reject:j})),!0):(i.classList.contains("is-message_request")&&(Be(a,i),removeClass(i,"is-message_request"),val(r,"")),a.disabled&&(removeClass(i,"is-f-vkcomgroup"),removeClass(geByClass1("_im_page_history"),"is_channel"),Be(a,i),removeClass(i,"is-message_request"),val(r,"")),!1)}function Re(e,t,a){return Promise.resolve().then((()=>{var n=null!=a?a:Emoji.val(geByClass1("_im_text",t));if(trim(n))return!(0,d.isAnyMessageBeingEdited)(e)||!(0,l.isMessageTooLong)(n);var i=ae(e),r=(0,l.getNowEditingMessage)(e);return i.hasAttaches()&&!i.hasOnlyReplies(r)}))}function Fe(e,t,a){var n=geByClass1("_im_send",t.parentNode);K(n,{fasthide:!0}),Promise.all([Re(e,t,a),(0,l.isVoiceMessageAvailable)(e)]).then((t=>{var a=F(t,2),i=a[0],r=a[1];if((0,d.isAnyMessageBeingEdited)(e))toggleClass(n,"is_input_empty",!i),attr(n,"aria-label",(0,b.getLang)("mail_im_edit"));else{toggleClass(n,"im-send-btn_audio",!i&&r),toggleClass(n,"im-send-btn_send",i),i&&removeClass(n,"im-send-btn_saudio");var s=i?(0,b.getLang)("mail_send2"):(0,b.getLang)("mail_added_audiomsg");attr(n,"aria-label",s)}}))}function Oe(e){var t=geByClass1(z,e);t.classList.contains(V)||t.classList.add(V)}function Ue(e,t,a){var n=(0,P.getCurrentTab)(e);if(n){if(!(0,l.isChatPeer)(n.peerId)||(0,d.isChannelPeer)(n))return Oe(t);var i=(a.match(M.MASS_MENTION_REGEXP)||[]).map((e=>e.slice(1)));if(0===i.length)return Oe(t),void e.set((e=>(n.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e))));var r=geByClass1(z,t),s=geByClass1("MassMentionWarning__title",r),o=geByClass1("MassMentionWarning__text",r),c=(e,t)=>{n.dontReopenWarningForCurrentMassMention||(s.innerHTML!==e&&(s.innerHTML=e),o.innerHTML!==t&&(o.innerHTML=t),r.classList.remove(V))},u=M.MASS_MENTION_ALIASES.all.some((e=>i.includes(e))),g=M.MASS_MENTION_ALIASES.online.some((e=>i.includes(e)));switch(!0){case u&&n.membersCount>=11:return c((0,b.getLang)("mail_im_mass_mention_warning_title"),(0,b.getLang)("mail_im_mass_mention_warning_many_people_mentioned_text",n.membersCount-1));case g&&n.membersCount>=30:return c((0,b.getLang)("mail_im_mass_mention_warning_title"),(0,b.getLang)("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return Oe(t)}}}function He(e,t,a,n,c){cur.share_timehash=t.get().share_timehash;var u=(0,p.createMutations)(Ie),m=u.callMutations,_=u.bindMutations,h=(0,w.mount)(e,t,m),v=se.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var C=(0,g.initQueue)(v,oe.bind(null,t),{store:!0,key:"im_send_queue_"+vk.id,waitCommit:!0}),E=C.pushMessage,T=C.inspectQueue,I=C.resend,M=C.resendAll,D=C.resendPeer,x=C.setErrored,N=C.complete,R=$.bind(null,t,c,E,m,e),F=$.bind(null,t,c,E,m,e),O=Ae.bind(null,t);hide(geByClass1("ms_items_more_helper",e));var U,z=t.get().mediaTypes||[["photo",(0,b.getLang)("mail_added_photo")],["video",(0,b.getLang)("profile_wall_video")],["audio",(0,b.getLang)("profile_wall_audio")],["doc",(0,b.getLang)("profile_wall_doc")],["map",(0,b.getLang)("profile_wall_map")],["gift",(0,b.getLang)("profile_wall_gift")]];(t.get().moneyTransferAvail||t.get().moneyRequestAvail)&&z.push(["money",(0,b.getLang)("profile_wall_money")]);var V=new MediaSelector(geByClass1("_im_media_selector",e),G,z,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(a,n,i,r){return a&&m().toggleKeyboard(!0),function(e,t,a,n,i,r,s,l,c){if(!t.get().removingMedias){if("album"===i||"page"===i||"mail"===i||"reply"===i)return!1;if("share"===i&&!s.title)return!1;var d,u;r&&"string"==typeof i?(l&&ae(t).addBindUrl(l,i,r),ae(t).addAttach(i,r,s)):(ae(t).syncWithSelector(c),"number"==typeof r&&c.chosenMedias[r]&&(d=c.chosenMedias[r],u=ae(t),("string"==typeof d[0]&&"string"==typeof d[1]&&d[1]||"string"==typeof d[0]&&"group"===d[0])&&u.dData.cancelled.push(`${d[0]},${d[1]}`)));var g=e().updateScroll();if(e().scrollFix(t,t.get().peer,g),t.get().delayed_message&&!(0,o.isAnythingLoading)(t.get()))return a([]),!1;Fe(t,n)}}(c,t,U,e,a,n,i,r,V)},onMediaChange:function(){return function(e,t,a,n,i){if(!t.get().removingMedias){var r=i.getMedias().find((e=>"poll"===e[0]));r&&ae(t).addAttach(r[0],r[1],i.pollData(!0,!0)),Fe(t,n)}}(0,t,0,e,V)},editable:1,onChangedSize:function(){var a,n,i=c().updateScroll();c().scrollFix(t,t.get().peer,i),a=e,n=ge(G).offsetHeight,toggleClass(a,"im-chat-input--overflowed",n>400)},sortable:1,teWidth:150,mail:1,teHeight:100,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}});U=ie.bind(null,t,c,E,e,m,V);var W=ce.bind(null,t,e),Y=geByClass1("_im_send",e),X=(0,l.isCommunityInterface)(t)?null:(0,i.mount)(e,t,$.bind(null,t,c,E,m,e),(()=>{addClass(Y,"im-send-btn_audio"),removeClass(Y,"im-send-btn_static")}),(()=>{m().restoreKeyboard()}));!function(e,t){var a=geByClass1("_im_text",e),n=(0,k.promisify)(stManager.add);(window.Wall?Promise.resolve():n(["page.js"])).then((function(){Wall.initComposer(a,{lang:{introText:(0,b.getLang)("profile_mention_start_typing"),noResult:(0,b.getLang)("profile_mention_not_found")},toup:!0,getValue:()=>t.get().peer>2e9?(window.Emoji&&Emoji.editableVal||val)(a):"",onShow:()=>{addClass(e,"im_mention_shown");var t=data(a,"composer");if(t&&t.wdd&&t.wdd.shown){var n=0,i=!1,r=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,val(t.wddInput,""),Composer.toggleSelectList(t)};each(t.wdd.shown,(function(){this[0]&&(n++,"@"+t.curTerm==this[2]&&(i=!0))})),!n||i&&1==n?r():cancelStackPush("im_mention",r)}},onHide:()=>{removeClass(e,"im_mention_shown"),cancelStackFilter("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=V,t.set(o.initTextStore.bind(null,T,I,x,N));var Z=geByClass1("_im_text",e);setTimeout((()=>{(0,B.getPeer)(t)&&m().setDraft(t,(0,d.getTabDraft)((0,P.getCurrentTab)(t))),le(t,e,V,U,R,F,h,c,m),c().renderStickersPanel(t)}),0);var ee=_e.bind(null,t,e,c),te=pe.bind(null,t,Z,(()=>{var e=c().updateScroll();c().scrollFix(t,(0,B.getPeer)(t),e)})),re=he.bind(null,t,a,n),ue=fe.bind(null,t,e,c),ve=be.bind(null,t,e,c),ye=J.bind(null,t);Ne(t,t.get().peer,Z);var Ce=e.querySelector("._im_keyboard_button"),we=(0,r.mount)(null,t,e,ne.bind(null,t,c,E,e,m),m),Se=(0,l.isCommunityInterface)(t)?(0,s.mount)(t,e.querySelector("._message_templates_container"),(e=>(0,L.setHTML)(Z,e)),(t=>toggleClass(e,"im-chat-input--textarea_show-templates",t))):null,Ee=(0,p.createModule)({handlers:(a,n)=>{a(Y,"click",(()=>{Oe(e),Promise.resolve().then((()=>Re(t,e))).then((e=>{e||(0,d.isAnyMessageBeingEdited)(t)?U([]):(0,l.isVoiceMessageAvailable)(t).then((e=>{if(e){var a=ae(t);Q(a)&&function(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),a=e.getFwdRaw();if(a){var n=a.object;t&&(t.innerHTML=me(n))}else t.innerHTML=""}(a),K(Y,{fasthide:!0}),null==X||X.start(),setTimeout((()=>removeClass(Y,"im-send-btn_saudio")),300)}}))}))})),a(Y,"mouseover",W),a(Z,"focus",(()=>{t.get().longpoll.push([(0,A.transitionEvent)("message")]),cur.focused=t.get().peer})),a(Z,"blur",(()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([(0,A.transitionEvent)(e)]),cur.focused=!1})),a(Ce,"click",(()=>m().toggleKeyboard(void 0))),a(Ce,"mouseover",(()=>{(0,f.showTooltip)(Ce,{text(){var e=(0,d.getCurrentKeyboard)(t);return!e||e.hide?(0,b.getLang)("mail_show_keyboard"):(0,b.getLang)("mail_hide_keyboard")},black:!0,shift:[4,5]})})),a(geByClass1("MassMentionWarning__close"),"click",(()=>{!function(e,t){Oe(t),e.set((e=>((0,P.getCurrentTab)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e))))}(t,e),de(Z)})),n(e.parentNode,"click","_im_peer_mute_unmute",ue),n(e.parentNode,"click","_im_peer_return_to_chat",ve),n(e.parentNode,"click","_im_remove_replied",ee),n(e.parentNode,"click",H,te),n(e.parentNode,"click",j,re),n(e,"click","_im_fwd_close",ee),n(e,"click","_im_will_fwd",O),n(e,"keydown","_im_text",(e=>function(e,t,a,n){if(38===n.which&&a().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!(0,y.hasAccessibilityMode)()&&!(0,o.isAnythingLoading)(e.get())){var i=(0,S.findLastMessageToEdit)(e,(0,P.getCurrentTab)(e));i&&t().startEditing((0,d.getMessage)(e,e.get().peer,i))}}(t,c,m,e))),n(bodyNode,"click",q,ye)}}),Te=_(t,V,Z,e,U,c,T,h,Ee,X,Ce,we,Se,E,M,D);return Te.initKeyboard(),Te}},583014:(e,t,a)=>{"use strict";a.d(t,{mount:()=>S});a(175115);var n=a(533246),i=a(389430),r=a(929566),s=a(663527),o=a(799196),l=a(442699),c=a(719016),d=a(414914),u=a(636600);function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var m="_im_top_banner_hide",_="_im_top_banner_reject_mr",p="_im_top_banner_business_notify",h="_im_top_banner_button_gifts",v="hiddenCallBanners";function f(e){return!e.children.length}function b(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=geByClass1("_im_dialog_actions",e);(0,d.toggleClass)(n,"im-page--chat-header_top-banner",t),(0,d.toggleClass)(n,"im-page--chat-header_top-banner--mr",!!a.messageRequest),(0,d.toggleClass)(n,"im-page--chat-header_top-banner--business-notify",!!a.businessNotify)}function y(e,t){var a=geByClass1(m,e);a&&window.tooltips&&tooltips.hide(a),b(e,!1),t.innerHTML=""}function C(e,t,a){var n=t.participants,i=n.count>0?langNumeric(n.count,getLang("mail_im_n_chat_members","raw")):"";return(0,l.getTemplate)("sImCallBannerContent",{user_list:(0,s.renderCallUserList)(e,n.list),title:getLang("calls_group_call_banner_title"),desc:i,cls:a?"CallBanner--classic":""})}function w(e){var t=e.peerId;if((0,s.isChatPeer)(e.peerId)&&!(0,r.isChatActive)(e))return!1;var a=e.callInProgress,n=cur.imDb.selectByKey(v);return n?!(!a||n[t]&&n[t]===a.join_link):!!a}function S(e,t,a){var d=geByClass1("_im_top_banner",e),S=(0,n.createModule)({handlers:(n,o)=>{var l=geByClass1("_im_dialog_actions",e);o(e,"click",m,(()=>{var n=t.get().peer,o=(0,r.getTab)(t,n);w(o)?function(e){var t=e.peerId,a=e.callInProgress,n=cur.imDb.selectByKey(v)||{};cur.imDb.updateByKey(v,g({},n,{[t]:a.join_link}))}(o):t.set((e=>(0,i.hideTopBannerAction)(n,e))),y(e,d);var l=!!(0,s.renderPinnedMessage)(t);(0,s.compensateHistoryHeightChange)(t,l,!0,a)})),o(e,"click","_im_top_banner_button",(n=>{var r=function(e,t,a,n,r){var o=e.target,l=t.get().peer;if(o.classList.contains("_im_call_banner_join_btn")){var c=o.dataset.link;return(0,s.joinCallFromIm)(t,l,c,!1,s.CALL_ENTRY_POINT_JOIN_BANNER),!1}var d=o.dataset.payload;return d?(t.set((e=>(0,i.callbackTopBannerAction)(l,d,e))),y(a,n),!0):(o.classList.contains(_)&&(r().showMessageRequestRejectDialog(t),e.originalEvent.preventDefault()),o.classList.contains(p)&&(r().showBusinessNotifyDialog(),e.originalEvent.preventDefault()),o.classList.contains(h)&&(showBox("al_gifts.php",{act:"get_gift_box",mid:l,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),(0,u.statlogsValueEvent)("gifts_im_birthday_banner","click",l),e.originalEvent.preventDefault()),!1)}(n,t,e,d,a),o=!r,l=!!(0,s.renderPinnedMessage)(t)||!r;(0,s.compensateHistoryHeightChange)(t,l,o,a)})),o(l,"mouseover",m,((e,t)=>{(0,c.showTooltip)(t,{text:getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:bodyNode})}))}});return{renderPeer(t){var n=(0,r.getTab)(t,t.get().peer);if(n){var i=n.top_banner,c=n.callInProgress,g=!f(d),m=w(n);!m&&!i||(0,r.isSearchShown)(t)?g&&y(e,d):(b(e,!0,{messageRequest:i&&"message_request_banner"===i.name,businessNotify:i&&"business_notify_banner"===i.name}),d.innerHTML=m?function(e,t){return(0,l.getTemplate)("im_top_banner",{text:C(e,t,(0,r.isClassicInterface)(e)),icon:"",buttons:[(0,l.getTemplate)("sImCallBannerButton",{call_link:t.join_link}),(0,l.getTemplate)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,c):function(e){var t=e.icon?(0,l.getTemplate)("im_top_banner_icon",{icon:e.icon}):"",a=e.text;"employees_banner"===e.name&&(a=(0,o.replaceHyperLinks)(a,(e=>(0,o.linksReplacer)(!1,e))),a=(0,o.replaceMentions)(a));var n=(e.buttons||[]).map((e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return(0,l.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"reject_mr":return t+=" _im_top_banner_reject_mr",(0,l.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"business_notify":return t+=" _im_top_banner_business_notify",(0,l.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=` ${h}`,(0,l.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});default:return(0,l.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}}));return!1!==e.can_hide&&(n=n.concat([(0,l.getTemplate)("im_top_banner_hide_btn",{})])),(0,l.getTemplate)("im_top_banner",{text:a,icon:t,buttons:n.join(""),classes:{message_request_banner:"im-top-banner--mr",business_notify_banner:"im-top-banner--business-notify"}[e.name]})}(i),i&&"birthday"===i.name&&(0,u.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer));var _=!f(d);(0,s.compensateHistoryHeightChange)(t,_,g,a)}},unmount(){(0,n.destroyModule)(S)}}}},771273:(e,t,a)=>{"use strict";a.d(t,{mount:()=>C});a(530522),a(283946),a(59357),a(751876);var n=a(791563),i=a(116886),r=a(533246),s=a(666003),o=a(389430),l="_im_upload_dropbox",c="jpg jpeg png gif heic heif".split(" "),d=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function u(e){var t=c.slice(0,c.length);if("types"===e){for(var a=t.length,n=0;n<a;++n)t.push(t[n].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+c.join(",."):"mask"===e?c.join("|"):""}function g(e,t,a){var r=void 0!==t.ind?t.ind:t,s=t.fileName?r+"_"+t.fileName:t;if(re("upload"+s+"_progress_wrap"),e().unchoose(s),!geByClass1("popup_box_container")){var o=(0,i.getLang)("mail_add_doc_error");"wrong_music_file"===a?o=(0,i.getLang)("mail_upload_music_fail"):"wrong_arch_file"===a||"wrong_arch_mp3_file"===a?o=(0,i.getLang)("mail_upload_arch_fail"):"photo"===Upload.options[r].file_name?o=(0,i.getLang)("mail_add_photo_error"):"video_file"===Upload.options[r].file_name?o=(0,i.getLang)("video_upload_error"):"wrong_mp3_file"===a&&(o=(0,i.getLang)("docs_upload_mp3_fail")),setTimeout((0,n.showFastBox)({title:(0,i.getLang)("global_error")},o).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+r)||{}).action}),Upload.embed(r)}function m(e){var t=void 0!==e.ind?e.ind:e,a=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),n=a?t+"_"+a:e,i=ge("upload"+n+"_progress_wrap");return i&&hide(geByClass1("progress_x",i)),n}function _(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var a="^("+u("mask")+")";return[].slice.call(t.items).every((e=>{var t=e.type.split("/");return new RegExp(a,"i").test(t[1])}))?"photo":[].slice.call(t.items).every((e=>"video"===e.type.split("/")[0]||~d.indexOf(e.type)))?"video":"doc"}function p(e){var t=geByClass1(l),a=geByClass1("im-page--chat-header").getBoundingClientRect(),n=geByClass1("im-chat-input").getBoundingClientRect();(a.width<10||n.bottom-a.bottom<10)&&(e="none"),t.style.top=a.bottom+"px",t.style.left=a.left+1+"px",t.style.width=a.width-2+"px",t.style.height=n.bottom-a.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function h(){geByClass1(l).classList.remove("im-dropbox--visible")}function v(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function f(e,t,a,n){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),n().reHeight(a)}function b(e,t,a,n,i){var r=t.get().upload_opts,s=geByClass1("_im_upload_photo",i),o=geByClass1("_im_drop_photo",i);return Upload.init(s,r.url,r.params,{accept:u("accept"),file_name:"photo",file_size_limit:26214400,file_types:u("types"),file_match:r.opts.ext_re,lang:r.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:r.opts.server,error:r.opts.default_error,error_hash:r.opts.error_hash,dropbox:o,dragEl:bodyNode,onNoFilteredCallback(e){Upload.onFileApiSend(n,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,n){var i=window.parseJSON(n);i.photos?function(e,t,a,n){var i=m(e);ajax.post("al_photos.php",extend({act:"choose_uploaded"},t),{onDone:function(e,t){n().choose("photo",e,extend(t,{upload_ind:i}))},onFail:g.bind(null,n,e)})}(e,i,0,a):f(e,n,t,a)},onUploadProgress(e,t,n){var i=void 0!==e.ind?e.ind:e;a().progress("photo",i,v(e,t,n))},onUploadError(e,t){statlogsValueEvent("upload_photo_fails",1,r.opts.server,t),g(a,e,t)},onDragEnter(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&p(_(a,e.dataTransfer))},onDragOut(){h()},onDrop(){h()}})}function y(e,t,a,n){var i=t.get().upload_doc_opts,r=geByClass1("_im_upload_doc",n),s=geByClass1("_im_drop_doc",n);return Upload.init(r,i.url,i.params,{file_name:"file",file_size_limit:1024*(parseInt(i.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:i.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,dropbox:s,dragEl:bodyNode,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,n){var r=window.parseJSON(n);r.file?function(e,t,a,n){var i=m(e),r={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};a.opts.imhash&&(r=extend(r,{from_place:"from_gim",imhash:a.opts.imhash})),ajax.post("docs.php",extend(r,t),{onDone:function(e,t,a){n().choose("doc",e+"_"+t,extend(a,{upload_ind:i}))},onFail:g.bind(null,n,e)})}(e,r,i,a):f(e,n,t,a)},onUploadProgress(e,t,n){var i=void 0!==e.ind?e.ind:e;a().progress("doc",i,v(e,t,n))},onUploadError(e,t){statlogsValueEvent("upload_doc_fails",1,i.opts.server,t),g(a,e,t)}})}function C(e,t,a){removeEvent(bodyNode,"dragover dragenter");var c=geByClass1(l),d=y(0,t,a,c),m=function(e,t,a,n,i){var r=t.get().upload_video_params;if(r){var l=geByClass1("_im_upload_video",i),c=geByClass1("_im_drop_video",i);return r.options.visible_dropbox=!1,(0,s.getUploadModule)(l,c,r,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,n){var i=window.parseJSON(n);i.video_id?(0,s.onVideoUploaded)(e,i,t.get().textMediaSelector,((e,a)=>{var n=document.querySelector('[data-video="'+a+'"]'),i=e.editable.sizes.x[0]||e.thumb;if(n&&i){n.style.backgroundImage=`url(${i})`;var r=gpeByClass("_im_mess",n);"im"===cur.module&&r&&(0,o.updateVideoThumb)(t,r)}})):f(e,n,t,a)},onUploadProgress:function(e,t,n){var i=void 0!==e.ind?e.ind:e;a().progress("video",i,v(e,t,n))},onUploadError:function(e,t){statlogsValueEvent("upload_video_fails",1,r.options.server,t),g(a,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(n,e)},onDragEnter:function(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&p(_(a,e.dataTransfer))},onDragOut:function(){h()},onDrop:function(){h()}})}}(0,t,a,d,c),C=b(0,t,a,m,c);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var w=(0,r.createModule)({handlers:e=>{var t=ge("im_full_upload");e(t,"change",(function o(l){if(window.Upload&&l.target.files){if(a().canAddMedia()){var c=Array.from(l.target.files),d=c.filter((e=>Upload.checkFileType(e.name,u("types")))),g=c.filter((e=>Upload.checkFileType(e.name,(0,s.getUploadVideoExtMasks)("types"))));Upload.onFileApiSend(C,d),Upload.onFileApiSend(m,g)}else(0,n.showFastBox)((0,i.getLang)("global_error"),(0,i.getLang)("global_error"));(0,r.destroyModule)(w);var _=t.cloneNode();_.value="",t.parentNode.replaceChild(_,t),e(t=_,"change",o)}}))}});return{paste(e){Upload.onFileApiSend(C,e)},unmount(){(0,r.destroyModule)(w),Upload.deinit(C),Upload.deinit(m),Upload.deinit(d)}}}},214701:(e,t,a)=>{"use strict";a.d(t,{mount:()=>p});a(940851),a(296253);var n=a(719016),i=a(116886),r=a(389430),s=a(533246),o="_ui_multiselect_cancel";function l(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function c(e){return e.selection=[],Promise.resolve(e)}function d(e,t){return t.selection=t.selection.filter((t=>t.id!==e)),Promise.resolve(t)}function u(e,t,a,n,i,r,s){var o=intval(domData(s,"peer"));tooltips.hide(s),t.set(d.bind(null,o)).then((r=>{m(e,n,t,i),a().selectionDeleted(t,o)}))}function g(e,t,a,n){e.set(r.setCurrentSearch.bind(null,a,!1)).then(t().onChange)}function m(e,t,a,n){var r=a.get().selection,s=uiSearch.getFieldEl(e);uiSearch.focus(e),r.length>0?attr(s,"placeholder",""):attr(s,"placeholder",unclean((0,i.getLang)("mail_search_creation"))),t.innerHTML=r.map((e=>`<div class="token">\n      <div class="token_title">${e.name}</div>\n      <div data-peer="${e.id}" class="token_del ${o}"></div>\n    </div>`)).join(""),toggleClass(e,"ui_multiselect_has_selection",r.length>0),domFC(e).scrollTop+=50,n()}function _(e,t){return(0,n.showTooltip)(t,{text:(0,i.getLang)("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function p(e,t,a){uiSearch.init(e,{onChange:g.bind(null,t,a)});var n=uiSearch.getFieldEl(e),i=ce("div",{className:"_ui_multiselection ui_multiselect_cnt"});n&&n.parentNode.insertBefore(i,n);var r,p,h=(r=n,p=0,function(){var e=r.offsetWidth;setStyle(r,{width:1});var t=r.offsetLeft;p!==t?(p=t,e=r.parentNode.offsetWidth,setStyle(r,{width:Math.max(30,e-t-20)})):setStyle(r,{width:e})});t.set(c);var v=u.bind(null,e,t,a,i,h),f=t=>{document.activeElement!==n&&uiSearch.focus(e)},b=(0,s.createModule)({handlers:(t,a)=>{a(e,"click",o,v),a(e,"mouseover",o,_),t(e,"click",f)}});return{addSelection:(a,n)=>t.set(l.bind(null,{id:a,name:n})).then(m.bind(null,e,i,t,h)),removeSelection:a=>t.set(d.bind(null,a)).then(m.bind(null,e,i,t,h)),resetSelection(){!function(e,t,a,n){e.set(c).then(m.bind(null,t,a,e,n))}(t,e,i,h)},focus(){uiSearch.focus(e)},save(){t.stash(),m(e,i,t,h)},restore(){t.pop(),m(e,i,t,h)},unmount(){uiSearch.destroy(e),(0,s.destroyModule)(b)}}}},744544:(e,t,a)=>{"use strict";a.d(t,{mount:()=>T});a(66108),a(991181),a(820075),a(940851),a(296253);var n=a(663527),i=a(907851),r=a(797399),s=a(533246);function o(e,t){return(0,i.toArray)(e).find((e=>domData(e,"list-id")===t))}function l(e,t){return(0,i.toArray)(e).findIndex((e=>domData(e,"list-id")===t))}function c(e,t,a,n){if(a){d(e,t,n);var i=domData(a,"list-id"),r=i&&o(t.children,i);r&&n.forEach((e=>addClass(r,e))),e.setState({hoveredListItemId:i})}}function d(e,t,a){var n=domQuery("."+a.join("."),t);n&&(0,i.toArray)(n).forEach((e=>{a.forEach((t=>removeClass(e,t)))})),e.setState({hoveredListItemId:null})}function u(e,t){var a=t&&domQuery("."+t.join("."),e)[0];return a?domData(a,"list-id"):null}function g(e,t,a){return e.map(t).reduce(((e,t)=>(e[t]=!0,e)),a)}function m(e,t,a){return{ids:g(a.get().elements,e,{}),scrolls:t,activated:!0}}function _(e,t,a){return a.elements=a.elements.filter((a=>t(a)!==e)),delete a.ids[e],Promise.resolve(a)}function p(e,t,a){var n=[];a.elements=a.elements.map((a=>{var i=t(a),r=e.filter((e=>t(e)===i))[0];return n.push(i),r||a}));var i=e.filter((e=>!inArray(t(e),n)));return a.elements=a.elements.concat(i),Promise.resolve(a)}function h(e){var t={};return e.forEach((e=>{"r"===e[0]&&t[`a,${e[1]}`]?delete t[`a,${e[1]}`]:t[`${e[0]},${e[1]}`]=e})),Object.keys(t).map((e=>t[e]))}function v(e,t,a,n,i,r,s){for(var o=0;o<n;o++)e=domNS(e);var l=se(i(t));return domData(l,"list-id",a),e?r.insertBefore(l,e):r.appendChild(l),s&&s(l),e}function f(e,t,a,n,r){var s=n.get(),o=s.limit,l=s.offset,c=function(e,t){var a=t.get();return!a._sortedEls&&e&&t.setState({elements:a.elements.sort(e),_sortedEls:!0}),t.get().elements}(a().sortFn,n).slice(0,l+o),d=function(e,t){for(var a=[],n=Math.max(e.length,t.length),i=0;i<n;i++){var r=e[i],s=t[i];!r&&s?a.push(["a",s,i]):r&&!s?a.push(["r",r,i]):r!==s&&(a.push(["r",r,i]),a.push(["a",s,i]))}var o=h(a),l=h(a.reverse());return o.length>l.length?l:o}((0,i.toArray)(e.children).map((e=>domData(e,"list-id"))).filter((e=>!!e)),c.map((e=>a().idFn(e).toString())));if(function(e,t,a,n,i){if(0!==t.length){var r=(t=t.sort(((e,t)=>e[2]-t[2]))).filter((e=>"a"===e[0]));if(t.filter((e=>"r"===e[0])).map((t=>e.children[t[2]])).forEach((e=>re(e))),0!==r.length)for(var s=r.shift(),o=s[2],l=(v(e.children[o],a[s[2]],s[1],0,n,e,i),0);l<r.length;l++)s=r[l],v(e.children[o],a[s[2]],s[1],s[2]-o,n,e,i),o=s[2]}}(e,d,c,a().renderFn,a().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(n,t),r)return d.filter((e=>"a"==e[0])).map((e=>parseInt(e[1])))}function b(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=e.get(),c=t.getContainer().children,d=l(c,n||o.hoveredListItemId);d<0||(o.limit+o.offset<d?e.setState({offset:d-o.limit+1}).then(f.bind(null,t.getContainer(),t,a)):Promise.resolve()).then((()=>{var e=c[d],a=t.scrollTop(),n=t.getScrollHeight(),o=e.offsetHeight;r="center"===r?-.5*n:r,s="center"===s?n/2:s;var l=i?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),u=a+r>e.offsetTop,g=o+e.offsetTop>a+n-s;u?l(e.offsetTop-r):g&&l(e.offsetTop-n+o+s)}))}function y(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];return t(...n).then((()=>{e.get().loading=!1}))}function C(e,t,a){return a.scrolls||(a.scrolls={}),a.scrolls[e]&&!t||(a.scrolls[e]={scrolled:a.scrolled||0,scrollItem:a.scrollItem}),Promise.resolve(a)}function w(e,t,a,i){var r=e.get(),s=r.elements,o=i.getContainer(),l=e.setState({offset:r.offset+r.limit}).then((()=>{var a,n=r.offset,l=r.limit;return l+n>s.length?a=t().more(n,l).then((t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t))).then(E.bind(null,e,o,i,t,r.pipeId)):(a=Promise.resolve(),f(o,i,t,e)),a}));if(!a){var c=s.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";(0,n.wrapLoading)(o)(l,"bottom",c)}return l}function S(e,t){var a=e.get().pipeId;return!(void 0!==a&&void 0!==t&&a!==t)}function E(e,t,a,n,i,r){return!!S(e,i)&&e.setState(function(e,t,a){var n=e.filter((e=>!a.ids[t(e)]));return{_sortedEls:!1,els:n,ids:g(n,t,a.ids),elements:a.elements.concat(n)}}(r,n().idFn,e.get())).then(f.bind(null,t,a,n))}function T(e,t,a){var n=y.bind(null,t,w.bind(null,t,a)),h=(e,n)=>{(t.get().activated||e)&&(void 0!==n&&t.get().elements.length>0&&t.setState({scrolled:n}),a().onScroll&&a().onScroll())},v=(0,r.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:h.bind(null,!1),more:!!a().more&&n.bind(null,!1)}),T=(0,s.createModule)({handlers:(n,i)=>{i(e,"click",t.get().elCls,a().onClick)}});return t.setState(m(a().idFn,{},t)),{pipe:(e,n)=>(t.setState({pipeId:n}),e.then(E.bind(null,t,v.getContainer(),v,a,n))),replacePreserveOrder:e=>t.set(p.bind(null,e,a().idFn)).then(f.bind(null,v.getContainer(),v,a)),pipeReplace(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.setState({pipeId:n,stop:!1}),e.then((e=>{if(S(t,n))return t.setState({elements:e,_sortedEls:!1,ids:g(e,a().idFn,{})}).then(f.bind(null,v.getContainer(),v,a,t,i))}))},wipe(){v.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,a)=>t.set(C.bind(null,e,a)),updateScroll(){v.update(!1,!0)},toTop(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?v.smoothScroll(-v.scrollTop()):v.scrollTop(0),e&&h(e,0)},scrollTop:e=>v.scrollTop(e),restoreScroll(e){var a=t.get().scrolls,n=a[e];return n&&(t.setState({scrolls:extend({},a,{[e]:null})}),v.scrollTop(n.scrolled)),!!n},unsetScroll(e){t.setState({scrolls:extend({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var a=v.scroll.scroller,n=v.scrollTop(),i=n+("up"===e?-1:1)*a.clientHeight;t?v.smoothScroll(i-n):v.scrollTop(i)},scrollToElement(e,n,i,r){b(t,v,a,e,n,i,r)},getScroller:()=>v.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?n(e,v):Promise.resolve([]),add:(e,n)=>E(t,v.getContainer(),v,a,n,e),hoverNextElement(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=v.getContainer(),o=s.children,d=l(o,t.get().hoveredListItemId||u(s,n)),g=(0,i.toArray)(o).slice(d+1).find(a().hoverableFn);c(t,s,g,e),b(t,v,a,null,!1,r.top,r.bottom)},hoverPrevElement(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=v.getContainer(),o=s.children,d=l(o,t.get().hoveredListItemId||u(s,n)),g=d>=0&&(0,i.toArray)(o).slice(0,d).reverse().find(a().hoverableFn);c(t,s,g,e),b(t,v,a,null,!1,r.top,r.bottom)},hoverFirstElement(e,n){var r=v.getContainer(),s=r.children,o=(0,i.toArray)(s).findIndex(a().hoverableFn),l=s[o];!t.get().hoveredListItemId&&l&&(c(t,r,l,e),b(t,v,a,o,!1,n.top,n.bottom))},hoverElement(e,n,i){var r=v.getContainer(),s=r.children,o=l(s,e),d=s[o];d&&(c(t,r,d,n),b(t,v,a,o,!1,i.top,i.bottom))},unhoverElements(e){d(t,v.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(m(a().idFn,e,t))},getHoveredElement:()=>o(v.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(_.bind(null,e,a().idFn)).then(f.bind(null,v.getContainer(),v,a))},unmount(){(0,s.destroyModule)(T),v.destroy()}}}},405982:(e,t,a)=>{"use strict";function n(e,t){var a,n,i=function(i){a=void 0!==i.clientX?i.clientX:i.touches[0].clientX,n=void 0!==i.clientY?i.clientY:i.touches[0].clientY,t.onDrag&&t.onDrag.call(e,a,n)},r=function r(s){t.onDrop&&t.onDrop.call(e,a,n),removeEvent(document,"mouseup touchend mouseleave",r),removeEvent(document,"mousemove touchmove",i)},s=function(s){(1===s.which||s.touches&&s.touches[0])&&(addEvent(document,"mouseup touchend mouseleave",r),addEvent(document,"mousemove touchmove",i),a=void 0!==s.clientX?s.clientX:s.touches[0].clientX,n=void 0!==s.clientY?s.clientY:s.touches[0].clientY,t.onStartDrag&&t.onStartDrag.call(e,a,n),t.onDrag&&t.onDrag.call(e,a,n),cancelEvent(s))};e.beginDragHandler=s,addEvent(e,"mousedown touchstart",s)}function i(e){removeEvent(e,"mousedown touchstart",e.beginDragHandler)}a.d(t,{initDraggable:()=>n,removeDraggable:()=>i})},724681:(e,t,a)=>{"use strict";a.d(t,{default:()=>m});a(530522),a(66108),a(296253),a(991181),a(579665),a(95767);function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var r=[],s=0,o=!1;function l(e){r=r.reduce(((t,a)=>{var i=n(a,2),r=i[0],s=i[1];return s(e)?t:t.concat([[r,s]])}),[])}function c(e,t){!1===o&&(o=!0,document.body.addEventListener("click",l,!0)),r=r.concat([[e,t]])}function d(e){r=r.filter((t=>n(t,1)[0]!==e)),0===s&&(document.body.removeEventListener("click",l,!0),o=!1)}function u(e,t){r=r.map((a=>{var i=n(a,2),r=i[0],s=i[1];return r===e?[e,t]:[r,s]}))}function g(e,t){return 0===t.length?t=>(e(t),!0):a=>{var n=t.reduce(((e,t)=>e&&!domClosest(t,a.target)),!0);return n&&e(a),n}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return s++,{stop(){s--,d(e)},replaceOrAdd(a){var i=r.filter((t=>{var a=n(t,1)[0];return e===a})),s=g(a,t);i.length>0?u(e,s):c(e,s)}}}},591140:(e,t,a)=>{"use strict";a.d(t,{create:()=>l});a(940851),a(296253);var n=a(91257),i=a(663527),r=a(229852);function s(e,t){return t.state=e,Promise.resolve(t)}function o(e,t,a,n,s){switch(t){case r.ARROW_UP:(0,i.isEditableFocused)()||(n.scroll(s,"up"),cancelEvent(a));break;case r.ARROW_DOWN:(0,i.isEditableFocused)()||(n.scroll(s,"down"),cancelEvent(a));break;case r.PAGE_UP:a.ctrlKey||(0,i.isClassicInterface)(s)||(n.scroll(s,"up",!0),cancelEvent(a));break;case r.PAGE_DOWN:a.ctrlKey||(0,i.isClassicInterface)(s)||(n.scroll(s,"down",!0),cancelEvent(a));break;case r.HOME:(0,i.isEditableFocused)()||(n.scroll(s,"up",!1,!0),cancelEvent(a));break;case r.END_KEY:(0,i.isEditableFocused)()||(n.scroll(s,"down",!1,!0),cancelEvent(a));break;case r.PRINTABLE:n.focustTxt(e)}}function l(e,t,a,l,c,d){var u=(0,n.default)({state:t||"default"});return{signal(t,n){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(u.get().state){case"default":return o(u,t,n,l,e);case"fwd":case"search":return function(e,t,a,n,s,o){switch(t){case r.ARROW_DOWN:n&&n.hoverNextDialog(o),cancelEvent(a);break;case r.ARROW_UP:n&&n.hoverPrevDialog(o),cancelEvent(a);break;case r.ENTER:(0,i.isEditableFocused)()&&!gpeByClass("_im_dialogs_search_input",document.activeElement)||n&&n.selectHoveredDialog(o);break;case r.PRINTABLE:s.focusInput()}}(0,t,n,a,c,e);case"create":return function(e,t,a,n,s){switch(t){case r.PAGE_UP:!a.ctrlKey&&(0,i.isClassicInterface)(s)&&(n.scroll("up"),cancelEvent(a));break;case r.PAGE_DOWN:!a.ctrlKey&&(0,i.isClassicInterface)(s)&&(n.scroll("down"),cancelEvent(a));break;case r.ARROW_DOWN:n.hoverNextElement(s);break;case r.ARROW_UP:n.hoverPrevElement(s);break;case r.ENTER:gpeByClass("_im_dialogs_creation_name",document.activeElement)?n.confirmCreate(s):gpeByClass("im-create--search",document.activeElement)&&n.selectElement(s);break;case r.PRINTABLE:n.focusSearch(s)}}(0,t,n,d,e);case"message":return function(e,t,a,n,i){switch(t){case r.HOME:case r.END_KEY:n.isEmpty(i)&&o(e,t,a,n,i);break;case r.PAGE_UP:case r.PAGE_DOWN:o(e,t,a,n,i)}}(u,t,n,l,e);default:throw new Error("Unknown state: "+u.get().state)}},transition:e=>u.set(s.bind(null,e))}}},370935:(e,t,a)=>{"use strict";a.d(t,{startLongPollForGroup:()=>L,startLongPoll:()=>k});a(530522),a(66108),a(579665),a(95767),a(940851),a(991181),a(296253);var n=a(389430),i=a(91257),r=a(668660),s=a(172989),o=a(227192),l=a(361447),c=a(907851),d=a(712817),u=a(104819),g=a(713075);function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var p={},h=Date.now();function v(e,t){var a=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&statlogsValueEvent("im_longpoll",1,a+"0x",t.getResponseHeader("x-frontend")),p[a]=p[a]?p[a]+1:1,Date.now()-h>=3e4&&(Object.keys(p).forEach((e=>{statlogsValueEvent("im_longpoll",p[e],e+"0x",t.getResponseHeader("x-frontend"))})),p={},h=Date.now()))}function f(e,t){return Promise.resolve(extend({},t,{timeout:e<64?2*e:e}))}function b(e,t){return Promise.resolve(extend({},t,{imTs:e}))}function y(e){e.set((e=>Promise.resolve(extend({},e,{stopped:!0})))).then((()=>{e.get().cancelToken()}))}function C(e,t){return t.cancelToken=e,Promise.resolve(t)}function w(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function S(e){return e.pauses||(e.pauses=[]),(0,c.lplog)("Aborting all pauses","error"),e.pauses.forEach((e=>e())),e.pauses=[],Promise.resolve(e)}function E(e,t,a,i){var r=i.failed?(0,o.abortablePause)(4,e):{},l=r.abort,d=r.pause;switch(i.failed){case 1:return(0,c.lplog)("Old timestamp, init resync","error"),e.set(w.bind(null,l)),a([s.resyncEvent()]),e.set(n.loadLongPollTs).then(d).then(T.bind(null,e,t,a));case 2:return(0,c.lplog)("Key is incorrect","error"),e.set(w.bind(null,l)),e.set(n.loadLongPollKey).then(d).then(T.bind(null,e,t,a));case 3:throw(0,g.imWeirdLog)("im_longpoll_force_reload",i,!1),nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(b.bind(null,i.ts)).then((()=>i))}}function T(e,t,a){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var n=e.get(),i=`${n.imUrl}/${n.imPart}`,s=(0,r.plaingetCancelable)(i,{act:"a_check",key:n.imKey,version:14,ts:n.imTs,wait:25,mode:n.mode}),o=s.request,l=s.cancel;return e.set(C.bind(null,l)).then((()=>o)).then((t=>{var a=m(t,2),i=a[0],r=a[1];return r&&v(n,r),e.set(f.bind(null,1)),JSON.parse(i)})).catch((e=>{var t=m(e,2),a=(t[0],t[1]);return a&&v(n,a),Promise.reject(new Error(""))})).then(E.bind(null,e,t,a))}function I(e,t,a){e.get().stopped||((0,c.lplog)("New request"),T(e,a,t).then((e=>e.map(s.constructEvent))).then((e=>((0,c.lplog)("Request success","success"),e))).then(t).catch((t=>{if(!e.get().stopped)return(0,c.lplog)("Error, waiting: "+(t.message||"no message (probably browser reset)"),"error"),e.set(f.bind(null,a()?2:e.get().timeout)).then((()=>{var t=(0,o.abortablePause)(e.get().timeout,e),a=t.abort,n=t.pause;return e.set(w.bind(null,a)).then(n)}));(0,c.lplog)("Stopped longpoll")})).then(I.bind(null,e,t,a)))}function L(e){(0,g.imWeirdLog)("im_start_longpoll_group",{},!1);var t=new window.EventEmitter,a=(0,u.createLongpollEventsQueue)(e.ts,(e=>{t.trigger("data",e)})),n=(0,d.createLongpoll)(e,a.onLp);return{onData:e=>t.on("data",e),offData:e=>t.off("data",e),push:e=>t.trigger("data",e),pause:a.pause.bind(a),resume:a.resume.bind(a),abortWaiting:n.abortWaiting.bind(n),onLp:a.onLp.bind(a),stop:n.stopConnection.bind(n),isEnabled:()=>!(!n||n.isStopped())}}function k(e){var t=e.id,a=e.gid,n=e.key,r=e.ts,s=e.url,o=e.lhost,c=e.lpstat,d="main",u=new EventEmitter,g=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,m=(0,l.initQueue)((function(e,t){return g&&window.longpollTesting_onImEvents(t),u.trigger("data",t),Promise.resolve({})})),_=m.pause,p=m.resume,h=m.pushMessage,v=m.isPaused,f=m.reset,b=(0,i.default)({id:t,gid:a,mode:202,timeout:1,imKey:n,imTs:r,imPart:s,imUrl:o,pause:!1,stat:c});return I(b,h.bind(null,d),v.bind(null,d)),{onData:e=>u.on("data",e),offData:e=>u.off("data",e),abortWaiting:()=>b.set(S),stop:y.bind(null,b),pause:_.bind(null,d),resume:p.bind(null,d),reset:f.bind(null,d),push:e=>u.trigger("data",e),isEnabled:()=>!b.get().pause&&!b.get().stopped}}},361447:(e,t,a)=>{"use strict";a.d(t,{initQueue:()=>h});a(820075),a(991181),a(940851),a(296253);var n=a(91257),i=a(227192);function r(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function s(e,t){var a=t.queues[e].currEv;return a?(t.queues[e].errored.push(a),r(e,t)):Promise.resolve(t)}function o(e,t,a){return a.queues[e]?(a.queues[e].errored=t?[]:a.queues[e].errored.concat(a.queues[e].evs),a.queues[e].evs=[],r(e,a)):Promise.resolve(a)}function l(e,t,a,n){var i=n.get().queues[e];if(i&&!i.currEv&&i.evs.length>0&&!i.pause){var o=l.bind(null,e,t,a,n),c=i.evs.shift();i.currEv=c,t(e,c).then((()=>{n.get().opts.waitCommit||n.set(r.bind(null,e))})).then(o).catch((t=>n.set(s.bind(null,e)).then((()=>{a(e,function(e,t){var a=g(e,t.get()).errored;return a.length>0&&a[a.length-1]}(e,n),t)})).then(o)))}}function c(e,t,a){var n=a.queues[e];return n.errored.filter((e=>e.mess.messageId===t)).forEach((e=>{e.failed=!1,n.evs.push(e)})),n.errored=n.errored.filter((e=>e.mess.messageId!==t)),Promise.resolve(a)}function d(e){var t=Date.now();return Object.keys(e.queues).forEach((a=>u(a,e,t,18e5))),Promise.resolve(e)}function u(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.queues[e],r=[];return i.errored.forEach((e=>{e.ts>=a-n?(e.failed=!1,i.evs.push(e)):r.push(e)})),i.errored=r,Promise.resolve(t)}function g(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function m(e,t,a){return g(e,a).pause=t,Promise.resolve(a)}function _(e,t,a){return t.ts=Date.now(),g(e,a).evs.push(t),Promise.resolve(a)}function p(e){Object.keys(e.get().queues).forEach((t=>{e.set(s.bind(null,t)),e.set(o.bind(null,t,!1))}))}function h(e,t,a){var s=(0,n.default)({queues:{},debug:a&&a.debug,opts:extend({},a)},a);return a&&a.store?(s.setState(function(e){for(var t={},a=Object.keys(e.queues),n=a.length,i=0;i<n;i++){var r=a[i],s=e.queues[r];(s.currEv||s.evs.length||s.errored.length)&&(t[r]=s)}return{queues:t,opts:e.opts}}(s.get())),p(s)):p(s),{pushMessage:(a,n)=>s.set(_.bind(null,a,n)).then((n=>{l(a,e,t,n)})),resend(a){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return s.set(c.bind(null,a,n)).then((()=>{var i=s.get().queues[a].evs.filter((e=>e.mess.messageId===n))[0];return l(a,e,t,s),i}))},resendAll:()=>s.set(d).then((()=>{Object.keys(s.get().queues).forEach((a=>{l(a,e,t,s)}))})),resendPeer:a=>s.set(u.bind(null,a)).then((()=>{l(a,e,t,s)})),reset:a=>s.set(o.bind(null,a,!0)).then((n=>{l(a,e,t,n)})),setErrored:(e,t)=>s.set((a=>(g(e,a).errored=t,Promise.resolve(a)))),pause(e){s.set(m.bind(null,e,!0))},isPaused:e=>!!g(e,s.get()).pause,complete(a,n){var i=s.get();i.queues[a].currEv&&i.queues[a].currEv.rid===n&&s.set(r.bind(null,a)).then((()=>{l(a,e,t,s)}))},resume(a){s.set(m.bind(null,a,!1)).then((0,i.pause)(.1)).then((()=>{l(a,e,t,s)}))},inspectQueue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!s.get().queues[e])return[];var a=s.get().queues[e];return(t&&a.currEv?[a.currEv]:[]).concat(a.evs.slice()).concat(a.errored.slice().map((e=>extend({},e,{failed:!0})))).sort(((e,t)=>e.ts-t.ts))}}}},888469:(e,t,a)=>{"use strict";a.d(t,{createWorker:()=>h});a(579665),a(95767),a(530522),a(66108),a(751876),a(175115),a(991181),a(296253),a(388416);var n=a(227192);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return s(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var l=new Map,c=!1;function d(e){return e.queue||e.key}function u(){l.forEach(((e,t)=>{var a=e.onData,n=e.onUpdateKey,i=e.ts;if(function(e){var t;return!!(null===(t=window.curNotifier)||void 0===t?void 0:t.addQueues)&&!curNotifier.addQueues[d(e)]}(t)){var r=o({},t,{ts:i});Notifier.addKey(r,p.bind(null,a,n,r))}}))}function g(){c||(c=setInterval(u,3e3))}function m(e){!function(e){var t;if(!(null===(t=window.curNotifier)||void 0===t?void 0:t.addQueues))return!1;delete curNotifier.addQueues[d(e)]}(e),l.delete(e),0===l.size&&(clearInterval(c),c=!1)}function _(e,t){var a,n=void 0,s=null==e?void 0:e.queue;if(s){var o,c=function(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=r(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,s=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}(l);try{for(c.s();!(o=c.n()).done;){var d=i(o.value,1)[0];if((null==d?void 0:d.queue)===s){n=d;break}}}catch(e){c.e(e)}finally{c.f()}}var u=null!==(a=n)&&void 0!==a?a:e;l.set(u,t)}function p(e,t,a,i,r){if(r.failed)return m(a),void function(e,t,a,i){var r;switch(e){case 1:case 2:case 3:case 5:r=i(t,e);break;case 4:r=(0,n.pause)(1).then((()=>t));break;default:throw new Error("Unkonwn error from queue: "+e)}(0,n.pause)(3).then((()=>r)).then((e=>{l.set(e,{onUpdateKey:i,onData:a,ts:e.ts}),u(),g()}))}(r.err,a,e,t);var s=intval(r.ts);Object.assign(a,{ts:s}),_(a,{onData:e,onUpdateKey:t,ts:s}),r.events.map((e=>"string"==typeof e?e.split("<!>"):e)).forEach(e)}function h(e,t,a){return Notifier.addKey(e,p.bind(null,t,a,e)),l.set(e,{onData:t,onUpdateKey:a,ts:e.ts}),g(),{stop:m.bind(null,e)}}},666003:(e,t,a)=>{"use strict";a.d(t,{default:()=>r,getUploadVideoExtMasks:()=>s,getUploadModule:()=>l,onVideoUploaded:()=>c});a(175115),a(59357);var n=a(791563),i=a(571399);const r={getUploadModule:(e,t,a,n,i)=>l(e,t,a,n,i),initModalVideoUploader(e){var t=cur.videoUploadParams,a=ge("choose_video_upload");if(!a)return!1;this.initDragEvents();var n={};return"article"===e&&(n.onUploadProgress=()=>{},n.onUploadStartDone=()=>{var e,t;null===(e=(t=cur).onMediaUploadStarted)||void 0===e||e.call(t)},n.onUploadError=()=>{var e,t;null===(e=(t=cur).onMediaUploadFail)||void 0===e||e.call(t)}),l(a,boxLayerWrap,t,null,n)},initDragEvents(){var e,t=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var t=ge("video_choose_upload_area_wrap");if(!hasClass(t,"video_choose_upload_area_enter")){addClass(t,"video_choose_upload_area_enter");var a=ge("video_choose_wrap"),n=getXY(a)[1],i=getSize(t)[1];return hide("video_choose_wrap"),setStyle(t,"height",scrollGetY()+window.clientHeight()-n+i),cancelEvent(e)}},a=e=>cancelEvent(e),n=e=>{if(a(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},i=()=>{addEvent(boxLayerWrap,"dragenter dragover",t),addEvent(boxLayerWrap,"dragleave",a),addEvent(boxLayerWrap,"drop",n)};i();var r=null===(e=curBox().getOptions())||void 0===e?void 0:e.onHide;setTimeout(curBox().setOptions.pbind({onHide:()=>{if(removeEvent(boxLayerWrap,"dragenter dragover",t),removeEvent(boxLayerWrap,"dragleave",a),removeEvent(boxLayerWrap,"drop",n),"function"==typeof r)return r()},onShow:()=>{Video.initChooseBox(),i()}}),0)}};function s(e){var t=i.VIDEO_UPLOAD_EXTS.slice(0,i.VIDEO_UPLOAD_EXTS.length);if("types"===e){for(var a=t.length,n=0;n<a;++n)t.push(t[n].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+i.VIDEO_UPLOAD_EXTS.join(",."):""}function o(e){if(!cur.leaving){var t=getLang("video_upload_changed"),a=!1;if(each(window.cur.videoUploaders,((e,t)=>{Upload.isSomethingUploading(t)&&(a=!0)})),1===e){if(!a)return!0;var i=(0,n.showFastBox)({title:getLang("global_warning"),dark:!0},t,getLang("global_continue"),(function(){cur.leaving=!0,i.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){i.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return a?winToUtf(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function l(e,t,a,r,l){if(a){r=r||cur,(l=l||{}).onUploadStart||(l.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,a){if(!1===o(1))return cur.onContinueCb=nav.go.pbind(a),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=o,l.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),l.onUploadStartDone&&l.onUploadStartDone()}),l.onUploadComplete||(l.onUploadComplete=(e,t)=>{var a=window.parseJSON(t);a.video_id?c(e,a,r):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);l.onUploadCompleteDone&&l.onUploadCompleteDone(),setTimeout((()=>{l.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&l.onUploadAllCompleteDone()}))}),l.onUploadProgress||(l.onUploadProgress=(e,t,a)=>{var n=void 0!==e.ind?e.ind:e;show("_im_media_preview"),r.showMediaProgress&&r.showMediaProgress("video",n,function(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,a))}),l.onUploadError||(l.onUploadError=(e,t)=>{statlogsValueEvent("upload_video_fails",1,a.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,a=e.fileName?t+"_"+e.fileName:e;if(re("upload"+a+"_progress_wrap"),!geByClass1("popup_box_container")){var i=getLang("video_upload_error");setTimeout((0,n.showFastBox)({title:getLang("global_error")},i).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var d=cur.maxFiles-(cur.savedVideos||[]).length,u=browser.safari?"":"video/*,"+s("accept");a.lang&&(cur.lang=extend(cur.lang||{},a.lang));var g={accept:u,file_input:null,file_name:"video_file",file_size_limit:1024*(a.options.file_size_limit_in_GB||i.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:s("types"),chooseBox:1,chunked:1,chunkSize:i.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:t,from:a.vars.from,lang:a.lang,max_attempts:3,max_files:d,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!a.options.hasOwnProperty("visible_dropbox")||a.options.visible_dropbox},m=Upload.init(e,"",{},Object.assign(g,l));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(m),m}}function c(e,t,a,i){a=a||cur;var r=void 0!==e.ind?e.ind:e,s=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),o=s?r+"_"+s:e,l=t.owner_id+"_"+t.video_id,c=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo,d=ge("upload"+o+"_progress_wrap");d&&hide(geByClass1("progress_x",d)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:l},{onDone:e=>{c||a.chooseMedia("video",l,extend(e[l],{upload_ind:o,upload_new:!0}));var r=t.owner_id,s=t.video_id,d=t.video_hash,u=0,g=()=>{ajax.post("al_video.php?act=encode_progress",{oid:r,vid:s,hash:d,need_thumb:1},{onDone:t=>{var d,u=!0;if(t){if(t.error)return d=getLang("video_upload_encode_error"),void setTimeout((0,n.showFastBox)({title:getLang("global_error")},d).hide,2e3);t.thumb&&(u=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:r,vid:s},{onDone:t=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(l,t),void re("upload"+o+"_progress_wrap");a.hasChosenMedia("video",l)?a.updateChosenMedia("video",l,extend(t,{upload_ind:o,upload_new:!0})):i&&i(e,l)}}))}u&&(c||a.hasChosenMedia("video",l))&&setTimeout(g,1e3)},onFail:()=>{++u<3&&setTimeout(g,2e3*u)}})};g()}})}},571399:(e,t,a)=>{"use strict";a.d(t,{VIDEO_UPLOAD_EXTS:()=>n,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>i,VIDEO_UPLOAD_CHUNK_SIZE:()=>r});a(751876);var n="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),i=5,r=4194304},164936:(e,t,a)=>{"use strict";a.d(t,{setHTML:()=>o,WithEmoji:()=>l,default:()=>d});a(175115),a(95767),a(991181),a(296253);var n=a(667294),i=(a(45697),a(659397));function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function o(e,t){var a=!!window.getSelection&&window.getSelection(),n=!1;if(a&&a.rangeCount){var i=a.getRangeAt(0);n=i.commonAncestorContainer?i.commonAncestorContainer:i.parentElement?i.parentElement():i.item(0)}for(var r=n;r&&r!==e;)r=r.parentNode;window.Emoji&&(r||window.Emoji.editableFocus(e,!1,!0),window.Emoji.insertHTML(t))}var l=n.memo((e=>{var t=e.title,a=e.children,r=n.useRef(),s=n.useRef({}),o=n.useMemo((()=>{var e=n.Children.only(a);return n.cloneElement(e,{ref:t=>{e.ref&&e.ref(t),s.current=t||{}},className:(0,i.classNames)(e.props.className,"WithEmoji__textbox")})}),[a]);return n.useEffect((()=>{window.Emoji&&window.Emoji.init(s.current.container,{noStickers:!0,onSend:()=>{},ctrlSend:()=>!0,noLineBreaks:!o.props.isMultiLine})}),[]),n.createElement("div",{className:"WithEmoji__field _emoji_field_wrap"},o,n.createElement("div",{className:"WithEmoji__smile emoji_smile_wrap _emoji_wrap"},n.createElement("div",{className:"emoji_smile _emoji_btn",ref:r,title:t,onMouseOver:e=>{e.persist(),window.Emoji&&window.Emoji.show(r.current,e)},onMouseOut:e=>{e.persist(),window.Emoji&&window.Emoji.hide(r.current,e)}},n.createElement("div",{className:"emoji_smile_icon"}))))}));class c extends n.Component{constructor(){super(...arguments),this.onChange=()=>{this.props.onChange&&window.Emoji&&this.props.onChange(window.Emoji.val(this.container))},this.containerRef=n.createRef(),this.state={value:this.props.initialValue}}componentDidMount(){if(this.container=this.containerRef.current,this.container&&!this.isMount){this.isMount=!0;var e=this.props.initialValue;window.Emoji&&window.Emoji.val(this.container,window.Emoji.emojiToHTML(e))}}componentWillUnmount(){this.container&&this.isMount&&(this.isMount=!1)}render(){var e=this.props,t=e.tabIndex,a=e.isMultiLine,i=(e.initialValue,s(e,["tabIndex","isMultiLine","initialValue"]));return n.createElement("div",r({role:"textbox",ref:this.containerRef,tabIndex:t,contentEditable:!0,"aria-multiline":a,onInput:this.onChange},i))}}c.defaultProps={isMultiLine:!1,tabIndex:0,initialValue:""};const d=c},809824:(e,t,a)=>{"use strict";var n=a(99275).f,i=a(342503),r=a(424408),s=a(500741),o=a(83328),l=a(803531),c=a(142923),d=a(715436),u=a(102974),g=a(867057),m=a(484728).fastKey,_=a(301616),p=g?"_s":"size",h=function(e,t){var a,n=m(t);if("F"!==n)return e._i[n];for(a=e._f;a;a=a.n)if(a.k==t)return a};e.exports={getConstructor:function(e,t,a,c){var d=e((function(e,n){o(e,d,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[p]=0,null!=n&&l(n,a,e[c],e)}));return r(d.prototype,{clear:function(){for(var e=_(this,t),a=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete a[n.i];e._f=e._l=void 0,e[p]=0},delete:function(e){var a=_(this,t),n=h(a,e);if(n){var i=n.n,r=n.p;delete a._i[n.i],n.r=!0,r&&(r.n=i),i&&(i.p=r),a._f==n&&(a._f=i),a._l==n&&(a._l=r),a[p]--}return!!n},forEach:function(e){_(this,t);for(var a,n=s(e,arguments.length>1?arguments[1]:void 0,3);a=a?a.n:this._f;)for(n(a.v,a.k,this);a&&a.r;)a=a.p},has:function(e){return!!h(_(this,t),e)}}),g&&n(d.prototype,"size",{get:function(){return _(this,t)[p]}}),d},def:function(e,t,a){var n,i,r=h(e,t);return r?r.v=a:(e._l=r={i:i=m(t,!0),k:t,v:a,p:n=e._l,n:void 0,r:!1},e._f||(e._f=r),n&&(n.n=r),e[p]++,"F"!==i&&(e._i[i]=r)),e},getEntry:h,setStrong:function(e,t,a){c(e,t,(function(e,a){this._t=_(e,t),this._k=a,this._l=void 0}),(function(){for(var e=this,t=e._k,a=e._l;a&&a.r;)a=a.p;return e._t&&(e._l=a=a?a.n:e._t._f)?d(0,"keys"==t?a.k:"values"==t?a.v:[a.k,a.v]):(e._t=void 0,d(1))}),a?"entries":"values",!a,!0),u(t)}}},745795:(e,t,a)=>{"use strict";var n=a(803816),i=a(542985),r=a(277234),s=a(424408),o=a(484728),l=a(803531),c=a(83328),d=a(755286),u=a(574253),g=a(307462),m=a(222943),_=a(640266);e.exports=function(e,t,a,p,h,v){var f=n[e],b=f,y=h?"set":"add",C=b&&b.prototype,w={},S=function(e){var t=C[e];r(C,e,"delete"==e||"has"==e?function(e){return!(v&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return v&&!d(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,a){return t.call(this,0===e?0:e,a),this})};if("function"==typeof b&&(v||C.forEach&&!u((function(){(new b).entries().next()})))){var E=new b,T=E[y](v?{}:-0,1)!=E,I=u((function(){E.has(1)})),L=g((function(e){new b(e)})),k=!v&&u((function(){for(var e=new b,t=5;t--;)e[y](t,t);return!e.has(-0)}));L||((b=t((function(t,a){c(t,b,e);var n=_(new f,t,b);return null!=a&&l(a,h,n[y],n),n}))).prototype=C,C.constructor=b),(I||k)&&(S("delete"),S("has"),h&&S("get")),(k||T)&&S(y),v&&C.clear&&delete C.clear}else b=p.getConstructor(t,e,h,y),s(b.prototype,a),o.NEED=!0;return m(b,e),w[e]=b,i(i.G+i.W+i.F*(b!=f),w),v||p.setStrong(b,e,h),b}},301616:(e,t,a)=>{var n=a(755286);e.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},388416:(e,t,a)=>{"use strict";var n=a(809824),i=a(301616),r="Map";e.exports=a(745795)(r,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(i(this,r),e);return t&&t.v},set:function(e,t){return n.def(i(this,r),0===e?0:e,t)}},n,!0)},798184:(e,t,a)=>{"use strict";var n=a(809824),i=a(301616);e.exports=a(745795)("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},781303:(e,t,a)=>{a(778440)("Int32",4,(function(e){return function(t,a,n){return e(this,t,a,n)}}))},814116:(e,t,a)=>{"use strict";a.d(t,{EntityType:()=>n,EventQueue:()=>r});var n,i=a(570655);!function(e){e.Online="online"}(n||(n={}));var r=function(e){var t=this,a=e.getQueue,n=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var a=(0,i.__assign)({},e);t.intervalId=window.setInterval((function(){t.registerQueue(a,(function(e,n){var r,s,o,l;if(function(e){return void 0!==e.err}(n))t.restart();else{a.ts=n.ts;try{for(var c=(0,i.__values)(n.events),d=c.next();!d.done;d=c.next()){var u=d.value;try{for(var g=(o=void 0,(0,i.__values)(t.listeners)),m=g.next();!m.done;m=g.next())(0,m.value)(u)}catch(e){o={error:e}}finally{try{m&&!m.done&&(l=g.return)&&l.call(g)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=n,this.getQueue=a}},976829:(e,t,a)=>{"use strict";a.d(t,{createLongpollConnect:()=>g});var n=a(570655),i=a(227192),r=a(668660),s=a(172989),o=a(486353);function l(e,t){e.waitAbortFns.push(t)}function c(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=(0,r.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),a=t.request,s=t.cancel;return e.stopFn=s,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:a,cancel:s},a.then((function(t){var a=(0,n.__read)(t,2),i=a[0],r=a[1];return window.lpDebug&&(window.lpDebug=(0,n.__assign)((0,n.__assign)({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,r),e.waitTimeout=2,JSON.parse(i)})).catch((function(t){var a=(0,n.__read)(t,2)[1];return window.lpDebug&&(window.lpDebug=(0,n.__assign)((0,n.__assign)({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,a),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var a=t.failed?(0,i.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},r=a.abort,s=a.pause;switch(t.failed){case 1:return l(e,r),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(s).then((function(){return c(e)}));case 2:return l(e,r),e.onKeyExpired(e,t).then((function(t){var a=(0,n.__read)(t,4),i=a[0],r=a[1],s=a[2],o=a[3];return e.onResult({ts:+o,updates:[[-2,i,r+"/"+s],[-1]]})})).then(s).then((function(){return c(e)}));case 3:return e.onLpBroken(e,t);default:return(0,o.partConfigEnabled)("im_longpoll_clocks")&&t.updates.some((function(e){switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(s).then((function(){return c(e)})):Promise.resolve(t)}}(e,t)}))}function d(e){e.isStoppedFn()||c(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&u(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),u(e,-3);var a=(0,i.abortablePause)(e.waitTimeout,null),n=a.abort,r=a.pause;return l(e,n),r().then((function(){return u(e,-4)}))}(e,t)})).then((function(){return d(e)}))}function u(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function g(e,t){var a=!!e.stopped,n={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||14,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return a},onResult:function(e){e.ts&&r(n.ts,e.ts,e.updates.map(s.constructEvent))},onData:m(t.onData),onRequestError:m(t.onRequestError),onHistoryLost:_(t.onHistoryLost),onKeyExpired:_(t.onKeyExpired),onLpBroken:_(t.onHistoryLost)},i=t.onEvents;function r(e,t,a){n.ts=t;for(var r=0;r<a.length;++r)a[r].type===s.REFRESH_LP_KEY&&(n.key=a[r].key||"",n.url=a[r].url||"");i(e,t,a)}var o={options:n,isStopped:function(){return a},stopConnection:function(){a=!0,n.stopFn&&n.stopFn(),n.stopFn=void 0,document.removeEventListener("resume",l),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",l),u(n,-4),a=!1,d(n)},abortWaiting:function(){n.waitAbortFns.forEach((function(e){return e()})),n.waitAbortFns=[],n.waitTimeout=2},onLp:r};function l(){o.abortWaiting()}return document.addEventListener("resume",l),d(n),o}function m(e){return e||function(){}}function _(e){return e?function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];return Promise.resolve(e.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(t))))}:function(){return Promise.reject()}}},104819:(e,t,a)=>{"use strict";a.d(t,{createLongpollEventsQueue:()=>i});var n=a(570655);function i(e,t,a){var i=0,r=e,s=[],o=!1;function l(){!s.length||i>0||o||(t(s),s=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,l())},onLp:function(e,t,i){o||(r>=e?(r=t,s.push.apply(s,(0,n.__spreadArray)([],(0,n.__read)(i))),l()):a&&(o=!0,a(r).then((function(e){var t=(0,n.__read)(e,3),a=t[1],i=t[2];r=a,o=!1,s.push.apply(s,(0,n.__spreadArray)([],(0,n.__read)(i))),l()}))))}}}},889854:(e,t,a)=>{"use strict";a.d(t,{screenWakeLocker:()=>n});var n=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}())},257326:(e,t,a)=>{"use strict";a.d(t,{ContactsList:()=>u});var n=a(570655),i=a(667294),r=a(138671),s=a(7692),o=a(276776),l=a(706885),c=a(41437),d=a(907851),u=function(e){var t=e.onClose,a=e.selectPeer,u=e.getContactsList,g=(0,n.__read)(i.useState({kind:"loading"}),2),m=g[0],_=g[1];switch(i.useEffect((function(){u().then((function(e){_({kind:"loaded",contactsList:e})})).catch((function(e){(0,d.showErrorBox)((0,c.getLang)("global_error")),_({kind:"failed",error:e}),t()}))}),[]),m.kind){case"failed":return i.createElement(i.Fragment,null);case"loading":return i.createElement(l.default,null);case"loaded":return i.createElement(r.default,{onClose:t,disableBodyScroll:!0,className:"ContactsList"},i.createElement(s.default.Header,{title:(0,c.getLang)("mail_contacts_list"),onClose:t}),i.createElement("div",{className:"ContactsList__body"},i.createElement(o.ContactsListContent,{contacts:m.contactsList,onClose:t,selectPeer:a})))}}},276776:(e,t,a)=>{"use strict";a.d(t,{ContactsListContent:()=>v});var n=a(570655),i=a(667294),r=a(736434),s=a(884143),o=a(172237),l=a(670546),c=a(663527),d=a(587041),u=a(906942),g=a(30081),m=a(41437),_=a(750598),p=a(659397),h=a(432975),v=function(e){var t=e.onClose,a=e.contacts,v=e.selectPeer,f=(0,n.__read)((0,i.useState)(""),2),b=f[0],y=f[1],C=(0,n.__read)((0,i.useState)(a),2),w=C[0],S=C[1],E=(0,i.useMemo)((function(){return new d.vkIndexer(a,(function(e){return[e.name,e.user&&e.user.full_name].filter(Boolean).join(" ")}))}),[a]);(0,i.useEffect)((function(){if(0!==b.length){var e=E.search(b);S(e)}else S(a)}),[b]);return i.createElement("div",{className:"ContactsListContent"},i.createElement(r.BlockSearchInput,{onChange:function(e){return t=e.target.value,void y(t);var t},placeholder:(0,m.getLang)("mail_top_search"),autoFocus:!0,key:"search",value:b}),0===w.length?i.createElement(s.default,{className:"ContactsListContent__stub",key:"no-results"},(0,m.getLang)("mail_im_search_empty_contacts")):i.createElement(o.Scroll,{className:"ContactsListContent__scroll"},i.createElement(l.default,{className:"ContactsListContent__list"},w.map((function(e){var a=e.user&&e.user.user_id?e.user.user_id:(0,h.getContactPeerId)(e.id),n=(0,c.prepareContactName)(e.name),r=e.can_write,s=(0,p.classNames)("ContactsListContent__item",{"ContactsListContent__item--disabled":!r});return i.createElement(_.default,{key:e.id,onClick:r?function(){return function(e){v(e),t()}(a)}:void 0,className:s,selectable:r},i.createElement("div",{className:"ContactsListContent__contactAvatar"},e.photo?i.createElement("img",{className:"ContactsListContent__contactAvatarImage",src:e.photo,alt:e.name}):i.createElement(u.ConversationNoPhoto,{text:(0,c.getUserInitials)(e.name),size:"34",id:a,specificType:7,key:e.id})),i.createElement("div",{className:"ContactsListContent__contactName"},i.createElement(g.default,null,n)))})))))}},72739:(e,t,a)=>{"use strict";a.d(t,{CAROUSEL_VIEWPORT_CLASS:()=>o,CAROUSEL_LAYER_CLASS:()=>l,mount:()=>f});var n=a(533246),i=a(414914),r=a(503369),s="_im_carousel",o="_im_carousel_viewport",l="_im_carousel_layer",c="_im_carousel_control",d="Carousel__control--hidden";function u(e){return(0,i.domClosest)(s,e.target)}function g(e,t){var a=t.querySelector("._im_carousel_control_left"),n=t.querySelector("._im_carousel_control_right"),i=t.querySelector("."+o),r=t.querySelector("."+l);if(n&&a&&i instanceof HTMLElement&&r instanceof HTMLElement){var s=i.offsetWidth,c=r.offsetWidth,u=s<c;a.classList.toggle(d,!u||e<=0),n.classList.toggle(d,!u||e+s>=c)}}function m(e){var t=u(e),a=(0,i.domClosest)(c,e.target),n=Number(a.dataset.direction);if(t){var r=t.querySelector("."+o),s=t.querySelector("."+l);if(r&&s&&n){var d=Number(t.dataset.scrollCount)||1,m=Math.floor(s.offsetWidth/s.childElementCount),_=(Math.floor(r.scrollLeft/m)+n*d)*m;g(_,t),r.scrollTo({left:_,behavior:"smooth"})}}}var _=(0,r.debounce)((function(e){var t=u(e),a=t&&t.querySelector("."+o);a&&g(a.scrollLeft,t)}),20);function p(e){var t=u(e);(t&&t.querySelector("."+o)).addEventListener("scroll",_)}function h(e){var t=u(e);(t&&t.querySelector("."+o)).removeEventListener("scroll",_)}function v(e){return{unmount:function(){(0,n.destroyModule)(e)}}}function f(e,t){return(0,(0,n.createMutations)(v).bindMutations)((0,n.createModule)({handlers:function(e,a){a(t,"click",c,m),a(t,"mouseover",s,p),a(t,"mouseout",s,h)}}),e)}},420364:(e,t,a)=>{"use strict";a.d(t,{mount:()=>g});var n=a(667294),i=a(973935),r=a(533246),s=a(287707),o=a(389430),l=a(81020),c=a(161945);function d(){var e="_im_create_chat_container",t=document.getElementById(e);if(t)return t;var a=document.createElement("section");return a.id=e,document.body.appendChild(a),a}function u(e,t,a){return{show:a,unmount:function(){var e=d();e&&i.unmountComponentAtNode(e),(0,r.destroyModule)(t)},closeCreateConvoPopup:function(){var e=d();i.unmountComponentAtNode(e),(0,o.toggleConversation)(!1)}}}function g(e){var t=(0,r.createModule)({handlers:function(){}}),a=(0,(0,r.createMutations)(u).bindMutations)(t,e),o=function(t){var n;null===(n=e.get().longpoll)||void 0===n||n.push([(0,l.changePeer)(t,!1,!1,!1,"create_conversation")]),a.closeCreateConvoPopup()},g=function(t){var n;null===(n=e.get().longpoll)||void 0===n||n.push([(0,l.changePeer)(t,!1,!1,!1,"create_conversation")]),a.closeCreateConvoPopup()},m=a.closeCreateConvoPopup;return u(0,t,(function(){return function(e,t,a,r){var o=d();i.render(n.createElement(s.ChatCreation,{store:e,uploadAvatar:c.uploadConvoPhoto,onClose:t,onCreateChat:a,onGoToConvo:r}),o)}(e,m,o,g)}))}},654424:(e,t,a)=>{"use strict";a.d(t,{mount:()=>g});var n=a(533246),i=a(389430),r=a(663527),s=a(929566),o=a(324466),l=a(236205),c=a(116886),d=a(442699),u="_im_to_unread";function g(e,t,a){var g=function(e,n){(0,r.showUnreadOnly)(t,a,i.changeDialogsTab).then((function(e){var i=t.get().active_tab;if(e){var r=i===o.ConvoListFolder.UNREAD;n.innerHTML=(0,d.getTemplate)("im_filter",{filter:r?(0,c.getLang)("mail_to_all_dialogs"):(0,c.getLang)("mail_to_unread")}),i===o.ConvoListFolder.ALL&&a().updateRecommendationList(t)}}))},m=(0,n.createModule)({handlers:function(t,a){a(e,"click",u,g)}});return function(e,t){return{updateFilter:function(t){var a,n=t.get().active_tab,i=n===o.ConvoListFolder.UNREAD,r=[];((0,s.isSearching)(t)||n===o.ConvoListFolder.BUSINESS_NOTIFY||n===o.ConvoListFolder.MR)&&r.push("im-page--dialogs-filter_hidden"),(0,l.getUnreadCountWithMuted)(t)>0?a=i?(0,c.getLang)("mail_to_all_dialogs"):(0,c.getLang)("mail_to_unread"):(a=(0,c.getLang)("mail_all_dialogs"),r.push("im-page--dialogs-filter_disabled"));var u=e.querySelector("._im_to_unread");u&&(u.innerHTML=(0,d.getTemplate)("im_filter",{filter:a,cls:r.join(" ")}))},toggleButton:function(t,a){var n=e.querySelector(".im-page--dialogs-filter");n&&n.classList.toggle("im-page--dialogs-filter_hidden",a)},toggleLoader:function(t,a){var n=e.querySelector("._im_dialogs_cog_settings");n&&n.classList.toggle("im-page--dialogs-settings_loading",a)},unmount:function(){(0,n.destroyModule)(t)}}}(e,m)}},969680:(e,t,a)=>{"use strict";a.d(t,{mount:()=>w});var n=a(667294),i=a(973935),r=a(800234),s=a(533246),o=a(389430),l=a(929566),c=a(351117),d=a(393202),u=a(757187),g=a(897557),m=a(791563),_=a(236205),p=a(566700).default,h=a(587462).default,v=a(587462),f=v.MAIN,b=v.EDIT;function y(e,t){return(0,u.default)().reduce((function(t,a){return t.replace(new RegExp("({"+a.id+"})","gi"),a.process(e))}),t).replace(/&lt;br&gt;/gi,"<br>")}function C(e,t,a,s,u){var p;return{closeSettingsPopup:function(){p&&p.hide()},showSettingsPopup:function(e){var a=this,s="TemplatesSettings",o={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:function(){var o=document.getElementById(s);o&&i.render(n.createElement(r.default,{value:t},n.createElement(h,{popup:p,section:e,getTemplates:function(){return(0,l.getTemplates)(t)},saveTemplate:a.saveTemplate.bind(a),deleteTemplate:a.deleteTemplate.bind(a),closePopup:a.closeSettingsPopup.bind(a)})),o),requestAnimationFrame((function(){return p.updateBoxCoords()}))}};(p=new m.MessageBox(o).content('<div id="'+s+'"></div>')).show()},applyTemplate:function(e){var a=(0,l.getTemplates)(t).find((function(t){return t.id===e}));(0,d.statlogsCommunityTemplatesClickEvent)(),s(y(t,(0,g.prepareToWriting)(a.text)))},getPreparedTemplates:function(){return(0,l.getTemplates)(t).map((function(e){return Object.assign({},e,{name:e.name,text:y(t,e.text)})}))},saveTemplate:function(e){var a=(0,g.decodeHTMLEntities)(e.name),n=(0,g.decodeHTMLEntities)(e.text);return t.set(e.id?o.updateTemplate.bind(null,e.id,a,n):o.createTemplate.bind(null,a,n))},deleteTemplate:function(e){return t.set(o.deleteTemplate.bind(null,e))},isNeedRenderTemplates:function(){var e=(0,_.getPeer)(t);if(!e)return!1;if(!(0,l.isCommunityInterface)(t))return!1;var a=(0,c.getCurrentTab)(t);return(!a||!(0,l.isChannelPeer)(a))&&!(0,l.isCommunityChat)(t,e)},toggleImText:function(e){void 0===e&&(e=this.isNeedRenderTemplates()),u(e)},update:function(){this.toggleImText()},unmount:function(){this.toggleImText(!1)}}}function w(e,t,a,o){var l=(0,(0,s.createMutations)(C).bindMutations)((0,s.createModule)({handlers:function(){}}),e,t,a,o);if("function"!=typeof l){l.toggleImText();var c=n.createElement(r.default,{value:e},n.createElement(p,{getTemplates:l.getPreparedTemplates,applyTemplate:l.applyTemplate.bind(l),isNeededRendering:l.isNeedRenderTemplates,showSettingsPopup:l.showSettingsPopup.bind(l,f),showCreatingTemplatePopup:l.showSettingsPopup.bind(l,b)}));i.render(c,t)}return l}},813458:(e,t,a)=>{"use strict";var n=a(570655),i=a(449165),r=a(478207),s=a(91257),o=a(81020),l=a(389430),c=a(135685),d=a(663527),u=a(713075),g=a(442699),m=a(116886),_=a(414914),p=a(520797),h=a.n(p),v=a(486353);window.IM={init:function(e){var t,a;if(window.imwl=e.imwl,(0,u.startLoggingAllUnhandled)(),(0,g.addTemplates)(h()),window.cur.lang.dont_attach=(0,m.getLang)("mail_dont_add_media"),e.failed)return(0,r.mount)((0,_.geByClass1)("im-sick",(0,_.ge)("page_body")),null);localStorage.removeItem("im_sick_timer"),window.cur.ctrl_submit=Boolean(e.settings.ctrl_submit),window.cur.module="im",window.cur.mutedPeers=e.mutedPeers,window.cur.gid=e.gid,window.cur.peer=e.peer,window.cur.options={blacklist_hash:e.thash};var p=-10800-60*(new Date).getTimezoneOffset(),f=e.timeshift,b=(0,n.__assign)((0,n.__assign)({},e),{owners:void 0,tabbedPeers:(e.tabbedPeersArray||[]).map((function(e){return{peer:e,type:"perm"}})),blockedFlagUpdates:{},msgid:(0,g.intval)(window.nav.objLoc.msgid),timeshift:f-p,oCache:{},ref_id:window.nav.objLoc.ref,ref_source:window.nav.objLoc.ref_source,topConvTree:new Promise((function(){})),hintsTree:new Promise((function(){})),imTopConvList:new Promise((function(){})),callbackEventButtons:new Map}),y=(0,s.default)(b);null===(t=e.owners)||void 0===t||t.forEach((function(e){return(0,c.oCacheAdd)(y,e)})),(0,d.normalizeTabsGotFromServer)(y,y.get().tabs),window.cur.imClassicInterface=(0,d.isClassicInterface)(y);var C=(0,i.mount)((0,_.geByClass1)("js-im-page",(0,_.ge)("page_body")),y);(0,l.updateMentions)(y.get()),e.group_calls_feature_tt_hash&&(0,d.showGroupCallsOnboardingBox)(y.get(),e.group_calls_feature_tt_hash),e.group_calls_new_year_feature_tt_hash&&(0,d.showGroupCallsNewYearTooltip)(y.get(),e.group_calls_new_year_feature_tt_hash),window.IMBRIDGE={chatPhotoSaved:function(e){window.curBox()&&window.curBox().hide();var t=(e||{})[1];return t?(window.cur.pvShown&&window.layers.fullhide(!0,!0),"im"!=window.cur.module||y.get().peer!=t?window.nav.go("/im?sel=c"+(t-2e9)):void 0):window.nav.reload()},syncHistory:function(){y.set((function(e){return(0,l.syncHistory)(e)})).then((function(){}),(function(){}))},activateTab:function(e,t){void 0===t&&(t="notifications"),y.get().gid||y.get().longpoll.push([(0,o.changePeer)((0,g.intval)(e),!1,!1,!0,t)])},selectedPeer:function(){return y.get().peer}},(0,v.partConfigEnabled)("debug_messenger")&&(window.IMBRIDGE.store=y);var w=!1;window.cur.nav.push((function(){var e;return!!w||((null===(e=y.get().audio_msg)||void 0===e?void 0:e.isRecording)&&C.cancelRecording(),window.AudioMessagePlayer.detachPlayer(),C.route.apply(null,arguments))})),null===(a=window.cur.destroy)||void 0===a||a.push((function(){if(w)return!0;C.unmount(),window.IMBRIDGE=void 0,y.unmount(),window.store=void 0,w=!0,e=!1,y=!1,C=!1,(0,u.stopLoggingAllUnhandled)()}))}};try{window.stManager.done("imn.js")}catch(e){}},449046:(e,t,a)=>{"use strict";a.d(t,{setMessageFlag:()=>r});var n=a(863675),i=a(351117);function r(e,t,a,r,s){var o=(0,i.getTab)(e,t),l=(0,n.getMessage)(e,t,a);return o&&o.msgs&&l?(l.flags=s?l.flags|r:l.flags&~r,o.msgs[a]=l,Promise.resolve(e)):Promise.resolve(e)}},910848:(e,t,a)=>{"use strict";a.d(t,{getFolderUnreadCount:()=>i});var n=a(236205);function i(e,t){var a=(0,n.getConvoListFolderCounterDisplayed)(e,t);return a?a<100?a.toString():"99+":""}},212015:(e,t,a)=>{"use strict";a.d(t,{Settings:()=>S});var n=a(570655),i=a(559653),r=a(992665),s=a(225350),o=a(798922),l=a(184723),c=a(407085),d=a(143468),u=a(472206),g=a(486353),m=a(167109),_=a(180508),p=a(206566),h=a(667294),v=a(973935),f=a(111189),b=a(138671),y=a(838480),C=a(41437),w=function(e){var t=e.onClose,a=e.store,n=e.browserEnv;return h.createElement(b.default,{onClose:t},h.createElement(y.ModalHeader,{title:(0,C.getLang)("mail_im_settings_header"),onClose:t}),h.createElement(f.ModalBody,{hasScroll:!1},h.createElement("div",{style:{width:"560px",margin:"0 -25px",padding:"4px 20px"}},h.createElement(i.SettingsApp,{store:a,env:n}))))},S=function(){function e(e,t){this.isMounted=!1,this.imStore=e,this.imPageMutations=t}return e.prototype.renderSettingsPopup=function(t,a){var n=this,i=e.getContainer();i&&v.render(h.createElement(w,{onClose:function(){return n.hide()},store:t,browserEnv:a}),i)},e.getContainer=function(){return document.querySelector("#MessengerSettings")},e.prototype.getContext=function(){var t;if(null===(t=window.reforgedME)||void 0===t?void 0:t.settingsContext)return window.reforgedME.settingsContext;if(this.ownContext)return this.ownContext;var a=window.vk.id,r=new l.Api(a),s=new c.Logger,p=new d.ProxyStorage("reforged-db-"+a),h=new _.SharedEngine(s,e.isMasterTab()),v=new i.Lang(s,"ru",{keys:(0,n.__assign)((0,n.__assign)({},window.lang),{global_months_of:Array.from(new Array(12),(function(e,t){return window.lang["Month"+(t+1)+"_of"].toLowerCase()}))}),config:window.langConfig}),f={api:r,lang:v,logger:s,navigate:function(){},storage:p,player:new o.Player(s),browserNotifications:new u.BrowserNotifications,externalEvents:new i.ExternalEvents,idle:new i.Idle(s),vkcom_textInput:{init:function(){return 1},destroy:function(){},show:function(){},hide:function(){},val:function(){return""},focus:function(){},swapCallbacks:function(){}},vkcom_mediaSelector:{create:function(){return function(){}},isUploading:function(){return!1},removeMedia:function(){}}},b={api:r,engine:h,queue:new m.SharedQueue,lang:v,logger:s,storage:p},y={me_fc_pinned_message:(0,g.partConfigEnabled)("me_fc_pinned_message")},C=(0,i.createStore)(b,y);return C.start(),this.ownContext={store:C,browserEnv:f},this.ownContext},e.isMasterTab=function(){return!window.curNotifier||window.curNotifier.is_server||p.browser.safari},e.prototype.hide=function(){if(this.isMounted){var t=e.getContainer();t&&v.unmountComponentAtNode(t),this.unsubscribe(),this.isMounted=!1}},e.prototype.show=function(){var e=this,t=this.getContext(),a=t.store,n=t.browserEnv,i=a.getState().userSettings;this.unsubscribe=a.subscribe((function(t){var a=t.userSettings;i.ctrSubmit!==a.ctrSubmit&&(window.cur.ctrl_submit=a.ctrSubmit,e.imStore.set((function(e){return(0,r.setLocalSettingsValue)("ctrl_submit",Number(a.ctrSubmit),e)})).finally((function(){}))),i.showRecommendations!==a.showRecommendations&&e.imStore.set((function(e){return(0,r.setLocalSettingsValue)("messages_recommendation_list_hidden",Number(!a.showRecommendations),e)})).finally((function(){a.showRecommendations?e.imPageMutations().setRecommendationListVisibility(!0)||(e.hide(),window.nav.reload()):e.imPageMutations().setRecommendationListVisibility(!1)})),i.countOnlyNotMuted!==a.countOnlyNotMuted&&e.imStore.set((function(e){return(0,r.setLocalSettingsValue)("show_only_not_muted_messages",Number(a.countOnlyNotMuted),e)})).then((function(e){(0,s.updateUnreadCounter)(e)})).catch((function(){})),i=t.userSettings})),this.renderSettingsPopup(a,n),this.isMounted=!0},e}()},906542:(e,t,a)=>{"use strict";a.d(t,{renderHistoryStub:()=>f,prepareEmptyDialogStickersTemplate:()=>b});var n=a(570655),i=a(91257),r=a(943457),s=a(236205),o=a(371372),l=a(442699),c=a(486353),d=a(432975),u=a(116886),g=a(453911),m=a(413336),_=a(9236),p=a(214390),h=a(351117),v=a(896282);function f(e){var t=(0,s.getPeer)(e),a=(0,o.isContactPeer)(t),i=t&&(0,h.getTab)(e,t),r=(0,d.getEmptyScreenUserInfo)(e,t);if(i&&(0,h.isCasperChatTab)(i))return(0,l.getTemplate)("sImEmptyCasper");var f=a||(0,h.isUserEmptyScreenRich)(e,t)&&r&&0!==(null==r?void 0:r.canWrite);if(!i||!(0,c.partConfigEnabled)("messages_new_empty_dialog_screen")||!f)return(0,u.getLang)("mail_im_here_history");var y,C,w=a?(0,v.prepareContactName)(i.tab):(0,l.stripHTML)(i.tab),S=a?(0,v.prepareContactName)(i.name):i.name,E=i.contact_name,T=a?(0,u.getLang)("mail_empty_history_with_contact").replace("{user_name}",S):(0,u.langSex)(i.sex,(0,u.getLang)("mail_empty_history_with_user","raw")).replace("{user_name}",S),I=E?(0,u.langSex)(i.sex,(0,u.getLang)("mail_saved_in_contacts_as","raw")).replace("{contact_name}",E):"",L=i.photo?'<img src="'+i.photo+'" alt="'+S+'">':(0,l.getTemplate)("sImContactAvatar",{name:(0,v.getUserInitials)(S),size:80,classes:""}),k=a||i.is_friend||i.is_subscribed?"":(0,l.getTemplate)("sImEmptyDialogStubSubscribeButton",{button_text:(0,u.getLang)("mail_add_to_friends")}),M=(0,n.__read)(r?function(e){if(e.occupation){var t=("work"===e.occupationType?(0,g.getIcon20WorkOutline)():(0,m.getIcon20EducationOutline)()).icon;return[e.occupation,t]}if(e.bdate){t=(0,_.getIcon20CakeOutline)().icon;var a=(0,n.__read)(e.bdate.split("."),2),i=a[0],r=a[1],s=new Date;return s.setDate(+i),s.setMonth(+r-1),[(0,u.langDate)(s.getTime(),(0,u.getLang)("mail_birthday_day_month","raw"),0,(0,u.getLang)("months_of","raw"),!0),t]}if(e.city){t=(0,p.getIcon20HomeOutline)().icon;return[e.city,t]}return["",""]}(r):["",""],2),A=M[0],P=M[1],B=(null==r?void 0:r.mutualFriends.length)?(C=(y=r).mutualFriends.map((function(e){return(0,l.getTemplate)("sImEmptyDialogStubMutualFriend",{name:e.name,src:e.photo})})).join(""),(0,l.getTemplate)("sImEmptyDialogStubMutualFriends",{friends:C,text:(0,u.langNumeric)(y.commonCount,(0,u.getLang)("mail_mutual_friends_count","raw"))})):"",D=a?"":(0,l.getTemplate)("sImEmptyDialogStubUserInfo",{profile_href:i.href,subscribe_button:k,additional_info:A,additional_icon:P,mutual_friends:B});return""+(0,l.getTemplate)("sImEmptyDialogStub",{avatar:L,name:w,stub_text:T,secondary_block:D,saved_as:I,classes:(0,s.isClassicInterface)(e)?"EmptyDialogStub--classic":""})+b(e)}function b(e){var t=(0,i.unpackStore)(e),a=t.newDialogStickersSet;if(0===a.length)return"";var o=(0,s.getEmojiOptId)(t),c=a.reduce((function(e,t){var a=(0,n.__read)(t,3),i=a[0],s=a[1],c=a[2],d={sticker_id:i,sticker_url:s,animation_url:c,set_id:r.Emoji.TAB_NEW_CONVO_STICKERS,opt_id:o},u=c?"sImEmptyDialogAnimatedSticker":"sImEmptyDialogSticker";return""+e+(0,l.getTemplate)(u,d)}),""),d=(0,l.getTemplate)("sImCarousel",{content:c,controls_class:"",scroll_count:"3"});return(0,l.getTemplate)("sImEmptyDialogStickers",{content:d})}},966010:(e,t,a)=>{"use strict";a.d(t,{updateFolderCounters:()=>o});var n=a(91257),i=a(324466),r=a(910848),s=[i.ConvoListFolder.MR,i.ConvoListFolder.BUSINESS_NOTIFY];function o(e){var t=(0,n.unpackStore)(e);s.forEach((function(e){var a=(0,r.getFolderUnreadCount)(t,e),n=document.querySelector('._im_right_menu_counter[data-tab="'+e+'"]');n&&(n.innerHTML=a)}))}},694405:(e,t,a)=>{"use strict";function n(){window.cur.videoAutoplayScrollHandler&&window.cur.videoAutoplayScrollHandler()}a.d(t,{videoAutoPlayHandler:()=>n})},712817:(e,t,a)=>{"use strict";a.d(t,{createLongpoll:()=>l});var n=a(976829),i=a(117114),r=a(668660),s=a(389430),o=a(109847);function l(e,t){return(0,n.createLongpollConnect)(e,{onEvents:t,onData:u,onRequestError:g,onHistoryLost:m,onKeyExpired:_,onLpBroken:p})}var c={},d=Date.now();function u(e,t){if(t&&t.status&&e.lpstat){var a=t.status.toString();t.status>=500&&t.status<600&&(0,o.statlogsValueEvent)("fc_longpoll",1,a,t.getResponseHeader("x-frontend")||""),c[a]=a in c?c[a]+1:1,Date.now()-d>=3e4&&(Object.keys(c).forEach((function(e){(0,o.statlogsValueEvent)("fc_longpoll",c[e],e,t.getResponseHeader("x-frontend")||"")})),c={},d=Date.now())}}function g(e){(0,i.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function m(e,t){(0,i.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function _(e){return(0,i.lpLogFc)("red","LP failed: key is incorrect; refresh key"),(0,r.post)(s.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function p(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},117114:(e,t,a)=>{"use strict";a.d(t,{lpLogFc:()=>r,longpollTestingOnFcEvents:()=>g});var n=a(570655),i=a(713075);function r(e,t){for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];if(window.vk.lpConfig.debug){var r="background: "+e+"; color: white",s=new Date,o=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,(0,n.__spreadArray)(["%c "+s.getHours()+":"+o(s.getMinutes())+":"+o(s.getSeconds())+":"+s.getMilliseconds()+" "+t+" ",r],(0,n.__read)(a)))}}function s(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function o(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function l(e,t){var a;window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:!!(null===(a=window.curNotifier)||void 0===a?void 0:a.is_server)}),setTimeout(c,1e4)}function c(){window.lpWeird&&window.lpWeird.length&&((0,i.imWeirdLog)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function d(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function u(){var e;d()&&(o().forEach((function(e){!s().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,r("red","im not fc",e.ev),(0,i.isWeirdLogging)()&&l("im not fc",e.ev))})),s().forEach((function(e){var t=o().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,r("red","now fc like im",e.ev),(0,i.isWeirdLogging)()&&l("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=s().filter((function(t){return t.time>e})),window.lpBufferIm=o().filter((function(t){return t.time>e}))}function g(e){var t;d()&&((t=s()).push.apply(t,(0,n.__spreadArray)([],(0,n.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))))),setTimeout(u,0)),r.apply(void 0,(0,n.__spreadArray)(["green","fc"],(0,n.__read)(e)))}window.longpollTestingOnImEvents=function(e){var t;d()&&((t=o()).push.apply(t,(0,n.__spreadArray)([],(0,n.__read)(e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))))),setTimeout(u,1100)),r.apply(void 0,(0,n.__spreadArray)(["blue","im"],(0,n.__read)(e)))}}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={exports:{}};return n[e].call(a.exports,a,a.exports,r),a.exports}r.m=n,e=[],r.O=(t,a,n,i)=>{if(!a){var s=1/0;for(d=0;d<e.length;d++){for(var[a,n,i]=e[d],o=!0,l=0;l<a.length;l++)(!1&i||s>=i)&&Object.keys(r.O).every((e=>r.O[e](a[l])))?a.splice(l--,1):(o=!1,i<s&&(s=i));if(o){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[a,n,i]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var i=Object.create(null);r.r(i);var s={};t=t||[null,a({}),a([]),a(a)];for(var o=2&n&&e;"object"==typeof o&&!~t.indexOf(o);o=a(o))Object.getOwnPropertyNames(o).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,r.d(i,s),i},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.e=()=>Promise.resolve(),r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={655:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var n,i,[s,o,l]=a,c=0;for(n in o)r.o(o,n)&&(r.m[n]=o[n]);if(l)var d=l(r);for(t&&t(a);c<s.length;c++)i=s[c],r.o(e,i)&&e[i]&&e[i][0](),e[s[c]]=0;return r.O(d)},a=self.webpackChunkvk=self.webpackChunkvk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var s=r.O(void 0,[8288,885,8592,4509,1798,9429,3639,3087,8042,6058],(()=>r(813458)));s=r.O(s)})();