(()=>{"use strict";var e,o,t,i={581133:(e,o,t)=>{var i=t(401324);window.Video=i.Video;try{stManager.done(jsc("web/video.js"))}catch(e){}},401324:(e,o,t)=>{t.d(o,{Video:()=>g});t(579665),t(95767),t(530522),t(66108),t(21466),t(991181),t(296253),t(283946),t(59357),t(976142),t(751876),t(820075);var i=t(414914),r=t(705456),a=t(791563),n=t(719016),s=t(109847),d=t(523845),c=t(917999),l=t(217770),u=t(116886),_=t(442699);function v(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,o){if(!e)return;if("string"==typeof e)return h(e,o);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h(e,o)}(e))){var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,a=!0,n=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){n=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(n)throw r}}}}function h(e,o){(null==o||o>e.length)&&(o=e.length);for(var t=0,i=new Array(o);t<o;t++)i[t]=e[t];return i}var g={VIDEO_SEARCH_TYPE:"search_videos",VIDEO_GLOBAL_SEARCH_TYPE:"search_global_videos",ALBUM_SEARCH_TYPE:"search_albums",ALBUM_GLOBAL_SEARCH_PROMO_PLAYLISTS_TYPE:"search_promo_albums",SEARCH_FILTERS:["hd","notsafe","live","date","order","len"],AVAILABLE_TABS:["all","uploaded","albums"],VIDEOS_PER_PAGE:60,VIDEOS_PER_ROW:3,PLAYLIST_FIRST_CHUNK_SIZE:9,PLAYLIST_OBJECT_ID_INDEX:6,SEARCH_KEEP_FILTERS_DELAY:3e3,SEARCH_STATS_POSITION_FIELDS:["oid","vid","clicked","viewStarted","viewedParts","viewedSeconds"],USER_SYSTEMS_ALBUM_TYPES:["type_my_uploaded","type_my_added","type_my_lives","type_my_recorded_calls"],getLoc:function(){return cur.curLoc?cur.curLoc:cur.is_showcase&&!nav.objLoc.section&&cur.showcaseSection&&("playlist"===cur.section||inArray(cur.showcaseSection,g.USER_SYSTEMS_ALBUM_TYPES))?(nav.objLoc.section=cur.showcaseSection,nav.objLoc):(isEmpty(nav.objLoc)||!nav.objLoc[0]||0!=nav.objLoc[0].indexOf("video"))&&cur.section&&inArray(cur.section,["catalog","all","uploaded","albums"])?{0:"catalog"===cur.section?"video":"videos"+cur.oid}:nav.objLoc},init:function(){cur.searchInputEl=geByClass1("video_search_input"),cur.videoRecentlyRemoved={},cur.videoShowWindow={},cur.found={},cur.silentLoaded={},cur.currentSortings={},cur._preloadedPages={},cur.videoSearchFilters={},cur.videoSearchStats=null,cur.videoSearchPos=null,cur.module="video",cur.albumsPreload=cur.albumsPreload||{},cur.albumsShowingAll={},cur.curLoc=!!cur.query&&nav.fromStr(cur.query),cur._back={hide:[function(){removeEvent(window,"scroll",cur._ev_onScroll)}],show:[function(){g._initScroll()}]},isObject(cur.curLoc)&&(cur.curLoc.section=cur.section),cur.getOwnerId=function(){return cur.oid},g.initNavigation(),g.initSearch();var e=g._getCurrentSectionType();g.isInAlbum()||g.loadSilent(),g.loadSilent(g.getLoc().section),"catalog"===e?(Videocat.init(),vk.id&&g._preloadPage("all")):(g.initOwnerVideoPage(),vk.id==cur.getOwnerId()&&-1!=g.AVAILABLE_TABS.indexOf(e)&&g._preloadPage("catalog")),cur.curLoc=!1,cur.section=!1,cur.currentModule=function(){return g.isInSearch()?"video_search":cur.is_showcase&&cur.ref?cur.ref:g.isInCatalog()?"videocat":g.isInVideosList()?cur.oid<0?"community_videos":cur.oid==vk.id?"profile_own_videos":"profile_videos":cur.module},g._initScroll(),addEvent(window,"beforeunload",(function(){var e=g.getLoc();return e[0].indexOf("video")>=0&&e.q&&g.logSearchStats(),!0})),g._updateThumbsInView()},_initScroll:function(){cur._ev_onScroll&&removeEvent(window,"scroll",cur._ev_onScroll),addEvent(window,"scroll",cur._ev_onScroll=g.onScroll),cur.destroy.push((function(){removeEvent(window,"scroll",cur._ev_onScroll)}))},_preloadPage:function(e){cur.is_showcase||ajax.post("al_video.php?act=s",{section:e,preload:1},{onDone:function(o,t,i){if(g.isInCatalog()||g.isInVideosList()){var r=cur.getOwnerId(),a=cur.videosCount[r];extend(cur,t),extend(cur.videosCount[r],a),cur._preloadedPages=cur._preloadedPages||{},cur._preloadedPages[e]=ce("div",{innerHTML:o,id:"video_content_"+e}),cur._preloadedPages.other=i,"all"===e&&g.loadSilent(e),cur._switchOnPagePreloaded&&g._switch.apply(g,cur._switchOnPagePreloaded),cur._switchOnPagePreloaded=!1}}})},initOwnerVideoPage:function(){if(!cur._videoInited){if(cur._videoInited=!0,cur.videoCanSort){if(!g.isInAlbum()){var e=cur.is_showcase?"video_playlist_list":"video_albums_list";cur.albumsSorter=new window.GridSorter(e,"video_item__thumb_link",{onReorder:g._onAlbumReorder})}g._createSorters()}var o=ge("video_sort_dd");o&&(cur.videoSortDD=new InlineDropdown(o,{items:cur.videoSortItems,withArrow:!0,selected:"default",onSelect:g._sortVideos})),g._toggleSorter("albums"!==g.getLoc().section)}},_toggleSorter:function(e){var o=geByClass1("video_tab_actions_wrap"),t=[geByClass1("_video_sort_dd_wrap",o),geByClass1("divider",o)];toggle(t[0],e),toggle(t[1],e)},_switch:function(e,o){var t=ge("video_content_"+o);if(!t&&void 0===cur._preloadedPages[o])return cur._switchOnPagePreloaded=[e,o],!1;if(g.doSearch(""),g.inputVal(cur.searchInputEl,""),hide("video_content_"+e),toggle("videocat_other_blocks","catalog"!==e),t||ge("video_layout_contents").appendChild(cur._preloadedPages[o]),show(t),"catalog"===e)g.initOwnerVideoPage(),setDocumentTitle((0,u.getLang)("video_myvideos"));else{var i=ge("videocat_other_blocks");trim(i.innerHTML)||(i.innerHTML=cur._preloadedPages.other),Videocat.init(),setDocumentTitle((0,u.getLang)("video_catalogue_tab_full"))}return toggle("video_add_album_btn","catalog"!==o),uiTabs.switchTab(domFC(ge("videocat_tab_"+o))),uiTabs.hideProgress("video_main_tabs"),g._updateThumbsInView(),!1},updateEmptyPlaceholder:function(e){if(e){var o=!1,t="";"albums"===e?cur.playlistsCount||(o=!0,t="video_no_albums_placeholder_text"):cur.videosCount[cur.getOwnerId()][e]||(o=!0,t="video_no_videos_here_yet"),g._toggleEmptyPlaceholder(o,t)}},initNavigation:function(){cur.nav.push((function(e,o,t,i){var r,a=void 0!==e[0],n=!cur.is_showcase&&a&&t[0]==="videos"+vk.id,d=!cur.is_showcase&&a&&"video"===t[0],c=!cur.is_showcase&&"comments"===t.section,l=t.q&&!o.q&&t[0].indexOf("video")>=0,u=o.q&&!t.q&&o[0].indexOf("video")>=0,_="upload"===o.section&&!t.section,v=e.q;if((u||v)&&g.logSearchStats(),l||v?g._initSearchStats(t):u&&g._clearSearchStats(),revertLastInlineVideo(),c)return delete cur._back,!0;if(a){var h=cur.getOwnerId();if(h==vk.id&&(cur.is_showcase||!inArray(e[0],["video","videos"+h])))return!0;if(h!=vk.id&&!inArray(e[0],["videos"+h]))return!0}if(n?(nav.setLoc(t),r=g._switch("catalog","all")):d&&(nav.setLoc(t),r=g._switch("all","catalog")),r||_)return!0;if(uiTabs.hideProgress("video_main_tabs"),"all"===e.section&&delete t.section,l&&(cur.videoLocBeforeSearch=o),u&&(cur.videoSearchFilters={},cur.lastProcessedSearchParams=null,g.doSearch(),g.inputVal(cur.searchInputEl,""),cur.videoLocBeforeSearch&&i.fromSearch)){var p=clone(cur.videoLocBeforeSearch);return delete cur.videoLocBeforeSearch,nav.go(p),!1}var f=t.section||"all";if(t.q||(0,s.removeSearchPositionTracker)(s.serviceVideo),t.q)g.isInAlbum()||delete t.section,g._prepareSearchFilters(t),i.fromSearch||g.inputVal(cur.searchInputEl,t.q),i.fromSearch||i.globalQuery||(i.globalQuery=t.q),g.doSearch(t.q);else{var S;if(cur.is_showcase)return"left_nav"===(null===(S=i.params)||void 0===S?void 0:S._ref)||(nav.setLoc(t),!(!cur.is_showcase||!t.z||o.z===t.z)||(o.section!==t.section||o[0]!==t[0]));if(-1==g.AVAILABLE_TABS.indexOf(f))return~f.indexOf("album")&&statlogsValueEvent("video_play_album",0,"open_album"),!0;if(g.isInAlbum(o.section))return nav.setLoc(t),!0;each(g.AVAILABLE_TABS,(function(e,o){hide("video_subtab_pane_"+o)})),show("video_subtab_pane_"+f),g.updateEmptyPlaceholder(f);var m=domFC(ge("video_tab_"+f));m&&uiTabs.switchTab(m,{noAnim:i.hist}),"albums"!==f?(g.loadSilent(f),cur.videoSortDD&&cur.videoSortDD.select(cur.currentSortings[f]||"default",!0),g._toggleSorter(!0)):g._toggleSorter(!1),g._createSorters(f)}return!!t.show_original||(nav.setLoc(t),!1)})),cur.destroy.push((function(){cur.nav.pop()}))},initSearch:function(){cur.searchInputEl=ge("video_search_input"),cur.searchInputEl&&((0,i.data)(cur.searchInputEl,"opts").onChange=function(e,o){e=trim(e),o=(0,c.isString)(o)?trim(o):"";var t={};e||(each(g.SEARCH_FILTERS,(function(e,o){t[o]=!1})),cur.videoPrevSearchFilters=clone(cur.videoSearchFilters),setTimeout((function(){delete cur.videoPrevSearchFilters}),g.SEARCH_KEEP_FILTERS_DELAY)),e&&cur.videoPrevSearchFilters&&(t=cur.videoPrevSearchFilters,delete cur.videoPrevSearchFilters),nav.change(extend({q:e||!1},t),!1,{fromSearch:!0,globalQuery:o})},(0,i.data)(cur.searchInputEl,"opts").onBlur=function(){trim(val(cur.searchInputEl))&&(cur.vSearchInputBlurred=!0)},cur.searchInputEl.focus())},_sortVideos:function(e){window.tooltips&&tooltips.hideAll();var o=g._getCurrentSectionType(),t=cur.getOwnerId();"album"===o&&(o=g.getLoc().section);var i=cur.silentLoaded[t][o],r=0;i=i.filter((function(e){var o=e[VideoConstants.VIDEO_ITEM_INDEX_OWNER_ID]+"_"+e[VideoConstants.VIDEO_ITEM_INDEX_ID];return!cur.videoRecentlyRemoved[o]||(r++,!1)}));var a=cur.videosCount[cur.getOwnerId()];if(r&&a)if(g.isInAlbum()){var n="album_"+g._getSectionAlbumId();a[n]&&(a[n]-=r,val(geByClass1("_video_subtitle_counter",ge("video_layout_contents")),langNumeric(a[n],cur.lang.video_playlist_size)))}else a.all-=r,g.updateTabCounter(a.all);if(cur.silentLoaded[t][o]=i,!i)return show("video_sort_progress"),hide("video_sort_dd"),void g._addPendingAction(o,(function(){g._sortVideos(e)}));hide("video_sort_progress"),show("video_sort_dd"),clearTimeout(cur._sortTO),cur._sortTO=setTimeout((function(){i.length&&(i.sort((function(o,t){switch(e){case"default":return o[cur.indexIndex]-t[cur.indexIndex];case"new":return t[VideoConstants.VIDEO_ITEM_INDEX_DATE]-o[VideoConstants.VIDEO_ITEM_INDEX_DATE];case"old":return o[VideoConstants.VIDEO_ITEM_INDEX_DATE]-t[VideoConstants.VIDEO_ITEM_INDEX_DATE];case"popularity":return t[VideoConstants.VIDEO_ITEM_INDEX_VIEWS]-o[VideoConstants.VIDEO_ITEM_INDEX_VIEWS]}})),ge("video_"+o+"_list").innerHTML="",cur.videoShowWindow&&cur.videoShowWindow[t]&&(cur.videoShowWindow[t][o]=!1),g.showMore(o),g._reinitSorters("default"!==e),cur.currentSortings=cur.currentSortings||{},cur.currentSortings[o]=e)}),10)},_reindex:function(e){for(var o=0,t=e.length;o<t;o++)e[o].length>=cur.indexIndex?e[o][cur.indexIndex]=o:e[o].push(o)},_onAlbumReorder:function(e,o,t){var i=e.getAttribute("data-id"),r=t?t.getAttribute("data-id"):null,a=o?o.getAttribute("data-id"):null,n=!1;if(cur.is_showcase&&!(n=e.classList.contains("VideoCard--first")||e.classList.contains("VideoCard--second"))){var s=[...document.querySelectorAll("#video_playlist_list .js-video_playlist_item")];n=s[0].getAttribute("data-id")===i||s[1].getAttribute("data-id")===i}n&&[...document.querySelectorAll("#video_playlist_list .js-video_playlist_item")].forEach(((e,o)=>{e.classList.toggle("VideoCard--first",0===o),e.classList.toggle("VideoCard--second",1===o)})),ajax.post("al_video.php?act=reorder_albums",{oid:cur.getOwnerId(),aid:i,before:a,after:r,hash:cur.videoAlbumsSortHash,need_update:n?1:0},{onDone:function(e){g._updatePlaylistPanel(e)}})},_onReorder:function(e,o,t){var i=cur.getOwnerId(),r=domData(e,"id"),a=t?domData(t,"id"):null,n=o?domData(o,"id"):null,s=g._getCurrentSectionType();"album"===s&&(s=g.getLoc().section.split("_")[1]);var d=g._getCurrentSectionType(),c=cur.silentLoaded[i][d];if(c){var l=-1,u=-1;if(each(c,(function(e,o){var t=o[VideoConstants.VIDEO_ITEM_INDEX_OWNER_ID]+"_"+o[VideoConstants.VIDEO_ITEM_INDEX_ID];if(t==r&&(l=e),t==a&&(u=e),u>=0&&l>=0)return!1})),l>=0){var _=c.splice(l,1)[0];u<0?c.unshift(_):(u>l&&u--,c.splice(u+1,0,_)),g._reindex(c)}}var v=!1;if(cur.is_showcase){if(!(v=e.classList.contains("VideoCard--first"))){var h=document.querySelector(`._video_playlist_${s}_list .VideoCard`);h&&(v=h.getAttribute("data-id")===r)}v&&[...document.querySelectorAll(`._video_playlist_${s}_list .VideoCard`)].forEach(((e,o)=>{e.classList.toggle("VideoCard--first",0===o)}))}ajax.post("al_video.php?act=reorder_videos",{album_id:s,target_id:i,vid:r,before:n,after:a,hash:cur.videoSortHash,ref:window.cur.ref,update_cover:v?1:0},{onDone:function(e,o){if(e){var t=document.querySelector(".VideoInfoPanel--playlistPage .VideoInfoPanel__coverImage");t&&(t.style.backgroundImage=`url(${e})`)}g._updatePlaylistPanel(o)}})},_updatePlaylistPanel:function(e){if(e){var o=document.getElementById("own_playlist_panel");o&&(o.innerHTML="",o.insertAdjacentHTML("beforeend",e))}},_prepareSearchFilters:function(e){return cur.videoSearchFilters={},each(g.SEARCH_FILTERS,(function(o,t){var i=e[t];(0,c.isString)(i)&&(i=(0,c.htsc)(i)),cur.videoSearchFilters[t]=i})),cur.videoSearchFilters},onFilterRemoved:function(e){g._setFilterSelector(e),clearTimeout(cur._frto),cur._frto=setTimeout(g._onFiltersChanged,10)},_setFilterSelector:function(e,o){var t,r=cur["videoFilter_"+e];return!!r&&("Selector"===r.__className?(void 0===o&&(o=r.options.defaultItems[0][0]),r.selectItem(o,!1),(t=clone(r.selectedItems()[0])).push(t[0]==r.options.defaultItems[0][0])):hasClass(r,"checkbox")&&(toggleClass(r,"on",!!o),t=[!!o,(0,i.data)(r,"title"),!o]),t)},_onFiltersChanged:function(){var e=isChecked("video_fltr_hd"),o=isChecked("video_fltr_notsafe"),t=isChecked("video_fltr_live"),i=cur.videoFilter_len.selectedItems()[0][0],r=cur.videoFilter_date.selectedItems()[0][0],a=cur.videoFilter_order.selectedItems()[0][0];nav.change({hd:!!e&&1,len:i>0&&i,date:r>0&&r,order:a>=0&&a,notsafe:!!o&&1,live:!!t&&1},!1,{filtersChanged:!0})},initFilters:function(){if(geByClass1("video_search_input")){cur.videoFilter_len=new Dropdown(ge("video_fltr_len"),cur.lenFilters,{big:1,zeroPlaceholder:!0,onChange:g._onFiltersChanged,width:cur.is_showcase?218:void 0}),cur.videoFilter_date=new Dropdown(ge("video_fltr_date"),cur.dateFilters,{big:1,zeroPlaceholder:!0,onChange:g._onFiltersChanged,width:cur.is_showcase?218:void 0}),cur.videoFilter_order=new Dropdown(ge("video_fltr_order"),cur.orderFilters,{big:1,zeroPlaceholder:!0,onChange:g._onFiltersChanged,width:cur.is_showcase?218:void 0}),cur.videoFilter_hd=ge("video_fltr_hd"),removeEvent(cur.videoFilter_hd,"click"),addEvent(cur.videoFilter_hd,"click",g._onFiltersChanged),(0,i.data)(cur.videoFilter_hd,"title",cur.lang.video_hd_checkbox),cur.videoFilter_notsafe=ge("video_fltr_notsafe"),removeEvent(cur.videoFilter_notsafe,"click"),addEvent(cur.videoFilter_notsafe,"click",g._onFiltersChanged),(0,i.data)(cur.videoFilter_notsafe,"title",cur.lang.video_filter_no_safe),cur.videoFilter_live=ge("video_fltr_live"),removeEvent(cur.videoFilter_live,"click"),addEvent(cur.videoFilter_live,"click",g._onFiltersChanged),(0,i.data)(cur.videoFilter_live,"title",cur.lang.video_filter_live);var e=g.getLoc().q;e&&(g._prepareSearchFilters(g.getLoc()),cur.searchText=e,g.inputVal(cur.searchInputEl,cur.searchText),g.doSearch(e))}},_isGeneralSection:function(e){for(var o=0;o<g.AVAILABLE_TABS.length;o++)if(e==g.AVAILABLE_TABS[o])return!0;return!1},showMoreShowcase:function(e,o){if(isVisible(o)&&!(0,r.isButtonLocked)(o)){(0,r.lockButton)(o);var t={silent_loading:1,next_from:cur.listNextFrom},i=window.location.pathname+window.location.search;ajax.post(i,t,{onDone:function(t,i,a){a&&(cur.listNextFrom=a);var n=ge(`video_${e}_list`);if(!isEmpty(t)){var s,d=v(t);try{for(d.s();!(s=d.n()).done;){var c=s.value;if("type_my_history"===e||"type_subscribes"===e){var l=c[VideoConstants.VIDEO_ITEM_INDEX_VIEWED_DAY];if(l)if(!document.querySelector(`.VideoGrid__separator[data-date='${l}']`)){var u=g.buildDateSeparatorEl(l);n.appendChild(u)}}var _=g.buildVideoEl(c,!0);n.appendChild(_)}}catch(e){d.e(e)}finally{d.f()}}if(!isEmpty(i)){var h,p=v(i);try{for(p.s();!(h=p.n()).done;){var f=h.value,S=g.buildPlaylistEl(f,!0);n.appendChild(S)}}catch(e){p.e(e)}finally{p.f()}}(0,r.unlockButton)(o),a||hide(o)},onFail:()=>{(0,r.unlockButton)(o)}})}},loadSilent:function(e){e=e||"all";var o=cur.getOwnerId(),t=g.isInAlbum(e),i=!!cur.isSnippetVideoSelection;if((t||this._isGeneralSection(e))&&"albums"!=e){cur.silentLoaded=cur.silentLoaded||{},cur.silentLoaded[o]=cur.silentLoaded[o]||{},cur.silentLoadingProgress=cur.silentLoadingProgress||{},cur.silentLoadingProgress[o]=cur.silentLoadingProgress[o]||{};var r=cur.silentLoadingProgress[o][e];!0!==r&&cur.pageVideosList&&cur.pageVideosList[o]&&(!1!==r?void 0===r&&(cur.silentLoadingProgress[o][e]=!0,function(e){function r(t,i){cur.silentLoadingProgress&&cur.silentLoadingProgress[o]&&(cur.silentLoadingProgress[o][e]=!1,t&&(t.length&&(cur.indexIndex=t[0].length),g._reindex(t),cur.silentLoaded[o][e]=t),i&&(cur.albumsPreload[o]=!1,cur.silentLoaded[o].albums=i),g.indexItems((function(){cur.silentLoadingProgress&&(g._callPendingAction(e),i&&g._callPendingAction("albums"),cur.is_showcase?g.onScroll():g.showMore(e))})))}var a=cur.pageVideosList[o][e],n=!!a&&cur.videosCount[o][e]<=a.list.length,s=!!t||cur.albumsPreload&&cur.playlistsCount<=cur.albumsPreload[o].length;if(s&&(cur.silentLoaded[o].albums=cur.albumsPreload[o]),n&&s)r(cur.pageVideosList[o][e].list,cur.albumsPreload[o]);else if(cur.noVideos)r([],[]);else{var d=function(){if(!cur.videosCount||!cur.videosCount[o])return{v:r([],[])};var t=cur.VIDEO_SILENT_VIDEOS_CHUNK_SIZE,a=Math.ceil(cur.videosCount[o][e]/t),n=Math.ceil((cur.playlistsCount||0)/t),d=Math.max(a,n),c=new Array(a),l=[],u=new window.callHub((()=>{r([].concat.apply([],c),l)}),d);if(0==d)return{v:r([],[])};for(var v=0;v<d;v++)!function(a){if(cur.serverPaging){if(cur.pageVideosList[o])r(cur.pageVideosList[o].all||[],[])}else{var n={oid:o,section:e,rowlen:g.VIDEOS_PER_ROW,offset:a*t,snippet_video:i?1:0,need_albums:(0,_.intval)(!s&&"all"==e&&(0,_.intval)(0==a))};ajax.post("/al_video.php?act=load_videos_silent",n,{onDone:function(o,t,i){i&&(cur.listNextFrom=i),o&&o[e]&&o[e].list?c[a]=o[e].list:c[a]=[],0==a&&(l=t),u.done()}})}}(v)}();if("object"==typeof d)d.v}}(e)):g._callPendingAction(e))}},indexItems:function(e){if(cur.getOwnerId){var o=0,t=cur.getOwnerId();cur.videoIndexes=cur.videoIndexes||{},cur.videoIndexes[t]=cur.videoIndexes[t]||{},each(cur.silentLoaded[t],(function(e){cur.videoIndexes[t][e]||o++}));var i=new callHub(e,o);each(cur.silentLoaded[t],(function(e,o){cur.videoIndexes[t][e]||(cur.videoIndexes[t][e]=new vkIndexer(o,(function(o){return"albums"===e?o[0]:o[VideoConstants.VIDEO_ITEM_INDEX_TITLE]}),(function(){i.done()})))}))}},_updateSearchPageTitle:function(e){curBox()||(e?(cur.prevVideoPageTitle||(cur.prevVideoPageTitle=document.title),setDocumentTitle((0,u.getLang)("video_title_search").replace("{q}",e))):cur.prevVideoPageTitle&&setDocumentTitle(cur.prevVideoPageTitle))},inputVal:function(e,o){if(val(e)!=o){val(e,o);var t=gpeByClass("_wrap",e);toggleClass(t,"ui_search_field_empty",!o)}},doSearch:function(e){if(cur.searchInputEl){var o=trim(e),t=o+g._buildFiltersSearchStr();if(cur.lastProcessedSearchParams!==t){cur.videoLocalSearchQuery=o,cur.videoGlobalSearchQuery=o;var i=(0,s.generateQID)();cur.searchQueryId=i,each(g.SEARCH_FILTERS,(function(e,o){var t=g._setFilterSelector(o,cur.videoSearchFilters[o]);t&&uiSearch.toggleFilter(cur.searchInputEl,o,t[1],!t[2])})),cur.noEmptyLocalResults=g.isInCatalog();var r=[g.VIDEO_SEARCH_TYPE,g.ALBUM_SEARCH_TYPE,g.ALBUM_GLOBAL_SEARCH_PROMO_PLAYLISTS_TYPE,g.VIDEO_GLOBAL_SEARCH_TYPE];g.isInSearch()&&cur.noEmptyLocalResults&&r.pop(),each(r,(function(e,o){hide("video_subtab_pane_"+o)})),toggle("videocat_other_blocks",g.isInCatalog()&&!o),o||g._toggleSearchContent(!1),curBox()?ge("box_layer_wrap").scrollTop=0:scrollToTop(cur.is_showcase?500:1e3);var a=g.isInAlbum()?g.getLoc().section:"all";g._clearPendingAction(a),g._updateSearchPageTitle(o),o&&(g._addPendingAction(a,(function(){var e=g._searchLocally(o);(0,s.saveSearchAttemptStats)(s.serviceVideo,0,e,o,i,0,"0","",s.blockNameOwn),cur.lastProcessedSearchParams=t,e<15&&g._searchGlobally(o)})),g.loadSilent(a),g._searchGlobally(o))}}},_searchGlobally:function(e,o){if(e){o=(0,_.intval)(o)||0;var t=cur.searchQueryId,i=o>0;cur.globalSearchResults=cur.globalSearchResults||{};var r=e+g._buildFiltersSearchStr(),a=cur.globalSearchResults[r];if(!i&&a)return(0,s.saveSearchAttemptStats)(s.serviceVideo,0,a.count,e,t,a.eventBits,"1",a.modelName,s.blockNameSearch),cur.globalSearchInProgress=!1,g._showGlobalSearchResults(e),void g._toggleSearchProgress(!1);if(cur.globalSearchInProgress!==e){cur.globalSearchInProgress=e;var n=!!cur.isSnippetVideoSelection,d={q:e,offset:o,from:cur.oid,query_id:t};n&&(d.snippet_video=1),i||g._toggleSearchProgress(!0);var c=Date.now(),l={onDone:function(o,a,n,d,l,u,_,v,h){if(!i){g._toggleSearchProgress(!1),cur.lastEventBits=_,cur.lastModelName=v;var p=Date.now()-c;(0,s.saveSearchAttemptStats)(s.serviceVideo,0,o,e,t,_,p,v,s.blockNameSearch)}cur.globalSearchInProgress=!1,curBox()&&(l=!1),cur.globalSearchResults=cur.globalSearchResults||{},cur.globalSearchResults[r]=cur.globalSearchResults[r]||{count:0,countHash:a,list:[],realOffset:0,promoPlaylists:l,modelName:v,eventBits:_,playlistTotalCount:h};var f=cur.globalSearchResults[r];f.done=f.done||!n.list||0==n.list.length;var S=f.list.length;if(!f.done){for(var m=n.list[0],w=0,E=f.list.length-1;E>=0;E--){var b=f.list.length-E;if(b>20)break;var I=f.list[E];if(m[0]==I[0]&&m[1]==I[1]){w=b;break}}f.count=parseInt(o),Array.prototype.push.apply(f.list,n.list.slice(w));var y=f.list.length%g.VIDEOS_PER_ROW;o>g.VIDEOS_PER_PAGE&&y&&f.list.length<f.count&&(f.list.splice(-y,g.VIDEOS_PER_ROW),u-=y),f.realOffset=u}(d||!f.done&&f.list.length==S)&&(f.done=!0),g._showGlobalSearchResults(e,i)}};cur.is_showcase?(clearTimeout(cur.searhRequestTimeout),cur.searhRequestTimeout=setTimeout((()=>{ajax.post("/al_video.php?act=search_video",extend(d,cur.videoSearchFilters),l)}),300)):ajax.post("/al_video.php?act=search_video",extend(d,cur.videoSearchFilters),l)}}},_toggleSearchProgress:function(e){cur.is_showcase||(cur.searchProgressRef=cur.searchProgressRef||0,cur.searchProgressRef=Math.max(0,cur.searchProgressRef+(e?1:-1)),e=cur.searchProgressRef>0);var o=geByClass1("ui_search_fltr_control",geByClass1("video_search_input")),t=geByClass1("ui_search_fltr_progress",o);toggle(t,e),hasClass(o,"shown")||toggleClass(gpeByClass("_wrap",cur.searchInputEl),"ui_search_loading",e)},_buildFiltersSearchStr:function(){var e=[];return each(cur.videoSearchFilters||{},(function(o,t){t&&e.push(o+":"+t)})),"$"+e.join("#")},_toggleEmptySearchPlaceholder:function(e,o,t){var i=ge("video_empty_placeholder_search"),r=cur.getOwnerId()<0?"video_not_found_group":"video_not_found_user";if(cur.getOwnerId()==vk.id&&(r="video_not_found_yours"),g.isInAlbum()&&(r="video_not_found_in_album"),g.isInCatalog()&&(r="video_not_found_globally"),o){var a=(0,u.getLang)(r).replace("{searchText}",'<b class="VideoEmptyStub__token">'+clean(o.replace(/\$/g,"$$$$"))+"</b>");i.classList.contains("VideoEmptyStub")?i.querySelector(".VideoEmptyStub__text").innerHTML=a:i.innerHTML=a}if(toggle(i,e),t){var n=!0,s=ge("video_layout_search");each(domChildren(s),(function(){if(isVisible(this))return n=!1,!1})),n&&toggle(i,!0)}},_toggleEmptyPlaceholder:function(e,o){var t=ge("video_empty_placeholder_main");e&&t&&(t.classList.contains("VideoEmptyStub")?t.querySelector(".VideoEmptyStub__text").innerHTML=(0,u.getLang)(o):t.innerHTML=(0,u.getLang)(o)),toggle(t,e)},_showSearchResult:function(e){var o=cur.found[e],t=cur.getOwnerId();if(toggle("video_subtab_pane_"+e,!!o.count&&!!o.list),o.count){var i,r="";switch(e){case g.ALBUM_SEARCH_TYPE:i="albums";case g.VIDEO_SEARCH_TYPE:i=i||"videos",r=g.isInAlbum()?cur.lang["video_found_"+i+"_in_album"]:cur.getOwnerId()<0?cur.lang["video_found_"+i+"_community"]:cur.getOwnerId()==vk.id?cur.lang["video_found_"+i+"_yours"]:cur.lang["video_found_"+i+"_of"];break;case g.VIDEO_GLOBAL_SEARCH_TYPE:r=cur.lang.video_found_videos_global;break;case g.ALBUM_GLOBAL_SEARCH_PROMO_PLAYLISTS_TYPE:r=(0,u.getLang)("video_search_promo_playlists")}r=(r=langNumeric(o.count,r,!0)).replace("{user}",cur.lang.video_owner_name_gen);var a=ge("video_subtab_pane_"+e),n=geByClass1("js-video-subtitle",a);if(val(n,r),cur.is_showcase&&o.count){var s=geByClass1("js-video-subtitle-counter",a);val(s,langNumeric(o.count,"%s",!0))}var d=e==g.VIDEO_GLOBAL_SEARCH_TYPE?cur.videoGlobalSearchQuery:cur.videoLocalSearchQuery;d+=g._buildFiltersSearchStr(),cur._videoRenderedSearchResults=cur._videoRenderedSearchResults||{};var c=cur._videoRenderedSearchResults;c[e]!=d&&(c[e]=d,ge("video_"+e+"_list").innerHTML="",cur.videoShowWindow&&cur.videoShowWindow[t]&&delete cur.videoShowWindow[t][e],g.showMore(e))}},_showGlobalSearchResults:function(e,o){var t=e+g._buildFiltersSearchStr(),i=cur.getOwnerId(),r=g.isInAlbum()?g.getLoc().section:"all",a=cur.is_showcase||!!cur.silentLoaded[i][r];if((e==cur.videoGlobalSearchQuery||e==cur.videoLocalSearchQuery)&&a&&cur.globalSearchResults[t]&&cur.globalSearchResults[t].count>=0){var n=cur.globalSearchResults[t];cur.found[g.VIDEO_GLOBAL_SEARCH_TYPE]={list:n.list,count:n.count,done:n.done,realOffset:n.realOffset},cur.found[g.ALBUM_GLOBAL_SEARCH_PROMO_PLAYLISTS_TYPE]={list:n.promoPlaylists,count:n.playlistTotalCount||n.promoPlaylists.length,done:!n.promoPlaylists.length},cur.noEmptyLocalResults&&(g._toggleSearchContent(!0),0==n.count?g._toggleEmptySearchPlaceholder(!0,e):g._toggleEmptySearchPlaceholder(!1)),o||(g._showSearchResult(g.ALBUM_GLOBAL_SEARCH_PROMO_PLAYLISTS_TYPE),g._showSearchResult(g.VIDEO_GLOBAL_SEARCH_TYPE)),g._callPendingAction(g.VIDEO_GLOBAL_SEARCH_TYPE)}},_toggleSearchContent:function(e){toggle("video_layout_contents",!e),toggle("video_layout_search",!!e),cur.is_showcase&&(toggle("video_block_header",!e),toggle("video_search_header",!!e))},_searchLocally:function(e){if(cur.found={},!e||!cur.videoIndexes)return!1;var o=cur.getOwnerId(),t=[],i=[];!g.isInAlbum()&&cur.videoIndexes[o].albums&&(i=cur.videoIndexes[o].albums.search(e),cur.found[g.ALBUM_SEARCH_TYPE]={list:i,count:i.length},g._showSearchResult(g.ALBUM_SEARCH_TYPE));var r=g.isInAlbum()?g.getLoc().section:"all";if(cur.videoIndexes[o][r]){var a=cur.videoIndexes[o][r].search(e);each(a,(function(e,o){(!cur.videoSearchFilters.hd||o[VideoConstants.VIDEO_ITEM_INDEX_FLAGS]&VideoConstants.VIDEO_ITEM_FLAG_HD)&&(!cur.videoSearchFilters.live||o[VideoConstants.VIDEO_ITEM_INDEX_FLAGS]&VideoConstants.VIDEO_ITEM_FLAG_LIVE)&&(vkNow()/1e3-o[VideoConstants.VIDEO_ITEM_INDEX_DATE]>cur.videoSearchFilters.date||t.push(o))})),cur.found[g.VIDEO_SEARCH_TYPE]={list:t,count:t.length},g._showSearchResult(g.VIDEO_SEARCH_TYPE)}return i.length+t.length?(g._toggleSearchContent(!0),g._toggleEmptySearchPlaceholder(!1)):cur.noEmptyLocalResults?g._toggleEmptySearchPlaceholder(!1,void 0,!0):(g._toggleSearchContent(!0),g._toggleEmptySearchPlaceholder(!0,e)),t?t.length:0},onItemEnter:function(e){window.setTitle(e,e,e.innerHTML.replace(/<\/?em>/g,""))},showMoreAlbums:function(e){var o=!1,t=cur.getOwnerId();cur.albumsPreload&&cur.albumsPreload[t]&&!cur.silentLoaded[t].albums&&(cur.silentLoaded[t].albums=cur.albumsPreload[t],o=!0),cur.albumsShowingAll[t]=!0,g.showMore("albums",e),o&&(cur.silentLoaded[t].albums=!1)},prepareVideoItemAttrs:function(e){var o="",t="",i={};i[VideoConstants.VIDEO_ITEM_FLAG_EXTERNAL]="video_ext",i[VideoConstants.VIDEO_ITEM_FLAG_ACTIVE_LIVE]="video_active_live",i[VideoConstants.VIDEO_ITEM_FLAG_CAN_EDIT]="video_can_edit",i[VideoConstants.VIDEO_ITEM_FLAG_CAN_ADD]="video_can_add",i[VideoConstants.VIDEO_ITEM_FLAG_CAN_DELETE]="video_can_delete",i[VideoConstants.VIDEO_ITEM_FLAG_NO_AUTOPLAY]="video_nap",i[VideoConstants.VIDEO_ITEM_FLAG_ADDED]="video_added",i[VideoConstants.VIDEO_ITEM_FLAG_SKIP_THUMB_LOAD]="video_skip_thumb_load",i[VideoConstants.VIDEO_ITEM_FLAG_CAN_DOWNLOAD]="video_can_download",i[VideoConstants.VIDEO_ITEM_FLAG_CAN_DELETE_FROM_HISTORY]="video_can_delete_from_history",i[VideoConstants.VIDEO_ITEM_FLAG_PRIVATE]="VideoCard--private",i[VideoConstants.VIDEO_ITEM_FLAG_PRIVATE_MEMBERS]="VideoCard--privateMembers",i[VideoConstants.VIDEO_ITEM_FLAG_PRIVATE_BY_LINK]="VideoCard--privateByLink",i[VideoConstants.VIDEO_ITEM_FLAG_PRIVATE_NOT_PUBLISHED]="VideoCard--privateNotPublished";var r=e[VideoConstants.VIDEO_ITEM_INDEX_FLAGS];each(i,(function(e,t){r&e&&(o+=t+" ")})),e[VideoConstants.VIDEO_ITEM_INDEX_PLATFORM]||e[VideoConstants.VIDEO_ITEM_INDEX_DURATION]||r&VideoConstants.VIDEO_ITEM_FLAG_ACTIVE_LIVE||(o+=" video_no_duration"),cur.is_showcase&&r&VideoConstants.VIDEO_ITEM_FLAG_ACTIVE_LIVE&&(o+=" video_no_duration"),e[VideoConstants.VIDEO_ITEM_INDEX_DATE]||(o+=" no_date");var a=e[VideoConstants.VIDEO_ITEM_INDEX_MUSIC_VIDEO_META];a&&a.explicit&&(o+=" video_explicit");var n=!(r&VideoConstants.VIDEO_ITEM_FLAG_CAN_EDIT||r&VideoConstants.VIDEO_ITEM_FLAG_CAN_DELETE),s=e[VideoConstants.VIDEO_ITEM_INDEX_BLOCKED],d=!(r&VideoConstants.VIDEO_ITEM_FLAG_CAN_ADD);return n&&(s||d)&&(o+=" video_no_actions"),s&&(o+=" video_blocked"),cur.videoCanAddAlbums&&!s&&(o+=" video_can_edit_albums"),cur.isSnippetVideoSelection&&(o+=" no_video_select_btn"),r&VideoConstants.VIDEO_ITEM_FLAG_NEED_SIGN_IN&&(t+=' rel="nofollow"'),[o,t]},buildVideoEl:function(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=trim(o?cur.videoItemTemplate:cur.videoItemTpl),i=(e=clone(e))[VideoConstants.VIDEO_ITEM_INDEX_MUSIC_VIDEO_META];if(i){var r=i.subtitle?' <span class="mv_subtitle">'+i.subtitle+"</span>":"";e[VideoConstants.VIDEO_ITEM_INDEX_TITLE]=i.title+r,e[VideoConstants.VIDEO_ITEM_INDEX_OWNER]=i.main+i.featured,e[VideoConstants.VIDEO_ITEM_INDEX_VIEWS]=i.release_date,e[VideoConstants.VIDEO_ITEM_INDEX_DATE]=i.genre}else e[VideoConstants.VIDEO_ITEM_INDEX_VIEWS]=langNumeric(e[VideoConstants.VIDEO_ITEM_INDEX_VIEWS],cur.lang.video_N_views_list,!0),e[VideoConstants.VIDEO_ITEM_INDEX_DATE]=g.getFormattedUpdatedTime(e[VideoConstants.VIDEO_ITEM_INDEX_DATE]),e[VideoConstants.VIDEO_ITEM_INDEX_FLAGS]&VideoConstants.VIDEO_ITEM_FLAG_ACTIVE_LIVE&&(e[VideoConstants.VIDEO_ITEM_INDEX_DURATION]='<span class="video_thumb_label_live_icon"></span>');var a=g.prepareVideoItemAttrs(e),n=rs(t,e);return n=n.replace("%classes%",a[0]).replace("%attrs%",a[1]),n=se(n)},buildPlaylistEl:function(e){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=trim(o?cur.playlistItemTemplate:cur.albumItemTpl);return se(rs(t,e))},buildDateSeparatorEl:function(e){var o=(0,u.langDate)(e,"{day} {month}",0,(0,u.getLang)("months_of","raw")),t=ce("div",{className:"VideoGrid__separator",innerHTML:o});return t.setAttribute("data-date",e),t},onMoreLoaded:function(e,o,t,i,r){g._loading=!1;var a,n=cur.getOwnerId(),s=cur.videoShowWindow[n][o],d=ge("video_"+o+"_list"),c=gpeByClass("ge_video_pane",d),l=d.classList.contains("VideoGrid");if(d){e=geByClass1("ui_load_more_btn",c);var u=o.indexOf("albums")>=0,_=u?0:3,v=g._getCurrentSectionType();v="album"==v?g.getLoc().section:"all";var h,p=!1;if(o.indexOf("search")>=0&&cur.videoIndexes&&cur.searchText)p=new RegExp("("+cur.searchText.replace(/\|/g,"").replace(null===(h=cur.videoIndexes[n][v])||void 0===h?void 0:h.delimiter,"|").replace(/^\||\|$/g,"").replace(/([\+\*\)\(])/g,"\\$1")+")","gi");for(var f=0,S=t.length;f<S;f++){var m=extend({},t[f]);p&&!l&&(m[_]=m[_].replace(p,"<em>$1</em>")),a=u?g.buildPlaylistEl(m,l):g.buildVideoEl(m,l),o==g.VIDEO_GLOBAL_SEARCH_TYPE&&a.setAttribute("data-search-pos",f+s.offset),d.appendChild(a)}s.offset=i,s.done=!t.length||r,toggle(e,!s.done),cur.is_showcase&&c.classList.toggle("VideoPane--noMore",s.done),o==g.VIDEO_GLOBAL_SEARCH_TYPE&&(cur.videoSearchStats||g._initSearchStats(g.getLoc()),cur.videoSearchStats.lastActionTime=(new Date).getTime(),g._updateLastSeenElement(d))}},showMore:function(e,o){e=e||g._getCurrentSectionType();var t=curBox()?curBox().bodyNode:void 0,i=geByClass1("_video_"+e+"_list",t);if(i){var a=g.isInAlbum(e),n=cur.getOwnerId();if(!a&&-1==g.AVAILABLE_TABS.indexOf(e)||cur.silentLoaded[n][e]){var s;if(window.cur.unauthScrollMoreBox&&window.cur.unauthScrollMoreBox.needShow)window.scrollNode.scrollHeight-window.pageYOffset-window.innerHeight<200&&(d.UnauthActionBox.show(window.cur.unauthScrollMoreBox.box),window.cur.unauthScrollMoreBox.needShow=!1);(0,r.unlockButton)(o),cur.videoShowWindow=cur.videoShowWindow||{},cur.videoShowWindow[n]=cur.videoShowWindow[n]||{},cur.videoShowWindow[n][e]||(cur.videoShowWindow[n][e]={done:!1,offset:i.children.length});var c=cur.videoShowWindow[n][e];if(!c.done)if(e.indexOf("search")>=0&&cur.found[e]){var l,u,_;if(e==g.VIDEO_GLOBAL_SEARCH_TYPE){if(s=cur.found[e].list.length,l=cur.found[e].realOffset||s,u=cur.found[e].list.slice(c.offset,s),!(_=cur.found[e].done)&&0==u.length)return g._addPendingAction(e,(function(){g.showMore(e,o)})),(0,r.lockButton)(o),void(cur.globalSearchInProgress||g._searchGlobally(cur.videoGlobalSearchQuery,l))}else if(e===g.ALBUM_GLOBAL_SEARCH_PROMO_PLAYLISTS_TYPE){var v=0===c.offset,h=ge("video_"+e+"_list"),p=h.classList.contains("VideoGrid");if(!v)return(0,r.lockButton)(o),void g.showMorePlaylist(cur.videoGlobalSearchQuery,c.offset,((t,i,a)=>{p&&h.classList.remove("VideoGrid--oneRow"),(0,r.unlockButton)(o),g.onMoreLoaded(o,e,i,a,t)}));s=cur.found[e].list.length,u=cur.found[e].list,_=s>=cur.found[e].count,p&&h.classList.add("VideoGrid--oneRow")}else if(cur.is_showcase&&e===g.ALBUM_SEARCH_TYPE){if(0===c.offset){s=g._getNumberOfVideoGridColumns()||g.PLAYLIST_FIRST_CHUNK_SIZE,u=cur.found[e].list.slice(0,s);var f=cur.found[e].list.length-s;if(f>0){_=!1;var S=geByClass1("ui_load_more_btn",gpeByClass("ge_video_pane",i));if(S){var m=cur.lang.video_show_more_playlists.map((e=>e.replace("%s",'<span class="VideoShowMoreButton__counter">%s</span>')));S.innerHTML=langNumeric(f,m)}}else _=!0}else ge("video_"+e+"_list").classList.remove("VideoGrid--oneRow"),u=cur.found[e].list.slice(c.offset,cur.found[e].list.length),_=!0}else s=c.offset+g.VIDEOS_PER_PAGE,u=cur.found[e].list.slice(c.offset,s),_=s>=cur.found[e].list.length;g.onMoreLoaded(o,e,u,s,_)}else if((a||-1!=g.AVAILABLE_TABS.indexOf(e))&&cur.silentLoaded[n][e]){var w=cur.silentLoaded[n][e];if(!s&&!w.length)return cur.is_showcase?void hide(o):void g._toggleEmptyPlaceholder(!0,"video_no_videos_here_yet");s=Math.min(w.length,c.offset+g.VIDEOS_PER_PAGE);var E=w.slice(c.offset,s),b=!1;if("albums"===e&&cur.albumsPreload[n])b=cur.albumsNoMore,cur.albumsPreload[n]=!1;else{b=s>=w.length;var I=Math.ceil(s,g.VIDEOS_PER_PAGE);if(window.cur.unauthScrollMoreBox){var y=window.cur.unauthScrollMoreBox,C=y.ownerId;I>y.screens&&g.getCurOwnerId()===C&&(window.cur.unauthScrollMoreBox.needShow=!0,b=!0)}}"albums"===e&&(cur.albumsShowingAll[n]=!b),g.onMoreLoaded(o,e,E,s,b)}g._updateThumbsInView()}else(0,r.isButtonLocked)(o)||(g._addPendingAction(e,(function(){g.showMore(e,o)})),(0,r.lockButton)(o))}},showMorePlaylist:function(e,o,t){ajax.post("/al_video.php?act=search_video_playlist",{q:e,offset:o},{onDone:function(e,o,i){t(e,o,i)}})},isInAlbum:function(e){return 0===(e=e||g.getLoc().section||"").indexOf("album_")||0===e.indexOf("playlist_")},isInSearch:function(){return!!g.getLoc().q},_getSectionAlbumId:function(){var e=g.getLoc().section||"all";switch(e){case"all":return-2;case"uploaded":return-1;default:return e.split("_")[1]}},isInCatalog:function(e){return e=e||g.getLoc(),cur.is_showcase?!cur.isOwnerVideos&&!inArray(e.section,g.USER_SYSTEMS_ALBUM_TYPES):"video"===e[0]&&!e.section},_getCurrentSectionType:function(){return cur.videoForcedSection?cur.videoForcedSection:g.isInAlbum(g.getLoc().section)?"album":g.isInCatalog()?"catalog":g.getLoc().section||"all"},_getNumberOfVideoGridColumns:function(){var e=document.querySelector(".VideoLayout__contentsWrapper"),o=document.querySelector(".VideoLayout__contents .VideoGrid"),t=o.offsetWidth||e.offsetWidth,i=getComputedStyle(o),r=parseInt(i.getPropertyValue("column-gap"),10);return Math.floor((t+r)/(300+r))},onScroll:function(){var e;cur.getOwnerId&&cur.albumsShowingAll[cur.getOwnerId()]?e="albums":(e=g._getCurrentSectionType(),g.getLoc().q||"search"===e?e=isVisible(gpeByClass("ge_video_pane","ui_search_global_videos_load_more"))?g.VIDEO_GLOBAL_SEARCH_TYPE:g.VIDEO_SEARCH_TYPE:"album"===e?e=g.getLoc().section:cur.showcaseSection&&(e=cur.showcaseSection));var o=curBox()?curBox().bodyNode:void 0,t=geByClass1("_video_"+e+"_list",o);if(t){var i=gpeByClass("ge_video_pane",t),r=geByClass1("ui_load_more_btn",i);if(r){var a=window.clientHeight(),n=scrollGetY(),s=getXY(r);n+a>(cur.serverPaging?s[1]-a:s[1]-a/2)&&(cur.serverPaging&&cur.showcaseSection===e?g.showMoreShowcase(e,r):g.showMore(e,r))}e===g.VIDEO_GLOBAL_SEARCH_TYPE&&g._updateLastSeenElement(t)}g._updateChooseFixedBottom(),g._updateThumbsInView()},getFormattedUpdatedTime:function(e){var o=(0,_.intval)(vkNow()/1e3)-e;function t(e,o,t){return isArray(o)&&e<o.length?o[e]:langNumeric(e,t)}var i="video_added_";return o<5?(0,u.getLang)(i+"now"):o<60?t(o,cur.lang.video_added_sec[0],cur.lang.video_added_sec[1]):o<3600?t((0,_.intval)(o/60),cur.lang.video_added_min[0],cur.lang.video_added_min[1]):o<86400?t((0,_.intval)(o/3600),cur.lang.video_added_hour[0],cur.lang.video_added_hour[1]):o<2592e3?t((0,_.intval)(o/86400),cur.lang.video_added_day[0],cur.lang.video_added_day[1]):o<31536e3?t((0,_.intval)(o/2592e3),cur.lang.video_added_month[0],cur.lang.video_added_month[1]):t((0,_.intval)(o/31536e3),cur.lang.video_added_year[0],cur.lang.video_added_year[1])},_createSorters:function(e){if(cur.videoCanSort){cur.videoSorter&&cur.videoSorter.destroy(),"album"===(e=e||g._getCurrentSectionType())&&(e=g.getLoc().section);var o=cur.is_showcase?"VideoCard--dragOver":"video_on_drag_over";cur.videoSorter=new window.GridSorter(ge("video_"+e+"_list"),"video_item__thumb_link",{onReorder:g._onReorder,onDragOverElClass:"js-video_playlist_item",onDragLeave:function(e,t){removeClass(e,o),removeClass(t,"video_on_drag_over")},onDragEnter:function(e,t){addClass(e,o),addClass(t,"video_on_drag_over")},onDragDrop:function(e,o){var t=attr(o,"data-id").split("_"),i=attr(e,"data-id");return ajax.post("/al_video.php?act=a_add_to_playlist",{oid:t[0],vid:t[1],gid:cur.getOwnerId()<0?-cur.getOwnerId():0,add:1,playlist_id:i,own:1,hash:cur.videoAddToPlaylistOwnHash},{onDone:function(o,t){if(t&&t[i]){var r=g.buildPlaylistEl(t[i],cur.is_showcase);domPN(e).replaceChild(r,e),g._reinitSorters(),cur.albumsSorter.update()}}}),!0}})}},_reinitSorters:function(e){cur.videoCanSort&&(clearTimeout(cur._rsto),cur._rsto=setTimeout((function(){cur.videoSorter?e?cur.videoSorter.disable():cur.videoSorter.enable():g._createSorters()})))},_saveHistoryAction:function(e,o){if(g.isInSearch()&&cur.videoGlobalSearchQuery){var t=cur.videoGlobalSearchQuery+g._buildFiltersSearchStr(),i=cur.globalSearchResults[t];i&&!cur.videoSearchFilters.notsafe&&uiSearch.saveHistorySearch(this.searchInputEl,cur.videoGlobalSearchQuery,e,o,i.count,i.countHash)}},onVideoAdd:function(e,o,t,i,r){var a=gpeByClass("_video_item",o),n=(0,_.intval)(toggleClass(a,"video_added")),s={};return s=n?{playlist_id:-2}:{playlists:0},g._saveHistoryAction(t,i),ajax.post("/al_video.php?act=a_add_to_playlist",extend({oid:t,vid:i,add:(0,_.intval)(n),hash:r},s),{onFail:function(){n&&(window.tooltips&&tooltips.destroyAll(),removeClass(a,"video_added"))},onDone:function(e,o,r){var a=cur.currentSortings&&(!cur.currentSortings.all||"default"===cur.currentSortings.all),s=!!cur._preloadedPages&&geByClass1("_video_list_my_all",cur._preloadedPages.all),d=!1;if(s){var c=geByClass1("ge_video_item_"+t+"_"+i,s);c&&re(c),d=!!c,n&&a&&s.insertBefore(g.buildVideoEl(r,cur.is_showcase),s.firstChild)}if(cur.silentLoaded&&cur.silentLoaded[vk.id]&&cur.silentLoaded[vk.id].all){var l=cur.silentLoaded[vk.id].all;if(n)a&&(l.unshift(r),g._reindex(l));else for(var u=0,_=l.length;u<_;u++)if(l[u][0]==t&&l[u][1]==i){l.splice(u,1);break}if(cur.videosCount[vk.id]){var v=n?1:-1;1===v&&d&&(v=0);var h=cur.videosCount[vk.id].all=Math.max(0,(cur.videosCount[vk.id].all||0)+v);g.updateTabCounter(h)}}}}),window.tooltips&&tooltips.destroyAll(),cancelEvent(e)},updateTabCounter:function(e){var o=ge("video_tab_all");o&&(geByClass1("ui_tab_count",o).innerHTML=e)},onVideoMove:function(e,o,t,i,r){return showBox("/al_video.php?act=video_playlists_box",{target_id:cur.getOwnerId(),oid:t,vid:i,hash:r},{dark:1}),cancelEvent(e)},_showProgressPanel:function(e){var o=se('<div class="video_delete_progress _video_delete_progress VideoCard__deleteProgress"><div class="round_spinner"></div></div>');return e.appendChild(o),o},onVideoDelete:function(e,o,t,r,a){var n=gpeByClass("_video_item",o),s=g._getCurrentSectionType(),d=g._showProgressPanel(n),c="album"===s?g._getSectionAlbumId():-2;return addClass(n,n.classList.contains("VideoCard")?"VideoCard--deleted":"video_deleted_now"),cur.videoRecentlyRemoved||(cur.videoRecentlyRemoved={}),cur.videoRecentlyRemoved[t+"_"+r]=!0,ajax.post("/al_video.php?act=a_delete_video",{oid:t,vid:r,from:cur.oid,pl_id:c,section:cur.section_id,hash:a,is_showcase:cur.is_showcase},{onDone:function(e){re(d),n.appendChild(se(e));var o=(0,i.data)(n,"restoreTO");clearTimeout(o),o=setTimeout((function(){re(geByClass1("_video_restore_act",n))}),6e4),(0,i.data)(n,"restoreTO",o)}}),cancelEvent(e)},restoreVideo:function(e,o,t,i){var r=gpeByClass("_video_item",e),a=gpeByClass("_video_restore",e),n=g._showProgressPanel(r),s="album"===g._getCurrentSectionType()?g._getSectionAlbumId():-2;if(re(a),"my_bookmarks"===cur.section_id){var d=o.split("_");return removeClass(r,r.classList.contains("VideoCard")?"VideoCard--deleted":"video_deleted_now"),re(n),void window.bookmark(d[0],d[1],"video",i,!1)}if("my_liked"===cur.section_id)return removeClass(r,r.classList.contains("VideoCard")?"VideoCard--deleted":"video_deleted_now"),re(n),void Likes.toggle(e,!1,"video"+o,i);ajax.post("/al_video.php?act=a_restore_video",{from:t,video_id:o,pl_id:s,hash:i,section:cur.section_id},{onDone:function(){removeClass(r,r.classList.contains("VideoCard")?"VideoCard--deleted":"video_deleted_now"),re(n)}}),delete cur.videoRecentlyRemoved[o]},onVideoUMA:function(e,o,t,i){return showBox("al_video.php?act=get_uma_restrictions",{oid:t,vid:i},{params:{width:750}}),cancelEvent(e)},onVideoEdit:function(e,o,t,i){return cur.videoEditItem=gpeByClass("_video_item",o),window.Videoview&&Videoview.hidePlayer(),showBox("al_video.php?act=edit_box",{vid:i,oid:t},{containerClass:"video_edit"}).setOptions({onHide:function(){window.Videoview&&Videoview.showPlayer()}}),cancelEvent(e)},switchChooserToOwner:function(e){var o=curBox(),t=!!cur.isSnippetVideoSelection,i={to_id:e,switched:1};t&&(i.snippet_video=1),showBox("al_video.php?act=a_choose_video_box",i,{showProgress:o.showCloseProgress.bind(o),hideProgress:o.hideCloseProgress.bind(o),cache:1,dark:1,onDone:function(){curBox().hide(),showBox("al_video.php?act=a_choose_video_box",i,{cache:1,dark:1})}})},chooseBoxBack:function(){cur.videoChoosePrevSection=cur.videoChoosePrevSection||"all",0==cur.videoChoosePrevSection.indexOf("album_")&&(cur.videoChoosePrevSection="albums"),nav.go("/videos?section="+cur.videoChoosePrevSection)},initChooseBox:function(e,o,t,i,r,a,n){if(arguments.length>0)this.initChooseBoxOptions={isNoteEdit:e,isReview:o,toMail:t,curOwnerId:i,defaultTitle:r,blockPersonal:a,isSnippetVideo:n};else{if(!this.initChooseBoxOptions)return;e=this.initChooseBoxOptions.isNoteEdit,o=this.initChooseBoxOptions.isReview,t=this.initChooseBoxOptions.toMail,i=this.initChooseBoxOptions.curOwnerId,r=this.initChooseBoxOptions.defaultTitle,a=this.initChooseBoxOptions.blockPersonal,n=this.initChooseBoxOptions.isSnippetVideo}cur.found={},cur.currentSortings={},cur._preloadedPages={},cur.videoSearchFilters={},cur.chosenVideos=[],cur.albumsShowingAll={},cur.isNoteEdit=e,cur.videoShowWindow={},cur.isSnippetVideoSelection=n;var s=curBox(),d=cur.getOwnerId;function c(){s.setOptions({width:631,bodyStyle:"padding: 0",hideButtons:!0}),ge("box_layer_wrap").scrollTop=0}function _(){each(g.AVAILABLE_TABS,(function(e,o){hide("video_subtab_pane_"+o)})),hide(geByClass1("video_subtab_pane_album"))}function v(){s.setOptions({title:'<div class="back" onclick="Video.chooseBoxBack();"><span class="back__icon">'+(0,l.getIcon24BrowserBack)().icon+"</span>"+(0,u.getLang)("video_choose_box_back_to_videos")+"</div>",bodyStyle:"padding: 0",noRefreshCoords:1})}function h(){var e=r;if(!a&&!o&&cur.videoSwitchOwnerId){var t=i==vk.id?(0,u.getLang)("video_choose_wall_to_group_videos"):(0,u.getLang)("video_choose_wall_to_my_videos");e+='<span class="divider">|</span><a class="toggle" onclick="Video.switchChooserToOwner('+(i==vk.id?cur.videoSwitchOwnerId:vk.id)+')">'+t+"</a>"}s.getOptions().defaultTitle&&(e=s.getOptions().defaultTitle),s.setOptions({title:e,grey:o})}function p(){curBox()&&each(geByClass("video_item",curBox().bodyNode),(function(){var e=geByClass1("media_check_btn_wrap",this),o=this.getAttribute("data-id");toggleClass(e,"checked",-1!=cur.chosenVideos.indexOf(o))}))}cur.getOwnerId=function(){return i},s.setOptions({onHideAttempt:function(){return cur.getOwnerId=d,!0}}),cur.nav.push((function(e,o,t,r){if(!r.filtersChanged&&1===Object.keys(t).length&&t[0]&&0!=t[0].indexOf("video")&&!r.fromSearch)return!0;if(e[0]&&!e.section&&t[0]!=="videos"+i)return!0;hide("global_prg");var a=geByClass1("video_default_tabs",s.bodyNode),n=geByClass1("video_subtab_pane_album",s.bodyNode),d=e.section?e.section:"all";g._prepareSearchFilters(t);var l=e.section?"":t.q||val(cur.searchInputEl);if(l?(d="search",r.fromSearch||r.globalQuery||(r.globalQuery=l),g.doSearch(l),v(),g._updateChooseFixedBottom()):(g.inputVal(cur.searchInputEl,""),g.doSearch("")),cur.videoForcedSection=d,-1!==g.AVAILABLE_TABS.indexOf(d))_(),show("video_subtab_pane_"+d),show(a),hide("albumPane"),h(),c(),cur.videoChoosePrevSection=d,"albums"!==d&&g.loadSilent(d),g.updateEmptyPlaceholder(d);else if(d&&0==d.indexOf("album_")){var u=d.split("_")[1];window.showGlobalPrg(ge("video_playlist_item_"+u),{cls:"progress_inv_img",w:46,h:16,shift:[0,-22],zIndex:1e3}),g._addPendingAction(d,(function(){v(),_(),hide("global_prg"),hide(a),n.id="video_subtab_pane_"+d;var e=geByClass1("video_items_list",n);e.id="video_"+d+"_list",addClass(e,"_video_"+d+"_list"),e.innerHTML="",show(n);var o=cur.getOwnerId();cur.videoShowWindow=cur.videoShowWindow||{},cur.videoShowWindow[o]=cur.videoShowWindow[o]||{},cur.videoShowWindow[o][d]=!1,g.showMore(d,geByClass1("ui_load_more_btn",ge("video_subtab_pane_album"))),c(),p(),g._updateChooseFixedBottom()})),cur.videoChoosePrevSection=d,g.loadSilent(d)}return p(),!1})),cur.chooseVideoToMail=t,cur.isCurrentVideoLayer=!0,g.loadSilent(),c(),addEvent(ge("box_layer_wrap"),"scroll",g.onScroll);var f=boxLayerWrap.scrollTop;elfocus(geByClass1("_scroll_node",s.bodyNode)),boxLayerWrap.scrollTop=f,g.initSearch(),h(),o||(cur.chooseVideoMedia=function(e,o,t){var i,r=e;if(hasClass(r,"media_check_btn_wrap")?cur.cancelClick=!0:r=geByClass1("media_check_btn_wrap",r),(i=cur.chosenVideos.indexOf(o))>=0)cur.chosenVideos.splice(i,1);else{if(cur.chosenVideos.length>=(cur.maxFiles||10))return;cur.chosenVideos.push(o)}if(toggleClass(r,"checked"),1===cur.chosenVideos.length&&!t)return g.doAttachSelectedVideos(e),!1;var a=ge("video_choosebox_bottom");if(cur.chosenVideos.length>0){show(a);var n=cur.chooseVideoAdd?cur.lang.video_add_videos:cur.lang.global_attach_videos;val(geByClass1("video_choosebox_attach_btn",a),langNumeric(cur.chosenVideos.length,n)),g._updateChooseFixedBottom()}else hide(a);return toggleClass(ge("video_choose_box"),"with_bottom_fixed",isVisible(a)),!1}),window.uiScrollBox&&window.uiScrollBox.init(curBox(),{onHide:function(){hide("global_prg"),cur.nav.pop(),removeEvent(ge("box_layer_wrap"),"scroll",g.onScroll),cur.isCurrentVideoLayer=!1},onShow:function(){g.initChooseBox()}})},doAttachSelectedVideos:function(e){hasClass(e,"flat_button")?(0,r.lockButton)(e):window.showGlobalPrg(geByClass1("video_item_thumb_wrap",e)||e,{cls:"progress_inv_img",w:46,h:16,zIndex:1e3});var o=function(){hasClass(e,"flat_button")&&(0,r.unlockButton)(e),hide("global_prg")};if(cur.chooseVideoAdd)return cur.chooseVideoAdd(cur.chosenVideos,"",o);g.attachVideos(cur.chosenVideos,o)},attachVideos:function(e,o){ajax.post("al_video.php?act=a_videos_attach_info",{from:cur.getFrom?cur.getFrom():"",videos:e.join(",")},{onDone:function(e){if(o&&o(),cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return each(e,(function(e,o){return cur.chooseSnippetVideo(e,o),!1})),void(curBox()&&curBox().hide());var t=0;each(e,(function(e,o){cur.isNoteEdit&&window.editorChooseVideo?window.editorChooseVideo(o.thumb,o.name,o.duration,"/video"+e,e):cur.chooseMedia("video",e,o,t,cur.chosenVideos.length>1),t++})),curBox()&&cur.chosenVideos.length>1&&curBox().hide()}})},_updateChooseFixedBottom:function(){var e=curBox(),o=ge("video_choosebox_bottom");if(e&&o){var t=gpeByClass("box_layout",e.bodyNode);getSize(t)[1]+(getXY(t)[1]-scrollGetY())-window.clientHeight()>0?addClass(o,"fixed"):removeClass(o,"fixed")}},_addPendingAction:function(e,o){var t=cur.getOwnerId?cur.getOwnerId():cur.oid;if(cur.videoPendingAction=cur.videoPendingAction||{},cur.videoPendingAction[t]=cur.videoPendingAction[t]||{},e){var i=cur.videoPendingAction[t][e];cur.videoPendingAction[t][e]=function(){o(),i&&i()}}},_callPendingAction:function(e){g._addPendingAction();var o=g.getCurOwnerId();cur.videoPendingAction[o][e]&&cur.videoPendingAction[o][e](),cur.videoPendingAction[o][e]=!1},_clearPendingAction:function(e){g._addPendingAction();var o=g.getCurOwnerId();cur.videoPendingAction[o][e]=!1},toggleTooltip:function(e,o){(0,n.showTooltip)(e,{appendParentCls:"videocat_row",black:1,text:o,shift:[9,18,3],needLeft:!0})},toggleAddTooltip:function(e,o,t){var i=gpeByClass("_video_item",e);g.toggleTooltip(e,hasClass(i,"video_added")?t:o)},show:function(e,o,t,i){if(cur.articleEditorLayer)return cancelEvent(e);if(t.playAlbum&&statlogsValueEvent("video_play_album",0,"play_album"),cur.isCurrentChooseVideoBox){var r=window.event,a=o.split("_");return ajax.post("al_video.php?act=a_video_photo_sizes",{oid:a[0],vid:a[1],type:cur.isCurrentChooseVideoBox},{onDone:function(){switch(window.event=r||window.event,cur.isCurrentChooseVideoBox){case"video_add":cur.chooseVideoAdd(o,arguments[0]);break;case"wiki_editor":window.editorChooseVideo(arguments[0],arguments[1],arguments[2],"video"+o,o);break;case"video_choose":cur.chooseMedia("video",o,arguments[0])}}}),cancelEvent(e),!1}if(i&&hasClass(i,"video_row_deleted"))return!1;if(!vk.id&&i&&hasClass(i,"video_row_not_public"))return showDoneBox((0,u.getLang)("video_please_sign_in")),!1;var n=extend({root:1,autoplay:1},t||{}),s=(t?t.listId:"")||this.getDefaultListId();if(!n.module){var d=cur.currentModule?cur.currentModule():cur.module;"video_search"===d&&isAncestor(i,"video_search_videos_list")&&(d="video_search_local"),n.module=d}if(g.isInVideosList()&&!n.playlistId){var c,l=g.getLoc().section||"all";"all"===l?n.playlistId=cur.oid+"_-2":"uploaded"===l?n.playlistId=cur.oid+"_-1":(c=l.match(/^album_(-?\d+)$/))&&(n.playlistId=cur.oid+"_"+c[1])}if(g.isInCatalog()&&n.playlistId&&/^cat_\d+$/.test(n.playlistId)&&i){var v=gpeByClass("videocat_row",i),h=v?v.getAttribute("data-type"):"";(h=(0,_.intval)(h.replace("cat_","")))&&cur.moreVideosInfo[h]&&(n.catLoadMore=function(e,o,t){Videocat.slideLoadMore(e,o,t)}.pbind(v,h))}if(n.playlistId&&(n.addParams=extend(n.addParams||{},{playlist_id:n.playlistId,show_next:(0,_.intval)(window.VideoPlaylist&&!!VideoPlaylist.getList(n.playlistId)),force_no_repeat:1,show_all_videos:(0,_.intval)(cur.isCatalog&&(!window.VideoPlaylist||!VideoPlaylist.getList(n.playlistId)))})),n.playlistId&&/^cat_ugc_popular/.test(n.playlistId)&&(statlogsValueEvent("videocat_popular","","play"),cur.popularQid)){n.addParams=extend(n.addParams||{},{suggestions_qid:cur.popularQid});var p=domPN(i),f=geByClass("video_item",ge("videocat_page_block_ugc_popular")),S=indexOf(f,p)+1;vkImage().src="//go.imgsmail.ru/vk?pxn=vic&qid="+cur.popularQid+"&vid="+o+"&p="+S+"&t=0"}if(cur.videoSearchStats){var m=domClosest("video_item",i);if(m&&m.hasAttribute("data-search-pos")){cur.videoSearchPos=parseInt(m.getAttribute("data-search-pos")),cur.videoSearchPos>cur.videoSearchStats.lastSeenIndex&&(cur.videoSearchStats.lastSeenElement=m,cur.videoSearchStats.lastSeenIndex=cur.videoSearchPos),cur.videoSearchStats.positions[cur.videoSearchPos]=extend({clicked:0},cur.videoSearchStats.positions[cur.videoSearchPos]),cur.videoSearchStats.positions[cur.videoSearchPos].clicked++;var w=++cur.videoSearchStats.clickNum,E=(new Date).getTime()-cur.videoSearchStats.lastActionTime;n.addParams=extend(n.addParams||{},{click_num:w,click_time:E})}}var b=o.split("_");return g._saveHistoryAction(b[0],b[1]),showVideo(o,s,n,e)},getDefaultListId:function(){return window.cur.oid<0?"club"+-window.cur.oid:window.cur.pvVideoTagsShown&&window.cur.pvShown?"tag"+window.cur.pvVideoTagsShown:""},isInVideosList:function(){var e=g.getLoc();return/^videos-?\d+|video-?\d+_\d+$/.test(e[0])&&!e.q&&(inArray(g._getCurrentSectionType(),g.AVAILABLE_TABS)||g.isInAlbum())},deleteAlbum:function(e,o){return e=e.split("_")[1],showBox("al_video.php?act=delete_album",{aid:e,oid:cur.oid,is_showcase:cur.is_showcase},{dark:1}),cancelEvent(o)},editAlbum:function(e,o){return e=e.split("_")[1],showBox("al_video.php?act=edit_album",{oid:cur.oid,aid:e,is_showcase:cur.is_showcase},{stat:[jsc("web/upload.js")],dark:1,containerClass:"VideoPlaylistPopup"}),cancelEvent(o)},initEditAlbumBox:function(e,o,t,i,a,n,s){var d=curBox(),c=isObject(a),l=!!Object.keys(s).length;if(l&&(VideoUpload.initThumbUpload(s,d.bodyNode),isObject(n)&&n.uploaded_id)){var _=geByClass1("js-video_tc_upload_image",d.bodyNode);setStyle(_,{backgroundImage:"url("+n.uploaded_url+")"}),show(_);var v=geByClass1("js-video_tc_uploader",d.bodyNode);v&&domData(v,"thumb-id",n.uploaded_id)}c&&(cur.privacy=extend(cur.privacy||{},a)),d.setOptions({bodyStyle:"padding: 20px; padding-bottom: 25px;",width:422}),d.removeButtons(),d.addButton((0,u.getLang)("global_save"),(function(a){var n=ge("video_album_edit_title").value,s=c?Privacy.getValue("video_playlist"+o):"",u="";if(l){var _=geByClass1("js-video_tc_uploader",d.bodyNode);u=domData(_,"thumb-id")||"0_0"}ajax.post("al_video.php?act=do_edit_album",{id:o,oid:e,hash:t,title:n,privacy:s,thumb_id:u},{showProgress:r.lockButton.pbind(a),hideProgress:r.unlockButton.pbind(a),onDone:function(t){o?cur.isAdmin?AdminShowcasePlaylists.search():nav.reload():cur.is_showcase?nav.go(i+"/"+e+"_"+t):nav.change({section:"album_"+t},!1,{noback:!0}),d.hide()}})})),d.addButton((0,u.getLang)("global_cancel"),d.hide,"no"),ge("video_album_edit_title").focus()},editCategories:function(e,o){var t=e.split("_")[1];return showBox("al_video.php?act=update_categories",{owner_id:cur.oid,playlist_id:t},{dark:1,onDone:function(e,o){cur.categoriesUpdateOptions={hash:o.hash,owner_id:o.owner_id,playlist_id:o.playlist_id};var t=new Dropdown(ge("video_playlist_categories"),o.all_categories,{multiselect:!0,autocomplete:!0,big:1,width:380,selectedItem:o.category_ids});e.setOptions({bodyStyle:"padding: 20px; padding-bottom: 25px;",width:422}),e.removeButtons(),e.addButton("Сохранить",(function(o){var i={hash:cur.categoriesUpdateOptions.hash,owner_id:cur.categoriesUpdateOptions.owner_id,playlist_id:cur.categoriesUpdateOptions.playlist_id,category_ids:t.selectedItems().map((function(e){return e[0]}))};ajax.post("al_video.php?act=do_update_categories",i,{showProgress:r.lockButton.pbind(o),hideProgress:r.unlockButton.pbind(o),onDone:function(){e.hide()}})})),e.addButton("Отмена",e.hide,"no")}}),cancelEvent(o)},createAlbum:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cur.oid;if(cur.is_showcase&&!vk.id)return showBox("al_login.php?act=box",{from:nav.strLoc},{},e),!1;showBox("al_video.php?act=edit_album",{oid:o,is_showcase:cur.is_showcase},{stat:[jsc("web/upload.js")],dark:1,containerClass:"VideoPlaylistPopup"})},uploadVideoBox:function(){return cur.uploadBanned?((0,a.showFastBox)({title:(0,u.getLang)("video_no_upload_title")},(0,u.getLang)("video_claims_no_upload")),!1):(showTabbedBox("al_video.php?act=upload_box",{oid:cur.oid},{stat:["video_edit.css","privacy.css",jsc("web/privacy.js")],params:{bodyStyle:"position: relative;",dark:1,hideButtons:1}}),!1)},isVideoPlayerOpen:function(e,o){var t=e;return o&&(t+="_"+o),window.mvcur&&!0===mvcur.mvShown&&mvcur.videoRaw===t},startPollVideoReady:function(e,o){var t=e+"_"+o;setTimeout((function(){ajax.post("al_video.php?act=check_upload_status",{video:t,oid:e,vid:o},{onDone:function(i){g.isVideoPlayerOpen(e,o)&&(i?(mvcur.minimized?Videoview.hide(!1,!0):Videoview.backLocation(),showVideo(t,"",{})):g.startPollVideoReady(e,o))}})}),1e4)},tcSlide:function(e,o,t,r){var a=gpeByClass("video_tc_slider",o),n=geByClass1("video_tc_slider_cont",a),s=getSize(n)[0],d=n.children[0].classList.contains("ThumbChooser__item")?12:10,c=getSize(n.children[0])[0]+d,l=(0,i.data)(n,"currOffset")||0;l+=t,l=Math.max(-(n.children.length-Math.abs(t)),Math.min(0,l)),(0,i.data)(n,"currOffset",l),r&&addClass(n,"no_transition");var u=l*c,_=-(n.children.length*c-s)+d;setStyle(n,{left:Math.max(u,_)}),r&&setTimeout((function(){removeClass(n,"no_transition")}));var v=0==+l,h=+l==-(n.children.length-Math.abs(t)),g=geByClass1("video_tc_btn_left",a),p=geByClass1("video_tc_btn_right",a);function f(e,o){e?addEvent(o,"mouseleave",(function(){setStyle(o,"pointer-events","none"),removeEvent(o,"mouseleave")})):setStyle(o,"pointer-events","all")}return toggleClass(g,"video_tc_btn_none",v),toggleClass(p,"video_tc_btn_none",h),f(v,g),f(h,p),e&&cancelEvent(e),!1},subscribePlaylist:(e,o)=>{if(cur.is_showcase&&!vk.id)return showBox("al_login.php?act=box",{from:nav.strLoc},{},o),!1;var t=ge("video_playlist_subscribe_btn");return window.ajax.post("al_video.php?act=playlist_subscribe",{playlist_raw_id:e,subscribe:t.classList.contains("activated")?0:1,hash:cur.videoSubscriptionHash},{onDone:e=>{t.classList.toggle("activated",e)}}),!1},updateAlbum:function(){},updateVideo:function(e,o){},_initSearchStats:function(e){cur.videoSearchPos=null,cur.videoSearchStats={loc:e,totalViews:0,lastSeenElement:null,lastSeenIndex:-1,totalViewedTime:0,clickNum:0,lastActionTime:(new Date).getTime(),positions:[]}},_clearSearchStats:function(){delete cur.videoSearchPos,delete cur.videoSearchStats},logSearchStats:function(){if(cur.vSearchInputBlurred&&cur.videoSearchStats){cur.vSearchInputBlurred=!1;var e=cur.videoSearchStats.loc.q+g._buildFiltersSearchStr();if(!cur.globalSearchResults||!cur.globalSearchResults[e])return;for(var o=cur.globalSearchResults[e].list||[],t=g._serializeSearchParams(cur.videoSearchStats.loc),i=cur.videoSearchStats.lastSeenIndex+1,r=[],a=0;a<i;a++){var n=extend(cur.videoSearchStats.positions[a]||{},g._extractSearchStat(o[a]));r.push(g._serializeSearchStat(n))}ajax.post("al_video.php?act=a_search_query_stat",{query:t,count:cur.videoSearchStats.totalViews,total_viewed_time:cur.videoSearchStats.totalViewedTime,scrolled_until:i,position_stats:r})}},_serializeSearchParams:function(e){return(e.hd?"1":"0")+"#"+(e.notsafe?"1":"0")+"#"+(e.order||"")+"#"+(e.date||"")+"#"+(e.len||"")+"#"+e.q},_extractSearchStat:function(e){return e?{oid:e[0],vid:e[1]}:{}},_serializeSearchStat:function(e){e=e||{};for(var o="",t=0;t<g.SEARCH_STATS_POSITION_FIELDS.length;t++){var i=e[g.SEARCH_STATS_POSITION_FIELDS[t]];null==i&&(i=""),o+=o?","+i:i}return o},_updateLastSeenElement:function(e){if(cur.videoSearchStats&&(null!==cur.videoSearchStats.lastSeenElement&&e.contains(cur.videoSearchStats.lastSeenElement)||(cur.videoSearchStats.lastSeenElement=domFC(e),cur.videoSearchStats.lastSeenElement))){cur.videoSearchStats.lastSeenIndex=0;var o=window.clientHeight(),t=domNS(cur.videoSearchStats.lastSeenElement);if(t){for(var i=t.getBoundingClientRect();null!==t&&i.top+t.clientHeight/2<o&&(cur.videoSearchStats.lastSeenElement=t,t=domNS(cur.videoSearchStats.lastSeenElement));)i=t.getBoundingClientRect();cur.videoSearchStats.lastSeenIndex=parseInt(cur.videoSearchStats.lastSeenElement.getAttribute("data-search-pos"))||0}}},_updateThumbsInView:function(){clearTimeout(this._updateThumbsInViewTO),this._updateThumbsInViewTO=setTimeout((function(){var e=null,o=window.clientHeight(),t="im"===cur.module?0:scrollGetY();each(geByClass("js-video-item-thumb"),(function(i,r){if(domData(r,"thumb")){var a=getXY(r,"im"===cur.module)[1];if(e=e||getSize(r),a>t-e[1]-800&&a<t+o+800){var n=domData(r,"thumb");domData(r,"thumb",null),setStyle(r,"background-image","url('"+n+"')")}}}))}),50)},copyAlbumVideosList:function(){var e=g._getCurrentSectionType(),o=cur.getOwnerId();if("album"===e&&(e=g.getLoc().section),!0!==cur.silentLoadingProgress[o][e]&&cur.silentLoaded[o][e]){var t=cur.silentLoaded[o][e].map((function(e){return"https://vk.com/video"+e[VideoConstants.VIDEO_ITEM_INDEX_OWNER_ID]+"_"+e[VideoConstants.VIDEO_ITEM_INDEX_ID]})).join("\n");(0,a.showFastBox)("",'<textarea class="dark" style="width: 100%; height: 350px;">'+t+"</textarea>")}else(0,a.showFastBox)("","List has not loaded yet")},getCurOwnerId:function(){return cur.getOwnerId?cur.getOwnerId():cur.oid}}}},r={};function a(e){var o=r[e];if(void 0!==o)return o.exports;var t=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(t.exports,t,t.exports,a),t.loaded=!0,t.exports}a.m=i,e=[],a.O=(o,t,i,r)=>{if(!t){var n=1/0;for(l=0;l<e.length;l++){for(var[t,i,r]=e[l],s=!0,d=0;d<t.length;d++)(!1&r||n>=r)&&Object.keys(a.O).every((e=>a.O[e](t[d])))?t.splice(d--,1):(s=!1,r<n&&(n=r));if(s){e.splice(l--,1);var c=i();void 0!==c&&(o=c)}}return o}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[t,i,r]},a.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return a.d(o,{a:o}),o},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var r=Object.create(null);a.r(r);var n={};o=o||[null,t({}),t([]),t(t)];for(var s=2&i&&e;"object"==typeof s&&!~o.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((o=>n[o]=()=>e[o]));return n.default=()=>e,a.d(r,n),r},a.d=(e,o)=>{for(var t in o)a.o(o,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},a.e=()=>Promise.resolve(),a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),a.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={7138:0};a.O.j=o=>0===e[o];var o=(o,t)=>{var i,r,[n,s,d]=t,c=0;for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(d)var l=d(a);for(o&&o(t);c<n.length;c++)r=n[c],a.o(e,r)&&e[r]&&e[r][0](),e[n[c]]=0;return a.O(l)},t=self.webpackChunkvk=self.webpackChunkvk||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})();var n=a.O(void 0,[8592],(()=>a(581133)));n=a.O(n)})();