(()=>{"use strict";var e,t,i,o={86798:(e,t,i)=>{var o=i(663662),r=i(112125),s=i(843052),a=i(125935),n=i(128533),d=i(422753),l=i(45150);window.GroupsAdmins=new class{init(e){var t=e.admin_tips_available,i=e.admin_tips_mode,o=e.admin_tips_location;t&&(window.GroupsAdminTips=r.GroupsAdminTips,r.GroupsAdminTips.init(i,o)),e&&e.hasOwnProperty("chats_edit_available")&&e.chats_edit_available&&window.GeChats.init(e.chats_edit_options)}coverUploadBox(e){new a.default(e).showBox()}},window.GroupsOnboarding=new o.GroupsOnboarding,window.GroupsInviteFriends=new s.GroupsInviteFriends,(0,n.tq)().setStartupHandler("Groups/donut_chat_tooltip",(e=>{var t=e.payload,i=t.target,o=t.data,r=(o=void 0===o?{}:o).content,s=o.helpHintHash,a=o.helpHintId,n=(0,d.helpHintTooltip)(i,{content:r,helpHintHash:s,helpHintId:a},{align:l.default.ALIGN_CENTER,appendToParent:!0,autoAdjustToViewport:!1,forceSide:"top",offset:[10,-5],rightShift:10}).tooltip;window.requestAnimationFrame((()=>{n.show()}))}));try{window.stManager.done(jsc("web/groups_admins.js"))}catch(e){}},906143:(e,t,i)=>{i.d(t,{default:()=>g});i(530522),i(579665),i(95767),i(66108),i(21466),i(991181),i(296253),i(751876),i(59357);var o=i(888969),r=i(414914),s=i(116886),a=i(442699),n=i(705456),d=i(901260),l=i(927663),h=i(791563),c=i(51229),p=i(91502);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var v=280;class g{constructor(e,t,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.groupId=e,this.showHash=t,this.addressId=i,this.isInline=o,this.onSaveHandler=r,this.map={},this.placeSelector={},this.citySelector={},this.countrySelector={},this.citySelectorEdit={},this.countrySelectorEdit={},this.box={},this.confirmationBox={},this.addressGeocodeTimer=null,this.onShowCallback=s,this.onDestroyCallback=a,this.onDeleteCallback=n}deleteAddressOnConfirmation(e,t,i,o){e.confirmationBox.hide(),e.deleteAddress(t,i,o,!0)}deleteAddress(e,t,i,o){if((0,n.linkLocked)(e))return!1;if(!o){var r=this.getAddress();r.title=r.title.replace(/</g,"&lt;").replace(/>/g,"&gt;");var a=(0,s.getLang)("groups_edit_address_delete_confirmation_message",r.title),d=this.deleteAddressOnConfirmation.pbind(this,e,t,i);return this.confirmationBox=(0,h.showFastBox)({title:(0,s.getLang)("groups_edit_address_delete_confirmation_title")},a,(0,s.getLang)("groups_edit_address_delete_confirmation_yes"),d,(0,s.getLang)("global_cancel")),!1}var l,c={act:"delete_address",id:this.groupId,address_id:t,hash:i};l=this.onDeleteCallback?()=>{this.isChanged=!1,this.box.hide(),this.onDeleteCallback()}:this.onAddressDelete.bind(this),ajax.post("groupsedit.php",c,{onDone:l,showProgress:n.lockLink.pbind(e),hideProgress:n.unlockLink.pbind(e)})}onAddressDelete(e){var t=e.address_id,i=e.main_address_id,o=void 0===i?null:i,a=ge("groups_edit_address_block_"+t);(0,r.re)(a),0==(0,r.geByClass)("groups_edit_address_block").length&&(0,r.show)("groups_edit_empty_placeholder"),this.isChanged=!1,this.box.hide(),window.GroupsEdit.invalidateBack();var n="<b>"+(0,s.getLang)("global_changes_saved")+"</b><br/>"+(0,s.getLang)("groups_address_edit_delete_address_success");window.GroupsEdit.showMessage(n),this.setCount(-1),null!==o&&window.GeAddresses.setMainAddressId(o)}setCount(e){var t=(0,r.geByClass1)("groups_edit_addresses_new_count_left"),i=(0,a.intval)((0,r.attr)(t,"data-left-count"));i-=e;var o="("+(0,s.langStr)((0,s.getLang)("groups_address_edit_left_count"),"%s",i)+")";(0,r.val)(t,o),(0,r.attr)(t,"data-left-count",i);var n="groups_edit_addresses_edit_new";i<=0?(0,r.hide)(n):(0,r.show)(n),i>=10?(0,r.hasClass)(t,"unshown")||(0,r.addClass)(t,"unshown"):(0,r.hasClass)(t,"unshown")&&(0,r.removeClass)(t,"unshown")}onClean(){this.map.removeMap(),this.placeSelector.destroy(),this.citySelector.destroy(),this.countrySelector.destroy(),this.citySelectorEdit.destroy(),this.countrySelectorEdit.destroy()}create(){var e={act:"edit_address_box",id:this.groupId,hash:this.showHash,is_inline:+this.isInline};this.addressId&&(e.address_id=this.addressId);var t={onDone:this.onShowBoxDone.bind(this),containerClass:"address_box "+(this.addressId?"address_box_edit":"address_box_add"),params:{onHideAttempt:this.onHideAttempt.bind(this)}};this.onDestroyCallback&&(t.params.onDestroy=this.onDestroyCallback),(0,h.showBox)("groupsedit.php",e,t)}onShowBoxDone(e,t){this.box=e,this.box.setOptions({width:570,bodyStyle:"padding: 0",onClean:this.onClean.bind(this)}),this.initBox(t),this.onShowCallback&&this.onShowCallback()}onHideAttempt(e){if(!this.isChanged||e)return!0;if(this.isChanged){var t=(0,h.showFastBox)({title:(0,s.getLang)("global_warning"),dark:1,forceNoBtn:!0,bodyStyle:"padding: 20px; line-height: 160%;"},(0,s.getLang)("groups_address_edit_close_warning"),(0,s.getLang)("global_continue"),(()=>{this.isChanged=!1,t.hide(),this.box.hide(!0)}),(0,s.getLang)("global_cancel"));return!1}}onAddressGeocoderTimeout(){if(!this.latLonGeocode){var e=this.getAddress();this.needUpdatePlaceSelector=!0,this.geocoder.geocode({address:e.geocoderString})}}addressInputOnChange(){this.addressGeocodeTimer&&(clearTimeout(this.addressGeocodeTimer),this.addressGeocodeTimer=null),this.addressGeocodeTimer=setTimeout(this.onAddressGeocoderTimeout.bind(this),2e3)}initBox(e){this.editAddressPlaceTitle=ge("edit_address_title_inp"),this.editAddressPlaceAddress=ge("edit_address_address_inp"),this.editAddressPlaceAddress.addEventListener("input",this.addressInputOnChange.bind(this)),this.editAddressPlaceAdd=ge("edit_address_additional_inp"),(0,c.autosizeSetup)(this.editAddressPlaceAdd,{minHeight:68,maxHeight:110}),this.editAddressPlacePhone=ge("address_phone"),this.editAddressPlaceItsMain=ge("address_its_main"),this.editAddressPlaceSetAsMainBlock=ge("address_set_as_main_block");var t=cur.addressData;window.selectsData.setCountries(t.countries),t.country&&window.selectsData.setCities(t.country[0],t.cities),this.metroSelector=new window.StationSelect(ge("place_metro"),ge("edit_address_metro"),{width:v,forceEnableCustom:1,noBlur:!0,big:1,station_color:1}),this.placeSelector=new o.PlacesSelect(ge("place_address"),ge("address_row"),{width:v,forceEnableCustom:1,noBlur:!0,big:1,showAddress:1,showCreateNewPlace:1});var i={width:v,country:t.country,placeSelect:this.placeSelector,stationSelectWithColor:this.metroSelector,big:1},a={width:v,country:t.country,big:1};browser.msie&&browser.version<=11&&(i.liteEventsBind=!0,a.liteEventsBind=!0),this.citySelector=new window.CitySelect(ge("place_city"),ge("city_row"),i),this.citySelectorEdit=new window.CitySelect(ge("place_city_edit"),ge("city_row_edit"),a);var n={width:v,citySelect:this.citySelector,noDefaultCountry:!0,full_list:(0,s.getLang)("select_country_full_list"),big:1},d={width:v,citySelect:this.citySelectorEdit,noDefaultCountry:!0,full_list:(0,s.getLang)("select_country_full_list"),big:1};browser.msie&&browser.version<=11&&(n.liteEventsBind=!0,d.liteEventsBind=!0),this.countrySelector=new window.CountrySelect(ge("place_country"),ge("country_row"),n),this.countrySelectorEdit=new window.CountrySelect(ge("place_country_edit"),ge("country_row_Edit"),d),this.isEditScreen=e.address,t.country&&(this.countrySelector.val(t.country,!0),this.countrySelectorEdit.val(t.country,!0)),t.city&&(this.citySelector.val(t.city,!0),this.citySelectorEdit.val(t.city,!0)),this.countrySelector.setOptions({onChange:this.countrySelectorOnChange.bind(this)}),this.countrySelectorEdit.setOptions({onChange:this.countrySelectorEditOnChange.bind(this)}),this.citySelector.setOptions({onChange:this.citySelectorOnChange.bind(this)}),this.citySelectorEdit.setOptions({onChange:this.citySelectorEditOnChange.bind(this)}),this.placeSelector.setOptions({onChange:this.placeSelectorOnChange.bind(this),onCreateNew:this.placeSelectorOnCreateNew.bind(this)}),Array.prototype.forEach.call((0,r.geByClass)("time_input"),(e=>{new p.default({element:e})})),this.saveHash=e.saveHash,e.address?(this.delHash=e.delHash,this.initEditAddress(e)):this.initNewAddress()}placeSelectorOnCreateNew(e){(this.geocodeCurrentLatLon(),e)||(e=u(this.placeSelector.val_full(),2)[1]);e&&(0,r.val)(this.editAddressPlaceTitle,e),this.nextCreateStep()}setEditAddress(e,t,i,o){(0,r.val)(this.editAddressPlaceTitle,e),(0,r.val)(this.editAddressPlaceAddress,(0,a.unclean)(t)),(0,r.val)(this.editAddressPlaceAdd,i),(0,r.val)(this.editAddressPlaceMetro,"")}initEditAddress(e){var t=e.address;this.setEditAddress(t.title,t.address,t.additional_address),this.metroSelector.val(t.metro_id,!0),this.curAddress=t,this.needInitMap=!0,this.initMapBox(),this.isEditScreen=!0,this.isChanged=!0,(0,r.hide)("groups_edit_address_select_new"),(0,r.show)("edit_address"),(0,r.show)("public_place_map"),(0,r.show)("edit_timetable"),this.box.setButtons((0,s.getLang)("global_save"),this.boxSavePlace.bind(this),(0,s.getLang)("global_cancel"));var i=(0,r.ce)("a",{innerHTML:(0,s.getLang)("groups_edit_address_delete")});i.addEventListener("click",(()=>{this.deleteAddress(i,t.id,e.delHash)})),this.box.controlsTextNode.appendChild(i),this.box.updateBoxCoords()}updateMapAndPlaceSelector(e,t,i,o){this.box.showProgress(),o&&this.map.setBounds(o),i||(i=new window.vkMaps.LatLonPoint(e,t)),this.setMarker(i),this.map.setCenterAndZoom(i,14),this.updatePlaceLatLon(e,t),this.box.hideProgress()}updatePlaceLatLon(e,t){if(!e||!t){var i=this.map.getCenter();e=i.lat,t=i.lon}this.placeSelector.setOptions({latitude:e,longitude:t})}setMarker(e){!1!==this.marker&&(debugLog("removing marker"),this.map.removeMarker(this.marker)),this.marker=new window.vkMaps.Marker(e),this.marker.dragend.addHandler(this.onDragMarker,this),this.map.addMarkerWithData(this.marker,{draggable:!0,infoBubble:!1,icon:"/images/map/move.png",icon2x:"/images/map/move_2x.png",iconSize:[26,23],iconAnchor:[7,23]})}geocodeCurrentLatLon(e){this.latLonGeocode=!0,e||(e=this.map.getCenter()),this.geocoder.geocode(e)}onGeocoderSuccess(e){var t=!0;if(this.latLonGeocode&&(this.latLonGeocode=!1,t=!1),t){var i=e.point,o=e.bounds;this.updateMapAndPlaceSelector(i.lat,i.lon,i,o)}else this.onLatLonDecode(e)}onLatLonDecode(e){e.text_name&&(0,r.val)(this.editAddressPlaceAddress,(0,a.unclean)(e.text_name))}onGeocoderFailure(e){this.updatePlaceLatLon(0,0)}onMapLoadHandler(){this.map.setOptions({enableScrollWheelZoom:!0}),this.map.addSmallControls();var e=this.onGeocoderSuccess.bind(this),t=this.onGeocoderFailure.bind(this);this.geocoder=new window.vkMaps.Geocoder("yandex2",e,t),this.needInitMap&&(this.curAddress?this.updateMapAndPlaceSelector(this.curAddress.latitude,this.curAddress.longitude):this.getGeocoderStringAndUpdate()),this.box.hideProgress()}getAddress(){var e={},t=(0,a.intval)(this.countrySelector.val());if(e.geocoderString="",!(t>0))return{};e.geocoderString=this.countrySelector.val_full()[1],e.countryId=(0,a.intval)(this.countrySelector.val());var i=(0,a.intval)(this.citySelector.val());if(i>0){var o=this.citySelector.val_full();if(e.cityId=i,o[2]){var s=o[2].split(",");e.geocoderString+=","+s[0]+", "+o[1]}else e.geocoderString+=", "+this.citySelector.val_full()[1]}return e.title=(0,r.val)(this.editAddressPlaceTitle),e.address=(0,r.val)(this.editAddressPlaceAddress),e.address&&(e.geocoderString+=", "+e.address),e.additional=(0,r.val)(this.editAddressPlaceAdd),this.marker&&(e.lat=this.marker.location.lat,e.lon=this.marker.location.lon),this.selectedPlaceId&&(e.placeId=this.selectedPlaceId),e.metroId=(0,a.intval)(this.metroSelector.val()),e.geocoderString=e.geocoderString.replace(/<\/?[^>]+>/g,""),e.phone=(0,r.val)(this.editAddressPlacePhone),this.editAddressPlaceItsMain&&(e.isMain=(0,n.isChecked)(this.editAddressPlaceItsMain)),this.editAddressPlaceSetAsMainBlock&&(e.isSetAsMainBlock=(0,n.isChecked)(this.editAddressPlaceSetAsMainBlock)),e}onDragMarker(e,t){this.geocodeCurrentLatLon(t.location)}initMapBox(){var e=cur.mapProvider,t=cur.mapProviders,i="place_map_"+e;for(var o in this.box.showProgress(),t)if(t[o]){var a=t[o];o!=e&&isArray(a)&&(0,r.isVisible)("place_map_"+a)&&(0,r.hide)("place_map_"+a),(0,r.isVisible)("place_map_"+e)||(0,r.show)(i)}var n={provider:e,lngcode:(0,s.getLang)("wall_google_maps_lang")};this.map=new window.vkMaps.VKMap(i,n),this.map.isLoaded(e)?this.onMapLoadHandler():this.map.load.addHandler(this.onMapLoadHandler,this)}initNewAddress(){this.showNewAddress(),this.needInitMap=!0,this.initMapBox(),this.initCreateStep(),this.nextCreateStep()}showNewAddress(){this.isEditScreen=!1,(0,r.hide)("edit_address"),(0,r.hide)("edit_timetable"),(0,r.show)("groups_edit_address_select_new"),(0,r.hide)("public_place_map"),this.placeSelector.val(""),this.box.setButtons((0,s.getLang)("global_continue"),(()=>{this.geocodeCurrentLatLon();var e=u(this.placeSelector.val_full(),2)[1];e&&(0,r.val)(this.editAddressPlaceTitle,e),this.nextCreateStep()}),(0,s.getLang)("global_cancel")),this.placeSelector.focus()}getGeocoderStringAndUpdate(){var e=this.getAddress();this.needUpdatePlaceSelector=!0,this.geocoder.geocode({address:e.geocoderString})}countrySelectorEditOnChange(e){this.isEditScreen&&(this.countrySelector.val(e,!0),this.getGeocoderStringAndUpdate(),(0,r.val)(this.editAddressPlaceAddress,""))}citySelectorEditOnChange(e){this.isEditScreen&&(this.citySelector.receivedData=this.citySelectorEdit.receivedData,this.citySelector.val(e,!0),this.getGeocoderStringAndUpdate(),(0,r.val)(this.editAddressPlaceAddress,""))}countrySelectorOnChange(e){this.isEditScreen||this.countrySelectorEdit.val(e,!0),this.getGeocoderStringAndUpdate()}citySelectorOnChange(e){this.isEditScreen||(this.citySelectorEdit.receivedData=this.citySelector.receivedData,this.citySelectorEdit.val(e,!0)),this.getGeocoderStringAndUpdate()}placeSelectorOnChange(e){if(e<=0)return!1;var t=u(this.placeSelector.val_full(),6),i=t[2],o=t[3],r=t[4],s=t[5];this.updateMapAndPlaceSelector(i,o),this.setEditAddress(r,s),this.selectedPlaceId=(0,a.intval)(e),this.curAddress=this.getAddress(),this.nextCreateStep()}isAddressValid(e){return e.countryId?e.cityId?!e.title||e.title.length>255?((0,n.notaBene)(this.editAddressPlaceTitle),!1):!e.address||e.address.length>255?((0,n.notaBene)(this.editAddressPlaceAddress),!1):!(e.additional.length>=400)||((0,n.notaBene)(this.editAddressPlaceAdd),!1):((0,n.notaBene)(this.citySelectorEdit.container),this.citySelectorEdit.input.focus(),!1):((0,n.notaBene)(this.countrySelectorEdit.container),this.countrySelectorEdit.input.focus(),!1)}boxSavePlace(e){if(!(0,r.isVisible)(this.box.progress)&&!(0,n.isButtonLocked)(e)){var t={};t.id=cur.groupId,t.hash=this.saveHash;var i=this.getAddress();if(!this.isAddressValid(i))return!1;t.title=i.title,t.address=i.address,t.additional=i.additional,t.country_id=i.countryId,t.city_id=i.cityId,t.lat=i.lat,t.lon=i.lon,t.place_id=i.placeId?i.placeId:0,i.metroId&&(t.metro_id=i.metroId),t.act="save_address",this.addressId&&(t.address_id=this.addressId),i.hasOwnProperty("isMain")&&(t.is_main=i.isMain),i.hasOwnProperty("isSetAsMainBlock")&&(t.main_section=i.isSetAsMainBlock),i.phone&&(t.phone_0=i.phone);var o=(0,d.collectAddress)(this.box.bodyNode);if(!1===o)return!1;var s=u(o,2)[1];Object.keys(s).forEach((e=>{t[e]=s[e]})),t.is_inline=+this.isInline,ajax.post("groupsedit.php",t,{onDone:this.onSaveDone.bind(this),showProgress:n.lockButton.pbind(e),hideProgress:n.unlockButton.pbind(e)})}}onSaveDone(e){if(e.status||!e.errors)if(this.isChanged=!1,this.box.hide(),this.isInline)this.onSaveHandler&&this.onSaveHandler(e);else{var t=e.address_id,i=e.address_edit_html,o=e.main_address_id,a=void 0===o?null:o;window.GroupsEdit.invalidateBack();var n=ge("groups_edit_address_block_"+t);if(n){var h="<b>"+(0,s.getLang)("global_changes_saved")+"</b><br/>"+(0,s.getLang)("groups_address_edit_edit_address_success");window.GroupsEdit.showMessage(h),(0,r.domReplaceEl)(n,i),a&&window.GeAddresses.setMainAddressId(a)}else{var c="<b>"+(0,s.getLang)("global_changes_saved")+"</b><br/>"+(0,s.getLang)("groups_address_edit_add_address_success");window.GroupsEdit.showMessage(c);var p=(0,r.domLC)(ge("group_edit_addresses_edit_list"));p?(0,r.domInsertAfter)((0,r.se)(i),p):(ge("group_edit_addresses_edit_list").appendChild((0,r.se)(i)),(0,r.hide)("groups_edit_empty_placeholder")),(0,l.scrollToY)((0,r.getXY)(ge("groups_edit_address_block_"+t))[1],400),this.setCount(1)}}else{var u=e.errors;Object.keys(u).forEach((e=>{var t=u[e];if(t)if("phone"===e){var i=ge("address_phone");(0,d.showAlert)(i,t)}else if(e.match("time")){var o=e.replace("time",""),s=ge("group_edit_addresses_timetable"),a=(0,r.geByClass1)("timetable_"+o,s),n=(0,r.geByClass1)("time_close",a);(0,d.showAlert)(n,t)}}))}}showEditAddress(){this.isEditScreen=!0,(0,r.hide)("groups_edit_address_select_new"),(0,r.hide)("edit_timetable"),(0,r.show)("edit_address"),(0,r.show)("public_place_map"),2!==this.createEndStep?this.box.setButtons((0,s.getLang)("global_continue"),this.nextCreateStep.bind(this),(0,s.getLang)("global_back"),this.prevCreateStep.bind(this)):this.box.setButtons((0,s.getLang)("global_save"),this.boxSavePlace.bind(this),(0,s.getLang)("global_back"),this.prevCreateStep.bind(this)),this.box.updateBoxCoords()}showEditTimetable(){(0,r.hide)("groups_edit_address_select_new"),(0,r.hide)("edit_address"),(0,r.hide)("public_place_map"),(0,r.show)("edit_timetable"),this.box.setButtons((0,s.getLang)("global_save"),this.boxSavePlace.bind(this),(0,s.getLang)("global_back"),this.prevCreateStep.bind(this)),this.box.updateBoxCoords()}initCreateStep(){(0,a.isUndefined)(this.createStep)&&(this.createEndStep=this.needShowTimetable()?3:2,this.createStep=0,this.createStepNode=(0,r.ce)("span"),this.createStepNode.classList.add("address_create_step"),this.box.controlsTextNode.appendChild(this.createStepNode))}nextCreateStep(){++this.createStep,this.updateCreateStep()}prevCreateStep(){--this.createStep,this.updateCreateStep()}updateCreateStep(){if(this.createStep>=2&&(this.isChanged||(this.isChanged=!0)),1===this.createStep)this.showNewAddress();else if(2===this.createStep)this.showEditAddress();else if(3===this.createStep){var e=this.getAddress();if(!this.isAddressValid(e))return--this.createStep,!1;this.showEditTimetable()}this.createStepNode.innerHTML=(0,s.getLang)("groups_edit_address_create_step").replace("{curr}",this.createStep.toString()).replace("{end}",this.createEndStep.toString()),1!==this.createStep?this.box.setBackTitle((()=>this.prevCreateStep())):(0,r.geByClass1)("box_title",this.box.titleWrap).innerHTML=(0,s.getLang)("groups_edit_new_address_time_box_title"),this.box.updateBoxCoords()}needShowTimetable(){return!(0,r.hasClass)("page_add_place_box","group_event")}}},91502:(e,t,i)=>{i.d(t,{default:()=>d});i(530522),i(66108),i(296253),i(991181),i(579665),i(95767),i(751876),i(21466);var o=i(917685),r=i(442699),s=i(901260);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}class d{constructor(e){var t=e.element;this.props={element:t},addEvent(t,"keyup",this.onKeyUp.bind(this)),addEvent(t,"keypress",this.onKeyPressed.bind(this)),addEvent(t,"paste drop",this.onPaste.bind(this)),addEvent(t,"blur",this.onBlur.bind(this))}isValid(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.element.value).match(/^(\d{1,2})(:(\d{1,2})?)?$/)}onKeyUp(e){var t=this.props.element,i=Number(e.keyCode);if(i===KEY.BACKSPACE||i===KEY.DELETE)return!0;if(t.value.match(/^(\d{3,})$/)&&(t.value=t.value.substring(0,2)+":"+t.value.substring(2)),!this.isValid()){var o=a(t.value.split(":"),2),r=o[0],s=o[1],n=void 0===s?null:s,d=t.selectionStart;t.value=r.substr(0,2),n&&n.length&&(t.value+=":"+n.substr(0,2)),t.selectionStart=d,t.selectionEnd=d}return!0}onKeyPressed(e){var t,i=this.props.element,r=0;if(null!=e.charCode?r=e.charCode:null!=e.which?r=e.which:null!=e.keyCode&&(r=e.keyCode),!r)return!0;var s=i.value.indexOf(":");if(s<=2){var n=i.value.substring(0,i.selectionStart)+i.value.substring(i.selectionEnd),d=a(n.split(":"),2),l=d[0],h=d[1],c=void 0===h?null:h,p=l.length,u=null!==c?c.length:0;if(t=String.fromCharCode(r),n.length<5&&t.match(/\d|:/))if(":"===t){if(-1===s)return!0}else{var _=-1===s||s>=i.selectionStart;if(_&&(p<2||-1===s))return!0;if(!_&&u<2)return!0}if(e.altKey||e.ctrlKey||e.metaKey||r<28)return!0}return(0,o.cancelEvent)(e),!1}onPaste(e){var t=this.props.element,i="paste"===e.type?"clipboardData":"drop"===e.type?"dataTransfer":null;if(i){var s=e[i]||e.originalEvent&&e.originalEvent[i];if(s&&s.types&&s.getData){(0,o.cancelEvent)(e);var a=(0,r.clean)(s.getData("text/plain")),n=t.value.substring(0,t.selectionStart)+a+t.value.substring(t.selectionEnd);this.isValid(n)&&(t.value=n)}}}onBlur(){var e=a(this.props.element.value.split(":"),2),t=e[0],i=void 0===t?null:t,o=e[1],r=void 0===o?null:o;i=Number(i),r=Number(r),i&&i>23&&(i=23,r=59),r&&r>59&&(r=59),this.setValue(i,r)}setValue(e,t){var i=this.props.element,o="";null===e&&null===t&&(e=0,t=0),null!==e&&(o+=`${e}`),null!==t&&(o+=`:${(0,s.padStart)(t,2,"0")}`),i.value=o}}},901260:(e,t,i)=>{i.d(t,{collectAddress:()=>h,showAlert:()=>p,padStart:()=>u});i(530522),i(66108),i(579665),i(95767),i(751876),i(991181),i(296253);var o=i(705456),r=i(414914),s=i(719016),a=i(917685),n=i(442699);function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function h(e){var t=e=>e.filter(Boolean).join("_"),i={},s=(0,r.attr)(e,"data-address-id"),a=(0,n.intval)(s),d=t(["groups_edit_g_address_timetable_select",a,"input"]),l=ge(d);if(!l)return!1;var h=(0,n.intval)((0,r.val)(l));i["workday_type_"+a]=h;var p=t(["address_phone",a]),u=ge(p);u&&(i["phone_"+a]=(0,r.val)(u));var _=t(["group_edit_addresses_timetable",a]),v=ge(_);if(2===h&&(0,r.isVisible)(v)){var g={},m=(0,r.geByClass)("timetable_day",v),w={};m.forEach((e=>{var t=(0,r.geByClass1)("timetable_checkbox",e),i=t&&(0,o.isChecked)(t)?1:0,s=(0,r.attr)(e,"data-day-id");if(w[s]=e,g["is_wday_"+s]=i,i){var a=(0,r.geByClass1)("time_open",e);c(a,s),w["time_open_"+s]=a,a&&(g["time_open_"+s]=(0,r.val)(a));var n=(0,r.geByClass1)("time_close",e);c(n,s),w["time_close_"+s]=n,n&&(g["time_close_"+s]=(0,r.val)(n));var d=(0,r.geByClass1)("timetable_break",e);if((0,r.isVisible)(d)){g["is_bday_"+s]=1;var l=(0,r.geByClass1)("time_break_start",e);c(l,s),w["time_break_start_"+s]=l,l&&(g["time_break_start_"+s]=(0,r.val)(l));var h=(0,r.geByClass1)("time_break_end",e);c(h,s),w["time_break_end_"+s]=h,h&&(g["time_break_end_"+s]=(0,r.val)(h))}else g["is_bday_"+s]=0}})),g&&Object.keys(g).forEach((e=>{i[e+"_"+a]=g[e]}))}return[a,i]}function c(e,t){var i,o,s,a,n,l=(0,r.val)(e);(i=d(l.split(":"),2),o=i[0],s=i[1],a=parseInt(o),n=parseInt(s),60*a+n)>=1440&&(0,r.val)(e,"23:59")}function p(e,t){!function(e,t){var i,n="INPUT"===e.tagName,d=e;(!n&&(i=(0,r.geByClass1)("selector_table",e))||!n&&(i=(0,r.geByClass1)("radiobtn",e)))&&(d=i);var l=function(){(0,s.showTooltip)(d,{text:t,dir:"left",width:300,typeClass:"ij_tt",shift:[-(0,r.getSize)(d)[0]-15,-(0,r.getSize)(d)[1]/2+2],hasover:1,nohideover:1,onCreate:function(){(0,a.removeEvent)(d,"mouseout"),n&&(d.onblur=function(){d.tt&&d.tt.hide&&d.tt.hide()})}})};n?(e.onfocus=l,(0,o.notaBene)(e)):(l(),each((0,r.geByClass)("selector_table",e),(function(e,t){(0,o.notaBene)(t)})))}(e,t)}function u(e,t,i){return e=String(e),t>>=0,i=String(i||" "),e.length>t?String(e):((t-=e.length)>i.length&&(i+=i.repeat(t/i.length)),i.slice(0,t)+String(e))}},497803:(e,t,i)=>{i.d(t,{COVER_UPLOAD_CROP_WIDTH:()=>o,COVER_UPLOAD_WIDTH:()=>r,MainCoverUploadEvents:()=>s,COVER_UPLOAD_CROP_IMG_ID:()=>a,COVER_UPLOAD_SIZE:()=>n,COVER_CROP_DONE_BUTTON:()=>d,COVER_CROP_RATIO:()=>l,COVER_BIG_CROP_RATIO:()=>h});var o=845,r=655,s={onEditStart:"edit_start",onCropSuccess:"crop_success",onUploadStart:"upload_start",onDragOut:"drag_out",onDragEnter:"drag_enter",onUploadError:"upload_error"},a="owner_photo_img",n=26214400,d="owner_photo_done_edit",l=3.975,h=3},125935:(e,t,i)=>{i.d(t,{default:()=>c});var o=i(414914),r=i(791563),s=i(917685),a=i(705456),n=i(661929),d=i(655768),l=i(497803),h="loading";class c{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.groupId=e,this.reUploadCoverId=0,this.liveCoverPosition=-1,this.box={},this.onCoverSaveCallback=t,this.onShowCallback=i,this.onDestroyCallback=o}showBox(){var e={id:this.groupId,act:"edit_box"},t={containerClass:"groups_cover_box",params:{hideButtons:!0,width:655},onDone:this.onShowBoxDone.bind(this)};this.onDestroyCallback&&(t.params.onDestroy=this.onDestroyCallback),(0,r.showBox)("groupsedit_cover.php",e,t)}onShowBoxDone(e,t){this.box=e,this.headerEl=(0,o.domQuery1)("#groups_edit_cover_header",this.box.bodyNode),this.contentEl=(0,o.domQuery1)("#groups_edit_cover_wrap",this.box.bodyNode),this.mainCoverEl=(0,o.domQuery1)("#groups_edit_cover_wrap_main_wrap",this.box.bodyNode),this.mainCoverEditEl=(0,o.domQuery1)("#groups_edit_cover_wrap_main_edit",this.box.bodyNode),this.mainCoverImgEl=(0,o.domQuery1)("#groups_edit_cover_wrap_main_edit_img",this.box.bodyNode),this.mainCoverCropEl=(0,o.domQuery1)("#owner_photo_edit",this.box.bodyNode),this.mainCoverUploadEl=(0,o.domQuery1)("#groups_edit_cover_wrap_main_input",this.box.bodyNode),this.mainCoverUploadPlaceholder=(0,o.domQuery1)("#groups_edit_cover_wrap_main_wrap_btn",this.mainCoverEl),this.liveWrapEl=(0,o.domQuery1)("#groups_edit_cover_wrap_live",this.box.bodyNode),this.initEvents(t),this.onShowCallback&&this.onShowCallback()}onMainCoverUploadStart(){hide(this.mainCoverEditEl),show(this.mainCoverEl),(0,o.addClass)(this.mainCoverEl,h)}onMainCoverDragEnter(){hide(this.mainCoverUploadPlaceholder)}onMainCoverDragOut(){show(this.mainCoverUploadPlaceholder)}onMainCoverUploadError(){(0,o.removeClass)(this.mainCoverEl,h),attr(this.mainCoverImgEl,"src")&&(show(this.mainCoverEditEl),hide(this.mainCoverEl))}initEvents(e){var t=(0,o.domQuery1)(".groups_edit_cover_close",this.box.bodyNode);t&&(0,s.addEvent)(t,"click",(()=>{this.box.hide()}));var i=this.getMainCoverEmitter();this.uploadMain=new n.default(this.groupId,this.mainCoverUploadEl,(0,o.domQuery1)("#owner_photo_thumb",this.mainCoverCropEl),e.upload,i),[(0,o.domQuery1)(".groups_edit_cover_wrap_main_a",this.box.bodyNode),(0,o.domQuery1)(".upload",this.mainCoverEditEl)].forEach((e=>{(0,s.addEvent)(e,"click",(e=>{(0,o.geByTag1)("button",this.mainCoverUploadEl).click()}))}));var r=(0,o.domQuery1)(".delete",this.mainCoverEditEl);r&&(0,s.addEvent)(r,"click",(()=>{var e=(0,o.domData)(r,"hash");Page.deleteOwnerCover(-this.groupId,e,this.onMainCoverDelete.bind(this))}));var l=(0,o.domQuery1)(".edit",this.mainCoverEditEl);l&&(0,s.addEvent)(l,"click",(()=>{this.uploadMain.edit(!1)}));var h=(0,o.domQuery1)("#groups_edit_cover_wrap_live_upload_input",this.contentEl);if(h&&(0,s.addEvent)(h,"change",(()=>{this.onFileChange(h)})),this.liveWrapEl){this.liveWrapToDrag=(0,o.domQuery1)("#live_covers_to_drag",this.box.bodyNode);var c=new EventEmitter;c.on(d.LiveCoverUploadEvents.onError,this.onUploadErrorLiveCover.bind(this)),c.on(d.LiveCoverUploadEvents.onDidUploaded,this.onDidUploadedLiveCover.bind(this)),c.on(d.LiveCoverUploadEvents.onStart,this.onUploadStartLiveCover.bind(this));var p=this.getLiveCoversCount();this.uploadLive=new d.default(this.groupId,this.liveWrapEl,e.uploadStoryHash,e.saveStoryHash,c,p),this.liveInputEl=(0,o.domQuery1)("#groups_edit_cover_wrap_live_upload_input",this.box.bodyNode),(0,s.addEvent)(this.liveWrapEl,"dragenter dragover",this.dragDidEnter.bind(this)),(0,s.addEvent)(this.liveWrapEl,"dragleave",this.dragDidLeave.bind(this)),(0,s.addEvent)(this.liveWrapEl,"drop",this.dragDidDrop.bind(this)),this.reorderHash=e.reorderHash,this.deleteHash=e.deleteHash,this.initSorter(),this.initLiveCoverEvents()}var u=(0,o.domQuery1)("#groups_edit_cover_scalable",this.contentEl);u&&(0,s.addEvent)(u,"click",(e=>{var t=(0,o.domData)(u,"hash");this.setScalable(u,t)}));var _=(0,o.domQuery1)("#owner_photo_done_edit",this.mainCoverCropEl);_&&(0,s.addEvent)(_,"click",(e=>{(0,a.lockButton)(_),this.editDone(),(0,a.unlockButton)(_)}));var v=(0,o.domQuery1)("#owner_photo_upload_return",this.mainCoverCropEl);v&&(0,s.addEvent)(v,"click",(e=>{this.uploadReturn()}))}getMainCoverEmitter(){var e=new EventEmitter;return e.on(l.MainCoverUploadEvents.onEditStart,this.onMainCoverEdit.bind(this)),e.on(l.MainCoverUploadEvents.onCropSuccess,this.onMainCoverSave.bind(this)),e.on(l.MainCoverUploadEvents.onUploadStart,this.onMainCoverUploadStart.bind(this)),e.on(l.MainCoverUploadEvents.onDragEnter,this.onMainCoverDragEnter.bind(this)),e.on(l.MainCoverUploadEvents.onDragOut,this.onMainCoverDragOut.bind(this)),e.on(l.MainCoverUploadEvents.onUploadError,this.onMainCoverUploadError.bind(this)),e}initLiveCoverEvents(){(0,o.domQuery)("#live_covers_for_drag .groups_edit_cover_wrap_live_upload_placeholder_enabled",this.box.bodyNode).forEach((e=>{(0,s.removeEvent)(e,"click"),(0,s.addEvent)(e,"click",(t=>{var i=(0,o.domData)(e,"pos");this.liveCoverUpload(t,i)}))})),(0,o.domQuery)("#live_covers_to_drag .groups_edit_cover_wrap_live_upload",this.box.bodyNode).forEach((e=>{var t=(0,o.domQuery1)(".delete",e);(0,s.removeEvent)(t,"click"),(0,s.addEvent)(t,"click",(e=>{this.liveCoverDelete(e)}));var i=(0,o.domQuery1)(".upload",e);(0,s.removeEvent)(i,"click"),(0,s.addEvent)(i,"click",(e=>{this.liveCoverChange(e)}))}))}onMainCoverEdit(){hide(this.contentEl),hide(this.headerEl),show(this.mainCoverCropEl),(0,o.removeClass)(this.mainCoverEl,h),this.box.setOptions({width:l.COVER_UPLOAD_CROP_WIDTH})}onMainCoverSave(e,t){if(attr(this.mainCoverImgEl,"src",e),hide(this.mainCoverCropEl),hide(this.mainCoverEl),this.box.setOptions({width:l.COVER_UPLOAD_WIDTH}),show(this.contentEl),show(this.headerEl),show(this.mainCoverEditEl),this.box.updateBoxCoords(),this.uploadMain.isAvailableBigCover()){this.contentEl.classList.contains("groups_edit_cover_wrap--big")||this.contentEl.classList.add("groups_edit_cover_wrap--big");var i=(0,o.domQuery1)(".PageCover");i&&!i.classList.contains("PageCover--big")&&i.classList.add("PageCover--big")}this.onCoverSaveCallback&&this.onCoverSaveCallback()}onMainCoverDelete(){window.curBox().hide(),hide(this.mainCoverEditEl),show(this.mainCoverEl),attr(this.mainCoverImgEl,"src","")}onFileChange(e){this.uploadLive.pushFiles(e.files,this.liveCoverPosition),this.liveCoverPosition=-1}liveCoverUpload(e,t){this.liveInputEl.click()}liveCoverDelete(e){(0,s.cancelEvent)(e);var t=e.target,i=(0,o.domData)(t,"cover-id");this.deleteLiveCover(i,t)}deleteLiveCover(e,t){if(this.deleteLock||(this.deleteLock=[]),this.deleteLock[e])return!1;var i={};return t&&(i={onDone:this.onLiveCoverDelete.bind(this,t),showProgress:()=>this.deleteLock[e]=!0,hideProgress:()=>this.deleteLock[e]=!1}),ajax.post("groupsedit_cover.php",{act:"a_delete_live",id:this.groupId,cover_id:e,hash:this.deleteHash},i),!1}liveCoverChange(e){(0,s.cancelEvent)(e);var t=e.target,i=(0,o.domData)(t,"cover-id");this.reUploadCoverId=i;var r=this.getCoverPosition(i);this.liveCoverPosition=r,this.liveInputEl.click()}onLiveCoverDelete(e){var t=domPN(domPN(domPN(e))),i=(0,o.geByTag1)("img",t);(0,o.removeClass)(t,"edit"),this.getLiveCoversCount()<4?(0,o.addClass)(t,"disabled"):(0,o.removeClass)(t,"disabled"),attr(i,"src","");var r=t.cloneNode(!0);re(t),(0,o.domQuery1)("#live_covers_for_drag",this.box.bodyNode).appendChild(r),this.uploadLive.setCurFilesCount(this.getLiveCoversCount()),this.initSorter(),this.initLiveCoverEvents()}editDone(){this.uploadMain.cropDone()}uploadReturn(){hide(this.mainCoverCropEl),hide(this.mainCoverEl),this.box.setOptions({width:l.COVER_UPLOAD_WIDTH}),show(this.contentEl),show(this.headerEl),hide(this.mainCoverEditEl),""==attr(this.mainCoverImgEl,"src")?(show(this.mainCoverEl),hide(this.mainCoverEditEl),show(this.mainCoverUploadPlaceholder)):(hide(this.mainCoverEl),show(this.mainCoverEditEl)),this.box.updateBoxCoords()}initSorter(){if(this.getLiveCoversCount()<=1)return!1;var e={canDrag:!0,clsUp:"groups_edit_cover_wrap_live_upload_preview_drag",onReorder:this.onReorder.bind(this)};window.usorter.init("live_covers_to_drag",e)}onReorder(){if(!this.saveReorderLock){var e=(0,o.domQuery1)("#live_covers_to_drag",this.box.bodyNode),t=(0,o.geByClass)("groups_edit_cover_wrap_live_upload",e).map((e=>(0,o.domData)(e,"cover-id")));ajax.post("groupsedit_cover.php",{act:"a_reorder_live",id:this.groupId,hash:this.reorderHash,covers:t},{showProgress:()=>this.saveReorderLock=!0,hideProgress:()=>this.saveReorderLock=!1})}}getLiveLoadedCover(){var e=(0,o.domQuery)(".groups_edit_cover_wrap_live_upload",this.liveWrapEl);for(var t in e)if(e[t]){var i=e[t];if((0,o.hasClass)(i,h))return i}return!1}getCoverPosition(e){var t=(0,o.domQuery)(".groups_edit_cover_wrap_live_upload",this.liveWrapEl);for(var i in t)if(t[i]){var r=t[i];if(e&&(0,o.domData)(r,"cover-id")==e)return parseInt(i)+1}return!1}getCoverWrapByCoverId(e){var t=(0,o.domQuery)(".groups_edit_cover_wrap_live_upload",this.box.bodyNode);for(var i in t)if(t[i]){var r=t[i];if((0,o.domData)(r,"cover-id")==e)return r}return!1}getNearestLiveCover(e){isUndefined(e)&&(e=0);var t=(0,o.domQuery)(".groups_edit_cover_wrap_live_upload:not(.edit)",this.box.bodyNode);return!!t[e]&&t[e]}onUploadErrorLiveCover(e,t){if(!t){var i=this.getLiveLoadedCover();(0,o.removeClass)(i,h),(0,o.removeClass)(i,"disabled")}return(0,r.showFastBox)(getLang("global_error"),e)}onDidUploadedLiveCover(e){var t,i=e.story.preview;t=this.reUploadCoverId?this.getCoverWrapByCoverId(this.reUploadCoverId):this.getNearestLiveCover();var r=(0,o.geByTag1)("img",t);(attr(r,"src",i),(0,o.removeClass)(t,h),(0,o.addClass)(t,"edit"),e.story.isVideo)?((0,o.addClass)(t,"video"),(0,o.removeClass)(t,"photo"),e.story.isProcessing&&(0,o.addClass)(t,"processing"),(0,o.geByClass1)("page_cover_action",(0,o.geByClass1)("video_size",t)).innerHTML=e.story.videoDuration):((0,o.removeClass)(t,"video"),(0,o.addClass)(t,"photo"));if((0,o.addClass)(t,"edit"),(0,o.domData)(t,"cover-id",e.storyRaw),(0,o.domData)((0,o.geByClass1)("upload",t),"cover-id",e.storyRaw),(0,o.domData)((0,o.geByClass1)("delete",t),"cover-id",e.storyRaw),!this.reUploadCoverId){var s=t.cloneNode(!0);re(t),this.liveWrapToDrag.appendChild(s),t=this.getNearestLiveCover(),(0,o.removeClass)(t,"disabled"),this.uploading=!1,this.uploadLive.setCurFilesCount(this.getLiveCoversCount()),this.initSorter()}this.reUploadCoverId=0,this.initLiveCoverEvents()}onUploadStartLiveCover(e){var t;this.reUploadCoverId?(t=this.getCoverWrapByCoverId(this.reUploadCoverId),(0,o.removeClass)(t,"edit")):t=this.getNearestLiveCover(e),(0,o.removeClass)(t,"disabled"),(0,o.addClass)(t,h)}dragDidEnter(e){return e.dataTransfer&&(e.dataTransfer.items&&e.dataTransfer.items.length>0&&"file"===e.dataTransfer.items[0].kind||e.dataTransfer.types&&e.dataTransfer.types.indexOf("Files")>-1)&&(clearTimeout(this.DragLeaveTimer),(0,o.addClass)(this.liveWrapEl,"drop")),(0,s.cancelEvent)(e)}dragDidLeave(e){return clearTimeout(this.DragLeaveTimer),this.DragLeaveTimer=setTimeout((()=>{(0,o.removeClass)(this.liveWrapEl,"drop")}),100),(0,s.cancelEvent)(e)}dragDidDrop(e){return this.dragDidLeave(e),e&&e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0&&this.uploadLive.pushFiles(e.dataTransfer.files),(0,s.cancelEvent)(e)}getLiveCoversCount(){var e=(0,o.geByClass)("edit",(0,o.domQuery1)("#live_covers_to_drag",this.box.bodyNode)),t=0;return e&&(t=e.length),t}setScalable(e,t){this.saveScalableLock||(this.saveScalableLock=!0,(0,a.checkbox)(e),ajax.post("groupsedit_cover.php",{act:"a_save_scalable",id:this.groupId,hash:t,scalable:(0,a.isChecked)(e)?1:0},{showProgress:()=>this.saveScalableLock=!0,hideProgress:()=>this.saveScalableLock=!1}))}}},655768:(e,t,i)=>{i.d(t,{LiveCoverUploadEvents:()=>s,default:()=>a});var o=i(852557),r=i(697606),s={onDidUploaded:"onUpload",onProgress:"onProgress",onStart:"onStart",onError:"onError"};class a{constructor(e,t,i,o,r,s){this.groupId=e,this.wrapEl=t,this.uploadHash=i,this.saveHash=o,this.emitter=r,this.filesCount=s}setCurFilesCount(e){this.filesCount=e}onDidUploaded(e){this.emitter.emit(s.onDidUploaded,e)}onDidProgress(e){this.emitter.emit(s.onProgress,e)}onDidFailed(e){this.emitter.emit(s.onError,getLang("groups_live_covers_error_upload_file_error"))}pushFiles(e,t){var i=!1;if(t>0&&(i=!0),e.length+this.filesCount>5&&!i)return this.emitter.emit(s.onError,getLang("groups_live_covers_error_upload_max_count_files")),!1;for(var a=0;a<e.length;a++){var n=e[a];if(n.size>31457280)this.emitter.emit(s.onError,getLang("groups_live_covers_error_upload_max_size"),!0);else{var d=new EventEmitter;d.on(o.UploaderEvents.didUploaded,this.onDidUploaded.bind(this)),d.on(o.UploaderEvents.didProgress,this.onDidProgress.bind(this)),d.on(o.UploaderEvents.didFailed,this.onDidFailed.bind(this));var l=new r.default(this.groupId,this.uploadHash,this.saveHash,n,d,1);this.emitter.emit(s.onStart,a),l.start(t)}}}}},661929:(e,t,i)=>{i.d(t,{default:()=>d});i(530522),i(991181),i(579665),i(95767),i(59357),i(66108),i(296253),i(21466);var o=i(705456),r=i(497803),s=i(791563);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}class d{constructor(e,t,i,o,s){this.emitter=s,this.groupId=e,this.thumbId=i,this.uploadOptions=this._getCoverUploadOptions(o,t),this.uploadEl=t,this.editOptions={},this.newEditOptions={},this.curEditOptions={},o.crop_options&&(this.editOptions=o.crop_options),this.mainCoverUpload=Upload.init(t,o.url,{},this.uploadOptions),this.coverCropDoneBtn=ge(r.COVER_CROP_DONE_BUTTON)}onUploadComplete(e,t,i){var o=window.parseJSON(t)||{};if(o.error)return this.showError(o.error),!1;var r=this._getCoverCropUrl(t),s=o.x_src;o.x_src.startsWith("http")||(s=this.uploadOptions.static_url+s);var a={thumb:s,thumbSize:o.x_size,size:o.size,uploadUrl:r};this.edit(!0,!0,a)}edit(e,t,i){if(!this.ownerPhotoThumb||t){var o=this.editOptions;isUndefined(i)||(o=i),this.curEditOptions=o,this.setCropWrap(o),this.ownerPhotoThumb=ge(r.COVER_UPLOAD_CROP_IMG_ID),window.stManager.add(["tagger.css",jsc("web/tagger.js")],this.initTagger.bind(this,o,e))}this.emitter.emit(r.MainCoverUploadEvents.onEditStart)}setCropWrap(e){var t=this.thumbId;toggleClass(t,"no_rotate");var i=this._getCropImageDiv(e);val(t,i)}initTagger(e,t){var i=this._getThumbOpts(e,t);this.ownerPhotoEditTagger&&this.ownerPhotoEditTagger.destroy(),this.ownerPhotoEditTagger=window.photoTagger(this.ownerPhotoThumb,i)}onCropSuccess(e,t,i){this.emitter.emit(r.MainCoverUploadEvents.onCropSuccess,i)}cropDone(){var e=this.ownerPhotoEditTagger.result(),t=this.curEditOptions,i=t.size[0]/t.thumbSize[0],r=t.size[1]/t.thumbSize[1],s=[Math.floor(e[0]*i),Math.floor(e[1]*r),Math.ceil(e[2]*i),Math.ceil(e[3]*r)],a=this.cropSuccess.bind(this,!0),n=t.uploadUrl+"&_full="+encodeURIComponent(s.join(","))+"&_rot=0";(0,o.lockButton)(this.coverCropDoneBtn),clearTimeout(this.ownerPhotoCropTimer),this.ownerPhotoCropTimer=setTimeout(this.cropSuccess.bind(this,!0,'{"error":"ERR_CLIENT_UPLOAD_TIMEOUT: no response on owner_photo_crop iframe request"}'),1e4),this.editOptions=t,window.stManager.add([jsc("web/upload.js")],(()=>{var e=[0,0,s[2]],t=window.jsonpManager.reg(a);window.utilsNode.appendChild(ce("iframe",{src:n+"&_crop="+e.join(",")+"&_jsonp="+t+"&_origin="+encodeURIComponent(locProtocol+"//"+locHost)}))}))}cropSuccess(e,t){if(!0!==e&&(t=e,e=!1),clearTimeout(this.ownerPhotoCropTimer),(window.parseJSON(t)||{}).error)return(0,o.unlockButton)(this.coverCropDoneBtn),console.log("done_edit error"),!1;var i={showProgress:o.lockButton.pbind(this.coverCropDoneBtn),hideProgress:o.unlockButton.pbind(this.coverCropDoneBtn),onDone:this.onCropSuccess.bind(this),onFail:this.onCropFail.bind(this)};ajax.post("al_page.php",{act:"owner_photo_save",_query:t,from:"groups_edit",gid:this.groupId},i)}onCropFail(e){return this.showError(e),!0}_getCropImageDiv(e){var t=e.thumbSize,i=t?"width: "+t[0]+"px; height: "+t[1]+"px;":"";return`<div id="owner_photo_rotate">\n        <div style="${i}margin: 0px auto;">\n          <img class="owner_photo_img" id="owner_photo_img" src="${e.thumb}" style="${i}"/>\n        </div>\n    </div>`}isAvailableBigCover(){var e,t;return(null===(e=this.editOptions)||void 0===e?void 0:e.hasOwnProperty("cover_big_crop_ratio"))&&this.editOptions.cover_big_crop_ratio||(null===(t=this.uploadOptions)||void 0===t?void 0:t.hasOwnProperty("cover_big_crop_ratio"))&&this.uploadOptions.cover_big_crop_ratio}_getCoverUploadOptions(e,t){var i={file_name:"photo",file_size_limit:r.COVER_UPLOAD_SIZE,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;",clear:1,type:"photo",noFlash:1,max_attempts:3,signed:1,static_url:e.static_url,check_url:e.check_url,base_url:e.base_url,lang:e.lang,dropbox:ge("groups_edit_cover_wrap_main_wrap_drop"),onUploadStart:this.onUploadStart.bind(this),onUploadComplete:this.onUploadComplete.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragOut:this.onDragOut.bind(this)};return(null==e?void 0:e.hasOwnProperty("cover_big_crop_ratio"))&&e.cover_big_crop_ratio&&(i.cover_big_crop_ratio=!0),(null==e?void 0:e.hasOwnProperty("cover_ratio_size_a"))&&e.cover_ratio_size_a&&(i.cover_ratio_size_a=e.cover_ratio_size_a),(null==e?void 0:e.hasOwnProperty("cover_ratio_size_e"))&&e.cover_ratio_size_e&&(i.cover_ratio_size_e=e.cover_ratio_size_e),i}onUploadStart(){this.emitter.emit(r.MainCoverUploadEvents.onUploadStart)}onDragEnter(){this.emitter.emit(r.MainCoverUploadEvents.onDragEnter)}onDragOut(){this.emitter.emit(r.MainCoverUploadEvents.onDragOut)}_getCoverCropUrl(e){return this.uploadOptions.base_url+"upload.php?act=owner_cover_crop&_query="+encodeURIComponent(e)+"&_origin="+encodeURIComponent(window.locProtocol+"//"+window.locHost)}_getThumbOpts(e,t){var i,o=e.size,r=e.thumbSize,s=a(d.getOriginalRatioSize(this.uploadOptions,"a"),2),n=s[0],l=s[1],h=a(d.getOriginalRatioSize(this.uploadOptions,"e"),2),c=h[0],p=h[1],u=[Math.max(c,Math.ceil(n*r[0]/o[0])),Math.max(p,Math.ceil(l*r[1]/o[1]))];if(r[0]<u[0]||r[1]<u[1])return console.log("error"),!1;i=t?this._getRect(e):this._getRectStrict(e);var _=d.getCropRatio(this.uploadOptions);return{minw:u[0],minh:u[1],mina:_,maxa:_,rect:i,zstart:1e3}}static getCropRatio(e){return(null==e?void 0:e.hasOwnProperty("cover_big_crop_ratio"))&&e.cover_big_crop_ratio?r.COVER_BIG_CROP_RATIO:r.COVER_CROP_RATIO}static getOriginalRatioSize(e,t){var i=`cover_ratio_size_${t}`;return(null==e?void 0:e.hasOwnProperty(i))&&e[i]?e[i]:"a"===t?[795,200]:[200,50]}_getRectStrict(e){var t=e.size,i=e.thumbSize;return{left:Math.floor(e.rect[0]*i[0]/t[0]),top:Math.floor(e.rect[1]*i[1]/t[1]),width:Math.ceil(e.rect[2]*i[0]/t[0]),height:Math.ceil(e.rect[3]*i[1]/t[1])}}_getRect(e){var t,i=e.thumbSize,o=d.getCropRatio(this.uploadOptions);return i[1]>=i[0]/o?(t={width:i[0]}).height=Math.ceil(t.width/o):(t={height:i[1]}).width=Math.ceil(t.height*o),t.height>1.5*t.width&&(t.height=Math.floor(1.5*t.width)),t.left=Math.floor((i[0]-t.width)/2),t.top=Math.floor((i[1]-t.height)/2),t}showError(e){e.match(/^ERR_[A-Z0-9_]+(\:|$)/)||(e='ERR_CLIENT_BAD_ERROR: error "'+clean(e.toString())+'"');var t=e.match(/^(ERR_[A-Z0-9_]+)(\:\s*|$)([\S\s]*)\s*$/),i=t[1],o="",n=a(d.getOriginalRatioSize(this.uploadOptions),2),l=n[0],h=n[1];switch(i){case"ERR_UPLOAD_FILE_NOT_SUPPORTED":o=getLang("profile_oph_err_format");break;case"ERR_UPLOAD_FILE_NOT_UPLOADED":o=getLang("profile_oph_err_upload").replace("{link}",'<a href="/support?act=new&from=ph">').replace("{/link}","</a>");break;case"ERR_UPLOAD_BAD_IMAGE_SIZE":o=getLang("groups_cover_photo_error_size").replace("{width}",`${l}`).replace("{height}",`${h}`);break;case"ERR_UPLOAD_BIG_IMAGE_SIZE":o=getLang("groups_cover_big_error_size").replace("{size}","14000");break;case"ERR_STORAGE_ENGINE_NOT_CONNECTED":case"ERR_STORAGE_ENGINE_SAVE_FAILED":o=getLang("profile_oph_error_server");break;default:o=getLang("profile_oph_err_unknown").replace("{link}",'<a href="/support?act=new&from=ph">').replace("{/link}","</a>")}return o=o.replace("{sorry}","<b>"+getLang("global_sorry_error")+"</b>")+'<br><a onclick="OwnerPhoto.detailsError(this);">'+getLang("global_error_details")+'</a><div class="unshown">Error: '+i+(t[3]?". Details: "+t[3]:".")+"</div>",this.emitter.emit(r.MainCoverUploadEvents.onUploadError),(0,s.showFastBox)(getLang("global_error"),o)}}},112125:(e,t,i)=>{i.d(t,{GroupsAdminTips:()=>b});i(530522),i(66108),i(579665),i(95767),i(175115),i(796409),i(991181),i(296253);var o=i(45150),r=i(414914),s=i(491792),a=i(927663),n=i(917685),d=i(442699),l=i(503369),h=i(484426);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}var _="group_admin_tips_reset_new",v="group_admin_tips_stat",g="item",m="section",w="https://vk.cc/businesscalls";class b{static get ITEM_LOAD_AVATAR(){return"load_avatar"}static get ITEM_DESCRIPTION(){return"description"}static get ITEM_MESSAGES(){return"messages"}static get ITEM_LEFT_LINK(){return"left_link"}static get ITEM_SHORT_URL(){return"short_url"}static get ITEM_MAKE_POST(){return"make_post"}static get ITEM_COMMENTS_FILTER(){return"comments_filter"}static get ITEM_CREATE_DISCUSSION(){return"create_discussion"}static get ITEM_ADDRESS(){return"address"}static get ITEM_ACTION_BUTTON(){return"action_button"}static get ITEM_MARKET_ITEM(){return"market_item"}static get ITEM_MICROLANDING(){return"micro_landing"}static get ITEM_EDU_SCHOOL(){return"edu_school"}static get ITEM_EDU_INVITE_USERS(){return"edu_invite_users"}static get ITEM_WEBSITE(){return"website"}static get ITEM_PHONE(){return"phone"}static get ITEM_MAIN_SECTION(){return"main_section"}static get ITEM_INVITE_FRIENDS(){return"invite_friends"}static get ITEM_VKCONNECT(){return"vkconnect"}static init(e,t){if(function(){var e=nav.objLoc.hasOwnProperty("admin_tip");e&&delete nav.objLoc.admin_tip;var t=nav.objLoc.hasOwnProperty("act")&&"group_section_admin_tips"===nav.objLoc.act&&nav.objLoc.hasOwnProperty("from");t&&delete nav.objLoc.from;(e||t)&&nav.setLoc(nav.objLoc)}(),"show"!==t){T("isModer",e);var i=window.cur,o=i.group_id,s=i.groups_admin_tips_stat;T("groupId",o),T("stat",s);var a={},d={};T("statQueue",a),T("statSent",d),T("currentTip",null),T("sendStatQuery",(0,l.debounce)((()=>y(a,d,o,s)),5e3)),T("itemsViewingTimeouts",{}),T("observers",[]);var h=(0,r.ge)("ui_admin_tips_load_more"),c=e=>{(0,n.checkEvent)(e)||(S(),y(a,d,o,s))};h&&(0,n.addEvent)(h,"click",c),window.cur.destroy.push((function(){C(),I(),h&&removeEvent(h,"click",c)})),E()}}static showItem(e,t){var i=function(e){var t=null;switch(e){case b.ITEM_LOAD_AVATAR:t={element:(0,r.ge)("page_avatar_wrap")||(0,r.geByClass1)("page_cover_image"),appendTo:(0,r.ge)("narrow_column"),offset:[16,16],width:190};break;case b.ITEM_DESCRIPTION:t={element:(0,r.ge)("group_edit_desc"),appendTo:(0,r.ge)("wide_column"),forceSide:"bottom",offset:[0,-8]};break;case b.ITEM_MESSAGES:t={element:(0,r.domQuery1)("#group_edit_row_messages .group_edit_labeled"),appendTo:(0,r.ge)("wide_column"),forceSide:"bottom",offset:[0,1]};break;case b.ITEM_LEFT_LINK:var i=(0,r.ge)("page_menu_group_more");if(!i)return null;Page.showMoreActions(i),t={element:(0,r.ge)("page_menu_group_left_menu"),appendTo:(0,r.ge)("narrow_column"),offset:[32,16],width:240};break;case b.ITEM_SHORT_URL:t={element:(0,r.ge)("group_edit_addr_table"),appendTo:(0,r.ge)("wide_column"),forceSide:"bottom",offset:[0,-8]};break;case b.ITEM_MAKE_POST:t={element:(0,r.ge)("submit_post_box"),appendTo:(0,r.ge)("wide_column"),forceSide:"bottom",offset:[0,-8]};break;case b.ITEM_COMMENTS_FILTER:t={element:(0,r.ge)("group_edit_obscene_wrap"),forceSide:"bottom",offset:[0,-8]};break;case b.ITEM_CREATE_DISCUSSION:t={disableTooltip:!0};break;case b.ITEM_ADDRESS:window.hasOwnProperty("GeAddresses")&&window.GeAddresses.toggleAddressesBlock(1),t={element:(0,r.ge)("groups_new_addresses_new"),forceSide:"bottom",offset:[0,-8],appendTo:(0,r.ge)("wide_column")};break;case b.ITEM_ACTION_BUTTON:t={element:(0,r.ge)("groups_edit_g_cta_button"),forceSide:"bottom",offset:[0,-8],appendTo:(0,r.ge)("wide_column")};break;case b.ITEM_MARKET_ITEM:t={element:(0,r.ge)("groups_edit_g_market"),forceSide:"bottom",offset:[0,-8],appendTo:(0,r.ge)("wide_column")};break;case b.ITEM_MICROLANDING:t={disableTooltip:!0};break;case b.ITEM_EDU_SCHOOL:t={element:(0,r.ge)("sel_groups_edit_school_wrap"),forceSide:"bottom",offset:[0,-8],appendTo:(0,r.ge)("wide_column")};break;case b.ITEM_EDU_INVITE_USERS:if(!(0,r.ge)("page_menu_group_invite"))return null;if(!("Groups"in window))return null;t={customAction:function(){return window.Groups.showInviteBox(null,O("groupId")),!0},disableTooltip:!0};break;case b.ITEM_WEBSITE:t={element:(0,r.ge)("group_website"),forceSide:"top",offset:[-32,16],appendTo:(0,r.ge)("wide_column")};break;case b.ITEM_PHONE:t={element:(0,r.ge)("group_edit_phone"),forceSide:"bottom",offset:[0,-4],appendTo:(0,r.ge)("wide_column")};break;case b.ITEM_MAIN_SECTION:t={element:(0,r.geByClass1)("GroupEditMainSection"),forceSide:"bottom",offset:[0,-4]};break;case b.ITEM_INVITE_FRIENDS:t={element:(0,r.ge)("page_menu_group_share"),appendTo:(0,r.ge)("narrow_column"),offset:[0,16]};break;case b.ITEM_VKCONNECT:t={customAction:function(){return window.open(w,"_blank"),!0},disableTooltip:!0}}return t}(e);if(!i)return!1;if(!i.disableTooltip&&!function(e){var t=e.type,i=e.text,d=e.element,l=e.appendTo,h=void 0===l?null:l,p=e.forceSide,u=void 0===p?"left":p,_=e.offset,v=void 0===_?[0,0]:_,g=e.width,m=void 0===g?null:g;if(!d)return!1;if(!h){var w=(0,r.ge)("page_wrap");h=w||d}var b="bottom"===u?o.default.ALIGN_LEFT:o.default.ALIGN_CENTER,f=new o.default(d,{autoShow:!1,appendTo:h,offset:v,content:`<div class="group_edit_admin_tip_show_container">${i}</div>`,type:o.default.TYPE_VERTICAL,onHide:()=>{C()},cls:"feature_intro_tt feature_intro_blue_tt group_edit_admin_tip_show group_edit_admin_tip_show_"+t,forceSide:u,align:b,width:m}),y=0;f&&setTimeout((()=>{f.show(),(0,n.addEvent)(document,"mousedown click",C);var e=f.getContent();if(!(0,s.isElementInViewport)(d)||!(0,s.isElementInViewport)(e)){var t=c((0,r.getXY)(d),2)[1],i=(0,r.getH)(d),o=100;y=400,(0,a.scrollToY)(t-i-o,y)}}),y);return T("currentTip",f),!0}(u({type:e,text:t},i)))return!1;var d=i.customAction?i.customAction:null;return!(!d||!d())||!i.disableTooltip}static hideItem(e,t,i,o){if((0,n.stopEvent)(o),!O("isModer")){var s={id:cur.group_id,type:e,hash:t,act:"group_admin_tips_hide_item",in_admin:i};ajax.post("groupsedit.php",s,{onDone(t){var o=t.result,s=t.html;if(o){if((0,d.isString)(s))if(i){var a=(0,r.ge)("group_edit_admin_tips_counter");a&&s.length&&(0,r.domReplaceEl)(a,(0,d.unclean)(s))}else b.refreshSection(s),I(),E();else i||I();if(i){var n=k(e),l=(0,r.domPN)((0,r.domPN)((0,r.domPN)(n)));if(n)(0,r.re)(n),S(O("itemsViewingTimeouts"),e),(0,r.geByClass)("group_edit_admin_tips_item",l).length||(0,r.re)(l),c=O("groupId"),(0,h.globalHistoryDestroy)(nav.objLoc[0]),c&&((0,h.globalHistoryDestroy)("club"+c),(0,h.globalHistoryDestroy)("event"+c),(0,h.globalHistoryDestroy)("public"+c))}var c}}})}}static isShownItem(e){return!!k(e)}static isShownSection(){return!!(0,r.ge)("admin_tips")}static refreshSection(e){if((0,d.isString)(e)){var t=(0,r.ge)("page_block_group_admin_tips");t&&(e.length?(0,r.domReplaceEl)(t,(0,d.unclean)(e)):(0,r.re)(t))}}static hideSection(e,t,i){if((0,n.stopEvent)(i),!O("isModer")){var o={id:cur.group_id,hash:e,value:t,act:"group_admin_tips_hide_section"},s=(0,r.ge)("page_block_group_admin_tips"),a=(0,r.ge)("page_block_group_admin_tips_cancel");t?(addClass(s,"unshown"),removeClass(a,"unshown")):(addClass(a,"unshown"),removeClass(s,"unshown")),ajax.post("groupsedit.php",o,{onFail(){t?(addClass(a,"unshown"),removeClass(s,"unshown")):(addClass(s,"unshown"),removeClass(a,"unshown"))}})}}static onItemClick(e,t,i,o,r,s,a){f(1,g,{in_admin:s,type:t}),f(2,g,{in_admin:s,type:t}),b.sendCommunityOnboardingTipsStat(t,s),o&&function(e,t){var i=window.cur.group_id;ajax.post("groupsedit.php",{id:i,type:e,hash:t,act:_,onDone(){var t=k(e);t&&removeClass(t,"group_edit_admin_tips_item_new")}})}(t,r);var d=k(t);return(d?Number(attr(d,"data-is-completed-on-click")):0)&&function(e,t){t?(removeClass(e,"group_edit_admin_tips_item_not_completed"),addClass(e,"group_edit_admin_tips_item_completed")):(removeClass(e,"group_edit_admin_tips_item_completed"),addClass(e,"group_edit_admin_tips_item_not_completed"))}(d,!0),b.showItem(t,i)?((0,n.stopEvent)(a),!0):((0,n.checkEvent)(a)?window.open(e,"_blank"):(S(),y(),nav.go(e)),(0,n.stopEvent)(a),!0)}static reset(e,t){(0,n.stopEvent)(t);var i={id:cur.group_id,hash:e,act:"group_admin_tips_reset"};ajax.post("groupsedit.php",i,{onDone(){nav.reload()}})}static sendCommunityOnboardingTipsStat(e,t){var i=window.cur.group_id;ajax.post("groupsedit.php",{act:"community_onboarding_tips_stat",group_id:i,type:e,in_admin:t})}}function f(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=t+"_"+e;i.hasOwnProperty("type")&&(r+="_"+i.type);var s=O("statSent");if(!s||!s.hasOwnProperty(r)){var a=O("statQueue");a[r]={event_type:e,target:t,data:JSON.stringify(i)},o?y():O("sendStatQuery")()}}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O("statQueue"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O("statSent"),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O("groupId"),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:O("stat");if(!e||!Object.keys(e).length)return!0;var r={id:i,hash:o,act:v,items:JSON.stringify(Object.values(e))};ajax.post("groupsedit.php",r),Object.keys(e).forEach((i=>{t[i]=!0,delete e[i]}))}function C(){var e=O("currentTip");e&&(e.hide(),e.destroy(),removeEvent(document,"mousedown click",C),T("currentTip",null))}function E(){if(!O("isModer")&&"IntersectionObserver"in window){var e=O("observers"),t=(0,r.ge)("page_block_group_admin_tips"),i=t?0:1,o=function(e){var t=O("itemsViewingTimeouts");return(i,o)=>{i.forEach((i=>{var r=i.target,s=attr(r,"data-type"),a="section"===s?.8:1;if(i.intersectionRatio>=a){if(t&&t.hasOwnProperty(s)&&t[s])return;t[s]=setTimeout((()=>{o.unobserve(r),"section"===s?f(1,m):f(1,g,{in_admin:e,type:s}),S(t,s)}),2e3)}else S(t,s)}))}}(i);if(t&&!t.firstElementChild){var s=new IntersectionObserver(o,{threshold:[0,.8]});s.observe(t),e.push(s)}else{if(!i){var a=new IntersectionObserver(o,{threshold:[0,.8]});a.observe(t),e.push(a)}var n=(0,r.domQuery)(".group_edit_admin_tips_item.group_edit_admin_tips_item_not_completed");if(n.length){var d=new IntersectionObserver(o,{threshold:[0,1]});n.forEach((e=>{d.observe(e)})),e.push(d)}}}}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O("itemsViewingTimeouts"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!=e&&(null!==t?e.hasOwnProperty(t)&&e[t]&&(clearTimeout(e[t]),delete e[t]):(Object.keys(e).forEach((t=>{clearTimeout(e[t])})),T("itemsViewingTimeouts",{})))}function I(){if(!O("isModer")){var e=O("observers");null!=e&&(e.forEach((e=>{e.disconnect()})),T("observers",[])),S()}}function T(e,t){window.hasOwnProperty("cur")&&window.cur&&!window.cur.hasOwnProperty("admin_tips")&&(window.cur.admin_tips={}),window.cur.admin_tips[e]=t}function O(e){return window.hasOwnProperty("cur")&&window.cur&&window.cur.hasOwnProperty("admin_tips")&&window.cur.admin_tips.hasOwnProperty(e)?window.cur.admin_tips[e]:null}function k(e){return(0,r.ge)(`group_edit_admin_tips_item_${e}`)}},843052:(e,t,i)=>{i.d(t,{GroupsInviteFriends:()=>s});var o=i(414914),r=i(917685);class s{hideSection(e,t,i){(0,r.stopEvent)(i);var s={id:cur.group_id,hash:e,value:t,act:"group_invite_friends_hide_section"},a=(0,o.ge)("page_block_group_invite_friends"),n=(0,o.ge)("page_block_group_invite_friends_cancel");t?(addClass(a,"unshown"),removeClass(n,"unshown")):(addClass(n,"unshown"),removeClass(a,"unshown")),ajax.post("groupsedit.php",s,{onFail(){t?(addClass(n,"unshown"),removeClass(a,"unshown")):(addClass(a,"unshown"),removeClass(n,"unshown"))}})}}},663662:(e,t,i)=>{i.d(t,{GroupsOnboarding:()=>p});i(530522),i(66108),i(296253),i(991181),i(579665),i(95767),i(116886);var o=i(414914),r=i(917685),s=i(442699),a=i(798170),n=(i(412685),i(514079)),d=i(906143),l=i(705456);function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}class p{constructor(){this.inlineElements=[],this.tutorial=!1}initInlineElements(){geByClass(a.INLINE_ROW_CLASS).forEach((e=>{if((0,o.hasClass)(e,"address")){var t=(0,o.geByClass1)(a.INLINE_ICON_CLASS,e);(0,r.addEvent)(t,"click",(i=>{(0,r.cancelEvent)(i),this.sendHide(e),(0,o.re)(t),(0,o.re)(e)}))}else{(0,o.domData)(e,"type");var i=new a.default(this,e);this.inlineElements.push(i)}})),(0,r.addEvent)(window,"keydown",this.onWindowKeyDown.bind(this)),(0,r.addEvent)(document,"mousedown",this.onDocumentMouseDown.bind(this))}initTutorial(e,t,i,o){this.tutorial=new n.default(e,t,i,o),o?browser.chrome?setTimeout((()=>this.tutorial.showStep()),1e3):this.tutorial.showStep():this.tutorial.showWelcomeBox()}onWindowKeyDown(e){e.keyCode==KEY.ESC&&this.resetInlineElements()}onDocumentMouseDown(e){for(var t=e.target;t.parentNode;){if((0,o.hasClass)(t,a.INLINE_EDIT_CLASS))return!0;t=t.parentNode}return this.resetInlineElements(),!0}resetInlineElements(e){for(var t in this.inlineElements)if(this.inlineElements[t]){var i=this.inlineElements[t];e&&i==e||i.disableInput()}}showAddressBox(e,t){return new d.default(e,t,null,!0,(function(e){var t=e.address_edit_html,i=e.address,r=e.admin_tips_section_html,a=(0,o.domQuery1)(".group_info_row.onboarding_placeholder.address"),n=h((0,o.sech)(t),2),d=n[0],l=n[1],c=void 0===l?null:l;(0,o.domReplaceEl)(a,d),null!==c&&(0,o.domInsertAfter)(c,d),window.Addresses.initInfo(i),(0,s.isString)(r)&&window.hasOwnProperty("GroupsAdminTips")&&window.GroupsAdminTips.refreshSection(r)})).create(),!1}showMenuPlaceholder(e,t){return(0,l.linkLocked)(e)||((0,r.cancelEvent)(t),this.sendHide(e,(()=>{var e=(0,o.domQuery1)("#group_section_menu");e&&(0,o.removeClass)(e,"hided")}),!0,!0)),!1}hideMenuPlaceholder(e,t){return(0,l.linkLocked)(e)||((0,r.cancelEvent)(t),this.sendHide(e,(()=>{var e=(0,o.domQuery1)("#group_section_menu");e&&(0,o.addClass)(e,"hided")}),!0)),!1}sendHide(e,t,i,r){var a=(0,o.domData)(e,"hide-hash"),n={act:"a_hide_inline",id:(0,o.domData)(e,"group-id"),hash:a,type:(0,o.domData)(e,"type"),reset:r?1:0},d={onDone:!!(0,s.isFunction)(t)&&t,showProgress:!!i&&l.lockLink.pbind(e),hideProgress:!!i&&l.unlockLink.pbind(e)};ajax.post("groupsedit_onboarding.php",n,d)}}},798170:(e,t,i)=>{i.d(t,{INLINE_EDIT_CLASS:()=>l,INLINE_ICON_CLASS:()=>h,INLINE_ROW_CLASS:()=>p,default:()=>_});i(59357);var o=i(414914),r=i(917685),s=i(838550),a=i(442699),n=i(719016),d=i(897557),l="line_edit",h="line_div_icon",c="valid",p="onboarding_placeholder",u="empty";class _{constructor(e,t){this.base=e,this.el=t,this.elInput=geByClass1("line_div_value",t),this.elIcon=geByClass1(h,t),this.elLine=geByClass1("line_value",t),this.hideHash=(0,o.domData)(t,"hide-hash"),this.saveHash=(0,o.domData)(t,"save-hash"),this.validateHash=(0,o.domData)(t,"validate-hash"),this.groupId=(0,o.domData)(t,"group-id"),this.type=(0,o.domData)(t,"type"),this.oldValue=(0,o.domData)(t,"raw-value"),this.validateValue="",this.validateText="",this.backValue="",this.oldValue||((0,o.hasClass)(this.elInput,u)?this.oldValue="":this.oldValue=(0,o.val)(this.elInput)),(0,r.addEvent)(this.elLine,"click",this.enableInput.bind(this)),(0,r.addEvent)(this.elIcon,"mouseover",this.onOverIcon.bind(this)),(0,r.addEvent)(this.elIcon,"click",this.onClickIcon.bind(this)),this.setValid(!0)}enableInput(e){if(this.hideValidateHint(),"a"===ge(e.target).tagName.toLowerCase())return!0;if((0,o.hasClass)(this.elLine,l))return!1;var t=geByClass1("wall_post_more",this.elInput);return t&&t.click(),(0,o.hasClass)(this.elInput,u)?this.backValue="":this.backValue=(0,o.val)(this.elInput),this.base.resetInlineElements(this.el),this.oldValue?(0,o.val)(this.elInput,this.oldValue):(0,o.val)(this.elInput,this.backValue),this.validateValue="",this.extractA(this.elLine),(0,o.addClass)(this.elLine,l),(0,o.removeClass)(this.elInput,u),attr(this.elInput,"contenteditable",!0),(0,o.elfocus)(this.elInput,(0,o.val)(this.elInput).length),(0,r.addEvent)(this.elInput,"keyup",this.onKeyUp.bind(this)),(0,r.addEvent)(this.elInput,"keydown",this.onKeyDown.bind(this)),(0,r.addEvent)(this.elInput,"paste",this.onPaste.bind(this)),!1}disableInput(e,t,i){if((0,o.hasClass)(this.elLine,l)){if(this.hideValidateHint(),(0,o.hasClass)(this.elIcon,c)||i){var s=this.oldValue;if((0,a.isUndefined)(e)||(s=e,this.formattedValue=e),t?((0,o.domData)(this.el,"raw-value",t),this.oldValue=t):((0,o.domData)(this.el,"raw-value",s),this.oldValue=s),s){if("group_phone"==this.type){var n=this.formattedValue?this.formattedValue:s;s=`<a href='tel:${n}'>${n}</a>`}else if("group_website"==this.type){var d=`/away.php?to=${s}`;s=`<a href='${d=d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;")}' target='_blank' ref='noopener'>${s}</a>`}else"group_description"==this.type&&"<br>"==s&&(s="");(0,o.val)(this.elInput,s),(0,o.addClass)(this.elIcon,"edit")}else(0,o.val)(this.elInput,s),(0,o.removeClass)(this.elIcon,"edit")}else(0,o.val)(this.elInput,this.backValue),(0,o.removeClass)(this.elIcon,"edit");(0,o.removeClass)(this.elLine,l),attr(this.elInput,"contenteditable",!1);var h=(0,o.val)(this.elInput);browser.msie_edge&&(h=this.cleanBR(h)),0==h.length&&((0,o.addClass)(this.elInput,u),(0,o.val)(this.elInput,attr(this.elInput,"placeholder"))),(0,r.removeEvent)(this.elInput,"keyup keydown paste"),window.getSelection().removeAllRanges()}}showValidateHint(){this.validateText&&(0,n.showHint)(this.elIcon,{text:this.validateText,maxWidth:242})}hideValidateHint(){window.tooltips&&window.tooltips.hideAll()}onOverIcon(e){if((0,o.hasClass)(this.elLine,l))(0,o.hasClass)(this.elIcon,c)||this.showValidateHint();else{var t="";t=(0,o.hasClass)(this.elIcon,"edit")?getLang("groups_info_placeholder_edit_tt"):getLang("groups_info_placeholder_hide_tt"),(0,n.showTitle)(this.elIcon,t,[7,7])}}onClickIcon(e){if((0,o.hasClass)(this.elLine,l)){if(!(0,o.hasClass)(this.elIcon,c))return!1;this.save(e)}else(0,o.hasClass)(this.elIcon,"edit")||this.hide(e);this.hideValidateHint()}onKeyUp(e){this.hideValidateHint(),"<br>"===this.elInput.innerHTML&&(this.elInput.innerHTML="",this.elInput.display="none",this.elInput.offsetHeight,this.elInput.style.display=""),this.validate(!0)}onPaste(e){return(0,r.cancelEvent)(e),Emoji.onEditablePaste(this.elInput,{},0,e),!0}cleanBR(e){return"<br>"===e?"":e}onKeyDown(e){if(this.hideValidateHint(),e.keyCode===KEY.ESC)this.disableInput(),(0,r.cancelEvent)(e);else{((0,o.hasClass)(e.target,"text")?10===e.keyCode||e.keyCode===KEY.ENTER:10===e.keyCode||e.keyCode===KEY.ENTER&&(e.ctrlKey||e.metaKey&&browser.mac))&&(this.save(),(0,r.cancelEvent)(e))}}validatePhone(e,t,i,o){this.validateTimeout&&(this.validateTimeout=!1);var r=this;this.validateTimeout=setTimeout((function(){var s={act:"a_validate_info_from_inline",id:t,hash:o,type:i,value:e};ajax.post("groupsedit_onboarding.php",s,{onDone:function(e){e.valid?(e.raw_value.startsWith("8800")||(e.raw_value="+"+e.raw_value),r.setValid(!0,"",e.value,e.raw_value)):r.setValid(!1,getLang("groups_inline_validation_error_not_valid_phone"))}})}),1e3)}removeSpans(e){for(var t=e.getElementsByTagName("span"),i=0;i<t.length;i++)t[i].outerHTML=t[i].innerHTML}extractA(e){for(var t=e.getElementsByTagName("a");t.length;){for(var i=t[0].parentNode;t[0].firstChild;)i.insertBefore(t[0].firstChild,t[0]);i.removeChild(t[0])}}validate(e){this.hideValidateHint(),this.removeSpans(this.elInput);var t=(0,o.val)(this.elInput);browser.msie_edge&&(t=this.cleanBR(t));var i=!0;t!=this.oldValue?"group_description"==this.type?(i=t.length<4e3,this.setValid(i,"",t)):"group_phone"==this.type?t.length>0?(i=(0,s.isPhoneNumber)(t))?!(0,a.isUndefined)(e)&&e?(this.setValid(!1),this.validatePhone(t,this.groupId,this.type,this.validateHash)):this.setValid(!0):this.setValid(!1,getLang("groups_inline_validation_error_not_valid_phone")):this.setValid(!0):"group_website"==this.type&&(i=t.length>=0&&t.length<100,this.setValid(i)):this.setValid(!1)}setValid(e,t,i,r){e&&!(0,o.hasClass)(this.elIcon,c)?(0,o.addClass)(this.elIcon,c):!e&&(0,o.hasClass)(this.elIcon,c)&&(0,o.removeClass)(this.elIcon,c),(0,a.isUndefined)(i)||(this.validateValue=i,this.validateRawValue=r),this.validateText="",e||(this.validateText=t||getLang("groups_info_inline_validation_error_default"))}hide(e){(0,r.cancelEvent)(e);var t={act:"a_hide_inline",id:this.groupId,hash:this.hideHash,type:this.type};return ajax.post("groupsedit_onboarding.php",t),(0,o.hasClass)(this.elInput,u)?this.removeEl():this.removeIcon(),!1}removeIcon(){this.elIcon.remove(),(0,o.removeClass)(this.el,p),this.disableInput()}removeEl(){var e=domPN(domPN(domPN(domPN(this.el))));(this.el.remove(),geByClass("ui_tab",e)<2)&&(geByClass1("group_info_row")||e.remove())}save(e){(0,r.cancelEvent)(e);var t=(0,o.val)(this.elInput);if(t==this.oldValue)return!1;var i=!(0,o.hasClass)(this.elIcon,c);browser.msie_edge&&(t=this.cleanBR(t));var s=this.clearVal(t);s=(s=(0,d.decodeHTMLEntities)(s)).replace(/&nbsp;/g," ");var a="group_description"===this.type||i,n=a&&window.GroupsAdminTips&&window.GroupsAdminTips.isShownSection()?1:0,l={act:"a_save_info_from_inline",id:this.groupId,hash:this.saveHash,type:this.type,value:s,update_admin_tips:n},h={};return a&&(h={onDone:this.onSaveDone.bind(this)}),ajax.post("groupsedit_onboarding.php",l,h),a||(this.validateValue?this.disableInput(this.validateValue,this.validateRawValue):this.disableInput(t)),!0}onSaveDone(e){if(e.valid){"group_phone"===this.type&&(e.raw_value.startsWith("8800")||(e.raw_value="+"+e.raw_value)),this.disableInput(e.value,e.raw_value,!0);var t=e.admin_tips_section,i=void 0===t?null:t;null!==i&&window.GroupsAdminTips&&window.GroupsAdminTips.refreshSection(i)}else"group_phone"===this.type?(this.setValid(!1,getLang("groups_inline_validation_error_not_valid_phone")),this.showValidateHint()):this.setValid(!1)}clearVal(e){return e.replace(/<br\s*[\/]?>/gi,"\n").replace(/<div>/gi,"\n").replace(/<div style="" class="" id="">/gi,"\n").replace(/<\/div>/gi,"")}}},412685:(e,t,i)=>{i.d(t,{ON_BOARDING_BG_RECT_ID:()=>d,default:()=>c});i(530522),i(66108),i(296253),i(991181),i(579665),i(95767);var o=i(414914),r=i(927663),s=i(491792);function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],o=!0,r=!1,s=void 0;try{for(var a,n=e[Symbol.iterator]();!(o=(a=n.next()).done)&&(i.push(a.value),!t||i.length!==t);o=!0);}catch(e){r=!0,s=e}finally{try{o||null==n.return||n.return()}finally{if(r)throw s}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var d="onboarding_bg_rect",l="page_header_cont",h="onboarding";class c{constructor(e,t){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;var r,s,a={autoShow:!1,noAutoHideOnWindowClick:null===(i=o.noAutoHideOnWindowClick)||void 0===i||i,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${s=null!==(r=o.class)&&void 0!==r?r:"",o.tooltipWhite?s:s+" feature_intro_blue_tt"}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:o.scrollOffset||0,align:o.align||window.ElementTooltip.ALIGN_CENTER};o.side&&(a.forceSide=o.side),o.offset&&(a.offset=o.offset),o.width&&(a.width=o.width),o.shift&&(a.centerShift=o.shift),o.border?this.border=o.border:this.border=[10,10,10,10],o.ttOnHide&&(a.onHide=o.ttOnHide),o.withCloseButton&&(a.withCloseButton=o.withCloseButton,a.onCloseButtonClick=o.onCloseButtonClick),o.align&&(a.align=o.align),this.ttParams=a,this.opts=o,this.initOnboardingBG()}initOnboardingBG(){if(!window.onboardingBG){var e=se('\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ');(0,o.domInsertBefore)(e,window.layerBG),window.onboardingBGHeader=ge("onboarding_bg_header"),window.onboardingBG=ge("onboarding_bg"),window.onboardingBGRect=ge(d),window.onboardingBGClip=ge("onboarding_bg_clip"),window.cur.destroy.push((()=>{hide(window.onboardingBG),hide(window.onboardingBGHeader),removeClass(ge(l),h),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&removeEvent(window.onboardingBG,"click",this.opts.onBGClick)})),this.opts.onBGClick&&addEvent(window.onboardingBG,"click",this.opts.onBGClick)}}showTT(){var e=a((0,o.getXY)(this.el),2)[1];this.tt=new window.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();var t=this.tt.getContent();(0,s.isElementInViewport)(this.el)&&(0,s.isElementInViewport)(t)||(0,r.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.opts.onHide&&this.opts.onHide(),this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&(removeEvent(window,"scroll"),removeEvent(window,"resize")))}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),addEvent(window,"scroll",this.onScrollTT.bind(this)),addEvent(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){var e=this.el.offsetWidth,t=this.el.offsetHeight,i=(0,o.getXY)(this.el);attr(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),attr(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),attr(window.onboardingBGClip,"x",i[0]-this.border[1]),attr(window.onboardingBGClip,"y",i[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){var e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){attr(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){attr(window.onboardingBG,"width",this.getPageWidth()),attr(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,o.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),show(window.onboardingBG),(0,o.isVisible)(window.onboardingBGHeader)||(show(window.onboardingBGHeader),addClass(ge(l),h)))}removeDarkens(){this.hideDarkness&&(hide(window.onboardingBG),hide(window.onboardingBGHeader),removeClass(ge(l),h))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){var e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){var e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}}},514079:(e,t,i)=>{i.d(t,{default:()=>d});i(991181),i(940851),i(296253);var o=i(412685),r=i(791563),s=i(917685),a=i(414914),n=i(116886);class d{constructor(e,t,i,r){this.hash=i,this.groupId=t,this.steps=[],this.stepsElements={},this.curStepId=0,this.confirmBox=null,this.lastTrack=Promise.resolve();var s=""!==r&&"box"!==r;Object.keys(e).forEach((t=>{var i=e[t];i&&(s?(i.step===r&&(s=!1),this.steps.push(null)):ge(i.el)&&this.steps.push(i))}));var a=this.steps.length;Object.keys(this.steps).forEach((e=>{var t=this.steps[e];if(t){var i={highlight:!0};t.side&&(i.side=t.side),t.offset&&(i.offset=t.offset),t.width&&(i.width=t.width),t.shift&&(i.shift=t.shift),t.border&&(i.border=t.border);var r=(0,n.getLang)(t.text),s=Number(e)+1,d=langStr((0,n.getLang)("groups_onboarding_tutor_progress"),"step",s,"total_steps",a),l=a>s,h=`<span class="feature_intro_tt_hide" onclick="window.GroupsOnboarding.tutorial.hide()">&nbsp;</span><div class="step_text">${r}</div>\n        <div><span class="flat_button further_button" onclick="window.GroupsOnboarding.tutorial.nextStep()">${(0,n.getLang)(l?"groups_onboarding_tutor_further":"groups_onboarding_tutor_done")}</span>\n        <span class="step_progress">${d}</span>\n        </div>\n        `,c=new o.default(ge(t.el),h,i);this.stepsElements[Number(e)]=c}else++this.curStepId})),this.onDocumentMouseDown=this.onDocumentMouseDown.bind(this)}showWelcomeBox(e){var t={act:"welcome_box",group_id:this.groupId},i={containerClass:"groups_welcome_box",params:{hideButtons:!0,width:638,onBeforeHide:()=>{(0,s.addEvent)(window.boxLayerWrap,"click",window.__bq.hideLastCheck)}},onDone:(e,t)=>{removeEvent(window.boxLayerWrap,"click",window.__bq.hideLastCheck)}};this.welcomeBox=(0,r.showBox)("al_groups.php",t,i)}hideWelcomeBox(e){this.welcomeBox&&(this.welcomeBox.hide(),this.track("box"),e||this.track("hide"))}start(){this.hideWelcomeBox(!0),this.showStep(),(0,s.addEvent)(document,"mousedown",this.onDocumentMouseDown)}onDocumentMouseDown(e){var t=ge(e.target);if(t&&t.id===o.ON_BOARDING_BG_RECT_ID){var i=geByClass1("further_button");(0,a.addClass)(i,"outline"),setTimeout((function(){(0,a.removeClass)(i,"outline")}),500)}}showStep(){this.stepsElements[this.curStepId]&&this.step(this.curStepId)}nextStep(){this.track(this.steps[this.curStepId].step);var e=this.curStepId+1;this.stepsElements[e]?(this.curStepId++,this.curStepElement.hideDarkness=!1,this.curStepElement.tt.hide(),this.step(e)):(this.track("success"),this.hideOnEnd())}step(e){this.curStepElement=this.stepsElements[e],this.curStepElement.showTT()}track(e){this.lastTrack=this.lastTrack.then((()=>new Promise((t=>{var i={act:"a_onboarding_tutorial_track",step:e,id:this.groupId,hash:this.hash};ajax.post("groupsedit_onboarding.php",i,{onDone:t})}))))}hide(e){if(!e){var t={title:(0,n.getLang)("groups_onboarding_tutor_hide_title"),noCloseButton:!0,onHide:this.onConfirmBoxNo.bind(this)};return this.curStepElement.removeDarkens(),this.confirmBox=(0,r.showFastBox)(t,(0,n.getLang)("groups_onboarding_tutor_hide"),(0,n.getLang)("global_yes"),this.onConfirmBoxYes.bind(this),(0,n.getLang)("global_cancel"),this.onConfirmBoxNo.bind(this)),void(0,a.addClass)(window.boxLayerBG,"onboarding_bg")}this.hideOnEnd()}onConfirmBoxNo(){(0,a.removeClass)(window.boxLayerBG,"onboarding_bg"),this.confirmBox.hide(),this.curStepElement.addDarkness()}onConfirmBoxYes(){(0,a.removeClass)(window.boxLayerBG,"onboarding_bg"),this.confirmBox.hide(),this.hide(!0),this.track("hide")}hideOnEnd(){this.curStepElement.tt.hide(),removeEvent(document,"mousedown",this.onDocumentMouseDown)}}},852557:(e,t,i)=>{i.d(t,{Events:()=>o,UploaderEvents:()=>r,Constants:()=>s,UploadErrorTypes:()=>a,UploadStoryState:()=>n});var o={storyDidUploaded:"storyDidUploaded",storyDidUpload:"storyDidUpload",storyDidFailed:"storyDidFailed",storyDidRemove:"storyDidRemove",coverDidUploaded:"coverDidUploaded",coverDidUpload:"coverDidUpload",coverDidFailed:"coverDidFailed",pushUploadError:"pushUploadError"},r={didUploaded:"didUploaded",didDestroyed:"didDestroyed",didProgress:"didProgress",didUpload:"didUpload",didFailed:"didFailed",didRemove:"didRemove",uploadError:"uploadError"},s={maxTotalCount:50,uploadingMaxCount:2},a={unknown:1,securityError:2,internalError:3,noVideoStream:4,invalidVideoCodec:5,invalidAudioCodec:6,toLongStory:7,bigFile:8},n={waiting:"waiting",uploading:"uploading",finished:"finished",failed:"failed"}},697606:(e,t,i)=>{i.d(t,{default:()=>l});var o=i(852557),r=i(442699),s=i(693476),a=i(736557),n=5,d=200;class l{constructor(e,t,i,r,s,a){this.groupId=e,this.uploadHash=t,this.saveHash=i,this.file=r,this.emitter=s,this.state=o.UploadStoryState.waiting,this.story={},this.uploadProgressVal=n,this.liveCover=a}start(e){this._isPhoto()?this.startWithMetadata(0,e):(0,a.getVideoDuration)(window.URL.createObjectURL(this.file)).then((t=>this.startWithMetadata(t,e))).catch((()=>this.startWithMetadata(0,e)))}startWithMetadata(e,t){this.state=o.UploadStoryState.uploading;var i={act:"stories_get_upload_url",id:this.groupId,type:this._isPhoto()?"photo":"video",hash:this.uploadHash,live_cover:this.liveCover,file_size:this.file.size,duration:Math.round(e)};(0,r.isUndefined)(t)||(i.position=t),ajax.post("groupsedit.php",i,{onDone:e=>{this.uploadUrl=e,this.state===o.UploadStoryState.uploading&&this.upload()},onFail:e=>(this._storyUploadDidFailed(e||{unknown:!0}),!0)})}upload(){this.xhr=new XMLHttpRequest,this.xhr.upload.onprogress=this._uploadDidProgress.bind(this),this.xhr.onload=this.xhr.onerror=this._uploadDidFinish.bind(this),this.xhr.open("POST",this.uploadUrl,!0);var e=new FormData;e.append(this._isPhoto()?"file":"video_file",this.file),this.xhr.send(e)}destroy(){try{this.xhr&&this.xhr.abort(),this.xhr=!1}catch(e){}this.emitter.emit(o.UploaderEvents.didDestroyed,this)}_uploadDidProgress(e){var t=e.loaded/e.total;this.uploadProgressVal=(d-n)*t+n,this.emitter.emit(o.UploaderEvents.didProgress,this)}_uploadDidFinish(){if(200===this.xhr.status){var e=JSON.parse(this.xhr.responseText);e?ajax.post("groupsedit.php",{act:"stories_save",group_id:this.groupId,hash:this.saveHash,upload_result:e.response.upload_result},{onDone:e=>{e&&e.story?(this.state=o.UploadStoryState.finished,this._storyUploadDidFinish(e.story)):this._storyUploadDidFailed({unknown:!0})},onFail:()=>{this._storyUploadDidFailed({unknown:!0})}}):this._storyUploadDidFailed(e.error)}else this._storyUploadDidFailed({unknown:!0});this.xhr=!1}_storyUploadDidFinish(e){this.storyRaw=`${e.owner_id}_${e.id}`;var t="video"===e.type,i=t?e.video.first_frame_320:(0,s.getPhotoUrl)(e.photo,"x");this.story={isProcessing:t&&e.video.processing,preview:i,isVideo:t,videoDuration:t?formatTime(e.video.duration):""},this.emitter.emit(o.UploaderEvents.didUploaded,this)}_storyUploadDidFailed(e){e.unknown||"flood"===e.type?this.state=o.UploadStoryState.failed:(this.emitter.emit(o.UploaderEvents.pushUploadError,this,e),this.emitter.emit(o.UploaderEvents.didRemove,this)),this.emitter.emit(o.UploaderEvents.didFailed,this)}_isPhoto(){return"image"===this.file.type.substr(0,5)}}},693476:(e,t,i)=>{i.d(t,{getPhotoUrl:()=>o});i(530522),i(66108),i(296253),i(991181),i(579665),i(95767);function o(e,t){if(e&&e.sizes)return(e.sizes.filter((e=>e.type===t))[0]||{}).url}},491792:(e,t,i)=>{function o(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}i.d(t,{isElementInViewport:()=>o})},888969:(e,t,i)=>{function o(e,t,i){if(null==e)return!1;var o={show,hide,forceEnableCustom:0,multiselect:!1,selectedItems:"",visible:!0,dropdown:!1,city:0,street:0,place:0,placeholder:getLang("global_select_address_or_place"),introText:getLang("select_place_select"),noResult:getLang("select_place_select"),showAddress:0,showCreateNewPlace:0};function r(){var e="/select_ajax.php?act=a_get_places2";return i.longitude&&i.latitude&&(e+="&longitude="+i.longitude+"&latitude="+i.latitude),i.showAddress&&(e+="&with_address=1"),i.showCreateNewPlace&&(e+="&show_create_new=1"),e}(i=extend(o,i)).enableCustom=i.forceEnableCustom>=0,i.city=intval(i.city),i.showAddress=intval(i.showAddress),i.showCreateNewPlace=intval(i.showCreateNewPlace);var s=new Selector(e,r(),i);function a(){s.old_setOptions({onChange:function(e){if(i.place=s.val_full(),i.showCreateNewPlace&&"new"==e&&isFunction(i.onCreateNew)){var t="";return i.place[3]&&(t=i.place[3]),void i.onCreateNew(t)}intval(e)||s.clear(),isFunction(i.onChange)&&i.onChange(e)}})}function n(){i.visible&&i.city?i.show(t):i.hide(t)}if(s.old_setOptions=s.setOptions,s.setOptions=function(e){if(extend(i,e),s.old_setOptions(e),"onChange"in e&&a(),"latitude"in e||"longitude"in e)if(i.city=intval(i.city),s.setURL(r()),intval(i.place)){if(!intval(s.val())){var t=i.multiselect?i.place:[i.place];for(var o in t)s.val(t[o])}}else"city"in e&&s.clear();("city"in e||"visible"in e)&&n()},s.show=function(){s.setOptions({visible:!0})},s.hide=function(){s.setOptions({visible:!1})},s.zero=function(){i.multiselect&&s.clear(),s.val("",!0)},intval(i.place)){var d=i.multiselect?i.place:[i.place];for(var l in d)s.val(d[l])}else s.clear();return n(),a(),s}i.d(t,{PlacesSelect:()=>o})},422753:(e,t,i)=>{i.d(t,{helpHintTooltip:()=>a});var o=i(570655),r=i(64385),s=i(45150),a=function(e,t,i){var a,n,d;void 0===i&&(i={});var l={autoShow:!1,content:t.content,withCloseButton:!0,noAutoHideOnWindowClick:!0,onHide:function(){null==d||d.destroy()},width:230},h="feature_intro_tt feature_intro_blue_tt feature_info_tooltip";i.cls&&(h+=" "+i.cls);var c=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},l),i),{cls:h,onDestroy:function(){var e,o;"isServerSideHideDisabled"in(o=t)&&o.isServerSideHideDisabled||r.ajax.post("al_index.php",{act:"help_hints_hide",hash:t.helpHintHash,hint_id:t.helpHintId}),null===(e=t.onHideRequestSent)||void 0===e||e.call(t),i.onDestroy&&i.onDestroy()}});return d=new s.default(e,c),null===(n=null===(a=window.cur)||void 0===a?void 0:a.destroy)||void 0===n||n.push((function(){null==d||d.destroy()})),{tooltip:d}}}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return o[e].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=o,e=[],s.O=(t,i,o,r)=>{if(!i){var a=1/0;for(h=0;h<e.length;h++){for(var[i,o,r]=e[h],n=!0,d=0;d<i.length;d++)(!1&r||a>=r)&&Object.keys(s.O).every((e=>s.O[e](i[d])))?i.splice(d--,1):(n=!1,r<a&&(a=r));if(n){e.splice(h--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[i,o,r]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},i=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var r=Object.create(null);s.r(r);var a={};t=t||[null,i({}),i([]),i(i)];for(var n=2&o&&e;"object"==typeof n&&!~t.indexOf(n);n=i(n))Object.getOwnPropertyNames(n).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,s.d(r,a),r},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.e=()=>Promise.resolve(),s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={2151:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var o,r,[a,n,d]=i,l=0;for(o in n)s.o(n,o)&&(s.m[o]=n[o]);if(d)var h=d(s);for(t&&t(i);l<a.length;l++)r=a[l],s.o(e,r)&&e[r]&&e[r][0](),e[a[l]]=0;return s.O(h)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[8592],(()=>s(86798)));a=s.O(a)})();