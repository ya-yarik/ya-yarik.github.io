(self.webpackChunkvk=self.webpackChunkvk||[]).push([[4084],{276018:(e,t,o)=>{"use strict";o.d(t,{addDelegateEvent:()=>r,removeDelegateEvent:()=>c});o(530522),o(66108),o(579665),o(95767),o(991181),o(296253),o(751876);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var o=[],s=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(s=(a=r.next()).done)&&(o.push(a.value),!t||o.length!==t);s=!0);}catch(e){n=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(n)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,s=new Array(t);o<t;o++)s[o]=e[o];return s}var i=new window.Map;function a(e){var t=i.get(e.currentTarget);if(t){var o=t[e.type];if(o)for(var n,a=0;a<o.length;a++){var r=s(o[a],2),c=r[0],l=r[1],u=void 0;if(hasClass(e.target,c)?u=l(e,e.target):(n=gpeByClass(c,e.target,e.currentTarget))&&(u=l(e,n)),!1===u)break}}}function r(e,t,o,s){var n=i.get(e);n||(i.set(e,{}),n=i.get(e));for(var r=t.split(" "),c=0;c<r.length;c++){var l=r[c];n[l]||(n[l]=[],addEvent(e,l,a)),n[l].push([o,s])}}function c(e,t,o,s){var n=i.get(e);n&&(t.split(" ").forEach((t=>{n[t]&&(n[t]=n[t].filter((e=>e[0]!==o||e[1]!==s)),0===n[t].length&&removeEvent(e,t,a))})),0===Object.keys(n).map((e=>n[e].length)).reduce(((e,t)=>e+t))&&i.delete(e))}},797399:(e,t,o)=>{"use strict";o.d(t,{getNativeOption:()=>n,createScroll:()=>c});var s=o(533246);function n(e,t){return bodyNode[e]||document.documentElement[e]}class i{constructor(e,t){this.el=e,this.opts=t,this.module=(0,s.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return n("scrollTop",this.el);!function(e,t,o){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return n("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-o<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},o=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),o=t-this.prevScroll,s=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-o,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&s-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,s.destroyModule)(this.module)}}class a{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var o=this.scrollTop(),s=this.prevTop-o;this.prevTop=o,t.scrollChange&&t.scrollChange(o),t.onScroll&&t.onScroll(s,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class r{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function c(e,t){return t.noScroll?new r(e):t.nativeScroll?new i(e,t):new a(e,t)}},172237:(e,t,o)=>{"use strict";o.d(t,{Scroll:()=>r});o(95767),o(991181),o(296253);var s=o(667294),n=o(436953),i=o(797399);o(45697);function a(e,t){if(null==e)return{};var o,s,n=function(e,t){if(null==e)return{};var o,s,n={},i=Object.keys(e);for(s=0;s<i.length;s++)o=i[s],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)o=i[s],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var r=e=>{var t=e.children,o=a(e,["children"]);return s.createElement(n.ScrollContext.Provider,{value:{createScroll:i.createScroll}},s.createElement(n.Scroll,o,t))};r.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},453398:(e,t,o)=>{"use strict";o.d(t,{TransferVotesBox:()=>l});o(59357);var s=o(621260),n=o(907851),i=o(442699),a=o(705456),r=o(414914),c=o(128533);class l{constructor(e,t){(0,c.tq)().setInteractiveHandler("TransferVotesBox/check_user_message",(()=>{this.transferCheckUserMessage()})),(0,c.tq)().setInteractiveHandler("TransferVotesBox/clean_amount",(e=>{this.transferCleanAmount(e.payload.event.target)})),(0,c.tq)().setInteractiveHandler("TransferVotesBox/text_keydown",(e=>{13===e.payload.event.keyCode&&this.transferSend()})),this.box=(0,s.curBox)(),extend(this,e,{votesTransferMaxTextLength:t,linkCache:{}}),this.uiTransferTo=new Dropdown(ge("transfer_to"),this.friends,{big:!0,introText:getLang("votes_transfer_start_typing_recipient"),noResult:"",placeholder:getLang("votes_transfer_choose_recipients"),placeholderColored:!0,multiselect:!1,enableCustom:!0,autocomplete:!0,selectedItems:this.friends_sel,imageId:"transfer_to_photo",indexkeys:[1,4],noImageSrc:"/images/blank.gif",onChange:e=>{var t=this.uiTransferTo.val_full();if(t[0]&&t[1]!==getLang("votes_transfer_choose_recipients"))if(-1===t[0]){for(var o=0;o<this.uiTransferTo.currentList.length;o++){var s=this.uiTransferTo.currentList[o];if(s[1]===t[1])return this.uiTransferTo.selectItem(s[0]),void this.transferCheckUserAmount(s[0])}this.transferGetUser(t[1])}else this.transferCheckUserAmount(t[0])}}),cur.destroy.push(this.uiTransferTo.destroy.bind(this.uiTransferTo)),this.box.setOptions({width:500,bodyStyle:"padding: 0;"}),this.box.setButtons(getLang("votes_transfer_send"),(()=>{this.transferSend()}),getLang("global_cancel"))}uiTransferToFocus(){this.uiTransferTo.focus()}transferCleanAmount(e){var t=e.value.replace(/[^0-9]/g,"");e.value!==t&&(e.value=t)}transferShowBoxError(e){ge("payments_box_error").innerHTML=e,show("payments_box_error"),this.box.hideProgress()}transferCheckUserMessage(){(0,n.checkTextLength)(this.votesTransferMaxTextLength,ge("transfer_comment"),ge("transfer_comment_limit_message"),!1,!0)}transferSend(){hide("payments_box_error");var e={act:"a_votes_transfer_send",transfer_to:this.uiTransferTo.val(),transfer_amount:(0,i.intval)(val("transfer_amount")),transfer_comment:(0,i.trim)(val("transfer_comment")),hash:this.transfer_hash};if((parseInt(e.transfer_to)||0)<=0)return this.transferShowBoxError(getLang("votes_transfer_please_select_recipient")),void this.uiTransferTo.focus();e.transfer_amount<=0?(0,a.notaBene)("transfer_amount"):this.user_limit<=0||e.transfer_amount>this.user_limit?this.transferShowBoxError(this.user_limit_err_msg):(this.box.showProgress(),ajax.post("al_payments.php",e,{onDone:(e,t)=>{this.box.hide(),(0,s.showDoneBox)(e,{out:4e3});var o=ge("settings_votes_history");if(o&&o.parentNode){for(var n=o.parentNode;n.firstChild;)n.removeChild(n.firstChild);for(var i=(0,r.domChildren)((0,r.ce)("div",{innerHTML:t})),a=0;a<i.length;a++)n.appendChild(i[a]);this.historyOffset=5}},onFail:e=>(e&&this.transferShowBoxError(e),this.box.hideProgress(),!0)}))}transferCheckUserAmount(e){this.box.showProgress(),hide("payments_box_error"),ajax.post("al_payments.php",{act:"a_votes_transfer_check",transfer_to:e},{onDone:e=>{this.box.hideProgress(),this.user_limit=e[0],this.user_limit_err_msg=e[2],ge("limit_message")&&(ge("limit_message").innerHTML=e[1],(0,r.elfocus)("transfer_amount"))},onFail:e=>(this.transferShowBoxError(e),!0)})}transferGetUser(e){var t=t=>{this.box.hideProgress(),hide("payments_box_error");for(var o=this.uiTransferTo.currentList,s=!1,n=0;n<o.length;n++)o[n][0]===t[0]&&(s=!0);s||(o.push(t),this.uiTransferTo.setData(o)),this.uiTransferTo.selectItem(t[0]),this.user_limit=t[4],this.user_limit_err_msg=t[6],ge("limit_message").innerHTML=t[5],this.linkCache[e]=t,(0,r.elfocus)("transfer_amount")};(0,i.trim)(e).length&&(void 0!==this.linkCache[e]?t(this.linkCache[e]):(this.box.showProgress(),ajax.post("al_payments.php",{act:"a_votes_transfer_get_person",page:e},{onDone:t,onFail:e=>(this.transferShowBoxError(e),!0)})))}}},134516:(e,t,o)=>{"use strict";o.d(t,{Settings:()=>D});o(175115),o(283946),o(976142),o(796409),o(21466),o(991181),o(59357),o(751876),o(530522),o(940851),o(296253);var s=o(667294),n=o(414914),i=o(442699),a=o(960139),r=o(927663),c=o(917685),l=o(705456),u=o(116886),d=o(930499),p=o(651988),_=o(519921),g=o(641142),h=o(907851),f=o(791563),m=o(719016),v=o(40897),w=o(682207),y=o(611386),b=o(128533),S=o(453398),B=o(382481),x=o(783611),k=o(548505),T=o(432655),C=o(255528),P=o(48557),L=o(619608),E=o(76238),N=o(981253);function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e}).apply(this,arguments)}var M="vk_mail",A="open",D={registerStartupHandlers:function(){(0,b.tq)().setStartupHandler("Settings/update_lang",(e=>(window.cur.lang=R({},window.cur.lang||{},{},e.payload.data),Promise.resolve(!1)))),(0,b.tq)().setStartupHandler("Settings/update_options",(e=>{window.cur.options=JSON.parse(e.payload.data)})),(0,b.tq)().setStartupHandler("Settings/init_blacklist",(()=>{D.initBlacklist()})),(0,b.tq)().setStartupHandler("PrivacySettings/init",(e=>{D.initPrivacy(e.payload.data)}))},registerInteractiveHandlers:function(){(0,b.tq)().setInteractiveHandler("Settings/add_to_blacklist_dialog",(()=>{D.addToBlacklist()})),(0,b.tq)().setInteractiveHandler("Settings/add_to_blacklist",(e=>{var t=e.payload.dataAttrs,o=t.id,s=t.hash;D.addToBl(parseInt(o),s,e.payload.event.target)})),(0,b.tq)().setInteractiveHandler("Settings/do_add_to_blacklist",(e=>{var t=e.payload.dataAttrs.mid;D.doAddToBlacklist(parseInt(t),e.payload.event.target)})),(0,b.tq)().setInteractiveHandler("Settings/remove_from_blacklist",(e=>{var t=e.payload.dataAttrs,o=t.id,s=t.hash;D.delFromBl(parseInt(o),s,e.payload.event.target)})),(0,b.tq)().setInteractiveHandler("Settings/remove_top_from_blacklist",(e=>{var t=e.payload.dataAttrs,o=t.id,s=t.hash;D.delTopFromBl(parseInt(o),s,e.payload.event.target)})),(0,b.tq)().setInteractiveHandler("Settings/more_search_box",(()=>{D.moreSearchBox(!1)}));var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;showBox("payments",{act:"votes_transfer_box",to:t},{onDone(t,o){o&&(o.noBalance?t.setButtons(o.getVotesButtonText,(()=>{t.hide(),C.Gifts.showGetMoneyBox()}),(0,u.getLang)("global_close")):new S.TransferVotesBox(o,e))}})};(0,b.tq)().setInteractiveHandler("Settings/transfer_votes_box",(t=>{var o=t.payload.dataAttrs.maxTextLength;e(o)})),(0,b.tq)().setStartupHandler("Settings/transfer_votes_init",(t=>{var o=t.payload.data,s=o.maxTextLength,n=o.to;e(s,n)})),(0,b.tq)().setStartupHandler("Settings/money_transfer_box",(e=>{var t=e.payload.data.tab;B.MoneyTransfer.showMoneyTransferBox({tab:t,to_id:!1,amount:!1,currency:"",from:"settings"})})),(0,b.tq)().setInteractiveHandler("Settings/money_transfer_button",(e=>{var t=e.payload.dataAttrs.tab;B.MoneyTransfer.showMoneyTransferBox({tab:t,to_id:!1,amount:!1,currency:"",from:"settings"})})),(0,b.tq)().setInteractiveHandler("Settings/show_money_land",(e=>{showWiki({w:"moneysend"},!1,e.payload.event)})),(0,b.tq)().setInteractiveHandler("Settings/vk_sans",(e=>{var t=e.payload.event.target,o=e.payload.dataAttrs.hash;(0,x.toggleVkSans)(t.checked,o)})),(0,b.tq)().setInteractiveHandler("PrivacySettings/open_profile",(()=>{window.ajax.post("al_settings.php?act=a_save_special",{hash:cur.options.hash,key:T.PRIVACY_KEYS.PROFILE_CLOSED,val:0},{onDone:()=>{nav.reload({preventScroll:!0,onDone:()=>{D.scrollHighlightPrivacy(document.querySelector("._"+T.PRIVACY_KEYS.PROFILE_CLOSED)),D.savePrivacyShowSaved(T.PRIVACY_KEYS.PROFILE_CLOSED),updateNarrow()}})}})})),(0,b.tq)().setInteractiveHandler("Settings/fill_balance",(e=>{!1===(0,c.checkEvent)(e.payload.event)?C.Gifts.showGetMoneyBox():location.href="/settings?act=payments&getvotes=1"})),(0,b.tq)().setInteractiveHandler("Settings/spasibo_promo_banner",(e=>{statlogsValueEvent("payments_ps_promo_banner_event","","votes_settings","relocate"),C.Gifts.showGetMoneyBox({type:"spasibo"})})),(0,b.tq)().setInteractiveHandler("Settings/spasibo_promo_votes_done",(e=>{var t;null===(t=curBox())||void 0===t||t.hide(),statlogsValueEvent("payments_ps_promo_banner_event","","votes_successpage","relocate"),C.Gifts.showGetMoneyBox({type:"spasibo"})})),(0,b.tq)().setStartupHandler("Settings/get_votes",(e=>{var t=e.payload.data.type;C.Gifts.showGetMoneyBox({type:t})}))},go:function(e,t){var o=D.getsect();return!1===(0,c.checkEvent)(t)&&(o.className="",e.parentNode.className="active_link"),nav.go(e,t)},getsect:function(){for(var e=(0,n.ge)("settings_filters").firstChild;!(0,n.hasClass)(e,"active_link");)e=e.nextSibling;return e},showMsg:function(e,t){t||(t=(0,n.ge)("settings_result")),e?((0,a.showMsg)(t,e,"ok_msg",!0),(0,n.show)(t)):(0,n.hide)(t),(0,r.scrollToTop)(0)},showError:function(e,t){e=e||(0,u.getLang)("global_unknown_error");var o=t?(0,n.ge)("settings_error_"+t):(0,n.ge)("settings_result");(0,a.showMsg)(o,e,"error",!0),(0,n.show)(o),t||(0,r.scrollToTop)(0)},toggleBlock:function(e,t){var o,s;e&&e.target?(o=e.target,s=(0,n.hasClass)(o,"settings_line")?o:(0,n.gpeByClass)("settings_line",o)):(e=(0,n.ge)(e),o=(0,n.geByClass1)("settings_right_control",e),s=(0,n.hasClass)(e,"settings_line")?e:(0,n.gpeByClass)("settings_line",e)),s&&(0,n.geByClass1)("settings_change_block",s)&&(!(0,n.hasClass)(s,"unfolded")||(0,n.hasClass)(o,"settings_right_control"))&&(cur.changingSetting&&cur.changingSetting!==s&&((0,n.removeClass)(cur.changingSetting,"unfolded"),window.tooltips&&tooltips.hideAll()),(0,n.toggleClass)(s,"unfolded"),cur.changingSetting=s,t&&(0,n.elfocus)(t))},savePrivacyKey:function(e){if("friends"!==e){var t,o={key:e,val:Privacy.getValue(e),hash:cur.options.hash};if([T.PRIVACY_KEYS.SEARCH_ACCESS,T.PRIVACY_KEYS.UPDATES,T.PRIVACY_KEYS.COMPANY_MESSAGES,T.PRIVACY_KEYS.PROFILE_CLOSED,T.PRIVACY_KEYS.CONTACT_AVATAR,T.PRIVACY_KEYS.CALLS_FROM_COMMUNITY].includes(e)){if(e===T.PRIVACY_KEYS.UPDATES){var s=Privacy.getValue(e);if("0"!==s.substr(0,1))s.substr(2).length||((0,n.ge)("privacy_header").innerHTML=(0,n.ge)("privacy_edit_updates").innerHTML=(0,u.getLang)("settings_updates_no_news"))}t="al_settings.php",o.act="a_save_special"}else t="al_friends.php",o.act="save_privacy";clearTimeout(cur["privacy_timer_"+e]),cur["privacy_timer_"+e]=setTimeout((()=>{window.ajax.post(t,o,{onDone:function(t){if(t)return nav.reload({preventScroll:!0,onDone:function(e){D.savePrivacyShowSaved(e),updateNarrow()}.pbind(e)});D.savePrivacyShowSaved(e)}})}),500)}else window.uiPageBlock&&uiPageBlock.showSaved("privacy_friends_hide")},savePrivacyShowSaved:function(e){window.uiPageBlock&&uiPageBlock.showSaved("privacy_edit_"+e)},initPrivacy:function(e){var t=e.privacy,o=e.options,s=e.isClosedProfileExperimentEnabled;if(cur.privacy=t,cur.options=o,cur.isClosedProfileExperimentEnabled=s,cur.onPrivacyChanged=D.savePrivacyKey,cur.privacyNeedConfirm=function(e,t,o){if("profile_closed"===e&&(0,i.intval)(t)){if(window.cur.isClosedProfileExperimentEnabled)return void(0,P.confirmProfileClose)(o);var s=new MessageBox({title:(0,u.getLang)("settings_closed_profile_confirm_title")});s.content((0,u.getLang)("settings_closed_profile_confirm_text")),s.removeButtons().addButton((0,u.getLang)("settings_closed_profile_confirm_btn"),(function(){o(),s.hide()})),s.addButton((0,u.getLang)("global_cancel"),s.hide,"no"),s.show()}else o()},nav.objLoc.hl){var a=(0,n.geByClass1)("_"+nav.objLoc.hl);D.scrollHighlightPrivacy(a)}},highlightPrivacy(e){(e=(0,n.ge)(e))&&((0,n.addClass)(e,"setting_row_selected"),(0,n.addClassDelayed)(e,"setting_row_animated",1500),(0,n.removeClassDelayed)(e,"setting_row_selected",2500),(0,n.removeClassDelayed)(e,"setting_row_animated",2500))},scrollHighlightPrivacy:function(e){(e=(0,n.ge)(e))&&setTimeout((function(){var t=(0,n.getXY)(e)[1],o=(0,n.getSize)("page_header")[1],s=(0,r.scrollGetY)(),i=(0,n.clientHeight)();t<o+s||t>s+i?((0,r.scrollToY)(t),setTimeout(D.highlightPrivacy.pbind(e),300)):D.highlightPrivacy(e)}),0)},initSearchBox:function(e,t,o){(0,i.extend)(cur,t),o&&ajax.preload(cur.searchBoxAddress,cur.searchBoxParams,o),window.uiScrollBox&&uiScrollBox.init(e,{onShow:function(){(0,c.addEvent)(boxLayerWrap,"scroll",D.boxScrollResize),setTimeout(D.boxScrollResize,0)},onHide:function(){(0,c.removeEvent)(boxLayerWrap,"scroll",D.boxScrollResize)}}),(0,c.addEvent)(boxLayerWrap,"scroll",D.boxScrollResize),D.boxScrollResize()},boxScrollResize:function(){if(!browser.mobile){var e=lastWindowHeight,t=(0,n.ge)(cur.boxMoreLink);t&&(0,n.isVisible)(t)&&e>(0,n.getXY)(t,!0)[1]&&cur.boxShowMore()}},moreSearchBoxLoaded:function(e,t,o){cur.loading=!1,cur.searchBoxParams.offset=t;var s=cur.boxRows,i=(0,n.ce)("div",{innerHTML:e});for((0,n.toggle)(cur.boxMoreLink,o);i.firstChild;)s.appendChild(i.firstChild)},moreSearchBox:function(e,t,o){var s=cur.boxMoreLink;!(e||(0,n.isVisible)(s)&&!(0,n.hasClass)(s,"loading"))||e&&o==cur.searchBoxParams.q||(cur.loading?cur.loading=2:(e&&(cur.oldBoxParams={q:cur.searchBoxParams.q,offset:cur.searchBoxParams.offset},(0,i.extend)(cur.searchBoxParams,{q:o,offset:0})),ajax.post(cur.searchBoxAddress,cur.searchBoxParams,{onDone:function(o,s,a,r){if(e){if(r)return(0,i.extend)(cur.searchBoxParams,cur.oldBoxParams),(0,n.val)(t,cur.oldBoxParams.q),void(cur.searchBoxFound&&cur.searchBoxFound(r));cur.boxRows.innerHTML=o?"":cur.boxNoRowsTpl,curBox().tbToTop()}D.moreSearchBoxLoaded.apply(window,arguments)},onFail:function(){return cur.loading=0,!0},showProgress:function(){(0,n.addClass)(s,"loading")},hideProgress:function(){(0,n.removeClass)(s,"loading")}})))},moreSearchBoxChange:function(e,t){t&&"paste"==t.type?D.moreSearchBox(!0,curBox().tbSearchField,e):e.length||D.moreSearchBox(!0,curBox().tbSearchField,"")},initBlacklist:function(){(0,n.ge)("settings_bl_msg")&&setTimeout(n.removeClass.pbind((0,n.ge)("settings_bl_msg"),"msg_appear"),0),(0,n.elfocus)("settings_bl_search")},searchBlacklist:function(e){e&&(e=e.toLowerCase());var t=(0,n.ge)("settings_bl_empty"),o=(0,u.getLang)("settings_blacklist_not_found_by_query"),s=(0,n.ge)("settings_bl_list"),i=0;Array.from((0,n.geByClass)("settings_bl_row",s)).forEach((t=>{if(e){var o=(0,n.geByClass1)("settings_bl_name",t);((0,n.val)((0,n.geByTag1)("a",o))||(0,n.val)((0,n.geByClass1)("name_label"))).toLowerCase().indexOf(e)>-1?((0,n.show)(t),i++):(0,n.hide)(t)}else(0,n.show)(t),i++})),e&&!i?(t.innerHTML=o.split("{query}").join("<b>"+e.replace(/([<>&#]*)/g,"")+"</b>"),(0,n.show)(t),(0,n.hide)("settings_bl_noempty")):((0,n.hide)(t),(0,n.show)("settings_bl_noempty"))},doAddToBlacklist:function(e,t){ajax.post("al_settings.php",{act:"search_blacklist",query:e,hash:cur.options.blacklist_hash},{onDone:function(e,t,o){curBox().emit("success",o),curBox().hide();var s=(0,n.ge)("settings_bl_summary");e&&-1!=e&&s&&(s.innerHTML=(0,u.langNumeric)(e,"%s",!0));var i=(0,n.ce)("div",{innerHTML:t}).firstChild,r=(0,n.ge)("settings_bl_list");(0,n.re)(i.id),r&&(r.insertBefore(i,r.firstChild),(0,n.show)("settings_bl_noempty"),(0,n.hide)("settings_bl_empty"),(0,a.showMsg)("settings_bl_result",o,"ok_msg",!0))},onFail:function(e){return(0,a.showMsg)("settings_search_rows",e,"error",!0),!0},showProgress:function(){"BUTTON"===t.tagName?(0,l.lockButton)(t):uiSearch.showProgress(t)},hideProgress:function(){"BUTTON"===t.tagName?(0,l.unlockButton)(t):uiSearch.hideProgress(t)}})},addToBlacklist:function(){return showBox("al_settings.php",{act:"blacklist_box"},{params:{dark:!0}}),!1},addToBl:function(e,t,o){ajax.post("al_settings.php",{act:"a_add_to_bl",id:e,hash:t,from:"settings"},{onDone:function(t){t&&((0,n.ge)("settings_bl_summary").innerHTML=(0,u.langNumeric)(t,"%s",!0)),(0,n.hide)("settings_bl_label"+e),o.setAttribute("data-task-click","Settings/remove_from_blacklist"),o.innerHTML=(0,u.getLang)("settings_remove")},onFail:function(e){return setTimeout((0,f.showFastBox)({title:(0,u.getLang)("global_error"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},e).hide,2e3),!0},showProgress:function(){(0,n.hide)(o),(0,n.show)("settings_progress"+e)},hideProgress:function(){(0,n.show)(o),(0,n.hide)("settings_progress"+e)}})},delFromBl:function(e,t,o){ajax.post("al_settings.php",{act:"a_del_from_bl",id:e,hash:t,from:"settings"},{onDone:function(t){(0,n.ge)("settings_bl_summary").innerHTML=t?(0,u.langNumeric)(t,"%s",!0):"",(0,n.setStyle)("settings_bl_label"+e,"display","inline"),o.setAttribute("data-task-click","Settings/add_to_blacklist"),o.innerHTML=(0,u.getLang)("settings_restore_blacklist")},onFail:function(e){return setTimeout((0,f.showFastBox)({title:(0,u.getLang)("global_error"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},e).hide,2e3),!0},showProgress:function(){(0,n.hide)(o),(0,n.show)("settings_progress"+e)},hideProgress:function(){(0,n.show)(o),(0,n.hide)("settings_progress"+e)}})},delTopFromBl:function(e,t,o){var s=(0,n.ce)("img",{src:"/images/upload.gif"});ajax.post("al_settings.php",{act:"a_del_from_bl",id:e,hash:t,from:"settings"},{onDone:function(t){t&&((0,n.ge)("settings_bl_summary").innerHTML=t?(0,u.langNumeric)(t,"%s",!0):""),(0,n.setStyle)("settings_bl_label"+e,"display","inline");var o=(0,n.geByTag1)("a",(0,n.geByClass1)("settings_bl_action",(0,n.ge)("settings_bl_row"+e)));o.setAttribute("data-task-click","Settings/add_to_blacklist"),o.innerHTML=(0,u.getLang)("settings_restore_blacklist"),(0,n.hide)("settings_bl_result")},showProgress:function(){o.parentNode.replaceChild(s,o)},hideProgress:function(){s.parentNode.replaceChild(o,s)}})},saveSmsNotify:function(e){(0,l.lockButton)(e);var t={act:"a_save_sms_notify",hash:cur.options.notify_hash};(0,i.each)(cur.options.notify_sms_keys,(function(e,o){t[o]=Privacy.getValue(o)})),t.smsenabled=(0,l.isChecked)("smsenabled")?1:0,(0,l.isChecked)("daytime")?(t.daytime_from=(0,n.ge)("daytime_from").value,t.daytime_to=(0,n.ge)("daytime_to").value):(t.daytime_from=0,t.daytime_to=0),(0,n.val)("settings_notify_sms_result",""),ajax.post("al_settings.php",t,{onDone:function(t,o,s){(0,l.unlockButton)(e),o&&s?(0,f.showFastBox)({title:t,dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},o,(0,u.getLang)("settings_subscribe_to_service_btn"),(function(){window.open(s),curBox().hide()}),(0,u.getLang)("box_cancel"),(function(){(0,l.checkbox)("smsenabled",0),D.smsNotifyCheck(),D.saveSmsNotify(),curBox().hide()})):(0,a.showMsg)("settings_notify_sms_result",t,"ok_msg",!0)},onFail:function(t){(0,l.unlockButton)(e),(0,l.checkbox)("smsenabled",0),D.smsNotifyCheck(),D.saveSmsNotify()}})},updateInstantSounds:function(e){(0,n.toggleClass)((0,n.geByClass1)("_ui_toggler",e),"on"),p.default.set("sound_notify_off",(0,n.hasClass)((0,n.geByClass1)("_settings_isounds"),"on")?0:1),uiPageBlock.showSaved(e)},saveSiteNotify:function(e){(0,n.toggleClass)((0,n.geByClass1)("_ui_toggler",e),"on");var t={act:"a_save_site_notify",hash:cur.options.notify_hash,ienable:(0,n.hasClass)((0,n.geByClass1)("_settings_ienable"),"on")?1:0,itexts:(0,n.hasClass)((0,n.geByClass1)("_settings_itexts"),"on")?1:0};(0,i.each)((0,n.geByClass)("_settings_nf_bt"),(function(e,o){t["nf_bt_"+o.getAttribute("data-id")]=+(0,n.hasClass)(o,"on")})),cur.options.notify_privacy_keys&&cur.options.notify_privacy_keys.forEach((function(e){t["nf_"+e]=0|Privacy.getValue(e)})),clearTimeout(cur.instantNotifyTO),clearTimeout(cur.instantNotifySaveTO),cur.instantNotifyTO=setTimeout(ajax.post.pbind("al_settings.php",t,{onDone:function(){cur.instantNotifySaveTO=setTimeout(window.uiPageBlock&&uiPageBlock.showSaved.pbind(e),1e3)}}),500),TopNotifier&&TopNotifier.invalidate()},saveBrowserNotify:function(e){var t="browser_notification",o=(0,n.ge)("privacy_edit_"+t),s=Number(Privacy.getValue(t));(0,n.addClass)(o,"privacy_link_disabled"),pushNotifier.canBeEnabled().then((function(i){i?pushNotifier.setupSubscription().then((function(){return(0,n.removeClass)(o,"privacy_link_disabled"),pushNotifier.setState(s,cur.options.push_notify_hash)})).catch((function(s){d.default.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===s?pushNotifier.showPopupAllowNotification():(0,f.showFastBox)((0,u.getLang)("global_error"),(0,u.getLang)("notifications_native_common_error")),Privacy.setValue(t,e),(0,n.removeClass)(o,"privacy_link_disabled")})):(Privacy.setValue(t,e),(0,n.removeClass)(o,"privacy_link_disabled"),(0,f.showFastBox)((0,u.getLang)("global_error"),(0,u.getLang)("notifications_native_common_error")))}))},saveGroupNotify:function(e,t){if((0,n.hasClass)((0,n.geByClass1)("_ui_toggler",e),"ui_toggler_disable"))return!1;(0,n.toggleClass)((0,n.geByClass1)("_ui_toggler",e),"on");var o={act:"a_save_group_notify",hash:cur.options.notify_hash,gid:t};(0,i.each)((0,n.geByClass)("ui_toggler",(0,n.domClosest)("wide_column",e)),(function(e,t){o[t.getAttribute("data-id")]=+(0,n.hasClass)(t,"on")})),clearTimeout(cur.instantNotifyTO),clearTimeout(cur.instantNotifySaveTO),cur.instantNotifyTO=setTimeout(ajax.post.pbind("al_settings.php",o,{onDone:function(){cur.instantNotifySaveTO=setTimeout(window.uiPageBlock&&uiPageBlock.showSaved.pbind(e),1e3)}}),500),TopNotifier&&TopNotifier.invalidate()},checkboxSiteNotify:function(e,t){t.target&&(0,n.hasClass)(t.target,"item_sel")||((0,l.checkbox)(e),D.saveSiteNotify(e))},saveMailNotify:function(e){var t={act:"a_save_mail_notify",hash:cur.options.notify_hash,mail_period:Privacy.getValue("mail_period")};(0,i.each)(cur.options.notify_mail_keys,(function(e,o){t[o]=(0,l.isChecked)(o)?1:0})),clearTimeout(cur.mailNotifyTO),cur.mailNotifyTO=setTimeout(ajax.post.pbind("al_settings.php",t,{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind(e)}),500)},saveNotifyPrivacyKey:function(e,t){"browser_notification"===e?D.saveBrowserNotify(t):"mail_period"===e?(D.saveMailNotify("privacy_edit_"+e),3==Privacy.getValue(e)?(0,n.hide)("mail_options"):(0,n.show)("mail_options")):cur.options.notify_privacy_keys&&~cur.options.notify_privacy_keys.indexOf(e)?D.saveSiteNotify("privacy_edit_"+e):"sms_pm_notify"===e&&(0!=Privacy.getValue(e)?(0,n.hide)("sms_pm_privacy_row"):(0,n.show)("sms_pm_privacy_row"))},initNotify:function(){cur.options.msg&&D.showMsg(cur.options.msg);var e=(0,n.geByClass1)("_settings_isounds");(0,n.toggleClass)(e,"on",!p.default.get("sound_notify_off")),(0,n.removeClassDelayed)(e,"no_transition"),cur.reloadOnMailBind=!0,cur.onPrivacyChanged=D.saveNotifyPrivacyKey;for(var t=[],o=24;o--;)t.unshift((o<10?"0":"")+o+":00");var s=(0,n.ge)("daytime_from"),i=(0,n.ge)("daytime_to");s&&i&&(void 0!==cur.options.time_from&&new Dropdown(s,t,{selectedItems:cur.options.time_from}),void 0!==cur.options.time_to&&new Dropdown(i,t,{selectedItems:cur.options.time_to}))},smsNotifyCheck:function(){(0,l.isChecked)("smsenabled")?(slideDown((0,n.ge)("sms_options"),200),(0,n.show)("sms_options_msg")):(0,n.isVisible)("sms_options")&&((0,n.hide)("sms_options_msg"),slideUp((0,n.ge)("sms_options"),200))},smsDayTimeCheck:function(){(0,l.isChecked)("daytime")?slideDown((0,n.ge)("daytime_from_to"),200):slideUp((0,n.ge)("daytime_from_to"),200)},checkPIN:function(e){var t=e.value.replace(/[^0-9]/g,"");e.value!==t&&(e.value=t)},updatePIN:function(e){(0,l.lockButton)((0,n.ge)("pin_btn")),(0,n.val)("settings_pin_result","");var t={act:"a_change_pin",pin:(0,n.ge)("pin").value,hash:e};ajax.post("al_settings.php",t,{onDone:function(e){(0,l.unlockButton)((0,n.ge)("pin_btn")),(0,n.val)("settings_pin_value",t.pin),(0,a.showMsg)("settings_pin_result",e,"ok_msg",!0)},onFail:function(e){return(0,l.unlockButton)((0,n.ge)("pin_btn")),(0,a.showMsg)("settings_pin_result",e,"error",!0),!0}})},getAdminSelectShowCt:function(e){return Object.keys(e).filter((function(t){return e[t]})).length},initMenuBox:function(e,t,o){this.initMenuEvents(e),e.setOptions({onHide:function(){cur.adminGroupsDirty&&(window.Notifier&&Notifier.resetCommConnection(),ajax.post("al_settings.php",{act:"a_get_left_menu"},{onDone:function(e){(0,n.geByTag1)("ol",(0,n.ge)("side_bar")).innerHTML=e}})),2==t&&(0,i.isFunction)(cur.settingsBoxSetLeftMenuAppCallback)&&cur.settingsBoxSetLeftMenuAppCallback(!1)}}),cur.menuSettings=o,this.updateMenuBoxCount(t)},initMenuEvents:function(e){var t=(0,n.geByClass1)("olist",e.bodyNode),o=(0,n.geByClass1)("summary_tabs",e.bodyNode);(0,n.setStyle)(o,"display","inline-block");var s=(0,n.getSize)(o)[0]+parseInt((0,n.getStyle)(o,"marginLeft"))+parseInt((0,n.getStyle)(o,"marginRight"));s>450&&e.setOptions({width:Math.ceil(s)}),(0,n.setStyle)(o,"display",null),(0,c.addEvent)(t,"scroll",this.onMenuBoxScroll.pbind(e,t)),this.onMenuBoxScroll(e,t)},onMenuBoxScroll:function(e,t){var o=(0,n.domPN)(e.bodyNode),s=t.scrollHeight,i=t.scrollTop,a=t.offsetHeight||t.clientHeight;(0,n.toggleClass)(o,"olist_topsh",i>0),(0,n.toggleClass)(o,"olist_botsh",i+a<s)},updateMenuBoxCount:function(e){var t=curBox(),o=cur.menuSettings[e]||{},s=D.getAdminSelectShowCt(o),n="";if(1==e||2==e){var i=cur.menuSettings.limits[e];n='<span class="settings_menu_box_counter">'+(0,u.getLang)("settings_admin_groups_left").replace("{count}",s).replace("{amt}",i)+"</span>"}t.setControlsText(n)},toggleMenuBoxRow:function(e,t,o){var s=cur.menuSettings[t]||{},i=D.getAdminSelectShowCt(s),a=s[o];if(curBox().changed=!0,1==t||2==t){var r=cur.menuSettings.limits[t];if((0,n.toggleClass)((0,n.gpeByClass)("olist_section",e),"settings_menu_rows_disabled",!a&&i>=r-1),!a&&i>=r)return!1}return(0,n.toggleClass)(e,"olist_item_wrap_on",!a),s[o]=a?0:1,D.updateMenuBoxCount(t),!1},switchMenuBoxSection:function(e,t){var o=curBox();(0,i.each)((0,n.geByClass)("olist_section",o.bodyNode),(function(){(0,n.hide)(this)})),(0,n.show)("settings_menu_"+t),(0,n.geByClass1)("olist",o.bodyNode).scrollTop=0,D.updateMenuBoxCount(t)},saveMenu:function(e,t){for(var o=curBox(),s=[],a=[],r=[],c=[],u={hash:e,act:"a_change_services"},d=!1,p=function(e){var t=cur.menuSettings[e]||{};(0,i.each)(t,(function(t,o){switch(e){case 1:o&&a.push(t);break;case 2:r.push(t),o&&(cur.aid==t&&(d=!0),s.push(t));break;case 3:o||c.push(t);break;default:u[t]=o}}))},_=0;_<=3;_++)p(_);r.length&&(u.apps_all=r.join(","),u.apps_on=s.join(",")),u.groups_list=a.join(","),u.service_hidden=c.join(","),ajax.post("al_settings.php",u,{onDone:function(e){(0,n.geByTag1)("ol",(0,n.ge)("side_bar")).innerHTML=e,window.uiPageBlock&&uiPageBlock.showSaved("settings_services"),(0,i.isFunction)(cur.settingsBoxSetLeftMenuAppCallback)&&cur.settingsBoxSetLeftMenuAppCallback(d),o.hide(),window.Apps&&window.Apps.updateAddToMenuAction()},showProgress:l.lockButton.pbind(t),hideProgress:l.unlockButton.pbind(t)})},giftsCheck:function(){clearTimeout(cur.giftsUpdateTO),cur.giftsUpdateTO=setTimeout(D.giftsSubmit,200)},giftsSubmit:function(){ajax.post("/al_profile.php",{act:"hide_gifts",hash:cur.options.hide_gifts_hash,shown:(0,n.ge)("settings_hide_gifts").checked?0:1},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},gifCheck:function(){clearTimeout(cur.gifUpdateTO),cur.gifUpdateTO=setTimeout(D.gifSubmit,200)},gifSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_autoplay_gif",hash:cur.options.gif_autoplay_hash,no_autoplay:(0,n.ge)("settings_gif_autoplay").checked?0:1},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},accessCheck:function(){clearTimeout(cur.accessUpdateTO),cur.accessUpdateTO=setTimeout(D.accessSubmit,200)},accessSubmit:function(){ajax.post("/al_settings.php",{act:"a_toggle_access_mode",hash:cur.options.a11y_hash,mode:(0,i.intval)((0,n.ge)("settings_a11y").checked)},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("settings_a11y")})},stickersHintsCheck:function(){clearTimeout(cur.stickersHintsTO),cur.stickersHintsTO=setTimeout(D.stickersHintsSubmit,200)},stickersHintsSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_stickers_hints",hash:cur.options.stickers_hints_hash,hints:(0,n.ge)("settings_stickers_hints").checked?1:0},{onDone:function(){window.uiPageBlock&&uiPageBlock.showSaved("cposts"),window.Emoji&&Emoji.updateTabs.apply(window,arguments)}})},autoUnarchiveCheck:function(){clearTimeout(cur.autoUnarchiveTO),cur.autoUnarchiveTO=setTimeout(D.autoUnarchiveSubmit,200)},autoUnarchiveSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_auto_unarchive",hash:cur.options.auto_unarchive_hash,unarchive:(0,n.ge)("settings_auto_unarchive").checked?1:0},{onDone:function(){window.uiPageBlock&&uiPageBlock.showSaved("cposts"),window.Emoji&&Emoji.updateTabs.apply(window,arguments)}})},videoCheck:function(){clearTimeout(cur.videoUpdateTO),cur.videoUpdateTO=setTimeout(D.videoSubmit,200)},videoSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_autoplay_video",hash:cur.options.video_autoplay_hash,video_autoplay:(0,n.ge)("settings_video_autoplay").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},videoShowcaseCheck:function(){clearTimeout(cur.videoShowcaseUpdateTO),cur.videoShowcaseUpdateTO=setTimeout(D.videoShowcaseSubmit,200)},videoShowcaseSubmit:function(){ajax.post("/al_settings.php?act=a_change_video_showcase",{hash:cur.options.video_showcase_hash,video_showcase:(0,n.ge)("settings_video_showcase").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},videostartCheck:function(){clearTimeout(cur.videostartUpdateTO),cur.videostartUpdateTO=setTimeout(D.videostartSubmit,200)},videostartSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_autostart_video",hash:cur.options.video_autostart_hash,video_autostart:(0,n.ge)("settings_video_autostart").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},hintachCheck:function(){clearTimeout(cur.hintachUpdateTO),cur.hintachUpdateTO=setTimeout(D.hintachSubmit,200)},hintachSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_hintach",hash:cur.options.hintach_hash,hintach:(0,n.ge)("settings_hintach").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},drCheck:function(){clearTimeout(cur.drUpdateTO),cur.drUpdateTO=setTimeout(D.drSubmit,200)},drSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_dr",hash:cur.options.dr_hash,dr:(0,n.ge)("settings_dr").checked?1:0},{onDone:nav.reload.pbind()})},externalAuthCheck:function(){clearTimeout(cur.externalAuthUpdateTO),cur.externalAuthUpdateTO=setTimeout((function(){ajax.post("al_settings.php",{act:"a_change_external_auth",hash:cur.options.external_auth_hash,state:(0,n.ge)("settings_external_auth").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})}),200)},videoadsCheck:function(){clearTimeout(cur.videoadsUpdateTO),cur.videoadsUpdateTO=setTimeout(D.videoadsSubmit,200)},videoadsSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_ads_video",hash:cur.options.video_ads_hash,video_ads:(0,n.ge)("settings_video_ads").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},vkPayEndpointCheck:function(){clearTimeout(cur.vkPayEndpointUpdateTO),cur.vkPayEndpointUpdateTO=setTimeout(D.vkPayEndpointSubmit,200)},vkPayEndpointSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_vk_pay_endpoint",hash:cur.options.vk_pay_endpoint_hash,vk_pay_endpoint:(0,n.ge)("settings_vk_pay_endpoint").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},microblogCheck:function(e){(0,n.hasClass)((0,n.ge)("settings_"+e),"disabled")||(0,n.ge)("settings_"+e).disabled||(clearTimeout(cur.microblogUpdateTO),cur.microblogUpdateTO=setTimeout(D.microblogSubmit,200))},microblogSubmit:function(){var e={act:"a_change_microblog",hash:cur.options.microblog_hash};(0,i.each)(["status_default","no_wall_replies"],(function(t,o){var s=(0,n.ge)("settings_"+o);s&&(e[o]=s.checked?1:0)})),ajax.post("/al_settings.php",e,{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},photoTagFriendsCheck:function(){clearTimeout(cur.photoAutoTagFriendsUpdateTO),cur.photoAutoTagFriendsUpdateTO=setTimeout(D.photoTagFriendsSubmit,200)},recognitionUserBlockCheck(){clearTimeout(cur.recognitionUserBlockUpdateTO),cur.recognitionUserBlockUpdateTO=setTimeout(D.recognitionUserBlockSubmit,200)},recognitionFriendsBlockCheck(){clearTimeout(cur.recognitionFriendsBlockUpdateTO),cur.recognitionFriendsBlockUpdateTO=setTimeout(D.recognitionFriendsBlockSubmit,200)},recognitionUserBlockSubmit(){ajax.post("/al_settings.php",{act:"toggle_user_recognition_block",hash:cur.options.recognition_user_hash,enabled:(0,n.ge)("settings_recognition_user").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},recognitionFriendsBlockSubmit(){ajax.post("/al_settings.php",{act:"toggle_friends_recognition_block",hash:cur.options.recognition_friends_hash,enabled:(0,n.ge)("settings_recognition_friends").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},photoTagFriendsSubmit:function(){ajax.post("/al_settings.php",{act:"a_change_autotag_friends",hash:cur.options.autotag_friends_hash,autotag_friends:(0,n.ge)("settings_autotag_friends").checked?1:0},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("cposts")})},OTPAuthEnable:function(e){return showBox("al_settings.php",{act:"otp_auth_box",confirm:e,hash:cur.options.otp_hash},{params:{dark:!0}}),!1},OTPAuthAppSet:function(e){var t={act:"otp_auth_app_box"};return e?(curBox().hide(),t.force=1,t.hash=e):t.hash=cur.options.otp_hash,showBox("al_settings.php",t),!1},OTPAuthDisable:function(e){if((0,l.isButtonLocked)(e))return!1;var t={type:"otp_auth",hash:cur.options.otp_hash};ajax.post("al_settings.php?act=a_otp_auth_save",t,{showProgress:()=>(0,l.lockButton)(e),hideProgress:()=>(0,l.unlockButton)(e),onFail:e=>void 0!==e&&(0,h.showErrorBox)(e)})},OTPAuthAppDisable:function(){if((0,n.isVisible)(curBox().progress))return!1;var e={type:"otp_auth_by_app",hash:cur.options.otp_hash};ajax.post("al_settings.php?act=a_otp_auth_save",e,{showProgress:curBox().showProgress,hideProgress:curBox().hideProgress,onDone:function(){(0,n.addClass)("settings_otp_auth_app_set","settings_otp_app_disabled"),(0,n.val)("settings_otp_auth_app_set_link",(0,u.getLang)("settings_otp_auth_by_app_enable")),curBox().hide()}})},OTPAuthShowReserveCodes:function(e,t){return showBox("al_settings.php",{act:"otp_auth_reserve_codes_box",hash:e,force_new:t?1:0},{params:{dark:!0}}),!1},OTPAuthGetTrusted:function(e){var t=(0,n.ge)("settings_otp_auth_trusted");if(t&&(0,n.isVisible)(t)&&(e||(0,n.geByTag1)("img",t))){var o=vk.loginscheme!=location.protocol.substr(0,location.protocol.length-1)?1:0;ajax.post(vk.loginscheme+"://"+location.host+"/al_login.php",{act:"is_trusted_browser",_http:o},{frame:o,onDone:function(e){t.innerHTML=e}})}},OTPAuthClearTrusted:function(e,t,o){var s=!1,i=e.getAttribute("confirm"),a=null==e?void 0:e.parentNode;function r(){if(!t&&cur.options.otp_reset_hash)return cur.onReLoginDoneCallback=function(){var e=(0,n.ge)("settings_reset_sessions_link");e&&(e.parentNode.innerHTML='<div class="settings_labeled_notice">'+(0,u.getLang)("setting_all_sessions_reset")+"</div>")},D.reset_sessions=!1,D.resetAllSessions(e,'<input name="otp_reset_hash" value="'+cur.options.otp_reset_hash+'" type="hidden" />',e.getAttribute("complete")),void(s&&s.hide());if(cur.options.new_reset_cur_browser)cur.onReLoginDoneCallback=function(){s&&s.hide(),a.innerHTML='<div class="settings_labeled_notice">'+e.getAttribute("complete")+"</div>"},D.reset_sessions=!1,D.resetAllSessions(e,`<input name="reset_cur_session_hash" value="${o}" type="hidden" />`,e.getAttribute("complete"),!0);else{var i=(0,n.ce)("img",{src:"/images/upload"+(window.devicePixelRatio>=2?"_2x":"")+".gif"},{width:32}),r=vk.loginscheme!=location.protocol.substr(0,location.protocol.length-1)?1:0;ajax.post(vk.loginscheme+"://"+location.host+"/al_login.php",{act:"clear_trusted_browsers",only_cur:t,hash:o,_http:r},{frame:r,onDone:function(t){s&&s.hide(),e.parentNode.innerHTML='<div class="settings_labeled_notice">'+e.getAttribute("complete")+"</div>"},showProgress:function(){s?s.showProgress():e.parentNode.replaceChild(i,e)},hideProgress:function(){s?s.hideProgress():i.parentNode.replaceChild(e,i)}})}}i?(i=i.split("<!!>"),s=(0,f.showFastBox)({title:i[0],dark:1,bodyStyle:"padding: 20px;"},i[1],i.length>2?i[2]:(0,u.getLang)("box_yes"),r)):r()},OTPAppPasswords:function(){return showBox("al_settings.php",{act:"otp_auth_app_passwords_box"},{params:{dark:!0}}),!1},OTPCreateAppPassword:function(e,t){if(!(0,l.isButtonLocked)(e)){var o=(0,n.val)("settings_app_password_name");o.length?((0,n.val)("settings_app_passwords_error",""),ajax.post("al_settings.php",{act:"a_otp_auth_create_app_password",name:o,hash:t},{onDone:function(e,t,o){(0,f.showFastBox)({title:e,width:450},t),(0,n.ge)("settings_app_passwords_table_wrap").innerHTML=o,(0,n.hide)("settings_app_passwords_empty"),(0,n.val)("settings_app_password_name","")},onFail:function(e){return e&&(0,a.showMsg)("settings_app_passwords_error",e,"error",!0),!0},showProgress:l.lockButton.pbind(e),hideProgress:l.unlockButton.pbind(e)})):(0,l.notaBene)("settings_app_password_name")}},OTPRemoveAppPassword:function(e,t,o){return ajax.post("al_settings.php",{act:"a_otp_auth_remove_app_password",id:t,hash:o},{onDone:function(){(0,n.re)("settings_app_password"+t),(0,n.geByTag)("tr","settings_app_passwords_table_wrap").length<=1&&((0,n.ge)("settings_app_passwords_table_wrap").innerHTML="",(0,n.show)("settings_app_passwords_empty"))},showProgress:function(){(0,l.showProgress)(e.parentNode),(0,n.hide)(e)},hideProgress:function(){(0,l.hideProgress)(e.parentNode),(0,n.show)(e)}}),!1},passwordDone:function(e,t){var o;(0,n.re)(cur.pwchFrame),(0,l.unlockButton)(cur.pwchDestroy),cur.pwchFrame=!1;var s="settings_new_pwd";switch(e){case 1:o="settings_cant_set_this_password";break;case-2:o="settings_oldpwd_notcorr",s="settings_old_pwd";break;case-3:o="settings_newpwd_not_good",s="settings_new_pwd";break;case 2:return(0,n.hide)("settings_error_pwd"),(0,n.val)((0,n.geByClass1)("settings_labeled_text","chgpass"),(0,u.getLang)("settings_pass_update_just_now")),(0,n.val)("settings_old_pwd",""),(0,n.val)("settings_new_pwd",""),(0,n.val)("settings_confirm_pwd",""),D.toggleBlock("chgpass"),D.showMsg((0,u.getLang)("settings_pass_success")),void(cur.pwchCaptchaBox&&(cur.pwchCaptchaBox.hide(),cur.pwchCaptchaBox=!1));case-1:return void(cur.pwchCaptchaBox=showCaptchaBox(t,1,cur.pwchCaptchaBox,{onSubmit:D.passwordSubmit.pbind(cur.pwchDestroy),onDestroy:function(){}}));default:o="settings_cant_change_password"}cur.pwchCaptchaBox&&(cur.pwchCaptchaBox.hide(),cur.pwchCaptchaBox=!1),D.showError((0,u.getLang)(o),"pwd"),(0,l.notaBene)(s)},passwordSubmit:function(e,t,o){var s=(0,n.val)("settings_old_pwd"),i=(0,n.val)("settings_new_pwd"),a=(0,n.val)("settings_confirm_pwd"),r=(0,n.ge)("settings_pwd_tt_place").tt;if(!cur.pwchFrame)if(s)if(i)if(a){if(r&&r.hide({fasthide:!0}),i.match(/\s/))return D.showError((0,u.getLang)("settings_pwd_bad"),"pwd"),(0,l.notaBene)("settings_new_pwd"),void(r&&setTimeout(r.show,10));if(i.length<6)return D.showError((0,u.getLang)("settings_pwd_bad"),"pwd"),(0,l.notaBene)("settings_new_pwd"),void(r&&setTimeout(r.show,10));if(a!=i)return D.showError((0,u.getLang)("settings_newpwd_notcorr"),"pwd"),(0,l.notaBene)("settings_confirm_pwd"),void(r&&setTimeout(r.show,10));cur.pwchDestroy||cur.destroy.push((function(e){(0,n.re)(e.pwchFrame)})),cur.pwchDestroy=e,curBox()||(0,l.lockButton)(cur.pwchDestroy);var c={act:"changepass",_origin:locProtocol+"//"+locHost,pass:s,new_pass:i};t&&o&&(c.captcha_sid=t,c.captcha_key=o),c.phash=cur.options.phash,cur.pwchDone=D.passwordDone,cur.pwchFrame=utilsNode.appendChild((0,n.ce)("iframe",{src:(0,g.getLoginDomain)()+"?"+AjaxConvert.toQueryString(c)}))}else(0,l.notaBene)("settings_confirm_pwd");else(0,l.notaBene)("settings_new_pwd");else(0,l.notaBene)("settings_old_pwd")},mailSubmit:function(e,t){var o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=s?"settings_new_notify_mail":"settings_new_mail",u=s?"notify_mail":"mail",d=s?"settings_error_notify_mail":"settings_error_mail",p=s?"a_bind_notify_mail":"a_bind_mail",_=s?"chgnotifymail":"chgmail";if(t||a)o="",(0,n.re)(e);else{if(!(o=(0,i.trim)((0,n.val)(c))))return void(0,l.notaBene)(c);(0,l.lockButton)(e)}var g={act:p,email:o,is_new:a?0:1,hash:cur.options.mail_hash};return a&&(g.delete=!0),(0,n.ge)(c).blur(),(0,n.hide)(d),ajax.post("al_settings.php",g,{onDone:function(t,o){if((0,l.unlockButton)(e),o){var s=(0,n.ge)(_);s.parentNode.replaceChild((0,n.se)(o),s)}["email_soft_bouncing","email_not_working"].forEach((e=>{var t=document.getElementById(e);t&&t.remove()})),(0,n.ge)(c).value="",showDoneBox(t,{out:4e3,w:400}),a&&r&&r()},onFail:function(t){if((0,l.unlockButton)(e),!(0,i.isUndefined)(t)){var o=void 0!==t.message?t.message:t;D.showError(o,u)}return a&&r&&r(),!0}}),!1},notifyMailRemove:function(e,t,o){var s=(0,f.showFastBox)(t,o,(0,u.getLang)("global_delete"),(()=>{this.mailSubmit(e,!1,!0,!0,(()=>{s.hide()}))}),(0,u.getLang)("box_cancel"));return!1},phoneSubmit:function(){showBox("activation.php",{act:"change_phone_box",hash:cur.options.phone_hash})},regionalSubmit:function(e){var t=((0,n.ge)("timezone")||{}).value,o={act:"a_change_regional",timeoffset:t,hash:cur.options.regional_hash||cur.options.regional_hashes[t]};(0,l.lockButton)(e),ajax.post("al_settings.php",o,{onDone:function(t){(0,l.unlockButton)(e),D.showMsg(t)},onFail:function(t){return(0,l.unlockButton)(e),D.showError(t),!0}})},reset_sessions:!1,resetAllSessions:function(e,t,o){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(D.reset_sessions)return!1;D.reset_sessions=!0;var a=bodyNode.appendChild((0,n.ce)("div",{innerHTML:`<form action="${(0,g.getLoginDomain)()}" method="POST" target="reset_sessions_frame">\n  <input name="_origin" value="${locProtocol+"//"+locHost}" type="hidden" />\n  <input name="role" value="al_frame" type="hidden" />\n  <input name="ip_h" value="${vk.ip_h}" type="hidden" />\n  ${s?"":`<input name="reset_hash" value="${cur.options.reset_hash}" type="hidden" />`}\n  ${void 0!==t?t:""}\n</form><iframe class="upload_frame" name="reset_sessions_frame"></iframe>`})),r=a.firstChild,c=(0,n.ce)("img",{src:"/images/upload"+(window.devicePixelRatio>=2?"_2x":"")+".gif"},{width:32});return window.onReLoginDone=function(t,s,r){if((0,n.re)(a),"object"==typeof s&&(s=r),cur.options.reset_hash=s,e)!0!==e&&c.parentNode.replaceChild((0,n.ce)("div",{className:"settings_labeled_notice",innerHTML:o||(0,u.getLang)("setting_all_sessions_reset")}),c);else{var l=curBox();l&&(l.hideProgress(),l.setControlsText((0,u.getLang)("setting_all_sessions_reset")));var d=0;(0,i.each)((0,n.ge)("activity_history").childNodes,(function(e,t){1===t.nodeType&&(d>0&&!(0,n.hasClass)(t,"settings_old_session")&&((0,n.addClass)(t,"settings_old_session"),(0,n.re)((0,n.geByClass1)("settings_cur_session",t))),d++)}))}(0,i.isFunction)(cur.onReLoginDoneCallback)&&cur.onReLoginDoneCallback(),D.reset_sessions=!1},e?!0!==e&&e.parentNode.replaceChild(c,e):curBox().showProgress(),r.submit(),!1},resetSession:function(e,t,o){var s={reset_data:t,hash:o},i=function(t){var o=document.querySelector('.settings_history_row[data-id="'+e+'"]');(0,n.addClass)(o,"settings_old_session"),(0,n.re)(document.querySelector("._settings_reset_session"+e)),showDoneBox(t)},a=(0,u.getLang)("settings_activity_session_reset_box_title"),r=(0,u.getLang)("settings_activity_session_reset_box_text"),c=(0,u.getLang)("settings_activity_session_reset_box_button");(0,f.showFastBox)(a,r,c,(function(){ajax.post("/settings?act=a_reset_session",s,{onDone:i}),curBox().hide()}),(0,u.getLang)("global_cancel"))},ipTTClick:function(e,t){(0,c.cancelEvent)(t);var o=document.createRange();o.selectNodeContents(e);var s=getSelection();s.removeAllRanges(),s.addRange(o),document.execCommand("copy"),s.removeAllRanges()},showUserClientTT:function(e,t){var o="";(0,n.hasClass)(e.parentNode.parentNode,"settings_old_session")&&(o='<div style="font-weight:bold; margin-bottom:5px;">'+(0,u.getLang)("settings_session_terminated")+"</div>"),cur.options.ua_tooltips[t]&&(o+=cur.options.ua_tooltips[t]),o&&(0,m.showTooltip)(e,{text:o,dir:"auto",slide:15,className:"settings_user_client_tt",hasover:1})},disabledPrivacy:function(){var e=(0,n.geByClass1)("settings_privacy_add_replies_view",(0,n.ge)("content"));e&&(0,m.showTooltip)(e,{black:!0,hasover:1,className:"settings_comments_disabled_tt",shift:[0,5],text:(0,u.getLang)("settings_comments_disabled_tt").replace("{link}",'<a href="/settings?f=cposts" onclick="return nav.go(this, event, {nocur: true})">').replace("{/link}","</a>")})},checkAddress:function(e){cur.addrUnchecked=0,clearTimeout(cur.addressCheckTO),cur.lastAddress!=(0,n.val)("settings_addr")&&(cur.addressCheckTO=setTimeout(D.doCheckAddress,e||0))},doCheckAddress:function(){var e=(0,n.ge)("settings_address_submit");cur.lastAddress=(0,n.val)("settings_addr"),ajax.post("al_settings.php",{act:"a_check_address",name:cur.lastAddress},{onDone:function(t){cur.addrChecked=1,(0,l.disableButton)(e,!1),e.innerHTML=t},onFail:function(t){return cur.addrChecked=-1,e.innerHTML=t,(0,l.disableButton)(e,!0),!0},showProgress:function(){(0,l.lockButton)(e),(0,l.disableButton)(e,!1)},hideProgress:function(){(0,l.unlockButton)(e)}})},addressSubmit:function(e){1==cur.addrChecked?((0,l.lockButton)(e),ajax.post("al_settings.php",{act:"a_change_address",hash:cur.options.address_hash,name:(0,n.val)("settings_addr")},{onDone:function(t){(0,l.unlockButton)(e),D.showMsg(t)},onFail:function(t){return(0,l.unlockButton)(e),t&&D.showError(t,"addr"),!0}})):(0,l.notaBene)("settings_addr")},init:function(){cur.checkboxResultsTOs={},cur.module="settings",cur.options.msg?D.showMsg(cur.options.msg):cur.options.err&&D.showError(cur.options.err),(0,i.each)({settings_status_default:(0,u.getLang)("settings_status_default_about"),settings_no_wall_replies:(0,u.getLang)("settings_no_wall_replies_about"),settings_video_autoplay:(0,u.getLang)("settings_video_autoplay")},(function(e,t){(e=(0,n.domQuery1)('label[for="'+e+'"]'))&&(e.onmouseover=function(){(0,m.showTooltip)(this,{shift:[-20,8,8],dir:"auto",text:t,slide:15,className:"settings_tt",hasover:1})})}));var e=(0,n.ge)("settings_pwd_tt_place");(0,i.each)([(0,n.ge)("settings_new_pwd"),(0,n.ge)("settings_confirm_pwd")],(function(){this&&(this.onfocus=function(){(0,m.showTooltip)(e,{text:(0,u.getLang)("settings_password_about"),dir:"left",slideX:15,className:"settings_pwd_tt",shift:[-12,-15,0],onCreate:function(){(0,c.removeEvent)(e,"mouseout")}})},this.onblur=function(){e.tt&&e.tt.hide&&e.tt.hide()})}));var t=(0,n.ge)("settings_addr");t.onfocus=function(){(0,m.showTooltip)(t,{text:(0,u.getLang)("settings_addr_intro"),dir:"auto",slide:15,className:"settings_toup_tt",shift:[(0,n.getSize)("prefix_input_prefix")[0],10],onCreate:function(){(0,c.removeEvent)(t,"mouseout"),t.onblur=function(){t.tt.hide()}}})},cur.lastAddress=(0,n.val)(t);var o=(0,n.ge)("settings_new_mail");o&&(o.onfocus=function(){(0,m.showTooltip)(o,{text:(0,u.getLang)("settings_email_about"),dir:"auto",slide:15,className:"settings_toup_tt",shift:[0,10],onCreate:function(){(0,c.removeEvent)(o,"mouseout"),o.onblur=function(){o.tt.hide()}}})}),(0,i.extend)(cur,{validationLastCallback:function(e){curBox()&&curBox().hide(),e?D.phoneSubmit():(0,n.elfocus)("settings_new_phone")}}),D.initRepliesOrder(),setTimeout((function(){if(nav.objLoc.f){var e=(0,n.ge)(nav.objLoc.f.split(",")[0]);e&&(0,n.hasClass)(e,"settings_line")&&D.toggleBlock((0,n.domFC)(e))}}),100),cur.destroy.push((function(){window.onLoginDone=nav.reload})),(0,N.initColorSchemeDropdown)()},emailPosts:function(e,t){ajax.post("al_settings.php",{act:"send_email_post",hash:e},{onDone:function(e,o){(0,n.ge)("settings_email_post_msg").innerHTML=e,(0,n.setStyle)((0,n.ge)("settings_email_post_msg"),{borderColor:"#D4BC4C",backgroundColor:"#F9F6E7"}),animate((0,n.ge)("settings_email_post_msg"),{borderColor:"#B9C4DA",backgroundColor:"#FFFFFF"},3e3),t.innerHTML=o},showProgress:function(){(0,l.lockButton)(t)},hideProgress:function(){(0,l.unlockButton)(t)}})},showPaymentsMethods:function(e,t,o,s){var i={act:s?"a_payments_checkout_methods":"a_payments_methods",hash:t};!s&&o&&(i.money_transfer=1);var a=(0,n.ce)("img",{src:"/images/upload.gif"});return ajax.post("al_settings.php",i,{onDone:function(t){if(o)return cur.autoacceptCards=t.cards,cur.autoacceptCardSelected=t.cardSeleceted,void D.initAutoAcceptDD(t.cards,t.cardSeleceted);var s=(0,n.ce)("div",{innerHTML:t,className:"unshown"});e.parentNode.replaceChild(s,e),slideDown(s,100)},showProgress:function(){e.parentNode.replaceChild(a,e)},hideProgress:function(){a.parentNode.replaceChild(e,a)},stat:o?["ui_controls.js","ui_controls.css"]:[]}),!1},initAutoAcceptDD:function(e,t){cur.autoacceptCardDD=new InlineDropdown("settings_p2p_receive_card",{items:e,selected:t,withArrow:!0,onSelect:function(e){if(-1==e)D.bindMoneyTransferCard();else if(e!=cur.autoacceptCardSelected){var t=cur.autoacceptCardDD.getSelected()[2];D.saveMoneyTransferCard(e,t),cur.autoacceptCardSelected=e}}})},saveMoneyTransferCard:function(e,t){ajax.post("al_payments.php",{act:"a_remember_money_transfer_accept_card",card_id:e,hash:t,from:"settings"},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("settings_p2p_receive_card")})},bindMoneyTransferCard:function(){return showBox("al_payments.php",{act:"card_payment_box",type:"card_bind"},{stat:["ui_controls.js","ui_controls.css"]}),!1},deletePaymentMethod:function(e,t,o,s,n,i){if(s){var a=e.parentNode,r={act:n?"a_del_checkout_method":"a_del_instant_method",type:t,hash:o};return n&&(r.bind_descr=i),ajax.post("al_payments.php",r,{onDone:function(e){a.innerHTML=e},onFail:function(e){return a.innerHTML=e,!0},showProgress:function(){cur.confirmBox.showProgress()},hideProgress:function(){cur.confirmBox.hide()}}),!1}cur.confirmBox=(0,f.showFastBox)({title:cur.lang.global_action_confirmation,dark:1,forceNoBtn:1,bodyStyle:"padding: 20px; line-height: 160%;"},cur.lang.settings_delete_payment_method_confirm,(0,u.getLang)("global_delete"),(function(){D.deletePaymentMethod(e,t,o,!0,n,i)}),(0,u.getLang)("global_cancel"))},showNextPaymentsHistory:L.showNextPaymentsHistory,switchPaymentsHistoryTab:function(e,t,o){if((0,c.checkEvent)(o))return!0;var s=(0,i.clone)(nav.objLoc);return uiTabs.switchTab(e),D.hideMoneyLinksTooltip(),(0,n.hide)("settings_votes_history_wrap","settings_payments_subscriptions_wrap","settings_transfer_history_wrap","settings_payments_transfer_msg","settings_payments_games_wrap"),"transfer"===t?((0,n.show)("settings_transfer_history_wrap","settings_payments_transfer_msg"),s.section=t,D.showMoneyLinksTooltip()):"subscriptions"===t?((0,n.show)("settings_payments_subscriptions_wrap"),s.section=t):"games"===t?((0,n.show)("settings_payments_games_wrap"),s.section=t):((0,n.show)("settings_votes_history_wrap"),delete s.section),nav.setLoc(s),!1},moneyTransferCancel:function(e,t,o,s,i){var a,r,c=(0,n.domClosest)("_row",e),l=(0,n.geByClass1)("_status",c);if(!i)return s?(a=(0,u.getLang)("settings_transfer_decline_confirm"),r=(0,u.getLang)("settings_transfer_decline_btn")):(a=(0,u.getLang)("settings_transfer_cancel_confirm"),r=(0,u.getLang)("settings_transfer_cancel_btn")),void(cur.confirmBox=(0,f.showFastBox)((0,u.getLang)("global_action_confirmation"),a,r,D.moneyTransferCancel.pbind(e,t,o,s,1),(0,u.getLang)("global_cancel")));2!==i&&((0,n.addClass)(c,"settings_history_row_progress"),cur.confirmBox&&cur.confirmBox.hide()),ajax.post("al_payments.php?act=a_cancel_money_transfer",{tx_id:t,hash:o},{onDone:function(e,a){if(0===e)return 2!==i&&((0,n.val)(l,(0,u.getLang)("settings_transfer_status_cancelling")),(0,n.removeClass)(l,"settings_transfer_receive")),void setTimeout(D.moneyTransferCancel.pbind(c,t,o,s,2),2e3);(0,n.removeClass)(c,"settings_history_row_progress"),(0,n.val)(l,(0,u.getLang)("settings_transfer_status_cancelled")),(0,n.removeClass)(l,"settings_transfer_receive"),(0,n.addClass)(l,"settings_transfer_status_cancelled"),TopNotifier.invalidate()},onFail:function(e){return(0,n.removeClass)(c,"settings_history_row_progress"),setTimeout((0,f.showFastBox)((0,u.getLang)("global_error"),e).hide,2e3),!0}})},moneyTransferRepeat:function(e,t){return B.MoneyTransfer.showMoneyTransferBox({repeat_id:e,hash:t}),!1},paymentsSubscriptionBox:function(e,t,o,s){if(s){var i=(0,n.domClosest)("_row",s);cur.onSubscriptionDone=function(e){var t=(0,n.geByClass1)("settings_history_amount",i);(0,n.val)(t,e.status),(0,n.removeClass)(t,"settings_history_btn"),(0,n.val)((0,n.geByClass1)("settings_history_actions",i),e.actions)}}showBox("al_apps.php?act=show_subscription_box",{aid:e,item:t,action:"create",hash:o},{onFail:function(e){return setTimeout((0,f.showFastBox)((0,u.getLang)("global_error"),e).hide,2e3),!0}})},paymentsSubscriptionCancel:function(e,t,o,s,i){var a=(0,n.domClosest)("_row",e);i?((0,n.addClass)(a,"settings_history_row_progress"),cur.confirmBox&&cur.confirmBox.hide(),ajax.post("al_apps.php?act=a_cancel_subscription",{aid:t,subscription_id:o,hash:s,from:"settings"},{onDone:function(e,t){(0,n.removeClass)(a,"settings_history_row_progress"),e?((0,n.val)((0,n.geByClass1)("settings_history_amount",a),e),(0,n.val)((0,n.geByClass1)("settings_history_actions",a),t)):(0,n.addClass)(a,"settings_history_row_deleted")},onFail:function(e){return(0,n.removeClass)(a,"settings_history_row_progress"),setTimeout((0,f.showFastBox)((0,u.getLang)("global_error"),e).hide,2e3),!0}})):cur.confirmBox=(0,f.showFastBox)((0,u.getLang)("global_action_confirmation"),(0,u.getLang)("settings_subscription_cancel_confirm"),(0,u.getLang)("settings_subscription_cancel_btn"),D.paymentsSubscriptionCancel.pbind(e,t,o,s,1),(0,u.getLang)("global_cancel"))},paymentsSubscriptionReactivate:function(e,t,o,s){var i=(0,n.domClosest)("_row",e);cur.onSubscriptionDone=function(e){(0,n.val)((0,n.geByClass1)("settings_history_amount",i),e.status),(0,n.val)((0,n.geByClass1)("settings_history_actions",i),e.actions)},showBox("al_apps.php?act=show_subscription_box",{aid:t,subscription_id:o,action:"resume",hash:s},{onFail:function(e){return setTimeout((0,f.showFastBox)((0,u.getLang)("global_error"),e).hide,2e3),!0}})},initAppOrdersDD:function(e,t,o){cur.appOrdersDD=new InlineDropdown("settings_app_orders",{items:e,selected:t,onShow:function(){if(cur.appOrdersDD){(0,m.showTooltip)(cur.appOrdersDD._els.popupHeader,{text:(0,u.getLang)("settings_payments_app_orders_tt"),width:250,slideX:-15,className:"pedit_tt",nohide:!0,asrtl:!0,shift:[263,-15,-15],dir:"left"})}},onHide:function(){cur.appOrdersDD&&cur.appOrdersDD._els.popupHeader.tt&&cur.appOrdersDD._els.popupHeader.tt.destroy()},onSelect:function(e){D.toggleAppOrders(e&&"0"!==e,o)}})},toggleAppOrders:function(e,t){ajax.post("al_payments.php?act=a_toggle_app_orders",{autoconfirm:e,hash:t},{onDone:window.uiPageBlock&&uiPageBlock.showSaved.pbind("settings_app_orders")})},initApps:function(e,t){(0,i.extend)(cur,{aSearch:(0,n.ge)("s_search"),lShowMoreButton:(0,n.ge)("ui_apps_load_more"),lContent:(0,n.ge)("settings_apps_list"),aEmptyCont:(0,n.ge)("settings_apps_empty"),aSummaryCounter:(0,n.geByClass1)("page_block_header_count","wide_column"),onSilentLoad:{},apps:{},deletedApps:{},appTpl:t||function(){return""}}),(0,i.extend)(cur,e),cur.defaultCount=cur.shownApps,cur.appTpl=t||function(){return""},D.scrollNode=browser.msie6?pageNode:window,(0,c.addEvent)(D.scrollNode,"scroll",D.scrollCheckApps.bind(this)),setTimeout((function(){cur.destroy.push((function(){(0,c.removeEvent)(D.scrollNode,"scroll",D.scrollCheckApps.bind(D))}))}),0),cur.silent=!0,ajax.post("/al_settings.php",{act:"load_apps_silent"},{cache:1,local:1,onDone:function(e){var t=e;try{e=JSON.parse(e)}catch(e){(0,_.logEvalError)(e,t)}if(!e)return cur.silent=!1;void 0===cur.searchOffset&&(cur.searchOffset=0),cur.curList="all",cur.appsList=e[cur.curList]?e:{all:[]},cur.appsCount=cur.appsList.all.length,this.indexApp((function(){cur.silent=!1,"object"==typeof cur.onSilentLoad&&Object.values(cur.onSilentLoad).forEach((e=>{(0,i.isFunction)(e)&&e()}))}))}.bind(this)})},isDelayedOnSilentLoad:function e(t,o){if(cur.silent)return e.count=e.count||0,e.count++,cur.onSilentLoad[t||"key_"+e.count]=o,!0},indexApp:function(e){cur.appsIndex=new vkIndexer(cur.appsList.all,(function(e){try{return cur.apps[parseInt(e[0])]=e,e[3]}catch(e){return""}}),e)},scrollCheckApps:function(){this.isDelayedOnSilentLoad("scrollCheck",this.scrollCheckApps.bind(this))||!browser.mobile&&!cur.isAppsLoading&&!cur.disableAutoMore&&(0,n.isVisible)(cur.lShowMoreButton)&&(window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight)+(0,r.scrollGetY)()+400>=cur.lShowMoreButton.offsetTop&&this.showAppsRows()},showAppsRows:function(){if(!this.isDelayedOnSilentLoad("showAppsRows",this.showAppsRows.bind(this))&&cur.defaultCount&&cur.shownApps<cur.appsCount){var e=(0,i.clean)(cur.searchStr),t="",o=cur.appsList[cur.curList]||[],s=o.length;if((o=this.filterApps(o.slice(cur.shownApps)).slice(0,cur.defaultCount)).length&&cur.appTpl){var a=[];(0,i.each)(o,(function(e,t){t=(0,i.clone)(t),cur.selection&&(t[3]=t[3].replace(cur.selection.re,cur.selection.val)),a.push(cur.appTpl(t,e==o.length-1,!1))})),t=a.join("")}if(cur.shownApps)t&&cur.lContent.appendChild((0,n.cf)(t));else if(t)cur.lContent.innerHTML=t,cur.aSummaryCounter&&(cur.aSummaryCounter.innerHTML=(0,u.langNumeric)(s,"%s",!0)),(0,n.show)("settings_apps_noempty"),(0,n.hide)(cur.aEmptyCont);else{var r=(0,u.getLang)("settings_apps_not_found_by_query").split("{query}").join("<b>"+e.replace(/([<>&#]*)/g,"")+"</b>");cur.aEmptyCont.innerHTML=r,cur.aSummaryCounter&&(cur.aSummaryCounter.innerHTML=""),(0,n.show)(cur.aEmptyCont),(0,n.hide)("settings_apps_noempty")}cur.shownApps+=cur.defaultCount,cur.shownApps>=cur.appsCount?(0,n.hide)(cur.lShowMoreButton):((0,n.show)(cur.lShowMoreButton),this.scrollCheckApps()),cur.aSearch&&uiSearch.hideProgress(cur.aSearch)}},filterApps:function(e){for(var t=e.length,o=[],s=0;s<t;s++){var n=e[s];cur.apps&&cur.apps[n[0]]&&!cur.apps[n[0]].deleted&&o.push(n)}return o},searchApps:function(e){if(!this.isDelayedOnSilentLoad("searchApps",this.searchApps.bind(this,e))){if(e&&" "==e[e.length-1]&&(e[e.length-1]="_"),e.length<2&&(e=""),cur.ignoreEqual||cur.searchStr!==e){if(cur.searchStr=e||"",e){var t=cur.appsIndex.search((0,i.clean)(e));cur.curList="all_search_"+e,cur.appsList[cur.curList]=t,e+=" "+((0,u.parseLatin)(e)||""),e=(0,i.trim)((0,i.escapeRE)(e).split("&").join("&amp;")),cur.selection={re:new RegExp("("+e.replace(cur.appsIndex.delimiter,"|")+")","gi"),val:'<em class="highlight">$1</em>'}}else cur.curList="all",cur.selection=!1;window.tooltips&&tooltips.hideAll(),cur.aSearch&&uiSearch.showProgress(cur.aSearch),this.scrollToSearch(),(0,n.hide)(cur.lShowMoreButton),cur.loadMore=1,cur.shownApps=cur.searchOffset=0,this.showAppsRows()}delete cur.ignoreEqual}},showAppSettings:function(e){window.tooltips&&tooltips.hideAll(),showBox("/al_apps.php",{act:"settings_box_info",aid:e,from:"profile_settings"},{stat:["apps.css"],dark:1})},removeApp:function(e,t,o,s){if(s&&(0,c.cancelEvent)(s),this.removingApp)return!1;if(this.isDelayedOnSilentLoad("removeApp"+e,this.removeApp.bind(this,e,t,o)))return!1;window.tooltips&&tooltips.hideAll();var i=(0,n.ge)("app"+e),a="profile_settings";(function(){ajax.post("/al_apps.php",{act:"quit",id:e,hash:t,from:a},{onDone:function(t){window.appsListChanged=!0,cur.apps[e]&&(cur.appsIndex.remove(cur.apps[e]),cur.apps[e].deleted=!0),cur.deletedApps[e]={from:a,html:i.innerHTML},i&&i.appendChild((0,n.cf)(t.html)),(0,n.addClass)(i,"deleted")},showProgress:function(){(0,n.addClass)(i,"loading"),this.removingApp=!0}.bind(this),hideProgress:function(){(0,n.removeClass)(i,"loading"),this.removingApp=!1}.bind(this)})}).bind(this)()},restoreApp:function(e,t){if(this.restoringApp)return!1;var o=(0,n.ge)("app"+e);return ajax.post("/al_apps.php",{act:"join",id:e,hash:t,restore:1,from:"al_apps",section:"settings"},{onDone:function(t){cur.deletedApps[e]&&(o.innerHTML=cur.deletedApps[e].html,delete cur.deletedApps[e]),cur.apps[e]&&(delete cur.apps[e].deleted,cur.appsIndex.add(cur.apps[e])),(0,n.removeClass)(o,"deleted")},showProgress:function(){this.restoringApp=!0,(0,n.addClass)(o,"loading")}.bind(this),hideProgress:function(){this.restoringApp=!1,(0,n.removeClass)(o,"loading")}.bind(this)}),!1},ttCommon:function(e,t,o,s,n){return s&&(0,c.cancelEvent)(s),o?(0,m.showTooltip)(e,{center:o,shift:n||[0,8,8],black:1,text:t}):showTitle(e,t,n)},scrollToSearch:function(){var e=(0,n.ge)("page_header_cont"),t=(0,n.ge)("settings_search_wrap");if(t&&e){var o=(0,n.getXY)((0,n.domPN)(t))[1]-(0,n.getSize)(e)[1];scrollNode.scrollTop>o&&(0,r.scrollToY)(o,200)}},deactivateBox:function(){return showBox("al_settings.php",{act:"deactivate_box"},{params:{dark:!0}}),!1},showValidateDevices:function(e,t){return ajax.post("al_settings.php",{act:"a_validate_devices",hash:t},{onDone:function(t){tooltips.hideAll();var o=(0,n.ce)("div",{innerHTML:t,className:"unshown"});e.parentNode.replaceChild(o,e),slideDown(o,100)}}),!1},deleteValidateDevice:function(e,t,o,s){if(s){var n=e.parentNode;return ajax.post("al_settings.php",{act:"a_del_validate_device",dhash:t,hash:o},{onDone:function(e){n.innerHTML=e},showProgress:function(){cur.confirmBox.showProgress()},hideProgress:function(){cur.confirmBox.hide()}}),!1}cur.confirmBox=(0,f.showFastBox)({title:cur.lang.global_action_confirmation,dark:1,forceNoBtn:1,bodyStyle:"padding: 20px; line-height: 160%;"},cur.lang.settings_delete_validate_device_confirm,(0,u.getLang)("global_delete"),(function(){D.deleteValidateDevice(e,t,o,!0)}),(0,u.getLang)("global_cancel"))},showNotifySubscriptions:function(e){return(0,n.hasClass)(e,"settings_no_subscriptions")||showBox("al_settings.php",{act:"notify_subscriptions_box"},{stat:[jsc("web/indexer.js")]}),!1},notifySubscriptionsInit:function(e,t,o){o.onListClick=D.notifySubscriptionToggle,cur.subsOList=new OList(e,t,{},o),e.removeButtons().addButton((0,u.getLang)("global_close"),(function(){e.hide(200)}),"yes")},notifySubscriptionToggle:function(e,t){var o=(0,n.geByClass1)("_subscriptions_count"),s=e.id.match(/-?\d+/)[0],a=!1,r=0;(0,i.each)(cur.subsOList.owners,(function(e,t){cur.subsOList.selected[t[0]]||r++,!1===a&&this[0]==s&&(a=this[4])})),o&&((0,n.toggleClass)(o,"settings_no_subscriptions",!r),(0,n.val)(o,r?(0,u.getLang)("settings_notify_subscriptions_count",r):(0,u.getLang)("settings_notify_no_subscriptions"))),ajax.post("/al_wall.php",{act:"a_toggle_posts_subscription",subscribe:t?1:0,oid:s,hash:a},{showProgress:n.addClass.pbind(e,"olist_item_loading"),hideProgress:n.removeClass.pbind(e,"olist_item_loading")})},showGroupNotifySources:function(e,t){return(0,c.cancelEvent)(e),showBox("al_settings.php",{act:"group_notify_sources_box",source:t},{params:{dark:1,width:450,bodyStyle:"padding: 0",containerClass:"group_notify_sources_box flist_list_radio"}}),!1},initShowGroupNotifySourcesBox:function(e,t){var o=window.cur||{};(0,i.extend)(o,t),e.removeButtons(),e.addButton(t.okBtnText,this.groupNotifyPopupSubmit.bind(this)),(0,i.extend)(o,{popupSubmitBtnEl:curBox().btns.ok[0],popupSelectedGroup:0,popupGroupsWrapperEl:(0,n.geByClass1)("_add_community_app_groups"),popupContentEl:(0,n.geByClass1)("_add_community_app_content")}),(0,l.disableButton)(o.popupSubmitBtnEl,!0),o.popupGroupsEls=(0,n.geByClass)("flist_item",o.popupGroupsWrapperEl,"div"),1===o.popupGroupsEls.length&&this.groupNotifyPopup(o.popupGroupsEls[0]),(0,i.each)(o.popupGroupsEls,function(e,t){(0,c.addEvent)(t,"click",this.groupNotifyPopup.bind(this,t))}.bind(this))},groupNotifyPopup:function(e){var t=(0,i.intval)(e.getAttribute("data-id"));cur.popupSelectedGroup=t,(0,i.each)(cur.popupGroupsEls,(function(t,o){(o===e?n.addClass:n.removeClass)(o.parentNode,"flist_item_checked")})),(0,l.disableButton)(cur.popupSubmitBtnEl,0===cur.popupSelectedGroup)},groupNotifyPopupSubmit:function(){var e=cur.popupSelectedGroup;(0,n.isVisible)(cur.popupSubmitBtnEl)&&!(0,l.isButtonLocked)(cur.popupSubmitBtnEl)&&0!==e&&TopNotifier.addNewSource(e,cur.popup_hash,2)},delGroupNotifySource:function(e,t,o,s){(0,c.cancelEvent)(e);var n=(0,f.showFastBox)((0,u.getLang)("settings_group_notify_disable_title"),(0,u.getLang)("settings_group_notify_disable_text"),(0,u.getLang)("settings_group_notify_disable_yes"),(function(){n.hide(),ajax.post("al_settings.php",{act:"a_group_notify_del_source",gid:t,hash:o},{onDone:function(e){t==s?(TopNotifier&&TopNotifier.changeSource("",null,null),nav.go("/settings?act=notify")):nav.reload()},showProgress:l.lockButton.pbind(cur.popupSubmitBtnEl),hideProgress:l.unlockButton.pbind(cur.popupSubmitBtnEl)})}),(0,u.getLang)("global_cancel"))},addSourcePopup:function(e){(0,n.hide)((0,n.geByClass1)("notify_sources")),TopNotifier&&TopNotifier.hide(),this.showGroupNotifySources(e,"popup")},groupNotify_disabledSetting:function(e){showTitle(e,(0,u.getLang)("settings_group_notify_disable_tooltip"),null,{shift:[-17,14],className:"settings_group_notifications_disable_tooltip",needLeft:1})},initRepliesOrder:function(){var e=(0,n.ge)("settings_replies_order");e&&cur.options.replies_order_items&&(cur.repliesReorderDD=new InlineDropdown(e,{items:cur.options.replies_order_items,selected:cur.options.replies_order_cur||cur.options.replies_order_items[0][0],onSelect:function(e){ajax.post("al_settings.php",{act:"change_replies_order",order:e,hash:cur.options.replies_order_hash},{onDone:function(){window.uiPageBlock&&window.uiPageBlock.showSaved("settings_replies_order")}})}}),cur.options.order_settings_feature_tooltip&&setTimeout((function(){cur.options&&cur.options.order_settings_feature_tooltip_hash&&D.showOrderSettingsTooltip(cur.options.order_settings_feature_tooltip_hash)}),800))},showOrderSettingsTooltip:function(e){var t=(0,n.ge)("settings_replies_order");t&&(cur.orderSettingsFeatureTT=new ElementTooltip(t,{content:'<div class="feature_tooltip__close" onclick="cur.orderSettingsFeatureTT.hide();"></div>'+(0,u.getLang)("wall_order_settings_feature_text"),forceSide:"top",cls:"feature_intro_tt feature_info_tooltip order_settings_feature_tooltip",autoShow:!1,noHideOnClick:!0,noAutoHideOnWindowClick:!0,appendToParent:!0,offset:[0,-4],onHide:function(){ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"order_settings_web"}),cur.orderSettingsFeatureTT.destroy(),delete cur.orderSettingsFeatureTT}}),cur.orderSettingsFeatureTT.show())},showMoneyLinksTooltip:function(){var e=(0,n.geByClass1)("_money_request_btn","wide_column");cur.moneylinks_feature_tooltip&&e&&setTimeout((function(){cur.moneyLinksTooltip=new ElementTooltip(e,{content:'<div class="feature_tooltip__close" onclick="cur.moneyLinksTooltip.hide();"></div>'+(0,u.getLang)("settings_payments_moneylinks_feature_text"),cls:"feature_intro_tt feature_info_tooltip moneylinks_feature_tooltip",forceSide:"top",width:270,autoShow:!1,noHideOnClick:!0,noAutoHideOnWindowClick:!0,appendToParent:!0,offset:[0,-4],onHide:function(){ajax.post("al_index.php",{act:"hide_feature_tt",hash:cur.moneylinks_feature_tooltip_hash,type:"moneylinks"}),D.hideMoneyLinksTooltip()}}),cur.moneyLinksTooltip.show(),cur.destroy.push(D.hideMoneyLinksTooltip)}),1e3)},hideMoneyLinksTooltip:function(){cur.moneyLinksTooltip&&(cur.moneyLinksTooltip.destroy(),delete cur.moneyLinksTooltip)},cancelDonutSubscription:(e,t,o)=>{(0,k.cancelDonutSubscription)(t,o,{onApplyDone:()=>{window.nav.reload({noback:!0})}}),e&&(0,c.cancelEvent)(e)},showGroupMessagesNotifyBox:function(e,t){return(0,c.cancelEvent)(e),showBox("al_settings.php",{act:"group_notify_messages_box",source:t},{params:{dark:1,width:560,bodyStyle:"padding: 0",containerClass:"group_notify_messages_box"}}),!1},initShowGroupMessagesNotifyBox:function(e,t){var o=this,s=window.cur||{};(0,i.extend)(s,t),e.removeButtons(),e.addButton(t.okBtnText,this.submitSettingsGroupMessagesNotifyPopup.bind(this)),e.addButton(t.cancelBtnText,e.hide,"no"),(0,i.extend)(s,{popupGroupRowsWrapperToggler:(0,n.geByClass1)("settings_group_rows_wrapper_toggler"),popupGroupRowsWrapper:(0,n.geByClass1)("settings_group_rows_wrapper"),popupSubmitBtnEl:curBox().btns.ok[0]}),this.toggleSettingsGroupMessagesNotifyRows(!0),s.popupGroupsEls=(0,n.geByClass)("flist_item",s.popupGroupRowsWrapper,"div"),(0,i.each)(s.popupGroupsEls,(function(e,t){(0,c.addEvent)(t,"click",o.changeSettingsGroupMessagesNotifyRowState.bind(o,t))}))},toggleSettingsGroupMessagesNotifyRows:function(e){e||(0,n.toggleClass)(cur.popupGroupRowsWrapperToggler,"on");var t=(0,n.hasClass)(cur.popupGroupRowsWrapperToggler,"on");(0,n.toggleClass)(cur.popupGroupRowsWrapper,"hidden",!t)},changeSettingsGroupMessagesNotifyRowState:function(e){(0,n.toggleClass)(e,"flist_item_checked")},saveGroupMessagesNotifySettings:function(e){var t={is_enabled:e.is_enabled?1:0,groups_map:JSON.stringify(e.groups_map),promo_group_id:cur.gid,hash:cur.popup_hash};clearTimeout(cur.instantNotifyTO),clearTimeout(cur.instantNotifySaveTO),cur.instantNotifyTO=setTimeout(ajax.post.pbind("/settings?act=a_group_messages_notify_save",t,{onDone:e=>{curBox().hide(),cur.instantNotifySaveTO=setTimeout(window.uiPageBlock&&uiPageBlock.showSaved.pbind("settings_notify_group_messages_link"),1e3);var t=(0,n.geByClass1)("settings_separated_row_hint","settings_group_messages_row");t&&(t.innerHTML=e.hint);var o=(0,n.geByClass1)("group-messages-notify-block");o&&e.hide_promo&&slideUp(o,200,n.re.pbind(o))},showProgress:l.lockButton.pbind(cur.popupSubmitBtnEl),hideProgress:l.unlockButton.pbind(cur.popupSubmitBtnEl)}),500),TopNotifier&&TopNotifier.invalidate()},submitSettingsGroupMessagesNotifyPopup:function(){var e={is_enabled:null,groups_map:{}};(0,n.isVisible)(cur.popupSubmitBtnEl)&&!(0,l.isButtonLocked)(cur.popupSubmitBtnEl)&&(e.is_enabled=(0,n.hasClass)(cur.popupGroupRowsWrapperToggler,"on"),(0,i.each)(cur.popupGroupsEls,(function(t,o){e.groups_map[o.getAttribute("data-id")]=(0,n.hasClass)(o,"flist_item_checked")?"1":"0"})),this.saveGroupMessagesNotifySettings(e))},refreshPaymentHistory:function(){var e=document.getElementById("settings_payments_history_panel");if(e){var t={act:"payments_history"};if(nav){var o=nav.fromStr(nav.strLoc).section;o&&(t.section=o)}ajax.post("al_settings.php",t,{onDone:function(t){t&&(e.innerHTML=t)}})}},showPhotoRecognitionBoxSettings(){ajax.post("al_settings.php",{act:"get_recognition_box_data"},{loader:!0,onDone:e=>{var t=(0,v.showComponentInBox)(s.createElement(w.PhotoRecognitionSettingsBox,{data:e,onClose:o,onSave:function(){showDoneBox((0,u.getLang)("photo_recognition_settings_saved")),o()}}),{width:450,onDestroy:e=>{(0,v.destroyComponentInBox)(e)}});function o(){t&&t.hide()}},onFail:e=>((0,f.showFastBox)((0,u.getLang)("global_error"),e||(0,u.getLang)("global_unknown_error")),(0,y.logError)(new Error("get RecognitionBoxSettings error"+(e?`: ${e}`:""))),!0)})},resetSoftBounceDisclaimer(e){var t="";e.dataset.csrf&&(t=String(e.dataset.csrf));var o="";e.dataset.emailType&&(o=String(e.dataset.emailType)),ajax.post("al_settings.php",{act:"a_reset_email_softbounce",csrf:t,email_type:o},{loader:!0,onDone:()=>{(0,n.ge)("email_soft_bouncing").remove()},onFail:e=>((0,f.showFastBox)((0,u.getLang)("global_error"),e||(0,u.getLang)("global_unknown_error")),!0)})},openVkmailApp(e){var t="vkmail";return e.dataset.ref&&(t=`${t}#ref=${e.dataset.ref}`),window.showWiki({w:t},!1,e),!1},bindVkmail(e){ajax.post("al_settings.php",{act:"a_bind_notify_vkcom_mail",csrf:String(e.dataset.csrf)},{loader:!0,onDone:(e,t)=>{if(["vkcom_email_binding_banner","email_soft_bouncing","email_not_working"].forEach((e=>{var t=document.getElementById(e);t&&t.remove()})),t){var o=(0,n.ge)("chgnotifymail");o.parentNode.replaceChild((0,n.se)(t),o)}showDoneBox(e)},onFail:e=>((0,f.showFastBox)((0,u.getLang)("global_error"),e||(0,u.getLang)("global_unknown_error")),!0)})},hideVkmailAnnounce(e){ajax.post("al_settings.php",{act:"a_hide_vkcom_mail_announce",csrf:String(e.dataset.csrf)},{loader:!0,onDone:()=>{var e=document.getElementById("vkcom_email_announce_banner");e&&e.remove()},onFail:e=>((0,f.showFastBox)((0,u.getLang)("global_error"),e||(0,u.getLang)("global_unknown_error")),!0)})},hideVkmailAppPromo(e){ajax.post("al_settings.php",{act:"a_hide_vkcom_mail_app_promo",csrf:String(e.dataset.csrf)},{loader:!0,onDone:()=>{var e=document.getElementById("vkcom_email_app_promo_banner");e&&e.remove()},onFail:e=>((0,f.showFastBox)((0,u.getLang)("global_error"),e||(0,u.getLang)("global_unknown_error")),!0)})},hideVkmailBinding(e){ajax.post("al_settings.php",{act:"a_hide_vkcom_mail_binding",csrf:String(e.dataset.csrf)},{loader:!0,onDone:()=>{var e=document.getElementById("vkcom_email_binding_banner");e&&e.remove()},onFail:e=>((0,f.showFastBox)((0,u.getLang)("global_error"),e||(0,u.getLang)("global_unknown_error")),!0)})},logVkmailAnnounceShowedStat(){E.marketingTransitionItemStat.logEvent(M,A,"announce_banner",window.location.href)},logVkmailBindingShowedStat(){E.marketingTransitionItemStat.logEvent(M,A,"bind_banner",window.location.href)},logVkmailAppPromoShowedStat(){E.marketingTransitionItemStat.logEvent(M,A,"app_promo_banner",window.location.href)}}},361554:(e,t,o)=>{"use strict";o.d(t,{BoxModal:()=>r});var s=o(570655),n=o(667294),i=o(121265),a=o(7692),r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.className,o=e.appearance,s=e.title,r=e.actionButtons,c=e.onClose,l=e.children,u=e.hint,d=e.hasScroll;return n.createElement("div",{className:"BoxModal"},n.createElement("div",{className:(0,i.classNames)("Modal","Modal--"+o,t)},n.createElement(a.default.Header,{title:s,onClose:c}),Boolean(l)&&n.createElement(a.default.Body,{hasScroll:d},l),Boolean(r)&&n.createElement(a.default.Footer,{actionButtons:r,hint:u})))},t.defaultProps={appearance:"white",hasScroll:!0},t}(n.Component)},548505:(e,t,o)=>{"use strict";o.d(t,{cancelDonutSubscription:()=>l});var s=o(414914),n=o(116886),i=o(705456),a=o(907851),r=o(791563),c=o(64385);function l(e,t,o){var l=o.onApplyDone;(0,r.showBox)("al_settings.php",{act:"a_cancel_donut",owner_id:e,hash:t},{onDone:function(o){o.setButtons((0,n.getLang)("settings_donut_confirm"),(function(){(0,i.lockButton)(o.btns.ok[0]),function(e,t,o,n){var a=n.onApplyDone;c.ajax.post("al_settings.php",{act:"a_cancel_donut_apply",owner_id:e,hash:t},{onDone:function(){var e;null===(e=null==o?void 0:o.hide)||void 0===e||e.call(o),a({box:o})},onFail:function(e){var t,n;if(o){var a=null===(n=null===(t=o.bodyNode)||void 0===t?void 0:t.querySelector)||void 0===n?void 0:n.call(t,".error");a&&((0,s.val)(a,e),(0,s.show)(a)),(0,i.unlockButton)(o.btns.ok[0])}}})}(e,t,o,{onApplyDone:l})}),(0,n.getLang)("settings_donut_cancel_button_cancel"))},onFail:function(e){(0,a.showErrorBox)(e)}})}},533246:(e,t,o)=>{"use strict";o.d(t,{createMutations:()=>a,createModule:()=>l,destroyModule:()=>u});var s=o(570655),n=o(276018),i=o(917685);function a(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,(0,s.__spreadArray)([],(0,s.__read)(t)))}}}function r(e,t,o,s){(0,i.addEvent)(t,o,s),e._registeredHandlers.push({handlerType:"bind",elem:t,types:o,handler:s})}function c(e,t,o,s,i){(0,n.addDelegateEvent)(t,o,s,i),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:o,selector:s,handler:i})}function l(e){var t={_registeredHandlers:[]};return e.handlers((function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return r.apply(void 0,(0,s.__spreadArray)([t],(0,s.__read)(e)))}),(function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return c.apply(void 0,(0,s.__spreadArray)([t],(0,s.__read)(e)))})),t}function u(e){e._registeredHandlers.forEach((function(e){var t=e.handlerType,o=e.elem,s=e.types,a=e.handler;"delegate"===t?(0,n.removeDelegateEvent)(o,s,e.selector,a):(0,i.removeEvent)(o,s,a)})),e._registeredHandlers=[]}},48557:(e,t,o)=>{"use strict";o.d(t,{confirmProfileClose:()=>d});var s=o(570655),n=o(659397),i=o(705456),a=o(791563),r=o(116886),c=o(688490),l=o(432655),u=o(51229);function d(e){var t=window.cur.onPrivacyChanged,o={};(0,a.showBox)("al_settings.php?act=a_confirm_profile_close_box",{},{onDone:function(t,a){t.setOptions({width:550});var d=function(){var e,n=t.btns.ok[0];e=Object.entries(o).map((function(e){var t=(0,s.__read)(e,2),o=t[0],n=t[1];return(0,c.savePrivacySetting)({key:o,value:n,hash:window.cur.options.hash})})),(0,i.lockButton)(n),Promise.all(e).then((function(){t.hide(),window.nav.reload({preventScroll:!0,onDone:function(){window.Settings.savePrivacyShowSaved(l.PRIVACY_KEYS.PROFILE_CLOSED),(0,u.updateNarrow)()}})})).finally((function(){(0,i.unlockButton)(n)}))},p=function(){t.removeButtons(),Object.keys(o).length>0?(t.addButton((0,r.getLang)("settings_closed_profile_confirm_box_button_save_settings"),d),t.addButton((0,r.getLang)("global_cancel"),t.hide,"no")):(t.addButton((0,r.getLang)("settings_closed_profile_confirm_box_button_close_profile"),(function(){t.hide(),e()})),t.addButton((0,r.getLang)("global_cancel"),t.hide,"no"))};p(),window.cur.onPrivacyChanged=function(e){if(a.keys.includes(e)){var t=(0,c.fixPrivacyValueTypes)(a.privacy[e]),s=(0,c.getPrivacyValueFromCur)(e);t&&s&&!(0,n.isEqual)(t,s)?o[e]=window.Privacy.getValue(e):delete o[e],p()}}},params:{onDestroy:function(){window.cur.onPrivacyChanged=t}}})}},432655:(e,t,o)=>{"use strict";o.d(t,{PRIVACY_KEYS:()=>s});var s={PROFILE:"profile",SEARCH_ACCESS:"search_access",UPDATES:"updates",COMPANY_MESSAGES:"company_messages",PROFILE_CLOSED:"profile_closed",CONTACT_AVATAR:"contact_avatar",CALLS_FROM_COMMUNITY:"calls_from_community"}},688490:(e,t,o)=>{"use strict";o.d(t,{getPrivacyValueFromCur:()=>n,fixPrivacyValueTypes:()=>i,savePrivacySetting:()=>a});var s=o(570655);function n(e){if(window.cur.privacy&&Array.isArray(window.cur.privacy[e]))return i(window.cur.privacy[e])}function i(e){if(Array.isArray(e)){var t=(0,s.__read)(e,4),o=t[0],n=t[1],i=t[2],a=t[3];return[parseInt(o),parseInt(n),Array.isArray(i)?i.map((function(e){return parseInt(e)})):[],Array.isArray(a)?a.map((function(e){return parseInt(e)})):[]]}}function a(e){return new Promise((function(t,o){window.ajax.post("al_friends.php?act=save_privacy",{key:e.key,val:e.value,hash:e.hash},{onDone:function(e){t(e)},onFail:function(e){return o(e),!0}})}))}},682207:(e,t,o)=>{"use strict";o.d(t,{PhotoRecognitionSettingsBox:()=>g});var s=o(570655),n=o(667294),i=o(361554),a=o(881150),r=o(41437),c=o(423558),l=o(856612),u=o(277256),d=o(121265),p=o(791563),_=o(917999),g=function(e){function t(t){var o=e.call(this,t)||this;o.save=function(){var e=o.props,t=e.onSave,s=e.data,n=o.state,i=n.isRecognitionMeEnabled,a=n.showMyRecognizedPhotosToFriends,c=n.isRecognitionFriendsEnabled,l=n.showMyRecognizedPhotosBlock,u=n.showFriendsRecognizedPhotosBlock;o.setState({isLoad:!0}),window.ajax.post("al_settings.php",{act:"save_recognition",is_recognition_me_disabled:(0,_.intval)(!i.value),show_recognition_photos_to_friends:(0,_.intval)(a.value),is_recognition_friends_enabled:(0,_.intval)(c.value),show_my_recognized_photos_block:(0,_.intval)(l.value),show_friends_recognized_photos_block:(0,_.intval)(u.value),hash:s.hash},{onDone:function(){t&&t()},hideProgress:function(){o.setState({isLoad:!1})},onFail:function(e){return(0,p.showFastBox)((0,r.getLang)("global_error"),e||(0,r.getLang)("global_unknown_error")),!0}})},o.onRecognitionMeChange=function(e,t){o.setState({showMyRecognizedPhotosBlock:{disabled:!t,value:!!t&&o.state.showMyRecognizedPhotosBlock.value},showMyRecognizedPhotosToFriends:{disabled:!t,value:!!t&&o.state.showMyRecognizedPhotosToFriends.value},isRecognitionMeEnabled:(0,s.__assign)((0,s.__assign)({},o.state.isRecognitionMeEnabled),{value:t})})},o.onShowMyRecognizedPhotoToFriendsChange=function(e,t){o.setState({showMyRecognizedPhotosToFriends:(0,s.__assign)((0,s.__assign)({},o.state.showMyRecognizedPhotosToFriends),{value:t})})},o.onRecognitionFriendsChange=function(e,t){o.setState({isRecognitionFriendsEnabled:(0,s.__assign)((0,s.__assign)({},o.state.isRecognitionFriendsEnabled),{value:t})})},o.onShowMyRecognizedBlockChange=function(e,t){o.setState({showMyRecognizedPhotosBlock:(0,s.__assign)((0,s.__assign)({},o.state.showMyRecognizedPhotosBlock),{value:t})})},o.onShowFriendsRecognizedBlockChange=function(e,t){o.setState({showFriendsRecognizedPhotosBlock:(0,s.__assign)((0,s.__assign)({},o.state.showFriendsRecognizedPhotosBlock),{value:t})})};var n=t.data;return o.state={isLoad:!1,isRecognitionMeEnabled:{value:n.isRecognitionMeEnabled.value},showMyRecognizedPhotosToFriends:{value:n.showMyRecognizedPhotosToFriends.value,disabled:!n.isRecognitionMeEnabled.value},isRecognitionFriendsEnabled:{value:n.isRecognitionFriendsEnabled.value},showMyRecognizedPhotosBlock:{value:n.showMyRecognizedPhotosBlock.value,disabled:!n.isRecognitionMeEnabled.value},showFriendsRecognizedPhotosBlock:{value:n.showFriendsRecognizedPhotosBlock.value}},o}return(0,s.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.onClose,o=e.data,s=this.state,a=s.isRecognitionMeEnabled,c=s.showMyRecognizedPhotosToFriends,p=s.isRecognitionFriendsEnabled,_=s.showMyRecognizedPhotosBlock,g=s.showFriendsRecognizedPhotosBlock;return n.createElement(i.BoxModal,{className:"PhotoRecognitionSettingsBox",appearance:"white",hasScroll:!1,title:(0,r.getLang)("photo_recognition_settings_box_title"),actionButtons:this.getActionModalButtons(),onClose:t},n.createElement("div",{className:"PhotoRecognitionSettingsBox__content"},n.createElement("section",{className:"PhotoRecognitionSettingsBox__section"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__wrapper"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__info"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__title"},(0,r.getLang)("photo_recognition_settings_is_recognize_me")),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__description"},(0,r.getLang)("photo_recognition_settings_is_recognize_me_description"),n.createElement(l.default,{href:"/@vk-ai-photo-tags",className:"PhotoRecognitionSettingsBoxRow__learnMore",target:"_blank"},(0,r.getLang)("photo_recognition_settings_learn_more")))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__control"},n.createElement(u.default,{checked:a.value,onChange:this.onRecognitionMeChange})))),n.createElement("div",{className:(0,d.classNames)("PhotoRecognitionSettingsBoxRow",{"PhotoRecognitionSettingsBoxRow--disabled":c.disabled||o.showMyRecognizedPhotosToFriends.forceDisable})},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__wrapper"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__info"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__title"},(0,r.getLang)("photo_recognition_settings_show_recognition_photos_to_friends")),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__description"},(0,r.getLang)("photo_recognition_settings_show_recognition_photos_to_friends_description"))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__control"},n.createElement(u.default,{checked:c.value,onChange:this.onShowMyRecognizedPhotoToFriendsChange})))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__wrapper"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__info"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__title"},(0,r.getLang)("photo_recognition_settings_recognition_friends_enabled")),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__description"},(0,r.getLang)("photo_recognition_settings_recognition_friends_enabled_description"))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__control"},n.createElement(u.default,{checked:p.value,onChange:this.onRecognitionFriendsChange}))))),n.createElement("section",{className:"PhotoRecognitionSettingsBox__section"},n.createElement("div",{className:(0,d.classNames)("PhotoRecognitionSettingsBoxRow",{"PhotoRecognitionSettingsBoxRow--disabled":_.disabled})},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__wrapper"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__info"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__title"},(0,r.getLang)("settings_photos_user_recognition_block")),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__description"},(0,r.getLang)("photo_recognition_settings_show_my_recognized_photos_block_description"))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__control"},n.createElement(u.default,{checked:_.value,onChange:this.onShowMyRecognizedBlockChange})))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__wrapper"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__info"},n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__title"},(0,r.getLang)("settings_photos_friends_recognition_block")),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__description"},(0,r.getLang)("photo_recognition_settings_show_friends_recognized_photos_block_description"))),n.createElement("div",{className:"PhotoRecognitionSettingsBoxRow__control"},n.createElement(u.default,{checked:g.value,onChange:this.onShowFriendsRecognizedBlockChange})))))))},t.prototype.getActionModalButtons=function(){var e=this.props.onClose,t=this.state.isLoad;return[n.createElement(a.default,{key:"close",appearance:"tertiary",onClick:function(){return e()}},(0,r.getLang)("global_cancel")),n.createElement(c.default,{key:"publish",appearance:"primary",onClick:this.save,loading:t},(0,r.getLang)("global_save"))]},t}(n.Component)},981253:(e,t,o)=>{"use strict";o.d(t,{initColorSchemeDropdown:()=>i});var s=o(570655),n=o(229804);function i(){var e=document.querySelector(".SettingsColorSchemeDropdown");if(e){var t=e.dataset.value,o=JSON.parse(e.dataset.items||"[]");n.ColorScheme.isSchemesAutoSwitchingSupported()||(t===n.ColorSchemeMode.Auto&&(t=n.ColorSchemeMode.Light),o=o.filter((function(e){return(0,s.__read)(e,1)[0]!==n.ColorSchemeMode.Auto}))),new window.InlineDropdown(e,{selected:t,items:o,onSelect:function(t){n.colorScheme.setMode(t);var o=e.dataset.hash;window.ajax.post("al_settings.php?act=a_save_color_scheme_mode",{mode:t,hash:o})}})}}},783611:(e,t,o)=>{"use strict";o.d(t,{toggleVkSans:()=>n});var s=o(64385);function n(e,t){s.ajax.post("/al_settings.php",{act:"a_change_vk_sans",hash:t,vk_sans:e?1:0})}}}]);try{stManager.done("dist/a7cf0056345e7afb289308a0dd1758ca.e59656e7215d76526781.js")}catch(e){}