(()=>{"use strict";var __webpack_modules__={437686:(e,o,_)=>{var t=_(888060);window.PhotosAdd=t.PhotosAdd;try{stManager.done(jsc("web/photos_add.js"))}catch(e){}},888060:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{PhotosAdd:()=>PhotosAdd});var core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(751876),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(991181),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(296253),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(59357),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(442699),_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(414914),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(927663),_web_lib_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(907851),_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(116886),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(519921),_web_lib_ui__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(705456),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(791563),PhotosAdd={PROGRESS_OPACITY_SPEED:100,checkChanges(e){if(!cur.leaving){if(cur.album&&cur.uploadStarted){var o=getLang("photos_uploading_warning");if(1===e){var _=(0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_11__.showFastBox)({title:getLang("global_warning"),dark:1},o,getLang("photos_stop_uploading"),(()=>{cur.leaving=!0,_.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"));return!0}return winToUtf(o)}return!e&&void 0}},go:(e,o)=>PhotosAdd.checkChanges(1)?(cur.onContinueCb=nav.go.pbind(e,o),!0):nav.go(e,o),initBeforeUnload(){cur.unloadInited||(cur.unloadInited=!0,cur.nav.push(((e,o,_)=>PhotosAdd.checkChanges(1)?(cur.onContinueCb=nav.go.pbind(_),!1):cur.album==vk.id+"_-7"&&cur.savedPhotos&&cur.savedPhotos.length&&!cur.savingPhotos?(cur.savingPhotos=!0,ajax.post("/al_photos.php",{act:"publish_photos",hash:cur.post_hash,photos:cur.savedPhotos.join(",")},{onDone:nav.go.pbind(_)}),!1):void 0)),addEvent(window,"mousewheel",PhotosAdd.wheelHandler),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=PhotosAdd.checkChanges,cur.destroy.push((()=>{window.onbeforeunload=cur.prevBefUnload,removeEvent(window,"mousewheel",PhotosAdd.wheelHandler)})))},genFile:(e,o,_)=>ce("div",{innerHTML:`\n      <a class="photo_file_cancel" id="photo_cancel${e}" onclick="${o}">${_}</a>\n      <div class="photo_file_button">\n        <div class="file_button_gray">\n          <div class="file_button" id="photo_file_button${e}">${getLang("photos_choose_file")}</div>\n        </div>\n      </div>\n      `}),initFile(e){FileButton.init(`photo_file_button${e}`,{name:"photo",id:`photo_file${e}`,accept:"image/jpeg,image/png,image/gif",onchange:PhotosAdd.fileSelected})},addFile(){var e=cur.files.length,o=PhotosAdd.genFile(e,`PhotosAdd.fileCancel(${e})`,getLang("global_cancel"));extend(o,{className:"photo_upload_file",id:`photo_upload_row${e}`}),ge("photo_upload_files").appendChild(o),PhotosAdd.initFile(e),cur.files.push({})},fileSelected(){var e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(this.id.replace("photo_file",""));if(cur.files[e].deleting||!cur.files[e].cont&&!cur.files[e].id){cur[`fileDone${e}`]=PhotosAdd.fileDone.pbind(e),cur[`fileFail${e}`]=PhotosAdd.fileFail.pbind(e),cur.files[e].cont=utilsNode.appendChild(ce("div",{innerHTML:`\n        <iframe name="photo_frame${e}"></iframe>\n        <form target="photo_frame${e}" id="photo_form${e}" method="POST" action="${cur.url}" enctype="multipart/form-data"></form>\n      `}));var o=ge(`photo_form${e}`),_=extend(cur.fields,{act:"do_add",al:1,from_host:locHost,ondone:`cur.fileDone${e}`,onfail:`cur.fileFail${e}`});for(var t in _)_.hasOwnProperty(t)&&o.appendChild(ce("input",{name:t,value:_[t]}));o.appendChild(this),o.submit();var r=ge(`photo_file_button${e}`);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_10__.lockButton)(r),setTimeout((()=>{r.innerHTML=r.innerHTML}),0),show(`photo_cancel${e}`),ge(`photo_cancel${e}`).innerHTML=getLang("global_cancel"),e==cur.files.length-1&&PhotosAdd.addFile()}},fileDone(i,res){hide(`photo_cancel${i}`);for(var before="",j=i+1,obj;j<cur.files.length;++j)if(cur.files[j].id&&!cur.files[j].deleting){before=cur.files[j].id;break}try{obj=eval("("+res+")")}catch(e){obj=AjaxConvert.fromQueryString(res),(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,res)}PhotosAdd.fetchGeo(obj),setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",before,context:1,geo:1},obj),{onDone(e,o){if(!e)return PhotosAdd.fileFail(i,0);cur.files[i].cont.innerHTML="",utilsNode.removeChild(cur.files[i].cont),extend(cur.files[i],{id:e,deleting:!1,cont:!1}),ge(`photo_upload_row${i}`).innerHTML=o,autosizeSetup(`photo_caption${e}`,{minHeight:30}),show(`photo_delete${e}`),window._tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],globalHistoryDestroy(_tbLink.loc))},onFail(e){if(e)return setTimeout((0,_web_lib_message_box__WEBPACK_IMPORTED_MODULE_11__.showFastBox)({title:getLang("global_error"),dark:1},e).hide,3e3),PhotosAdd.fileCancel(i),!0}}),0)},fileCancel(e,o){if(cur.files[e].cont&&(cur.files[e].cont.innerHTML="",utilsNode.removeChild(cur.files[e].cont)),!o){var _=ge(`photo_file_button${e}`);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_10__.unlockButton)(_),_.innerHTML=getLang("photos_choose_file"),cur.files[e]={},PhotosAdd.initFile(e),hide(`photo_cancel${e}`)}},fileFail(e,o){PhotosAdd.fileCancel(e)},fileDelete(e,o){for(var _=0;_<cur.files.length&&cur.files[_].id!=e;)++_;if(_!=cur.files.length&&!cur.files[_].deleting){cur.files[_].deleting=!0,ajax.post("al_photos.php",{act:"delete_photo",photo:e,hash:o,edit:2},{onFail(){cur.files[_].deleting=!1}});var t=ge(`photo_edit_row${e}`);t.parentNode.insertBefore(PhotosAdd.genFile(_,`PhotosAdd.fileRestore('${e}', '${o}')`,getLang("global_restore")),t),hide(t),PhotosAdd.initFile(_),show(`photo_cancel${_}`)}},fileRestore(e,o){for(var _=0,t="";_<cur.files.length&&cur.files[_].id!=e;)++_;if(_!=cur.files.length&&cur.files[_].deleting&&-1!==cur.files[_].deleting){if(cur.files[_].cont)return PhotosAdd.fileCancel(_);for(var r=_+1;r<cur.files.length;++r)if(cur.files[r].id&&!cur.files[r].deleting){t=cur.files[r].id;break}cur.files[_].deleting=-1,ajax.post("al_photos.php",{act:"restore_photo",photo:e,hash:o,before:t,edit:2},{onDone(){cur.files[_].deleting=!1}});var a=ge(`photo_edit_row${e}`);show(a),re(a.previousSibling)}},filesDone(e){var o=AjaxConvert.fromQueryString(e);PhotosAdd.fetchGeo(o),setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",context:2,geo:1},o)),0)},filesFail(){for(var e=0;e<cur.files.length;++e)PhotosAdd.fileCancel(e);cur.allcont.innerHTML="",utilsNode.removeChild(cur.allcont),cur.allcont=!1},backupDesc(e){cur.descs||(cur.descs={}),cur.descs[e]=trim(ge(`photo_caption${e}`).value)},saveDesc(e,o){var _=ge(`photo_caption${e}`).value,t=(cur.descs||{})[e];delete(cur.descs||{})[e],trim(_)!=t&&ajax.post("al_photos.php",{act:"save_desc",photo:e,hash:o,text:_,edit:1},{onDone(o){ge(`photo_save_result${e}`).innerHTML=o},onFail:o=>(ge(`photo_save_result${e}`).innerHTML=`<div class="photo_save_error">${o}</div>`,!0),showProgress:function(){ge(`photo_save_result${e}`).innerHTML=getLang("photos_privacy_description"),show(`photo_save_progress${e}`)},hideProgress:function(){hide(`photo_save_progress${e}`)}})},activeTab(e){for(var o=domPN(domPN(e)),_=domFC(o);_;_=domNS(_))removeClass(_,"active_link");addClass(domPN(e),"active_link"),domFC(ge("photo_add_tab"))!==e&&re("photo_add_tab")},wheelHandler(){cur.album&&(cur.scrollFixed=scrollNode.scrollTop+window.innerHeight!=scrollNode.offsetHeight)},setThumb(e,o){var _=geByClass1("photos_add_img",e),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(_);o.mtop=0,browser.opera&&(o.mtop=o.mtop-2),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(o,{width:t[0],marginLeft:Math.floor((132-t[0])/2)})},thumbOver(e,o){var _=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.geByClass)("photos_add_controls",e)[0];_||(_=ce("div",{id:`photos_add_controls${o}`,className:"photos_add_controls",innerHTML:`\n          <div class="photos_add_c_bar">\n            <a class="photos_add_rl" onclick="PhotosAdd.rotateAngle('${o}', 90);"></a>\n            <a class="photos_add_rr" onclick="PhotosAdd.rotateAngle('${o}', -90);"></a>\n          </div>\n        `}),e.appendChild(_)),PhotosAdd.setThumb(e,_),show(_),animate(_,{height:24,marginTop:_.mtop-24},{duration:200,transition:Fx.Transitions.easeOutCirc})},thumbOut(e){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.geByClass)("photos_add_controls",e)[0];o&&animate(o,{height:0,marginTop:o.mtop},200)},rotatePhotoDone(e){if(e){var o=e.id,_=document.querySelector(`#photo_edit_row_${o}`),t=_.querySelector(".photos_photo_edit_row_thumb"),r=e.photos.p;r||(r=e.photos.x),window.photos._hideProgressPanel(_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(t,{"background-image":`url('${r[0]}')`}),window.ajaxCache={},delete cur.pvList,delete cur.pvData}},rotateAngle(e,o,_,t){var r=gpeByClass("photos_photo_edit_row",_);e=attr(r,"data-id"),window.tooltips&&tooltips.hideAll(),cancelEvent(t);var a=cur.photoData[e],d=90==o?1:-1;if(a.rotate){var s=document.querySelector("#photo_rotate_form"+e);s.innerHTML="",s.action=a.rotate[0];var i=extend({act:"do_rotate",to:d,fid:e},a.rotate);if("rotate_photo"==i.act&&(i.angle=(i.angle+i.to+4)%4),i[`rot${(i.to+4)%4}`])return i.act="done_rotate",i.complete=1,window.ajax.post("/al_photos.php",i,{onDone:PhotosAdd.rotateDone,onFail:PhotosAdd.rotateDone}),!1;for(var l in i)i.hasOwnProperty(l)&&0!=l&&s.appendChild(ce("input",{type:"hidden",name:l,value:i[l]}));s.submit()}else a.rotate_hash&&window.ajax.post("/al_photos.php?act=make_rotate",{type:"album",hash:a.rotate_hash,crop:1,photo:e,to:d},{onDone:PhotosAdd.rotatePhotoDone});return window.ajaxCache={},delete cur.pvList,delete cur.pvData,!1},rotateDone(e){if(e){var o=e.photo_raw,_=ge(`photo_edit_row_${o}`),t=geByClass1("photos_photo_edit_row_thumb",_);window.photos._hideProgressPanel(_),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(t,{"background-image":`url('${e.p_src||e.q_src}')`}),delete e.m_,delete e.o_;var r=cur.photoData[o];extend(r.rotate,{photo:e.photo,hash:e.hash,rhash:e.rhash,angle:e.angle,rot1:e.rot1,rot3:e.rot3}),window.ajaxCache={},delete cur.pvList,delete cur.pvData}},scrollToBottom(e){if(!cur.scrollFixed){var o=window,_=document.documentElement;if(e||(e=cur.lastPhotoRow),o.pageNode&&e){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(e),a=Math.max((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(o.innerHeight),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.intval)(_.clientHeight));t[1]<=0&&(t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(e.parentNode));var d=t[1]+r[1]-a+200;d>0&&d>scrollNode.scrollTop&&(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToY)(d,400)}}},_onScroll(){if(null!==cur.pageBlockHeader&&(cur.pageBlockHeader=cur.pageBlockHeader||geByClass1("page_block_header",ge("photos_add_block")),cur.pageBlockHeader)){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(ge("page_header_cont"))[1];cur.photoAddHeaderElOffset=cur.photoAddHeaderElOffset||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(cur.pageBlockHeader)[1]-e;var o=ge("photos_add_block");(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollGetY)()>=cur.photoAddHeaderElOffset?(addClass(cur.pageBlockHeader,"photos_header_fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.pageBlockHeader,{width:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(ge("page_body"))[0],top:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)("page_header")[1]}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(o,{"padding-top":`${(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(cur.pageBlockHeader)[1]}px`})):(removeClass(cur.pageBlockHeader,"photos_header_fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.pageBlockHeader,{width:""}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(o,{"padding-top":""})),PhotosAdd.updateBottomFixedPanel()}},updateBottomFixedPanel(){if(null!==cur.fixedBottomPanel&&(cur.fixedBottomPanel=cur.fixedBottomPanel||ge("photos_go_to_album"),cur.fixedBottomPanel)){var e=ge("photos_add_block");if(e){var o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getXY)(e)[1],_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(e)[1];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.clientHeight)()+(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollGetY)()<o+_?(addClass(cur.fixedBottomPanel,"photos_bottom_fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.fixedBottomPanel,{width:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(ge("page_body"))[0]}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domPS)(cur.fixedBottomPanel),{"padding-bottom":`${10+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(cur.fixedBottomPanel)[1]}px`})):(removeClass(cur.fixedBottomPanel,"photos_bottom_fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(cur.fixedBottomPanel,{width:""}),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domPS)(cur.fixedBottomPanel),{"padding-bottom":""}))}}},initFixedHeader(){var e=()=>{removeEvent(window,"scroll",PhotosAdd._onScroll)};e(),addEvent(window,"scroll",PhotosAdd._onScroll),cur.destroy.push(e)},onUploadStart(e,o){if(PhotosAdd.initBeforeUnload(),cur.onPhotoAddStart&&cur.onPhotoAddStart(),cur.flash_lite&&void 0===e.num&&(e=o),0==e.num&&(cur.errorCount=0,!ge("photos_add_wrap"))){cur.count=0,show("photos_add_block"),removeClass(ge("photos_add_block"),"unshown"),hide("photos_tagged_block"),hide("photos_all_block");var _=ge("photos_albums_block");(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(_,{visibility:"hidden",height:0,padding:0,margin:0,overflow:"hidden"}),each((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.geByClass)("photos_period_delimiter_fixed"),hide),cur.prevDocTitle=document.title,cur.uploadStarted=!0,hide("photos_go_to_album"),PhotosAdd.initFixedHeader()}cur.photosAddFirst||(cur.photosAddFirst=!0),e.prepareCont=se(rs(cur.uploadRowTpl,{photo_raw:"",thumb:"",description:"",hash:""})),re(geByClass1("photos_photo_edit_row_selector",e.prepareCont)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(e.prepareCont,{display:"none"}),window.photos._showProgressPanel(e.prepareCont),cur.flash_lite&&(cur.flashPrepareCont=cur.flashPrepareCont||{},cur.flashPrepareCont[e.num]=cur.flashPrepareCont[e.num]||{},cur.flashPrepareCont[e.num][e.filename]=e.prepareCont),ge("photos_add_list").appendChild(e.prepareCont),cur.lastPhotoRow=e.prepareCont,PhotosAdd.makeTask((()=>(show(e.prepareCont),show(geByClass1("photos_photo_edit_row_progress",e.prepareCont)),PhotosAdd.scrollToBottom(),!0))),cur.uplSelected=!0,ajax.post("al_photos.php",{act:"start_add",hash:cur.statsPhotoAddHash})},updateProgressBar(e,o,_){var t=ge("photos_uploaded_progress"),r=ge("photos_total_progress");if(!1===e){var a=ge("photos_upload_btn");addClass(t,"photos_progress_hidden"),setTimeout((()=>{hide(t),show(a),setTimeout(removeClass.pbind(a,"photos_progress_hidden"))}),PhotosAdd.PROGRESS_OPACITY_SPEED),e=1}else if(hasClass(t,"photos_progress_hidden")){var d=ge("photos_upload_btn");addClass(d,"photos_progress_hidden"),setTimeout((()=>{hide(d),show(t),setTimeout(removeClass.pbind(t,"photos_progress_hidden"))}),PhotosAdd.PROGRESS_OPACITY_SPEED),e=0}var s=geByClass1("ui_progress_bar",r);if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(s,"width",e*(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.getSize)(r)[0]),o||_){o=o||0,_=_||0;var i=(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_8__.langNumeric)(o,cur.uploaderLang.photos_upload_progress).replace("{count}",o).replace("{total}",_);val(ge("photos_total_progress_text"),i)}},hideUploadProgress(){PhotosAdd.updateProgressBar(!1)},onUploadProgress(e,o,_){var t=e.totalCount||1,r=e.num||0,a=1/t,d=r*a;PhotosAdd.updateProgressBar(d+a*o/_,r,t)},onUploadComplete(info,res){var obj;cur.flash_lite&&(info.prepareCont=cur.flashPrepareCont[info.num][info.filename]);try{obj=eval("("+res+")")}catch(e){obj=AjaxConvert.fromQueryString(res),(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,res)}if(!obj.photos)return cur.errorCount++,re(info.prepareCont),info.prepareCont&&info.prepareCont.helper&&re(info.prepareCont.helper),ge("photos_upload_error_msg").innerHTML=cur.uploaderLang.photos_add_error,show("photos_upload_error"),(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToTop)(200),void PhotosAdd.makeTask();if(obj.code)Upload.onUploadError(cur.UplId,obj.code);else{PhotosAdd.fetchGeo(obj);var params=extend({act:"done_add",from:"html5",context:1,geo:1},obj);cur.lastPhotoRow=info.prepareCont,cur.photoSaveQ=cur.photoSaveQ||[],cur.photoSaveQ.push((()=>{ajax.post("al_photos.php",params,{onDone(html,js,photoRaw,thumb,editHash,qParams){hide("photos_upload_error"),cur.count++,info.prepareCont=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domReplaceEl)(info.prepareCont,html),re(geByClass1("photos_photo_edit_row_selector",info.prepareCont));try{eval(js)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,js)}cur.savedPhotos=cur.savedPhotos||[],cur.savedPhotos.push(photoRaw),cur.savedThumbs=cur.savedThumbs||{},cur.savedThumbs[photoRaw]=thumb;var thumbEl=geByClass1("photos_photo_edit_row_thumb",info.prepareCont),thumbImage=vkImage();thumbImage.onload=()=>{removeClass(thumbEl,"no_thumb"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setStyle)(thumbEl,"background-image",`url('${thumb}')`),hide(geByClass1("photos_photo_edit_row_progress",info.prepareCont))},thumbImage.src=thumb,PhotosAdd.makeTask(),cur.photoSaveQ.shift(),cur.photoSaveQ[0]&&cur.photoSaveQ[0](),cur.onPhotoFirstUploaded&&cur.onPhotoFirstUploaded();var uploadDocumentTitle=cur.uploaderLang.photos_upload_progress_title.replace("{count}",cur.count).replace("{total}",info.totalCount);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setDocumentTitle)(replaceEntities(uploadDocumentTitle)),qParams&&PhotosAdd.queueCheckUpdates(qParams)},onFail(e){if(e&&(ge("photos_upload_error_msg").innerHTML=e,show("photos_upload_error"),(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToTop)(200)),cur.errorUpload=!0,hasClass(info.prepareCont,"photos_add_first_child")){for(var o=info.prepareCont.nextSibling;o;){if(hasClass(o,"photos_add_upl_row")){addClass(o,"photos_add_first_child");break}o=o.nextSibling}o||(cur.photosAddFirst=!1)}return re(info.prepareCont),cur.photoSaveQ.shift(),cur.photoSaveQ[0]&&cur.photoSaveQ[0](),PhotosAdd.makeTask(),!0}})})),1==cur.photoSaveQ.length&&cur.photoSaveQ[0]()}},onImpUploadComplete(e,o,_,t){hide("photos_upload_error");var r=0;if(e.forEach((e=>{if(show(e.prepareCont),e.errorCode||e.errorMessage){var o=cur.uploaderLang.photos_add_error;if(ge("photos_upload_error_msg").innerHTML=o,show("photos_upload_error"),(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_6__.scrollToTop)(200),PhotosAdd.makeTask(),r++,hasClass(e.prepareCont,"photos_add_first_child")){for(var _=e.prepareCont.nextSibling;_;){if(hasClass(_,"photos_add_upl_row")){addClass(_,"photos_add_first_child");break}_=_.nextSibling}_||(cur.photosAddFirst=!1)}re(e.prepareCont),cur.count++}})),r!==e.length){var a=e.filter((e=>!e.errorCode&&!e.errorMessage));cur.photoSaveQ=cur.photoSaveQ||[],cur.photoSaveQ.push((()=>{ajax.post(_,o,{onDone(e,o,_,r,d,s){cur.savedPhotos=cur.savedPhotos||[],Object.keys(o.photo_data).forEach(((_,t)=>{cur.count++,cur.photoData[_]=o.photo_data[_],e=o.photo_html[_];var d=a[t];cur.lastPhotoRow=d.prepareCont,d.prepareCont=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.domReplaceEl)(d.prepareCont,e),re(geByClass1("photos_photo_edit_row_selector",d.prepareCont)),cur.savedPhotos.push(_),cur.savedThumbs=cur.savedThumbs||{},cur.savedThumbs[_]=r;var s=cur.uploaderLang.photos_upload_progress_title.replace("{count}",cur.count).replace("{total}",d.totalCount);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setDocumentTitle)(replaceEntities(s))})),PhotosAdd.makeTask(),cur.photoSaveQ.shift(),cur.photoSaveQ[0]&&cur.photoSaveQ[0](),cur.onPhotoFirstUploaded&&cur.onPhotoFirstUploaded(),s&&PhotosAdd.queueCheckUpdates(s),t()}})})),1==cur.photoSaveQ.length&&cur.photoSaveQ[0]()}else t()},queueCheckUpdates(e){window.Notifier&&Notifier.addKey(e,PhotosAdd.queueReceiveUpdates)},queueReceiveUpdates(e,o){o.events&&o.events.forEach((e=>{var o=e.split("<!>"),_=o[1],t=o[2],r=JSON.parse(t);r&&Object.keys(r).length&&addClass(ge("photo_edit_row_"+_),"has_faces animated")}))},onUploadCompleteAll(e,o){var _=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];cur.uploadStartProgress=0,delete cur.uploadStarted,window.onbeforeunload=cur.prevBefUnload,delete cur.unloadInited,_&&PhotosAdd.hideUploadProgress(),PhotosAdd.makeTask((()=>{if(cur.flash_lite){re("lite_photo_uploader");var e=ge("photos_upload_area"),o=ce("div",{innerHTML:'<div id="lite_photo_uploader" style="position: absolute; height: 100%; width: 100%; z-index: 9999; cursor: pointer;"></div>'}).firstChild;e.parentNode.insertBefore(o,e),cur.initFlashLite()}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_5__.setDocumentTitle)(cur.prevDocTitle),show("photos_go_to_album"),cur.lastPhotoRow=ge("photos_go_to_album"),PhotosAdd.updateBottomFixedPanel(),re("photos_albums_block")}))},makeTask(e){if(cur.photoAddQ=cur.photoAddQ||[],e?cur.photoAddQ.push(e):cur.photoAddSt=!1,!cur.photoAddSt){var o=cur.photoAddQ.shift();o&&(cur.photoAddSt=o())}},fetchGeo(e){if(!e.photos)return!1;var o=(0,_web_lib_utils__WEBPACK_IMPORTED_MODULE_7__.parseJSON)(e.photos);if(!o)return!1;var _={},t=0;for(var r in o)if(o.hasOwnProperty(r)){var a=o[r].latitude,d=o[r].longitude;a&&d&&(_[a+","+d]=1,t+=1)}if(!t)return!1;stManager.add(["maps.js"],(()=>{cur.placeMap=new window.vkMaps.VKMap(!1,"google"),cur.placeMap.isLoaded("google")?PhotosAdd.setGeo(_):cur.placeMap.load.addHandler(PhotosAdd.setGeo.pbind(_))}))},setGeo(e){var o=cur.uploaderLang.geolang||"en",_=function(_){if(e.hasOwnProperty(_)){var r=(_=_.split(","))[0],a=_[1];new window.vkMaps.Geocoder("google",(e=>{ajax.post("al_photos.php",{act:"a_set_geo",lat:_[0],long:_[1],geo_country:e.country,geo_locality:e.locality,geo_region:e.region,geo_street:e.street,geo_place:e.place,geo_lang:o,geo_code:e.countryCode})})).geocode({location:new window.google.maps.LatLng(r,a),language:o})}t=_};for(var t in e)_(t)}}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto;function __webpack_require__(e){var o=__webpack_module_cache__[e];if(void 0!==o)return o.exports;var _=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(_.exports,_,_.exports,__webpack_require__),_.loaded=!0,_.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,o,_,t)=>{if(!o){var r=1/0;for(i=0;i<deferred.length;i++){for(var[o,_,t]=deferred[i],a=!0,d=0;d<o.length;d++)(!1&t||r>=t)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](o[d])))?o.splice(d--,1):(a=!1,t<r&&(r=t));if(a){deferred.splice(i--,1);var s=_();void 0!==s&&(e=s)}}return e}t=t||0;for(var i=deferred.length;i>0&&deferred[i-1][2]>t;i--)deferred[i]=deferred[i-1];deferred[i]=[o,_,t]},__webpack_require__.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(o,{a:o}),o},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var _=Object.create(null);__webpack_require__.r(_);var t={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var r=2&o&&e;"object"==typeof r&&!~leafPrototypes.indexOf(r);r=getProto(r))Object.getOwnPropertyNames(r).forEach((o=>t[o]=()=>e[o]));return t.default=()=>e,__webpack_require__.d(_,t),_},__webpack_require__.d=(e,o)=>{for(var _ in o)__webpack_require__.o(o,_)&&!__webpack_require__.o(e,_)&&Object.defineProperty(e,_,{enumerable:!0,get:o[_]})},__webpack_require__.e=()=>Promise.resolve(),__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={7204:0};__webpack_require__.O.j=o=>0===e[o];var o=(o,_)=>{var t,r,[a,d,s]=_,i=0;for(t in d)__webpack_require__.o(d,t)&&(__webpack_require__.m[t]=d[t]);if(s)var l=s(__webpack_require__);for(o&&o(_);i<a.length;i++)r=a[i],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[a[i]]=0;return __webpack_require__.O(l)},_=self.webpackChunkvk=self.webpackChunkvk||[];_.forEach(o.bind(null,0)),_.push=o.bind(null,_.push.bind(_))})();var __webpack_exports__=__webpack_require__.O(void 0,[8592],(()=>__webpack_require__(437686)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();