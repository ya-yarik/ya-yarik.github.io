(self.webpackChunkvk=self.webpackChunkvk||[]).push([[7057],{513e3:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(927663),a=r(907851),o=r(414914),s=r(442699),n=r(917685);function l(t,e,r){if((0,s.isObject)(e)?r=e:this._dragElClass=e,this.options=(0,s.extend)({dragThreshold:l.DRAG_THRESHOLD_DIST},r),this._contEl=(0,o.ge)(t),this._contEl){this._excludedCount=0;for(var i=0;i<this._contEl.children.length;i++)this._contEl.children[i].getAttribute("nodrag")&&this._excludedCount++;(0,n.addEvent)(this._contEl,"mousedown",this._ev_mousedown_handler=this._onMouseDown.bind(this)),(0,o.setStyle)(this._contEl,"position","relative"),this._inited=!0,this._updateScrollbar=this._initUpdaterScrollbar()}}l.AUTO_SCROLL_DY=10,l.DRAG_THRESHOLD_DIST=0,l.AUTO_SCROLL_DISTANCE_THRESHOLD=300,l.AUTO_SCROLL_GAP=300,l.prototype.destroy=function(){this._inited&&(this._inited=!1,this._deinitEvents(!0))},l.prototype._getParentDragItemEl=function(t){for(var e,r=t;r&&(e=(0,o.domPN)(r))!==this._contEl;)r=e;return r===this._curPlaceholderEl&&(r=null),r},l.prototype._onKey=function(t){t.keyCode===n.KEY.ESC&&this.isCurrentlyDragging()&&this._onMouseUp()},l.prototype._onMouseDown=function(t){if(!(this._disabled||0!=t.button||this._curDragEl||(0,o.attr)(t.target,"nodrag")||this._dragElClass&&!(0,o.domClosest)(this._dragElClass,t.target))){for(var e=t.target;e&&e!==window.document;){if((0,s.intval)((0,o.domData)(e,"nodrag")))return;e=(0,o.domPN)(e)}var r=this._getParentDragItemEl(t.target);if(r&&!(0,o.attr)(r,"nodrag")&&((0,o.re)((0,o.geByClass1)("ui_gridsorter_placeholder"),this._contEl),this._contInfo=this._contInfo||{prevSize:(0,o.getSize)(this._contEl)},this._ensureGridIsActual(),!(this._grid.length<=1))){var i=window.getComputedStyle(r),a=(0,o.getXY)(r);this._initial={candidateEl:r,x:t.clientX,y:t.clientY,itemMargin:{x:parseInt(i.marginLeft),y:parseInt(i.marginTop)},shift:{x:t.pageX-a[0],y:t.pageY-a[1]}},(0,n.addEvent)(document,"mousemove",this._ev_mousemove_handler=this._onMouseMove.bind(this)),(0,n.addEvent)(document,"mouseup",this._ev_mouseup_handler=this._onMouseUp.bind(this)),(0,n.addEvent)(document,"keydown",this._ev_keydown_handler=this._onKey.bind(this)),cur.cancelClick=!1,(0,n.cancelEvent)(t)}}},l.prototype._dist=function(t){return Math.abs(t.clientX-this._initial.x)+Math.abs(t.clientY-this._initial.y)},l.prototype._onMouseUp=function(t){var e=this._curDragEl,r=!t;if(this._curDragEl){this._curDragEl=null,(0,o.removeClass)(e,"ui_gridsorter_moveable_notrans"),this._curOverCell||(this._curOverCell={el:this._curPlaceholderEl,pos:(0,o.getXY)(this._curPlaceholderEl),size:(0,o.getSize)(this._curPlaceholderEl)});var i=this._curOverCell.pos,a=this._curOverCell.el,s=this._grid[this._curDragCellIndex],l=s&&s.size;(0,o.gpeByClass)("_ape_item_list",e)&&(i[0]+=20,i[1]+=20),l&&this._isShiftToLeft&&(i[1]-=l[1]-this._curOverCell.size[1]),setTimeout((()=>{if(r){for(var t=0,a=this._grid.length;t<a;t++){var o=this._grid[t];o.dirty&&this._setPos(o.el,{left:0,top:0})}this._setPos(e,this._initialCurDragPos)}else this._setPos(e,{left:i[0],top:i[1]})})),setTimeout((()=>{if((0,o.re)(this._curPlaceholderEl),(0,o.removeClass)(this._contEl,"ui_gridsorter_cont"),this.options.dragCls&&(0,o.removeClass)(e,this.options.dragCls),this._inited){var t;if(r){for(var i=this._grid.length,s=0;s<i;s++){var n=this._grid[s];n.dirty&&this._setPos(n.el,{left:null,top:null})}this._setPos(e,{left:null,top:null,width:null,height:null})}else{var l;t=this._isShiftToLeft?(0,o.domNS)(a):a,this._contEl.insertBefore(e,t);var d=-1,h=this._initial.hasInlineSize;this._setPos(e,{left:null,top:null}),h||(0,o.setStyle)(e,{width:null,height:null});for(var c=this._grid.length,p=0;p<c;p++){var _=this._grid[p];(_.dirty||_.el===e)&&(this._setPos(_.el,{left:null,top:null}),h||(0,o.setStyle)(_.el,{width:null,height:null}),_.pos=this._calcElementPos(_.el),_.dirty=!1),_.el===e?l=p:_.el===a&&(d=p)}if(d>=0){var u=this._grid.splice(l,1);this._grid.splice(d,0,u[0])}}(0,o.removeClass)(e,"ui_gridsorter_moveable"),this._curOverCell=this._curPlaceholderEl=null,r&&this.update(),this.options.onDragFinish&&this.options.onDragFinish(e),a!==e&&!r&&this.options.onReorder&&this.options.onReorder(e,t,(0,o.domPS)(e))}}),210),t&&this._dist(t)>5&&((0,n.cancelEvent)(t),cur.cancelClick=!0)}this._updateScrollbar(),this._deinitEvents(),e&&this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,e),r||e&&this._overEl&&this.options.onDragDrop&&(r=this.options.onDragDrop(this._overEl,e)),this._overEl=null},l.prototype._deinitEvents=function(t){t&&(this._onMouseUp(),(0,n.removeEvent)(this._contEl,"mousedown",this._ev_mousedown_handler)),clearTimeout(this._autoScrollTO),this._autoScrollTO=!1,this._ev_mousemove_handler&&(0,n.removeEvent)(document,"mousemove",this._ev_mousemove_handler),this._ev_mouseup_handler&&(0,n.removeEvent)(document,"mouseup",this._ev_mouseup_handler),this._ev_keydown_handler&&(0,n.removeEvent)(document,"keydown",this._ev_keydown_handler)},l.prototype._setPos=function(t,e){this.options.noPosTransform||!this._hasTranslateFeauture&&!(this._hasTranslateFeauture=window.getComputedStyle(t).getPropertyValue("transform"))?(0,o.setStyle)(t,(0,s.extend)({transform:null},e)):null===e.left||null===e.top?(0,o.setStyle)(t,{transform:null,top:null,left:null}):(0,o.setStyle)(t,{transform:"translate("+e.left+"px, "+e.top+"px)",top:null,pos:null})},l.prototype._recalc=function(){var t=this._curDragEl,e=this._curOverCell.el;if(this._initGrid(),e!==t){for(var r=0,i=!1,a=!1,o=this._grid.length,s=0;s<o;s++){var n=this._grid[s];if(n.el===t){i=!0;break}if(n.el===e){i=!1;break}}this._isShiftToLeft=i;for(var l=i?0:this._grid.length-1,d=i?this._grid.length:-1,h=i?1:-1,c=[0,0];l!==d;l+=h){var p=this._grid[l];if(2!==r)if(p.el!==t){if(p.el===e&&r++,1===r||2===r){var _=0,u=0;i?(_=a.pos[0]+c[0],u=a.pos[1]+c[1],c[0]+=p.size[0]-a.size[0],c[1]+=p.size[1]-a.size[1]):(c[0]+=a.size[0]-p.size[0],c[1]+=a.size[1]-p.size[1],_=a.pos[0]+c[0],u=a.pos[1]+c[1]),this._setPos(p.el,{left:_-p.pos[0],top:u-p.pos[1]}),p.dirty=!0}else p.dirty&&(this._setPos(p.el,{left:null,top:null}),p.dirty=!1);a=p}else r++,a=p;else p.dirty&&(this._setPos(p.el,{left:null,top:null}),p.dirty=!1),a=p}}else for(var g=this._grid.length,f=0;f<g;f++){var v=this._grid[f];v.el!==t&&v.dirty&&(v.dirty=!1,this._setPos(v.el,{left:null,top:null}))}},l.prototype.disable=function(){this._disabled=!0},l.prototype.enable=function(){this._disabled=!1,this._initGrid(!0)},l.prototype.update=function(){this._disabled||this._initGrid(!0)},l.prototype._ensureGridIsActual=function(){this._initGrid()},l.prototype._needGridUpdate=function(){if(!this._grid)return 1;this._contInfo.prevSize=this._contInfo.prevSize||(0,o.getSize)(this._contEl);var t=0,e=this._contEl.children.length-this._excludedCount-(0,s.intval)(!!this._curPlaceholderEl);if(e!==this._grid.length)t=e>this._grid.length?2:1,this._contInfo.prevSize=(0,o.getSize)(this._contEl);else{var r=(0,o.getSize)(this._contEl),i=this._contInfo.prevSize;(Math.abs(i[0]-r[0])>5||Math.abs(i[1]-r[1])>5)&&(t=1),this._contInfo.prevSize=r}return t},l.prototype._initGrid=function(t){var e=t?1:this._needGridUpdate();if(e){1===e&&(this._grid=[],this._contInfo&&(delete this._contInfo.pos,delete this._contInfo.size));var r=this._grid?this._grid[this._grid.length-1]:null;this._grid=this._grid||[];var i,a=!!r,s=this._contEl.children;if(s.length)for(var n=this._getItemMargins(),l=this._curDragEl?this._grid.length:0,d=s.length;l<d;l++){var h=s[l];r&&h===r.el?a=!1:a||h===this._curPlaceholderEl||h.getAttribute("nodrag")||((i=(0,o.getSize)(h))[0]+=n[0],i[1]+=n[1],this._grid.push({el:h,size:i,pos:this._calcElementPos(h)}))}}},l.prototype._getRelativeMousePos=function(t){var e=this._getContPos(),r=this._getContShift();return{left:t.clientX-e[0]-r[0],top:t.clientY-e[1]-r[1]}},l.prototype._updateDraggablePosition=function(t){if(this._curDragEl){var e=this._getRelativeMousePos(t),r=this._getItemShift(),i=this._getContShift(),a=this._getContSize(),s=e.top-this._initial.shift.y-r[1]+i[1];this.options.limitBottomMove&&(s=Math.min(s,a[1]+30)),(0,o.hasClass)(this._contEl,"_ape_item_list")&&(s+=this._contEl.scrollTop),this._setPos(this._curDragEl,{left:e.left-this._initial.shift.x-r[0]+i[0],top:s}),window.AudioPage&&window.AudioPage.onUpdateDraggablePosition&&window.AudioPage.onUpdateDraggablePosition()}},l.prototype._getContShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.shift){var t=window.getComputedStyle(this._contEl);this._contInfo.shift=[parseFloat(t.paddingLeft),parseFloat(t.paddingTop)]}return this._contInfo.shift},l.prototype._getContSize=function(){return this._contInfo=this._contInfo||{},this._contInfo.size=(0,o.getSize)(this._contEl),this._contInfo.size},l.prototype._getContPos=function(){return this._contInfo=this._contInfo||{},this._contInfo.pos=(0,o.getXY)(this._contEl),this._contInfo.pos[1]-=(0,i.scrollGetY)(),this._contInfo.pos},l.prototype._getItemShift=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemShift){var t=window.getComputedStyle((0,o.domFC)(this._contEl));this._contInfo.itemShift=[parseFloat(t.marginLeft),parseFloat(t.marginTop)]}return this._contInfo.itemShift},l.prototype._getItemMargins=function(){if(this._contInfo=this._contInfo||{},!this._contInfo.itemMargins){var t=window.getComputedStyle((0,o.domFC)(this._contEl));this._contInfo.itemMargins=[parseFloat(t.marginLeft)+parseFloat(t.marginRight),parseFloat(t.marginTop)+parseFloat(t.marginBottom)]}return this._contInfo.itemMargins},l.prototype._calcElementPos=function(t){var e=this._getContShift(),r=this._getItemShift();return[t.offsetLeft-e[0]-r[0],t.offsetTop-e[1]-r[1]]},l.prototype.isCurrentlyDragging=function(){return!!this._curDragEl},l.prototype._initUpdaterScrollbar=function(){return(0,a.throttle)((t=>{var e=this.options.wrapNode||t,r=(0,o.data)(e,"sb");r&&r.update(!1,!0)}),500)},l.prototype._onMouseMove=function(t){var e=()=>this.options.wrapNode?this.options.wrapNode.scrollTop:(0,i.scrollGetY)(),r=t=>{this.options.wrapNode?this.options.wrapNode.scrollTop=t:(0,i.scrollToY)(t,0,!1,!0)};if(this._curDragEl){this._ensureGridIsActual(),!t&&(t={clientX:this._lastMousePos.x,clientY:this._lastMousePos.y}),this._lastMousePos={x:t.clientX,y:t.clientY},this._updateDraggablePosition(t);var a=this._getContSize(),s=this._getRelativeMousePos(t),l=!1;if((0,o.hasClass)(this._contEl,"_ape_item_list")&&(s.top+=this._contEl.scrollTop),s.left>0&&s.left<a[0]&&s.top>0&&s.top<a[1])for(var d=0,h=this._grid.length-1,c=50;c;){var p=d+Math.floor((h-d)/2),_=this._grid[p];if(s.left>_.pos[0]&&s.top>_.pos[1]&&s.left<_.pos[0]+_.size[0]&&s.top<_.pos[1]+_.size[1]){l=_;break}if(d===h)break;s.top<_.pos[1]||s.left<_.pos[0]&&s.top<_.pos[1]+_.size[1]?h=h===p?h-1:p:d=d===p?d+1:p,c--}else{for(var u,g,f,v=this._grid.length,m=999999,b=0;b<v;b++){var y=this._grid[b],P=(g=s.left-(y.pos[0]+y.size[0]/2))*g+(f=s.top-(y.pos[1]+y.size[1]/2))*f;m>P&&(m=P,u=y)}l=u}!l||this._curOverCell&&this._curOverCell.el===l.el||(this._curOverCell=l,this._recalc());var E,C,w,T,O=0;if(this.options.wrapNode)E=T=this.options.wrapNode,C=(0,o.getSize)(E),(w=(0,o.getXY)(E))[1]-=(0,i.scrollGetY)(),O=t.clientY;else{var S=window,x=document.documentElement,I=document.getElementsByTagName("body")[0],j=S.innerWidth||x.clientWidth||I.clientWidth,L=S.innerHeight||x.clientHeight||I.clientHeight;T=S.bodyNode,C=[j,L],w=[0,0],O=t.clientY}var k=Math.max(20,C[1]/10),D=w[1]+k-O,A=k-(w[1]+C[1]-O);if(A>0||D>0){var M=Math.min(1,D/k),z=Math.min(1,A/k);this._autoScrollTO||(this._autoScrollTO=setTimeout((()=>{this._autoScrollTO=!1;var t=e();r(t+16*(M>0?-M:z)),t!==T.scrollTop&&(this._updateScrollbar(T),this._onMouseMove())}),20))}if(this.options.onDragOverElClass){var B=t.target;(0,o.hasClass)(B,this.options.onDragOverElClass)||(B=(0,o.gpeByClass)(this.options.onDragOverElClass,B))?this._overEl!==B&&(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this.options.onDragEnter&&this.options.onDragEnter(B,this._curDragEl),this._overEl=B):(this._overEl&&this.options.onDragLeave&&this.options.onDragLeave(this._overEl,this._curDragEl),this._overEl=null)}}else if(this._dist(t)>this.options.dragThreshold){this._curDragEl=this._initial.candidateEl;for(var N=this._grid.length,H=0;H<N;H++)if(this._grid[H].el===this._curDragEl){this._curDragCellIndex=H;break}this.options.dragCls&&(0,o.addClass)(this._curDragEl,this.options.dragCls);var R=(0,o.getSize)(this._curDragEl),F=(0,o.getXY)(this._curDragEl),U=window.getComputedStyle(this._curDragEl),Y=this._getContPos();this._initial.hasInlineSize=!(!this._curDragEl.style.width&&!this._curDragEl.style.height),(0,o.setStyle)(this._curDragEl,{width:R[0],height:R[1]}),this._initialCurDragPos={left:F[0]-Y[0],top:F[1]-Y[1]-bodyNode.scrollTop},this._curPlaceholderEl=(0,o.ce)("div",{className:"ui_gridsorter_placeholder"}),(0,o.setStyle)(this._curPlaceholderEl,{width:R[0]+parseFloat(U.marginLeft)+parseFloat(U.marginRight),height:R[1]+parseFloat(U.marginTop)+parseFloat(U.marginBottom)}),this._contEl.insertBefore(this._curPlaceholderEl,this._curDragEl),(0,o.addClass)(this._curDragEl,"ui_gridsorter_moveable"),(0,o.addClass)(this._curDragEl,"ui_gridsorter_moveable_notrans"),(0,o.addClass)(this._contEl,"ui_gridsorter_cont"),this._onMouseMove(t),this._updateDraggablePosition(t),this.options.onDragStart&&this.options.onDragStart(this._curDragEl)}(0,n.cancelEvent)(t)};const d=l},257367:(t,e,r)=>{"use strict";r.d(e,{default:()=>h});r(59357),r(751876);var i=r(206566),a=r(442699),o=r(414914),s=r(917685),n=r(190148),l=r(433394);class d{constructor(t,e){if(!(t=(0,l.getScrollElement)(t)))throw new Error("uiScroll container is undefined");t.__uiScroll__&&t.__uiScroll__.destroy(),this.options=extend({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1,noLazyLoadWatch:!1},e),this.options.native&&(this.options.shadows=!1),i.browser.mobile&&(this.options.stopScrollPropagation=!1),isArray(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,(0,a.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),(0,a.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),(0,a.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),(0,a.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),(0,a.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),(0,a.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),(0,a.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),(0,a.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),(0,a.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:t,overflow:ce("div",{className:"ui_scroll_overflow"}),outer:ce("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:ce("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:ce("div",{className:"ui_scroll_shadow_top"}),shadowBottom:ce("div",{className:"ui_scroll_shadow_bottom"}),content:ce("div",{className:"ui_scroll_content clear_fix"}),barContainer:ce("div",{className:"ui_scroll_bar_container"}),barOuter:ce("div",{className:"ui_scroll_bar_outer"}),barInner:ce("div",{className:"ui_scroll_bar_inner"})},(0,o.data)(this.el.container,"ui-scroll",this);var r=(0,o.cf)(),n=["ui_scroll_container"];for(each(isArray(this.options.theme)?this.options.theme:trim(this.options.theme+"").split(/\s+/),(function(t,e){e&&n.push("ui_scroll_"+e+"_theme")})),addClass(this.el.container,n.join(" ")),this.options.hidden&&addClass(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=ce("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),r.appendChild(this.el.overflow),this.options.native?addClass(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),r.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),i.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){var h=(0,l.addResizeSensor)(this.el.inner,this.resize.bind(this,!0)),c=(0,l.addResizeSensor)(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(h[0]),this.removeElements.push(c[0]),this.startResizeListening=function(){h[1](),c[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(r),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init(),this.options.noLazyLoadWatch||(window.LazyLoad&&LazyLoad.watch(this.el.outer),window.LazyLoad&&LazyLoad.scanDelayed());var p="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":i.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,p,function(t){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&(0,s.cancelEvent)(t):this.isScrollEventUnused(t)?(0,s.cancelEvent)(t):(0,s.stopEvent)(t))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),each(this.options.scrollElements,function(t,e){this.addEvent(e,p,function(t){this.disabled||this.unnecessary||(this.scrollBy(d.scrollEventDelta(t)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(t)||(0,s.cancelEvent)(t))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(t){this.released=!1,this.noMore=!0;var e=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(t){removeEvent(document,"mouseup contextmenu touchend pointerup",e),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,addClass(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||removeClass(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(t,e,r,i){return this.removeEvents.push([t,e,r]),addEvent(t,e,r,void 0,void 0,i?{passive:!0}:void 0),r}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),each(this.removeEvents,(function(t,e){removeEvent.apply(null,e)})),this.el.overflow.parentNode==this.el.container){for(var t=(0,o.cf)();this.el.content.firstChild;)t.appendChild(this.el.content.firstChild);this.el.container.appendChild(t)}return(0,o.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),each(this.removeElements,(function(t,e){(0,o.re)(e)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(t){if((0,a.isFunction)(t)){this.animation&&this.animation.stop();var e=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;t(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-e}return this.api}updateBelow(t){if((0,a.isFunction)(t)){this.animation&&this.animation.stop();var e=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;t(),e&&this.scrollBottom(!1)}return this.api}fixBlocker(){i.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(t){this.options.native||(t&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),setStyle(this.el.container,"width",t?(0,o.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(t){this.disabled||this.inited&&this.emitter.emitEvent(t,[this.api])}static scrollEventDelta(t){var e=0,r=void 0!==t.deltaMode?t.deltaMode:"MozMousePixelScroll"==t.type?0:1;return"wheel"==t.type?e=t.deltaY:void 0!==t.wheelDeltaX&&void 0!==t.wheelDeltaY?(e=1/40*-t.wheelDeltaY,i.browser.mac&&i.browser.opera&&(e*=.1)):void 0!==t.wheelDelta?e=1/40*-t.wheelDelta:t.detail&&2===t.axis&&(e=t.detail),e*(1==r?15:2==r?450:1)}isScrollEventUnused(t){return d.scrollEventDelta(t)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(t){if(!t&&this.options.preserveEdgeBelow){var e=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),e&&this.scrollBottom(),this.options.stopScrollPropagation&&!t&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!t&&this.fixBlocker(),this.emitEvent("resize"))}disable(t){return this.disabled=!!t,t?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),(0,o.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(t){if(!(this.disabled||this.dragging||this.options.native))return t||(t=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),addEvent(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),addEvent(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=t.screenY,(0,s.cancelEvent)(t),this.emitEvent("dragstart"),this.api}dragstop(t){if(!this.disabled&&this.dragging&&!this.options.native){if(t||(t=window.event),this.dragging=!1,this.dragstopHandler&&removeEvent(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&removeEvent(document,"mousemove",this.dragHandler),setStyle(bodyNode,"cursor",""),removeClass(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);var e=(t.pageY-(0,o.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,e,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,t&&"contextmenu"!==t.type&&(0,s.cancelEvent)(t),this.emitEvent("dragstop"),this.api}}drag(t){if(!this.disabled&&this.dragging&&!this.options.native){t||(t=window.event);var e=(t.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+e:this.dragScroll+e,this.dragged||(this.dragged=!0,setStyle(bodyNode,"cursor","pointer"),addClass(this.el.container,"ui_scroll_dragging")),(0,s.cancelEvent)(t),this.emitEvent("drag"),this.api}}scroll(t,e,r){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==t&&this.update(!0),e?(e="number"!=typeof e||!isFinite(e)||e%1?300:Math.abs(e),this.animation=new n.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:n.Fx.Transitions.easeOutCubic,onStep:function(t){this.el.outer.scrollTop=t.scrollTop}.bind(this),duration:e,onComplete:(0,a.isFunction)(r)?r.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:t})):(this.el.outer.scrollTop=t,(0,a.isFunction)(r)&&r(this.api)),this.api}scrollTop(t,e,r,i){if(t&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll((0,a.intval)(e),r,i)}scrollBottom(t,e,r,i){if(t&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-(0,a.intval)(e),r,i)}scrollBy(t,e,r){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+(0,a.intval)(t),e,r)}scrollIntoView(t,e,r,i){if(t&&this.options.stopScrollPropagation&&this.fixBlocker(),(e=(0,l.getScrollElement)(e))&&e.compareDocumentPosition&&e.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){var s=(0,o.getXY)(e)[1],n=(0,o.getXY)(this.el.overflow)[1],d=(0,o.getSize)(e)[1];if(s<=n&&s+d>=n+this.api.data.viewportHeight||s>=n&&s+d<=n+this.api.data.viewportHeight)(0,a.isFunction)(i)&&(r?setTimeout(i.bind(this.api),0):i(this.api));else if(d>this.api.data.viewportHeight||s<n)this.scrollTop(!1,s-n+this.api.data.scrollTop-(this.options.shadows?(0,o.getSize)(this.el.shadowTop)[1]:0),r,i);else{var h=this.options.shadows?(0,o.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,s-n+this.api.data.scrollTop+d-this.api.data.viewportHeight+h,r,i)}}return this.api}update(t){var e,r;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));var i=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(t&&(e=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==e)||this.api.data.scrollTop!==i)){if(t&&(this.api.data.scrollHeight=e),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,i))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(!(r=(e=Math.max(this.options.minContentHeight,this.api.data.scrollHeight))<=this.api.data.viewportHeight)){var a=this.el.barOuter.offsetHeight;(t||this.barOuterHeight!==a)&&(this.barOuterHeight=a,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/e),this.el.barInner.style.height=this.barInnerHeight+"px"),(0,l.nextFrame)((()=>{var t=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(e-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${t}px)`}))}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!r)&&(0,o.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!r),this.shadowBottom!=(this.api.data.scrollBottom&&!r)&&(0,o.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!r)),this.unnecessary!==r&&((0,o.toggleClass)(this.el.container,"ui_scroll_unnecessary",r),this.unnecessary=r,this.options.stopScrollPropagation&&this.fixBlocker(),r&&this.barInnerHeight&&this.barOuterHeight&&(0,l.nextFrame)(function(t){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";var r=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(e-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${r}%)`}.bind(this)))}return this.emitEvent("update"),this.options.noLazyLoadWatch||window.LazyLoad&&LazyLoad.scanDelayed(this.el.outer),(!this.options.reversed||i>=0)&&this.more(),!0}return!1}more(){var t=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,e=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&t<=e&&this.emitEvent("more")}}d.addResizeSensor=l.addResizeSensor;const h=d},433394:(t,e,r)=>{"use strict";r.d(e,{nextFrame:()=>l,getScrollElement:()=>d,addResizeSensor:()=>h});var i,a=r(442699),o=r(206566),s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(t=>setTimeout(t,1)),n=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function l(t){i&&n(i),i=s(t)}function d(t){return(0,a.isString)(t)&&"_"===t[0]?geByClass1(t):ge(t)}function h(t,e){if((t=d(t))&&(0,a.isFunction)(e)){if(o.browser.msie9||o.browser.opera&&o.browser.version<13){var r=!1,i=!1,s=ce("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){i=!0,r&&n()}});function n(){if(!s.contentDocument)return setTimeout(n,100);s.contentDocument.defaultView.removeEventListener("resize",e),s.contentDocument.defaultView.addEventListener("resize",e),e()}return t.appendChild(s),t.__resizeSensor__=[s,function(){r=!0,i&&n()}]}var l=ce("div",{className:"ui_scroll_resize_sensor"}),h=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),c=ce("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),p=ce("div"),_=ce("div"),u=null;return h.appendChild(p),c.appendChild(_),l.appendChild(h),l.appendChild(c),t.appendChild(l),t.__resizeSensor__=[l,h.onscroll=c.onscroll=function(){var r=(t.offsetWidth||1e4)+10,i=(t.offsetHeight||1e4)+10;p.style.width=r+"px",p.style.height=i+"px",h.scrollLeft=r,h.scrollTop=i,c.scrollLeft=r,c.scrollTop=i,u!==(u=r+" "+i)&&e()}]}}},130712:(t,e,r)=>{"use strict";r.d(e,{ParagraphType:()=>a,ResizableObjectTypes:()=>o,ObjectResizeType:()=>s,ArticleStatsEvents:()=>n,getAppropriateImage:()=>l,preloadImage:()=>h,mailruStatsPixel:()=>c,getUrlParam:()=>p,changeHeightInstagramEmbed:()=>_,ALLOWED_FILE_TYPES_FOR_PASTE:()=>u});var i=r(917999),a={Text:1,Header1:2,Header2:3,Header3:4,Code:5,NumericList:6,BulletList:7,Quote:8,Quote2:9,ObjectAudioPlaylist:100,ObjectPhoto:101,ObjectVideo:102,ObjectGIF:103,ObjectPodcast:104,ObjectAudio:105,ObjectTwitter:106,ObjectFacebook:107,ObjectInstagram:108,ObjectVK:109,ObjectTelegram:110,ObjectPoll:111,ObjectMarketItem:112,ObjectAliExpressProduct:113},o=[a.ObjectPhoto,a.ObjectGIF,a.ObjectVideo,a.ObjectTwitter,a.ObjectFacebook,a.ObjectInstagram,a.ObjectVK,a.ObjectTelegram],s={Normal:0,Float:1,Medium:2,Large:3},n={clickOnVideo:"click_on_video",clickOnAudio:"click_on_audio",clickOnPhoto:"click_on_photo",clickOnExternalLink:"external_link_click",clickOnCarouselNext:"click_on_carousel_next",clickOnCarouselPrev:"click_on_carousel_prev",clickOnMentions:"click_on_mentions",nightModeOn:"night_mod_on",nightModeOff:"night_mod_off",close:"close"};function l(t,e,r){var a=[];if((0,i.each)(t,(function(t,e){r&&!["w","z","y","x","m","s"].includes(t)||a.push(e)})),!a.length)return[!1];a.sort((function(t,e){return t[1]-e[1]})),e*=window.devicePixelRatio>=2?2:1;var o=a[a.length-1];return(0,i.each)(a,(function(t,r){if(r[1]>=e)return o=r,!1})),o}var d={};function h(t,e){if(!0===d[t])return e&&e(),!0;if(Array.isArray(d[t]))return d[t].push(e),!1;d[t]=[e];var r=new Image;return r.onload=function(){var e=d[t];d[t]=!0,(0,i.each)(e,(function(t,e){e&&e()}))},r.src=t,!1}function c(t,e){if((0,i.isObject)(e)&&!(0,i.isEmpty)(e)){var r="https://vk-callback.go.mail.ru/longread_pxl?action="+t;(0,i.each)(e,(function(t,e){r+="&"+t+"="+e})),(new Image).src=r}}function p(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e||location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function _(t){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(t.origin)){var e=function(t){for(var e,r=document.getElementsByTagName("iframe"),i=r.length-1;i>=0;i--){var a=r[i];if(a.contentWindow===t.source){e=a;break}}return e}(t);if(e){try{t=JSON.parse(t.data)}catch(t){}"object"==typeof t&&"string"==typeof t.type&&"object"==typeof t.details&&setTimeout((function(){if("MEASURE"===t.type){var r=t.details.height;e.setAttribute("height",r)}}),100)}}}var u="*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;*.gif;*.GIF"},254235:(t,e,r)=>{"use strict";r.d(e,{getCleanedState:()=>n,expandParagraphFields:()=>l});var i=r(130712),a=r(703930),o=r(917999);function s(t){return JSON.parse(JSON.stringify(t))}function n(t,e,r){var n=[];return t.forEach((function(t,l){r&&!(0,a.isObjectParagraph)(t)&&(0,a.isParagraphEmpty)(t)&&0!=l&&t.type!=i.ParagraphType.Code||n.push(function(t,e){var r={type:i.ParagraphType.Text,lines:[]};for(var n in t)if(t.hasOwnProperty(n)){if(n.startsWith("_")&&("_uuid"!==n||!e))continue;var l=t[n];r[n]=(0,o.isObject)(l)||Array.isArray(l)?s(l):l}return(0,a.isObjectParagraph)(t)&&t._object&&(r.mediaId=t._object.getMediaId()),t.sep&&(r.sep=1),r.type==i.ParagraphType.Text&&delete r.type,r.lines.forEach((function(t){if(t){if(void 0!==t.decorations){var e=!0;(0,o.each)(t.decorations,(function(r,i){0==i.length?delete t.decorations[r]:e=!1})),e&&delete t.decorations}t.brs&&0==t.brs.length&&delete t.brs}})),r}(t,e))})),s(n)}function l(t){return t.forEach((function(t){t.type=t.type||i.ParagraphType.Text,t.lines.forEach((function(t){t.brs=t.brs||[],t.decorations=t.decorations||{}}))})),t}},523251:(t,e,r)=>{"use strict";r.d(e,{ArticleEditor:()=>et});var i=r(570655),a=r(616149),o=r(454090),s=r(383030),n=r(199996),l=r(975515),d=r(744630),h=r(410500),c=r(558996),p=r(641925),_=r(158723),u=r(263862),g=r(700072),f=r(998539),v=r(235184),m=r(859828),b=r(703930),y=r(130712),P=r(371490),E=r(98654),C=r(647276),w=r(254235),T=r(414914),O=r(442699),S=r(116886),x=r(927663),I=r(469433),j=r(917685),L=r(791563),k=r(917999),D=r(519921),A=r(45150),M=r(651988),z=65,B=66,N=67,H=73,R=83,F=89,U=90,Y=8,W=13,G=38,X=40,K=46,V=9,q=[{type:"strong",tag:"strong"},{type:"em",tag:"em"},{type:"strike",tag:"strike"},{type:"link",tag:"a"},{type:"code",tag:"code"}],Q=q.slice().reverse(),$={};q.forEach((function(t){$[t.tag]=t}));var J={};q.forEach((function(t){J[t.type]=t}));var Z=1;function tt(){return Z+++"-"+Date.now()%1e6+"-"+(0,k.irand)(0,99999)}var et=function(){function t(t,e,r,i){this._id=tt(),window.cur.lang=window.cur.lang||{},(0,O.extend)(window.cur.lang,i.lang),this._options=i,this._els={editor:(0,T.ge)(t),canvas:(0,T.se)('<div class="article_editor_canvas article_edit article" contenteditable="true"></div>')},this._els.editor.appendChild(this._els.canvas),this._els.editor.appendChild(this._photoUploadEl=(0,T.se)('<div class="article_photo_upload"></div>')),(0,T.addClass)(this._els.editor,"article_editor"),this._dirty=[],this._undos=[],this._redos=[],this._objects={},this._floatedObjects=[],(0,C.initLimits)(i.limits);var a=r||[];if(i.postData){var o=i.postData.text||"";o=(o=o.replace(/❤/g,"❤️")).split("\n");var s=[];s.push((0,b.buildParagraph)({type:y.ParagraphType.Header1,lines:[{text:""}]})),o.forEach((function(t){(0,O.trim)(t)&&s.push((0,b.buildParagraph)({lines:[{text:(0,O.clean)(t)}]}))})),a=s.concat(a)}a&&0!=a.length||(a=[(0,b.buildParagraph)({type:this._options.noTitle?y.ParagraphType.Text:y.ParagraphType.Header1})]),(a=a.filter((function(t){return!1!==t}))).forEach((function(t){t.lines.forEach((function(t){t.text=(0,b.replaceParagraphEntities)(t.text),t.brs&&(0,k.isObject)(t.brs)&&(t.brs=(0,b.convertBRsToArray)(t.brs))}))})),i.needIndexCorrection&&(0,b.correctRealIndexes)(a,1),this.initParagraphs(a),this._updateTextPlaceholders(),this._initObjectDrag(),i.postData?(0,b.focusEl)(this._getParagraphElByIndex(0)):this._restoreLastCursor(),this.saveDraft(!1,!0),i.coverPhoto&&this.setCoverPhoto(i.coverPhoto,!1),(this._options.isPublished||this._options.wasPublished)&&this.setPublishName(e.name),this.updateWarnInfos(),this._publishNameCandidate=i.name||this._getName(),this._saveUndoState(),this.wasPublishedInCurrentSession=!1,this._openTime=Date.now(),window.stManager.add([window.jsc("web/audio.js")]).catch((function(){}))}return t.prototype.updateWarnInfos=function(){this.showWarningInfo(),this.showEditLockInfo(),this.showRevEditInfo()},t.prototype._setEventListener=function(t,e,r){this._events=this._events||[],this._events.push({el:t,event:e,handler:r}),t.addEventListener(e,r)},t.prototype.setCoverPhoto=function(t,e){void 0===e&&(e=!0),this._coverPhoto=t,this._options.isPublished||this.saveDraft(e)},t.prototype.getCoverPhoto=function(){return!1!==this._coverPhoto&&(this._coverPhoto?this._coverPhoto:void 0)},t.prototype.getFirstCoverPhotoFromParagraphs=function(){var t=!1;return this._ps.forEach((function(e){if(!t&&e.type==y.ParagraphType.ObjectPhoto){var r=e._object.getMediaId(0);t={id:r,data:E.ArticleEditorPreparedData.get(y.ParagraphType.ObjectPhoto,r)}}})),t},t.prototype.getPublishName=function(){return this._publishName||this._publishNameCandidate||this._getName()},t.prototype.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},t.prototype.setPublishName=function(t){this._publishName=t,this._options.isPublished||this.saveDraft(!0)},t.prototype._updateTextPlaceholders=function(){if(!this._options.noTitle){this._els.placeholders||(this._els.placeholders=(0,T.se)('<div class="article_ed__text_placeholders"></div>'),this._els.placeholderTitle=(0,T.se)("<h1>"+this.getOptions().placeholderTitle+"</h1>"),this._els.placeholderFirstParagraph=(0,T.se)("<p>"+this.getOptions().placeholderParagraph+"</p>"),this._els.placeholders.appendChild(this._els.placeholderTitle),this._els.placeholders.appendChild(this._els.placeholderFirstParagraph),this._els.editor.appendChild(this._els.placeholders)),(0,b.isParagraphEmpty)(this._ps[0])?(0,T.removeClass)(this._els.placeholderTitle,"article_ed__text_placeholder_hidden"):(0,T.addClass)(this._els.placeholderTitle,"article_ed__text_placeholder_hidden");var t=this._ps[1],e=!!t&&t.sep,r=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0];(0,b.isParagraphEmpty)(t)&&(!t||t.type!=y.ParagraphType.Code)&&r<2&&this._ps.length<=2&&!e?(0,T.removeClass)(this._els.placeholderFirstParagraph,"article_ed__text_placeholder_hidden"):(0,T.addClass)(this._els.placeholderFirstParagraph,"article_ed__text_placeholder_hidden")}},t.prototype.destroy=function(){this._els.editor.innerHTML="",(0,T.removeClass)(this._els.editor,"article_editor"),this._formatTooltip&&this._formatTooltip.destroy(),this._resizeTooltip&&this._resizeTooltip.destroy(),this._objectPickerTooltip&&this._objectPickerTooltip.destroy(),this._events=this._events||[],this._events.forEach((function(t){t.el.removeEventListener(t.event,t.handler)})),delete window.cur.docsCurFilter},t.prototype.getLimits=function(){return this._options.limits},t.prototype.getOptions=function(){return this._options},t.prototype.getWidth=function(t){return void 0===t&&(t=!1),(0,T.getSize)(this._els.canvas)[0]+(t?2*this._options.figureSideMargin:0)},t.prototype.getPhotoUploadOptions=function(){return this._options.photoUploadOptions},t.prototype.getPhotoUploadEl=function(){return this._photoUploadEl},t.prototype.removeObject=function(t){var e=this;(0,k.each)(this._ps,(function(r,i){if(i._object==t){var a=e._getParagraphElByIndex(r+1);return(0,b.focusEl)(a),(0,T.re)(e._getParagraphElByIndex(r)),e._setAllParagraphsDirty(),e._triggerInputEvent(),!1}}))},t.prototype._processPastedUrl=function(t,e){var r=this,i=this._getParagraph(t);i&&i.type==y.ParagraphType.Text&&setTimeout((function(){r._processMatchingEmbeds(t,e)||((0,T.re)(r._els.shareParseForm),(0,T.re)(r._els.shareIFrame),r._els.shareIFrame=r._els.editor.appendChild((0,T.se)('<iframe class="editor__share_parse_iframe" name="editor__share_parse_iframe"></iframe>')),r._els.shareParseForm=r._els.editor.appendChild((0,T.ce)("form",{action:"share.php?act=url_attachment",method:"post",target:"editor__share_parse_iframe"})),r._els.shareParseForm.appendChild((0,T.ce)("input",{type:"hidden",name:"hash",value:r._options.shareHash})),r._els.shareParseForm.appendChild((0,T.ce)("input",{type:"hidden",name:"url",value:e})),r._els.shareParseForm.appendChild((0,T.ce)("input",{type:"hidden",name:"index",value:1})),r._els.shareParseForm.appendChild((0,T.ce)("input",{type:"hidden",name:"force_media",value:1})),r._els.shareParseForm.appendChild((0,T.ce)("input",{type:"hidden",name:"from",value:"article"})),r._els.shareParseForm.appendChild((0,T.ce)("input",{type:"hidden",name:"owner_id",value:window.cur.oid})),window.onUploadFail=function(){},window.onUploadDone=function(e){if(e){var i=e[2];if(i){var a,o,s={};switch(e[0]){case"audio_playlist":a=y.ParagraphType.ObjectAudioPlaylist,s={accessHash:i.accessHash},e[1]=i.ownerId+"_"+i.id+(i.accessHash?"_"+i.accessHash:"");break;case"podcast":a=y.ParagraphType.ObjectPodcast,s={};break;case"poll":a=y.ParagraphType.ObjectPoll,s={editable:!1,snippet:i.snippet};break;case"doc":"gif"!=i.ext&&3!=i.type||(a=y.ParagraphType.ObjectGIF,(s={size:i.video_preview_size,video:i.video_preview,href:i.href||i.editable.href}).video||s.href||(a=!1));break;case"photo":a=y.ParagraphType.ObjectPhoto,s={size:(0,b.getPhotoSize)(i.editable.sizes),sizes:i.editable.sizes};break;case"video":a=y.ParagraphType.ObjectVideo,s={editable:i.editable,duration:i.editable.duration,platform:i.editable.platform}}if(a){var n=(0,b.hasSeparator)(r._ps[t]),l={mediaId:e[1],type:a,sep:n,fromExtPage:(0,k.intval)(i.from_ext_page)};E.ArticleEditorPreparedData.add(a,l.mediaId,s),r._linkTooltip&&r._linkTooltip.hide(),l=(0,b.buildParagraph)(l),(o=r._getParagraph(t+1))&&o._object&&o._object._mediaId===l.mediaId||(r._getOrCreateParagraphObject(l),r._insertParagraphAt(t+1,l),r._els.canvas.normalize(),r._redraw(!0,!0),r._saveUndoState(),setTimeout((function(){r.onObjectStateLoaded()}),10))}}}},r._els.shareParseForm.submit())}),0)},t.prototype._processMatchingEmbeds=function(t,e){var r,i,a;if(r=e.match(/^https?:\/\/(?:www.)?twitter\.com\/(?:#!\/)?(?:\w+)\/status(?:es)?\/(\d+)$/))i=y.ParagraphType.ObjectTwitter,a=r[1];else if(r=e.match(/^https?:\/\/(?:www.)?instagram\.com\/p\/([a-zA-Z0-9_-]+)(?:\/embed)?(?:\/)?/))i=y.ParagraphType.ObjectInstagram,a=r[1];else if(r=e.match(/^https?:\/\/(?:www.)?facebook\.com\/(\w.+)\/posts\/(\d+)\/?$/))i=y.ParagraphType.ObjectFacebook,a=r[1]+";"+r[2];else if(r=e.match(/^(?:https?:\/\/)?(?:[a-z0-9\_\.-]*\.)?(?:www.)?vk\.com\/(?:[a-z0-9\_\.-?]*w=)?wall(-?\d+)_(\d+)/))i=y.ParagraphType.ObjectVK,a=r[1]+";"+r[2];else if(r=e.match(/^https?:\/\/(?:www.)?t\.me\/(\w.+)\/(\d+)/)){if((0,T.ge)("telegram-post-"+r[1]+"-"+r[2]))return!1;i=y.ParagraphType.ObjectTelegram,a=r[1]+";"+r[2]}if(!i||!a)return!1;var o=(0,b.buildParagraph)({_uuid:tt(),type:i,mediaId:a}),s=this._getParagraph(t+1);return s&&s._object&&s._object._mediaId===o.mediaId||(this._getOrCreateParagraphObject(o),this._insertParagraphAt(t+1,o),this._els.canvas.normalize(),this._redraw(!0,!0),this._saveUndoState()),!0},t.prototype._handleObjectPaste=function(t){var e=(t.clipboardData||t.originalEvent.clipboardData).getData("text/plain");if(e){var r=(0,i.__read)(e.split(":"),2),a=r[0],o=r[1];if("uuid"==a&&o){var s=(0,T.domQuery1)('[data-uuid="'+o+'"]');if(s){var n=s.cloneNode(!0);n.setAttribute("data-force-update","1");var l=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0];(0,T.domInsertAfter)(n,this._getParagraphElByIndex(l)),t.preventDefault(),this._setAllParagraphsDirty(),this._triggerInputEvent()}}}},t.prototype._handleLinkPaste=function(t){var e=this,r=(t.clipboardData||t.originalEvent.clipboardData).items,a=function(t){if(!r.hasOwnProperty(t))return"continue";var a=r[t];if("string"===a.kind){var s=(0,i.__read)(o._getCurrentParagraphIndex(),1)[0];a.getAsString((function(t){var r=t.replace(/(<([^>]+)>)/gi,""),i=(0,O.extractUrls)(r,!0);if(1===i.length){var a=i[0].url,o=e._getParagraphElByIndex(s);e._processPastedUrl(s,a),(0,b.traverseTree)(o,(function(t){if(t.nodeType==Node.TEXT_NODE&&t.textContent.indexOf(a)>=0&&!(0,T.traverseParent)(t,(function(t){return t.tagName&&"a"==t.tagName.toLowerCase()}),3)){e._saveCursorMarker();var r=document.createRange();r.setStart(t,t.textContent.indexOf(a)),r.setEnd(t,t.textContent.indexOf(a)+a.length);var i=window.getSelection();i.removeAllRanges(),i.addRange(r),e._setParagraphDirty(s),document.execCommand("createLink",!1,a),e._restoreCursorFromMarker()}}),!1)}}))}},o=this;for(var s in r)a(s)},t.prototype._handlePhotoPaste=function(t){var e=this;this._photoPasteUploadingProcess=!1;var r=(t.clipboardData||t.originalEvent.clipboardData).items,a=function(t){if(!r.hasOwnProperty(t))return"continue";var a=r[t];if("file"===a.kind){o._photoPasteUploadingProcess=!0;var s=a.getAsFile(),n=new FileReader;n.onload=function(){e._photoPasteUploadingProcess=!1;var t=(0,i.__read)(e._getCurrentParagraphIndex(),1)[0];t=t||0;var r,a=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPhoto});e._getOrCreateParagraphObject(a).setBLOB(s),(0,b.isParagraphEmpty)(e._ps[t])?(r=t,(0,b.hasSeparator)(e._ps[r])&&(a.sep=1),e._ps[r]=a):(r=t+1,e._insertParagraphAt(r,a)),e._redraw(!0,!0);var o=new Image;o.onload=function(){e._focusParagraph(r+1),e._showObjectPicker()},o.src=n.result},n.readAsDataURL(s)}},o=this;for(var s in r)a(s)},t.prototype._getCurrentSelectionState=function(){var t,e=(0,i.__read)(this._getCurrentParagraphIndex(),2),r=e[0],a=e[1];if(!1===r||!1===a)return!1;for(var o,s,n={decorations:{},header1:!1,header2:!0,header3:!0,header:!1,object:!1,quote:!0,list:!1,justHeaders:!0},l={},d=0,h=r;h<=a&&h<this._ps.length;h++){var c=(0,b.isObjectParagraph)(this._ps[h])?this._ps[h]._object.getCaptionEl():this._getParagraphElByIndex(h);void 0===o&&(t=(0,i.__read)((0,O.getCaretCharacterOffsetWithin)(c),2),o=t[0],s=t[1]),this._ps[h].lines.forEach((function(t){var e=t.decorations;q.forEach((function(r){var i=e[r.type];i&&!(0,k.isEmpty)(i)&&i.forEach((function(e){var i=[e[0]+d,e[1]+d];if("link"==r.type)o<i[1]&&s>i[0]&&(l[r.type]=1,n.decorations[r.type]=!0);else if(1==l[r.type]){var a=s>=i[0]&&s<=i[1];s>i[1]||(a?e[0]>0?l[r.type]=-1:(l[r.type]=2,n.decorations[r.type]=!0):l[r.type]=-1)}else if(!l[r.type]){var h=o>=i[0]&&o<=i[1];a=s>=i[0]&&s<=i[1];h&&a?(l[r.type]=2,n.decorations[r.type]=!0):h&&(t.text.length>i[1]?l[r.type]=-1:l[r.type]=1)}}))})),d+=t.text.length}))}for(h=r;h<=a&&h<this._ps.length;h++)(0,b.isObjectParagraph)(this._ps[h])&&(n.captionFocused=n.captionFocused||this._ps[h]._object.isCaptionFocused(),n.object=!0),this._ps[h].type==y.ParagraphType.Header1&&(n.header1=!0),this._ps[h].type!=y.ParagraphType.Header2&&(n.header2=!1),this._ps[h].type!=y.ParagraphType.Header3&&(n.header3=!1),(0,O.inArray)(this._ps[h].type,[y.ParagraphType.Header1,y.ParagraphType.Header2,y.ParagraphType.Header3])?n.header=!0:n.justHeaders=!1,(0,O.inArray)(this._ps[h].type,[y.ParagraphType.Quote,y.ParagraphType.Quote2])||(n.quote=!1),(0,O.inArray)(this._ps[h].type,[y.ParagraphType.BulletList,y.ParagraphType.NumericList])&&(n.list=!0);var p=(0,i.__read)((0,b.getRange)(),1)[0];return!(p&&p.startContainer&&(0,T.hasClass)(p.startContainer,"article_ed__noconteditable"))&&(n.multiline=r!=a,n)},t.prototype._hideFormatTooltip=function(){this._formatTooltip&&this._formatTooltip.isShown()&&this._formatTooltip.hide()},t.prototype._showFormatTooltip=function(){if(!this.isLocked()){clearTimeout(this._doShowFormatTooltipTO);try{var t=window.getSelection();if(t.focusNode&&((0,T.hasClass)(t.focusNode,"article_set_link")||"input"==t.focusNode.nodeName.toLowerCase()))return;var e=!t.isCollapsed;this._doShowFormatTooltipTO=setTimeout(this._doShowFormatTooltip.bind(this,e),1)}catch(t){}}},t.prototype._doShowFormatTooltip=function(t){var e=this;if(!this._formatTooltip){var r,a=(0,T.se)('\n        <div>\n          <div class="article_format_btns clear_fix"></div>\n          <div class="article_set_link"><input type="text" placeholder="'+(0,S.getLang)("pages_articles_enter_link")+'"/><div class="article_set_link_delete"></div></div>\n        </div>');this._formatTooltip=new A.default(this._els.editor,{cls:"article_format_tt",content:a,customShow:!0,offset:[0,-3],onShow:function(){var t=e._getCurrentSelectionState(),r=[];if(!t||t.header1||t.object&&!t.captionFocused||(t.justHeaders||r.push(["strong","cur.articleEditor.setStrong()",!!t.decorations.strong]),t.quote||t.justHeaders||r.push(["em","cur.articleEditor.setEm()",!!t.decorations.em]),r.push(["strike","cur.articleEditor.setStrike()",!!t.decorations.strike]),t.decorations.link?r.push(["link","cur.articleEditor.clearLink()",t.decorations.link]):r.push(["link","cur.articleEditor.setLinkMode(true)",t.decorations.link]),t.object||t.header1||t.list||(r.push(["header1","cur.articleEditor.setHeader1("+(0,k.intval)(t.header2)+")",t.header2]),r.push(["header2","cur.articleEditor.setHeader2("+(0,k.intval)(t.header3)+")",t.header3]),r.push(["quote","cur.articleEditor.setQuote()",t.quote]))),0!=r.length){var i=(0,T.geByClass1)("article_format_btns",a);i.innerHTML="",r.forEach((function(t,e){e>0&&(0,O.inArray)(t[0],["header1"])&&i.appendChild((0,T.se)('<div class="article_format_divider"></div>'));var r=t[2]?"article_format_btn_active":"";i.appendChild((0,T.se)('<button class="article_format_btn '+r+'" id="article_format_btn_'+t[0]+'" onclick="'+t[1]+'"></button>'))})),e.setLinkMode(!1)}else e._formatTooltip.hide()},getTargetBoundingBox:function(){if(e._formatTooltip.linkMode)return r;var t=(0,i.__read)((0,b.getRange)(),3),a=t[0],o=t[2];if(!o||!o.rangeCount)return r;var s=a.getBoundingClientRect();if(!s.left){var n=a.startContainer.nodeType==Node.ELEMENT_NODE?a.startContainer:(0,T.domPN)(a.startContainer),l=(0,T.getXY)(n),d=(0,T.getSize)(n);return r={top:l[1]+(0,x.scrollGetY)(),left:l[0]+d[0]/2,width:s.width,height:s.height}}return r={top:s.top+(0,x.scrollGetY)(),left:s.left,width:s.width,height:s.height}}}),this._formatTooltip.linkMode=!1;var o=(0,T.geByTag1)("input",a);o.addEventListener("keypress",(function(t){if(t.keyCode==W)return e._setLinkToSelectedText(o.value.trim()),e._formatTooltip.hide(),(0,j.cancelEvent)(t)})),(0,T.geByClass1)("article_set_link_delete",a).addEventListener("click",(function(t){return e._setLinkToSelectedText(),(0,j.cancelEvent)(t)}))}t?(this._linkTooltip&&this._linkTooltip.isShown()&&this._linkTooltip.hide(),this._formatTooltip.show(),this._formatTooltip.getOptions().onShow(),this._formatTooltip.updatePosition()):(this._formatTooltip.hide(),this._formatTooltip.linkMode&&this.setLinkMode(!1,!0))},t.prototype._setLinkToSelectedText=function(t){if(t){if(!(t=(t=t.substr(0,1500)).replace(/%E2%80%AE/i,"").replace("&#8238;","").replace(/&#x202E;/i,"")).match("^https?://"))t=((0,b.isVKUrl)(t)?"https":"http")+"://"+t;t=encodeURIComponent(t)}this.setLinkMode(!1,!1),this._restoreCursor(this._linkSelectedCursor),this._setAllParagraphsDirty(),t&&document.execCommand("createLink",!1,t),!window.browser.msie&&t||this._triggerInputEvent(),t?this._restoreCursor(this._linkSelectedCursor):this._restoreCursor(this._linkCursor)},t.prototype.clearLink=function(){this.setLinkMode(!1);var t=(0,i.__read)((0,b.getRange)(),3),e=t[0],r=t[2],a=(0,T.domClosestByTag)("a",e.startContainer),o=(0,T.domClosestByTag)("a",e.endContainer)||a;a&&(this._saveCursorMarker(),r.setBaseAndExtent(a,0,o,Math.max(1,o.children.length))),this._setCurrentParagraphDirty(),document.execCommand("unlink",!1)},t.prototype.setLinkMode=function(t,e){var r;t&&(r=this._getCursor(),window.browser.msie||document.execCommand("superscript",!1,!0));var i=this._formatTooltip.getContent();if(this._formatTooltip.linkMode!=!!t)if(t){var a=(0,T.geByTag1)("input",i);a.value="",(0,T.addClass)(i,"article_editor_format_tt_set_link"),this._linkCursor=r,this._linkSelectedCursor=this._getCursor(),a.focus(),this._formatTooltip.linkMode=!0,this._formatTooltip.updatePosition()}else(0,T.setStyle)(i,{width:null}),(0,T.removeClass)(i,"article_editor_format_tt_set_link"),this._formatTooltip.linkMode=!1,e&&(this._saveCursorMarker(),this._setAllParagraphsDirty(),this._triggerInputEvent())},t.prototype.setHeader1=function(t){this._setHeader(y.ParagraphType.Header2,!t)},t.prototype.setHeader2=function(t){this._setHeader(y.ParagraphType.Header3,!t)},t.prototype.setQuote=function(){var t=this._getCursor(),e=(0,i.__read)(this._getCurrentParagraphIndex(),2),r=e[0],a=e[1];if(!1!==r){a||(a=r);for(var o=y.ParagraphType.Text,s=r;s<=a;s++)if(l(this._ps[s])){o=this._ps[s].type==y.ParagraphType.Quote?y.ParagraphType.Quote2:this._ps[s].type==y.ParagraphType.Quote2?y.ParagraphType.Text:y.ParagraphType.Quote;break}for(s=r;s<=a;s++){var n=this._ps[s];l(n)&&(this._ps[s]=(0,b.buildParagraph)({type:o,lines:[n.lines[0]],sep:(0,b.hasSeparator)(this._ps[s])}),this._setParagraphDirty(s))}this._redraw(!0),this._updateTextPlaceholders(),this._restoreCursor(t),this._saveUndoState(),this.saveDraft()}function l(t){return!(0,b.isObjectParagraph)(t)&&!(0,b.isListParagraph)(t)}},t.prototype._setHeader=function(t,e){var r=this._getCursor(),a=(0,i.__read)(this._getCurrentParagraphIndex(),2),o=a[0],s=a[1];if(!1!==o){s||(s=o);for(var n=o;n<=s;n++){l(this._ps[n])&&(this._ps[n].type=e?t:y.ParagraphType.Text,this._setParagraphDirty(n))}this._redraw(!0),this._updateTextPlaceholders(),this._restoreCursor(r),this._saveUndoState(),this.saveDraft()}function l(t){return!(0,b.isObjectParagraph)(t)&&!(0,b.isListParagraph)(t)}},t.prototype.setStrong=function(){this._setAllParagraphsDirty(),document.execCommand("bold"),window.browser.msie&&this._triggerInputEvent()},t.prototype.setEm=function(){this._setAllParagraphsDirty(),document.execCommand("italic"),window.browser.msie&&this._triggerInputEvent()},t.prototype.setStrike=function(){this._setCurrentParagraphDirty(),document.execCommand("strikeThrough"),window.browser.msie&&this._triggerInputEvent()},t.prototype.saveUndoStateAndDraft=function(){this._saveUndoState(),this.saveDraft()},t.prototype._saveUndoStateDelayed=function(){var t=this;clearTimeout(this._saveUndoDelayedTO),this._saveUndoDelayedTO=setTimeout((function(){t._saveUndoState()}),1e3)},t.prototype._saveUndoState=function(){clearTimeout(this._saveUndoDelayedTO),this._saveUndoDelayedTO=!1;var t=(0,w.getCleanedState)(this._ps,!0);if(this._undoCurrentState){if(JSON.stringify(t)==JSON.stringify(this._undoCurrentState))return;this._undos.push({ps:this._undoCurrentState,cursor:this._lastCursor}),this._undos.length>100&&this._undos.shift()}this._undoCurrentState=t,this._undoCurrentStateCursor=this._getCursor(),this._redos=[],this._options.onUndoRedo&&this._options.onUndoRedo()},t.prototype.undo=function(){if(this._saveUndoDelayedTO&&this._saveUndoState(),this._undos.length){this._redos.push({ps:this._undoCurrentState,cursor:this._undoCurrentStateCursor});var t=this._undos.pop();this._ps=(0,w.expandParagraphFields)(t.ps),this._undoCurrentState=(0,w.getCleanedState)(this._ps,!0),this._undoCurrentStateCursor=t.cursor,this._redraw(!0),t.cursor&&this._restoreCursor(t.cursor),this._updateTextPlaceholders(),0==this._undos.length&&(this._undoable=!1)}this._options.onUndoRedo&&this._options.onUndoRedo()},t.prototype.redo=function(){if(0!=this._redos.length){this._undos.push({ps:this._undoCurrentState,cursor:this._undoCurrentStateCursor});var t=this._redos.pop();this._ps=(0,w.expandParagraphFields)(t.ps),this._undoCurrentState=(0,w.getCleanedState)(this._ps,!0),this._undoCurrentStateCursor=t.cursor,this._redraw(!0),t.cursor&&this._restoreCursor(t.cursor),this._updateTextPlaceholders(),this._options.onUndoRedo&&this._options.onUndoRedo()}},t.prototype.canUndo=function(){return this._undoable||this._undos.length>0},t.prototype.canRedo=function(){return this._redos.length>0},t.prototype.initParagraphs=function(t){t.forEach((function(t){if(t._preparedData){((0,b.isEmbedType)(t.type)?[t.mediaId]:t.mediaId.split(",")).forEach((function(e,r){E.ArticleEditorPreparedData.add(t.type,e,t._preparedData[r])})),delete t._preparedData}})),this._ps=(0,w.expandParagraphFields)(t),this._cleanParagraphsBRs(),this._ensureDummyParagraphs(),this._init()},t.prototype._getParagraphFromHTML=function(t,e,r){function i(e,r){if(e.nodeType==Node.TEXT_NODE){var a=e.data.replace(/</g,"&lt;").replace(/>/g,"&gt;");r.text+="pre"==t?a:(0,b.cleanTextSpaces)(a)}else(0,b.isBR)(e)&&r.text.length>0&&r.brs.push(r.text.length);(0,k.each)(e.childNodes,(function(t,e){var a=[r.text.length];i(e,r),a.push(r.text.length);var o,s=(e.tagName||"").toLowerCase();switch(e.style&&("bold"==e.style.fontWeight||parseInt(e.style.fontWeight)>400)&&(s="strong"),s){case"b":case"strong":o=J.strong;break;case"em":case"i":o=J.em;break;case"s":case"strike":case"del":o=J.strike;break;case"a":o=J.link;var n=e.getAttribute("href")||"",l=(0,b.decodeURL)(n);(0,b.isVKUrl)(n)&&(l=n.match(/vkpay|health|app-?\d+(_-?\d+)?/)?l.replace("%23","#"):l.replace("#","%23")),a.push(l);break;case"code":o=J.code;break;case"font":var d=e.getAttribute("face");("monospace"===d||"times"===d)&&(o=J.code)}o&&(r.decorations[o.type]=r.decorations[o.type]||[],a[0]<a[1]&&r.decorations[o.type].push(a),r.decorations[o.type]=(0,b.mergeRanges)(r.decorations[o.type]))}))}void 0===r&&(r=!1);var a=document.createElement("div");a.innerHTML=e;var o,s=[],n={};if("ol"==t||"ul"==t){switch(t){case"ol":o=y.ParagraphType.NumericList;break;case"ul":o=y.ParagraphType.BulletList}for(var l=0,d=a.children.length;l<d;l++){var h={text:"",decorations:{},brs:[]};i(a.children[l],h),h.brs=(0,b.cleanBRs)(h.brs),s.push(h)}}else{switch(t){case"h1":o=y.ParagraphType.Header1;break;case"h2":case"header":o=y.ParagraphType.Header2;break;case"h3":case"h4":o=y.ParagraphType.Header3;break;case"blockquote":o=y.ParagraphType.Quote;break;case"cite":o=y.ParagraphType.Quote2;break;case"pre":o=y.ParagraphType.Code;break;default:o=y.ParagraphType.Text}var c=a.firstElementChild;if((0,b.isObjectParagraphEl)(c)){var p=(0,T.domData)(c,"type"),_=(0,T.domData)(c,"media-id");p&&_&&(a=(0,T.geByTag1)("figure",c),o=p,n.mediaId=_)}i(a,h={text:"",decorations:{},brs:[]}),h.brs=(0,b.cleanBRs)(h.brs,h.text.length),s.push(h),o==y.ParagraphType.Code&&delete h.decorations.code,r||o!=y.ParagraphType.Text||"```"!=h.text||0!=h.brs.length||(h.text="",o=y.ParagraphType.Code),(0,b.isHeaderParagraph)(o)||(0===h.text.indexOf("1. ")?(o=y.ParagraphType.NumericList,this._removeParagraphLineTextPart(h,0,"1. ".length)):0===h.text.indexOf("* ")&&(o=y.ParagraphType.BulletList,this._removeParagraphLineTextPart(h,0,"* ".length))),h.brs=h.brs.filter((function(t){return t>0}))}return n.lines=s,n.type=o,(0,b.buildParagraph)(n)},t.prototype._removeParagraphLineTextPart=function(t,e,r){t.text=t.text.substring(0,e)+t.text.substring(r);for(var i=r-e,a=0,o=t.brs.length;a<o;a++){var s=t.brs[a];s>e&&s<r?t.brs[a]=void 0:t.brs[a]>e&&t.brs[a]>=r&&(t.brs[a]-=i)}t.brs=t.brs.filter((function(t){return void 0!==t})),(0,k.each)(t.decorations,(function(a,o){o.forEach((function(t){t[0]<=e&&t[1]<=e||(t[0]<=e&&t[1]<=r?t[1]=e:t[0]>=e&&t[1]<=r?t[0]=t[1]=void 0:t[0]>=e&&t[1]>r?(t[0]=e,t[1]-=i):(t[0]-=i,t[1]-=i))})),t.decorations[a]=t.decorations[a].filter((function(t){return void 0!==t[0]}))}))},t.prototype._renderObjectParagraph=function(t,e){var r=this._getOrCreateParagraphObject(t),i=r.el();r.onRender&&r.onRender();var a=0;return(0,k.isString)(e)&&(e=[e]),t.type==y.ParagraphType.ObjectPhoto?(a=r.getImageIndex(),r.setCaptionElHtml(e[a]||"")):r.setCaptionElHtml(e[0]||""),(0,T.domData)(i,"paragraph-lines",JSON.stringify(t.lines)),(0,T.domData)(i,"uuid",t._uuid),(0,T.domData)(i,"type",t.type),(0,T.domData)(i,"media-id",t._object.getMediaId()),(0,T.domData)(i,"mode",parseInt(t.mode)||0),(0,T.addClass)(i,b.ArticleEditorParagraphClass),i},t.prototype._renderParagraphLines=function(t,e){if(!t.lines)return["",""];var r="",i="",a="",o=parseInt(t.type);switch(o){case y.ParagraphType.NumericList:r="ol",i="li";break;case y.ParagraphType.BulletList:r="ul",i="li";break;case y.ParagraphType.Header1:i="h1";break;case y.ParagraphType.Header2:i="h2";break;case y.ParagraphType.Header3:i="h3";break;case y.ParagraphType.Quote:i="blockquote";break;case y.ParagraphType.Quote2:i="cite";break;case y.ParagraphType.Code:i="pre";break;default:r="p"}var s=[];return t.lines.forEach((function(r){if(r){var n=r.text,l=r.decorations,d=[];(0,k.each)(q,(function(t,e){if(!(0,b.isHeaderParagraph)(o)&&o!=y.ParagraphType.Code||"code"!=e.type){var r=l[e.type];if(r)for(var i=function(t,i){var a=r[t];(d[a[0]]=d[a[0]]||{open:{},close:{}}).open[e.type]=_(a);var o=d[a[1]]=d[a[1]]||{open:{},close:{}},s=function(t,e){for(var r=[];t>0;){var i=d[--t];if(i)for(var a in i.open)if(i.open.hasOwnProperty(a)){if(a==e)return[];r.push(a)}}return r}(a[1],e.type);s.forEach((function(t){o.close[t.type]=!0})),o.close[e.type]=!0,s.forEach((function(t){o.open[t.type]=_(a)}))},a=0,s=r.length;a<s;a++)i(a)}}));var h=0,c=[];d.forEach((function(e,i){if(e){var a=!1,o=e.close.link&&1==Object.keys(e.close).length;i>0&&(a=(0,b.prepareLineText)(n,h,i,r.brs,t.type==y.ParagraphType.Code),o||c.push(a));var s=0;o&&(a&&a.endsWith("<br/>")&&(s++,a=a.replace(/<br\/>$/,"")),a&&a.endsWith("<br/>")&&(s++,a=a.replace(/<br\/>$/,"")),!1!==a&&c.push(a)),(0,k.each)(Q,(function(t,r){void 0!==e.close[r.type]&&c.push("</"+r.tag+">")})),c.push("<br/>".repeat(s)),(0,k.each)(q,(function(t,r){var i=e.open[r.type];void 0!==e.open[r.type]&&(!0===i?c.push("<"+r.tag+">"):c.push("<"+r.tag+' href="'+(0,O.clean)(i)+'">'))})),h=i}})),c.push((0,b.prepareLineText)(n,h,void 0,r.brs,t.type==y.ParagraphType.Code));var p="";i&&(p+="<"+i+(a=a?" "+a:"")+">"),(0,O.inArray)(o,[y.ParagraphType.Quote,y.ParagraphType.Quote2])&&(p+="<p>"),p+=c.join("")||(e?"":"<br/>"),(0,O.inArray)(o,[y.ParagraphType.Quote,y.ParagraphType.Quote2])&&(p+="</p>"),i&&(p+="</"+i+">"),s.push(p)}function _(t){return t[2]||!0}})),[r,s]},t.prototype._renderParagraph=function(t){var e,r=(0,b.isObjectParagraph)(t),a=(0,i.__read)(this._renderParagraphLines(t,r),2),o=a[0],s=a[1];if(r)e=this._renderObjectParagraph(t,s);else{var n=s.join("");e=o?(0,T.se)("<"+o+">"+n+"</"+o+">"):(0,T.se)(n)}return(0,b.hasSeparator)(t)?(0,T.domData)(e,"sep",(0,b.genSepatorId)()):(0,T.domData)(e,"sep",null),(0,T.addClass)(e,b.ArticleEditorParagraphClass),(0,T.addClass)(e,"article_paragraph"),e},t.prototype._getParagraphElByIndex=function(t){return!1===t?null:this._els.canvas.childNodes[t]||null},t.prototype.getObjectParagraphIndex=function(t){for(var e=0;e<this._ps.length;e++)if(this._ps[e]._uuid===t._uuid)return e;return-1},t.prototype._getParagraph=function(t){return t<this._ps.length?this._ps[t]:null},t.prototype._decorateParagraphEls=function(){for(var t=0,e=this._ps.length;t<e;t++){var r=t>0&&this._ps[t-1],i=this._ps[t],a=t+1<e&&this._ps[t+1],o=!1,s=!1,n=!1;r&&i.type==r.type||(o=!0),a&&i.type==a.type||(s=!0),(y.ResizableObjectTypes.includes(+a.type)||a.sep)&&(n=!0);var l=this._getParagraphElByIndex(t);(0,T.toggleClass)(l,"article_decoration_first",o),(0,T.toggleClass)(l,"article_decoration_last",s),(0,T.toggleClass)(l,"article_decoration_before",n)}},t.prototype.redraw=function(t){void 0===t&&(t=!0),this._redraw(t,!0)},t.prototype._redraw=function(t,e){var r=this,i=this._getCursor();t?(this._els.canvas.innerHTML="",this._ps.forEach((function(t){r._els.canvas.appendChild(r._renderParagraph(t))}))):this._dirty.forEach((function(t){if(!(t>=r._ps.length)){var e=r._getParagraphElByIndex(t);if(e){var i=r._renderParagraph(r._ps[t]);e?i.outerHTML!=e.outerHTML&&(0,T.domReplaceEl)(e,i):r._els.canvas.appendChild(i)}}})),e&&this._restoreCursor(i),this._decorateParagraphEls(),this._dirty=[]},t.prototype._getContainingParagraphEl=function(t){for(;t&&t.parentNode!=this._els.canvas;)t=t.parentNode;var e=(0,b.getElementIndex)(t);return[t,e,this._getParagraph(e)]},t.prototype._getCurrentParagraphIndex=function(){var t=window.getSelection();if(null==t?void 0:t.rangeCount){var e=t.getRangeAt(0);if(e.startContainer==this._els.canvas)return[e.startOffset,e.endOffset];var r=(0,i.__read)(this._getContainingParagraphEl(e.startContainer),2)[1],a=e.endContainer;if(0===e.endOffset&&(this._isParagraphEl(a)||this._isParagraphEl((0,T.domPN)(a))&&0==(0,b.childNodeIndex)(a))){var o=(0,i.__read)(this._getContainingParagraphEl(a),1)[0];a=(0,T.domPS)(o)||o}var s=(0,i.__read)(this._getContainingParagraphEl(a),2)[1];return[r,Math.max(r,s)]}return[0,!1]},t.prototype._saveCursorMarker=function(){if(!this._markerCursorSet){var t=(0,i.__read)((0,b.getRange)(),2),e=t[0],r=t[1];if(!e)return[0,0];var a=e.startContainer,o=e.startOffset,s=e.endContainer,n=e.endOffset;if(a!=this._els.canvas){var l=this._getContainingParagraphEl(a)[1];d(a,o,b.CURSOR_MARKER_START),r||(this._getContainingParagraphEl(s)[1]==l&&s.textContent.includes(b.CURSOR_MARKER_START)&&(n+=1),d(s,n,b.CURSOR_MARKER_END)),this._markerCursorSet=!0}}function d(t,e,r){if(t.nodeType==Node.TEXT_NODE){var i=t.textContent;t.textContent=i.substring(0,e)+r+i.substring(e)}else{var a=document.createTextNode(r);t.insertBefore(a,t.childNodes[e])}}},t.prototype._restoreCursorFromMarker=function(){var t=this;if(this._markerCursorSet){var e,r,i,a=function(t,e,r){return function e(i){if(i.nodeType==Node.TEXT_NODE){var a=i.textContent.indexOf(t);if(a>=0){i.textContent=i.textContent.split(t).join("");var o=i.parentElement;return-1!=o.innerHTML.search(/\s$/)&&(o.innerHTML=o.innerHTML.trimRight()+b.NBSP,r&&r[0]==i&&(r[0]=o.lastChild),i=o.lastChild),o.innerHTML||((i=o).innerHTML="<br/>",a=0),[i,a]}}else for(var s=0,n=i.childNodes.length;s<n;s++){var l;if(l=e(i.childNodes[s]))return l}}(e)};for(i=0;i<this._els.canvas.children.length&&!(e=a(b.CURSOR_MARKER_START,this._els.canvas.children[i]));i++);for(;i<this._els.canvas.children.length&&!(r=a(b.CURSOR_MARKER_END,this._els.canvas.children[i],e));i++);if(e){var o=document.createRange();e[0].nodeType==Node.TEXT_NODE&&(e[1]=Math.min(e[1],e[0].textContent.length)),o.setStart(e[0],e[1]),r&&(r[0].nodeType==Node.TEXT_NODE&&(r[1]=Math.min(r[1],r[0].textContent.length)),o.setEnd(r[0],r[1])),window.getSelection().setBaseAndExtent(o.startContainer,o.startOffset,o.endContainer,o.endOffset)}var s=function(e){t._ps.forEach((function(t){t.lines.forEach((function(t){var r=t.text.indexOf(e);if(r>=0){t.text=t.text.replace(e,"");for(var i=0,a=0;a<t.brs.length;a++)t.brs[a]>r&&(i=1),t.brs[a]-=i;(0,k.each)(q,(function(e,i){var a=t.decorations[i.type];if(a)for(var o=0,s=a.length;o<s;o++){var n=a[o];n[0]>r&&(n[0]-=1),n[1]>r&&(n[1]-=1)}}))}}))}))};s(b.CURSOR_MARKER_START),s(b.CURSOR_MARKER_END),this._markerCursorSet=!1}},t.prototype._setAllParagraphsDirty=function(){this._dirty=[];for(var t=this._els.canvas.children.length,e=0;e<t;e++)this._dirty.push(e);this._ps=[]},t.prototype._setCurrentParagraphDirty=function(){var t=(0,i.__read)(this._getCurrentParagraphIndex(),2),e=t[0],r=t[1];this._setParagraphDirty(e,r)},t.prototype.setParagraphDirty=function(t,e){this._setParagraphDirty(t,e)},t.prototype._setParagraphDirty=function(t,e){if(void 0===t||t<0)throw new Error("Invalid paragraph index");e=e||t;for(var r=t;r<=e;r++)(0,O.inArray)(r,this._dirty)||this._dirty.push(r)},t.prototype._expandDoubleBRs=function(){function t(t,e,r){var i=t.lines[0];void 0===r&&(r=i.text.length);var a=[];return i.brs.forEach((function(t){t<r&&t>e&&a.push(t-e)})),(0,b.buildParagraph)({type:t.type,lines:[{text:i.text.substr(e,r-e),decorations:(0,b.decorationsSlice)(i.decorations,e,r),brs:a}]})}for(var e=!1,r=0,i=this._ps.length;r<i;r++){var a=this._ps[r];if(a.lines.length>1)a.lines.forEach(b.cleanLineBRs);else{var o=a.lines[0];if(!o||!o.brs.length)continue;for(var s=o.brs,n=[],l=0,d=0,h=s.length;d<h;d++)if(l!=s[d]&&d>0&&s[d-1]==s[d]){var c=t(a,l,s[d]);(0,b.isParagraphEmpty)(c)||n.push(c),l=s[d]}n.push(t(a,l)),n.length>1&&(Array.prototype.splice.apply(this._ps,[r,1].concat(n)),r=r+n.length-1,e=!0)}}return e},t.prototype._processAlienPhotos=function(){var t=this;if(!this._photoPasteUploadingProcess)for(var e,r=Array.prototype.slice.call(this._els.canvas.children);e=r.shift();)if(!(0,b.isObjectParagraphEl)(e)||!this._isTrackedObjectEl(e))for(var i=Array.prototype.slice.call((0,T.geByTag)("img",e)),a=void 0,o=function(){if(!a.src||!(0,T.domPN)(e)||!(0,T.isVisible)(a))return"continue";var r=(0,T.traverseParent)(a,(function(e){return e==t._els.canvas||"FIGURE"==e.tagName}),10),i=!(!r||r==s._els.canvas)&&(0,T.geByTag1)("figcaption",r),o=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPhoto}),n=s._renderObjectParagraph(o,i?i.innerHTML:"");(0,b.justCursorInString)(e.textContent)?((0,T.domReplaceEl)(e,n),(0,T.re)(a),(0,T.domInsertAfter)((0,T.se)("<p>"+b.CURSOR_MARKER_START+"</p>"),n)):((0,T.domInsertAfter)(n,(0,T.domPN)(a)),(0,T.re)(i),(0,T.re)(a)),(0,T.traverseParent)(n,(function(e){if(e==t._els.canvas)return!0;(0,T.removeClass)(e,b.ArticleEditorParagraphClass)}));var l=function(){(0,T.re)(n),t._forgetObject(o._uuid),t._setAllParagraphsDirty(),t._triggerInputEvent()};(0,b.queuePhotoProcess)(a.src,(function(e,r,i){e||!r?(l(),i()):t._getOrCreateParagraphObject(o).setBLOB(r,i,l)}))},s=this;a=i.shift();)o()},t.prototype._flattenAlienParagraphs=function(){if(this._fromPasteEvent){for(var t,e=Array.prototype.slice.call(this._els.canvas.children),r=this._fromPasteEvent,a=this._pasteCurrentIndex,o=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],s=-1,n=function(){if(s++,r&&!(0,O.trim)(t.textContent)&&s>a&&s<=o)return(0,T.re)(t),"continue";var e=t;(0,b.isQuoteEl)(t)&&!(0,b.isAlienParagraphEl)(t)&&(e=t.firstChild);var i=!1;(function r(a){if(a&&a.nodeType!=Node.TEXT_NODE&&!(0,b.isBR)(a))if((0,b.hasBlockElements)(a))if(this._isTrackedObjectEl(a))a!=e&&((0,T.domInsertBefore)(a,t),i=!0);else for(var o,s=Array.prototype.slice.call(a.childNodes);o=s.shift();)r.call(this,o);else a!=e&&((0,O.trim)(a.innerHTML)&&(0,T.domInsertBefore)(a,t),i=!0)}).call(l,e,!0),i&&(0,T.re)(t)},l=this;t=e.shift();)n();this._setAllParagraphsDirty()}},t.prototype._correctCaptionSelection=function(){var t=(0,i.__read)((0,b.getRange)(),3),e=t[0],r=t[1],a=t[2];if(e&&!r){var o=(0,T.traverseParent)(e.startContainer,(function(t){return"FIGCAPTION"==t.tagName}),5);if(o&&e.endContainer!=e.startContainer&&e.endContainer.nodeType==Node.ELEMENT_NODE&&(0,b.isParagraphEl)(e.endContainer)&&0==e.endOffset&&0==e.startOffset){var s=(0,T.geByClass1)("article_ed__figcaption_edit",o),n=e.cloneRange();n.selectNodeContents(s),a.removeAllRanges(),a.addRange(n)}}},t.prototype.cancelSaveDraft=function(){clearTimeout(this._draftSaveTO)},t.prototype.saveDraft=function(t,e,r){var i=this;if(!this.isLocked()){clearTimeout(this._draftSaveTO);var a=JSON.stringify({paragraphs:(0,w.getCleanedState)(this._ps,!1)});e?this._lastSavedDraft=a:this._lastSavedDraft!=a||t?(this._options.onDraftNotSaved&&this._options.onDraftNotSaved(),this._draftSaveTO=setTimeout((function(){if(i._lastSavedDraft=a,0!=i._ps.length){var t=(0,C.checkLimits)(i._ps);t?i._options.onDraftNotSaved&&i._options.onDraftNotSaved(t):i.save(!1,(function(t,e,r){i._initDraftSave=!0,i._options.onDraftSaved&&i._options.onDraftSaved(t,e,r)}))}}),r?0:1e3*this._options.draftSaveDelay)):!e&&this._initDraftSave&&this._options.onDraftSaved&&this._options.onDraftSaved(!1,this.getArticleId())}},t.prototype._getName=function(){if(this._publishName)return this._publishName;var t=(0,w.getCleanedState)(this._ps,!1),e=t.length?t[0].lines[0].text:"";return(0,b.generateLatinizedName)(e,this._options.maxNameLength)},t.prototype.getTitle=function(){var t=this._ps[0];return t?t.lines[0].text:""},t.prototype.isLimitsExceeded=function(){return!!(0,C.checkLimits)(this._ps)},t.prototype.save=function(t,e,r){var i=this;void 0===r&&(r={});var a=(0,w.getCleanedState)(this._ps,!1,!0);t&&(0,b.correctRealIndexes)(a,-1);var o=this._getName(),s=this.getCoverPhoto();void 0===s&&t&&(s=this.getFirstCoverPhotoFromParagraphs()),this.getOptions().postData&&(r.from_post_convert=1),this.getOptions().isEducationArticle&&(r.education_course_id=this.getOptions().educationCourseId,r.education_step_id=this.getOptions().educationStepId),r.session_duration=this.getTimeSpent(),P.ArticleEditorSaver.save(this.getArticleOwnerId(),this.getArticleId(),a,t,o,s?s.id:"",this._getSaveDraftHash(),this._options.limits.maxSymbolsPerChunk,r,(function(r,a,s,n,l){if((0,k.isString)(r)&&r.startsWith("locked "))return i.getOptions().editLockMessage=r.slice("locked ".length),i.showEditLockInfo(),void(e&&e(!0));r||(a&&(i._options.articleId=a),"al_articles.php"!=window.nav.objLoc[0]||window.nav.objLoc.article_id||window.nav.setLoc((0,O.extend)({},window.nav.objLoc,{article_id:i.getArticleOwnerId()+"_"+i.getArticleId()})),i._publishNameCandidate=o,t&&(i._options.isPublished=!0,i.wasPublishedInCurrentSession=!0),i._replaceVideos(l)),e&&e(r,a,s,n)}))},t.prototype._replaceVideos=function(t){var e=this;void 0===t&&(t=[]);var r=!1;try{t.forEach((function(t){var a=(0,i.__read)(t,4),o=a[0],s=a[1],n=a[2],l=a[3];e._ps.forEach((function(t,a){if(t.type==y.ParagraphType.ObjectVideo){var d=(0,i.__read)(t.mediaId.split("_"),3),h=d[0],c=d[1];d[2]||h!=o||c!=s||(t.mediaId=n+"_"+l,e._setParagraphDirty(a),r=!0)}}))}))}catch(t){}r&&this._redrawModel()},t.prototype.focus=function(){this._restoreLastCursor()},t.prototype.focusLastParagraph=function(){(0,b.focusEl)(this._getParagraphElByIndex(this._ps.length-1))},t.prototype.getArticleId=function(){return this._options.articleId},t.prototype.getArticleOwnerId=function(){return this._options.articleOwnerId},t.prototype._getSaveDraftHash=function(){return this._options.saveDraftHash},t.prototype._expandBlockquoteParagraphs=function(t){for(var e,r=Array.prototype.slice.call(this._els.canvas.children);e=r.shift();)if((0,b.isQuoteEl)(e)){var i=e.tagName,a=Array.prototype.slice.call(e.children),o=a[0];if(1==a.length&&o&&o.tagName&&(0,O.inArray)(o.tagName,["H1","H2","H3"])){(0,T.domReplaceEl)(e,o);continue}if(a.shift(),a.length)for(var s=void 0;s=a.shift();){if(this._saveCursorMarker(),t)(0,T.domInsertAfter)(s,e);else{var n=(0,T.se)("<"+i+"></"+i+">");n.appendChild(s),(0,T.domInsertAfter)(n,e)}this._restoreCursorFromMarker()}}},t.prototype._ensureDummyParagraphs=function(){if(this._els.canvas){var t=this._els.canvas.lastChild;if(t)if((0,O.trim)(t.innerHTML)&&"<br>"!=t.innerHTML&&"&nbsp;"!=t.innerHTML||"H1"==t.tagName){var e=(0,b.buildParagraph)({});this._els.canvas.appendChild(this._renderParagraph(e)),this._ps.push(e),this._updateTextPlaceholders()}}},t.prototype._ensureAtLeastOneParagraph=function(){0==this._ps.length&&(this._ps=[(0,b.buildParagraph)({type:y.ParagraphType.Text})])},t.prototype._ensureTitleParagraph=function(){var t=this;if(!this._options.noTitle){var e=this._ps[0];(0,b.isObjectParagraph)(e)&&(this._ps[0]=(0,b.buildParagraph)({type:y.ParagraphType.Header1})),e.type=y.ParagraphType.Header1,e.lines[0].decorations={},e.lines[0].brs=[],delete e.sep}this._ps.forEach((function(e,r){(t._options.noTitle||0!=r)&&(1==r&&e.type==y.ParagraphType.Header1&&(e.type=y.ParagraphType.Text),e.type==y.ParagraphType.Header1&&(e.type=y.ParagraphType.Header2))}))},t.prototype._insertParagraphAt=function(t,e){this._ps.splice(t,0,e)},t.prototype._deleteParagraphFrom=function(t){this._ps.splice(t,1)},t.prototype._focusParagraph=function(t,e){(0,b.focusEl)(this._getParagraphElByIndex(t),e)},t.prototype._init=function(){this._correctEmptyParagraphAfterFloatObjects(),this._redraw(!0),this._initEvents(),this._initLinksHrefTooltip(),this._initResizeTooltip()},t.prototype._redrawModel=function(){this._saveCursorMarker(),this._redraw(!0),this._restoreCursor()},t.prototype.addObjectMarketProduct=function(){var t=this,e=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0];(0,I.showAttachProductBox)(null,(function(r){(0,b.isParagraphEmpty)(t._ps[e])||t._insertParagraphAt(e,(0,b.buildParagraph)());var i={type:y.ParagraphType.ObjectMarketItem,mediaId:r.id};"link"===r.type&&(i.type=y.ParagraphType.ObjectAliExpressProduct,i.mediaId=r.url);var a=(0,b.buildParagraph)(i);"link"===r.type?E.ArticleEditorPreparedData.addRaw(i.type,i.mediaId,{product:r}):E.ArticleEditorPreparedData.add(i.type,i.mediaId,{product:r}),t._getOrCreateParagraphObject(a),t._ps[e]=a,window.curBox().hide(),t._redrawModel();var o=t._getParagraphElByIndex(e);(0,b.focusEl)(o),t.saveUndoStateAndDraft(),e++}))},t.prototype.addObjectAudio=function(){var t=this,e=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0];this.getArticleOwnerId()<0&&(window.cur.audioAttachOriginalOwnerId=this.getArticleOwnerId(),window.cur.audioAttachSwitchOwnerId=window.vk.id),window.AudioPage.showAttachBox(this.getArticleOwnerId(),{canPlaylistAttach:!0,onAudioChoose:function(r,i,a,o){(0,b.isParagraphEmpty)(t._ps[e])||t._insertParagraphAt(e,(0,b.buildParagraph)());var s=(0,b.buildParagraph)({type:y.ParagraphType.ObjectAudio,mediaId:a.fullId});E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectAudio,a.fullId,{audio:o}),t._getOrCreateParagraphObject(s),t._ps[e]=s,r.shiftKey||window.curBox().hide(),t._redrawModel();var n=t._getParagraphElByIndex(e);(0,b.focusEl)(n),t.saveUndoStateAndDraft(),e++},onPlaylistChoose:function(r,i){var a=i.getOwnerId()+"_"+i.getPlaylistId()+(i.getAccessHash()?"_"+i.getAccessHash():""),o=(0,b.buildParagraph)({type:y.ParagraphType.ObjectAudioPlaylist,mediaId:a});E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectAudioPlaylist,a,{accessHash:i.getAccessHash()}),t._getOrCreateParagraphObject(o),t._ps[e]=o,window.curBox().hide(),t._redrawModel();var s=t._getParagraphElByIndex(e);(0,b.focusEl)(s),t.saveUndoStateAndDraft()}})},t.prototype.closeAllCarouselEditors=function(){this._ps.forEach((function(t){t.type==y.ParagraphType.ObjectPhoto&&t._object.cancelCarouselEditor&&t._object.cancelCarouselEditor()}))},t.prototype.setMediaUploadMode=function(t){this._isUploading=!!t,(0,T.toggleClass)(this._els.editor,"article_ed__uploading",this._isUploading)},t.prototype.isMediaUploadMode=function(){return this._isUploading},t.prototype.addObjectVideo=function(){var t,e=this,r=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],a=this._getParagraph(r),o=(0,b.hasSeparator)(a);delete a.sep,(0,L.showBox)("al_video.php",{act:"a_choose_video_box",from:"article",to_id:this.getArticleOwnerId(),blockPersonal:1}),window.cur.onMediaUploadStarted=function(){var i=(0,b.buildParagraph)({type:y.ParagraphType.ObjectVideo}),a=e._renderObjectParagraph(i,""),o=e._getParagraphElByIndex(r);t=a,(0,T.domInsertBefore)(a,o),(0,b.focusEl)(o),e.setMediaUploadMode(!0)},window.cur.onMediaUploadFail=function(){delete cur.onMediaUploadStarted,t&&(0,T.re)(t),e.setMediaUploadMode(!1)};var s=-1;window.cur.chooseMedia=function(i,a,n,l,d){var h;void 0===l?s++:s=(0,k.intval)(l),d=d||!1,delete cur.onMediaUploadStarted,e.setMediaUploadMode(!1),t&&(0,T.re)(t);var c=(0,b.buildParagraph)({type:y.ParagraphType.ObjectVideo,mediaId:a,sep:o});o=!1,E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectVideo,a,n),e._getOrCreateParagraphObject(c),s?e._insertParagraphAt(r+s,c):e._ps[r]=c,e._redrawModel(),e._focusParagraph(r+s),e.saveUndoStateAndDraft(),!d&&window.curBox()&&(null===(h=window.curBox())||void 0===h||h.hide())},window.cur.hasChosenMedia=function(t,e){var r=!1;return(0,k.each)(window.cur.chosenMedias,(function(){if(this[0]===t&&this[1]===e)return r=!0,!1})),r}},t.prototype.addObjectDoc=function(){var t=this,e=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],r=this._getParagraph(e),a=(0,b.hasSeparator)(r);delete r.sep,window.cur.docsCurFilter="gif";var o=(0,L.showBox)("docs.php",{act:"a_choose_doc_box",from:"article",ext_filter:"gif",to_id:this.getArticleOwnerId()},{stat:["docs.css"]});window.cur.chooseMedia=function(r,i,s){o.hide();var n=(0,b.buildParagraph)({type:y.ParagraphType.ObjectGIF,mediaId:i,sep:a});a=!1,E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectGIF,i,{video:s.video_preview,size:s.video_preview_size,href:s.href}),t._getOrCreateParagraphObject(n),t._insertParagraphAt(e,n),t._redrawModel(),t._saveUndoState(),t.saveDraft(),t._focusParagraph(e),t._updateTextPlaceholders()},window.cur.showMediaProgress=function(){}},t.prototype.addObjectPhoto=function(){var t,e,r=this,a=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],o=this._getParagraph(a)||(0,b.buildParagraph)(),s=(0,L.showBox)("al_photos.php",{to_id:this.getArticleOwnerId(),act:"choose_photo",max_files:200,article:1},{cache:1,stat:[window.jsc("web/photos.js"),"photos.css",window.jsc("web/upload.js")],dark:1});window.cur.onMediaUploadStarted=function(){var e=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPhoto}),i=r._renderObjectParagraph(e,""),o=r._getParagraphElByIndex(a);(0,T.domInsertBefore)(i,o),(0,b.focusEl)(o),t=i,r.setMediaUploadMode(!0)},window.cur.onMediaUploadFail=function(){delete window.cur.onMediaUploadStarted,t&&(0,T.re)(t),r.setMediaUploadMode(!1)};var n=-1;window.cur.chooseMedia=function(i,l,d,h){void 0===h?n++:n=(0,k.intval)(h),delete window.cur.onMediaUploadStarted,r.setMediaUploadMode(!1),t&&(0,T.re)(t);var c=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPhoto,mediaId:l,sep:o.sep});return E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectPhoto,l,{size:(0,b.getPhotoSize)(d.editable.sizes),sizes:d.editable.sizes}),r._getOrCreateParagraphObject(c),n?r._ps.splice(a+n,0,c):r._ps[a]=c,void 0===h&&s.hide(),clearTimeout(e),e=setTimeout((function(){r._redrawModel(),r._focusParagraph(a+n),r._updateTextPlaceholders(),r.saveUndoStateAndDraft()}),10),!1},window.cur.showMediaProgress=function(){}},t.prototype.addSeparator=function(){var t=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],e=(0,b.hasSeparator)(this._getParagraph(t)),r=(0,b.hasSeparator)(this._getParagraph(t+1));!e&&!r&&t<this._ps.length-1&&this._ps.splice(t,1),this._getParagraph(t).sep=1;var a=this._getCursor();this._redraw(!0),this._restoreCursor(a),this._updateTextPlaceholders()},t.prototype.addObjectPoll=function(){var t=this,e=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],r=this._getParagraph(e),a=(0,b.hasSeparator)(r);(0,L.showBox)("al_voting.php",{act:"box",owner_id:this.getArticleOwnerId(),ref:"article"},{containerClass:"article_poll_creation"}),window.cur.chooseMedia=function(r,i){if(r&&i){var o=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPoll,mediaId:r,sep:a});E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectPoll,r,{editable:!0,snippet:i}),a=!1,t._getOrCreateParagraphObject(o),t._insertParagraphAt(e,o),t._redrawModel(),t._saveUndoState(),t.saveDraft(),t._updateTextPlaceholders()}}},t.prototype.editObjectPoll=function(t){var e=this,r=(0,i.__read)(t.getMediaId().split("_"),2),a=r[0],o=r[1],s=(0,i.__read)(this._getContainingParagraphEl(t.el()),3),n=s[1],l=s[2],d=(0,b.hasSeparator)(l);(0,L.showBox)("al_voting.php",{act:"box",voting_id:o,owner_id:a,ref:"article"},{containerClass:"article_poll_creation"}),window.cur.chooseMedia=function(r,i){var a=t.getCaptionEl().innerHTML;e._deleteParagraphFrom(n),e._forgetObject(l._uuid);var o=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPoll,mediaId:r,sep:d});E.ArticleEditorPreparedData.add(y.ParagraphType.ObjectPoll,r,{editable:!0,snippet:i}),d=!1;var s=e._getOrCreateParagraphObject(o);e._insertParagraphAt(n,o),e._redrawModel(),e._saveUndoState(),e.saveDraft(),e._updateTextPlaceholders(),s.setCaptionElHtml(a)}},t.prototype.onObjectStateLoaded=function(){this.saveDraft(),this._showObjectPicker()},t.prototype._hideObjectPicker=function(){this._objectPickerTooltip&&this._objectPickerTooltip.hide()},t.prototype._showObjectPicker=function(){if(!this.isLocked()&&window.cur.articleEditor){if(!this._objectPickerEl){this._objectPickerEl=(0,T.se)('<div class="article_editor_object_picker"><div class="article_editor_object_picker_icon"></div></div>'),this._els.editor.appendChild(this._objectPickerEl);var t="";window.cur.articleEditor.getOptions().marketAttachProductEnabled&&(t='<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_product" onclick="cur.articleEditor.addObjectMarketProduct()"></button>');var e=window.SAKIntegration&&window.SAKIntegration.isIntegrated,r=(0,T.se)('<div class="article_editor_object_picker_btns_wrap clear_fix">\n        <button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_photo" onclick="cur.articleEditor.addObjectPhoto()">\n        '+(e?"":'</button><button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_video" onclick="cur.articleEditor.addObjectVideo()">')+"\n        "+(e?"":'</button><button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_audio" onclick="cur.articleEditor.addObjectAudio()"></button>')+'\n        <button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_poll" onclick="cur.articleEditor.addObjectPoll()"></button>\n        '+(e?"":t)+"\n        "+(e?"":'<button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_doc" onclick="cur.articleEditor.addObjectDoc()">')+'\n        </button><button class="article_editor_object_picker_btn" id="article_editor_object_picker_btn_sep" onclick="cur.articleEditor.addSeparator()">\n        </button>\n      </div>');this._objectPickerTooltip=new A.default(this._objectPickerEl,{content:r,forceSide:"right",cls:"article_editor_object_picker_tt",autoShow:!1,elClassWhenShown:"article_editor_object_picker_tt_shown",offset:[2,0]}),this._objectPickerEl.addEventListener("mousedown",(function(t){return(0,j.cancelEvent)(t)}))}var a=(0,i.__read)(this._getCurrentParagraphIndex(),2),o=a[0],s=a[1];if(!this.isMediaUploadMode()&&!1!==o&&o==s&&(0,b.isParagraphEmpty)(this._ps[o],!0)&&this._ps[o]&&(0,O.inArray)(this._ps[o].type,[y.ParagraphType.Text,y.ParagraphType.Header2,y.ParagraphType.Header3])){(0,T.show)(this._objectPickerEl);var n=this._getParagraphElByIndex(o),l=(0,T.getXY)(this._els.editor),d=(0,T.getXY)(n)[1]-l[1],h=!1;this._uploadFloatList(),this._floatedObjects.forEach((function(t){t.startY<=d+15&&t.endY+30>=d&&(h=!0)})),(0,T.setStyle)(this._objectPickerEl,{left:h?355:-40,top:d})}else(0,T.hide)(this._objectPickerEl)}},t.prototype._initLinksHrefTooltip=function(){var t=this;this._els.canvas.addEventListener("mouseover",(function(e){if("a"==e.target.tagName.toLowerCase()){if(t._linkTooltip&&t._linkTooltip.destroy(),t._formatTooltip&&t._formatTooltip.isShown())return;var r=e.target,i=r.getAttribute("href").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),a=(0,b.decodeURL)(i);(0,b.isVKUrl)(i)||(i="/away.php?to="+encodeURIComponent(i)+"&utf=1"),t._linkTooltip=new A.default(r,{cls:"article_editor_link_show_tt",appendTo:t._els.editor,content:(0,T.se)('<a target="_blank" rel="noopener" href="'+i+'" class="article_editor_link">'+a+"</a>")})}}))},t.prototype._isTrackedObjectEl=function(t){var e=(0,T.domData)(t,"uuid");return!!e&&!!this._getObject(e)},t.prototype._cloneObjectParagraphs=function(){for(var t,e=Array.prototype.slice.call(this._els.canvas.children),r={};t=e.shift();)if((0,b.isObjectParagraphEl)(t)){var i=t.getAttribute("data-uuid"),a=parseInt(t.getAttribute("data-type"));if(r[i]){var o=this._getObject(i);i=tt(),this._getOrCreateParagraphObject({type:a,_uuid:i,mediaId:o.getMediaId()}),(0,T.domData)(t,"uuid",i)}r[i]=!0}},t.prototype._correctCursorToBeWithinCanvas=function(){var t=(0,i.__read)((0,b.getRange)(),2),e=t[0];t[1]&&e.startContainer==this._els.canvas&&this._focusParagraph(0)},t.prototype._triggerInputEvent=function(){this._els.canvas.dispatchEvent(new Event("input"))},t.prototype.getCursor=function(){return this._getCursor()},t.prototype._getCursor=function(){var t=this._els.canvas,e=(0,i.__read)((0,b.getRange)(),2),r=e[0],a=e[1];if(!r)return!1;var o={start:{path:[],textOffset:void 0,nodeOffset:void 0},end:{path:[],textOffset:void 0,nodeOffset:void 0}};function s(e,r,i){r.nodeType==Node.TEXT_NODE?e.textOffset=i:e.nodeOffset=i,(0,T.traverseParent)(r,(function(r){if(r==t)return!0;(0,b.isQuoteEl)(r)&&r.firstChild&&r.firstChild.nodeType==Node.ELEMENT_NODE&&"p"==r.firstChild.tagName.toLowerCase()&&e.path.pop(),e.path.push((0,b.childNodeIndex)(r))}),10),e.path=e.path.slice().reverse()}return s(o.start,r.startContainer,r.startOffset),a?delete o.end:s(o.end,r.endContainer,r.endOffset),o.isEmpty=function(){return!o.end&&0==o.start.nodeOffset&&0==o.start.path.length&&0==o.start.path[0]},o},t.prototype.restoreCursor=function(t){this._restoreCursor(t)},t.prototype._restoreCursor=function(t){if(!t)return this._restoreCursorFromMarker();var e=this._els.canvas;function r(t){var r=e,i=0;return t.path.forEach((function(e,i){if((0,b.isQuoteEl)(r)){var a=r.firstChild;a&&1==i&&a.nodeType==Node.ELEMENT_NODE&&"p"==a.tagName.toLowerCase()&&(r=a)}e=Math.min(r.childNodes.length-1,e);var o=r.childNodes[e];if(!o)return t.nodeOffset=0,!1;r=o})),i=r.nodeType==Node.TEXT_NODE&&void 0!==t.textOffset?Math.min(r.textContent.length,t.textOffset):0,void 0!==t.nodeOffset&&r&&r.children&&(i=Math.min(t.nodeOffset,r.childNodes.length)),[r,i]}var a=document.createRange();try{var o=(0,i.__read)(r(t.start),2),s=o[0],n=o[1];if((0,b.isBR)(s)&&0==n){var l=(0,T.domPN)(s);(0,b.isParagraphEl)(l)&&1==l.childNodes.length&&(s=l)}if(a.setStart(s,n),t.end){var d=(0,i.__read)(r(t.end),2),h=d[0],c=d[1];a.setEnd(h,c)}window.getSelection().setBaseAndExtent(a.startContainer,a.startOffset,a.endContainer,a.endOffset)}catch(t){(0,D.debugLog)(t)}},t.prototype._saveLastCursor=function(){var t=this._getCursor(),e="article_cursor_"+this.getArticleOwnerId()+"_"+(this.getArticleId()||0);t&&!t.isEmpty()?M.default.set(e,JSON.stringify(t)):M.default.remove(e),this._lastCursor=t},t.prototype._restoreLastCursor=function(){var t=M.default.get("article_cursor_"+this.getArticleOwnerId()+"_"+(this.getArticleId()||0));t?(t=JSON.parse(t),this._restoreCursor(t)):(0,b.focusEl)(this._els.canvas.firstChild)},t.prototype._toggleCodeBlocks=function(){for(var t,e=(0,i.__read)(this._getCurrentParagraphIndex(),2),r=e[0],a=e[1],o=r;o<=a;o++)void 0===t&&(t=this._ps[o].type!=y.ParagraphType.Code),this._ps[o].type=t?y.ParagraphType.Code:y.ParagraphType.Text;var s=this._getCursor();this._redraw(!0),this._restoreCursor(s),this._updateTextPlaceholders()},t.prototype._removeExtraSeparators=function(){for(var t,e=this._els.canvas.children,r=0;r<e.length;r++){var i=e[r],a=(0,T.domData)(i,"sep");a&&(void 0!==t&&a==t&&(0,T.domData)(i,"sep",null),t=a)}},t.prototype._replaceAlienInlineTags=function(){var t=!1,e={b:"strong",i:"em"};return function r(i){var a=i.tagName.toLowerCase();if(e[a]){t||(this._saveCursorMarker(),t=!0);var o=(0,T.ce)(e[a],{innerHTML:i.innerHTML});(0,T.domReplaceEl)(i,o)}else for(var s=Array.prototype.slice.call(i.childNodes),n=void 0;n=s.shift();)n.nodeType==Node.ELEMENT_NODE&&r.call(this,n)}.call(this,this._els.canvas),t&&this._restoreCursorFromMarker(),t},t.prototype._cleanParagraphsBRs=function(){this._ps.forEach((function(t){t.lines.forEach(b.cleanLineBRs)}))},t.prototype._initEvents=function(){var t=this;if(!this.isLocked()){this._setEventListener(window,"scroll",(function(){var e=(0,x.scrollGetY)(),r=window.innerHeight;t._ps.forEach((function(i,a){if((0,b.isObjectParagraph)(i)){var o=t._getParagraphElByIndex(a),s=(0,T.getSize)(o),n=(0,T.getXY)(o),l=n[1]<e+r&&n[1]+s[1]>e;i._object.onViewport&&i._object.onViewport(l)}}))}));var e,r=0;this._setEventListener(document,"selectionchange",(function(){var a=(0,i.__read)((0,b.getRange)(),2),o=a[0],n=a[1];if(o&&!(0,T.traverseParent)(o.commonAncestorContainer,(function(e){return e==t._els.canvas})))return void t._showObjectPicker();var l=(0,i.__read)(t._getCurrentParagraphIndex(),1)[0];if(!1!==l){if(!n&&(0,T.hasClass)(o.startContainer,"article")){var d=t._ps[r];if((0,b.isObjectParagraph)(d))return void(0,b.focusEl)(d._object.getCaptionEl())}var h=o.startContainer;if(window.browser.msie&&n&&(0,T.gpeByClass)("article_ed__extra_controls",h)&&"BUTTON"!=h.tagName){var c=t._ps[l];if((0,b.isObjectParagraph)(c))return void c._object.getCaptionEl().focus()}r=l,t._highlightObjectsInCurrentSelection(),t._showObjectPicker(),t._correctCaptionSelection(),t._ensureDummyParagraphs(),0==s&&t._showFormatTooltip(),t._saveLastCursor();var p=t._getParagraph(l);(0,b.isObjectParagraph)(p)&&y.ResizableObjectTypes.includes(parseInt(p.type))?t._resizeTooltip&&(clearTimeout(e),e=setTimeout((function(){t._showResizeTooltip()}),100)):t._resizeTooltip&&t._resizeTooltip.isShown()&&t._resizeTooltip.hide()}else t._showObjectPicker()}));var a=!1,o=!1,s=!1;this._els.canvas.addEventListener("mousedown",(function(){var e;s=!0,t._setEventListener(window,"mouseup",e=function(r){s=!1,"article_format_btn_link"==r.target.id||(t._showFormatTooltip(),e&&window.removeEventListener("mouseup",e))})})),this._els.canvas.addEventListener("selectstart",(function(){t._hideFormatTooltip()})),this._els.canvas.addEventListener("copy",(function(e){var r=(0,i.__read)((0,b.getRange)(),2),a=r[0];if(r[1]){var o=(0,i.__read)(t._getContainingParagraphEl(a.commonAncestorContainer),1)[0];(0,b.isObjectParagraphEl)(o)&&(e.clipboardData.setData("text/plain","uuid:"+o.getAttribute("data-uuid")),e.preventDefault())}})),this._els.canvas.addEventListener("paste",(function(e){var r=(0,i.__read)(t._getCurrentParagraphIndex(),1)[0];r&&(t._handleObjectPaste(e),t._handleLinkPaste(e),t._handlePhotoPaste(e),t._fromPasteEvent=!0,t._pasteCurrentIndex=r)})),this._els.canvas.addEventListener("click",(function(t){if(t.target.nodeType==Node.ELEMENT_NODE&&"A"==t.target.tagName)return(0,j.cancelEvent)(t)}));var n=!1;this._els.canvas.addEventListener("input",(function(){t._hideObjectPicker(),t._expandBlockquoteParagraphs(h),t._removeExtraSeparators();var e,r=t._replaceAlienInlineTags();window.browser.safari||t._els.canvas.normalize(),t._fromPasteEvent||r||t._markerCursorSet?t._saveCursorMarker():e=t._getCursor(),t._processAlienPhotos(),t._flattenAlienParagraphs(),t._cloneObjectParagraphs(),t._ps.length>0&&t._els.canvas.children.length!==t._ps.length&&t._setAllParagraphsDirty(),t._dirty.forEach(t._updateLineData.bind(t)),n&&(t._cleanParagraphsBRs(),n=!1),t._ensureAtLeastOneParagraph(),t._ensureTitleParagraph();var i=!1;if(t._fromPasteEvent)try{i=t._expandDoubleBRs()}catch(t){console.error(t)}t._redraw(i),t._restoreCursor(e),t._correctCursorToBeWithinCanvas(),t._dirty=[],o?t._saveUndoStateDelayed():t._saveUndoState(),a=o=!1,t._fromPasteEvent=!1,t._updateTextPlaceholders(),t.saveDraft(),t._undoable=!0,t._options.onUndoRedo&&t._options.onUndoRedo()}));var l,d=!1,h=!1,c=1;this._els.canvas.addEventListener("keydown",(function(e){var r=e.keyCode,s=e.metaKey||e.ctrlKey,_=e.shiftKey,u=(0,i.__read)((0,b.getRange)(),2),g=u[0],f=u[1];if(g){var v=(0,i.__read)(t._getCurrentParagraphIndex(),2),m=v[0],P=v[1],E=t._getParagraph(m),C=!1;if((0,b.isObjectParagraph)(E))if(E._object.isCaptionFocused())C=0==g.startOffset&&f;else C=(0,i.__read)(t._getContainingParagraphEl(g.startContainer),1)[0]==E._object.el();if(C&&f&&window.browser.mozilla){if(r==G)return t._focusParagraph(m-1,!0),(0,j.cancelEvent)(e);if(r==X)return t._focusParagraph(m+1,!0),(0,j.cancelEvent)(e)}if((r==K||r==Y)&&t._resizeTooltip&&t._resizeTooltip.isShown()&&t._resizeTooltip.hide(),r==V&&f&&0==m)return(0,b.focusEl)(t._getParagraphElByIndex(1)),(0,j.cancelEvent)(e);if(s&&r==z&&(0,b.isObjectParagraph)(E)&&E._object.isCaptionFocused()){var w=E._object.getCaptionEl();return(0,b.selectEl)(w),(0,j.cancelEvent)(e)}if(s)switch(r){case B:return t._setCurrentParagraphDirty(),document.execCommand("Bold",!1,null),(0,j.cancelEvent)(e);case H:return t._setCurrentParagraphDirty(),document.execCommand("Italic",!1,null),(0,j.cancelEvent)(e);case R:return t.saveDraft(!1,!1,!0),(0,j.cancelEvent)(e);case U:return _?t.redo():t.undo(),(0,j.cancelEvent)(e);case F:return t.redo(),(0,j.cancelEvent)(e)}var S=r==N&&e.altKey,x=E?E.type:y.ParagraphType.Text,I=(0,T.gpeByTag)("pre",g.startContainer),L=!!(I||(0,T.gpeByTag)("pre",g.endContainer)||g.startContainer.nodeType==Node.ELEMENT_NODE&&"PRE"==g.startContainer.tagName);if(S){if(x===y.ParagraphType.Header1)return(0,j.cancelEvent)(e);if(f)return t._toggleCodeBlocks(),(0,j.cancelEvent)(e);if(!L&&(0,O.inArray)(x,[y.ParagraphType.Text,y.ParagraphType.NumericList,y.ParagraphType.BulletList])){t._setCurrentParagraphDirty();var D=(0,T.gpeByTag)("code",g.startContainer)||(0,T.gpeByTag)("code",g.endContainer);if(D){t._saveCursorMarker();var A=(0,T.se)("<span></span>");A.innerHTML=D.innerHTML,(0,T.domReplaceEl)(D,A),t._triggerInputEvent()}else document.execCommand("fontName",!1,"monospace"),window.browser.msie&&t._triggerInputEvent();return(0,j.cancelEvent)(e)}}if(r==V&&L&&x==y.ParagraphType.Code)return document.execCommand("insertText",!1,"  "),(0,j.cancelEvent)(e);var M=!1;if(r==Y){if(d)return d[0].textContent=d[1],t._restoreCursor(d[2]),d=!1,(0,j.cancelEvent)(e);if(C){var q=t._getParagraphElByIndex(m),Q=(0,b.createParagraphEl)("",(0,b.hasSeparator)(E));return t._correctEmptyParagraphAfterFloatObjects(),(0,T.domReplaceEl)(q,Q),(0,b.focusEl)(Q),t._setAllParagraphsDirty(),t._triggerInputEvent(),(0,j.cancelEvent)(e)}if(g&&0==g.startOffset&&g.collapsed){var $=(0,T.gpeByTag)("li",g.startContainer),J=(0,b.getElementIndex)($);if($){var Z=t._ps[m],tt=(0,O.clone)(Z),et=(0,O.clone)(Z);tt.lines=tt.lines.slice(0,J);var rt=(0,b.buildParagraph)({lines:[(0,O.clone)(Z.lines[J])]});et.lines=et.lines.slice(J+1),t._ps.splice(m,1,tt,rt,et),t._redraw(!0);var it=t._getParagraphElByIndex(m+1);return(0,b.focusEl)(it),t._saveUndoState(),(0,j.cancelEvent)(e)}}if(g&&f&&0==g.startOffset&&"LI"!==g.startContainer.nodeName){var at=(0,i.__read)(t._getCurrentParagraphIndex(),1)[0],ot=at>0&&t._ps[at-1];if((0,b.isObjectParagraph)(ot)){(0,b.isParagraphEmpty)(t._ps[at])&&(t._ps.splice(at,1),t._redraw(!0));var st=t._getParagraphElByIndex(at-1);return(0,b.focusEl)(st),(0,j.cancelEvent)(e)}}t._setAllParagraphsDirty(),window.browser.msie&&setTimeout((function(){t._triggerInputEvent()}))}if(r==K){var nt=t._ps[m],lt=t._ps[m+1],dt=(0,i.__read)((0,O.getCaretCharacterOffsetWithin)(g.startContainer),1)[0],ht=g.startContainer.textContent.length==dt;if(C)if(!(nt._object.isCaptionFocused()&&!!nt.lines[0].text)){q=t._getParagraphElByIndex(m),Q=(0,b.createParagraphEl)();return(0,T.domReplaceEl)(q,Q),(0,b.focusEl)(Q),t._setAllParagraphsDirty(),t._triggerInputEvent(),(0,j.cancelEvent)(e)}if(f&&(0,b.hasSeparator)(lt)&&ht)return t._setParagraphDirty(m+1),delete lt.sep,t._redraw(!1,!0),(0,j.cancelEvent)(e);if(f&&ht&&(0,b.isObjectParagraph)(lt))return(0,b.isParagraphEmpty)(nt)&&nt.type!=y.ParagraphType.Header1&&(t._ps.splice(m,1),t._redraw(!0,!0)),(0,b.focusEl)(lt._object.getCaptionEl()),(0,j.cancelEvent)(e);lt&&(0,b.isParagraphEmpty)(nt)&&(0,O.inArray)(lt.type,[y.ParagraphType.Header2,y.ParagraphType.Header3])&&(nt.type=lt.type,t._setParagraphDirty(m),t._redraw()),t._setAllParagraphsDirty(),(window.browser.msie&&0==g.startOffset&&0==m||_)&&setTimeout((function(){t._setCurrentParagraphDirty(),t._triggerInputEvent()}))}else if(r==W){if(L&&I&&x==y.ParagraphType.Code&&f){var ct=I.textContent.search(/[^\s]/);return-1==ct&&(ct=I.textContent.length),document.execCommand("insertText",!1,"\n"+" ".repeat(ct)),(0,j.cancelEvent)(e)}if(t._isWithinObjectParagraphEl((0,b.getFocusedElement)())){var pt=(0,i.__read)(t._getContainingParagraphEl((0,b.getFocusedElement)()),2),_t=(q=pt[0],pt[1]),ut=(it=(0,b.createParagraphEl)(),t._ps[_t]._object);return!ut.isCaptioned||ut.isCaptionFocused()?(0,T.domInsertAfter)(it,q):(0,T.domInsertBefore)(it,q),t._setAllParagraphsDirty(),(0,b.focusEl)(it),t._triggerInputEvent(),(0,j.cancelEvent)(e)}var gt=(0,i.__read)(t._getContainingParagraphEl((0,b.getFocusedElement)()),3),ft=gt[0],vt=gt[2],mt=(0,i.__read)((0,O.getCaretCharacterOffsetWithin)(ft),2)[1];if(e.shiftKey||e.ctrlKey&&window.browser.safari){var bt=(0,i.__read)((0,O.getCaretCharacterOffsetWithin)(ft),2)[1],yt=($=(0,T.domClosestByTag)("li",g.startContainer),0);$&&(yt=(0,T.domChildIndex)($));var Pt=!1;if((0,k.each)(vt.lines,(function(t,e){var r=e.brs,i=e.text.length;return 0==bt||bt<=i&&(0,O.inArray)(bt,r)?(Pt=!0,!1):!((bt-=i)<=0&&t==yt)&&void 0})),Pt)return n=!0,t._setParagraphDirty(m,P),document.execCommand("insertParagraph"),(et=(0,T.domNS)(ft))&&((0,b.focusEl)(et),et.focus()),t._triggerInputEvent(),(0,j.cancelEvent)(e);window.browser.msie&&0==bt&&g.insertNode((0,T.se)("<br>"))}var Et=f&&g.startContainer.nodeType==Node.TEXT_NODE&&!g.startContainer.nextSibling&&mt==ft.textContent.length;h=Et&&!(0,b.isListParagraph)(t._ps[m])&&!e.shiftKey&&(0,O.inArray)(vt.type,[y.ParagraphType.Quote,y.ParagraphType.Quote2]),window.browser&&window.browser.msie&&setTimeout(t._triggerInputEvent.bind(t)),t._setParagraphDirty(m,P)}else e.key&&1==e.key.length?(t._setParagraphDirty(m),t._setParagraphDirty(P),e.metaKey||(M=!0,e.key&&((0,b.isCyrillicChar)(e.key)?c+=1:(0,b.isLatinChar)(e.key)&&(c-=1),c=Math.min(Math.max(c,-5),5))),a=(0,b.isWhiteSpaceChar)(e.key),M&&!a&&(o=!0),setTimeout((function(){var e=(0,i.__read)((0,b.getRange)(),2),r=e[0],a=e[1],o=t._getParagraph(m);if(o&&(o.type!=y.ParagraphType.Code&&!!!((0,T.gpeByTag)("code",r.startContainer)||r.startContainer.nodeType==Node.ELEMENT_NODE&&"CODE"==r.startContainer.tagName)&&(l=l||c>0,a&&r))){var s=r.startContainer;if(s.nodeType==Node.TEXT_NODE&&r.startOffset>0)for(var n=s.textContent.substring(r.startOffset-5,r.startOffset),h=0,_=p.Sequences.length;h<_;h++){var u=p.Sequences[h];if(void 0===u.cyrillic||u.cyrillic===l)if(u.pattern instanceof RegExp){var g=n.match(u.pattern);if(g){var f=u.substitution;g.length>1&&(f=f.replace("$1",g[1])),v.call(t,r.startOffset,s,g[0],f,u.noUndo);break}}else if(n.endsWith(u.pattern)){v.call(t,r.startOffset,s,u.pattern,u.substitution,u.noUndo);break}}}function v(t,e,r,i,a){var o=this._getCursor(),s=e.textContent.substring(0,t-r.length),n=e.textContent.substring(t);a||(d=[e,s+r+n,o]),e.textContent=s+i+n,this._restoreCursor(o),this._setParagraphDirty(m),this._triggerInputEvent()}}),0)):!1;d=!1}})),this._setEventListener(window,"resize",(function(){t._resizeTooltip&&t._resizeTooltip.isShown()&&t._updatePositionResizeTooltip()}))}},t.prototype._isParagraphEl=function(t){return t&&(0,T.hasClass)(t,b.ArticleEditorParagraphClass)},t.prototype._isWithinObjectParagraphEl=function(t){var e=(0,i.__read)(this._getContainingParagraphEl(t),1)[0];return e&&(0,b.isObjectParagraphEl)(e)},t.prototype._highlightObjectsInCurrentSelection=function(){var t=(0,i.__read)(this._getCurrentParagraphIndex(),2),e=t[0],r=t[1];!1!==e&&!1!==r&&this._ps.forEach((function(t,i){if(t._object){var a=e!=r;t._object.highlight(i>=e&&i<=r,a)}}))},t.prototype._getOrCreateParagraphObject=function(t){t._uuid||(t._uuid=tt());var e=this._getObject(t._uuid);if(!e){var r=t.mediaId||"";switch(parseInt(t.type)){case y.ParagraphType.ObjectPhoto:e=new o.default(r,this,t);break;case y.ParagraphType.ObjectVideo:e=new s.default(r,this);break;case y.ParagraphType.ObjectGIF:e=new n.default(r,this);break;case y.ParagraphType.ObjectAudio:e=new d.default(r,this);break;case y.ParagraphType.ObjectAudioPlaylist:e=new a.default(r,this);break;case y.ParagraphType.ObjectPodcast:e=new l.default(r,this);break;case y.ParagraphType.ObjectTwitter:e=new _.default(r,this);break;case y.ParagraphType.ObjectInstagram:e=new g.default(r,this);break;case y.ParagraphType.ObjectFacebook:e=new u.default(r,this);break;case y.ParagraphType.ObjectVK:e=new f.default(r,this);break;case y.ParagraphType.ObjectTelegram:e=new v.default(r,this);break;case y.ParagraphType.ObjectPoll:e=new m.default(r,this);break;case y.ParagraphType.ObjectMarketItem:e=new h.default(r,this);break;case y.ParagraphType.ObjectAliExpressProduct:e=new c.default(r,this)}this._setObject(t._uuid,e)}return t._object=e,e},t.prototype._forgetObject=function(t){delete this._objects[t]},t.prototype._getObject=function(t){return this._objects[t]||null},t.prototype._setObject=function(t,e){return this._objects[t]=e},t.prototype._updateLineData=function(t){var e=this._getParagraphElByIndex(t);if(e){if(this._isWithinObjectParagraphEl(e)){var r=(0,i.__read)((0,b.paragraphElProperties)(e),3),a=r[0],o=r[1],s=r[2],n=this._getObject(o);if(!n)return;var l=(0,b.buildParagraph)();if(n.getCaptionEl()){var d=this._getParagraphFromHTML("",n.getCaptionEl().innerHTML,!0);if(a==y.ParagraphType.ObjectPhoto){var h=(0,T.domData)(n.el(),"paragraph-lines");h&&(l.lines=JSON.parse(h));var c=n.getImageIndex();l.lines[c]=d.lines[0];for(var p=0;p<l.lines.length;p++)l.lines[p]=l.lines[p]||{text:"",decorations:{}}}else l.lines[0]=d.lines[0]}l.type=a,l.mode=s,l._uuid=o,l._object=n,this._ps[t]=l}else if(e.nodeType==Node.ELEMENT_NODE){var _=e.tagName.toLowerCase();this._ps[t]=this._getParagraphFromHTML(_,e.innerHTML)}else this._ps[t]=this._getParagraphFromHTML("p",e.textContent);e.nodeType==Node.ELEMENT_NODE&&(0,T.domData)(e,"sep")&&(this._ps[t].sep=!0)}},t.prototype.onDragEnd=function(){this._dragEnterEventsHandler&&(this._els.canvas.removeEventListener("dragenter",this._dragEnterEventsHandler),delete this._dragEnterEventsHandler),this._dragLeaveEventsHandler&&(this._els.canvas.removeEventListener("dragleave",this._dragLeaveEventsHandler),delete this._dragLeaveEventsHandler),this._dragDropEventsHandler&&(this._els.canvas.removeEventListener("drop",this._dragDropEventsHandler),delete this._dragDropEventsHandler),this._dragEndEventsHandler&&(this._els.canvas.removeEventListener("dragend",this._dragEndEventsHandler),delete this._dragEndEventsHandler)},t.prototype.getCurrentParagraphs=function(){var t=(0,i.__read)(this._getCurrentParagraphIndex(),2),e=t[0],r=t[1];return[this._getParagraphElByIndex(e),this._getParagraphElByIndex(r)]},t.prototype._initObjectDrag=function(){var t,e,r,a,o,s,n=this,l=!1,d=null,h=this._els,c=200;function p(t){!1!==t&&t===d||u(),s!=t&&((0,k.each)((0,T.geByClass)("article_ed__drag_hovered"),(function(t,e){(0,T.removeClass)(e,"article_ed__drag_hovered")})),t&&(0,T.addClass)(t,"article_ed__drag_hovered"),s=t)}function _(){window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",e),l=!1,(0,T.removeClass)(h.canvas,"no_select"),clearTimeout(o),clearInterval(a),p(!1),(0,T.re)(r),r=!1}function u(){d&&((0,T.removeClass)(d._objectEl,"article__carousel--noHover"),d.removeCarouselHover(),d=null)}var g=function(t){t&&((0,T.addClass)(t._object._objectEl,"article__carousel--noHover"),(d=n._getOrCreateParagraphObject(t)).renderCarouselHover())};function f(t){t.preventDefault(),t.stopPropagation()}var v=function(t,e){void 0===e&&(e=null);var r=!1;e&&(r=n._getOrCreateParagraphObject(e).isCarouselEditorOpened());var a=(0,i.__read)(n._getContainingParagraphEl(t.target),3),o=a[0],s=a[2],l=s&&+s.type===y.ParagraphType.ObjectPhoto;if(s&&parseInt(s.mode)===y.ObjectResizeType.Float)return!1;if(e===s||r)return!1;if(l){var d=(0,T.getXY)(o),h=(0,T.getSize)(o);if(t.pageY<d[1]+.7*h[1])return!0}return!1},m=function(t,e){var r=t.isCarouselEditorOpened();e&&(r||t.createCarousel(),e.forEach((function(e,r){var i={editable:{sizes:E.ArticleEditorPreparedData.get(y.ParagraphType.ObjectPhoto,e).sizes}};t.addPhotoInCarousel(e,i,r)})))},P=function(t){o&&(clearTimeout(o),(0,j.cancelEvent)(t)),o=setTimeout((function(){var e=(0,i.__read)(n._getContainingParagraphEl(t.target),3),r=e[0],o=e[1],s=e[2];s&&+s.type===y.ParagraphType.ObjectPhoto&&v(t)?(p(!1),g(s)):p(r),l=o,(0,T.addClass)(n._els.canvas,"no_select"),clearInterval(a),t.pageY<c+(0,x.scrollGetY)()?a=setInterval((function(){return n._options.layer.scrollTop-=10}),10):(0,x.scrollGetY)()+window.innerHeight-c<t.pageY&&(a=setInterval((function(){return n._options.layer.scrollTop+=10}),10))}),0)};["dragenter","dragover","dragleave","drop"].forEach((function(t){n._els.canvas.addEventListener(t,f,!1)})),["dragenter","dragover"].forEach((function(t){n._els.canvas.addEventListener(t,P)})),this._els.canvas.addEventListener("dragleave",(function(t){o&&(clearTimeout(o),(0,j.cancelEvent)(t)),o=setTimeout((function(){return _()}),100)})),this._els.canvas.addEventListener("drop",(function(t){var e=t.dataTransfer.files;if(e.length){if(!function(t){return Array.from(t).every((function(t){return!!t.name&&y.ALLOWED_FILE_TYPES_FOR_PASTE.split(";").some((function(e){return e=e.slice(1),t.name.substr(-e.length).toLowerCase()===e}))}))}(e))return(0,L.showFastBox)((0,S.getLang)("global_error"),(0,S.getLang)("pages_article_ed_paste_photo_file_error")),void _();if(!1!==l){u(),n._photoPasteUploadingProcess=!0;var r=(0,i.__read)(n._getContainingParagraphEl(t.target),3)[2],a=Array.from(e),o=r&&+r.type===y.ParagraphType.ObjectPhoto&&v(t),s=function(t,e){return new Promise((function(r){var i=new FileReader;i.onload=function(){n._photoPasteUploadingProcess=!1;var i=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPhoto}),a=n._getOrCreateParagraphObject(e);a.setLoadingState(!0,!0);n._getOrCreateParagraphObject(i).setBLOB(t,(function(){var t=n._getOrCreateParagraphObject(i).getMediaId(0);a.setLoadingState(!1),m(a,[t]),n._forgetObject(i._uuid),r()})),n._resizeTooltip&&n._resizeTooltip.isShown()&&n._resizeTooltip.hide()},i.readAsDataURL(t)}))};o?Promise.all(a.map((function(t){return s(t,r)}))).then((function(){n._focusParagraph(l),n._showObjectPicker(),n.saveUndoStateAndDraft(),_()})).catch((function(){})):function(t,e){return new Promise((function(r){var i=new FileReader;i.onload=function(){n._photoPasteUploadingProcess=!1;var a=e,o=(0,b.buildParagraph)({type:y.ParagraphType.ObjectPhoto});n._getOrCreateParagraphObject(o).setBLOB(t,(function(){r(o)})),(0,b.isParagraphEmpty)(n._ps[e])&&e?((0,b.hasSeparator)(n._ps[e])&&(o.sep=1),n._ps[e]=o):(a=e+1,n._insertParagraphAt(a,o)),e||n._updateTextPlaceholders(),n._redraw(!0,!0),(new Image).src=i.result,n._resizeTooltip&&n._resizeTooltip.isShown()&&n._resizeTooltip.hide()},i.readAsDataURL(t)}))}(e[0],l).then((function(t){for(var e=[],r=1;r<a.length;r++)e.push(s(a[r],t));return Promise.all(e)})).then((function(){n._showObjectPicker(),n._focusParagraph(l+1),n.saveUndoStateAndDraft(),_()})).catch((function(){}))}}})),this._els.canvas.addEventListener("mousedown",(function(o){if(r&&(0,T.re)(r),2==o.button)return _(),(0,j.cancelEvent)(o);var s=(0,T.getSize)(n._els.canvas)[1];(0,T.removeClass)(n._els.canvas,"no_select"),p(!1);var d=(0,i.__read)(n._getContainingParagraphEl(o.target),3),h=d[0],f=d[1],P=d[2];if((0,b.isObjectParagraph)(P)){var E,C,w,O,S,I=o.pageY;window.addEventListener("mousemove",t=function(t){if(r||!(Math.abs(I-t.pageY)<10)){r||(r=(0,T.se)('<div class="article_ed__drag_shadow"></div>'),n._els.editor.appendChild(r),(E=(0,T.getXY)(n._els.canvas))[1]-=(0,x.scrollGetY)(),C=(0,T.getSize)(h),w=(0,T.getXY)(h),O=t.pageX-w[0],S=t.pageY-w[1]+n._options.layer.scrollTop,(0,T.setStyle)(r,{width:C[0],height:C[1]}),n._focusParagraph(f)),(0,T.addClass)(n._els.canvas,"no_select"),E||_(),(0,T.setStyle)(r,{left:t.pageX-E[0]-O,top:t.pageY-(0,x.scrollGetY)()-S-E[1]+n._options.layer.scrollTop}),clearInterval(a),t.pageY-(0,x.scrollGetY)()<c?a=setInterval((function(){n._options.layer.scrollTop-=10}),10):t.pageY-(0,x.scrollGetY)()>window.innerHeight-c&&(a=setInterval((function(){n._options.layer.scrollTop+window.innerHeight>s+300?clearInterval(a):n._options.layer.scrollTop+=10}),10));var e=(0,i.__read)(n._getContainingParagraphEl(t.target),3),o=e[0],d=e[1],m=e[2];if(+P.type===y.ParagraphType.ObjectPhoto){if(v(t,P))return p(!1),g(m),void(l=d);u()}o&&o!=h&&o!=(0,T.domPS)(h)?(p(o),l=d):(p(!1),l=!1)}}),window.addEventListener("mouseup",e=function(t){if(!1!==l&&f){var e=n._getParagraph(l),r=e&&+e.type===y.ParagraphType.ObjectPhoto&&v(t,P);if(n._ps.splice(f,1),(0,b.hasSeparator)(P)&&(n._ps[f].sep=1,delete P.sep),r){var i=n._getOrCreateParagraphObject(P).getMediaIds(),a=n._getOrCreateParagraphObject(e);m(a,i)}else n._ps.splice(l+1,0,P);if(n._redraw(!0,!0),r){var o=n.getObjectParagraphIndex(e);n._focusParagraph(o)}else n._focusParagraph(l+1);n.saveUndoStateAndDraft(),n._resizeTooltip&&n._resizeTooltip.isShown()&&n._resizeTooltip.hide()}_()})}}))},t.prototype.isLocked=function(){return!!this.getOptions().editLockMessage},t.prototype.showEditLockInfo=function(){this.isLocked()?(this.showWarningInfo(this.getOptions().editLockMessage),this._els.canvas.removeAttribute("contenteditable"),(0,T.hide)(this._objectPickerEl),this._hideObjectPicker(),this._hideFormatTooltip()):this.showWarningInfo()},t.prototype.showRevEditInfo=function(){window.nav.objLoc.from_rev&&this.showWarningInfo((0,S.getLang)("pages_article_rev_edit"))},t.prototype.showWarningInfo=function(t){var e=(0,T.geByClass1)("article_ed__warn_info",this._els.editor);e&&!t&&((0,T.removeClass)(this._els.editor,"article_ed__warn_shown"),(0,T.re)(e)),e||t&&(e=(0,T.se)('<div class="article_ed__warn_info">'+t+"</div>"),this._els.editor.appendChild(e),(0,T.addClass)(this._els.editor,"article_ed__warn_shown"))},t.prototype._initResizeTooltip=function(){var t=this,e=(0,T.se)('<div class="resize-tooltip__btns article_format_btns clear_fix"></div>');this._resizeTooltip=new A.default(this._els.editor.parentNode,{content:e,autoShow:!1,customShow:!0,forceSide:"top",cls:"resize-tooltip article_format_tt"}),e.addEventListener("click",(function(e){if(e.target.classList.contains("article_format_btn")){var r=parseInt(e.target.dataset.mode);t.setModeCurrentObject(r)}}))},t.prototype._showResizeTooltip=function(){var t=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],e=this._getParagraphElByIndex(t),r=this._getParagraph(t),a=(0,k.intval)(r.type);if(y.ResizableObjectTypes.includes(a))if(this._resizeTooltip&&!this._resizeTooltip.isShown()&&this._resizeTooltip.show(),(0,T.hasClass)(e,"article_ed__carousel_edit_open"))this._resizeTooltip.hide();else if(r._object.isLoading())this._resizeTooltip.hide();else{var o=[{id:y.ObjectResizeType.Float,type:"inline"},{id:y.ObjectResizeType.Normal,type:"text"},{id:y.ObjectResizeType.Medium,type:"bigger"},{id:y.ObjectResizeType.Large,type:"cover"}],s=(0,T.geByClass1)("resize-tooltip__btns"),n=[1,1,1,1];switch(a){case y.ParagraphType.ObjectPhoto:r._object.isCarousel()?n=[0,1,1,0]:r._object.isSmallPhotoSize()||(n=[1,1,0,0]);break;case y.ParagraphType.ObjectGIF:r._object._isSmallGifSize()||(n=[1,1,0,0]);break;case y.ParagraphType.ObjectTwitter:case y.ParagraphType.ObjectFacebook:case y.ParagraphType.ObjectInstagram:case y.ParagraphType.ObjectVK:case y.ParagraphType.ObjectTelegram:n=[1,1,0,0]}s.innerHTML="",o.forEach((function(t,e){n[e]&&s.appendChild((0,T.se)('\n          <button class="article_format_btn'+(r.mode==t.id||!r.mode&&!t.id?" article_format_btn_active":"")+'" id="article_format_btn_'+t.type+'"  data-mode='+t.id+" ></button>\n        "))})),this._updatePositionResizeTooltip()}},t.prototype._updatePositionResizeTooltip=function(){var t=this._resizeTooltip,e=(0,i.__read)((0,T.getXY)(this._els.editor),2)[1],r=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0],a=this._getParagraphElByIndex(r).getBoundingClientRect(),o=a.top,s=a.left,n=a.width,l=(0,T.getSize)(t._ttel)[0]/2;(0,T.setStyle)(t._ttel,{top:o-e-60+window.scrollY+140,left:s+n/2-l})},t.prototype.setModeObject=function(t,e){void 0===e&&(e=y.ObjectResizeType.Normal);var r=this._getParagraph(t);r&&(0,b.isObjectParagraph)(r)&&(r.mode=e,this._correctEmptyParagraphAfterFloatObjects(),this._redraw(!0,!0),this.saveUndoStateAndDraft())},t.prototype.setModeCurrentObject=function(t){void 0===t&&(t=y.ObjectResizeType.Normal);var e=(0,i.__read)(this._getCurrentParagraphIndex(),1)[0];this.setModeObject(e,t)},t.prototype._uploadFloatList=function(){var t=this,e=(0,T.getXY)(this._els.editor);this._floatedObjects=[],this._ps.forEach((function(r,i){if(r.mode&&parseInt(r.mode)===y.ObjectResizeType.Float){var a=t._getParagraphElByIndex(i),o=a.getBoundingClientRect().height,s=(0,T.getXY)(a);t._floatedObjects.push({startY:s[1]-e[1],endY:s[1]-e[1]+o})}}))},t.prototype._correctEmptyParagraphAfterFloatObjects=function(){for(var t=0;t<this._ps.length;t++){var e=this._ps[t],r=this._ps[t+1];if((0,b.isObjectResize)(e)>=0)if(1===parseInt(e.mode)&&(0,b.isObjectParagraph)(r)){var i=(0,b.buildParagraph)();i._autoInsert=!0,this._insertParagraphAt(t+1,i)}else 1!==parseInt(e.mode)&&r&&r._autoInsert&&this._deleteParagraphFrom(t+1)}},t}()},419006:(t,e,r)=>{"use strict";r.d(e,{default:()=>u});var i=r(570655),a=r(98654),o=r(130712),s=r(703930),n=r(116886),l=r(414914),d=r(442699),h=r(791563),c=r(257367),p=r(513e3);function _(t,e){return t?'<div class="article_ed__caredit_item article_ed__caredit_item_photo" data-media-id="'+e+'">\n      <div class="article_ed__caredit_photo" style="background-image: url('+t+')"></div>\n      <div class="article_ed__caredit_remove"><div class="article_ed__caredit_remove_icon"></div></div>\n    </div>':'<button class="article_ed__caredit_item article_ed__caredit_item_add" nodrag="1">\n      <div class="article_ed__caredit_add"></div>\n      <div class="article_ed__caredit_item_text">'+(0,n.getLang)("pages_article_ed_carousel_add")+"</div>\n    </button>"}const u=function(){function t(t,e,r,s){var d=this,p='<div class="article_ed__caredit">\n                  <div class="article_ed__caredit_inner">\n    ';p+='\n      <div class="article_ed__caredit_header">\n        <div class="article_ed__caredit_container">\n          '+(0,n.getLang)("pages_article_ed_carousel_title")+'\n          <div class="article_ed__caredit_header_controls">\n            <div class="article_ed__caredit_header_counter"></div>\n            <button class="flat_button article_ed__caredit_save">'+(0,n.getLang)("global_save")+'</button>\n            <button class="flat_button article_ed__caredit_cancel">'+(0,n.getLang)("global_cancel")+"</button>\n          </div>\n         </div>\n      </div>\n    ",p+='\n      <div class="article_ed__caredit_items_wrap article_ed__caredit_container">\n        <div class="article_ed__caredit_items">\n    ',e.getMediaId().split(",").forEach((function(t){var e=a.ArticleEditorPreparedData.get(o.ParagraphType.ObjectPhoto,t),r=(0,i.__read)((0,o.getAppropriateImage)(e.sizes,251),1)[0];p+=_(r,t)})),p+=_(),p+="  </div>",p+="</div>",p+='</div>\n             <div class="article_ed__caredit_loading" style="display: none"></div>\n           </div>';var u=(0,l.se)(p);this._els={editor:u,itemsWrap:(0,l.geByClass1)("article_ed__caredit_items_wrap",u),items:(0,l.geByClass1)("article_ed__caredit_items",u),addButton:(0,l.geByClass1)("article_ed__caredit_item_add",u),saveButton:(0,l.geByClass1)("article_ed__caredit_save",u),cancelButton:(0,l.geByClass1)("article_ed__caredit_cancel",u),loading:(0,l.geByClass1)("article_ed__caredit_loading",u),counter:(0,l.geByClass1)("article_ed__caredit_header_counter",u)},this._els.addButton.addEventListener("click",(function(){(0,h.showBox)("al_photos.php",{to_id:e.getEditor().getArticleOwnerId(),act:"choose_photo",max_files:d._limit-d._medias.length,article:1},{cache:1,stat:[window.jsc("web/photos.js"),"photos.css",window.jsc("web/upload.js")]}),window.cur.chooseMedia=d._onPhotoAdd.bind(d),window.cur.showMediaProgress=function(){(0,l.show)(d._els.loading),e.getEditor().setMediaUploadMode(!0)},window.cur.choosePhotoUploadedAll=function(){(0,l.hide)(d._els.loading),e.getEditor().setMediaUploadMode(!1)}})),this._onSave=r,this._els.saveButton.addEventListener("click",this.save.bind(this)),this._els.cancelButton.addEventListener("click",this.cancel.bind(this)),this._els.items.addEventListener("click",(function(t){if((0,l.hasClass)(t.target,"article_ed__caredit_remove")){var e=(0,l.gpeByClass)("article_ed__caredit_item",t.target);(0,l.re)(e),d._collectMediaIds(),d._initSorter(),d._toggleAddButton(),d._updateCounter()}})),t.appendChild(this._els.editor),(0,l.setStyle)(this._els.itemsWrap,{height:(0,l.getSize)(this._els.itemsWrap)[1]}),this._initSorter(),this._scroll=new c.default(this._els.itemsWrap,{global:!0,stopScrollPropagation:!0,stopScrollPropagationAlways:!0,theme:"dark"}),this._limit=s,this._originalMedias=this._collectMediaIds(),this._toggleAddButton(),this._updateCounter()}return t.prototype.cancel=function(){(0,l.re)(this._els.editor),this._onSave(this._originalMedias.join(","))},t.prototype.save=function(){(0,l.re)(this._els.editor),this._onSave(this._medias.join(","))},t.prototype._updateCounter=function(){this._els.counter.innerHTML=(0,n.getLang)("pages_aricle_ed_carousel_counter",this._medias.length)},t.prototype._toggleAddButton=function(){(0,l.toggle)(this._els.addButton,this._medias.length<this._limit),this._scroll.update()},t.prototype._collectMediaIds=function(){var t=this;return this._medias=[],(0,d.each)(this._els.items.children,(function(e,r){var i=(0,l.domData)(r,"media-id");i&&t._medias.push(i)})),this._medias=this._medias.slice(0,this._limit),this._medias},t.prototype.addPhoto=function(t,e,r){void 0===r&&(r=0),this._onPhotoAdd("photo",t,e,r)},t.prototype._onPhotoAdd=function(t,e,r,n){var h;if(!(0,d.inArray)(e,this._medias)&&this._medias.length<this._limit){a.ArticleEditorPreparedData.add(o.ParagraphType.ObjectPhoto,e,{size:(0,s.getPhotoSize)(r.editable.sizes),sizes:r.editable.sizes});var c=(0,i.__read)((0,o.getAppropriateImage)(r.editable.sizes,251),1)[0];(0,l.domInsertBefore)((0,l.se)(_(c,e)),this._els.addButton)}return void 0===n&&(null===(h=window.curBox())||void 0===h||h.hide(),this._initSorter(),this._scroll.update()),this._collectMediaIds(),this._toggleAddButton(),this._updateCounter(),!1},t.prototype._initSorter=function(){var t=this;this._sorter?this._sorter.update():this._sorter=new p.default(this._els.items,"",{onReorder:function(){t._collectMediaIds()}})},t}()},647276:(t,e,r)=>{"use strict";r.d(e,{initLimits:()=>s,checkLimits:()=>n});var i,a=r(703930),o=r(116886);function s(t){i=t}function n(t){var e=[];t.length>i.maxParagraphs&&e.push((0,o.getLang)("pages_article_ed_limit_paragraphs").replace("{count}",t.length).replace("{limit}",i.maxParagraphs));var r=0,s=0;return t.forEach((function(t){var n=0;t.lines.forEach((function(t){t&&(r+=t.text.length,n+=t.text.length)})),(0,a.isObjectParagraph)(t)&&s++,n>i.maxSymbolsPerParagraph&&e.push((0,o.getLang)("pages_article_ed_limit_symbols_per_par").replace("{count}",n).replace("{limit}",i.maxSymbolsPerParagraph))})),r>i.maxSymbols&&e.push((0,o.getLang)("pages_article_ed_limit_symbols").replace("{count}",r).replace("{limit}",i.maxSymbols)),s>i.maxObjects&&e.push((0,o.getLang)("pages_article_ed_limit_objects").replace("{count}",s).replace("{limit}",i.maxObjects)),e.length&&e.push((0,o.getLang)("pages_article_ed_limit")),e.join("<br>")}},98654:(t,e,r)=>{"use strict";r.d(e,{ArticleEditorPreparedData:()=>s});var i=r(703930),a={};function o(t){var e=t.split("_");return e[0]+"_"+e[1]}var s={add:function(t,e,r){a[t]=a[t]||{},(0,i.isEmbedType)(t)?a[t][e]=r:a[t][o(e)]=r},get:function(t,e,r){if(a[t]=a[t]||{},(0,i.isEmbedType)(t))return a[t][e];if(void 0!==r){var s=e.split(",");e=s[r]}return a[t][o(e)]},addRaw:function(t,e,r){a[t]=a[t]||{},a[t][e]=r},getRaw:function(t,e){return a[t]=a[t]||{},a[t][e]}}},371490:(t,e,r)=>{"use strict";r.d(e,{ArticleEditorSaver:()=>s});var i=r(791563),a=r(116886),o=r(917999),s={_saveChunk:function(t,e,r,i,a){window.ajax.post("al_articles.php",{act:"save_text_chunk",article_owner_id:t,hash:i,chunk_index:r,Article_text:JSON.stringify(e)},{onDone:function(t){a(t)},onFail:function(){return a(!0),!0}})},_saveFinally:function(t,e,r,s,n,l,d,h,c,p){window.ajax.post("al_articles.php",Object.assign({act:"save",article_owner_id:t,article_id:e,cover_photo_id:n,name:s,is_published:Number(r),chunks_count:h,Article_text:c?JSON.stringify(c):"",hash:d},l||{}),{onDone:p,onFail:function(t){return(0,o.isString)(t)&&t.startsWith("locked ")&&p(t),t&&((0,i.showFastBox)((0,a.getLang)("global_error"),t),p(!0)),!0}})},save:function(t,e,r,o,s,n,l,d,h,c){var p=this,_=[],u=[],g=0;if(r.forEach((function(t){var e=JSON.stringify(t).length;(g+=e)>=d&&(_.push(u),g=e,u=[]),u.push(t)})),u.length&&_.push(u),_.length>1){var f=new window.CallHub((function(){p._saveFinally(t,e,o,s,n,h,l,_.length,!1,c)}),_.length);_.forEach((function(e,r){p._saveChunk(t,e,r,l,(function(t){t?(0,i.showFastBox)((0,a.getLang)("global_error"),(0,a.getLang)("pages_articles_save_fail")):f.done()}))}))}else this._saveFinally(t,e,o,s,n,h,l,0,r,c)}}},703930:(t,e,r)=>{"use strict";r.d(e,{NBSP:()=>s,CURSOR_MARKER_START:()=>n,CURSOR_MARKER_END:()=>l,ArticleEditorParagraphClass:()=>d,replaceParagraphEntities:()=>h,isQuoteEl:()=>c,paragraphElProperties:()=>p,isParagraphEl:()=>_,selectEl:()=>u,focusEl:()=>g,isBR:()=>f,prepareLineText:()=>v,getElementIndex:()=>m,isObjectParagraphEl:()=>b,isObjectParagraph:()=>y,isObjectResize:()=>P,hasSeparator:()=>E,genSepatorId:()=>w,isEmbedType:()=>T,isHeaderParagraph:()=>O,isListParagraph:()=>S,buildParagraph:()=>x,convertBRsToArray:()=>I,getRange:()=>j,cleanTextSpaces:()=>k,mergeRanges:()=>D,isWhiteSpaceChar:()=>A,isCyrillicChar:()=>z,isLatinChar:()=>B,isAlienParagraphEl:()=>N,getFocusedElement:()=>H,getPhotoSize:()=>R,childNodeIndex:()=>F,generateLatinizedName:()=>Y,queuePhotoProcess:()=>Q,justCursorInString:()=>$,isParagraphEmpty:()=>J,decorationsSlice:()=>Z,cleanLineBRs:()=>tt,cleanBRs:()=>et,createParagraphEl:()=>rt,traverseTree:()=>it,isPublishNameCorrect:()=>at,correctRealIndexes:()=>st,isVKUrl:()=>nt,decodeURL:()=>lt,hasBlockElements:()=>ht,buildProductSnippetElement:()=>ct});var i=r(130712),a=r(414914),o=r(442699),s="&nbsp;",n="​",l="‌",d="_article_paragraph";function h(t){return(0,a.se)("<textarea>"+(t||"")+"</textarea>").value.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(t){return t&&t.nodeType==Node.ELEMENT_NODE&&(0,o.inArray)(t.tagName.toLowerCase(),["cite","blockquote"])}function p(t){return[(0,a.domData)(t,"type"),(0,a.domData)(t,"uuid"),(0,a.domData)(t,"mode")]}function _(t){return t&&(0,a.hasClass)(t,"_article_paragraph")}function u(t){if(t)try{var e=document.createRange();e.selectNodeContents(t);var r=window.getSelection();null==r||r.removeAllRanges(),null==r||r.addRange(e)}catch(t){}}function g(t,e){if(t)try{var r=document.createRange();e?(r.selectNodeContents(t),r.collapse(!1)):(r.setStart(t,0),r.setEnd(t,0));var i=window.getSelection();null==i||i.removeAllRanges(),null==i||i.addRange(r)}catch(t){}}function f(t){return t&&t.nodeType==Node.ELEMENT_NODE&&"BR"==t.tagName}function v(t,e,r,i,a){if(void 0===a&&(a=!1),t=t.substring(e,r),i&&i.length){var o=[],s=0;i.forEach((function(r){if(!((r-=e)<=0||r>t.length)){var i=t.substring(s,r)+"<br/>";i=a?i:L(i),o.push(i),s=r}}));var n=t.substring(s);o.push(a?n:L(n));o[o.length-1];return o.join("")}return a?t:L(t)}function m(t){if(!t)return!1;for(var e=0;null!=(t=t.previousSibling);)e++;return e}function b(t){return t&&t.nodeType==Node.ELEMENT_NODE&&!!(0,a.domData)(t,"uuid")}function y(t){return t&&t.type&&t.type>=100}function P(t){return t&&t.mode}function E(t){return t&&t.sep}var C=0;function w(){return++C}function T(t){return(0,o.inArray)(t,[i.ParagraphType.ObjectFacebook,i.ParagraphType.ObjectInstagram,i.ParagraphType.ObjectTwitter,i.ParagraphType.ObjectTelegram,i.ParagraphType.ObjectVK,i.ParagraphType.ObjectAliExpressProduct])}function O(t){var e;return e=(0,o.isObject)(t)?t.type:t,(0,o.inArray)(e,[i.ParagraphType.Header1,i.ParagraphType.Header2,i.ParagraphType.Header3])}function S(t){return t&&(t.type==i.ParagraphType.NumericList||t.type==i.ParagraphType.BulletList)}function x(t){var e={};return y(t=t||{})&&(e._uuid=t._uuid),e.lines=t.lines||[{text:"",decorations:{},brs:[]}],e.type=t.type?parseInt(t.type):i.ParagraphType.Text,t.mediaId&&(e.mediaId=t.mediaId),t.sep&&(e.sep=t.sep),t.fromExtPage&&(e.fromExtPage=t.fromExtPage),e}function I(t){if(Array.isArray(t))return t;var e=[];return(0,o.each)(t,(function(t,r){e.push((0,o.intval)(r))})),e.sort(),e}function j(){var t=window.getSelection();return(null==t?void 0:t.rangeCount)?[t.getRangeAt(0),t.isCollapsed,t]:[!1]}function L(t){return-1!=t.search(/^\s/)&&(t=" "+t.trimLeft()),-1!=t.search(/\s$/)&&(t=t.trimRight()+s),t}function k(t){return t.replace(/\s\s+/g," ").replace(/\s/g," ")}function D(t){var e=t.slice();e.sort((function(t,e){return t[0]-e[0]}));for(var r=0;r<e.length-1;){var i=e[r],a=e[r+1],o=i[2]===a[2];i[1]>=a[0]&&o?(i[1]=Math.max(i[1],a[1]),e.splice(r+1,1)):r++}return e}function A(t){return/\s/.test(t)}var M=/[\u0400-\u04FF]/;function z(t){return M.test(t)}function B(t){return/[a-zA-Z]/.test(t)}function N(t){return!(0,a.hasClass)(t,d)}function H(){var t=window.getSelection();return null==t?void 0:t.focusNode}function R(t){var e=[];(0,o.each)(t,(function(t,r){e.push(r)}));var r=e.sort((function(t,e){return e[1]-t[1]}))[0];return[r[1],r[2]]}function F(t){var e=t.parentNode;if(null==e?void 0:e.childNodes.length)for(var r=0;r<e.childNodes.length;r++)if(t==e.childNodes[r])return r;return-1}var U={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1105:"e",1078:"zh",1079:"z",1080:"i",1081:"i",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"c",1095:"ch",1096:"sh",1097:"sch",1099:"y",1101:"e",1102:"u",1103:"ya"};function Y(t,e){t=t.toLowerCase();for(var r="",i=!1,a="-qwertyuiopasdfghjklzxcvbnm0123456789".split(""),s=0;s<t.length;s++)if(/\s/.test(t[s]))i||(r+="-",i=!0);else if((0,o.inArray)(t[s],a))r+=t[s],i=!1;else{var n=U[t.charCodeAt(s)];n&&(r+=n,i=!1)}return r=(r=r.substr(0,e)).replace(/-*$/,"").replace(/^-*/,"").replace(/-+/g,"-")}function W(t){var e,r,i;e=t.split(",")[0].includes("base64")?atob(t.split(",")[1]):unescape(t.split(",")[1]),r=t.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(e.length);for(var a=0;a<e.length;a++)i[a]=e.charCodeAt(a);return new Blob([i],{type:r})}function G(t,e,r){var i,a="";if(e=e||{},!t)return r(new Error("Pass in a IMG DOM node or a url as first param"),!1);if("object"==typeof t&&"img"===t.tagName.toLowerCase()&&(a=t.src),"string"==typeof t&&(a=t),!a.startsWith("data:")||e.convert){var o,s={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",svg:"image/svg+xml"};e.type=s[e.type]||((o=a)?s[o.split("?").shift().split(".").pop()]:null),e.src=a,e.callback=r,e.name=null===(i=a.toLowerCase().match(/\w+\.(?:jpg|jpeg|png|gif)/))||void 0===i?void 0:i[0],e.type?function(t,e){var r=document.createElement("canvas"),i=document.createElement("img");i.onload=function(){var t=r.getContext("2d");t&&(r.width=i.width,r.height=i.height,t.drawImage(i,0,0),e(null,r.toDataURL("image/png")))},i.addEventListener("error",(function(){e(new Error("FailedToLoadImage"))})),(null==r?void 0:r.getContext("2d"))?(i.crossOrigin="anonymous",i.src=t):setTimeout(e,0,new Error("CanvasIsNotSupported"))}(a,X.bind(null,e)):r(new Error("Image type is not supported"),!1)}else r(null,W(a))}function X(t,e,r){if(e)t.callback(e);else{var i=W(r);i.name=i.filename=t.name,t.callback(null,i)}}var K=[],V=0;function q(){if(0!=K.length&&2!=V){V++;var t=K.shift(),e=new Image,r=function(e,r){t.blobPreparedCallback(e,r,(function(){V--,q()}))};e.addEventListener("error",(function(){r(!0,!1)})),e.addEventListener("load",(function(){G(e,{},(function(t,e){r(!!t,e)}))})),e.src=t.src}}function Q(t,e){K.push({src:t,blobPreparedCallback:e}),q()}function $(t){return 1==(t=(0,o.trim)(t)).length&&t.startsWith(n)}function J(t,e){if(!t)return!0;if(y(t))return!1;var r=t.lines;return 0==r.length||!(e?(0,o.trim)(r[0].text):r[0].text)}function Z(t,e,r){var i={},a=function(a){if(t.hasOwnProperty(a)){var o=[];t[a].forEach((function(t){e<t[1]&&t[0]<=r&&o.push([Math.max(t[0],e)-e,Math.min(r,t[1])-e,t[2]])})),i[a]=o}};for(var o in t)a(o);return i}function tt(t){t.brs&&(t.brs=t.brs.filter((function(t,e,r){return r.indexOf(t)===e})),t.brs[t.brs.length-1]==t.text.length&&t.brs.pop())}function et(t,e){var r=t.length;return(1==r&&t[r-1]==e||r>1&&t[r-1]==e&&t[r-2]!=e)&&t.pop(),t}function rt(t,e){void 0===t&&(t="");var r=e?'data-sep="'+w()+'"':"";return(0,a.se)('<p class="'+d+'" '+r+">"+t+"</p>")}function it(t,e,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var a=e(t,i);if(void 0!==a)return a;for(var o,s=Array.prototype.slice.call(r?t.children:t.childNodes);o=s.shift();){var n=it(o,e,r,!1);if(void 0!==n)return n}}function at(t){return!!/^[a-z0-9\-]+$/.test(t)&&(!t.includes("--")&&(!t.startsWith("-")&&!t.endsWith("-")&&!(t.length>60)))}function ot(t,e,r){t.decorations&&(0,o.each)(t.decorations,(function(t,i){i.forEach((function(t){t[0]>e&&(t[0]+=r),t[1]>e&&(t[1]+=r)}))})),t.brs&&t.brs.forEach((function(r,i){r>e&&t.brs&&(t.brs[i]-=1)}))}function st(t,e){t.forEach((function(t){t.lines.forEach((function(t){for(var r=0,i=t.text.length;r<i;r++){var a=t.text.charCodeAt(r);a>=55296&&a<=56319&&(ot(t,r,e),r+=1)}}))}))}function nt(t){return/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(t)}function lt(t){var e=t;try{e=decodeURIComponent(t)}catch(r){e=t}return e}var dt="div p footer form h1 h2 h3 h4 h5 h6 header hgroup hr main nav output pre section table tfoot address article aside blockquote canvas dd dl dt fieldset figcaption figure".toUpperCase().split(" ");function ht(t){for(var e=0,r=t.children.length;e<r;e++)if(dt.includes(t.children[e].tagName))return!0;return!1}function ct(t,e){var r;if(t.snippet)r=t.snippet;else{var i=t.product;i.description||(i.description=i.title),r=(0,a.rs)(window.cur.articleEditor.getOptions().marketItemSnippetTemplate,i)}return(0,a.se)('<div class="'+e+'" contenteditable="false">'+r+"</div>")}},898965:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i,a=r(570655),o=r(703930),s=r(116886),n=r(414914),l=window.browser&&(window.browser.mozilla||window.browser.safari);const d=function(){function t(t,e,r){this._mediaId=t,this._editor=e,this._highlighted=!1,this.isCaptioned=r,i=this.getEditor().getOptions().multiMediasSeparator}return Object.defineProperty(t.prototype,"isCaptioned",{get:function(){return this._isCaptioned},set:function(t){this._isCaptioned=t},enumerable:!1,configurable:!0}),t.prototype.getEditor=function(){return this._editor},t.prototype.getMediaIdsCount=function(){return this._mediaId.split(i).length},t.prototype.getMediaId=function(t){return void 0!==t?this._mediaId.split(i)[t]:this._mediaId},t.prototype.getMediaIds=function(){return this._mediaId.split(i)},t.prototype.setMediaId=function(t){this._mediaId=t},t.prototype.highlight=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),t!=this._highlighted){this._highlighted=t;var r=this.el();if(t){var i=(0,n.getSize)(r),a=(0,n.se)('<div class="article_ed__object_highlight _article_ed__object_highlight"></div>');(0,n.setStyle)(a,{width:i[0]+0,height:i[1]+0}),(0,n.addClass)(r,"article_ed__object_highlighted")}else(0,n.re)((0,n.geByClass1)("_article_ed__object_highlight",r)),(0,n.removeClass)(r,"article_ed__object_highlighted");if(this.isCaptioned)if(t)this._toggleCaption(!0),this._toggleCaptionPlaceholder(this.isEmptyCaption()),e||(0,o.focusEl)(this._getCaptionEl(),!0);else{var s=this.isEmptyCaption();this._toggleCaptionPlaceholder(s),this._toggleCaption(!s)}}},t.prototype.render=function(){return!1},t.prototype.appendObjectInnerEl=function(){var t=this.render();(0,n.addClass)(t,"article_object_el"),t.setAttribute("contenteditable","false");var e=(0,n.geByClass1)("article_object_el",this._objectEl);if(e)(0,n.domReplaceEl)(e,t);else{var r=(0,n.geByClass1)("article_ed__img_inner",this._objectEl);r.insertBefore(t,r.firstChild)}},t.prototype.el=function(){var t=this;if(!this._objectEl){var e=this.render();(0,n.addClass)(e,"article_object_el"),e.setAttribute("contenteditable","false");var r=this.getEditor().isLocked()?"false":"true",i=window.browser.mozilla?'contenteditable="'+r+'"':'contenteditable="false"';this._objectEl=(0,n.se)("<figure "+i+"></figure>");var a=this.renderExtraControlsEl(),d=this.renderEditControlEl();if(a){var h=(0,n.se)('<div class="article_ed__img_wrapper"></div>'),c=(0,n.se)('<div class="article_ed__img_inner"></div>');a.setAttribute("contenteditable","false"),(0,n.addClass)(a,"article_ed__extra_controls"),c.appendChild(a),h.appendChild(c),this._objectEl.appendChild(h),this.appendObjectInnerEl()}else this._objectEl.appendChild(e);d&&this._objectEl.appendChild(d),this.isCaptioned&&(this._captionEl=(0,n.se)('<figcaption class="article_ed__figcaption" contenteditable="false">\n          <div class="article_ed__figcaption_edit" contenteditable="'+r+'"></div>\n          <div class="article_ed__caption_placeholder" contenteditable="false">'+(0,s.getLang)("pages_article_figure_placeholder")+"</div>\n        </figcaption>"),this._objectEl.appendChild(this._captionEl)),l&&e.addEventListener("click",(function(){t.highlight(!0),(0,o.focusEl)(e)}))}return this._setLoadingEl(),this._objectEl},t.prototype.renderExtraControlsEl=function(){return!1},t.prototype.renderEditControlEl=function(){return!1},t.prototype.renderLoadErr=function(){return(0,n.se)('\n      <div class="article_editor_embed_error">\n        <p class="article_editor_embed_error_text">'+(0,s.getLang)("pages_article_load_error_msg")+"</p>\n      </div>\n    ")},t.prototype.setLoadingState=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this._isLoading!=t&&(this._isLoading=t,this._setLoadingEl(e),(0,n.toggleClass)(this._objectEl,"article_ed__object_loading",t),t||this.getEditor().onObjectStateLoaded(this))},t.prototype.isLoading=function(){return this._isLoading},t.prototype._setLoadingEl=function(t){if(void 0===t&&(t=!1),this._objectEl){if((0,n.re)((0,n.geByClass1)("article_ed___object_loading_placeholder",this._objectEl)),this._isLoading){var e=(0,n.se)('<div class="article_ed___object_loading_placeholder"></div>');(0,n.toggleClass)(e,"article_ed__object_loading_white",t),(0,n.domInsertBefore)(e,this._objectEl.firstChild)}(0,n.toggleClass)(this._objectEl,"article_ed___object_loading",!!this._isLoading)}},t.prototype.getCaptionEl=function(){return!!this.isCaptioned&&this._getCaptionEl()},t.prototype.isCaptionFocused=function(){return!!this.isCaptioned&&this._isFocusInCaption()},t.prototype.setCaptionElHtml=function(t){if(this.isCaptioned){t=t.trim();var e=this._getCaptionEl();e&&(e.innerHTML!=t&&(e.innerHTML=t),this._toggleCaptionPlaceholder(!t),this._toggleCaption(!!t))}},t.prototype.isEmptyCaption=function(){var t;return!(null===(t=this._getCaptionEl().textContent)||void 0===t?void 0:t.trim())},t.prototype._getCaptionEl=function(){return(0,n.geByClass1)("article_ed__figcaption_edit",this._captionEl)},t.prototype._toggleCaption=function(t){(0,n.toggleClass)(this._captionEl,"article_ed__figcaption_visible",t)},t.prototype._toggleCaptionPlaceholder=function(t){void 0!==this._captionPlaceholderShown&&this._captionPlaceholderShown===t||(this._captionPlaceholderShown=(0,n.toggle)((0,n.geByClass1)("article_ed__caption_placeholder",this._captionEl),t))},t.prototype._isFocusInCaption=function(){var t=this,e=(0,a.__read)((0,o.getRange)(),2),r=e[0],i=e[1];if(!r)return!1;var s=function(e){var r=t._captionEl;return!!(0,n.traverseParent)(e,(function(t){return t==r}),10)};if(i)return s(r.startContainer);var l=s(r.startContainer),d=s(r.endContainer);return l&&d},t.prototype.loadErrorHandler=function(t){this.setLoadingState(!1),(0,n.addClass)(this._objectEl,"article_paragraph_err"),t.appendChild(this.renderLoadErr())},t}()},744630:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(570655),a=r(898965),o=r(98654),s=r(130712),n=r(80909),l=r(414914);const d=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectAudio,this.getMediaId()).audio,e=n.AudioUtils.drawAudio(t);return this._el=(0,l.se)('<div class="article_object_audio">'+e+"</div>"),this._el},e}(a.default)},616149:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(570655),a=r(898965),o=r(98654),s=r(130712),n=r(116886),l=r(414914);const d=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;this._el=(0,l.se)('\n      <div class="article_object_audio"></div>\n    ');var e=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectAudioPlaylist,this.getMediaId());if(e.snippet)this._el.innerHTML=e.snippet;else{var r=(0,i.__read)(this.getMediaId().split("_"),2),a=r[0],d=r[1];this.setLoadingState(!0),window.ajax.post("al_articles.php",{act:"get_audioplaylist_snippet",pl_owner_id:a,pl_id:d,pl_access_hash:e.accessHash},{onDone:function(e){t.setLoadingState(!1),t._el.appendChild((0,l.se)(e))}})}return this._el.appendChild((0,l.se)('<div class="article_ed__audioplaylist_play_note" contenteditable="false">'+(0,n.getLang)("pages_articles_editor_audio_play_note")+"</div>")),this._el},e}(a.default)},263862:(t,e,r)=>{"use strict";r.d(e,{default:()=>n});var i=r(570655),a=r(898965),o=r(663197),s=r(414914);const n=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this,e=(0,i.__read)(this.getMediaId().split(";"),2),r=e[0],a=e[1];this._el=(0,s.se)('<div class="article_object_embed fb-post" data-href="https://www.facebook.com/'+r+"/posts/"+a+'/" data-width="552px"></div>'),this.setLoadingState(!0);var n=window.vk&&0==window.vk.lang?"ru_RU":"en_US";return(0,o.loadScript)("https://connect.facebook.net/"+n+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){setTimeout((function(){var e;null===(e=window.FB)||void 0===e||e.XFBML.parse(t._objectEl,t.setLoadingState(!1))}),0)},onError:function(){t.loadErrorHandler(t._el)}}),this._el},e}(a.default)},199996:(t,e,r)=>{"use strict";r.d(e,{default:()=>h});var i=r(570655),a=r(791563),o=r(898965),s=r(98654),n=r(130712),l=r(116886),d=r(414914);const h=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;this._el=(0,d.se)('<div class="article_ed__gif_content"></div>');var e=s.ArticleEditorPreparedData.get(n.ParagraphType.ObjectGIF,this.getMediaId());if(e)if(e.video){if(this._videoEl=(0,d.ce)("video",{autoplay:!0,loop:"loop",muted:!0,src:e.video+"&mp4=1"}),e.size){var r=e.size[0]<e.size[1],i=!this._isSmallGifSize();(r||i)&&(0,d.setStyle)(this._videoEl,{width:e.size[0]})}this._el.appendChild(this._videoEl),this._el.appendChild((0,d.se)('<span class="article_ed__select_dummy">&nbsp;</span>'))}else if(e.href){var o=e.href+"&wnd=1&module="+window.cur.module;this._imgEl=(0,d.ce)("img",{}),this._imgEl.addEventListener("error",(function(){(0,a.showFastBox)((0,l.getLang)("pages_article_error_box_title"),(0,l.getLang)("pages_article_error_box_text")),t._editor.removeObject(t)})),this._imgEl.src=o,this._el.appendChild(this._imgEl)}return this._el},e.prototype.onViewport=function(t){this._imgEl?(0,d.setStyle)(this._imgEl,"visibility",t?"visible":"hidden"):t?this._videoEl&&this._videoEl.play().catch((function(){})):this._videoEl&&this._videoEl.pause()},e.prototype.onRender=function(){var t=this;setTimeout((function(){if(t._videoEl&&(t._videoEl.play().catch((function(){})),window.browser.msie)){var e=t._videoEl.src;t._videoEl.src="",t._videoEl.src=e}}))},e.prototype._isSmallGifSize=function(){var t=s.ArticleEditorPreparedData.get(n.ParagraphType.ObjectGIF,this.getMediaId());return!(!t||!t.size)&&t.size[0]>this.getEditor().getOptions().minGifWidthExpand},e}(o.default)},700072:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(570655),a=r(898965),o=r(130712),s=r(917685),n=r(663197),l=r(414914);const d=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;return this._el=(0,l.se)('\n      <div class="article_object_embed article_object_embed_instagram">\n        <blockquote\n            class="article_embed_spacer instagram-media"\n            data-instgrm-permalink="https://instagram.com/p/'+this.getMediaId()+'"\n            data-instgrm-version="12"\n        ></blockquote>\n      <div>\n    '),this.setLoadingState(!0),(0,n.loadScript)("https://www.instagram.com/embed.js",{onLoad:function(){setTimeout((function(){var e;null===(e=window.instgrm)||void 0===e||e.Embeds.process(),(0,s.addEvent)(window,"message",o.changeHeightInstagramEmbed),t.setLoadingState(!1)}),0)},onError:function(){t.loadErrorHandler(t._el)}}),this._el},e}(a.default)},558996:(t,e,r)=>{"use strict";r.d(e,{default:()=>l});var i=r(570655),a=r(898965),o=r(98654),s=r(130712),n=r(703930);const l=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=o.ArticleEditorPreparedData.getRaw(s.ParagraphType.ObjectAliExpressProduct,this.getMediaId());return this._el=(0,n.buildProductSnippetElement)(t,"article_add__object_market_aliexpress_product"),this._el},e}(a.default)},410500:(t,e,r)=>{"use strict";r.d(e,{default:()=>l});var i=r(570655),a=r(898965),o=r(98654),s=r(130712),n=r(703930);const l=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectMarketItem,this.getMediaId());return this._el=(0,n.buildProductSnippetElement)(t,"article_add__object_market_product"),this._el},e}(a.default)},454090:(t,e,r)=>{"use strict";r.d(e,{default:()=>u});var i,a=r(570655),o=r(898965),s=r(130712),n=r(98654),l=r(419006),d=r(703930),h=r(116886),c=r(917685),p=r(414914),_=r(442699);const u=function(t){function e(e,r,i){var a=t.call(this,e,r,!0)||this;return a._currentImageIndex=0,a.paragraph=i,a}return(0,a.__extends)(e,t),e.prototype.cancelCarouselEditor=function(){var t;null===(t=this._carouselEditor)||void 0===t||t.cancel()},e.prototype.renderExtraControlsEl=function(){var t=this,e=(0,p.se)('\n        <div>\n          <div class="article_ed__carousel_nav_btn">\n            <div class="article_ed__carousel_nav_btn_left"></div>\n            <div class="article_ed__carousel_nav_btn_right"></div>\n          </div>\n          <div class="article_ed__carousel_btns">\n            <button class="article_ed__carousel_btn article_ed__carousel_btn_edit">'+(0,h.getLang)("pages_article_ed_create_carousel")+'</button>\n            <div class="article_ed__carousel_btn article_ed__carousel_counter"></div>\n          </div>\n        </div>\n    ');this._carouselControlsEl=e;var r=(0,p.geByClass1)("article_ed__carousel_btn_edit",e),i=(0,p.geByClass1)("article_ed__carousel_nav_btn_left",e),a=(0,p.geByClass1)("article_ed__carousel_nav_btn_right",e);return this._editButtonEl=r,this._controls=e,this.updateEditButtonCaption(),r.addEventListener("click",(function(e){return t.createCarousel(),(0,c.cancelEvent)(e)})),i.addEventListener("click",this.prevPhotoInCarousel.bind(this)),a.addEventListener("click",this.nextPhotoInCarousel.bind(this)),this._setImageIndex(0),e},e.prototype.renderCarouselHover=function(){this._carouselControlsEl&&!this._hoverEl&&(this._hoverEl=(0,p.ce)("div",{className:"article_ed__carouselHover",innerHTML:this.isCarousel()||this.isCarouselEditorOpened()?(0,h.getLang)("pages_article_ed_add_photo_carousel_hint"):(0,h.getLang)("pages_article_ed_create_carousel_hint")}),(0,p.domInsertAfter)(this._hoverEl,this._carouselControlsEl))},e.prototype.removeCarouselHover=function(){(0,p.re)(this._hoverEl),this._hoverEl=null},e.prototype.updateEditButtonCaption=function(){var t=this.getMediaIdsCount()>1;this._editButtonEl.innerHTML=t?(0,h.getLang)("pages_article_ed_edit_carousel"):(0,h.getLang)("pages_article_ed_create_carousel")},e.prototype.createCarousel=function(){var t=this,e=this.getEditor();e.closeAllCarouselEditors(),e._resizeTooltip&&e._resizeTooltip.hide(),(0,p.addClass)(this._objectEl,"article_ed__carousel_edit_open"),this._carouselEditor=new l.default(this._controls,this,(function(e){e?(delete t._fixedImageSize,t.setMediaId(e),t.appendObjectInnerEl(),t.getEditor().saveUndoStateAndDraft(),t.updateEditButtonCaption(),t._setImageIndex(0),(0,p.removeClass)(t._objectEl,"article_ed__carousel_edit_open"),delete t._carouselEditor):t.getEditor().removeObject(t)}),this.getEditor().getLimits().maxCarouselItems)},e.prototype.addPhotoInCarousel=function(t,e,r){void 0===r&&(r=0),this._carouselEditor&&this._carouselEditor.addPhoto(t,e,r)},e.prototype.nextPhotoInCarousel=function(){this.isCarousel()&&this._changePhotoInCarousel(!1)},e.prototype.prevPhotoInCarousel=function(){this.isCarousel()&&this._changePhotoInCarousel(!0)},e.prototype._changePhotoInCarousel=function(t){var e=this.getEditor();this._setImageIndex(this.getImageIndex()+(t?-1:1));var r=e.getObjectParagraphIndex(this.paragraph);if(r>=0?(e.setParagraphDirty(r),e.redraw(!1)):e.redraw(!0),this.isCaptionFocused()){var i=this.getCaptionEl();i&&(0,d.focusEl)(i,!0)}},e.prototype.getImageIndex=function(){return Math.min(this.getMediaIdsCount()-1,this._currentImageIndex)},e.prototype._setImageIndex=function(t){this._currentImageIndex=Math.min(Math.max(0,t),this.getMediaIdsCount());var e=(0,p.geByClass1)("article_ed__carousel_nav_btn",this._carouselControlsEl);(0,p.toggleClass)(e,"no_left",0==this._currentImageIndex),(0,p.toggleClass)(e,"no_right",this._currentImageIndex==this.getMediaIdsCount()-1),(0,p.toggleClass)(this._objectEl,"article__carousel",this.isCarousel());var r=(0,p.geByClass1)("article_ed__carousel_counter",this._carouselControlsEl);this.isCarousel()?((0,p.setStyle)(r,"display","inline-block"),r.innerHTML=(0,h.getLang)("pages_article_ed_carousel_counter").replace("{counter}",this._currentImageIndex+1).replace("{total}",this.getMediaIdsCount())):(0,p.hide)(r),this._drawImage(),this.highlight()},e.prototype.render=function(){this._el=(0,p.se)('\n      <div class="article_ed__img_content">\n        <img contenteditable="false" class="article_ed__img"/>\n      </div>\n    ');var t=n.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPhoto,this.getMediaId(),0);return t&&t.sizes?(this.setLoadingState(!1),this._drawImage()):this.setLoadingState(!0),this._el},e.prototype._initUpload=function(t,e){var r=this;if(void 0===this._upload){var i=this.getEditor().getPhotoUploadOptions();this._upload=window.Upload.init(this.getEditor().getPhotoUploadEl(),i.url,i.params,{file_name:"photo",file_size_limit:15728640,file_types_description:"Image files (*.jpg, *.jpeg, *.png, *.gif)",file_types:s.ALLOWED_FILE_TYPES_FOR_PASTE,file_input:null,accept:"image/jpeg,image/png,image/gif",wiki_editor:0,noCheck:!0,onUploadComplete:function(e,i){i=JSON.parse(i),(0,_.isEmpty)(i)?t():window.ajax.post("al_photos.php",(0,_.extend)({act:"choose_uploaded"},i),{onDone:function(e,i){r._mediaId=e,n.ArticleEditorPreparedData.add(s.ParagraphType.ObjectPhoto,e,{size:(0,d.getPhotoSize)(i.editable.sizes),sizes:i.editable.sizes}),r._drawImage(),t(),r.getEditor().saveUndoStateAndDraft()}})},onNoFilteredCallback:function(){null==e||e()},noFlash:1,max_files:20,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash})}},e.prototype._getImageEl=function(){return(0,p.geByTag1)("img",this._el)},e.prototype.setBLOB=function(t,e,r){var i=this,a=new FileReader;a.onload=function(){i._initUpload(e,r),window.Upload.onFileApiSend(i._upload,[t])},a.readAsDataURL(t)},e.prototype._drawImage=function(){var t=this;if(this._el){var e=n.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPhoto,this.getMediaId(),this.getImageIndex()),r=720;switch(Number(this.paragraph.mode)){case 1:r=350;break;case 2:r=920;break;case 3:r=window.innerWidth}if(e){var o=(0,a.__read)((0,s.getAppropriateImage)(e.sizes,r),1)[0],l=this._getImageEl(),d=!1;l.onload=function(){clearTimeout(i),d=!0,(0,p.setStyle)(l,"visibility","visible"),(0,p.show)(l),t.setLoadingState(!1),t.isCarousel()&&t._fixSize()},l.src=o,clearTimeout(i),d||(i=setTimeout((function(){d||((0,p.setStyle)(l,"visibility","hidden"),t.setLoadingState(!0,t.isCarousel()))}),10))}}},e.prototype.isCarousel=function(){return this.getMediaIdsCount()>1},e.prototype.isCarouselEditorOpened=function(){return!!this._carouselEditor},e.prototype._fixSize=function(){this._fixedImageSize=(0,p.getSize)(this._el),this._fixedImageSize[0]=Math.ceil(this._fixedImageSize[0]),this._fixedImageSize[1]=Math.ceil(this._fixedImageSize[1]),(0,p.setStyle)(this._el,{height:this._fixedImageSize[1]+"px"}),(0,p.setStyle)(this._getImageEl(),{"max-width":this._fixedImageSize[0],"max-height":this._fixedImageSize[1]})},e.prototype.isSmallPhotoSize=function(){var t=n.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPhoto,this.getMediaId(),0);return!(!t&&!t.size)&&t.size[0]>=720},e}(o.default)},975515:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(570655),a=r(898965),o=r(98654),s=r(130712),n=r(116886),l=r(414914);const d=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;this._el=(0,l.se)('\n      <div class="article_object_audio"></div>\n    ');var e=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPodcast,this.getMediaId());if(e.snippet)this._el.innerHTML=e.snippet;else{var r=(0,i.__read)(this.getMediaId().split("_"),2),a=r[0],d=r[1];this.setLoadingState(!0),window.ajax.post("al_articles.php",{act:"get_podcast_snippet",owner_id:a,podcast_id:d},{onDone:function(e){t.setLoadingState(!1),t._el.appendChild((0,l.se)(e))}})}return this._el.appendChild((0,l.se)('<div class="article_ed__audioplaylist_play_note" contenteditable="false">'+(0,n.getLang)("pages_articles_editor_audio_play_note")+"</div>")),this._el},e}(a.default)},859828:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(570655),a=r(898965),o=r(98654),s=r(130712),n=r(116886),l=r(414914);const d=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;this._el=(0,l.se)('\n      <div class="article_object_poll"></div>\n    ');var e=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPoll,this.getMediaId());if(e&&e.snippet)return this._el.appendChild((0,l.se)(e.snippet)),this._el;var r=(0,i.__read)(this.getMediaId().split("_"),2)[1];return this.setLoadingState(!0),window.ajax.post("al_articles.php",{act:"get_poll_snippet",voting_id:r},{onDone:function(e){t.setLoadingState(!1),t._el.appendChild((0,l.se)(e))}}),this._el},e.prototype.renderEditControlEl=function(){var t=o.ArticleEditorPreparedData.get(s.ParagraphType.ObjectPoll,this.getMediaId());if(!t||!t.editable)return!1;var e=(0,l.se)('\n      <div class="article_ed__obj_edit_control">\n        <div class="article_ed__poll_object_btn">\n          <button class="article_ed__poll_object_edit">'+(0,n.getLang)("global_edit")+"</button>\n        </div>\n      </div>\n    ");return(0,l.geByClass1)("article_ed__poll_object_edit",e).addEventListener("click",this._editor.editObjectPoll.bind(this._editor,this)),e},e}(a.default)},235184:(t,e,r)=>{"use strict";r.d(e,{default:()=>n});var i=r(570655),a=r(898965),o=r(663197),s=r(414914);const n=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this,e=(0,i.__read)(this.getMediaId().split(";"),2),r=e[0],a=e[1];return this._el=(0,s.se)('<div class="article_object_embed"><blockquote class="telegram-post" data-telegram-post="'+r+"/"+a+'" data-width="100%" data-userpic="true"></div>'),this.setLoadingState(!0),(0,o.loadScript)("https://telegram.org/js/telegram-widget.js?5",{onLoad:function(){t.setLoadingState(!1)},onError:function(){t.loadErrorHandler(t._el)}}),this._el},e}(a.default)},158723:(t,e,r)=>{"use strict";r.d(e,{default:()=>n});var i=r(570655),a=r(898965),o=r(663197),s=r(414914);const n=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;return this._el=(0,s.se)('<div class="article_object_embed"></div>'),this.setLoadingState(!0),(0,o.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:function(){var e;t.setLoadingState(!1),null===(e=window.twttr)||void 0===e||e.widgets.createTweet(t.getMediaId(),t._el,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0}).then((function(){}))},onError:function(){t.loadErrorHandler(t._el)}}),this._el},e}(a.default)},383030:(t,e,r)=>{"use strict";r.d(e,{default:()=>d});var i=r(570655),a=r(898965),o=r(130712),s=r(98654),n=r(116886),l=r(414914);const d=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){this._el=(0,l.se)('<div class="article_object_video"></div>');var t=s.ArticleEditorPreparedData.get(o.ParagraphType.ObjectVideo,this.getMediaId());if(!t)return this.setLoadingState(!0),this._el;if(this.setLoadingState(!1),t.preview)this._el.appendChild((0,l.se)('<div class="article_ed__video_play_note" contenteditable="false">'+(0,n.getLang)("pages_articles_editor_video_play_note")+"</div>")),this._el.appendChild((0,l.se)(t.preview));else if(t.editable||t.thumb){var e=void 0;if(t.thumb)e=t.thumb;else e=(0,o.getAppropriateImage)(t.editable.sizes,this.getEditor().getWidth(!0))[0];this._el.appendChild((0,l.se)('<div class="article_object_video_play"></div>')),this._el.appendChild((0,l.se)((0,l.rs)(this.getEditor().getOptions().videoLabelTemplate,{duration:t.duration||0,platform:t.platform||""}))),this._el.appendChild((0,l.se)('<div class="article_ed__video_play_note" contenteditable="false">'+(0,n.getLang)("pages_articles_editor_video_play_note")+"</div>")),this._el.appendChild((0,l.se)('<img class="article_ed__video_img" src='+e+' contenteditable="false" />'))}return this._el},e}(a.default)},998539:(t,e,r)=>{"use strict";r.d(e,{default:()=>n});var i=r(570655),a=r(898965),o=r(663197),s=r(414914);const n=function(t){function e(e,r){return t.call(this,e,r,!0)||this}return(0,i.__extends)(e,t),e.prototype.render=function(){var t=this;return this._el=(0,s.se)('<div class="article_object_embed"></div>'),setTimeout((function(){var e=(0,i.__read)(t.getMediaId().split(";"),2),r=e[0],a=e[1],n=(0,s.domData)(t._objectEl,"uuid"),l="vk_post_"+t.getMediaId()+"_"+n;t._el.setAttribute("id",l),t.setLoadingState(!0),(0,o.loadScript)("/js/api/openapi.js",{onLoad:function(){window.ajax.post("dev.php",{act:"a_get_post_hash",post:r+"_"+a},{onDone:function(e){var i;e&&(t.setLoadingState(!1),null===(i=window.VK)||void 0===i||i.Widgets.Post(""+l,r,a,e))},onFail:function(){return t.loadErrorHandler(t._el),!0}})}})}),0),this._el},e}(a.default)},641925:(t,e,r)=>{"use strict";r.d(e,{Sequences:()=>i});var i=[{pattern:/\s-\s$/,substitution:" — "},{pattern:/^-\s$/,substitution:"— "},{pattern:/--\s$/,substitution:"— "},{pattern:/\s"$/,substitution:" “",noUndo:!0,cyrillic:!1},{pattern:/(\S)"$/,substitution:"$1”",noUndo:!0,cyrillic:!1},{pattern:/^"$/,substitution:"“",noUndo:!0,cyrillic:!1},{pattern:/\s"$/,substitution:" «",noUndo:!0,cyrillic:!0},{pattern:/(\S)"$/,substitution:"$1»",noUndo:!0,cyrillic:!0},{pattern:/^"$/,substitution:"«",noUndo:!0,cyrillic:!0},{pattern:"+/-",substitution:"±"},{pattern:"+-",substitution:"±"},{pattern:"^2",substitution:"²"},{pattern:"^3",substitution:"³"},{pattern:"<<",substitution:"«"},{pattern:">>",substitution:"»"},{pattern:"(c)",substitution:"©"},{pattern:"(C)",substitution:"©"},{pattern:"(r)",substitution:"®"},{pattern:"(R)",substitution:"®"},{pattern:"1/2",substitution:"½"},{pattern:"1/4",substitution:"¼"},{pattern:"3/4",substitution:"¾"},{pattern:"...",substitution:"…"},{pattern:"->",substitution:"→"},{pattern:"<-",substitution:"←"},{pattern:"!=",substitution:"≠"},{pattern:"<=",substitution:"≤"},{pattern:">=",substitution:"≥"}]}}]);try{stManager.done("dist/6deb4edfcbfb465064078145a4a266bf.4de25df3317b0d5337da.js")}catch(t){}