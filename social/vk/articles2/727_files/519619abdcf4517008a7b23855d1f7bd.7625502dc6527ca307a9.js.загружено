(self.webpackChunkvk=self.webpackChunkvk||[]).push([[6058],{337057:(e,t,n)=>{"use strict";n.d(t,{VkIndexer:()=>a});var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),r=a.length;r--;){var o=a[r],s="";if(o){for(var i=0;i<6;i++){var l=o.charCodeAt(i);if(l){var c=this.toTranslit[l],u=o.substr(i,1);s+=null!=c?c:u}}n[s]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var r={},o=n[a],s="",i="",l="",c=o.length>1;if(o){for(var u=0;u<6;u++){var d=o.charCodeAt(u);if(d){var m=this.toTranslit[d],h=o.substr(u,1);if(s+=null!=m?m:h,c){var g=this.toLocalCase[h],p=this.toLocalTranslit[d];i+=null!=g?g:h,l+=null!=p?p:h}}}r[s]=1,c&&(r[i]=2,r[l]=3),t.push(r)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var r=e.substr(a,1)||-1;n=n[r]?n[r]:n[r]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var r=this.index,o=0;o<6;o++){var s=a.substr(o,1)||-1;if(!r[s])break;r=r[s]}if(r.length)for(var o in r)if(this.equals(r[o],e)){r.splice(o,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(r(e[0])||r(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],r=!1;for(var o in n)if(n.hasOwnProperty(o)){if(r&&!a)break;var s=this.localSearch(n[o],0,t);s.sort((function(e,t){return e._order-t._order})),a=r?this.intersect(a,s):s,r=!0}for(var i=a[0],l=a.length+1,c=[],u=1;u<l;u++){var d=a[u];d!=i&&(c.push(i),i=d)}return c},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var r in e)e.hasOwnProperty(r)&&(a[s=r.substr(t,1)||-1]||(a[s]={}),a[s][r]=1);if(6==t++)return n;var o=[];for(var s in a)if("-1"===s)for(var i in n)n.hasOwnProperty(i)&&o.push.apply(o,this.localSearch(a[s],t,n[i]));else{var l=this.localSearch(a[s],t,n[s]);o.push.apply(o,l)}return o},e}();function r(e){return!isNaN(e)}},649159:(e,t,n)=>{"use strict";n.d(t,{MessageForward:()=>L});n(175115),n(530522),n(66108),n(991181),n(579665),n(95767),n(820075),n(940851),n(296253);var a=n(667294),r=(n(45697),n(319368)),o=n(148434),s=n(166056),i=n(389430),l=n(227192),c=n(663527),u=n(929566),d=n(351117),m=n(81020),h=n(41437),g=n(393202),p=n(121265),v=n(283778),_=n(800234),f=n(791563),C=n(432975);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(a=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var y=(0,l.debouncedPromise)(i.searchHints,300),S=h.default.getLang;class T extends a.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if((0,u.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?i.searchImTopConv:i.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>n("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=(0,u.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!(0,d.doesChatTabHaveFlag)(e,1024))&&!(!t&&n>2e9&&(0,d.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=(0,u.isCommunityInterface)(t)&&0===this.state.mode,r=a?i.searchImTopConv:i.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):r(e,n).then((t=>{var r=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?y(e,r,"all",{hidegid:a,skipStoreUpdate:a},n):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},r={};return(0,i.searchTopConv)("",t).then((o=>(o.forEach((e=>{r[e.peerId]=e})),[t.peer].concat(n.filter((e=>e!==t.peer))).map((t=>{var n=(0,u.getTab)(e,t);return a[t]=!0,{name:r[t]&&r[t].tab||n.tab,photo:r[t]&&r[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}})).concat(o.filter((e=>!a[e.peerId]))).sort(((n,a)=>n.peerId===t.peer?-1:a.peerId===t.peer?1:(0,C.sortFn)(e,n,a))))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([(0,m.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,g.statlogsForwardEvent)(t),(0,u.isCommunityInterface)(t)&&(0,g.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var r=e.filter((e=>!t.found[e.peerId]));r.forEach((e=>{t.found[e.peerId]=!0})),t.setState({found:[].concat(t.state.found,r),loading:a})}else t.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),a=new v.ImDraft({},0),r=e.get().pendingForward;if(t&&!(0,c.isMessageTooLong)(val)){this.setState({sending:!0});var o=(0,u.isCommunityInterface)(e)&&0===this.state.mode;o||a.addAttach("mail",r.msgIds.join(";"),r.object||null);var s={message:n,attaches:a.dData.attaches.map((e=>[e.type,e.id]))||[]},l={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:o?r.msgIds.join(";"):void 0}};new Promise((n=>{(0,i.loadHashes)([t],{hidegid:!0},e.get()).then((e=>{var a=I(e,1)[0];return n(a[t])}))})).then((n=>e.set(i.sendMessage.bind(null,t,s,b({hash:n},l))))).then((()=>{(0,g.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),showDoneBox(S("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,f.showFastBox)(S("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,i=this.state,l=i.mode,c=i.loading,d=i.selected,m=i.found,h=i.sending,g=(0,p.classNames)("MessageForward",{"MessageForward--form":0===l&&!!d});return a.createElement("section",{className:g},a.createElement(r.default,{title:a.createElement(a.Fragment,null,a.createElement("span",{className:"MessageForward__title"},S("mail_forward_messages")),(0,u.isCommunityInterface)(t)&&a.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},S(0===l?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),a.createElement("div",{className:"MessageForward__content"},a.createElement(s.ConvoPicker,{searchValue:this.state.value,isLoading:c,convos:m.map((e=>e||(0,u.getTab)(t,e.peerId))),mode:1===l?s.convoPickerMode.DEFAULT:s.convoPickerMode.RADIO,selectedConvos:[d],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),a.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},a.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},a.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:S("mail_im_enter_msg")}),a.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},a.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:S("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},a.createElement("div",{className:"emoji_smile_icon_vector emoji_smile_icon"})))),h?a.createElement("div",{className:"MessageForward__send-spinner"},a.createElement(o.default,null)):a.createElement("button",{className:"MessageForward__send",onClick:this.send}))))}}var L=(0,_.connect)(T)},888563:(e,t,n)=>{"use strict";n.d(t,{checkContactListLoaded:()=>K,mount:()=>le});n(820075),n(991181),n(59357),n(940851),n(296253);var a=n(791563),r=n(719016),o=n(116886),s=n(533246),i=n(389430),l=n(663527),c=n(172989),u=n(81020),d=n(929566),m=n(121265),h=n(193483),g=n(135685),p=n(992828),v=n(212311),_=n(632910),f=n(595869),C=n(736929),b=n(896282),I=n(428128),E=n(537510),y=n(907851),S=n(486353),T=n(351117),L=n(236205),A=n(414914),k=n(324466),w=n(705456),M=n(69785),P=n(841645),N=n(442699),R=n(663074),F="_im_dialog_action_wrapper",B="_im_dialog_call_action_wrapper",O="_im_header_icon",D="_im_page_action",x="_im_chat_verified",H="._im_page_status",U="im-page--chat-header_reconnected",j="button_disabled",q="im-page--header-action_loading";function V(e,t,n){return!e.map((e=>{var a=(0,d.getMessage)(t,n,e);return(0,h.isImportant)(a)})).reduce(((e,t)=>e&&t),!0)}function G(e,t){var n=t.get(),a=n.peer,r=n.tabs[a].pinned;return 1===e.length&&r&&e[0]===(0,d.parserMessage)(r).messageId}function K(e){return e.get().contactsList?Promise.resolve(e):e.set(i.getContactsList)}function z(e,t,n){var a=(0,o.getLang)("mail_selected_shorted",t.length);Q({actions:!0},"im-page--chat-header"),(0,A.val)((0,A.geByClass1)("im-page--selected-messages"),(0,N.getTemplate)("im_selected_messages",{label:a.replace("{count}",t.length),tip:(0,o.getLang)("mail_deselect_all")}));var r=(0,d.getTab)(n,n.get().peer),s=e.querySelector("._im_mess_actions"),i=V(t,n,n.get().peer),c=G(t,n),u=t.length>1,h=!u&&(0,l.isChatPeer)(r.peerId)&&(0,l.canPinMessage)(n,t[0]),g=(0,l.canForwardMessages)(n,t),p=e.querySelector('._im_page_action[data-action="respond"]'),v=e.querySelector('._im_page_action[data-action="forward"]'),_=Boolean((0,d.tabIsOutgoingMessageRequest)(r)),f=Boolean((0,d.tabIsMessageRequest)(r)),C=(0,T.isBusinessNotifyPeer)(n,n.get().peer);s.className=(0,m.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!i,"im-page--mess-actions_pinned":c,"im-page--mess-actions_channel":(0,d.isChannelPeer)(r)&&!n.get().gid,"im-page--mess-actions_multiple-selection":u,"im-page--mess-actions_no-pin-btn":!h,"im-page--mess-actions_out-mr":_,"im-page--mess-actions_in-mr":f,"im-page--mess-actions_business-notify":C,"im-page--mess-actions_no-important-btn":!(0,l.canMarkImportant)(n,t)}),t.length>1?p.innerHTML=(0,o.getLang)("mail_forward_here"):p.innerHTML=(0,o.getLang)("mail_im_mark_reply"),g?(v.removeAttribute("disabled"),v.classList.remove(j)):(v.setAttribute("disabled","disabled"),v.classList.add(j)),u&&!g||(0,T.isBusinessNotifyTab)(r)?(p.setAttribute("disabled","disabled"),p.classList.add(j)):(p.removeAttribute("disabled"),p.classList.remove(j));var b=i?(0,o.getLang)("mail_im_toggle_important"):(0,o.getLang)("mail_im_toggle_important_off"),I=c?(0,o.getLang)("mail_unpin"):(0,o.getLang)("mail_pin");attr((0,A.geByClass1)("im-page-action_star",e),"aria-label",b),attr((0,A.geByClass1)("im-page-action_pin",e),"aria-label",I)}function W(e,t,n){var a=t.get(),r=a.peer,o=a.tabs[r],s=(0,A.geByClass1)(x,e),c=(0,A.geByClass1)(l.PINNED_CONTAINER_CLASS,e),u=(0,l.isChatPeer)(r),m=u&&(0,d.isChannelPeer)(o),h=u&&(0,T.isBusinessNotifyTab)(o)&&(0,L.isBusinessNotifyEnabled)(t),v=a.selectedMessages&&!!a.selectedMessages.length;s.tt=!1;var _=(0,l.renderPhotosFromTab)(t,o,!1),f=(0,N.getTemplate)("im_simple_link",{href:m?"/club"+-o.ownerId:o.href,content:(0,N.getTemplate)("im_peer_photo",{online_class:"",owner_photo:_,modifier_class:"nim-peer_smaller"})});(0,A.val)((0,A.geByClass1)("im-page--aside-photo",e),f);var C=u&&(0,d.isChatActive)(o),b={muted:inArray(r,a.mutedPeers),verified:!!o.verified,chat:u,vkcomgroup:m,actions:v,derelict:u&&!C&&!m&&!h,pinned:!1};if(u){var I=(0,d.getPinnedMessage)(t),E=function(e){var t=(0,d.getPinnedMessage)(e);if(!t||(0,g.oCacheGet)(e,t.userId))return!1;return t.userId}(t);I&&(0,p.isPinnedMessageVisibleInTab)(t,r)&&(E?t.set(i.loadChatMember.bind(null,{[r]:[E]})).then(W.bind(null,e,t,n)):b.pinned=!0)}Y(t,o,e);var y=!o.top_banner&&c.innerHTML,S=!o.top_banner&&$(t,e,c),k=(0,A.geByClass1)("_im_page_peer_name",e);(0,A.removeClass)(k,l.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;(0,A.geByClass)(O,e).forEach((e=>{if("star"===e.dataset.type&&(0,l.isFoldersAvailable)(t)&&((0,A.toggleClass)(e,"im-page--header-icon_shown",!a),(0,A.toggleClass)(e,"im-page--header-icon_star-active",(0,l.isImportant)(t))),"answer"===e.dataset.type&&(0,l.isFoldersAvailable)(t)&&(0,A.toggleClass)(e,"im-page--header-icon_shown",!a&&(0,l.isUnrespond)(t)),"search"===e.dataset.type&&!(0,l.isCommunityInterface)(t)){var n=t.get().peer,r=!a&&(0,l.isFullyLoadedTab)(t,n)&&(0,d.getTab)(t,n).offset&&!(0,l.isCommunityInterface)(t)&&(!(0,l.isCallToPeerAvailable)(t,n)||!(0,l.isClassicInterface)(t));(0,A.toggleClass)(e,"im-page--header-icon_shown",r)}}))}(e,t,[]);var w=e.querySelector("._im_dialog_call_action_wrapper"),M=e.querySelector("._im_header_icon[data-type=call]");if(w&&w.classList.toggle("im-page--header-call-is-hidden",!(0,l.isCallToPeerAvailable)(t,r)||!!o.callInProgress),M&&(M.classList.toggle("im-page--header-icon_shown",(0,l.isCallToPeerAvailable)(t,r)&&!!o.callInProgress),M.classList.toggle("im-page--header-icon_call-active",!!o.callInProgress&&o.callInProgress.participants.count>0)),(0,l.isClassicInterface)(t)){var P=(0,A.geByClass1)("_im_page_back",e);attr(P,"href",`${(0,l.getBaseLink)(t)}?tab=${a.active_tab}`)}Q(b,"im-page--chat-header"),(0,l.compensateHistoryHeightChange)(t,S,y,n)}function Y(e,t,n){var a=(0,l.isChatPeer)(t.peerId),r=a&&(0,d.isChannelPeer)(t),s=a&&(0,d.isChatActive)(t),i=a&&(0,d.isCasperChatTab)(t),c=a&&(0,T.isBusinessNotifyTab)(t)&&(0,L.isBusinessNotifyEnabled)(e),u=(0,l.isContactPeer)(t.peerId),m=t.isDonutChat,h="";a?h=r?(0,N.getTemplate)("im_vkcomgroup_members",{name:(0,o.getLang)("mail_im_n_vkcomgroup_members",(0,l.getAliveMembersCount)(t))}):s?(0,N.getTemplate)("im_chat_members",{name:(0,o.getLang)("mail_im_n_chat_members",(0,l.getAliveMembersCount)(t))}):"":(0,l.isUserPeer)(t.peerId)&&(h=(0,l.getLastSeenTextInHeader)(e,t.peerId));var g=[];""!==h||c||g.push("im-page--title--1line"),i&&g.push("im-page--title--casper"),m&&g.push("im-page--title--donut"),c&&g.push("im-page--title--business-notify"),g=g.join(" ");var p=u?(0,l.prepareContactName)(t.name):t.tab,v=(0,N.getTemplate)("im_simple_name",{name:p,href:r?"/club"+-t.ownerId:t.href,name_attr:stripHTML(p),ads_union:t.ad_union_ids_attr,online:h,more_cls:g,more_children:c?(0,N.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:(0,o.getLang)("mail_tab_business_notify")}):""});(0,A.val)((0,A.geByClass1)("im-page--title-wrapper",n),v)}function $(e,t,n){var a=(0,d.getPinnedMessage)(e),r=n||(0,A.geByClass1)(l.PINNED_CONTAINER_CLASS,t);if((0,A.removeClass)(r,"im-page--pinned_with-bar"),a&&(0,h.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&(0,A.addClass)(r,"im-page--pinned_with-bar")}var o=(0,l.renderPinnedMessage)(e);return(0,A.val)(r,o),!!o}function Q(e,t){var n=(0,A.geByClass1)(t);Object.keys(e).forEach((a=>{(0,A.toggleClass)(n,`${t}_${a}`,!!e[a])}))}function J(e,t,n,a,r){e.set(i.removeMessagesWithRestore.bind(null,n,r,a)).then(t().removeMessagesRestore.bind(null,n,r,a)),(0,i.removeMessageSend)(n,r,null,a,e.get()).then((()=>{var a=(0,d.getTab)(e,r);n.includes(a.lastmsg)&&(0,i.loadActualLastMessage)(e,r).then((()=>{(0,S.partConfigEnabled)("messenger_empty_pinned_support")&&t().updateConvoInList(r,e),t().updateState(r,e)}))}))}function X(e,t,n,a,r){var o=e.get().selectedMessages,s=domData(r,"action"),u=e.get().peer,m=(0,d.getTab)(e,u),h=!0;if(!["star","delete"].includes(s)&&(0,d.tabIsOutgoingMessageRequest)(m))return ee(e,t,n);switch(s){case"delete":var g=!(vk.id==u&&!e.get().gid)&&o.every((t=>(0,l.canMessageBeDeletedForAll)(e,(0,d.getMessage)(e,u,t))));if(g||o.length>1){h=!1;var p=(0,l.showMsgDeleteDialog)(u,o.length,g,(a=>{ee(e,t,n),p.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?(0,i.removeMessageSend)(o,u,null,"deleteforall",e.get()):J(e,t,o,s,u)}))}else J(e,t,o,s,u);break;case"spam":J(e,t,o,s,u);break;case"forward":if(!(0,l.canForwardMessages)(e,o))return;(0,i.processFwd)(o,u,e).then((t=>e.set(i.prepareForward.bind(null,t)))).then((()=>n().showForward(e))).catch((e=>console.error(e)));break;case"star":var v=V(o,e,u);e.set(i.favMessage.bind(null,o,v,u)),e.get().longpoll.push(o.map((e=>({type:v?c.SET_FLAGS:c.RESET_FLAGS,messageId:e,peerId:u,flags:c.FLAG_IMPORTANT}))));break;case"respond":var _=e.get(),f=1===o.length;(0,i.processFwd)(o,_.peer,e).then((t=>e.set(i.forwardMessages.bind(null,t,_.tfdraft,f)))).then((()=>{t().respond(e,u)}));break;case"pin":var C=(0,d.getLocalId)(e,o[0]);if(!(0,l.canPinMessage)(e,C))return;var b=G(o,e),I=b?i.unpinMessageOptimistic.bind(null,u):i.pinMessageOptimistic.bind(null,C,u),E=b?i.unpinMessage.bind(null,u):i.pinMessage.bind(null,C,u),y=se.bind(null,t,u);e.set(i.checkChatMember.bind(null,e,C,u)).then((e=>e.set(I))).then(y).then((e=>e.set(E))).then(y)}h&&ee(e,t,n)}function Z(e,t,n,r,s,c){var m=domData(c,"action"),h=r.querySelector(`.${F} ._ui_menu`).parentNode,v=e.get().peer;switch(m){case k.ConvoAction.CLEAR:var _=(0,d.getTab)(e,v),f=(0,l.showFlushChat)(_,v,(()=>{(0,l.cleanHistory)(e,f,t,i.flushHistory,e.get().peer)}));break;case k.ConvoAction.MEDIA:showWiki({w:"history"+(0,l.convertPeerToUrl)(v)+"_photo"},null,{});break;case k.ConvoAction.CALL_AUDIO:case k.ConvoAction.CALL_VIDEO:(0,l.isCallToPeerAvailable)(e,v)&&(0,l.startCallFromIm)(e,v,m===k.ConvoAction.CALL_VIDEO,[],l.CALL_ENTRY_POINT_HEADER);break;case k.ConvoAction.CALL_APP:var S;(0,l.isCallToPeerAvailable)(e,v)&&(null===(S=window.Calls)||void 0===S?void 0:S.showStartCallModal)&&(0,l.startCallFromIm)(e,v,m===k.ConvoAction.CALL_VIDEO,[],l.CALL_ENTRY_POINT_HEADER,!0);break;case k.ConvoAction.CALL_BY_NAME:var T;(0,l.isCallToPeerAvailable)(e,v)&&(null===(T=window.Calls)||void 0===T?void 0:T.showCallByNamePopup)&&(0,l.startCallFromIm)(e,v,m===k.ConvoAction.CALL_VIDEO,[],l.CALL_ENTRY_POINT_HEADER,!1,!0);break;case k.ConvoAction.SEARCH:t().showSearch(e);break;case k.ConvoAction.BLOCK_NOTIFY:case k.ConvoAction.BLOCK_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!1,v)).then((()=>{e.get().longpoll.push([(0,u.resetPeer)()]),showDoneBox((0,o.getLang)("mail_community_was_blocked"))}));break;case k.ConvoAction.ALLOW_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!0,v)).then((()=>{n().changeActions(e)}));break;case k.ConvoAction.BLOCK:(0,l.showBlacklistBox)(v,e).once("success",(t=>{t.delta&&(showDoneBox(t.msg),e.get().longpoll.push([(0,u.resetPeer)()]))}));break;case k.ConvoAction.LEAVE:var A=(0,l.showLeaveDialog)(e,v,(n=>{var a=e.set(i.leaveChat.bind(null,v)).then((()=>e.set(i.unpinMessageOptimistic.bind(null,v))));n&&a.then((()=>(0,l.cleanHistory)(e,A,t,i.flushHistory,v))),A.hide(),e.get().longpoll.push([(0,u.resetPeer)()])}));break;case k.ConvoAction.UNREAD:var B=e.get();(0,i.markDialogUnread)(B.peer,B);break;case k.ConvoAction.RETURN:e.set(i.returnToChat.bind(null,v)).then((e=>e.set(i.getPinnedMessage.bind(null,v)))).then(t().updateChatTopic.bind(null,v)).catch((e=>{(0,a.showFastBox)((0,o.getLang)("global_error"),e)}));break;case k.ConvoAction.MUTE:case k.ConvoAction.UNMUTE:e.set(i.toggleMutePeer.bind(null,v,m===k.ConvoAction.MUTE,-1)).then(t().updateState.bind(null,v));break;case k.ConvoAction.PIN_CONVO:(0,E.pinConvoHandler)(e.get(),v).catch((e=>{(0,y.showErrorBox)(e)}));break;case k.ConvoAction.UNPIN_CONVO:(0,E.unpinConvoHandler)(e.get(),v).catch((e=>{(0,y.showErrorBox)(e)}));break;case k.ConvoAction.CHAT_INVITE:(0,l.inviteUser)(e,v,t,i.setCreationType);break;case k.ConvoAction.USER_INVITE:var O=(0,d.getTab)(e,v);if((0,l.isUserPeer)(v)&&O.canBeAddedToChat){(0,I.collectConvoInviteStats)(I.ConvoInviteEntryPoint.DIALOG_ACTIONS,v);var D=(0,l.isContactPeer)(v)?(0,b.makeUserFromUserConvo)(O):(0,g.oCacheGet)(e,v);(0,C.mount)(e,D,(t=>{var n;return Promise.resolve(null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,u.changePeer)(t,!1,!1,!1,"convo_invite")]))}),(t=>{var n;return null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,u.changePeer)(t,!1,!1,!1,"convo_invite")])}))}break;case k.ConvoAction.CREATE_CHAT:var x=(0,d.getTab)(e,v),H=[[v,x.tab]];e.set(i.setCreationType.bind(null,"chat",[])).then((()=>t().showCreation(e,H)));break;case k.ConvoAction.PIN_HIDE:(0,p.pinnedMessageHide)(e,(0,L.getPeer)(e),t);break;case k.ConvoAction.PIN_UNHIDE:(0,p.pinnedMessageUnHide)(e,(0,L.getPeer)(e),t);break;case k.ConvoAction.UNPIN:(0,p.pinnedMessageUnpin)(e,(0,L.getPeer)(e),t);break;case k.ConvoAction.SETTINGS:n().showSettings(e);break;case k.ConvoAction.DISABLE_BUSINESS_NOTIFY:var U,j=null===(U=(0,d.getTab)(e,v))||void 0===U?void 0:U.ownerId;if(!j)return;var q=new MessageBox({title:(0,o.getLang)("mail_business_notify_disable_box_title")});q.content((0,N.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:(0,o.getLang)("mail_business_notify_disable_box_text")})),q.addButton((0,o.getLang)("mail_business_notify_disable_box_button"),(n=>{(0,w.lockButton)(n),(0,M.denyMessagesFromGroup)({group_id:-j}).then((n=>{n&&e.set((e=>(0,P.setConvoBusinessNotifyEnabled)(e,v,!1))).then((()=>e.set(i.setActions))).then((()=>t().updateActions(e))),q.hide()}))})),q.show();break;case k.ConvoAction.ENABLE_BUSINESS_NOTIFY:var V,G=null===(V=(0,d.getTab)(e,v))||void 0===V?void 0:V.ownerId;if(!G)return;(0,M.allowMessagesFromGroup)({group_id:-G}).then((n=>{n&&e.set((e=>(0,P.setConvoBusinessNotifyEnabled)(e,v,!0))).then((()=>e.set(i.setActions))).then((()=>t().updateActions(e)))}));break;case k.ConvoAction.ARCHIVE:var K=(0,d.getTab)(e,v);if(!K)break;e.set((e=>(0,R.archiveConvo)(e,K))).then((()=>e.set(i.setActions))).then((()=>{t().updateActions(e),t().removePeer(e,v)})).then((()=>(0,M.archiveConversation)({peer_id:v})));break;case k.ConvoAction.UNARCHIVE:var z=(0,d.getTab)(e,v);if(!z)break;e.set((e=>(0,R.unarchiveConvo)(e,z))).then((()=>e.set(i.setActions))).then((()=>{var n;t().updateActions(e),t().restoreDialogs(e,!0,!0);var a=(0,y.unpackStore)(e);a.active_tab!==k.ConvoListFolder.ARCHIVE||(null===(n=a.dialog_tabs[k.ConvoListFolder.ARCHIVE])||void 0===n?void 0:n.length)||a.longpoll.push([(0,u.changeTab)(k.ConvoListFolder.ALL)])})).then((()=>(0,M.unarchiveConversation)({peer_id:v})))}uiActionsMenu.toggle(h,!1),t().cancelEditing()}function ee(e,t,n){var a=e.get().selectedMessages;e.set(i.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function te(e,t,n,a){var s,i,c=(0,l.isClassicInterface)(e);switch(domData(a,"type")){case"star":i=[4,6],s=()=>(0,l.isImportant)(e)?(0,o.getLang)("mail_im_toggle_important_off"):(0,o.getLang)("mail_im_toggle_important");break;case"answer":i=[4,6],s=(0,o.getLang)("mail_end_conversation");break;case"search":i=c?[5,6]:[4,-9],s=(0,o.getLang)("mail_search_in_peer")}(0,r.showTooltip)(a,{text:s||"",black:1,shift:i,forcetoup:!0,appendParentCls:c?"_im_dialog_actions":"_im_mess_actions"})}function ne(e,t,n){var a=(0,l.isClassicInterface)(e),o=domData(n.target,"action");"respond"!==o&&"forward"!==o&&(0,r.showTooltip)(n.target,{text:ae.bind(null,e,o)||"",black:1,shift:[2,a?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function ae(e,t){var n=e.get(),a=n.selectedMessages,r=n.peer;switch(t){case"pin":return G(a,e)?(0,o.getLang)("mail_unpin"):(0,o.getLang)("mail_pin");case"star":return V(a,e,r)?(0,o.getLang)("mail_im_toggle_important"):(0,o.getLang)("mail_im_toggle_important_off");case"delete":return(0,o.getLang)("mail_delete");case"spam":return(0,o.getLang)("mail_im_mark_spam")}}function re(e,t,n,a,r){var s=domData(r,"type"),c=e.get().peer;switch(s){case"star":e.set(i.toggleDialogImportant.bind(null,c)).then((()=>{setTimeout((()=>te(e,0,0,r)),40)}));break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(r,{fasthide:!0});break;case"answer":var m=(0,d.getTab)(e,c);m&&(e.set(i.markDialogAnswered.bind(null,e.get().peer,m.lastmsg)),showDoneBox((0,o.getLang)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,u.resetPeer)()]));break;case"call":if((0,l.isCallToPeerAvailable)(e,c)){var h=(0,d.getTab)(e,c).callInProgress;h&&(0,l.joinCallFromIm)(e,c,h.join_link,!1,l.CALL_ENTRY_POINT_JOIN_HEADER)}}}function oe(e,t){var n=Number(t),a=(0,l.formatTimespan)(n,!0),r=(0,o.getLang)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector(H).innerHTML=r}function se(e,t,n){return e().updateChatTopic(t,n),n}function ie(e,t,n,a){var r={};return{changeActions(t){var n=e.querySelector(`.${F} ._ui_menu`),a=e.querySelector(`.${F}`),r=t.get().curActions||{},o=Object.keys(r).sort(((e,t)=>i.ACTION_PRIORITIES[e]-i.ACTION_PRIORITIES[t]));if(0!==o.length){for(var s=(0,N.getTemplate)("sUiActionsMenuSeparator"),l="",c=0,u=0;u<o.length;u++){var d=o[u];u>0&&(c/10|0)!=(i.ACTION_PRIORITIES[d]/10|0)&&(l+=s),l+=(0,N.getTemplate)("sImUiActionMenuItem",{action:d,name:r[d].name,icon:r[d].icon,classes:"_im_action"}),c=i.ACTION_PRIORITIES[d]}n.innerHTML=l,a.classList.remove(q)}else a.classList.add(q)},setNetworkWaitingStatus(t,n){r.interval&&clearInterval(r.interval);var a=(0,d.getTab)(n,(0,T.getCurrentTab)(n));a&&!(0,T.isBusinessNotifyTab)(a)&&(oe(e,t),r.timeout=t,r.interval=setInterval((()=>{r.timeout>1?(r.timeout--,oe(e,r.timeout)):(clearInterval(r.interval),r={})}),1e3))},setNetworkReconnectingStatus(t){r.interval&&clearInterval(r.interval),r={};var n,a,s=(0,d.getTab)(t,(0,T.getCurrentTab)(t));s&&!(0,T.isBusinessNotifyTab)(s)&&(n=e.querySelector(H),a=(0,o.getLang)("mail_network_reconnecting"),n&&(n.innerHTML=a))},clearNetworkStatus(){r.interval&&clearInterval(r.interval),r={},e.querySelector(H).innerHTML=""},showSettings(t){var n=t.get(),r=(0,d.getTab)(t,n.peer);(0,d.isChatActive)(r)&&(0,v.mount)(e,t,a)},showForward(t){(0,_.mount)(e,t,a)},renderPeer(n){W(e,n,t)},reRenderPinned(t){var n=(0,T.getCurrentTab)(t);n&&n.pinned&&$(t,e)},reRenderTitle(t){var n=(0,T.getCurrentTab)(t);n&&Y(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&z(e,n,t)},hideActions(t){if(!(0,l.isFullyLoadedTab)(t,t.get().peer)){(0,A.geByClass)(O,e).forEach((e=>{(0,A.addClass)(e,q)}));var n=(0,A.geByClass1)(F,e);(0,A.addClass)(n,q);var a=(0,A.geByClass1)(B,e);(0,A.addClass)(a,q)}},showActions(t){if((0,l.isFullyLoadedTab)(t,t.get().peer)){(0,A.geByClass)(O,e).forEach((e=>{(0,A.removeClass)(e,q)}));var n=(0,A.geByClass1)(F,e);(0,A.removeClass)(n,q);var a=(0,A.geByClass1)(B,e);(0,A.removeClass)(a,q)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?z(e,a,n):W(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=(0,A.geByClass1)("_im_page_peer_online",t);a&&(0,l.isUserPeer)(n)&&(0,d.getTab)(e,n)&&(0,l.applyInnerHtml)(a,(0,l.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){ee(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,s.destroyModule)(n),cancelStackFilter("fowrward")}}}function le(e,t,n){var a=(0,s.createMutations)(ie),r=a.callMutations,o=a.bindMutations,c=X.bind(null,t,n,r),m=Z.bind(null,t,n,r,e),h=ee.bind(null,t,n,r),g=(e,n)=>{var a=t.get().peer,r=(0,d.getTab)(t,a);(0,l.showVerifiedTooltip)(n,(0,T.isBusinessNotifyTab)(r)?r.ownerId:a)},p=te.bind(null,t,e),v=ne.bind(null,t,e),_=re.bind(null,t,e,n),C=()=>r().showSettings(t),b=n=>{var a=t.get().peer;(0,l.isContactPeer)(a)&&((0,f.mount)(t,a,e),cancelEvent(n)),!gpeByClass("im-page--chat-header_chat",n.target,e)||gpeByClass("im-page--chat-header_vkcomgroup",n.target,e)||checkEvent(n)||(C(),cancelEvent(n))},I=()=>function(e,t){var n=()=>{t&&(t.classList.remove(U),t.removeEventListener("mouseleave",n))};t&&(t.classList.add(U),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),E=(0,s.createModule)({handlers:(n,a)=>{a(e,"click",D,c),a(e,"click","_im_action",m),a(e,"click",l.DESELECT_ALL_CLASS,h),a(e,"mouseover",x,g),a(e,"mouseover",O,p),a(e,"mouseover",D,v),a(e,"click",O,_),a(e,"click","_im_header_link",b),a(e,"click","_im_page_peer_name",b),a(e,"click","_im_chat_members",C),a(e,"click","_im_page_reconnect",I),a(e,"click","_im_page_back",(e=>{checkEvent(e)||(t.get().longpoll.push([(0,u.resetPeer)()]),cancelEvent(e))}))}});return(0,l.isReservedPeer)(t.get().peer)||setTimeout((()=>{t.set(i.setActions).then(r().changeActions)})),o(e,n,E,r)}},595869:(e,t,n)=>{"use strict";n.d(t,{mount:()=>d});n(940851),n(296253);var a=n(667294),r=n(533246),o=n(973935),s=n(879274),i=n(888563);function l(e,t,n){var r=c();if(r){var l=t-19e8;o.render(a.createElement(s.ContactPopup,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return(0,i.checkContactListLoaded)(e).then((e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find((e=>e.id===t)):null}(e,t);return Promise.resolve(n)}))}(e,l)}),r)}}function c(){return document.querySelector("._im_contact_popup_container")}function u(e,t){return{unmount:()=>function(e,t){var n=c();n&&o.unmountComponentAtNode(n),(0,r.destroyModule)(e)}(e),closeContactPopup(){var e=c();o.unmountComponentAtNode(e)}}}function d(e,t,n,a){var o=(0,(0,r.createMutations)(u).bindMutations)((0,r.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,o),o}},632910:(e,t,n)=>{"use strict";n.d(t,{mount:()=>g});n(940851),n(296253);var a,r=n(533246),o=n(667294),s=n(973935),i=n(800234),l=n(649159),c=n(389430);function u(){a&&a.hide()}function d(){a&&a.updateBoxCoords()}function m(){return document.querySelector("#MessageForward")}function h(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=isVisible(t);return{unmount(){var t=m();t&&s.unmountComponentAtNode(t),(0,r.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),a||show(t)},hideLoader(){hide(n),a||hide(t)}}}function g(e,t,n){var g=(0,(0,r.createMutations)(h).bindMutations)((0,r.createModule)({handlers:(e,t)=>{}})),p={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=m();t&&s.render(o.createElement(i.default,{value:e},o.createElement(l.MessageForward,{closePopup:u,updatePopup:d})),t)}(t),requestAnimationFrame((()=>a.updateBoxCoords()))},onHideAttempt:()=>(t.set(c.prepareForward.bind(null,null)),g.unmount(),!0)};return g.showLoader(),Promise.resolve().then((e=>{g.hideLoader(),a=new MessageBox(p).content('<div id="MessageForward"></div>').show()})),g}},287707:(e,t,n)=>{"use strict";n.d(t,{ChatCreation:()=>E});var a,r=n(570655),o=n(667294),s=n(41437),i=n(706885),l=n(456047),c=n(838091),u=n(410861),d=n(398834),m=n(774415),h=n(881150),g=n(111189),p=n(122902),v=n(91257),_=n(227192),f=n(537510),C=n(575e3),b=n(888563),I=n(432975);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(a||(a={}));var E=function(e){var t=e.store,n=e.uploadAvatar,E=e.onClose,y=e.onBack,S=e.onCreateChat,T=e.onGoToConvo,L=e.preselectedUsers,A=(0,r.__read)((0,o.useState)([]),2),k=A[0],w=A[1],M=(0,r.__read)((0,o.useState)(a.LOADING),2),P=M[0],N=M[1],R=(0,r.__read)((0,o.useState)(0),2),F=R[0],B=R[1],O=(0,r.__read)((0,o.useState)(""),2),D=O[0],x=O[1],H=(0,r.__read)((0,o.useState)(""),2),U=H[0],j=H[1],q=(0,r.__read)((0,o.useState)(void 0),2),V=q[0],G=q[1],K=(0,r.__read)((0,o.useState)(L?new Map(L.map((function(e){return[e.id,(0,u.getTokenFromUserItem)(e)]}))):new Map),2),z=K[0],W=K[1];(0,o.useEffect)((function(){(function(e){return(0,v.unpackStore)(e).hintsTree.then((function(t){var n=t.list.map((function(e){var t=(0,r.__read)(e,3),n=t[0];return{id:+n,peerId:+n,name:t[1],photo:t[2]}}));return function(e,t){return(0,b.checkContactListLoaded)(e).then((function(e){var n=e.get().contactsList.filter((function(e){return!e.user})).sort((function(e,t){return e.id<t.id?1:-1})).map((function(e){return{id:(0,I.getContactPeerId)(e.id),peerId:(0,I.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}})),a=n.splice(0,n.length<3?n.length:3);return(0,r.__spreadArray)((0,r.__spreadArray)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(t.slice(0,4))),(0,r.__read)(a)),(0,r.__read)(t.slice(4))),(0,r.__read)(n))}))}(e,n)}))})(t).then((function(e){if(L){var t=L.reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=L.concat(e.filter((function(e){return!t[e.peerId]})));w(n)}else w(e)})).then((function(){return N(a.LIST)})).catch((function(){N(a.ERROR)}))}),[]);var Y=(0,_.debouncedPromise)(f.searchHints,300);switch(P){case a.SETTINGS:return o.createElement(l.ChatCreationModal,{title:(0,s.getLang)("mail_chat_creation_settings"),onClose:E,onBack:function(){return N(a.LIST)}},o.createElement(c.ChatSettingsContainer,{flags:F,setFlags:B,onClose:function(){return N(a.LIST)}}));case a.LIST:return o.createElement(l.ChatCreationModal,{title:(0,s.getLang)("mail_im_create_chat"),onBack:y,onClose:E},o.createElement(u.UsersListContainer,{usersList:k,selectedMap:z,setSelectedMap:W,onServerSearch:function(e,n){return Y(e,n,C.HintsSearchType.FRIENDS_AND_CONTACTS,{},t.get())}}),o.createElement(d.ConvoInfoContainer,{title:D,photo:U,selectedUserIds:Array.from(z.keys()),onTitleChange:x,onShowSettings:function(){return N(a.SETTINGS)},onCreateChat:function(){var e=Array.from(z.keys()),n=V||void 0;return t.set((function(t){return(0,p.createChatAction)(t,n,e,D,F)})).then((function(e){S(e.get().next_peer)}))},onUploadAvatar:function(){N(a.PHOTO),n().then((function(e){if(e.photo&&e.photoData){var t=e.photo,n=e.photoData;j(t),G(n)}else G(void 0);N(a.LIST)})).catch((function(){N(a.ERROR)}))},onRemoveAvatar:function(){j(""),G(void 0)},onGoToConvo:T}));case a.ERROR:return o.createElement(l.ChatCreationModal,{title:(0,s.getLang)("global_error"),onClose:E},o.createElement(g.ModalBody,null,o.createElement("p",null,(0,s.getLang)("global_error"))),o.createElement(m.ModalFooter,{actionButtons:o.createElement(h.default,{onClick:E},(0,s.getLang)("global_close"))}));case a.LOADING:return o.createElement(i.default,null);case a.PHOTO:return o.createElement(o.Fragment,null)}}},421273:(e,t,n)=>{"use strict";n.d(t,{ChatCreationInfo:()=>c});var a=n(667294),r=n(581685),o=n(838482),s=n(595775),i=n(423558),l=n(41437),c=function(e){var t=e.onChangeTitle,n=e.onResetTitle,c=e.onShowSettings,u=e.onButtonClickHandler,d=e.title,m=e.photo,h=e.loading,g=e.onUploadAvatar,p=e.onRemoveAvatar,v=e.isButtonDisabled,_=e.buttonText;return a.createElement("div",{className:"ChatCreationInfo"},a.createElement("div",{className:"ChatCreationInfo__avatarWrapper"},a.createElement(r.default,{photo:m,title:d,className:"ChatCreationInfo__avatar",onClick:g}),m&&a.createElement(o.default,{text:(0,l.getLang)("mail_settings_remove_photo"),position:"t",align:"left"},a.createElement("button",{onClick:p,className:"ChatCreationInfo__avatarRemove"}))),a.createElement(s.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:d,onChange:function(e){return t(e.target.value)},onCancel:n,placeholder:(0,l.getLang)("mail_im_chat_title_intro")}),a.createElement(o.default,{text:(0,l.getLang)("mail_chat_creation_settings_icon_tooltip"),position:"t"},a.createElement("button",{className:"ChatCreationInfo__settings",onClick:c,"aria-label":(0,l.getLang)("mail_chat_creation_settings_icon_tooltip")})),a.createElement(i.default,{disabled:v,loading:h,onClick:u},_))}},456047:(e,t,n)=>{"use strict";n.d(t,{ChatCreationModal:()=>i});var a=n(138671),r=n(838480),o=n(667294),s=n(41437),i=function(e){var t=e.children,n=e.title,i=e.onClose,l=e.onBack;return o.createElement(a.default,{onClose:i,disableBodyScroll:!0,className:"ChatCreationModal"},o.createElement(r.ModalHeader,{title:n,onClose:i,backText:l?(0,s.getLang)("global_back"):void 0,onBack:l}),o.createElement("div",{className:"ChatCreationModal__content"},t))}},743543:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserRow:()=>c});var a=n(248586),r=n(750598),o=n(123683),s=n(667294),i=n(663527),l=n(906942),c=function(e){var t=e.data,n=e.onSelect,c=e.isSelected,u=t.photo?t.photo:s.createElement(l.ConversationNoPhoto,{id:t.peerId,text:(0,i.getUserInitials)(t.name),size:"34",specificType:7});return s.createElement(r.default,{"data-id":t.peerId,onClick:function(){return n(t.peerId)},selectable:!0,aside:s.createElement(o.ListMultiSelectControl,{isSelected:c})},s.createElement(a.default,{"data-id":t.peerId,size:"34",title:t.name,photo:u}))}},486288:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserList:()=>s});var a=n(667294),r=n(167578),o=n(41437),s=function(e){var t=e.usersList,n=e.onRemoveToken,s=e.onChange,i=e.onSelect,l=e.renderSuggest,c=e.tokens,u=e.query;return a.createElement(r.default,{className:"ChatCreationUserList",tokens:c,removeTokenPlaceholder:(0,o.getLang)("mail_create_chat_remove_user"),onRemoveToken:n,placeholder:(0,o.getLang)("mail_search_creation"),value:u,onChange:s,onSelect:i,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:function(){},notFoundText:(0,o.getLang)("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:l,data:t})}},838091:(e,t,n)=>{"use strict";n.d(t,{ChatSettingsContainer:()=>o});var a=n(667294),r=n(732779),o=function(e){var t=e.setFlags,n=e.flags,o=e.onClose;return a.createElement(r.ChatSettingsOptions,{flags:n,back:o,isChatCreation:!0,onSave:function(e){return t(e),Promise.resolve()},afterSave:o,onCancel:o})}},398834:(e,t,n)=>{"use strict";n.d(t,{ConvoInfoContainer:()=>i});var a=n(570655),r=n(421273),o=n(667294),s=n(41437),i=function(e){var t=e.title,n=e.photo,i=e.selectedUserIds,c=e.onShowSettings,u=e.onTitleChange,d=e.onCreateChat,m=e.onUploadAvatar,h=e.onRemoveAvatar,g=e.onGoToConvo,p=(0,a.__read)((0,o.useState)(!1),2),v=p[0],_=p[1],f=(0,a.__read)((0,o.useState)(!l(t)),2),C=f[0],b=f[1],I=1===i.length&&!C&&!n,E=0!==i.length||C,y=(0,o.useCallback)((function(e){b(!l(e)),u(e)}),[]),S=!I&&!E,T=I?(0,s.getLang)("mail_im_go_to_dialog"):(0,s.getLang)("mail_im_create_chat");return o.createElement(r.ChatCreationInfo,{title:t,onResetTitle:function(){return y("")},onChangeTitle:y,photo:n,onShowSettings:c,onButtonClickHandler:function(){if(!v)if(_(!0),I){var e=(0,a.__read)(i,1)[0];g(+e)}else d().catch((function(){_(!1)}))},loading:v,isButtonDisabled:S,onUploadAvatar:m,onRemoveAvatar:h,buttonText:T})};function l(e){return!e.trim().replace("\n","")}},410861:(e,t,n)=>{"use strict";n.d(t,{UsersListContainer:()=>c,getTokenFromUserItem:()=>d});var a=n(570655),r=n(667294),o=n(486288),s=n(743543),i=n(729685),l=n(897557),c=function(e){var t=e.usersList,n=e.selectedMap,l=e.setSelectedMap,c=e.onServerSearch,m=(0,a.__read)((0,r.useState)(""),2),h=m[0],g=m[1],p=(0,a.__read)((0,r.useState)(t.map((function(e){return e.peerId}))),2),v=p[0],_=p[1],f=(0,r.useRef)(u(t)),C=(0,r.useCallback)((function(e){return e.name}),[]),b=(0,r.useCallback)((function(e){return e.peerId}),[]),I=(0,i.useIndexer)(Array.from(f.current.values()),C,b),E=(0,r.useMemo)((function(){return Array.from(f.current.keys())}),[f.current]),y=(0,r.useCallback)((function(e,t){return c(e,t)}),[c]);(0,r.useEffect)((function(){var e=I.search(h).map((function(e){return e.peerId}));_(e),y(h,e).then((function(t){if(0!==h.length){var n=[],r=[];t.forEach((function(e){f.current.has(e.peerId)||(r.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(o=f,s=u(n),o.current=new Map((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(Array.from(o.current.entries()))),(0,a.__read)(Array.from(s.entries())))),_((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(e)),(0,a.__read)(r))))}var o,s})).catch((function(){}))}),[h]);var S=function(e){n.delete(e),l((function(){return new Map(n)}))},T=function(e){n.has(e)?S(e):(!function(e){var t=f.current.get(e);t&&(n.set(e,d(t)),l((function(){return new Map(n)})))}(e),g(""))},L=(0,r.useCallback)((function(e){S(+e)}),[n]),A=(0,r.useCallback)((function(e){g(e.target.value)}),[h]),k=Array.from(n.values());return r.createElement(o.ChatCreationUserList,{query:h,tokens:k,usersList:h?v:E,onSelect:T,onChange:A,onRemoveToken:L,renderSuggest:function(e){var t=f.current.get(e);return t?r.createElement(s.ChatCreationUserRow,{key:e,data:t,onSelect:T,isSelected:n.has(e)}):r.createElement(r.Fragment,null)}})};function u(e){return e.reduce((function(e,t){return t.name=(0,l.decodeHTMLEntities)(t.name),e.set(t.id,t)}),new Map)}function d(e){return{id:e.id.toString(),text:e.name}}},879274:(e,t,n)=>{"use strict";n.d(t,{ContactPopup:()=>d});var a=n(570655),r=n(667294),o=n(138671),s=n(7692),i=n(448975),l=n(706885),c=n(41437),u=n(907851),d=function(e){var t=e.getContactInfo,n=e.onClose,d=(0,a.__read)((0,r.useState)({kind:"loading"}),2),m=d[0],h=d[1];switch((0,r.useEffect)((function(){var e=function(e){(0,u.showErrorBox)(e),h({kind:"failed"}),n()};t().then((function(t){t?h({kind:"loaded",contact:t}):e((0,c.getLang)("mail_contact_was_removed"))})).catch((function(){e((0,c.getLang)("global_error"))}))}),[]),m.kind){case"failed":return r.createElement(r.Fragment,null);case"loading":return r.createElement(l.default,null);case"loaded":return r.createElement(o.default,{onClose:n,className:"ContactPopup"},r.createElement(s.default.Header,{title:(0,c.getLang)("mail_contact"),onClose:n}),r.createElement(i.ContactPopupContent,{contact:m.contact}))}}},620935:(e,t,n)=>{"use strict";n.d(t,{ContactIconRow:()=>o});var a=n(667294),r=n(121265),o=function(e){var t=e.icon,n=e.children,o=(0,r.classNames)("ContactIconRow__icon","ContactIconRow__icon--"+t);return a.createElement("div",{className:"ContactIconRow"},a.createElement("div",{className:o}),a.createElement("div",{className:"ContactIconRow__text"},n))}},448975:(e,t,n)=>{"use strict";n.d(t,{ContactPopupContent:()=>u});var a=n(667294),r=n(663527),o=n(620935),s=n(906942),i=n(30081),l=n(41437),c=n(432975),u=function(e){var t=e.contact,n=(0,c.getContactPeerId)(t.id);return a.createElement("div",{className:"ContactPopupContent"},a.createElement("header",{className:"ContactPopupContent__header"},a.createElement("div",{className:"ContactPopupContent__photo"},t.photo?a.createElement("img",{className:"ContactPopupContent__contactAvatarImage",src:t.photo,alt:t.name}):a.createElement(s.ConversationNoPhoto,{text:(0,r.getUserInitials)(t.name),size:"80",id:n,specificType:7,key:t.id})),a.createElement("h3",{className:"ContactPopupContent__title"},a.createElement(i.default,null,(0,r.prepareContactName)(t.name))),a.createElement("div",{className:"ContactPopupContent__meta"},(0,l.getLang)("mail_from_contacts_list"))),a.createElement("div",{className:"ContactPopupContent__info"},t.main_phone&&a.createElement(o.ContactIconRow,{icon:"phone"},(0,r.formatPhoneNumber)(t.main_phone)),t.emails[0]&&a.createElement(o.ContactIconRow,{icon:"mail"},a.createElement("a",{href:"mailto:"+t.emails[0]},t.emails[0]))),t.sync_date&&a.createElement("div",{className:"ContactPopupContent__info"},a.createElement(o.ContactIconRow,{icon:"sync"},t.sync_date)))}},166056:(e,t,n)=>{"use strict";n.d(t,{convoPickerMode:()=>a,ConvoPicker:()=>b});var a,r=n(570655),o=n(667294),s=n(973935),i=n(121265),l=n(736434),c=n(884143),u=n(148434),d=n(658861),m=n(229852),h=n(41437),g=n(752141),p=n(929566),v=n(663527),_=n(750598),f=n(916972),C=h.default.getLang;!function(e){e.DEFAULT="default",e.RADIO="radio"}(a||(a={}));var b=function(e){var t,n=e.searchValue,h=void 0===n?"":n,b=e.isLoading,I=void 0!==b&&b,E=e.convos,y=e.mode,S=void 0===y?a.DEFAULT:y,T=e.selectedConvos,L=void 0===T?[]:T,A=e.checkDisabled,k=e.onSearchValueChange,w=e.onSearchInputKeydown,M=e.onConvoSelect,P=e.onListLoadMore,N=void 0===P?function(){}:P,R=e.onAddClick,F=e.searchInputGetter,B=e.className,O=e.style,D=(0,r.__rest)(e,["searchValue","isLoading","convos","mode","selectedConvos","checkDisabled","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","onAddClick","searchInputGetter","className","style"]),x=(0,i.classNames)("ConvoPicker",B),H=(0,o.createRef)(),U=(0,r.__read)((0,o.useState)(0),2),j=U[0],q=U[1],V=function(e){var t=Math.max(e-1,0);return A&&A(E[t])?V(t):t},G=function(e){var t=Math.min(e+1,E.length-1);return A&&A(E[t])?G(t):t},K=function(e){e!==j&&(q(e),function(e){if(t){var n=E[e].peerId,a=t.querySelector('[data-id="'+n+'"]');if(a&&a instanceof HTMLElement){var r=a.offsetTop,o=t.scrollTop;if(r<o)t.scrollTop=r;else{var s=t.offsetHeight,i=r+a.offsetHeight;i>o+s&&(t.scrollTop=i-s)}}}}(e))};(0,o.useEffect)((function(){F&&H.current&&F(H.current.element)}),[]);var z=!!R&&!h,W=(z?[o.createElement(_.default,{selectable:!1,key:"add","data-id":0},o.createElement(f.ListAddControl,{onClick:R},C("mail_new_convo_from_invite")))]:[]).concat(E.map((function(e,t){var n=e.peerId,a=e.photo,r=e.name,s=e.online,i=!!A&&A(e);return o.createElement(g.ConvoPickerRow,{key:n,"data-id":n,peerId:n,photo:a,name:r,online:s,memberCount:(0,v.getChatMemberCount)(e),mode:S,isCasper:(0,p.isCasperChatTab)(e),isSelected:L.includes(n),isActive:t===j,isDisabled:i,onClick:function(){i||M(n)},onMouseEnter:function(){return q(i?-1:t)}})})));return o.createElement("div",(0,r.__assign)({className:x,onMouseLeave:function(){return q(-1)},style:O},D),o.createElement(l.BlockSearchInput,{value:h,onChange:k,onKeyDown:function(e){switch(e.which||e.keyCode){case m.ARROW_UP:K(V(j)),e.preventDefault();break;case m.ARROW_DOWN:K(G(j)),e.preventDefault();break;case m.ENTER:M(E[j].peerId),e.preventDefault()}w(e)},placeholder:C("mail_top_search"),autoFocus:!0,key:"search",ref:H}),I&&o.createElement(c.default,{className:"ConvoPicker__stub",key:"loading"},o.createElement(u.default,null)),!I&&h&&0===E.length&&o.createElement(c.default,{className:"ConvoPicker__stub",key:"no-results"},C("mail_im_search_empty_chats")),!I&&(E.length>0||z)&&o.createElement(d.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:N,hasMore:!1,ref:function(e){var n=s.findDOMNode(e);n&&n instanceof HTMLElement&&(t=n)},key:"results"},W))}},752141:(e,t,n)=>{"use strict";n.d(t,{ConvoPickerRow:()=>g});var a=n(570655),r=n(667294),o=n(121265),s=n(750598),i=n(248586),l=n(663527),c=n(166056),u=n(471709),d=n(906942),m=n(581685),h=n(206566),g=function(e){var t=e.peerId,n=e.name,g=e.photo,p=e.online,v=e.memberCount,_=e.mode,f=void 0===_?c.convoPickerMode.DEFAULT:_,C=e.isSelected,b=e.isDisabled,I=e.isActive,E=e.isCasper,y=e.className,S=(0,a.__rest)(e,["peerId","name","photo","online","memberCount","mode","isSelected","isDisabled","isActive","isCasper","className"]),T=function(e,t,n,a){void 0===a&&(a=0);var o=(0,l.isContactPeer)(e);switch(!0){case Array.isArray(n):return r.createElement(u.default,{photos:n});case o:return r.createElement(d.ConversationNoPhoto,{id:e,text:(0,l.getUserInitials)(t),size:"34",specificType:7});default:return r.createElement(m.default,{isOnline:!!a,isMobile:!!h.mobPlatforms[a],title:t,photo:n,onlineSize:"s"})}}(t,n,g,p),L=E?'<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          '+n+"\n        </span>\n      </span>":n,A=f===c.convoPickerMode.RADIO?r.createElement("span",{className:(0,o.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":C})}):void 0,k=(0,o.classNames)("ConvoPickerRow",y,{"ConvoPickerRow--disabled":b});return r.createElement(s.default,(0,a.__assign)({active:I,selectable:!b,canBeHovered:!1,chevron:f===c.convoPickerMode.DEFAULT&&!b,aside:A,className:k},S),r.createElement(i.default,{ignoreDecodeHTML:!0,size:"34",title:r.createElement("span",{dangerouslySetInnerHTML:{__html:L}}),photo:T,description:v,className:"ConvoPickerRow__itemContent"}))}},504685:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteContainer:()=>k});var a,r=n(570655),o=n(667294),s=n(397512),i=n(774415),l=n(731585),c=n(166056),u=n(122902),d=n(762371),m=n(351117),h=n(791563),g=n(41437),p=n(706885),v=n(537510),_=n(116886),f=n(992665),C=n(841645),b=n(371372),I=n(949597),E=n(344624),y=n(432975),S=n(575e3),T=n(287707),L=n(161945),A=g.default.getLang;!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(a||(a={}));var k=function(e){var t=e.user,n=e.store,g=e.onClose,k=e.onInviteSent,w=e.onGoToConvo,M=(0,r.__read)((0,o.useState)(a.PICKER),2),P=M[0],N=M[1],R=(0,r.__read)((0,o.useState)(!function(e){var t,n=e.get(),a=n.chatList||(null===(t=n.dialog_tabs)||void 0===t?void 0:t.all);return Boolean(a&&a.length>0)}(n)),2),F=R[0],B=R[1],O=(0,r.__read)((0,o.useState)(!0),2),D=O[0],x=O[1],H=(0,r.__read)((0,o.useState)(!1),2),U=H[0],j=H[1],q=(0,r.__read)((0,o.useState)(function(e){var t,n=e.get(),a=n.chatList||((null===(t=n.dialog_tabs)||void 0===t?void 0:t.all)||[]).filter(b.isChatPeer);if(a&&a.length>0)return a.map((function(t){return(0,m.getTab)(e,t)}));return[]}(n)),2),V=q[0],G=q[1],K=(0,r.__read)((0,o.useState)(""),2),z=K[0],W=K[1],Y=(0,o.useCallback)((function(e){W(e.target.value)}),[z]),$=(0,o.useCallback)((function(){}),[]),Q=(0,o.useRef)(null),J=(0,r.__read)((0,I.useHints)(n,V,z,{queryType:S.HintsSearchType.ALL,filterFn:function(e){return(0,b.isChatPeer)(e.peerId)}}),2),X=J[0],Z=J[1];(0,o.useEffect)((function(){return(0,v.loadConversations)(n.get(),d.ConvoFilters.CHATS,200).then((function(e){var t=e.items;return G((0,y.mergeConvoLists)(V,t)),t})).then((function(e){var t=e.reduce((function(e,t){return e[t.peerId]=t,e}),{});return n.set((function(n){return(0,C.mergeTabs)(n,t).then((function(t){return(0,f.setChatList)(t,e.map((function(e){return e.peerId})))}))}))})).finally((function(){return B(!1)})),(0,E.cancelStackPush)("convo_invite",(function(){})),function(){setTimeout((function(){return(0,E.cancelStackFilter)("convo_invite")}),0)}}),[]);var ee=t.inv_name?(0,_.langStr)((0,_.langSex)(t.sex,A("mail_im_invite_user",!0)),"user",t.inv_name):A("mail_convo_invite_title");return o.createElement(o.Fragment,null,P===a.PICKER&&o.createElement(s.UserConvoInviteModal,{title:ee,onCloseModal:g,footer:o.createElement(i.ModalFooter,null,o.createElement(l.default,{checked:D,onChange:function(e,t){return x(t)}},A("mail_im_chat_add_members_show_history")))},o.createElement(c.ConvoPicker,{convos:X.map((function(e){return(0,m.getTab)(n,e.peerId)||e})),searchValue:z,onSearchValueChange:Y,onSearchInputKeydown:$,onConvoSelect:function(e){j(!0),Promise.resolve().then((function(){return n.set((function(n){return(0,u.addNewMember)(e,[t.id],D,n)}))})).then((function(){return k(e)})).then((function(){g(),j(!1)})).catch((function(e){j(!1),(0,h.showFastBox)(A("global_error"),e)}))},checkDisabled:function(e){return!e.canInvite},searchInputGetter:function(e){return Q.current=e},isLoading:F||Z&&0===X.length,style:{height:410},onAddClick:function(){return N(a.CREATION)}})),P===a.CREATION&&o.createElement(T.ChatCreation,{store:n,uploadAvatar:L.uploadConvoPhoto,onClose:g,onBack:function(){return N(a.PICKER)},onCreateChat:function(e){k(e).then((function(){}),(function(){})),g()},onGoToConvo:function(e){w(e),g()},preselectedUsers:[{id:t.id,peerId:t.id,name:t.name,photo:t.photo}]}),U&&o.createElement(p.default,null))}},397512:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteModal:()=>i});var a=n(667294),r=n(138671),o=n(41437),s=n(838480),i=function(e){var t=e.title,n=e.onCloseModal,i=e.footer,l=e.isWithBackButton,c=void 0!==l&&l,u=e.onBackClick,d=e.children;return a.createElement(r.default,{className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:n},a.createElement(s.ModalHeader,{title:t,onClose:n,backText:c?(0,o.getLang)("global_back"):void 0,onBack:u,className:"UserConvoInviteModal__header"}),a.createElement("div",{className:"UserConvoInviteModal__content"},d),i)}},736929:(e,t,n)=>{"use strict";n.d(t,{mount:()=>c});var a=n(533246),r=n(667294),o=n(973935),s=n(504685);function i(){var e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function l(e){return{unmount:function(){var t=i();t&&o.unmountComponentAtNode(t),(0,a.destroyModule)(e)}}}function c(e,t,n,c){var u=(0,(0,a.createMutations)(l).bindMutations)((0,a.createModule)({handlers:function(){}}));return function(e,t,n,a,l){var c=i();o.render(r.createElement(s.UserConvoInviteContainer,{user:n,store:e,onClose:t.unmount,onInviteSent:a,onGoToConvo:l}),c)}(e,u,t,n,c),u}},729685:(e,t,n)=>{"use strict";n.d(t,{useIndexer:()=>s});var a=n(570655),r=n(337057),o=n(667294),s=function(e,t,n){var s=(0,o.useRef)(null);s.current=s.current?s.current:new r.VkIndexer(e,t);var i=s.current,l=(0,o.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),c=(0,a.__read)((0,o.useState)(e),2),u=c[0],d=c[1],m=(0,a.__read)((0,o.useState)(l(e)),2),h=m[0],g=m[1];return(0,o.useEffect)((function(){var t=l(e),a=e.filter((function(e){return!h[n(e)]})),r=u.filter((function(e){return!t[n(e)]}));(a.length||r.length)&&(a.forEach((function(e){i.add(e)})),r.forEach((function(e){i.remove(e)})),d(e),g(t))}),[e]),i}},663074:(e,t,n)=>{"use strict";n.d(t,{archiveConvo:()=>i,unarchiveConvo:()=>l});var a=n(324466),r=n(91257);function o(e,t,n){var a,r;e.dialog_tabs[t]=null!==(r=null===(a=e.dialog_tabs[t])||void 0===a?void 0:a.filter((function(e){return e!==n})))&&void 0!==r?r:[]}function s(e,t,n){var a;null===(a=e.dialog_tabs[t])||void 0===a||a.push(n)}function i(e,t){t.folders=t.folders&&t.folders|a.FOLDER_MASKS[a.FOLDER_ARCHIVE];var n=(0,r.unpackStore)(e);return o(n,a.ConvoListFolder.ALL,t.peerId),t.unread&&o(n,a.ConvoListFolder.UNREAD,t.peerId),s(n,a.ConvoListFolder.ARCHIVE,t.peerId),Promise.resolve(n)}function l(e,t){t.folders=t.folders&&t.folders&~a.FOLDER_MASKS[a.FOLDER_ARCHIVE];var n=(0,r.unpackStore)(e);return o(n,a.ConvoListFolder.ARCHIVE,t.peerId),s(n,a.ConvoListFolder.ALL,t.peerId),t.unread&&s(n,a.ConvoListFolder.UNREAD,t.peerId),Promise.resolve(n)}},949597:(e,t,n)=>{"use strict";n.d(t,{useHints:()=>m});var a=n(570655),r=n(667294),o=n(227192),s=n(537510),i=n(729685),l=n(432975),c=n(575e3),u=(0,o.debouncedPromise)(s.searchHints,300),d=function(){return!0};function m(e,t,n,o){var s=(0,a.__read)((0,r.useState)(t),2),m=s[0],h=s[1],g=(0,a.__read)((0,r.useState)(!1),2),p=g[0],v=g[1],_=(0,r.useRef)(n),f=(0,r.useCallback)((function(e){return e.name}),[]),C=(0,r.useCallback)((function(e){return e.peerId}),[]),b=(0,i.useIndexer)(t,f,C),I=(0,r.useCallback)((function(e){return o.filterFn?e.filter(o.filterFn):e}),[o.filterFn]);return(0,r.useEffect)((function(){if(_.current=n,n){var a=b.search(n),r=a.map((function(e){return e.peerId}));h(I(a)),v(!0),u(n,r,o.queryType||c.HintsSearchType.ALL,o,e.get()).then((function(e){_.current===n&&(h((0,l.mergeConvoLists)(a,e,o.filterFn||d)),v(!1))})).catch((function(){}))}else h(I(t)),v(!1)}),[n,t]),[m,p]}},161945:(e,t,n)=>{"use strict";n.d(t,{uploadConvoPhoto:()=>s});var a=n(917999),r=n(621260),o=n(575e3);function s(){var e=2e9+Math.round((0,a.rand)(1e6,2e6));return new Promise((function(t){window.cur.recieveCropResult=function(n){window.cur.recieveCropResult=!1,(0,o.ownerPhoto)(JSON.parse(n).data[0],e).then((function(e){var a=Array.isArray(e)?e[0]:e;t({photo:a,photoData:n}),(0,r.curBox)()&&(0,r.curBox)().hide(!0)}),(function(){}))},window.Page.ownerPhoto(e),(0,r.curBox)().setOptions({onHideAttempt:function(e){return e||t({}),!0}})}))}},762371:(e,t,n)=>{"use strict";var a;n.d(t,{ConvoFilters:()=>a}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(a||(a={}))}}]);try{stManager.done("dist/519619abdcf4517008a7b23855d1f7bd.7625502dc6527ca307a9.js")}catch(e){}