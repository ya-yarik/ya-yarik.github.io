/* profiles */(function(a){function i(i,l){l=l||{},a(i).bind("click",function(c){var f=a(this),i=f.data("tag-id");b=0,d=f.data("maxsize")||2e3,e=f.data("minsize")||0,g=f.data("allowEnter");if(a(c.target).is("a"))return;f.prop("contenteditable",!0).focus();if(window.context.enableTagging&&i&&h&&!h[i]){var j=f.data("tag-mention"),k=j&&Object.keys(j).length||0;h[i]=Myspace.tagging(f),k&&h[i].setMentionProfileList(j)}}).bind("focus",function(){var b=a(this),d=b.text();!a.trim(d)||a.trim(d)===b.data("placeholder")?(b.text("​"),c=b.data("placeholder"),placeCaretAtEnd(this)):c=d,j(b)}).bind("keydown",function(b){var c=a(this);if(b.which===13&&!g||b.which===27){c.blur();return}if(b.which===9){var d=a(".contentEditable"),e=d.index(c)+1;c.blur(),e=d.length==e?0:e;var f=d[e];f.click(),placeCaretAtEnd(f),b.preventDefault();return}k(b)}).bind("keyup",function(c){var g=a(this);j(g,!0),k(c),d-b>=e&&f&&(g.siblings(".tipHolder").tip("hide"),f=!1),b==d&&!g.children().length&&(g.text("​"),placeCaretAtEnd(this))}).bind("blur",function(){var c=a(this),g="",i=c.data("tag-id"),j=a("ul.mentionDropDown");if(typeof l.onblur=="function")return l.onblur();if(i&&j&&j.hasClass("show"))return!1;if(e>d-b)return setTimeout(function(){c.siblings(".tipHolder").tip({title:c.data("minSizeMessage"),trigger:"manual",placement:"inside top"}).tip("addErrorCustomClass").tip("show"),f=!0,c.focus()},10),!1;var k=c.data("event");c.prop("contenteditable",!1),c.data("placeholder")&&b===d?(c.text(c.data("placeholder")),k&&comm.send(k,{value:"",tags:[]})):i&&h[i]?k&&(g=="​"&&(g=""),h[i].getTaggingInfo(function(a){g=a.text.substr(0,d),comm.send(k,{value:g,tags:a.tags})})):(g=a.trim(c.text()).substr(0,d),c.data("trimDisabled")||c.text(g),k&&(g=="​"&&(g=""),comm.send(k,{value:g}))),comm.send("field.edited")}).bind("paste",function(){var b=a(this),c=b.data("tag-id"),e=a(this).data("onpaste");setTimeout(function(){if(e)comm.send(e,{target:b});else{if(c)return!1;var f=a.trim(b.text().replace(/<!--(.|\n)*?-->/mg,""));f&&(b.removeClass("empty"),b.text(f.substr(0,d)),placeCaretAtEnd(this))}},0)})}function j(c,e){var f=c.text().replace(/[\u200B]/,"");f=e?l(f):a.trim(f),b=d-f.length,b<0?c.addClass("overLimit"):d==b?c.addClass("empty"):(c.removeClass("empty"),c.removeClass("overLimit")),c.attr("data-content",b)}function k(a){a.which!==8&&(a.which<37||a.which>40)&&b<=0?a.preventDefault():a.which===8&&b==d&&a.preventDefault()}function l(a){return a.replace(/^\s+/,"")}var b,c,d,e,f=!1,g=!1,h=[];window.placeCaretAtEnd=function(a){a.focus();if(window.getSelection&&document.createRange){var b=document.createRange();b.selectNodeContents(a),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else if(typeof document.body.createTextRange){var d=document.body.createTextRange();d.moveToElementText(a),d.collapse(!1),d.select()}},i(a(".contentEditable")),Myspace.ContentEditable={makeEditable:i}})(jQuery);
(function(a){Myspace.ContentEditableForm=function(b,c){function p(){var b=window.getSelection&&window.getSelection();if(b&&b.type=="Range"&&b.focusNode&&b.focusNode.nodeType==3){var c=a(b.focusNode).closest(".contentEditable");c.length&&c.prop("contenteditable")!=="true"&&c.click()}}function q(a,c){if(o)return;a&&a.stopPropagation(),o=!0,h.removeClass("allEmpty"),b.addClass("editing"),A(),s(c),t(c),comm.send("contentEditableForm.enterEditMode",{$form:b}),setTimeout(function(){d.on("click",r).on("keydown",r),b.on("mouseup",p)},0)}function r(a){if(a.type=="keydown"&&a.which===8&&document.activeElement.nodeName==="BODY"){a.preventDefault();return}if(e&&!e(a))return;o=!1,u(),v(),x(),y(),z(),b.removeClass("editing"),w(),comm.send("contentEditableForm.exitEditMode",{$form:b}),d.off("click",r).off("keydown",r),b.off("mouseup",p)}function s(b){i.each(function(){var c=a(this);if(c.children("a").length){var d=a.trim(c.text())||"​";c.text(d),b&&b.is(c)&&placeCaretAtEnd(c[0])}})}function t(b){j.each(function(){var c=a(this),d=c.find(".contentEditable"),e=c.find(".media > .songImage").first().find(".playBtn");if(e.length){var f=objectify(e);d.html(htmlEncode(f.title)+"<br/>​"+htmlEncode(f.artistName))}b&&b.closest(c).length&&d.click()})}function u(){l.each(function(){var b=a(this),c=b.find(".contentEditable"),d=b.find(".showMore"),e=b.find(".showLess"),f=c.filter(".empty"),g=c.filter(":not(.empty)"),h=b.data("displayLimit")||g.length;c.length==f.length?f.not(":first").remove():f.remove(),d.length&&(b.removeClass("showAll"),g.length>h?b.addClass("shorten"):b.removeClass("shorten"));if(b.hasClass("combine")){var i=b.find(".combined"),j=b.find(".combinedAll");if(g.length){var k=[];g.each(function(){k.push(a(this).text())}),i.text(k.slice(0,h).join(", ")+"   ").append(d).removeClass("empty"),j.text(k.join(", ")+"   ").append(e).removeClass("empty")}else i.html(d).addClass("empty"),j.html(e).addClass("empty")}})}function v(){m.each(function(){var b=a(this),c=!0;b.find(g).each(function(){if(!a(this).hasClass("empty"))return c=!1,!1}),c?b.addClass("empty"):b.removeClass("empty")})}function w(){h.each(function(){var b=!0,c=a(this);c.find(g).each(function(){if(!a(this).hasClass("empty"))return b=!1,!1}),b&&c.addClass("allEmpty")})}function x(){k.each(function(){var b=a(this),c=b.data("displayText");c?(b.text(c),b.removeClass("empty")):(b.text("​"),b.addClass("empty"))})}function y(){i.each(function(){var b=a(this),c=a.trim(b.text()).replace(/https?:\/\//,"");if(b.data("editableType")=="email"){var d=a("<a></a>").text(c).attr("href","mailto:"+c);b.html(d)}else b.text(c)})}function z(){j.each(function(){var b=a(this),c=b.find(".contentEditable"),d=b.find(".media > .songImage").first().find(".playBtn");b.removeClass("searching");if(d.length){var e=objectify(d),f=a("<h6></h6>").append(a("<a></a>").attr("href",e.url).text(e.title)).append("<br/>").append(a("<span></span>").append(a("<a></a>").attr("href",e.artistUrl).text(e.artistName)));c.empty().append(f)}else b.addClass("empty")})}function A(){a.each(g,function(){var b=a(this);b.hasClass("contentEditable")&&a.trim(b.text())==""&&b.addClass("empty")})}function B(a){Myspace.ContentEditable.makeEditable(a),g=g.add(a);var b=a.data("editableType");b=="link"?i=i.add(a):b=="song"?j=j.add(a):b=="autocomplete"&&(k=k.add(a))}var d=a(document),e=c.exitValidator,f=c.editablesSelector||".contentEditable",g=b.find(f),h=c.emptyStateContainers&&a(c.emptyStateContainers)||b,i=g.filter('[data-editable-type="link"],[data-editable-type="email"]'),j=g.filter('[data-editable-type="song"]'),k=g.filter('[data-editable-type="autocomplete"]'),l=b.find(".resizeableFields"),m=a(c.editableSections),n=c.disableWindowBlur,o=!1;return b.delegate(f,"click",function(b){if(a(b.target).closest("a, .playBtn").length)return;q(b,a(this))}),n||a(window).blur(function(a){r(a)}),l.on("click",".combined, .combinedAll",function(b){q(b,a(this));var c=a(b.delegateTarget).find(".contentEditable").first();c.click(),placeCaretAtEnd(c[0])}),{enterEditMode:q,addEditable:B}}})(jQuery);
(function(a){Myspace.SongEditor=function(b){function g(a,b){var c=h();c&&(c.currentSong=!0,a.unshift(c)),b(a)}function h(){var b=Cookies.player,c=a("#queue .queue .controls"),d=c.find(".playBtn.playing,.playBtn.paused"),e;return!d.length&&b&&b.values.sequenceId>-1&&(d=c.find('.playBtn[data-sequence-id="'+b.values.sequenceId+'"]')),d.length&&(e=objectify(d)),e&&e.type=="song"?e:null}function i(){var a=b.find(".media > .songImage").first().find(".playBtn");return a.length?objectify(a):{mediaId:-1,mediaReleaseId:-1}}var c=b.find(".songSearch"),d=i(),e='<div class="media size_30 inline" data-song-id="<%- song.mediaId %>" data-song-release-id="<%- song.mediaReleaseId %>"><a class="songImage"><%- play("song", song) %><img src="<%- song.imageUrl %>" alt="" /></a><div><% if (song.currentSong) { %>Current Song<% } else { %><%= song.title %><br /><%= "​" + song.artistName %><% } %></div></div>',f=Myspace.AutoComplete(c,{handlerUrl:"/ajax/autocomplete/songs?max=20",template:'<% locals.forEach(function(song) { %><li <% if (song.currentSong) { %>class="current"<% } %>>'+e+"</li>"+"<% }); %>",interval:500,minlen:3,positionEl:b,allowClickDefault:!0,onType:function(a){var b=a.which;b===27&&(f.hideList(),c.blur()),(b==38||b==40||b==13||b==9)&&a.preventDefault()},onGetDataSuccessfully:function(a,b){g(a,b)},onSelectItem:function(e,g){if(a(g.target).hasClass("playBtn"))return!0;var i=a(e);i.hasClass("current")?d=h():d=objectify(i.find(".playBtn"));var j=b.find(".media > .songImage").first();j.replaceWith(i.find(".media > a").clone()),c.html(htmlEncode(d.title)+"<br />​"+htmlEncode(d.artistName)).removeClass("empty"),b.removeClass("searching").removeClass("empty"),f.setNoListOnFocus(!0),c.click(),placeCaretAtEnd(c[0]),f.setNoListOnFocus(!1),g.which==13&&g.stopImmediatePropagation()},onSelectionModified:function(){b.addClass("searching")},onSelectionCleared:function(a){b.find(".media > .songImage").first().find(".playBtn").remove(),d={mediaId:-1,mediaReleaseId:-1},g([],a)},sessionRequired:!0});return{blur:function(){f.blur()},show:function(){c.click().focus(),f.showList()},hideList:function(){f.hideList()},getSongId:function(){return d.mediaId},getSongReleaseId:function(){return d.mediaReleaseId}}}})(jQuery);
(function(a){Myspace.TopFriendsEditor=function(b,c){function s(){q||(d.find("i").click(function(){return u(),!1}),l.keyup(B).keydown(C),p=require("ejs").compile(templates["areas/stream/views/helpers/_userSquare"]),q=!0),w(),d.show(),l.click(),l.focus(),a(document).mousedown(t)}function t(b){a(b.target).closest(".friendSelector").length||u()}function u(){a(document).unbind("mousedown",t),d.hide()}function v(){m.html("")}function w(){var a=y(),b;if(!a){H(),v();return}b?x(b,a):f&&z(a)}function x(a,b){var c=y(),d="";if(c!=b)return;a=F(a),a&&a.forEach(function(a){var b=p({user:a,size:"70x70",links:{profile:function(a){return"/"+a}}});d+='<li class="media size_40 inline">'+b+"<div>"+"<h6>"+a.fullName+"</h6>"+"<h5>"+a.username+"</h5>"+"</div>"+"</li>"}),m.html(d)}function y(){return a.trim(l.val())}function z(b){var c=k[b];c?x(c,b):(n.show(),a.ajax({data:{query:b,max:h,ssid:r},type:"POST",url:f,success:function(a,c,d){n.hide();var e=a.data||[];k[b]=e,x(e,b);var f=d.getResponseHeader("X-SearchSessionId");f&&(r=f)},error:function(){l.removeClass("loadingAutoComplete")}}))}function A(b){var c=m.children(),d=c.length,e;if(d){b?j>0&&(e=!0):j<d&&(j==d-1&&--j,e=!0);if(e){c.removeClass("hover"),b?--j:++j;var f=c[j],g=m.scrollTop(),h=b?g-f.offsetTop:f.offsetTop+f.offsetHeight-m.innerHeight()-g;a(f).addClass("hover"),h>0&&m.scrollTop(b?g-h:g+h)}}}function B(a){var b=a.which;b==13?D(null,m.children(".hover")):b==38||b==40?(A(b==38),a.preventDefault()):y()===""||b===27?(i.stop(),w()):(v(),i.reset())}function C(a){var b=a.which;return b!==13&&b!==38&&b!==40}function D(c,d){try{var f=a(d).closest("li"),g=f.children("a"),h=g.data("profileid");if(h){G(f),j=-1;if(o.indexOf(h)>-1)return;var i=a('<li class="media size_50">');i.append(g),i.append('<i class="x_18_border" data-action="removeFriend"></i>'),e.append(i),o.push(h),o.length>=8&&u(),b.removeClass("empty")}l.focus()}catch(k){console.log(k)}}function E(){var b=[];return e.find("li > a").each(function(){b.push(a(this).data("profileid"))}),b.slice(0,8)}function F(a){var b=[];return a.forEach(function(a){o.indexOf(a.profileId)==-1&&b.push(a)}),b}function G(b){b.fadeOut(500,function(){a(this).remove()})}function H(){r=undefined}var d=b.find(".friendSelector"),e=b.find(".friendsGrid"),f="/ajax/autocomplete/connections",g=200,h=10,i=new Myspace.ResetTimer(w,g),j=-1,k={},l=d.find(".search"),m=d.find("ul"),n=d.find(".loadingIcon"),o=E(),p,q,r;return new Myspace.SortManager({$elem:e,activeClass:"dragging",dragText:function(a,b){return b.find("img").attr("alt")},dragEnd:function(){c(),o=E()}}),d.delegate("li","click",function(a){a.preventDefault(),a.stopImmediatePropagation(),D(a,this)}).delegate("li","mouseenter",function(b){m.children().removeClass("hover"),a(this).addClass("hover")}),m.on("mousewheel",function(a){a.stopPropagation()}),b.delegate(".grid, i, .placeholder","click",function(c){var d=a(c.target);d.data("action")=="removeFriend"?(d.parent().remove(),w(),o=E(),o.length||b.addClass("empty")):context.followingCount===0?Myspace.Confirm({text:"Connect to your friends to add them to your Top 8.",yes:{text:"OK"},no:!1}):d.is("img")||o.length<8&&s()}),{getTopFriendsValue:function(){return o.slice(0,8).join(",")||-1},open:s,close:u}}})(jQuery);
(function(a){function x(b){if(b.type=="click"){var c=a(b.target);return c.is("#addFeatured")||!c.closest("#profileDetails,#editProfile").length&&c.data("action")!="removeFriend"}return b.type=="keydown"?b.which===13||b.which===27:!0}function y(){var a={};Object.keys(u).forEach(function(b){t[b]!=u[b]&&(a[b]=u[b])}),Object.keys(a).length&&!v&&z(a)}function z(b){function c(b){var c=a.parseJSON(b.responseText),d=c.profileObjectVersion,e=c.profileDetailsObjectVersion,f;d&&(context.profileObjectVersion=d),e&&(context.profileDetailsObjectVersion=e),b.status==409?f={text:"Oops, your profile is out-of-date. Do you still want to save, or reload your previously saved profile?",yes:{text:"Reload",onClick:function(){comm.send("location.href",location.href)}},no:{text:"Save",onClick:function(){y()}}}:f={yes:{onClick:function(){y()}}},setTimeout(function(){Myspace.Error(f)},550)}v=!0,u={},b.profileObjectVersion=context.profileObjectVersion,b.profileDetailsObjectVersion=context.profileDetailsObjectVersion,a.ajax({url:"/ajax/editprofile/update",type:"POST",data:b,success:function(a){comm.send("profile.objectversion",a.profileObjectVersion),comm.send("profiledetails.objectversion",a.profileDetailsObjectVersion),Object.keys(b).forEach(function(a){t[a]=b[a]}),a.websiteLink&&k.html(a.websiteLink),v=!1,y()},error:c})}function A(a){if(!m)return;d.removeClass("empty");var b="";l.data("bioType")=="artist"?b=a?"Edit bio & contacts":"Bio & Contact":b=a?"Edit bio":"Bio",n.text(b)}function B(){if(!s.is(":visible"))return;var a=-(200+b[0].scrollLeft)+"px";s[0].style.marginLeft=a,r[0].style.marginLeft=a,q[0].style.marginLeft=a}var b=a("#parallax"),c=a("#profileDetails"),d=c.children("#locAndWeb"),e=new Myspace.ContentEditableForm(c,{editablesSelector:".contentEditable, #profileSong, #topFriends",editableSections:a("#profileSong, #locAndWeb, #aboutMe"),exitValidator:x}),f=a("#profileImageUpload"),g=c.children("#topFriends"),h=new Myspace.TopFriendsEditor(g,function(){e.enterEditMode()}),i=new Myspace.SongEditor(c.children("#profileSong")),j=d.children(".location"),k=d.children(".website"),l=d.children(".bio"),m=l.length&&!l.hasClass("empty"),n=l.children(),o=a("#aboutMe"),p=a("#background"),q=a("#editProfileImage"),r=a("#editCoverImage"),s=a("#profileTutorial"),t={aboutMe:a.trim(o.text()),websiteUri:a.trim(k.text()),residenceLocationId:j.data("value"),profileSongId:i.getSongId(),profileSongReleaseId:i.getSongReleaseId(),topFriendsProfileIds:h.getTopFriendsValue()},u={},v,w=Myspace.AutoComplete(j,{handlerUrl:"/ajax/geosearch",template:'<% locals.forEach(function(item) { %><li data-value="<%= item.locationId %>"><%= item.locationNameWithHierarchy %></li><% }); %>',noListOnFocus:!0,onType:function(a){var b=a.which;b===27&&(w.hideList(),j.blur()),(b==38||b==40||b==13||b==9)&&a.preventDefault()},interval:500,minLen:5,onSelectItem:function(b,c){var d=a(b),e=d.data("value"),f=d.text();j.data("value",e).data("displayText",f).text(f),j.click(),placeCaretAtEnd(j[0]),c.which==13&&c.stopPropagation()},onSelectionCleared:function(){j.data("value",0).data("displayText","").text("​")},sessionRequired:!0});f.on("mouseenter",function(){a(this).addClass("open")}).on("mouseleave",function(){a(this).removeClass("open")}),f.find(".coverImageBtn").click(function(){comm.send("coverImageChooser.open"),b.animate({scrollLeft:0},500),r.removeClass("hide")}),f.find(".profileImageBtn").click(function(){comm.send("profileImageChooser.open"),b.animate({scrollLeft:0},500),q.removeClass("hide")}),comm.listen("contentEditableForm.exitEditMode,spaceway.page.beforeCleanup",function(a){if(!a||a.$form.is("#profileDetails"))f.removeClass("editing open"),h.close(),i.blur(),w.blur(),A(!1),u.profileSongId=i.getSongId(),u.profileSongReleaseId=i.getSongReleaseId(),u.topFriendsProfileIds=h.getTopFriendsValue(),y()}),comm.listen("contentEditableForm.enterEditMode",function(a){a.$form.is("#profileDetails")&&(f.addClass("editing"),A(!0))}),comm.listen("profile.edit.aboutMe",function(a){u.aboutMe=a.value}),comm.listen("profile.edit.websiteUri",function(a){u.websiteUri=a.value}),comm.listen("profile.edit.location",function(a){a&&a.value===""?u.residenceLocationId=null:u.residenceLocationId=j.data("value")}),comm.listen("profile.coverImageUploaded",function(b){a("#background").css("background-image","url('"+b.urls[0].url+"')")}),comm.listen("profile.imageUploaded",function(b){a("#sidebar > header > .item > .mediaSquare > a > img").attr("src",b.urls[2].url)}),comm.listen("profile.objectversion",function(a){context.profileObjectVersion=a}),comm.listen("profiledetails.objectversion",function(a){context.profileDetailsObjectVersion=a}),a("#editProfile").click(function(){e.enterEditMode()});if(queryString["mode"]=="edit"){e.enterEditMode();switch(queryString.action){case"profileimage":case"coverimage":f.addClass("open").css("display","block");break;case"topfriends":h.open();break;case"aboutme":o.find(".contentEditable").click().focus();break;case"profilesong":i.show();break;case"location":j.click().focus();break;case"website":k.click().focus()}}b.length&&p.length&&b.on("scroll",B)})(jQuery);
var Myspace=Myspace||{};(function(a){function h(a,b){g.StartUpload()}function i(a,b,c){n(c.errorMessage,"error")}function j(a,c){b.addClass("photoObject loading"),n("Your upload is in progress.","info")}function k(a,c,g){comm.send("profile.imageUploadComplete");var h=Myspace.PhotoCropper;h.setOptions({photoUrl:g.image.url,photoType:e.MEDIA_TYPES.PROFILE,photoDimensions:{width:g.image.width,height:g.image.height},successCallback:function(a){comm.send("profile.objectversion",a.objectVersion),comm.send("profile.imageUploaded",a),b.removeClass("loading"),n("Upload completed successfully!","ok"),setTimeout(m,5e3)},failedCallback:function(a){l(null,null,a)}},function(){d.hasClass("hide")||(f=!0,d.addClass("hide")),h.show()})}function l(a,c,d){n(d.errorMessage,"error"),setTimeout(m,5e3),b.removeClass("loading")}function m(){c.tip("hide"),b.removeClass("photoObject")}function n(b,d){var e="";switch(d){case"ok":e="addOKCustomClass";break;case"warning":e="addWarningCustomClass";break;case"error":e="addErrorCustomClass";break;case"info":e="addInfoCustomClass"}a('.tip[data-name="editProfileTip"] > .tip-inner').text(b),c.attr("data-original-title",b).tip(e).tip("show")}function o(){f&&(d.removeClass("hide"),f=!1)}function p(a){var b=atob(a.split(",")[1]),c=[];for(var d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/jpeg"})}function q(){var a="";for(var b=0;b<32;b++)a+=Math.floor(Math.random()*16).toString(16);return a}function r(b){var c=new XMLHttpRequest,d=new FormData,f=p(b);d.append("file",f,"webcam.jpeg"),d.append("type",e.MEDIA_TYPES.PROFILE),d.append("ui",q()),d.append("utoken",window.context.hashMashter),c.addEventListener("load",function(b){var c=a.parseJSON(b.target.responseText)[0];k(f,null,c)},!1),c.open("POST",e.GetUploadEndpoint(e.MEDIA_TYPES.TEMP)),c.send(d)}var b=a("#sidebar .mediaSquare"),c=a("#editProfilePhoto, #profileImageUpload > strong",b),d=a("#profileTutorial"),e=Myspace.Upload,f=!1,g=new Myspace.LiteUploader({MEDIA_TYPE:e.MEDIA_TYPES.TEMP,POST_PARAMS:{type:e.MEDIA_TYPES.PROFILE},UPLOAD_BEGIN_HANDLER:j,UPLOAD_ERROR_HANDLER:l,UPLOAD_COMPLETE_HANDLER:k,FILE_PROCESSED_SUCCESS_HANDLER:h,FILE_PROCESSED_ERROR_HANDLER:i,html:{filesInput:a(".profile.imageChooser .profileImageFile")}});c.tip({placement:"right",trigger:"manual",name:"editProfileTip"}),comm.listen("photoCropper.canceled",function(){m(),o(),b.removeClass("photoObject loading")}),comm.listen("photoCropper.hiding",function(){o()}),comm.listen("profileTutorial.hiding",function(){f=!0}),comm.listen("profileImageChooser.invokeWebcam",function(){Myspace.Webcam.takePhoto(function(a,b){a?Myspace.errorDialog("Sorry, we were unable to connect to your webcam"):r(b)})})})(jQuery);
(function(a){function h(a,b){g.StartUpload()}function i(a,b,c){n(c.errorMessage,"error")}function j(a,c){b.addClass("photoObject loading"),e.addClass("photoObject loading"),n("Your upload is in progress. Feel free to make other changes to your profile in the meantime.","info")}function k(a,c,d){m(!0),n("Upload completed successfully!","ok"),setTimeout(m,5e3),b.removeClass("loading"),e.removeClass("photoObject loading"),comm.send("profile.objectversion",d.objectVersion),comm.send("profile.coverImageUploaded",d)}function l(a,c,d){n(d.errorMessage,"error"),setTimeout(m,5e3),b.removeClass("loading"),e.removeClass("photoObject loading")}function m(){c.tip("hide"),b.removeClass("photoObject")}function n(b,d){var e="";switch(d){case"ok":e="addOKCustomClass";break;case"warning":e="addWarningCustomClass";break;case"error":e="addErrorCustomClass";break;case"info":e="addInfoCustomClass"}a('.tip[data-name="editCoverTip"] > .tip-inner').text(b),c.attr("data-original-title",b).tip(e).tip("show")}var b=a("#editCover, #profileImageUpload"),c=a("#editCover, #profileImageUpload > strong"),d=a(".cover.imageChooser"),e=d.find("ul"),f=Myspace.Upload,g=new Myspace.LiteUploader({MEDIA_TYPE:f.MEDIA_TYPES.COVER,UPLOAD_BEGIN_HANDLER:j,UPLOAD_ERROR_HANDLER:l,UPLOAD_COMPLETE_HANDLER:k,FILE_PROCESSED_SUCCESS_HANDLER:h,FILE_PROCESSED_ERROR_HANDLER:i,html:{filesInput:a(".cover.imageChooser .coverImageFile")}});c.tip({placement:"right",trigger:"manual",name:"editCoverTip"})})(jQuery);
(function(a){function l(){f.HasInitiatedProfileTutorial=a(".yourProfileStep",b).data("onLoad",t),f.HasCompletedProfileImageTutorial=a(".profileImageStep",b).data("onLoad",p).data("onUnload",q),f.HasCompletedCoverImageTutorial=a(".cover.imageChooser",b).data("onLoad",p).data("onUnload",q),f.HasCompletedProfileDetailsTutorial=a(".profileDetailsStep",b).data("onLoad",r).data("onUnload",s),f.HasCompletedMediaTutorial=a(".uploadMediaStep",b).data("onLoad",t),b.on("click","button, a.startOver",function(c){c.preventDefault();var d=a(this),e=d.closest(".step"),f=c.target.tagName==="A"?b.children("div:first-child"):e.next();w(i.data("onUnload")),i.addClass("hide"),f[0]!=null?(f.removeClass("hide"),g=o(f),i=f):(b.addClass("hide"),g="",i=null,u()),w(f.data("onLoad"))});if(e)for(var c in f)f.hasOwnProperty(c)&&(e[c]=="False"&&g==""?(g=c,i=f[g]):e[c]=="True"&&f[c].remove());g!=""&&(v(i),w(i.data("onLoad")),i.removeClass("hide"),b.removeClass("hide"))}function m(a){if(e[a]=="False"){var b={settingName:a,settingValue:"True"};j.push(b),k||n(b)}}function n(b){k=!0,b.homeTraySettingVersion=e.objectVersion,a.ajax({url:"/ajax/profile/homeSetting/update",data:b,type:"POST",dataType:"json",success:function(a){if(a&&a.success){e.objectVersion=a.homeTraySettingVersion,e[b.settingName]="True",j.shift();if(j.length>0)return n(j[0]);k=!1}},error:function(){console.log("error while updating Home setting")}})}function o(a){for(var b in f)if(f.hasOwnProperty(b)&&f[b][0]===a[0])return b}function p(){d.addClass("hover"),c.addClass("open")}function q(){d.removeClass("hover"),c.removeClass("open"),(context.profileImageId>0&&g=="HasCompletedProfileImageTutorial"||context.coverImageId>0&&g=="HasCompletedCoverImageTutorial")&&m(g)}function r(){comm.send("show.editprofile.show")}function s(){comm.send("show.editprofile.hide"),context.hasProfileDetails&&m(g)}function t(){m(g)}function u(){e.HasViewedWelcomeMessage=="False"&&comm.send("show.tooltip",{name:"home"})}function v(a){var c=b.children("div:last-child"),d=c.find(".header > .steps");c.prev().length>0&&d.append('<a href="#" class="startOver">Start again</a>'),d.find("button").text("Finish")}function w(a){a&&a()}var b=a("#profileTutorial"),c=a("#profileImageUpload"),d=a("#sidebar .mediaSquare"),e=context.profileSettings,f={},g="",h=0,i=null,j=[],k=!1;comm.listen("profiledetails.objectversion",function(){m("HasCompletedProfileDetailsTutorial")}),comm.listen("profile.imageUploaded",function(){m("HasCompletedProfileImageTutorial")}),comm.listen("profile.coverImageUploaded",function(){m("HasCompletedCoverImageTutorial")}),comm.listen("profile.objectversion",function(a){h=a}),comm.listen("tutorial.updateHomeSetting",function(a){m(a)}),l()})(jQuery);
(function(a){function i(){b.on({click:function(c){var d=a(c.target),f=d.data("url"),h={defaultCoverImageEntityKey:d.data("defaultcoverentitykey"),imageId:d.data("imageid"),albumId:d.data("albumid"),imageType:"cover"};b.addClass("photoObject loading"),a.save({url:"/ajax/editprofile/updateimage",method:"POST",type:"POST",data:h,success:function(a){g='url("'+f+'")',e.css("background-image",'url("'+g+'")'),comm.send("profile.objectversion",a.profileObjectVersion),comm.send("tutorial.updateHomeSetting","HasCompletedCoverImageTutorial")},complete:function(){b.removeClass("photoObject loading")}})},mouseenter:function(b){var c=a(b.target),d=c.data("url");e.css("background-image",'url("'+d+'")')},mouseleave:function(a){e.css("background-image",g)}},"li"),b.find("i").click(function(){b.each(function(){var b=a(this);b.hasClass("edit")&&(b.parent().addClass("hide"),h&&(f.removeClass("hide"),h=!1))})}),b.bind("mousewheel",function(a){a.stopPropagation()})}var b=a(".cover.imageChooser"),c=a("#editProfileImage"),d=b.find("ul"),e=a("#background"),f=a("#profileTutorial"),g=e.css("background-image"),h=!1;comm.listen("profile.coverImageUploaded",function(a){var b=a.urls;g='url("'+b[0].url+'")';var c="<li><img data-url="+b[0].url+" src="+b[3].url+" data-imageId="+a.imageId+" data-albumId="+a.albumId+" /></li>";d.prepend(c)}),comm.listen("coverImageChooser.open",function(){f.hasClass("hide")||(comm.send("profileTutorial.hiding"),f.addClass("hide")),c.addClass("hide")}),comm.listen("profileTutorial.hiding",function(){h=!0}),i()})(jQuery);
var Myspace=Myspace||{};(function(a){function j(){b.on({click:function(c){var d=a(c.target),f=d.data("url"),h={imageId:d.data("imageid"),albumId:d.data("albumid"),imageType:"profile"};b.addClass("photoObject loading"),a.save({url:"/ajax/editprofile/updateimage",method:"POST",type:"POST",data:h,success:function(a){g=f,e.attr("src",f),comm.send("profile.objectversion",a.profileObjectVersion)},complete:function(){b.removeClass("photoObject loading")}})},mouseenter:function(b){var c=a(b.target),d=c.data("url");e.attr("src",d)},mouseleave:function(a){e.attr("src",g)}},"li"),b.find("i").click(function(){b.each(function(){a(this).parent().addClass("hide"),h&&(f.removeClass("hide"),h=!1)})}),b.bind("mousewheel",function(a){a.stopPropagation()}),window.context.isPorfileImageWebcamEnabled&&Myspace.Webcam.isSupported&&b.addClass("webcamSupported").find(".webcam").click(function(){comm.send("profileImageChooser.invokeWebcam")})}var b=a(".profile.imageChooser"),c=a("#editCoverImage"),d=b.find("ul"),e=a("#profileImage > img"),f=a("#profileTutorial"),g=e.attr("src"),h=!1,i=!1;comm.listen("profile.imageUploaded",function(a){var b=a.urls;g=b[2].url;var c="<li><img data-url="+b[2].url+" src="+b[3].url+" data-imageId="+a.imageId+" data-albumId="+a.albumId+" /></li>";d.prepend(c)}),comm.listen("profileImageChooser.open",function(){f.hasClass("hide")||(comm.send("profileTutorial.hiding"),f.addClass("hide")),c.addClass("hide")}),comm.listen("profile.imageUploadComplete",function(){b.parent().addClass("hide"),i=!0}),comm.listen("photoCropper.canceled",function(){i&&(b.parent().removeClass("hide"),i=!1)}),comm.listen("profileTutorial.hiding",function(){h=!0}),j()})(jQuery);
