/* connections */(function(a){function n(){return a.ajax({type:"POST",data:{start:l?f:h,nextEntityType:g},url:i})}function o(){m&&m.stop()}function p(){m&&m.reset()}function q(){if(l)return;l=!0,k.hide().html(""),o(),i="/ajax"+window.location.pathname,c.html(d),f=e.nextStart,p()}function r(b){o(),l=!1,k.removeClass("loading").html("");var d=a(b.html).children();d.length?(i="/ajax/connections/search?q="+j.val(),h=b.nextStart,c.html(d),h!=-1&&p(),comm.send("page.changed",c)):(h=1,k.html("No results found."))}var b=a(".horizontalContent"),c=b.find(".grid"),d=c.children(),e=context.pageData||{},f=isNaN(e.nextStart)?-1:e.nextStart,g=e.nextEntityType,h=1,i="/ajax"+window.location.pathname,j=a("#connections-search-query"),k=a("#status"),l=!0,m;a(".post-photo").on("click",function(){comm.send("location.href","/manage/photos")}),new Myspace.DropDown("#connectionsFilter .dropDown",{eventTracking:{category:"Profile Connections",action:function(a){var b=a.data("value").split(",")[1];return"Select: "+(b?b:a.text().trim())}}}),context.isIE&&context.ieVersion<=9&&c.imagesLoaded(function(){c.isotope({layoutMode:"masonryHorizontal"})}),comm.listen("connections.view",function(a){comm.send("location.href",a.value.split(",")[0])}),c.attr("id")=="imageGrid"&&a("#uploadPhotoKPI").click(function(){comm.send("rightRail.hide"),comm.send("superpost",{element:this,placeholder:"Say something about this photo.",photoUpload:!0})}),f!=-1&&(m=new Myspace.Scroller(b,{content:c,offset:100},function(){m.beginLoading(),n().done(function(b){m.endLoading();var d=a(b.html).children();c.append(d);var e=b.nextStart;e===-1&&m.stop(),l?f=e:h=e,g=b.nextEntityType,comm.send("page.changed",c)}).fail(function(){m.error()})})),j&&new Myspace.AutocompleteSearchV1(j,{url:"/ajax/connections/search?q="+j.val(),limit:e.max||40,onClear:q,onLoading:function(){o(),c.html(""),k.html("").addClass("loading").show()},onSuccess:r,onError:function(a){k.removeClass("loading").html("Unable to retrieve search results.")}})})(jQuery);
